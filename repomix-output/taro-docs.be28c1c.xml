This file is a merged representation of a subset of the codebase, containing specifically included files, combined into a single document by Repomix.
The content has been processed where content has been compressed (code blocks are separated by ⋮---- delimiter).

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: docs/**/*.{mdx,md}
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Content has been compressed - code blocks are separated by ⋮---- delimiter
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
docs/
  apis/
    about/
      desc.md
      env.md
      events.md
      tarocomponent.md
    ad/
      createInterstitialAd.md
      createRewardedVideoAd.md
      InterstitialAd.md
      RewardedVideoAd.md
    ai/
      face/
        faceDetect.md
        initFaceDetect.md
        stopFaceDetect.md
      inference/
        createInferenceSession.md
        getInferenceEnvInfo.md
        InferenceSession.md
      visionkit/
        createVKSession.md
        isVKSupport.md
        VKBodyAnchor.md
        VKCamera.md
        VKDepthAnchor.md
        VKFaceAnchor.md
        VKFrame.md
        VKHandAnchor.md
        VKMarkerAnchor.md
        VKOCRAnchor.md
        VKOSDAnchor.md
        VKPlaneAnchor.md
        VKSession.md
    alipay/
      getOpenUserInfo.md
      tradePay.md
    base/
      crypto/
        getRandomValues.md
        getUserCryptoManager.md
        UserCryptoManager.md
      debug/
        console.md
        getLogManager.md
        getRealtimeLogManager.md
        LogManager.md
        RealtimeLogManager.md
        RealtimeTagLogManager.md
        setEnableDebug.md
      env/
        env.md
      performance/
        EntryList.md
        getPerformance.md
        Performance.md
        PerformanceEntry.md
        PerformanceObserver.md
        preloadAssets.md
        preloadSkylineView.md
        preloadWebview.md
        reportPerformance.md
      system/
        getAppAuthorizeSetting.md
        getAppBaseInfo.md
        getDeviceInfo.md
        getRendererUserAgent.md
        getSkylineInfo.md
        getSkylineInfoSync.md
        getSystemInfo.md
        getSystemInfoAsync.md
        getSystemInfoSync.md
        getSystemSetting.md
        getWindowInfo.md
        openAppAuthorizeSetting.md
        openSystemBluetoothSetting.md
      update/
        getUpdateManager.md
        UpdateManager.md
        updateWeChatApp.md
      weapp/
        app-event/
          offAppHide.md
          offAppShow.md
          offAudioInterruptionBegin.md
          offAudioInterruptionEnd.md
          offError.md
          offPageNotFound.md
          offThemeChange.md
          offUnhandledRejection.md
          onAppHide.md
          onAppShow.md
          onAudioInterruptionBegin.md
          onAudioInterruptionEnd.md
          onError.md
          onPageNotFound.md
          onThemeChange.md
          onUnhandledRejection.md
        life-cycle/
          getEnterOptionsSync.md
          getLaunchOptionsSync.md
      arrayBufferToBase64.md
      base64ToArrayBuffer.md
      canIUse.md
      canIUseWebp.md
      env.md
      preload.md
    canvas/
      Canvas.md
      CanvasContext.md
      canvasGetImageData.md
      CanvasGradient.md
      canvasPutImageData.md
      canvasToTempFilePath.md
      Color.md
      createCanvasContext.md
      createContext.md
      createOffscreenCanvas.md
      drawCanvas.md
      Image.md
      ImageData.md
      OffscreenCanvas.md
      Path2D.md
      RenderingContext.md
      toTempFilePath.md
    cloud/
      cloud.md
      DB.md
    data-analysis/
      getCommonConfig.md
      getExptInfoSync.md
      reportAnalytics.md
      reportEvent.md
      reportMonitor.md
    device/
      accelerometer/
        offAccelerometerChange.md
        onAccelerometerChange.md
        startAccelerometer.md
        stopAccelerometer.md
      accessibility/
        checkIsOpenAccessibility.md
      battery/
        getBatteryInfo.md
        getBatteryInfoSync.md
      bluetooth/
        closeBluetoothAdapter.md
        getBluetoothAdapterState.md
        getBluetoothDevices.md
        getConnectedBluetoothDevices.md
        isBluetoothDevicePaired.md
        makeBluetoothPair.md
        offBluetoothAdapterStateChange.md
        offBluetoothDeviceFound.md
        onBluetoothAdapterStateChange.md
        onBluetoothDeviceFound.md
        openBluetoothAdapter.md
        startBluetoothDevicesDiscovery.md
        stopBluetoothDevicesDiscovery.md
      bluetooth-ble/
        closeBLEConnection.md
        createBLEConnection.md
        getBLEDeviceCharacteristics.md
        getBLEDeviceRSSI.md
        getBLEDeviceServices.md
        getBLEMTU.md
        notifyBLECharacteristicValueChange.md
        offBLECharacteristicValueChange.md
        offBLEConnectionStateChange.md
        offBLEMTUChange.md
        onBLECharacteristicValueChange.md
        onBLEConnectionStateChange.md
        onBLEMTUChange.md
        readBLECharacteristicValue.md
        setBLEMTU.md
        writeBLECharacteristicValue.md
      bluetooth-peripheral/
        BLEPeripheralServer.md
        createBLEPeripheralServer.md
        offBLEPeripheralConnectionStateChanged.md
        onBLEPeripheralConnectionStateChanged.md
      calendar/
        addPhoneCalendar.md
        addPhoneRepeatCalendar.md
      clipboard/
        getClipboardData.md
        setClipboardData.md
      compass/
        offCompassChange.md
        onCompassChange.md
        startCompass.md
        stopCompass.md
      contact/
        addPhoneContact.md
        chooseContact.md
      gyroscope/
        offGyroscopeChange.md
        onGyroscopeChange.md
        startGyroscope.md
        stopGyroscope.md
      iBeacon/
        getBeacons.md
        IBeaconInfo.md
        offBeaconServiceChange.md
        offBeaconUpdate.md
        onBeaconServiceChange.md
        onBeaconUpdate.md
        startBeaconDiscovery.md
        stopBeaconDiscovery.md
      keyboard/
        getSelectedTextRange.md
        hideKeyboard.md
        offKeyboardHeightChange.md
        onKeyboardHeightChange.md
      memory/
        offMemoryWarning.md
        onMemoryWarning.md
      motion/
        offDeviceMotionChange.md
        onDeviceMotionChange.md
        startDeviceMotionListening.md
        stopDeviceMotionListening.md
      network/
        getLocalIPAddress.md
        getNetworkType.md
        offNetworkStatusChange.md
        offNetworkWeakChange.md
        onNetworkStatusChange.md
        onNetworkWeakChange.md
      nfc/
        getHCEState.md
        getNFCAdapter.md
        IsoDep.md
        MifareClassic.md
        MifareUltralight.md
        Ndef.md
        NfcA.md
        NFCAdapter.md
        NfcB.md
        NfcF.md
        NfcV.md
        offHCEMessage.md
        onHCEMessage.md
        sendHCEMessage.md
        startHCE.md
        stopHCE.md
      phone/
        makePhoneCall.md
      scan/
        scanCode.md
      screen/
        getScreenBrightness.md
        getScreenRecordingState.md
        offScreenRecordingStateChanged.md
        offUserCaptureScreen.md
        onScreenRecordingStateChanged.md
        onUserCaptureScreen.md
        setKeepScreenOn.md
        setScreenBrightness.md
        setVisualEffectOnCapture.md
      sms/
        sendSms.md
      vibrate/
        vibrateLong.md
        vibrateShort.md
      wifi/
        connectWifi.md
        getConnectedWifi.md
        getWifiList.md
        offGetWifiList.md
        offWifiConnected.md
        offWifiConnectedWithPartialInfo.md
        onGetWifiList.md
        onWifiConnected.md
        onWifiConnectedWithPartialInfo.md
        setWifiList.md
        startWifi.md
        stopWifi.md
        WifiInfo.md
    ext/
      getExtConfig.md
      getExtConfigSync.md
    files/
      FileSystemManager.md
      getFileInfo.md
      getFileSystemManager.md
      getSavedFileInfo.md
      getSavedFileList.md
      openDocument.md
      ReadResult.md
      removeSavedFile.md
      saveFile.md
      saveFileToDisk.md
      Stats.md
      WriteResult.md
    framework/
      App.md
      getApp.md
      getCurrentPages.md
      Page.md
    location/
      chooseLocation.md
      choosePoi.md
      getFuzzyLocation.md
      getLocation.md
      offLocationChange.md
      offLocationChangeError.md
      onLocationChange.md
      onLocationChangeError.md
      openLocation.md
      startLocationUpdate.md
      startLocationUpdateBackground.md
      stopLocationUpdate.md
    media/
      audio/
        AudioBuffer.md
        AudioContext.md
        createAudioContext.md
        createInnerAudioContext.md
        createMediaAudioPlayer.md
        createWebAudioContext.md
        getAvailableAudioSources.md
        InnerAudioContext.md
        MediaAudioPlayer.md
        pauseVoice.md
        playVoice.md
        setInnerAudioOption.md
        stopVoice.md
        WebAudioContext.md
        WebAudioContextNode.md
      background-audio/
        BackgroundAudioManager.md
        getBackgroundAudioManager.md
        getBackgroundAudioPlayerState.md
        onBackgroundAudioPause.md
        onBackgroundAudioPlay.md
        onBackgroundAudioStop.md
        pauseBackgroundAudio.md
        playBackgroundAudio.md
        seekBackgroundAudio.md
        stopBackgroundAudio.md
      camera/
        CameraContext.md
        CameraFrameListener.md
        createCameraContext.md
      editor/
        EditorContext.md
      image/
        chooseImage.md
        chooseMessageFile.md
        compressImage.md
        cropImage.md
        editImage.md
        getImageInfo.md
        previewImage.md
        previewMedia.md
        saveImageToPhotosAlbum.md
      live/
        createLivePlayerContext.md
        createLivePusherContext.md
        LivePlayerContext.md
        LivePusherContext.md
      map/
        createMapContext.md
        MapContext.md
      media-recorder/
        createMediaRecorder.md
        MediaRecorder.md
      recorder/
        getRecorderManager.md
        RecorderManager.md
        startRecord.md
        stopRecord.md
      video/
        chooseMedia.md
        chooseVideo.md
        compressVideo.md
        createVideoContext.md
        getVideoInfo.md
        openVideoEditor.md
        saveVideoToPhotosAlbum.md
        VideoContext.md
      video-decoder/
        createVideoDecoder.md
        VideoDecoder.md
      video-processing/
        createMediaContainer.md
        MediaContainer.md
        MediaTrack.md
      voip/
        exitVoIPChat.md
        join1v1Chat.md
        joinVoIPChat.md
        offVoIPChatInterrupted.md
        offVoIPChatMembersChanged.md
        offVoIPChatSpeakersChanged.md
        offVoIPChatStateChanged.md
        offVoIPVideoMembersChanged.md
        onVoIPChatInterrupted.md
        onVoIPChatMembersChanged.md
        onVoIPChatSpeakersChanged.md
        onVoIPChatStateChanged.md
        onVoIPVideoMembersChanged.md
        setEnable1v1Chat.md
        subscribeVoIPVideoMembers.md
        updateVoIPChatMuteConfig.md
    navigate/
      exitMiniProgram.md
      navigateBackMiniProgram.md
      navigateToMiniProgram.md
      openBusinessView.md
      openEmbeddedMiniProgram.md
    network/
      download/
        downloadFile.md
        DownloadTask.md
      mdns/
        offLocalServiceDiscoveryStop.md
        offLocalServiceFound.md
        offLocalServiceLost.md
        offLocalServiceResolveFail.md
        onLocalServiceDiscoveryStop.md
        onLocalServiceFound.md
        onLocalServiceLost.md
        onLocalServiceResolveFail.md
        startLocalServiceDiscovery.md
        stopLocalServiceDiscovery.md
      request/
        addInterceptor.md
        cleanInterceptors.md
        request.md
        RequestTask.md
      tcp/
        createTCPSocket.md
        TCPSocket.md
      udp/
        createUDPSocket.md
        UDPSocket.md
      upload/
        uploadFile.md
        UploadTask.md
      websocket/
        closeSocket.md
        connectSocket.md
        onSocketClose.md
        onSocketError.md
        onSocketMessage.md
        onSocketOpen.md
        sendSocketMessage.md
        SocketTask.md
    open-api/
      account/
        getAccountInfoSync.md
      address/
        chooseAddress.md
      authorize/
        authorize.md
        authorizeForMiniProgram.md
      card/
        addCard.md
        card.md
        openCard.md
      channels/
        getChannelsLiveInfo.md
        getChannelsLiveNoticeInfo.md
        getChannelsShareKey.md
        openChannelsActivity.md
        openChannelsEvent.md
        openChannelsLive.md
        openChannelsUserProfile.md
        reserveChannelsLive.md
      customer-service/
        openCustomerServiceChat.md
      device-voip/
        getDeviceVoIPList.md
        requestDeviceVoIP.md
      facial/
        checkIsSupportFacialRecognition.md
        startFacialRecognitionVerify.md
        startFacialRecognitionVerifyAndUploadVideo.md
      favorites/
        addFileToFavorites.md
        addVideoToFavorites.md
      group/
        getGroupEnterInfo.md
      invoice/
        chooseInvoice.md
        chooseInvoiceTitle.md
      license-plate/
        chooseLicensePlate.md
      login/
        checkSession.md
        login.md
        pluginLogin.md
      my-miniprogram/
        checkIsAddedToMyMiniProgram.md
      privacy/
        getPrivacySetting.md
        onNeedPrivacyAuthorization.md
        openPrivacyContract.md
        requirePrivacyAuthorize.md
      redpackage/
        showRedPackage.md
      settings/
        AuthSetting.md
        getSetting.md
        openSetting.md
        SubscriptionsSetting.md
      soter/
        checkIsSoterEnrolledInDevice.md
        checkIsSupportSoterAuthentication.md
        startSoterAuthentication.md
      sticker/
        openSingleStickerView.md
        openStickerIPView.md
        openStickerSetView.md
      subscribe-message/
        requestSubscribeDeviceMessage.md
        requestSubscribeMessage.md
        subscribeService.md
        unsubscribeMessage.md
      user-info/
        getUserInfo.md
        getUserProfile.md
        UserInfo.md
      werun/
        getWeRunData.md
        shareToWeRun.md
    payment/
      faceVerifyForPay.md
      requestOrderPayment.md
      requestPayment.md
    qq/
      addRecentColorSign.md
      applyAddToMyApps.md
      getGuildInfo.md
      getQQRunData.md
      isAddedToMyApps.md
      openQzonePublish.md
      setCustomDress.md
      setOfficialDress.md
      updateQQApp.md
    route/
      EventChannel.md
      navigateBack.md
      navigateTo.md
      redirectTo.md
      reLaunch.md
      router.md
      switchTab.md
    share/
      authPrivateMessage.md
      getShareInfo.md
      hideShareMenu.md
      offCopyUrl.md
      onCopyUrl.md
      shareFileMessage.md
      shareVideoMessage.md
      showShareImageMenu.md
      showShareMenu.md
      updateShareMenu.md
    skyline/
      DraggableSheetContext.md
      Snapshot.md
      worklet.md
    storage/
      background-fetch/
        getBackgroundFetchData.md
        getBackgroundFetchToken.md
        onBackgroundFetchData.md
        setBackgroundFetchToken.md
      cache-manager/
        CacheManager.md
        createCacheManager.md
      batchGetStorage.md
      batchGetStorageSync.md
      batchSetStorage.md
      batchSetStorageSync.md
      clearStorage.md
      clearStorageSync.md
      createBufferURL.md
      getStorage.md
      getStorageInfo.md
      getStorageInfoSync.md
      getStorageSync.md
      removeStorage.md
      removeStorageSync.md
      revokeBufferURL.md
      setStorage.md
      setStorageSync.md
    swan/
      bookshelf/
        deleteBookshelf.md
        insertBookshelf.md
        navigateToBookshelf.md
        queryBookshelf.md
        updateBookshelfReadTime.md
      download-package/
        downloadPackage.md
        downloadPackages.md
        loadSubPackage.md
      pay/
        getOptimalPriceInfo.md
        requestPolymerPayment.md
      getFavorStatus.md
      getSystemRiskInfo.md
      getTopStatus.md
      openBdboxWebview.md
      setDocumentTitle.md
      setMetaDescription.md
      setMetaKeywords.md
      setPageInfo.md
    taro.extend/
      eventCenter.md
      getAppInfo.md
      getCurrentInstance.md
      getEnv.md
      getEnvInfoSync.md
      getRenderer.md
      getTabBar.md
      initPxTransform.md
      interceptorify.md
      pxTransform.md
      requirePlugin.md
      setGlobalDataPlugin.md
    taro.hooks/
      useAddToFavorites.md
      useDidHide.md
      useDidShow.md
      useError.md
      useLaunch.md
      useLoad.md
      useOptionMenuClick.md
      usePageNotFound.md
      usePageScroll.md
      usePullDownRefresh.md
      usePullIntercept.md
      useReachBottom.md
      useReady.md
      useResize.md
      useRouter.md
      useSaveExitState.md
      useShareAppMessage.md
      useShareTimeline.md
      useTabItemTap.md
      useTitleClick.md
      useUnhandledRejection.md
      useUnload.md
    ui/
      animation/
        Animation.md
        createAnimation.md
      background/
        setBackgroundColor.md
        setBackgroundTextStyle.md
      custom-component/
        nextTick.md
      fonts/
        loadFontFace.md
      interaction/
        disableAlertBeforeUnload.md
        enableAlertBeforeUnload.md
        hideLoading.md
        hideToast.md
        showActionSheet.md
        showLoading.md
        showModal.md
        showToast.md
      menu/
        getMenuButtonBoundingClientRect.md
      navigation-bar/
        hideHomeButton.md
        hideNavigationBarLoading.md
        setNavigationBarColor.md
        setNavigationBarTitle.md
        showNavigationBarLoading.md
      pull-down-refresh/
        startPullDownRefresh.md
        stopPullDownRefresh.md
      scroll/
        pageScrollTo.md
        ScrollViewContext.md
      sticky/
        setTopBarText.md
      tab-bar/
        hideTabBar.md
        hideTabBarRedDot.md
        removeTabBarBadge.md
        setTabBarBadge.md
        setTabBarItem.md
        setTabBarStyle.md
        showTabBar.md
        showTabBarRedDot.md
      window/
        checkIsPictureInPictureActive.md
        offWindowResize.md
        onWindowResize.md
        setWindowSize.md
    worker/
      createWorker.md
      Worker.md
    wxml/
      createIntersectionObserver.md
      createMediaQueryObserver.md
      createSelectorQuery.md
      IntersectionObserver.md
      MediaQueryObserver.md
      NodesRef.md
      SelectorQuery.md
    General.md
    index.md
  components/
    base/
      icon.md
      progress.md
      rich-text.md
      text.md
    canvas/
      canvas.md
    forms/
      button.md
      checkbox-group.md
      checkbox.md
      editor.md
      form.md
      input.md
      keyboard-accessory.md
      label.md
      picker-view-column.md
      picker-view.md
      picker.md
      radio-group.md
      radio.md
      slider.md
      switch.md
      textarea.md
    gesture/
      double-tap-gesture-handler.md
      force-press-gesture-handler.md
      horizontal-drag-gesture-handler.md
      long-press-gesture-handler.md
      pan-gesture-handler.md
      scale-gesture-handler.md
      tap-gesture-handler.md
      vertical-drag-gesture-handler.md
    maps/
      map.md
    media/
      animation-video.md
      animation-view.md
      ar-camera.md
      audio.md
      camera.md
      channel-live.md
      channel-video.md
      image.md
      live-player.md
      live-pusher.md
      lottie.md
      rtc-room-item.md
      rtc-room.md
      video.md
      voip-room.md
    navig/
      functional-page-navigator.md
      navigation-bar.md
      navigator.md
      tab-item.md
      tabs.md
    open/
      ad-custom.md
      ad.md
      aweme-data.md
      comment-detail.md
      comment-list.md
      contact-button.md
      follow-swan.md
      inline-payment-panel.md
      lifestyle.md
      like.md
      login.md
      official-account.md
      open-data.md
      others.md
      web-view.md
    skyline/
      draggable-sheet.md
      grid-builder.md
      grid-view.md
      list-builder.md
      list-view.md
      nested-scroll-body.md
      nested-scroll-header.md
      open-container.md
      share-element.md
      snapshot.md
      span.md
      sticky-header.md
      sticky-section.md
    viewContainer/
      cover-image.md
      cover-view.md
      custom-wrapper.md
      match-media.md
      movable-area.md
      movable-view.md
      native-slot.md
      page-container.md
      root-portal.md
      script.md
      scroll-view.md
      slot.md
      swiper-item.md
      swiper.md
      view.md
    common.md
    event.md
    page-meta.md
  harmony/
    lazy/
      index.md
      reuse.md
    c-api-css.md
    c-api.md
    hybrid.md
    index.md
    meta.md
    troubleshooting.md
  platform-plugin/
    how.md
    index.md
    platform-mini.md
    platform-web.md
    reconciler.md
    template.md
  team/
    58anjuke.md
    index.mdx
    role-collaborator.mdx
    role-committee.mdx
    role-committer.mdx
    role-triage.mdx
    team-community.mdx
    team-core.mdx
    team-innovate.mdx
    team-platform.mdx
    team-plugin.mdx
  test-utils/
    fire-event.md
    index.md
    life-cycle.md
    other.md
    queries.md
    render.md
  app-config.md
  babel-config.md
  best-practice.md
  children.md
  cli.md
  codebase-overview.md
  come-from-miniapp.mdx
  communicate.mdx
  compile-optimized.mdx
  complier-mode.mdx
  component-style.md
  components-desc.mdx
  composition-api.md
  composition.md
  condition.md
  config-detail.md
  config.md
  context.md
  CONTRIBUTING-GUIDE.md
  CONTRIBUTING.md
  convert-to-react.md
  css-in-js.mdx
  css-modules.md
  custom-tabbar.mdx
  debug-config.md
  debug.md
  difference-to-others.md
  dynamic-import.md
  env-mode-config.md
  envs-debug.md
  envs.md
  event.md
  external-libraries.md
  folder.md
  functional-component.md
  GETTING-STARTED.md
  guide.mdx
  h5.md
  hooks.md
  html.mdx
  hybrid.mdx
  implement-note.md
  independent-subpackage.md
  join-in.md
  jquery-like.md
  jsx.md
  list.md
  migration.md
  mini-split-chunks-plugin.md
  mini-troubleshooting.md
  miniprogram-plugin.md
  mobx.md
  nutui.mdx
  optimized.mdx
  ossa.md
  page-config.mdx
  pinia.md
  plugin-custom.md
  plugin-mini-ci.md
  plugin.md
  preact.md
  prebundle.md
  prerender.md
  project-config.md
  props.md
  quick-app.md
  react-18.md
  react-devtools.md
  react-entry.mdx
  react-error-handling.mdx
  react-native-harmony.md
  react-native-remind.md
  react-native.md
  react-overall.md
  react-page.mdx
  README.mdx
  redux.md
  ref.mdx
  relations.md
  render-props.md
  report.md
  request.md
  router-extend.mdx
  router.mdx
  seowhy.md
  size.md
  skyline.mdx
  spec-for-taro.md
  specials.md
  state.md
  static-reference.md
  tailwindcss.mdx
  taro-dom.md
  taro-in-miniapp.mdx
  taro-quickapp-manifest.md
  taroize-troubleshooting.md
  taroize.md
  template.md
  treasures.md
  ui-lib.md
  use-h5.mdx
  vant.mdx
  version.md
  virtual-list.mdx
  virtual-waterfall.mdx
  vue-devtools.md
  vue-entry.mdx
  vue-overall.mdx
  vue-page.mdx
  vue3.md
  vuex.md
  wxcloudbase.md
  youshu.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="docs/apis/about/desc.md">
---
title: API 说明
---

Taro 的 API 包括 Taro 内置提供的 API 以及对小程序的端能力 API 的封装。

其中对小程序的端能力 API 的封装，主要会基于微信小程序的 API 规范，对于其他小程序类似的 API，会在 Taro 中适配为小程序 API 的规范格式，并且都挂载在 `Taro` 命名空间下。

例如，支付宝小程序中，`my.alert` 用于弹出一个警告的模态框，而微信小程序中没有这一 API，与之类似的有 `wx.showModal`，所以在 Taro 中会将支付宝的 `my.alert` 统一为 `Taro.showModal`，从而减少一些跨平台兼容代码的书写。

而对于微信小程序中没有，而某些小程序平台特有的 API，可以先尝试用 `Taro.` + API 名称来进行调用，如果出现未定义，则使用对应小程序平台的命名空间（如 `my`、`swan`、`tt` 等）来进行调用，并反馈给我们。

当然，由于各个小程序平台的迭代非常快速，Taro 要不断跟进小程序的更新，有时候难免有些 API 没有加入 Taro 适配，你可以通过提 PR 或者 issue，来获得帮助。

同时，为了方便代码书写，Taro 默认对小程序的异步 API 进行了 `promisify` 化，你可以像使用 Promise 那样进行调用，例如

```js
import Taro from '@tarojs/taro'

Taro.request(url).then(function (res) {
  console.log(res)
})
```
</file>

<file path="docs/apis/about/env.md">
---
title: 环境判断
---

## Taro.ENV_TYPE

`ENV_TYPE.WEAPP` 微信小程序环境

`ENV_TYPE.SWAN` 百度小程序环境

`ENV_TYPE.ALIPAY` 支付宝小程序环境

`ENV_TYPE.TT` 抖音小程序环境

`ENV_TYPE.WEB` WEB(H5)环境

`ENV_TYPE.RN` ReactNative 环境

`ENV_TYPE.QUICKAPP` 快应用环境

`ENV_TYPE.QQ` QQ小程序 环境

`ENV_TYPE.JD` 京东小程序 环境

`ENV_TYPE.ASCF` ASCF元服务环境

## Taro.getEnv()

获取当前环境值，具体值如上 `Taro.ENV_TYPE`
</file>

<file path="docs/apis/about/events.md">
---
title: 消息机制
---

Taro 提供了 `Taro.Events` 来实现消息机制，使用时需要实例化它，如下

```jsx
import Taro, { Events } from '@tarojs/taro'

const events = new Events()

// 监听一个事件，接受参数
events.on('eventName', (arg) => {
  // doSth
})

// 监听同个事件，同时绑定多个 handler
events.on('eventName', handler1)
events.on('eventName', handler2)
events.on('eventName', handler3)

// 触发一个事件，传参
events.trigger('eventName', arg)

// 触发事件，传入多个参数
events.trigger('eventName', arg1, arg2, ...)

// 取消监听一个事件
events.off('eventName')

// 取消监听一个事件某个 handler
events.off('eventName', handler1)

// 取消监听所有事件
events.off()
```

同时 Taro 还提供了一个全局消息中心 `Taro.eventCenter` 以供使用，它是 `Taro.Events` 的实例

```jsx
import Taro from '@tarojs/taro'

Taro.eventCenter.on
Taro.eventCenter.trigger
Taro.eventCenter.off
```
</file>

<file path="docs/apis/about/tarocomponent.md">
---
title: Taro.Component
---

`Taro.Component` 是一个抽象基础类，因此直接引用 `Taro.Component` 几乎没意义。相反，你通常会继承自它，并至少定义一个 `render()` 方法。

通常你定义一个 `Taro` 组件相当于一个纯 `JavaScript` 类：

```jsx
class Welcome extends Component {
  render () {
    return <h1>Hello, {this.props.name}</h1>
  }
}
```

> 这里 Taro 和 React 不一样的地方在于没有暴露出一个 `createClass` 的方法，你只能用 ES6 的 class 类来创建 Taro 组件。

## 组件生命周期

每一个组件都有几个你可以重写以让代码在处理环节的特定时期运行的“生命周期方法”。方法中带有前缀 `will` 的在特定环节之前被调用，而带有前缀 `did` 的方法则会在特定环节之后被调用。

#### 装载(Mounting)

这些方法会在组件实例被创建和插入 DOM 中时被调用：

* `constructor()`
* `componentWillMount()`
* `render()`
* `componentDidMount()`

#### 更新(Updating)

属性或状态的改变会触发一次更新。当一个组件在被重新渲染时，这些方法将会被调用：

* `componentWillReceiveProps()`
* `shouldComponentUpdate()`
* `componentWillUpdate()`
* `render()`
* `componentDidUpdate()`

#### 卸载(Unmounting)

当一个组件被从 DOM 中移除时，该方法被调用：

* `componentWillUnmount()`

#### 其他 API

每一个组件还提供了其他的 API：

* `setState()`
* `forceUpdate()`

#### 类属性

* `defaultProps`

#### 实例属性

* `props`
* `state`
* `config`（小程序专属）

## 参考

### render()

`render()` 方法是必须的。

当被调用时，`render` 方法必须返回一个 Taro 组件（可以是内置组件也可以是自定义组件）或一个 [falsy](https://developer.mozilla.org/zh-CN/docs/Glossary/Falsy) 的值。

`render()` 函数应该纯净，意味着其不应该改变组件的状态，其每次调用都应返回相同的结果，同时不直接和浏览器/小程序交互。若需要和浏览器/小程序交互，将任务放在`componentDidMount()` 阶段或其他的生命周期方法。保持 `render()` 方法纯净使得组件更容易思考。

> 在 React/Nerv 中，`render()` 可以返回多种数据结构，但 Taro 暂时只支持两种。因为 Taro 必须把 JSX  编译成微信小程序模板。当 return 的值为 `falsy` 时，实际上会编译成小程序的  `wx:if` 标签。

### constructor()

```jsx
constructor(props)
```

Taro 组件的构造函数将会在装配之前被调用。当为一个 `Taro.Component` 子类定义构造函数时，你应该在任何其他的表达式之前调用 `super(props)`。否则，this.props 在构造函数中将是未定义，并可能引发异常。

构造函数是初始化状态的合适位置。若你不初始化状态且不绑定方法，那你也不需要为你的 Taro 组件定义一个构造函数。

> 在 Taro 中，即便你不写 constructor()，编译到微信小程序时也会自动给你加上，因为 Taro 运行时框架需要在 constructor() 中多做一些事情。

可以基于属性来初始化状态。这样有效地“分离（forks）”属性并根据初始属性设置状态。

### `static getDerivedStateFromProps()`

> 自 v1.3.0 起可用

```jsx
static getDerivedStateFromProps(props, state)
```

`getDerivedStateFromProps` 会在调用 render 方法之前调用，并且在初始挂载及后续更新时都会被调用。它应返回一个对象来更新 state，如果返回 null 则不更新任何内容。

此方法无权访问组件实例（this）。如果你需要，可以通过提取组件 props 的纯函数及 class 之外的状态，在 `getDerivedStateFromProps()` 和其他 class 方法之间重用代码。

和 `componentWillReceiveProps` 不同，`getDerivedStateFromProps` 会在每次 `render` 前触发此方法，而 `componentWillReceiveProps` 会在父组件重新渲染时调用。

```jsx
export default class ButtonSelectable extends Component {
  static propTypes = {
    selected: PropTypes.bool,
    onClick: PropTypes.func
  };

  constructor(props) {
    super(props);

    this.state = {
      isSelected: props.selected
    };
  }

  static getDerivedStateFromProps(props, state) {
    if (props.selected !== state.isSelected) {
      return {
        isSelected: props.selected
      };
    }

    return null;
  }

  handleClick = event => {
    this.setState({
      isSelected: !this.state.isSelected
    });
  };

  render() {
    return (
      <Button
        className={`B-selectable ${
          this.state.isSelected ? "button-selectable-selected" : ""
        }`}
        onClick={this.handleClick}
      >
        {this.state.isSelected ? "Selected!" : "Not selected..."}
      </Button>
    );
  }
}

```

> 请注意：
> getDerivedStateFromProps() 如果存在，`componentWillReceiveProps`、`componentWillMount` 和 `componentWillUpdate` 将不会调用。
> 当你需要在以上老生命周期 setState 时，我们更推荐你使用 getDerivedStateFromProps 方法，因为它能减少一次更新开销。

### getSnapshotBeforeUpdate()

> 自 v1.3.0 起可用

```jsx
getSnapshotBeforeUpdate(prevProps, prevState)
```

`getSnapshotBeforeUpdate()` 在最近一次渲染输出（提交到 DOM 节点）之前调用。它使得组件能在发生更改之前从 DOM 中捕获一些信息（例如，滚动位置）。此生命周期的任何返回值将作为参数传递给 `componentDidUpdate()`。

应返回 snapshot 的值（或 null）。

> 请注意：
> getSnapshotBeforeUpdate() 如果存在，`componentWillReceiveProps`、`componentWillMount` 和 `componentWillUpdate` 将不会调用。
> 当你需要在以上老生命周期 setState 时，我们更推荐你使用 `getSnapshotBeforeUpdate` 方法，因为它能减少一次更新开销。


### componentWillMount()

```jsx
componentWillMount()
```

`componentWillMount()` 在组件在装载发生前被立刻调用。

避免在该方法中引入任何的副作用或订阅。对于这些使用场景，我们推荐使用 constructor() 来替代。

这是唯一的会在服务端渲染调起的生命周期钩子函数。

> componentWillMount() 在小程序里对应的生命周期是 `onLoad`

### componentDidMount()

```jsx
componentDidMount()
```

componentDidMount() 在组件被装载后立即调用。初始化使得 DOM 节点应该进行到这里。若你需要从远端加载数据，这是一个适合实现网络请求的地方。在该方法里 `setState()` 将会触发重新渲染。

### componentWillReceiveProps()

```jsx
componentWillReceiveProps(nextProps)
```

`componentWillReceiveProps()` 在已经装载的组件接收到新属性前调用。若你需要更新状态响应属性改变，你可能需对比 `this.props` 和 `nextProps` 并在该方法中使用 `this.setState()` 处理状态改变。

注意即使属性未有任何改变，Taro 可能也会调用该方法，因此若你想要处理改变，请确保比较当前和之后的值。

在装载期间，Taro 并不会调用带有初始属性的 `componentWillReceiveProps`方法。调用 `this.setState` 通常不会触发 `componentWillReceiveProps`。

### shouldComponentUpdate()

```jsx
shouldComponentUpdate(nextProps, nextState)
```

使用 `shouldComponentUpdate()` 让 Taro 知道组件的输出是否不受 state 或 props 当前变化的影响。 默认行为是在每次 state 更改时重新渲染，并且在绝大多数情况下，你应该依赖于默认行为。

当接收到新的 props 或 state 时，`shouldComponentUpdate()` 在渲染之前被调用。 默认返回 true ，对于初始(第一次)渲染 或 使用 `forceUpdate()` 时，不调用此方法。

返回 `false` 不会阻止子组件在 state 更改时重新渲染。

### componentWillUpdate()

```jsx
componentWillUpdate(nextProps, nextState)
```

当接收到新的 props 或 state 时，`componentWillUpdate()` 在渲染之前立即被调用。在更新发生之前，使用这个方法可以作为执行准备更新的一个好机会。这个方法在第一次渲染时不会被调用。

注意，这里不能调用 `this.setState()` 。 如果你需要更新 state 以响应 props 更改，请改用 `componentWillReceiveProps()`。

如果你需要更新 state 来响应 props 的改变，可以使用 `componentWillReceiveProps()` 代替。

### componentDidUpdate()

```jsx
componentDidUpdate(prevProps, prevState)
```

`componentDidUpdate()`  在更新发生后立即被调用。 这个方法在第一次渲染时不会被调用。

### componentWillUnmount()

```jsx
componentWillUnmount()
```

`componentWillUnmount()` 在一个组件被 卸载(unmounted) 和 销毁(destroyed) 之前立即被调用。 在此方法中执行任何必要的清理，例如使计时器无效，取消网络请求，清除一些可能会造成内存泄露的事件等。

> 在小程序中，一个挂在到 `Page`  组件的组件并不会执行 `componentWillUnmount()` 方法，只有当他挂载的 Page 组件被销毁时，该组件才会执行 `componentWillUnmount()`  方法。

### setState()

## 类属性

### defaultProps

`defaultProps` 可以被定义为组件类的一个属性，用以为类设置默认的属性。这对于未定义（undefined）的属性来说有用，而对于设为空（null）的属性并没用。例如：

```jsx
class CustomButton extends React.Component {
  // ...
}

CustomButton.defaultProps = {
  color: 'blue'
}
```

若未设置 `props.color`，其将被设置默认为 'blue':

```jsx
render () {
  return <CustomButton /> // props.color will be set to blue
}
```

若 props.color 设为 null，则其值则为 null：

```jsx
render() {
  return <CustomButton color={null} />  // props.color will remain null
}
```

## 实例属性

### props

`this.props` 包含了组件该调用者定义的属性。查看 [组件 & Props](../../render-props.md) 关于属性的介绍。

### state

状态是该组件的特定数据，其可能改变多次。状态由用户定义，且其应为纯 JavaScript 对象。

若你不在 `render()` 方法中使用它，那它就不应该被放在 state 中。例如，你可直接将 timer IDs 放在实例上。

查看 [生命周期 & State](../../state.md) 了解更多关于状态的信息。

永远不要直接改变 `this.state`，因为调用 `setState()` 会替换你之前做的改变。将 `this.state` 当成不可变的。
</file>

<file path="docs/apis/ad/createInterstitialAd.md">
---
title: Taro.createInterstitialAd(option)
sidebar_label: createInterstitialAd
---

创建插屏广告组件。
请通过 getSystemInfoSync 返回对象的 SDKVersion 判断基础库版本号后再使用该 API。每次调用该方法创建插屏广告都会返回一个全新的实例（小程序端的插屏广告实例不允许跨页面使用）。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/wx.createInterstitialAd.html)

## 类型

```tsx
(option: Option) => InterstitialAd
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| adUnitId | `string` | 广告单元 id |
</file>

<file path="docs/apis/ad/createRewardedVideoAd.md">
---
title: Taro.createRewardedVideoAd(option)
sidebar_label: createRewardedVideoAd
---

创建激励视频广告组件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/wx.createRewardedVideoAd.html)

## 类型

```tsx
(option: Option) => RewardedVideoAd
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| adUnitId | `string` |  | 是 | 小程序广告位 ID<br />API 支持度: weapp, tt, swan |
| multiton | `boolean` | `false` | 否 | 是否启用多例模式<br />API 支持度: weapp |
| appSid | `string` |  | 否 | 小程序应用 ID<br />API 支持度: swan<br />swan: 必填 |
</file>

<file path="docs/apis/ad/InterstitialAd.md">
---
title: InterstitialAd
sidebar_label: InterstitialAd
---

插屏广告组件。插屏广告组件是一个原生组件，层级比普通组件高。插屏广告组件每次创建都会返回一个全新的实例（小程序端的插屏广告实例不允许跨页面使用），默认是隐藏的，需要调用 InterstitialAd.show() 将其显示。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/InterstitialAd.html)

## 方法

### destroy

销毁插屏广告实例。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/InterstitialAd.destroy.html)

```tsx
() => void
```

### offClose

取消监听插屏广告关闭事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/InterstitialAd.offClose.html)

```tsx
(callback: OnCloseCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnCloseCallback` |

### offError

取消监听插屏错误事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/InterstitialAd.offError.html)

```tsx
(callback: OnErrorCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnErrorCallback` |

### offLoad

取消监听插屏广告加载事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/InterstitialAd.offLoad.html)

```tsx
(callback: OnLoadCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnLoadCallback` |

### onClose

监听插屏广告关闭事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/InterstitialAd.onClose.html)

```tsx
(callback: OnCloseCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnCloseCallback` |

### onError

监听插屏错误事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/InterstitialAd.onError.html)

```tsx
(callback: OnErrorCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnErrorCallback` |

### onLoad

监听插屏广告加载事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/InterstitialAd.onLoad.html)

```tsx
(callback: OnLoadCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnLoadCallback` |

### load

加载插屏广告。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/InterstitialAd.load.html)

```tsx
() => Promise<any>
```

### show

显示插屏广告。

**错误码信息表**

如果插屏广告显示失败，InterstitialAd.show() 方法会返回一个rejected Promise，开发者可以获取到错误码及对应的错误信息。

| 代码 | 异常情况 | 理由 |
| ------ | -------------- | -------------------------- |
| 2001  | 触发频率限制  | 小程序启动一定时间内不允许展示插屏广告 |
| 2002  | 触发频率限制  | 距离小程序插屏广告或者激励视频广告上次播放时间间隔不足，不允许展示插屏广告 |
| 2003  | 触发频率限制  | 当前正在播放激励视频广告或者插屏广告，不允许再次展示插屏广告 |
| 2004  | 广告渲染失败  | 该项错误不是开发者的异常情况，或因小程序页面切换导致广告渲染失败 |
| 2005  | 广告调用异常  | 插屏广告实例不允许跨页面调用 |

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/InterstitialAd.show.html)

```tsx
() => Promise<any>
```

## 参数

### OnCloseCallback

插屏广告关闭事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |

### OnErrorCallback

插屏错误事件的回调函数

```tsx
(result: OnErrorCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnErrorCallbackResult` |

### OnLoadCallback

插屏广告加载事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |

### OnErrorCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errCode | string or number or symbol | 错误码<br />[参考地址]( /docs/apis/General#aderrcode) |
| errMsg | `string` | 错误信息 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| InterstitialAd.destroy | ✔️ |  |  |  |  |
| InterstitialAd.offClose | ✔️ |  |  |  |  |
| InterstitialAd.offError | ✔️ |  |  |  |  |
| InterstitialAd.offLoad | ✔️ |  |  |  |  |
| InterstitialAd.onClose | ✔️ |  |  |  |  |
| InterstitialAd.onError | ✔️ |  |  |  |  |
| InterstitialAd.onLoad | ✔️ |  |  |  |  |
| InterstitialAd.load | ✔️ |  |  |  |  |
| InterstitialAd.show | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/ad/RewardedVideoAd.md">
---
title: RewardedVideoAd
sidebar_label: RewardedVideoAd
---

激励视频广告组件。激励视频广告组件是一个原生组件，层级比普通组件高。激励视频广告是一个单例（小游戏端是全局单例，小程序端是页面内单例，在小程序端的单例对象不允许跨页面使用），默认是隐藏的，需要调用 RewardedVideoAd.show() 将其显示。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/RewardedVideoAd.html)

## 方法

### load

加载激励视频广告。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/RewardedVideoAd.load.html)

```tsx
() => Promise<any>
```

### show

显示激励视频广告。激励视频广告将从屏幕下方推入。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/RewardedVideoAd.show.html)

```tsx
() => Promise<any>
```

### destroy

销毁激励视频广告实例。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/RewardedVideoAd.destroy.html)

```tsx
() => void
```

### offClose

取消监听用户点击 `关闭广告` 按钮的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/RewardedVideoAd.offClose.html)

```tsx
(callback: OnCloseCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnCloseCallback` |

### offError

取消监听激励视频错误事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/RewardedVideoAd.offError.html)

```tsx
(callback: OnErrorCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnErrorCallback` |

### offLoad

取消监听激励视频广告加载事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/RewardedVideoAd.offLoad.html)

```tsx
(callback: OnLoadCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnLoadCallback` |

### onClose

监听用户点击 `关闭广告` 按钮的事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/RewardedVideoAd.onClose.html)

```tsx
(callback: OnCloseCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnCloseCallback` |

### onError

监听激励视频错误事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/RewardedVideoAd.onError.html)

```tsx
(callback: OnErrorCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnErrorCallback` |

### onLoad

监听激励视频广告加载事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ad/RewardedVideoAd.onLoad.html)

```tsx
(callback: OnLoadCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnLoadCallback` |

## 参数

### OnErrorCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errCode | string or number or symbol | 错误码<br />[参考地址]( /docs/apis/General#aderrcode) |
| errMsg | `string` | 错误信息 |

### OnCloseCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| isEnded | `boolean` | 视频是否是在用户完整观看的情况下被关闭的 |

### OnCloseCallback

用户点击 `关闭广告` 按钮的事件的回调函数

```tsx
(result: OnCloseCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnCloseCallbackResult` |

### OnErrorCallback

激励视频错误事件的回调函数

```tsx
(result: OnErrorCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnErrorCallbackResult` |

### OnLoadCallback

激励视频广告加载事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| RewardedVideoAd.load | ✔️ |  |  |  |  |
| RewardedVideoAd.show | ✔️ |  |  |  |  |
| RewardedVideoAd.destroy | ✔️ |  |  |  |  |
| RewardedVideoAd.offClose | ✔️ |  |  |  |  |
| RewardedVideoAd.offError | ✔️ |  |  |  |  |
| RewardedVideoAd.offLoad | ✔️ |  |  |  |  |
| RewardedVideoAd.onClose | ✔️ |  |  |  |  |
| RewardedVideoAd.onError | ✔️ |  |  |  |  |
| RewardedVideoAd.onLoad | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/ai/face/faceDetect.md">
---
title: Taro.faceDetect(option)
sidebar_label: faceDetect
---

人脸识别，使用前需要通过 Taro.initFaceDetect 进行一次初始化，推荐使用相机接口返回的帧数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/face/wx.faceDetect.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| frameBuffer | `ArrayBuffer` |  | 是 | 图像像素点数据，每四项表示一个像素点的 RGBA |
| width | `number` |  | 是 | 图像宽度 |
| height | `number` |  | 是 | 图像高度 |
| enablePoint | `boolean` | `false` | 否 | 是否返回当前图像的人脸（106 个点） |
| enableConf | `boolean` | `false` | 否 | 是否返回当前图像的人脸的置信度（可表示器官遮挡情况） |
| enableAngle | `boolean` | `false` | 否 | 是否返回当前图像的人脸角度信息 |
| enableMultiFace | `boolean` | `false` | 否 | 是否返回多张人脸的信息 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackOption) => void` |  | 否 | 接口调用成功的回调函数 |

### SuccessCallbackOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| faceInfo | `face` | 否 | 多人模式（enableMultiFace）下的人脸信息，每个对象包含上述其它属性 |

### face

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| detectRect | `detectRect` | 脸部正方框数值，对象包含 height, weight, originX, originY 四个属性 |
| x | `number` | 脸部中心点横坐标，检测不到人脸则为 -1 |
| y | `number` | 脸部中心点纵坐标，检测不到人脸则为 -1 |
| pointArray | `point[]` | 人脸 106 个点位置数组，数组每个对象包含 x 和 y |
| confArray | `conf[]` | 人脸置信度，取值范围 [0, 1]，数值越大置信度越高（遮挡越少） |
| angleArray | `angle[]` | 人脸角度信息，取值范围 [-1, 1]，数值越接近 0 表示越正对摄像头 |

### detectRect

脸部正方框数值

| 参数 | 类型 |
| --- | --- |
| height | `number` |
| weight | `number` |
| originX | `number` |
| originY | `number` |

### point

| 参数 | 类型 |
| --- | --- |
| x | `number` |
| y | `number` |

### conf

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| global | `number` | 整体可信度 |
| leftEye | `number` | 左眼可信度 |
| rightEye | `number` | 右眼可信度 |
| mouth | `number` | 嘴巴可信度 |
| nose | `number` | 鼻子可信度 |

### angle

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| pitch | `number` | 仰俯角（点头） |
| yaw | `number` | 偏航角（摇头） |
| roll | `number` | 翻滚角（左右倾） |
</file>

<file path="docs/apis/ai/face/initFaceDetect.md">
---
title: Taro.initFaceDetect(option)
sidebar_label: initFaceDetect
---

初始化人脸识别

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/face/wx.initFaceDetect.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/ai/face/stopFaceDetect.md">
---
title: Taro.stopFaceDetect(option)
sidebar_label: stopFaceDetect
---

停止人脸识别

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/face/wx.stopFaceDetect.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/ai/inference/createInferenceSession.md">
---
title: Taro.createInferenceSession(option)
sidebar_label: createInferenceSession
---

创建 AI 推理 Session

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/inference/wx.createInferenceSession.html)

## 类型

```tsx
(option: Option) => InferenceSession
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| model | `string` | 是 | 模型文件路径，目前只执行后缀为.onnx格式(支持代码包路径，和本地文件系统路径） |
| precesionLevel | `PrecesionLevel` | 否 | 推理精度，有效值为 0 - 4。<br />一般来说，使用的precesionLevel等级越低，推理速度越快，但可能会损失精度。<br />推荐开发者在开发时，在效果满足需求时优先使用更低精度以提高推理速度，节约能耗。 |
| allowQuantize | `boolean` | 否 | 是否生成量化模型推理 |
| allowNPU | `boolean` | 否 | 是否使用NPU推理，仅对IOS有效 |
| typicalShape | `boolean` | 否 | 输入典型分辨率 |

### PrecesionLevel

| 参数 | 说明 |
| --- | --- |
| 0 | 使用fp16 存储浮点，fp16计算，Winograd 算法也采取fp16 计算，开启近似math计算 |
| 1 | 使用fp16 存储浮点，fp16计算，禁用 Winograd 算法，开启近似math计算 |
| 2 | 使用fp16 存储浮点，fp32计算，开启 Winograd，开启近似math计算 |
| 3 | 使用fp32 存储浮点，fp32计算，开启 Winograd，开启近似math计算 |
| 4 | 使用fp32 存储浮点，fp32计算，开启 Winograd，关闭近似math计算 |
</file>

<file path="docs/apis/ai/inference/getInferenceEnvInfo.md">
---
title: Taro.getInferenceEnvInfo(option)
sidebar_label: getInferenceEnvInfo
---

获取通用AI推理引擎版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/inference/wx.getInferenceEnvInfo.html)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| ver | `string` | AI推理引擎版本 |
</file>

<file path="docs/apis/ai/inference/InferenceSession.md">
---
title: InferenceSession
sidebar_label: InferenceSession
---

## 方法

### destroy

销毁 InferenceSession 实例

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/inference/InferenceSession.destroy.html)

```tsx
() => void
```

### offError

取消监听模型加载失败事件. 传入指定回调函数则只取消指定回调，不传则取消所有回调

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/inference/InferenceSession.offError.html)

```tsx
(callback?: OnErrorCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnErrorCallback` |

### offLoad

取消监听模型加载完成事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/inference/InferenceSession.offLoad.html)

```tsx
(callback?: OnLoadCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnLoadCallback` |

### onError

监听模型加载失败事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/inference/InferenceSession.onError.html)

```tsx
(callback: OnErrorCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnErrorCallback` |

### onLoad

监听模型加载完成事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/inference/InferenceSession.onLoad.html)

```tsx
(callback: OnLoadCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnLoadCallback` |

### run

运行推断
需要在 session.onLoad 回调后使用。接口参数为 Tensors 对象，返回 Promise。
一个 InferenceSession 被创建完成后可以重复多次调用 InferenceSession.run(), 直到调用 session.destroy() 进行销毁。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/inference/InferenceSession.destroy.html)

```tsx
(option: Tensors) => Promise<Tensors>
```

| 参数 | 类型 |
| --- | --- |
| option | `Tensors` |

## 参数

### Type

### Tensor

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| shape | `number[]` | Tensor shape （Tensor 形状，例如 [1, 3, 224, 224] 即表示一个4唯Tensor，每个维度的长度分别为1, 3, 224, 224） |
| data | `ArrayBuffer` | Tensor 值，一段 ArrayBuffer |
| type | `keyof Type` | ArrayBuffer 值的类型，合法值有 uint8, int8, uint32, int32, float32 |

### Tensors

| 参数 | 类型 |
| --- | --- |
| __index | `__index` |

### OnErrorCallback

模型加载失败回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |

### OnLoadCallback

模型加载完成回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| InferenceSession.destroy | ✔️ |  |  |  |  |
| InferenceSession.offError | ✔️ |  |  |  |  |
| InferenceSession.offLoad | ✔️ |  |  |  |  |
| InferenceSession.onError | ✔️ |  |  |  |  |
| InferenceSession.onLoad | ✔️ |  |  |  |  |
| InferenceSession.run | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/ai/visionkit/createVKSession.md">
---
title: Taro.createVKSession(version)
sidebar_label: createVKSession
---

创建 vision kit 会话对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/wx.createVKSession.html)

## 类型

```tsx
(version: keyof IVersion) => VKSession
```

## 参数

| 参数 | 类型 |
| --- | --- |
| version | `keyof IVersion` |

### IVersion

vision kit 版本

| 参数 | 说明 |
| --- | --- |
| v1 | 旧版本 |
| v2 | v2 版本，目前只有 iOS 基础库 2.22.0 以上支持 |

### ITrack

跟踪配置

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| plane | `IPlane` | 平面跟踪配置 |

### IPlane

平面跟踪配置

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| mode | `keyof IPlaneMode` | 平面跟踪配置模式 |

### IPlaneMode

平面跟踪配置模式合法值

| 参数 | 说明 |
| --- | --- |
| 1 | 检测横向平面 |
| 2 | 检测纵向平面，只有 v2 版本支持 |
| 3 | 检测横向和纵向平面，只有 v2 版本支持 |
</file>

<file path="docs/apis/ai/visionkit/isVKSupport.md">
---
title: Taro.isVKSupport(version)
sidebar_label: isVKSupport
---

判断支持版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/wx.isVKSupport.html)

## 类型

```tsx
(version: keyof IVersion) => boolean
```

## 参数

| 参数 | 类型 |
| --- | --- |
| version | `keyof IVersion` |

### IVersion

vision kit 版本

| 参数 | 说明 |
| --- | --- |
| v1 | 旧版本 |
| v2 | v2 版本，目前只有 iOS 基础库 2.22.0 以上支持 |
</file>

<file path="docs/apis/ai/visionkit/VKBodyAnchor.md">
---
title: VKBodyAnchor
sidebar_label: VKBodyAnchor
---

人体 anchor

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKBodyAnchor.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `number` | 唯一标识 |
| type | `5` | 类型 |
| detectId | `number` | 识别序号 |
| size | `ISize` | 相对视窗的尺寸，取值范围为 [0, 1]，0 为左/上边缘，1 为右/下边缘 |
| origin | `IOrigin` | 相对视窗的位置信息，取值范围为 [0, 1]，0 为左/上边缘，1 为右/下边缘 |
| confidence | `number[]` | 关键点的置信度 |
| points | `IPoint[]` | 关键点 |
| score | `number` | 总体置信值 |

## 参数

### IType

类型

| 参数 | 说明 |
| --- | --- |
| 5 | 人体 |

### ISize

相对视窗的尺寸

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| width | `number` | 宽度 |
| height | `number` | 高度 |

### IOrigin

相对视窗的位置信息

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 横坐标 |
| y | `number` | 纵坐标 |

### IPoint

关键点

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 横坐标 |
| y | `number` | 纵坐标 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| VKBodyAnchor | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/ai/visionkit/VKCamera.md">
---
title: VKCamera
sidebar_label: VKCamera
---

相机对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKCamera.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| viewMatrix | `Float32Array` | 视图矩阵 |
| intrinsics | `Float32Array` | 相机内参，只有 v2 版本支持 |

### getProjectionMatrix

获取投影矩阵

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKCamera.getProjectionMatrix.html)

```tsx
(near: number, far: number) => Float32Array
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| near | `number` | 近视点 |
| far | `number` | 远视点 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| VKCamera | ✔️ |  |  |  |  |
| VKCamera.getProjectionMatrix | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/ai/visionkit/VKDepthAnchor.md">
---
title: VKDepthAnchor
sidebar_label: VKDepthAnchor
---

depth anchor

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKDepthAnchor.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `number` | 唯一标识 |
| type | `8` | 类型 |
| size | `ISize` | 相对视窗的尺寸，取值范围为 [0, 1]，0 为左/上边缘，1 为右/下边缘 |
| depthArray | `number[]` | 包含深度信息的数组 |

## 参数

### IType

类型

| 参数 | 说明 |
| --- | --- |
| 8 | DEPTH |

### ISize

相对视窗的尺寸

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| width | `number` | 宽度 |
| height | `number` | 高度 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| VKDepthAnchor | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/ai/visionkit/VKFaceAnchor.md">
---
title: VKFaceAnchor
sidebar_label: VKFaceAnchor
---

人脸 anchor

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKFaceAnchor.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `number` | 唯一标识 |
| type | `3` | 类型 |
| detectId | `number` | 识别序号 |
| origin | `IOrigin` | 相对视窗的位置信息，取值范围为 [0, 1]，0 为左/上边缘，1 为右/下边缘 |
| size | `ISize` | 相对视窗的尺寸，取值范围为 [0, 1]，0 为左/上边缘，1 为右/下边缘 |
| points | `IPoint[]` | 人脸 106 个关键点的坐标 |
| angle | `number[]` | 人脸角度信息 |
| confidence | `number` | 关键点的置信度 |

## 参数

### IType

类型

| 参数 | 说明 |
| --- | --- |
| 3 | 人脸 |

### ISize

相对视窗的尺寸

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| width | `number` | 宽度 |
| height | `number` | 高度 |

### IOrigin

相对视窗的位置信息

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 横坐标 |
| y | `number` | 纵坐标 |

### IPoint

关键点

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 横坐标 |
| y | `number` | 纵坐标 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| VKFaceAnchor | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/ai/visionkit/VKFrame.md">
---
title: VKFrame
sidebar_label: VKFrame
---

vision kit 会话对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKFrame.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| timestamp | `number` | 生成时间 |
| camera | `VKCamera` | 相机对象 |

### getCameraTexture

获取当前帧纹理，目前只支持 YUV 纹理

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKFrame.getCameraTexture.html)

```tsx
(ctx: WebGLRenderingContext) => IGetCameraTextureResult
```

| 参数 | 类型 |
| --- | --- |
| ctx | `WebGLRenderingContext` |

### getCameraBuffer

获取当前帧 rgba buffer。iOS 端微信在 v8.0.20 开始支持，安卓端微信在 v8.0.30 开始支持。
按 aspect-fill 规则裁剪，此接口要求在创建 VKSession 对象时必须传入 gl 参数。
此接口仅建议拿来做帧分析使用，上屏请使用 getCameraTexture 来代替。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKFrame.getCameraBuffer.html)

```tsx
(widht: number, height: number) => ArrayBuffer
```

| 参数 | 类型 |
| --- | --- |
| widht | `number` |
| height | `number` |

### getDisplayTransform

获取纹理调整矩阵。默认获取到的纹理是未经裁剪调整的纹理，此矩阵可用于在着色器中根据帧对象尺寸对纹理进行裁剪

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKFrame.getDisplayTransform.html)

```tsx
() => Float32Array
```

## 参数

### IGetCameraTextureResult

帧纹理对象

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| yTexture | `WebGLTexture` | Y 分量纹理 |
| uvTexture | `WebGLTexture` | UV 分量纹理 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| VKFrame | ✔️ |  |  |  |  |
| VKFrame.getCameraTexture | ✔️ |  |  |  |  |
| VKFrame.getCameraBuffer | ✔️ |  |  |  |  |
| VKFrame.getDisplayTransform | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/ai/visionkit/VKHandAnchor.md">
---
title: VKHandAnchor
sidebar_label: VKHandAnchor
---

手势 anchor

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKHandAnchor.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `number` | 唯一标识 |
| type | `7` | 类型 |
| detectId | `number` | 识别序号 |
| size | `ISize` | 相对视窗的尺寸，取值范围为 [0, 1]，0 为左/上边缘，1 为右/下边缘 |
| origin | `IOrigin` | 相对视窗的位置信息，取值范围为 [0, 1]，0 为左/上边缘，1 为右/下边缘 |
| confidence | `number[]` | 关键点的置信度 |
| points | `IPoint[]` | 关键点 |
| score | `number` | 总体置信值 |
| gesture | keyof IGesture or -1 | 手势分类, 返回整数 -1 到 18, -1 表示无效手势 |

## 参数

### IType

类型

| 参数 | 说明 |
| --- | --- |
| 7 | 手势 |

### ISize

相对视窗的尺寸

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| width | `number` | 宽度 |
| height | `number` | 高度 |

### IOrigin

相对视窗的位置信息

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 横坐标 |
| y | `number` | 纵坐标 |

### IPoint

关键点

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 横坐标 |
| y | `number` | 纵坐标 |

### IGesture

手势分类

| 参数 | 说明 |
| --- | --- |
| 0 | 单手比心 |
| 1 | 布（数字5） |
| 2 | 剪刀（数字2） |
| 3 | 握拳 |
| 4 | 数字1 |
| 5 | 热爱 |
| 6 | 点赞 |
| 7 | 数字3 |
| 8 | 摇滚 |
| 9 | 数字6 |
| 10 | 数字8 |
| 11 | 双手抱拳（恭喜发财） |
| 12 | 数字4 |
| 13 | 比ok |
| 14 | 不喜欢（踩） |
| 15 | 双手比心 |
| 16 | 祈祷（双手合十） |
| 17 | 双手抱拳 |
| 18 | 无手势动作 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| VKHandAnchor | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/ai/visionkit/VKMarkerAnchor.md">
---
title: VKMarkerAnchor
sidebar_label: VKMarkerAnchor
---

marker anchor

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKMarkerAnchor.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `number` | 唯一标识 |
| type | `1` | 类型 |
| transform | `Float32Array` | 包含位置、旋转、放缩信息的矩阵，以列为主序 |
| markerId | `number` | marker id |
| path | `string` | 图片路径 |

## 参数

### IType

类型

| 参数 | 说明 |
| --- | --- |
| 1 | marker |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| VKMarkerAnchor | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/ai/visionkit/VKOCRAnchor.md">
---
title: VKOCRAnchor
sidebar_label: VKOCRAnchor
---

OCR anchor

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKOCRAnchor.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `number` | 唯一标识 |
| type | `6` | 类型 |
| text | `string` | 识别的文字结果 |

## 参数

### IType

类型

| 参数 | 说明 |
| --- | --- |
| 6 | OCR |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| VKOCRAnchor | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/ai/visionkit/VKOSDAnchor.md">
---
title: VKOSDAnchor
sidebar_label: VKOSDAnchor
---

OSD anchor

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKOSDAnchor.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `number` | 唯一标识 |
| type | `2` | 类型 |
| markerId | `number` | marker id |
| size | `ISize` | 相对视窗的尺寸，取值范围为 [0, 1]，0 为左/上边缘，1 为右/下边缘 |
| path | `string` | 图片路径 |
| origin | `IOrigin` | 相对视窗的位置信息，取值范围为 [0, 1]，0 为左/上边缘，1 为右/下边缘 |

## 参数

### IType

类型

| 参数 | 说明 |
| --- | --- |
| 2 | OSD |

### ISize

相对视窗的尺寸

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| width | `number` | 宽度 |
| height | `number` | 高度 |

### IOrigin

相对视窗的位置信息

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 横坐标 |
| y | `number` | 纵坐标 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| VKOSDAnchor | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/ai/visionkit/VKPlaneAnchor.md">
---
title: VKPlaneAnchor
sidebar_label: VKPlaneAnchor
---

平面 anchor，只有 v2 版本支持

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKPlaneAnchor.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `number` | 唯一标识 |
| type | `0` | 类型 |
| transform | `Float32Array` | 包含位置、旋转、放缩信息的矩阵，以列为主序 |
| size | `ISize` | 尺寸 |
| alignment | `number` | 方向 |

## 参数

### IType

类型

| 参数 | 说明 |
| --- | --- |
| 0 | 平面 |

### ISize

相对视窗的尺寸

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| width | `number` | 宽度 |
| height | `number` | 高度 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| VKPlaneAnchor | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/ai/visionkit/VKSession.md">
---
title: VKSession
sidebar_label: VKSession
---

vision kit 会话对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| state | `keyof IState` | 会话状态 |
| config | `IConfig` | 会话配置 |
| cameraSize | `ISize` | 相机尺寸 |

### addMarker

添加一个 marker，要求调 Taro.createVKSession 时传入的 track.marker 为 true

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.addMarker.html)

```tsx
(path: string) => number
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| path | `string` | 图片路径，目前只支持本地用户图片 |

### addOSDMarker

添加一个 OSD marker（one-shot detection marker），要求调 Taro.createVKSession 时传入的 track.OSD 为 true

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.addOSDMarker.html)

```tsx
(path: string) => number
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| path | `string` | 图片路径，目前只支持本地用户图片 |

### cancelAnimationFrame

取消由 requestAnimationFrame 添加到计划中的动画帧请求

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.cancelAnimationFrame.html)

```tsx
(requestID: number) => void
```

| 参数 | 类型 |
| --- | --- |
| requestID | `number` |

### destroy

销毁会话

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.destroy.html)

```tsx
() => void
```

### detectBody

静态图像人体关键点检测。当 Taro.createVKSession 参数传入 {track: {body: {mode: 2} } } 时可用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.detectBody.html)

```tsx
(option: IDetectBodyOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `IDetectBodyOption` |

### detectDepth

深度识别。当 Taro.createVKSession 参数传入 {track: {depth: {mode: 2} } } 时可用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.detectDepth.html)

```tsx
(option: IDetectDepthOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `IDetectDepthOption` |

### detectFace

静态图像人脸关键点检测。当 Taro.createVKSession 参数传入 {track: {face: {mode: 2} } } 时可用。安卓微信8.0.25开始支持，iOS微信8.0.24开始支持。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.detectFace.html)

```tsx
(option: IDetectFaceOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `IDetectFaceOption` |

### detectHand

静态图像手势关键点检测。当 Taro.createVKSession 参数传入 {track: {hand: {mode: 2} } } 时可用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.detectHand.html)

```tsx
(option: IDetectHandOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `IDetectHandOption` |

### getAllMarker

获取所有 marker，要求调 Taro.createVKSession 时传入的 track.marker 为 true

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.getAllMarker.html)

```tsx
() => IMarker[]
```

### getAllOSDMarker

获取所有 OSD marker，要求调 Taro.createVKSession 时传入的 track.OSD 为 true

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.getAllOSDMarker.html)

```tsx
() => IOSDMarker[]
```

### getVKFrame

获取帧对象，每调用一次都会触发一次帧分析过程

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.getVKFrame.html)

```tsx
(width: number, height: number) => VKFrame
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| width | `number` | 宽度 |
| height | `number` | 高度 |

### hitTest

触摸检测，v1 版本只支持单平面（即 hitTest 生成一次平面后，后续 hitTest 均不会再生成平面，而是以之前生成的平面为基础进行检测）。

如果需要重新识别其他平面，可以在调用此方法时将 reset 参数置为 true。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.hitTest.html)

```tsx
(x: number, y: number, reset?: boolean) => IHitTestResult[]
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 相对视窗的横坐标，取值范围为 [0, 1]，0 为左边缘，1 为右边缘 |
| y | `number` | 相对视窗的纵坐标，取值范围为 [0, 1]，0 为上边缘，1 为下边缘 |
| reset | `boolean` | 是否需要重新识别其他平面，v2 版本不再需要此参数 |

### off

取消监听会话事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.off.html)

```tsx
(eventName: string, fn: TaroGeneral.EventCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| eventName | `string` | 事件名称 |
| fn | `TaroGeneral.EventCallback` | 事件监听函数 |

### on

监听会话事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.on.html)

```tsx
(eventName: string, fn: TaroGeneral.EventCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| eventName | `string` | 事件名称 |
| fn | `TaroGeneral.EventCallback` | 事件监听函数 |

### removeMarker

删除一个 marker，要求调 Taro.createVKSession 时传入的 track.marker 为 true

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.removeMarker.html)

```tsx
(markerId: number) => number
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| markerId | `number` | marker id |

### removeOSDMarker

删除一个 OSD marker，要求调 Taro.createVKSession 时传入的 track.OSD 为 true

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.removeOSDMarker.html)

```tsx
(markerId: number) => number
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| markerId | `number` | marker id |

### requestAnimationFrame

在下次进行重绘时执行。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.requestAnimationFrame.html)

```tsx
(callback: TaroGeneral.TFunc) => number
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `TaroGeneral.TFunc` | 执行函数 |

### runOCR

静态图像 OCR 检测。当 Taro.createVKSession 参数传入 {track: {OCR: {mode: 2} } } 时可用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.runOCR.html)

```tsx
(option: IRunOCROption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `IRunOCROption` |

### start

开启会话。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.start.html)

```tsx
(callback: (status: keyof IStartStatus) => void) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(status: keyof IStartStatus) => void` | 开启会话回调 |

### stop

停止会话。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.stop.html)

```tsx
() => void
```

### update3DMode

开启 3D 模式

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.update3DMode.html)

```tsx
(open3d: boolean) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| open3d | `boolean` | 是否开启 |

### updateOSDThreshold

更新 OSD 识别精确度，要求调 Taro.createVKSession 时传入的 track.OSD 为 true

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ai/visionkit/VKSession.updateOSDThreshold.html)

```tsx
(threshold: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| threshold | `number` | 阈值 |

## 参数

### IState

state 的合法值

| 参数 | 说明 |
| --- | --- |
| 0 | 不可用 |
| 1 | 运行中 |
| 2 | 暂停中 |
| 3 | 初始化中 |

### IConfig

会话配置

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| version | `keyof IVersion` | 不可用 |
| track | `ITrack` | 运行中 |
| marker | `boolean` | marker 跟踪配置，基础库(3.0.0)开始允许同时支持v2的水平面检测能力 |
| OSD | `boolean` | OSD 跟踪配置 |
| depth | `IDepth` | 深度识别配置 |
| face | `IFace` | 人脸检测配置。安卓微信8.0.25开始支持，iOS微信8.0.24开始支持。 |
| OCR | `IOCR` | OCR 检测配置。 |
| body | `IBody` | 人体检测配置。 |
| hand | `IHand` | 手势检测配置。 |
| threeDof | `boolean` | 提供基础AR功能，输出相机旋转的3个自由度的位姿，利用手机陀螺仪传感器，实现快速稳定的AR定位能力，适用于简单AR场景。 |
| gl | `WebGLRenderingContext` | 绑定的 WebGLRenderingContext 对象 |

### IVersion

vision kit 版本

| 参数 | 说明 |
| --- | --- |
| v1 | 旧版本 |
| v2 | v2 版本，目前只有 iOS 基础库 2.22.0 以上支持 |

### ITrack

跟踪配置

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| plane | `IPlane` | 平面跟踪配置 |

### IPlane

平面跟踪配置

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| mode | `keyof IPlaneMode` | 平面跟踪配置模式 |

### IPlaneMode

平面跟踪配置模式合法值

| 参数 | 说明 |
| --- | --- |
| 1 | 检测横向平面 |
| 2 | 检测纵向平面，只有 v2 版本支持 |
| 3 | 检测横向和纵向平面，只有 v2 版本支持 |

### IDepth

深度识别配置

| 参数 | 类型 |
| --- | --- |
| mode | `keyof IDepthMode` |

### IDepthMode

深度识别模式

| 参数 | 说明 |
| --- | --- |
| 1 | 通过摄像头实时检测 |
| 2 | 静态图片检测 |

### IFace

人脸检测模式

| 参数 | 类型 |
| --- | --- |
| mode | `keyof IFaceMode` |

### IFaceMode

人脸检测模式

| 参数 | 说明 |
| --- | --- |
| 1 | 通过摄像头实时检测 |
| 2 | 静态图片检测 |

### IOCR

OCR 检测配置

| 参数 | 类型 |
| --- | --- |
| mode | `keyof IOCRMode` |

### IOCRMode

OCR 检测模式

| 参数 | 说明 |
| --- | --- |
| 1 | 通过摄像头实时检测 |
| 2 | 静态图片检测 |

### IBody

人体检测模式

| 参数 | 类型 |
| --- | --- |
| mode | `keyof IBodyMode` |

### IBodyMode

人体检测模式

| 参数 | 说明 |
| --- | --- |
| 1 | 通过摄像头实时检测 |
| 2 | 静态图片检测 |

### IHand

手势检测配置

| 参数 | 类型 |
| --- | --- |
| mode | `keyof IHandMode` |

### IHandMode

手势检测模式

| 参数 | 说明 |
| --- | --- |
| 1 | 通过摄像头实时检测 |
| 2 | 静态图片检测 |

### ISize

相机尺寸

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| width | `number` | 宽度 |
| height | `number` | 高度 |

### IDetectBodyOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| frameBuffer | `ArrayBuffer` | 是 | 人脸图像像素点数据，每四项表示一个像素点的 RGBA |
| width | `number` | 是 | 图像宽度 |
| height | `number` | 是 | 图像高度 |
| scoreThreshold | `number` | 否 | 评分阈值。正常情况传入 0.8 即可。默认值 0.8 |
| sourceType | `keyof ISourceType` | 否 | 图像源类型。正常情况传入 1 即可。当输入的图片是来自一个连续视频的每一帧图像时，sourceType 传入 0 会得到更优的效果。默认值1 |

### ISourceType

图像源类型。

| 参数 | 说明 |
| --- | --- |
| 1 | 表示输入的图片是随机的图片 |
| 0 | 表示输入的图片是来自一个连续视频的每一帧图像 |

### IDetectDepthOption

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| frameBuffer | `ArrayBuffer` | 人需要识别深度的图像像素点数据，每四项表示一个像素点的 RGBA |
| width | `number` | 图像宽度 |
| height | `number` | 图像高度 |

### IDetectFaceOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| frameBuffer | `ArrayBuffer` | 是 | 人脸图像像素点数据，每四项表示一个像素点的 RGBA |
| width | `number` | 是 | 图像宽度 |
| height | `number` | 是 | 图像高度 |
| scoreThreshold | `number` | 否 | 评分阈值。正常情况传入 0.8 即可。默认值 0.8 |
| sourceType | `keyof ISourceType` | 否 | 图像源类型。正常情况传入 1 即可。当输入的图片是来自一个连续视频的每一帧图像时，sourceType 传入 0 会得到更优的效果。默认值1 |
| modelModel | `keyof IModelModel` | 否 | 算法模型类型。正常情况传入 1 即可。0、1、2 分别表示小、中、大模型，模型越大识别准确率越高，但资源占用也越高。建议根据用户设备性能进行选择。 |

### IModelModel

算法模型类型

| 参数 | 说明 |
| --- | --- |
| 0 | 小模型 |
| 1 | 中模型 |
| 2 | 大模型 |

### IDetectHandOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| frameBuffer | `ArrayBuffer` | 是 | 人脸图像像素点数据，每四项表示一个像素点的 RGBA |
| width | `number` | 是 | 图像宽度 |
| height | `number` | 是 | 图像高度 |
| scoreThreshold | `number` | 否 | 评分阈值。正常情况传入 0.8 即可。默认值0.8 |
| algoMode | `keyof IAlgoMode` | 否 | 算法检测模式 |

### IAlgoMode

算法检测模式

| 参数 | 说明 |
| --- | --- |
| 0 | 检测模式，输出框和点 |
| 1 | 手势模式，输出框和手势分类 |
| 2 | 结合0和1模式，输出框、点、手势分类 |

### IMarker

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| markerId | `number` | marker id |
| path | `string` | 图片路径 |

### IOSDMarker

OSD marker

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| markerId | `number` | marker id |
| path | `string` | 图片路径 |

### IRunOCROption

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| frameBuffer | `ArrayBuffer` | 待识别图像的像素点数据，每四项表示一个像素点的 RGBA |
| width | `number` | 图像宽度 |
| height | `number` | 图像高度 |

### IHitTestResult

hitTest 检测结果

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| transform | `Float32Array` | 包含位置、旋转、放缩信息的矩阵，以列为主序 |

### IStartStatus

start status 的合法值

| 参数 | 说明 |
| --- | --- |
| 0 | 成功 |
| 2000000 | 系统错误 |
| 2000001 | 参数错误 |
| 2000002 | 设备不支持 |
| 2000003 | 系统不支持 |
| 2003000 | 会话不可用 |
| 2003001 | 未开启系统相机权限 |
| 2003002 | 未开启小程序相机权限 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| VKSession | ✔️ |  |  |  |  |
| VKSession.addMarker | ✔️ |  |  |  |  |
| VKSession.addOSDMarker | ✔️ |  |  |  |  |
| VKSession.cancelAnimationFrame | ✔️ |  |  |  |  |
| VKSession.destroy | ✔️ |  |  |  |  |
| VKSession.detectBody | ✔️ |  |  |  |  |
| VKSession.detectDepth | ✔️ |  |  |  |  |
| VKSession.detectFace | ✔️ |  |  |  |  |
| VKSession.detectHand | ✔️ |  |  |  |  |
| VKSession.getAllMarker | ✔️ |  |  |  |  |
| VKSession.getAllOSDMarker | ✔️ |  |  |  |  |
| VKSession.getVKFrame | ✔️ |  |  |  |  |
| VKSession.hitTest | ✔️ |  |  |  |  |
| VKSession.off | ✔️ |  |  |  |  |
| VKSession.on | ✔️ |  |  |  |  |
| VKSession.removeMarker | ✔️ |  |  |  |  |
| VKSession.removeOSDMarker | ✔️ |  |  |  |  |
| VKSession.requestAnimationFrame | ✔️ |  |  |  |  |
| VKSession.runOCR | ✔️ |  |  |  |  |
| VKSession.start | ✔️ |  |  |  |  |
| VKSession.stop | ✔️ |  |  |  |  |
| VKSession.update3DMode | ✔️ |  |  |  |  |
| VKSession.updateOSDThreshold | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/alipay/getOpenUserInfo.md">
---
title: Taro.getOpenUserInfo(Option)
sidebar_label: getOpenUserInfo
---

此接口可获取支付宝会员的基础信息（头像图片地址、昵称、性别、国家码、省份、所在市区），接入方法请参考 获取会员基础信息介绍。如需获取支付宝会员标识（user_id），请调用 my.getAuthCode 和 alipay.system.oauth.token 接口。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://docs.alipay.com/mini/api/ch8chh)

## 类型

```tsx
(Option: Option) => Promise<SuccessCallbackResult>
```

## 参数

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| response | `string` | 返回一个 Object 类型的对象 res。使用 JSON.parse(res.response).response 解析 |
</file>

<file path="docs/apis/alipay/tradePay.md">
---
title: Taro.tradePay(Option)
sidebar_label: tradePay
---

此接口是用于发起支付的 API，此 API 暂仅支持企业支付宝小程序使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://opendocs.alipay.com/mini/api/openapi-pay)

## 类型

```tsx
(Option: Option) => Promise<SuccessCallbackResult>
```

## 参数

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tradeNO | `string` | 否 | 接入小程序支付时传入此参数。此参数为支付宝交易号，注意参数有大小写区分（调用 小程序支付 时必填） |
| orderStr | `string` | 否 | 完整的支付参数拼接成的字符串，从服务端获取（调用 支付宝预授权 时必填） |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### ResultCode

| 参数 | 说明 |
| --- | --- |
| 4 | 无权限调用（N22104） |
| 9000 | 订单处理成功 |
| 8000 | 正在处理中。支付结果未知（有可能已经支付成功） |
| 4000 | 订单处理失败 |
| 6001 | 用户中途取消 |
| 6002 | 网络连接出错 |
| 6004 | 处理结果未知（有可能已经成功） |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| response | `{ resultCode: ResultCode; }` | success 回调函数会携带一个 Object 类型的对象，其属性如下： |
</file>

<file path="docs/apis/base/crypto/getRandomValues.md">
---
title: Taro.getRandomValues(option)
sidebar_label: getRandomValues
---

获取密码学安全随机数

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/crypto/UserCryptoManager.getRandomValues.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

## 示例代码

```tsx
Taro.getRandomValues({
  length: 6 // 生成 6 个字节长度的随机数
}).then(res => {
  console.log(Taro.arrayBufferToBase64(res.randomValues)) // 转换为 base64 字符串后打印
})
```
</file>

<file path="docs/apis/base/crypto/getUserCryptoManager.md">
---
title: Taro.getUserCryptoManager()
sidebar_label: getUserCryptoManager
---

获取用户加密模块

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/crypto/wx.getUserCryptoManager.html)

## 类型

```tsx
() => UserCryptoManager
```
</file>

<file path="docs/apis/base/crypto/UserCryptoManager.md">
---
title: UserCryptoManager
sidebar_label: UserCryptoManager
---

用户加密模块

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/crypto/UserCryptoManager.html)

## 方法

### getLatestUserKey

获取最新的用户加密密钥

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/crypto/UserCryptoManager.getLatestUserKey.html)

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

#### 示例代码

```tsx
const userCryptoManager = Taro.getUserCryptoManager()
userCryptoManager.getLatestUserKey({
  success: res => {
    const { encryptKey, iv, version, expireTime } = res
    console.log(encryptKey, iv, version, expireTime)
  }
})
```

### getRandomValues

获取密码学安全随机数

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/crypto/UserCryptoManager.getRandomValues.html)

```tsx
(option: Option) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

#### 示例代码

```tsx
Taro.getUserCryptoManager().getRandomValues({
  length: 6 // 生成 6 个字节长度的随机数,
  success: res => {
    console.log(Taro.arrayBufferToBase64(res.randomValues)) // 转换为 base64 字符串后打印
  }
})
```

## 参数

### getLatestUserKey

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: SuccessCallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| encryptKey | `string` | 用户加密密钥 |
| iv | `string` | 密钥初始向量 |
| version | `number` | 密钥版本 |
| expireTime | `number` | 密钥过期时间 |

### getRandomValues

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| length | `number` | 是 | 整数，生成随机数的字节数，最大 1048576 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: SuccessCallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| randomValues | `ArrayBuffer` | 随机数内容，长度为传入的字节数 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| UserCryptoManager | ✔️ |  |  |  |  |
| UserCryptoManager.getLatestUserKey | ✔️ |  |  |  |  |
| UserCryptoManager.getRandomValues | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/base/debug/console.md">
---
title: console
sidebar_label: console
---

向调试面板中打印日志。console 是一个全局对象，可以直接访问。在微信客户端中，向 vConsole 中输出日志。

**注意**
- 由于 vConsole 功能有限，以及不同客户端对 console 方法的支持情况有差异，建议开发者在小程序中只使用本文档中提供的方法。
- 部分内容展示的限制请参见调试

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/console.html)

## 方法

### debug

向调试面板中打印 debug 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/console.debug.html)

```tsx
(...args: any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| args | `any[]` | 日志内容，可以有任意多个。 |

### error

向调试面板中打印 error 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/console.error.html)

```tsx
(...args: any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| args | `any[]` | 日志内容，可以有任意多个。 |

### group

在调试面板中创建一个新的分组

**注意**
仅在工具中有效，在 vConsole 中为空函数实现。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/console.group.html)

```tsx
(label?: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| label | `string` | 分组标记 |

### groupEnd

结束由 [console.group](#group) 创建的分组

**注意**
仅在工具中有效，在 vConsole 中为空函数实现。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/console.groupEnd.html)

```tsx
() => void
```

### info

向调试面板中打印 info 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/console.info.html)

```tsx
(...args: any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| args | `any[]` | 日志内容，可以有任意多个。 |

### log

向调试面板中打印 log 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/console.log.html)

```tsx
(...args: any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| args | `any[]` | 日志内容，可以有任意多个。 |

### warn

向调试面板中打印 warn 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/console.warn.html)

```tsx
(...args: any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| args | `any[]` | 日志内容，可以有任意多个。 |

## API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| console | ✔️ |  |  |  |  | ✔️ | ✔️ |
| console.debug | ✔️ |  |  |  |  | ✔️ | ✔️ |
| console.error | ✔️ |  |  |  |  | ✔️ | ✔️ |
| console.group | ✔️ |  |  |  |  | ✔️ | ✔️ |
| console.groupEnd | ✔️ |  |  |  |  | ✔️ | ✔️ |
| console.info | ✔️ |  |  |  |  | ✔️ | ✔️ |
| console.log | ✔️ | ✔️ |  |  |  | ✔️ | ✔️ |
| console.warn | ✔️ |  |  |  |  | ✔️ | ✔️ |
</file>

<file path="docs/apis/base/debug/getLogManager.md">
---
title: Taro.getLogManager(res)
sidebar_label: getLogManager
---

获取日志管理器对象。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/wx.getLogManager.html)

## 类型

```tsx
(res?: Option) => LogManager
```

## 参数

| 参数 | 类型 |
| --- | --- |
| res | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 |
| --- | --- | :---: | :---: |
| level | `keyof Level` | `0` | 否 |

### Level

| 参数 | 说明 |
| --- | --- |
| 0 | 表示会把 App、Page 的生命周期函数和 wx 命名空间下的函数调用写入日志 |
| 1 | 表示不会把 App、Page 的生命周期函数和 wx 命名空间下的函数调用写入日志 |

## 示例代码

```tsx
const logger = Taro.getLogManager({level: 1})

logger.log({str: 'hello world'}, 'basic log', 100, [1, 2, 3])
logger.info({str: 'hello world'}, 'info log', 100, [1, 2, 3])
logger.debug({str: 'hello world'}, 'debug log', 100, [1, 2, 3])
logger.warn({str: 'hello world'}, 'warn log', 100, [1, 2, 3])
```
</file>

<file path="docs/apis/base/debug/getRealtimeLogManager.md">
---
title: Taro.getRealtimeLogManager()
sidebar_label: getRealtimeLogManager
---

获取实时日志管理器对象。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
() => RealtimeLogManager
```

## 示例代码

```tsx
const logger = Taro.getRealtimeLogManager()
logger.info({str: 'hello world'}, 'info log', 100, [1, 2, 3])
logger.error({str: 'hello world'}, 'error log', 100, [1, 2, 3])
logger.warn({str: 'hello world'}, 'warn log', 100, [1, 2, 3])
```
</file>

<file path="docs/apis/base/debug/LogManager.md">
---
title: LogManager
sidebar_label: LogManager
---

日志管理器实例，可以通过 Taro.getLogManager 获取。

使用说明
最多保存5M的日志内容，超过5M后，旧的日志内容会被删除。
对于小程序，用户可以通过使用 button 组件的 open-type="feedback" 来上传打印的日志。
对于小游戏，用户可以通过使用 Taro.createFeedbackButton 来创建上传打印的日志的按钮。
开发者可以通过小程序管理后台左侧菜单“反馈管理”页面查看相关打印日志。

基础库默认会把 App、Page 的生命周期函数和 wx 命名空间下的函数调用写入日志。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/LogManager.html)

## 方法

### debug

写 debug 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/LogManager.debug.html)

```tsx
(...args: any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| args | `any[]` | 日志内容，可以有任意多个。每次调用的参数的总大小不超过100Kb |

### info

写 info 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/LogManager.info.html)

```tsx
(...args: any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| args | `any[]` | 日志内容，可以有任意多个。每次调用的参数的总大小不超过100Kb |

### log

写 log 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/LogManager.log.html)

```tsx
(...args: any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| args | `any[]` | 日志内容，可以有任意多个。每次调用的参数的总大小不超过100Kb |

### warn

写 warn 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/LogManager.warn.html)

```tsx
(...args: any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| args | `any[]` | 日志内容，可以有任意多个。每次调用的参数的总大小不超过100Kb |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| LogManager | ✔️ |  |  |  | ✔️ |
| LogManager.debug | ✔️ |  |  |  | ✔️ |
| LogManager.info | ✔️ |  |  |  | ✔️ |
| LogManager.log | ✔️ |  |  |  | ✔️ |
| LogManager.warn | ✔️ |  |  |  | ✔️ |
</file>

<file path="docs/apis/base/debug/RealtimeLogManager.md">
---
title: RealtimeLogManager
sidebar_label: RealtimeLogManager
---

实时日志管理器实例，可以通过 Taro.getRealtimeLogManager 获取。

使用说明
为帮助小程序开发者快捷地排查小程序漏洞、定位问题，我们推出了实时日志功能。从基础库2.7.1开始，开发者可通过提供的接口打印日志，日志汇聚并实时上报到小程序后台。
开发者可从小程序管理后台“开发->运维中心->实时日志”进入日志查询页面，查看开发者打印的日志信息。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/RealtimeLogManager.html)

## 方法

### addFilterMsg

添加过滤关键字

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/RealtimeLogManager.addFilterMsg.html)

```tsx
(msg: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| msg | `string` | 是 setFilterMsg 的添加接口。用于设置多个过滤关键字。 |

### error

写 error 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/RealtimeLogManager.error.html)

```tsx
(...args: any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| args | `any[]` | 日志内容，可以有任意多个。每次调用的参数的总大小不超过5Kb |

### in

设置实时日志page参数所在的页面

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/RealtimeLogManager.in.html)

```tsx
(pageInstance: any) => void
```

| 参数 | 说明 |
| --- | --- |
| pageInstance | page 实例 |

### info

写 info 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/RealtimeLogManager.info.html)

```tsx
(...args: any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| args | `any[]` | 日志内容，可以有任意多个。每次调用的参数的总大小不超过5Kb |

### setFilterMsg

设置过滤关键字

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/RealtimeLogManager.setFilterMsg.html)

```tsx
(msg: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| msg | `string` | 过滤关键字，最多不超过1Kb，可以在小程序管理后台根据设置的内容搜索得到对应的日志。 |

### tag

获取给定标签的日志管理器实例，目前只支持在插件使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/RealtimeLogManager.tag.html)

```tsx
(tagName: string) => RealtimeTagLogManager
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tagName | `string` | 标签名 |

### warn

写 warn 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/RealtimeLogManager.warn.html)

```tsx
(...args: any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| args | `any[]` | 日志内容，可以有任意多个。每次调用的参数的总大小不超过5Kb |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| RealtimeLogManager | ✔️ |  |  |  |
| RealtimeLogManager.addFilterMsg | ✔️ |  |  |  |
| RealtimeLogManager.error | ✔️ |  |  |  |
| RealtimeLogManager.in | ✔️ |  |  |  |
| RealtimeLogManager.info | ✔️ |  |  |  |
| RealtimeLogManager.setFilterMsg | ✔️ |  |  |  |
| RealtimeLogManager.tag | ✔️ |  |  |  |
| RealtimeLogManager.warn | ✔️ |  |  |  |
</file>

<file path="docs/apis/base/debug/RealtimeTagLogManager.md">
---
title: RealtimeTagLogManager
sidebar_label: RealtimeTagLogManager
---

给定标签的实时日志管理器实例，可以通过 给定标签的实时日志管理器实例，可以通过 [RealtimeLogManager.tag](./RealtimeLogManager#tag) 接口获取，目前只支持在插件使用。 接口获取，目前只支持在插件使用。

**使用说明**
RealtimeTagLogManager 功能和 [RealtimeLogManager](./RealtimeLogManager) 相似，但是为了让输出的实时日志更易于分析，其具有更严格的格式要求。
RealtimeTagLogManager 使用时需要传入标签，调用该实例所输出的日志均会被汇集到对应标签下，同时该实例的日志只支持 key-value 格式进行输出。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/RealtimeTagLogManager.html)

## 方法

### addFilterMsg

添加过滤关键字

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/RealtimeTagLogManager.addFilterMsg.html)

```tsx
(msg: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| msg | `string` | 是 setFilterMsg 的添加接口。用于设置多个过滤关键字。 |

### error

写 error 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/RealtimeTagLogManager.error.html)

```tsx
(key: string, value: string | number | Object | any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| key | `string` | 日志的 key |
| value | string or number or Object or any[] | 日志的 key |

### info

写 info 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/RealtimeTagLogManager.info.html)

```tsx
(key: string, value: string | number | Object | any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| key | `string` | 日志的 key |
| value | string or number or Object or any[] | 日志的 key |

### setFilterMsg

设置过滤关键字

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/RealtimeTagLogManager.setFilterMsg.html)

```tsx
(msg: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| msg | `string` | 过滤关键字，最多不超过1Kb，可以在小程序管理后台根据设置的内容搜索得到对应的日志。 |

### warn

写 warn 日志

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/RealtimeTagLogManager.warn.html)

```tsx
(key: string, value: string | number | Object | any[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| key | `string` | 日志的 key |
| value | string or number or Object or any[] | 日志的 key |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| RealtimeTagLogManager | ✔️ |  |  |  |
| RealtimeTagLogManager.addFilterMsg | ✔️ |  |  |  |
| RealtimeTagLogManager.error | ✔️ |  |  |  |
| RealtimeTagLogManager.info | ✔️ |  |  |  |
| RealtimeTagLogManager.setFilterMsg | ✔️ |  |  |  |
| RealtimeTagLogManager.warn | ✔️ |  |  |  |
</file>

<file path="docs/apis/base/debug/setEnableDebug.md">
---
title: Taro.setEnableDebug(res)
sidebar_label: setEnableDebug
---

设置是否打开调试开关，此开关对正式版也能生效。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/debug/wx.setEnableDebug.html)

## 类型

```tsx
(res: Option) => Promise<Promised>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| res | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| enableDebug | `boolean` | 是 | 是否打开调试 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### Promised

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
// 打开调试
Taro.setEnableDebug({
    enableDebug: true
})
// 关闭调试
Taro.setEnableDebug({
    enableDebug: false
})
```
</file>

<file path="docs/apis/base/env/env.md">
---
title: env
sidebar_label: env
---

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/env/envObj.html)

## 类型

```tsx
{ [key: string]: string; FRAMEWORK: "react" | "preact" | "solid" | "vue3"; TARO_ENV: "weapp" | "h5" | "rn" | "swan" | "alipay" | "tt" | "qq" | "jd" | "quickapp"; USER_DATA_PATH?: string; }
```
</file>

<file path="docs/apis/base/performance/EntryList.md">
---
title: EntryList
sidebar_label: EntryList
---

EntryList 对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/EntryList.html)

## 方法

### getEntries

该方法返回当前列表中的所有性能数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/EntryList.getEntries.html)

```tsx
() => PerformanceEntry[]
```

### getEntriesByName

获取当前列表中所有名称为 [name] 且类型为 [entryType] 的性能数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/EntryList.getEntriesByName.html)

```tsx
(name: string, entryType: string) => PerformanceEntry[]
```

| 参数 | 类型 |
| --- | --- |
| name | `string` |
| entryType | `string` |

### getEntriesByType

获取当前列表中所有类型为 [entryType] 的性能数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/EntryList.getEntriesByType.html)

```tsx
(entryType: string) => PerformanceEntry[]
```

| 参数 | 类型 |
| --- | --- |
| entryType | `string` |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| EntryList | ✔️ |  |  |  |  |
| EntryList.getEntries | ✔️ |  |  |  |  |
| EntryList.getEntriesByName | ✔️ |  |  |  |  |
| EntryList.getEntriesByType | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/base/performance/getPerformance.md">
---
title: Taro.getPerformance()
sidebar_label: getPerformance
---

小程序测速上报。使用前，需要在小程序管理后台配置。 详情参见[小程序测速](https://developers.weixin.qq.com/miniprogram/dev/framework/performanceReport/index.html)指南。

**注意**
- 目前，当开启代码 [按需注入](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/lazyload.html) `时，evaluateScript` 将仅包含公有部分代码，页面和组件的代码注入的时间会包含在 `firstRender` 中（因为页面和组件的代码注入过程成为了首次渲染过程的一部分）。因此开启按需注入后，脚本耗时降低，渲染时间提高属于正常现象，优化效果可以关注整体启动耗时（`appLaunch`）来评估。
- `firstPaint` 和 `firstContentfulPaint` 指标在开启 `vconsole` 的情况下，由于绘制 `vconsoel` 的面板，会导致数据提前。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/wx.getPerformance.html)

## 类型

```tsx
() => Performance
```

## 示例代码

```tsx
const performance = Taro.getPerformance()
const observer = performance.createObserver((entryList) => {
  console.log(entryList.getEntries())
})
observer.observe({ entryTypes: ['render', 'script', 'navigation'] })
```
</file>

<file path="docs/apis/base/performance/Performance.md">
---
title: Performance
sidebar_label: Performance
---

Performance 对象，用于获取性能数据及创建性能监听器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/Performance.html)

## 方法

### createObserver

创建全局性能事件监听器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/Performance.createObserver.html)

```tsx
(callback: TaroGeneral.TFunc) => PerformanceObserver
```

| 参数 | 类型 |
| --- | --- |
| callback | `TaroGeneral.TFunc` |

### getEntries

该方法返回当前缓冲区中的所有性能数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/Performance.getEntries.html)

```tsx
() => PerformanceEntry[]
```

### getEntriesByName

获取当前缓冲区中所有名称为 [name] 且类型为 [entryType] 的性能数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/Performance.getEntriesByName.html)

```tsx
(name: string, entryType: string) => PerformanceEntry[]
```

| 参数 | 类型 |
| --- | --- |
| name | `string` |
| entryType | `string` |

### getEntriesByType

获取当前缓冲区中所有类型为 [entryType] 的性能数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/Performance.getEntriesByType.html)

```tsx
(entryType: string) => PerformanceEntry[]
```

| 参数 | 类型 |
| --- | --- |
| entryType | `string` |

### setBufferSize

设置缓冲区大小，默认缓冲 30 条性能数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/Performance.setBufferSize.html)

```tsx
(size: number) => void
```

| 参数 | 类型 |
| --- | --- |
| size | `number` |

## API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| Performance | ✔️ | ✔️ |  |  |  |  |
| Performance.createObserver | ✔️ |  |  |  |  |  |
| Performance.getEntries | ✔️ | ✔️ |  |  |  |  |
| Performance.getEntriesByName | ✔️ | ✔️ |  |  |  |  |
| Performance.getEntriesByType | ✔️ | ✔️ |  |  |  |  |
| Performance.setBufferSize | ✔️ |  |  |  |  |  |
</file>

<file path="docs/apis/base/performance/PerformanceEntry.md">
---
title: PerformanceEntry
sidebar_label: PerformanceEntry
---

单条性能数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/PerformanceEntry.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| entryType | `keyof EntryType` | 指标类型 |
| name | `keyof EntryName` | 指标名称 |
| startTime | `number` | 开始时间，不同指标的具体含义会有差异 |
| duration | `number` | 耗时 ms。仅对于表示阶段的指标有效。 |
| path | `string` | 页面路径。仅 render 和 navigation 类型指标有效。 |
| navigationStart | `number` | 路由真正响应开始时间。仅 navigation 类型指标有效。 |
| navigationType | `string` | 路由详细类型，与小程序路由方法对应。仅 navigation 类型指标有效。 |
| moduleName | `string` | 分包名，主包表示为 APP。仅 evaluateScript 指标有效。 |
| fileList | `string[]` | 注入文件列表。仅 evaluateScript 指标有效。 |
| viewLayerReadyTime | `number` | 渲染层代码注入完成时间。仅 firstRender 指标有效。 |
| initDataSendTime | `number` | 首次渲染参数从逻辑层发出的时间。仅 firstRender 指标有效。 |
| initDataRecvTime | `number` | 首次渲染参数在渲染层收到的时间。仅 firstRender 指标有效。 |
| viewLayerRenderStartTime | `number` | 渲染层执行渲染开始时间。仅 firstRender 指标有效。 |
| viewLayerRenderEndTime | `number` | 渲染层执行渲染结束时间。仅 firstRender 指标有效。 |

## 参数

### EntryType

entryType 的合法值

| 参数 | 说明 |
| --- | --- |
| navigation | 路由 |
| render | 渲染 |
| script | 脚本 |

### EntryName

name 的合法值

| 参数 | 说明 |
| --- | --- |
| appLaunch | 小程序启动耗时。起点为用户点击小程序图标，或小程序被拉起的时间；终点为首页 onReady。(entryType: navigation) |
| route | 路由处理耗时。(entryType: navigation) |
| firstRender | 页面首次渲染耗时。起点为逻辑层收到路由事件，包括逻辑层页面与组件初始化、VD 同步、渲染层执行渲染的时间；终点为首页 onReady。(entryType: render) |
| firstPaint | [页面首次绘制](https://developer.mozilla.org/en-US/docs/Glossary/First_paint)。第一个像素渲染到屏幕上所用的时间。(entryType: render) |
| firstContentfulPaint | [页面首次内容绘制](https://developer.mozilla.org/en-US/docs/Glossary/First_contentful_paint)。第一块内容渲染到屏幕上所用的时间。(entryType: render) |
| evaluateScript | 逻辑层 JS 代码注入耗时。(entryType: script) |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| PerformanceEntry | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/base/performance/PerformanceObserver.md">
---
title: PerformanceObserver
sidebar_label: PerformanceObserver
---

PerformanceObserver 对象，用于监听性能相关事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/PerformanceObserver.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| supportedEntryTypes | `PerformanceEntry[]` | 获取当前支持的所有性能指标类型 |

### disconnect

停止监听

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/PerformanceObserver.disconnect.html)

```tsx
() => void
```

### observe

开始监听

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/PerformanceObserver.observe.html)

```tsx
(option: Option) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

## 参数

### observe

#### Option

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `keyof EntryType` | 指标类型。不能和 entryTypes 同时使用 |
| entryTypes | `(keyof EntryType)[]` | 指标类型列表。不能和 type 同时使用。 |

#### EntryType

| 参数 | 说明 |
| --- | --- |
| navigation | 路由 |
| render | 渲染 |
| script | 脚本 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| PerformanceObserver | ✔️ |  |  |  |  |
| PerformanceObserver.disconnect | ✔️ |  |  |  |  |
| PerformanceObserver.observe | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/base/performance/preloadAssets.md">
---
title: Taro.preloadAssets(option)
sidebar_label: preloadAssets
---

为视图层预加载媒体资源文件, 目前支持：font，image

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/wx.preloadAssets.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### AssetsObjectType

| 参数 | 说明 |
| --- | --- |
| font | 字体 |
| image | 图片 |

### AssetsObject

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `keyof AssetsObjectType` | 类型 |
| src | `string` | 资源地址 |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `AssetsObject[]` | 是 |  |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/base/performance/preloadSkylineView.md">
---
title: Taro.preloadSkylineView(option)
sidebar_label: preloadSkylineView
---

预加载下个页面所需要的 Skyline 运行环境

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/wx.preloadSkylineView.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/base/performance/preloadWebview.md">
---
title: Taro.preloadWebview(option)
sidebar_label: preloadWebview
---

预加载下个页面的 WebView

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/wx.preloadWebview.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/base/performance/reportPerformance.md">
---
title: Taro.reportPerformance(id, value, dimensions)
sidebar_label: reportPerformance
---

小程序测速上报。使用前，需要在小程序管理后台配置。 详情参见[小程序测速](https://developers.weixin.qq.com/miniprogram/dev/framework/performanceReport/index.html)指南。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/performance/wx.reportPerformance.html)

## 类型

```tsx
(id: number, value: number, dimensions?: string | string[]) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `number` | 指标 id |
| value | `number` | 需要上报的数值 |
| dimensions | string or string[] | 自定义维度 |

## 示例代码

```tsx
Taro.reportPerformance(1101, 680)
Taro.reportPerformance(1101, 680, 'custom')
```
</file>

<file path="docs/apis/base/system/getAppAuthorizeSetting.md">
---
title: Taro.getAppAuthorizeSetting()
sidebar_label: getAppAuthorizeSetting
---

获取微信APP授权设置

- 'authorized' 表示已经获得授权，无需再次请求授权；
- 'denied' 表示请求授权被拒绝，无法再次请求授权；（此情况需要引导用户[打开系统设置](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.openAppAuthorizeSetting.html)，在设置页中打开权限）
- 'non determined' 表示尚未请求授权，会在微信下一次调用系统相应权限时请求；（仅 iOS 会出现。此种情况下引导用户打开系统设置，不展示开关）

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> H5: 暂未支持设置权限

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.getAppAuthorizeSetting.html)

## 类型

```tsx
() => Result
```

## 参数

### Result

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| albumAuthorized | `keyof Authorized` | 允许微信使用相册的开关（仅 iOS 有效） |
| bluetoothAuthorized | `keyof Authorized` | 允许微信使用蓝牙的开关（仅 iOS 有效） |
| cameraAuthorized | `keyof Authorized` | 允许微信使用摄像头的开关 |
| locationAuthorized | `keyof Authorized` | 允许微信使用定位的开关 |
| locationReducedAccuracy | `boolean` | 定位准确度。true 表示模糊定位，false 表示精确定位（仅 iOS 有效） |
| microphoneAuthorized | `keyof Authorized` | 允许微信使用麦克风的开关 |
| notificationAuthorized | `keyof Authorized` | 允许微信通知的开关 |
| notificationAlertAuthorized | `keyof Authorized` | 允许微信通知带有提醒的开关（仅 iOS 有效） |
| notificationBadgeAuthorized | `keyof Authorized` | 允许微信通知带有标记的开关（仅 iOS 有效） |
| notificationSoundAuthorized | `keyof Authorized` | 允许微信通知带有声音的开关（仅 iOS 有效） |
| phoneCalendarAuthorized | `keyof Authorized` | 允许微信读写日历的开关 |

### Authorized

授权合法值

| 参数 | 说明 |
| --- | --- |
| authorized | 表示已经获得授权，无需再次请求授权 |
| denied | 表示请求授权被拒绝，无法再次请求授权 （此情况需要引导用户打开[打开系统设置](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.openAppAuthorizeSetting.html)，在设置页中打开权限） |
| not determined | 表示尚未请求授权，会在微信下一次调用系统相应权限时请求 （仅 iOS 会出现。此种情况下引导用户[打开系统设置](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.openAppAuthorizeSetting.html)，不展示开关） |

## 示例代码

```tsx
const appAuthorizeSetting = Taro.getAppAuthorizeSetting()

console.log(appAuthorizeSetting.albumAuthorized)
console.log(appAuthorizeSetting.bluetoothAuthorized)
console.log(appAuthorizeSetting.cameraAuthorized)
console.log(appAuthorizeSetting.locationAuthorized)
console.log(appAuthorizeSetting.locationReducedAccuracy)
console.log(appAuthorizeSetting.microphoneAuthorized)
console.log(appAuthorizeSetting.notificationAlertAuthorized)
console.log(appAuthorizeSetting.notificationAuthorized)
console.log(appAuthorizeSetting.notificationBadgeAuthorized)
console.log(appAuthorizeSetting.notificationSoundAuthorized)
console.log(appAuthorizeSetting.phoneCalendarAuthorized)
```
</file>

<file path="docs/apis/base/system/getAppBaseInfo.md">
---
title: Taro.getAppBaseInfo()
sidebar_label: getAppBaseInfo
---

获取微信APP基础信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> H5: 不支持 SDKVersion、host、version

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.getAppBaseInfo.html)

## 类型

```tsx
() => Result
```

## 参数

### Result

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| SDKVersion | `string` | 否 | 客户端基础库版本 |
| enableDebug | `boolean` | 否 | 是否已打开调试。可通过右上角菜单或 [Taro.setEnableDebug](/docs/apis/base/debug/setEnableDebug) 打开调试。 |
| host | `Host` | 否 | 当前小程序运行的宿主环境 |
| language | `string` | 是 | 微信设置的语言 |
| version | `string` | 否 | 微信版本号 |
| theme | `keyof Theme` | 否 | 系统当前主题，取值为light或dark，全局配置"darkmode":true时才能获取，否则为 undefined （不支持小游戏） |

### Theme

系统主题合法值

| 参数 | 说明 |
| --- | --- |
| dark | 深色主题 |
| light | 浅色主题 |

### Host

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| appId | `string` | 宿主 app 对应的 appId |

## 示例代码

```tsx
const appBaseInfo = Taro.getAppBaseInfo()

console.log(appBaseInfo.SDKVersion)
console.log(appBaseInfo.enableDebug)
console.log(appBaseInfo.host)
console.log(appBaseInfo.language)
console.log(appBaseInfo.version)
console.log(appBaseInfo.theme)
```
</file>

<file path="docs/apis/base/system/getDeviceInfo.md">
---
title: Taro.getDeviceInfo()
sidebar_label: getDeviceInfo
---

获取设备基础信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> H5: 不支持 abi、benchmarkLevel

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.getDeviceInfo.html)

## 类型

```tsx
() => Result
```

## 参数

### Result

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| abi | `string` | 否 | 应用二进制接口类型（仅 Android 支持） |
| deviceAbi | `string` | 是 | 设备二进制接口类型（仅 Android 支持） |
| benchmarkLevel | `number` | 是 | 设备性能等级（仅Android小游戏）。取值为：-2 或 0（该设备无法运行小游戏），-1（性能未知），>=1（设备性能值，该值越高，设备性能越好，目前最高不到50） |
| brand | `string` | 是 | 设备品牌 |
| model | `string` | 是 | 设备型号 |
| system | `string` | 是 | 操作系统及版本 |
| platform | `string` | 是 | 客户端平台 |
| CPUType | `string` | 是 | 设备 CPU 型号（仅 Android 支持） |

## 示例代码

```tsx
const deviceInfo = Taro.getDeviceInfo()

console.log(deviceInfo.abi)
console.log(deviceInfo.benchmarkLevel)
console.log(deviceInfo.brand)
console.log(deviceInfo.model)
console.log(deviceInfo.platform)
console.log(deviceInfo.system)
```
</file>

<file path="docs/apis/base/system/getRendererUserAgent.md">
---
title: Taro.getRendererUserAgent(option)
sidebar_label: getRendererUserAgent
---

获取 Webview 小程序的 UserAgent
基础库 2.26.3 开始支持

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.getRendererUserAgent.html)

## 类型

```tsx
(option?: Option) => Promise<Result>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| success | `(res: Result) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### Result

| 参数 | 类型 |
| --- | --- |
| userAgent | `string` |
</file>

<file path="docs/apis/base/system/getSkylineInfo.md">
---
title: Taro.getSkylineInfo(option)
sidebar_label: getSkylineInfo
---

获取当前运行环境对于 Skyline 渲染引擎 的支持情况
基础库 2.26.2 开始支持

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.getSkylineInfo.html)

## 类型

```tsx
(option?: Option) => Promise<Result>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| success | `(res: Result) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### Result

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| isSupported | `boolean` | 是 | 当前运行环境是否支持 Skyline 渲染引擎 |
| version | `string` | 是 | 当前运行环境 Skyline 渲染引擎 的版本号，形如 0.9.7 |
| reason | `string` | 否 | 当前运行环境不支持 Skyline 渲染引擎 的原因，仅在 isSupported 为 false 时出现 |
</file>

<file path="docs/apis/base/system/getSkylineInfoSync.md">
---
title: Taro.getSkylineInfoSync()
sidebar_label: getSkylineInfoSync
---

获取当前运行环境对于 Skyline 渲染引擎 的支持情况
基础库 2.26.2 开始支持

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.getSkylineInfoSync.html)

## 类型

```tsx
() => Result
```

## 参数

### Result

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| isSupported | `boolean` | 是 | 当前运行环境是否支持 Skyline 渲染引擎 |
| version | `string` | 是 | 当前运行环境 Skyline 渲染引擎 的版本号，形如 0.9.7 |
| reason | `string` | 否 | 当前运行环境不支持 Skyline 渲染引擎 的原因，仅在 isSupported 为 false 时出现 |
</file>

<file path="docs/apis/base/system/getSystemInfo.md">
---
title: Taro.getSystemInfo(res)
sidebar_label: getSystemInfo
---

获取系统信息，支持 `Promise` 化使用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> 微信小程序: 小程序可以在微信和企业微信中调用此接口，但是在企业微信中调用此接口时，会额外返回一个 environment 字段（微信中不返回），如此字段值为 wxwork，则表示当前小程序运行在企业微信环境中。
>
> H5: 不支持 version、statusBarHeight、fontSizeSetting、SDKVersion

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/system-info/wx.getSystemInfo.html)

## 类型

```tsx
(res?: Option) => Promise<Result>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| res | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| success | `(res: Result) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### Result

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| brand | `string` | 是 | 设备品牌 |
| model | `string` | 是 | 设备型号 |
| pixelRatio | `number` | 是 | 设备像素比 |
| screenWidth | `number` | 是 | 屏幕宽度，单位px |
| screenHeight | `number` | 是 | 屏幕高度，单位px |
| windowWidth | `number` | 是 | 可使用窗口宽度，单位px |
| windowHeight | `number` | 是 | 可使用窗口高度，单位px |
| statusBarHeight | `number` | 否 | 状态栏的高度，单位px |
| language | `string` | 是 | 微信设置的语言 |
| version | `string` | 否 | 微信版本号 |
| system | `string` | 是 | 操作系统及版本 |
| platform | `string` | 是 | 客户端平台 |
| fontSizeSetting | `number` | 否 | 用户字体大小（单位px）。以微信客户端「我-设置-通用-字体大小」中的设置为准 |
| SDKVersion | `string` | 否 | 客户端基础库版本 |
| benchmarkLevel | `number` | 是 | 设备性能等级（仅Android小游戏）。取值为：-2 或 0（该设备无法运行小游戏），-1（性能未知），>=1（设备性能值，该值越高，设备性能越好，目前最高不到50） |
| albumAuthorized | `boolean` | 否 | 允许微信使用相册的开关（仅 iOS 有效） |
| cameraAuthorized | `boolean` | 否 | 允许微信使用摄像头的开关 |
| locationAuthorized | `boolean` | 否 | 允许微信使用定位的开关 |
| microphoneAuthorized | `boolean` | 否 | 允许微信使用麦克风的开关 |
| notificationAuthorized | `boolean` | 否 | 允许微信通知的开关 |
| notificationAlertAuthorized | `boolean` | 否 | 允许微信通知带有提醒的开关（仅 iOS 有效） |
| notificationBadgeAuthorized | `boolean` | 否 | 允许微信通知带有标记的开关（仅 iOS 有效） |
| notificationSoundAuthorized | `boolean` | 否 | 允许微信通知带有声音的开关（仅 iOS 有效） |
| phoneCalendarAuthorized | `boolean` | 否 | 允许微信使用日历的开关 |
| bluetoothEnabled | `boolean` | 否 | 蓝牙的系统开关 |
| locationEnabled | `boolean` | 否 | 地理位置的系统开关 |
| wifiEnabled | `boolean` | 否 | Wi-Fi 的系统开关 |
| safeArea | `TaroGeneral.SafeAreaResult` | 否 | 在竖屏正方向下的安全区域 |
| locationReducedAccuracy | `boolean` | 否 | `true` 表示模糊定位，`false` 表示精确定位，仅 iOS 支持 |
| theme | `keyof Theme` | 否 | 系统当前主题，取值为light或dark，全局配置"darkmode":true时才能获取，否则为 undefined （不支持小游戏） |
| host | `Host` | 否 | 当前小程序运行的宿主环境 |
| enableDebug | `boolean` | 否 | 是否已打开调试。可通过右上角菜单或 [Taro.setEnableDebug](/docs/apis/base/debug/setEnableDebug) 打开调试。 |
| deviceOrientation | `keyof DeviceOrientation` | 否 | 设备方向 |
| environment | `string` | 否 | 小程序当前运行环境 |

### Theme

系统主题合法值

| 参数 | 说明 |
| --- | --- |
| dark | 深色主题 |
| light | 浅色主题 |

### Host

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| appId | `string` | 宿主 app 对应的 appId |

### DeviceOrientation

设备方向合法值

| 参数 | 说明 |
| --- | --- |
| portrait | 竖屏 |
| landscape | 横屏 |

## 示例代码

### 示例 1

```tsx
Taro.getSystemInfo({
  success: res => console.log(res)
})
.then(res => console.log(res))
```

### 示例 2

```tsx
Taro.getSystemInfo({
  success: function (res) {
    console.log(res.model)
    console.log(res.pixelRatio)
    console.log(res.windowWidth)
    console.log(res.windowHeight)
    console.log(res.language)
    console.log(res.version)
    console.log(res.platform)
  }
})
```
</file>

<file path="docs/apis/base/system/getSystemInfoAsync.md">
---
title: Taro.getSystemInfoAsync(res)
sidebar_label: getSystemInfoAsync
---

异步获取系统信息。需要一定的微信客户端版本支持，在不支持的客户端上，会使用同步实现来返回。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> 微信小程序: 小程序可以在微信和企业微信中调用此接口，但是在企业微信中调用此接口时，会额外返回一个 environment 字段（微信中不返回），如此字段值为 wxwork，则表示当前小程序运行在企业微信环境中。
>
> H5: 不支持 version、statusBarHeight、fontSizeSetting、SDKVersion

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.getSystemInfoAsync.html)

## 类型

```tsx
(res?: Option) => Promise<Result>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| res | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| success | `(res: Result) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### Result

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| brand | `string` | 是 | 设备品牌 |
| model | `string` | 是 | 设备型号 |
| pixelRatio | `number` | 是 | 设备像素比 |
| screenWidth | `number` | 是 | 屏幕宽度，单位px |
| screenHeight | `number` | 是 | 屏幕高度，单位px |
| windowWidth | `number` | 是 | 可使用窗口宽度，单位px |
| windowHeight | `number` | 是 | 可使用窗口高度，单位px |
| statusBarHeight | `number` | 否 | 状态栏的高度，单位px |
| language | `string` | 是 | 微信设置的语言 |
| version | `string` | 否 | 微信版本号 |
| system | `string` | 是 | 操作系统及版本 |
| platform | `string` | 是 | 客户端平台 |
| fontSizeSetting | `number` | 否 | 用户字体大小（单位px）。以微信客户端「我-设置-通用-字体大小」中的设置为准 |
| SDKVersion | `string` | 否 | 客户端基础库版本 |
| benchmarkLevel | `number` | 是 | 设备性能等级（仅Android小游戏）。取值为：-2 或 0（该设备无法运行小游戏），-1（性能未知），>=1（设备性能值，该值越高，设备性能越好，目前最高不到50） |
| albumAuthorized | `boolean` | 否 | 允许微信使用相册的开关（仅 iOS 有效） |
| cameraAuthorized | `boolean` | 否 | 允许微信使用摄像头的开关 |
| locationAuthorized | `boolean` | 否 | 允许微信使用定位的开关 |
| microphoneAuthorized | `boolean` | 否 | 允许微信使用麦克风的开关 |
| notificationAuthorized | `boolean` | 否 | 允许微信通知的开关 |
| notificationAlertAuthorized | `boolean` | 否 | 允许微信通知带有提醒的开关（仅 iOS 有效） |
| notificationBadgeAuthorized | `boolean` | 否 | 允许微信通知带有标记的开关（仅 iOS 有效） |
| notificationSoundAuthorized | `boolean` | 否 | 允许微信通知带有声音的开关（仅 iOS 有效） |
| phoneCalendarAuthorized | `boolean` | 否 | 允许微信使用日历的开关 |
| bluetoothEnabled | `boolean` | 否 | 蓝牙的系统开关 |
| locationEnabled | `boolean` | 否 | 地理位置的系统开关 |
| wifiEnabled | `boolean` | 否 | Wi-Fi 的系统开关 |
| safeArea | `TaroGeneral.SafeAreaResult` | 否 | 在竖屏正方向下的安全区域 |
| locationReducedAccuracy | `boolean` | 否 | `true` 表示模糊定位，`false` 表示精确定位，仅 iOS 支持 |
| theme | `keyof Theme` | 否 | 系统当前主题，取值为light或dark，全局配置"darkmode":true时才能获取，否则为 undefined （不支持小游戏） |
| host | `Host` | 否 | 当前小程序运行的宿主环境 |
| enableDebug | `boolean` | 否 | 是否已打开调试。可通过右上角菜单或 [Taro.setEnableDebug](/docs/apis/base/debug/setEnableDebug) 打开调试。 |
| deviceOrientation | `keyof DeviceOrientation` | 否 | 设备方向 |
| environment | `string` | 否 | 小程序当前运行环境 |

### Theme

系统主题合法值

| 参数 | 说明 |
| --- | --- |
| dark | 深色主题 |
| light | 浅色主题 |

### Host

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| appId | `string` | 宿主 app 对应的 appId |

### DeviceOrientation

设备方向合法值

| 参数 | 说明 |
| --- | --- |
| portrait | 竖屏 |
| landscape | 横屏 |

## 示例代码

```tsx
Taro.getSystemInfoAsync({
  success (res) {
    console.log(res.model)
    console.log(res.pixelRatio)
    console.log(res.windowWidth)
    console.log(res.windowHeight)
    console.log(res.language)
    console.log(res.version)
    console.log(res.platform)
  }
})
```
</file>

<file path="docs/apis/base/system/getSystemInfoSync.md">
---
title: Taro.getSystemInfoSync()
sidebar_label: getSystemInfoSync
---

[Taro.getSystemInfo](./getSystemInfo) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> 微信小程序: 小程序可以在微信和企业微信中调用此接口，但是在企业微信中调用此接口时，会额外返回一个 environment 字段（微信中不返回），如此字段值为 wxwork，则表示当前小程序运行在企业微信环境中。
>
> H5: 不支持 version、statusBarHeight、fontSizeSetting、SDKVersion

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/system-info/wx.getSystemInfoSync.html)

## 类型

```tsx
() => Result
```

## 参数

### Result

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| brand | `string` | 是 | 设备品牌 |
| model | `string` | 是 | 设备型号 |
| pixelRatio | `number` | 是 | 设备像素比 |
| screenWidth | `number` | 是 | 屏幕宽度，单位px |
| screenHeight | `number` | 是 | 屏幕高度，单位px |
| windowWidth | `number` | 是 | 可使用窗口宽度，单位px |
| windowHeight | `number` | 是 | 可使用窗口高度，单位px |
| statusBarHeight | `number` | 否 | 状态栏的高度，单位px |
| language | `string` | 是 | 微信设置的语言 |
| version | `string` | 否 | 微信版本号 |
| system | `string` | 是 | 操作系统及版本 |
| platform | `string` | 是 | 客户端平台 |
| fontSizeSetting | `number` | 否 | 用户字体大小（单位px）。以微信客户端「我-设置-通用-字体大小」中的设置为准 |
| SDKVersion | `string` | 否 | 客户端基础库版本 |
| benchmarkLevel | `number` | 是 | 设备性能等级（仅Android小游戏）。取值为：-2 或 0（该设备无法运行小游戏），-1（性能未知），>=1（设备性能值，该值越高，设备性能越好，目前最高不到50） |
| albumAuthorized | `boolean` | 否 | 允许微信使用相册的开关（仅 iOS 有效） |
| cameraAuthorized | `boolean` | 否 | 允许微信使用摄像头的开关 |
| locationAuthorized | `boolean` | 否 | 允许微信使用定位的开关 |
| microphoneAuthorized | `boolean` | 否 | 允许微信使用麦克风的开关 |
| notificationAuthorized | `boolean` | 否 | 允许微信通知的开关 |
| notificationAlertAuthorized | `boolean` | 否 | 允许微信通知带有提醒的开关（仅 iOS 有效） |
| notificationBadgeAuthorized | `boolean` | 否 | 允许微信通知带有标记的开关（仅 iOS 有效） |
| notificationSoundAuthorized | `boolean` | 否 | 允许微信通知带有声音的开关（仅 iOS 有效） |
| phoneCalendarAuthorized | `boolean` | 否 | 允许微信使用日历的开关 |
| bluetoothEnabled | `boolean` | 否 | 蓝牙的系统开关 |
| locationEnabled | `boolean` | 否 | 地理位置的系统开关 |
| wifiEnabled | `boolean` | 否 | Wi-Fi 的系统开关 |
| safeArea | `TaroGeneral.SafeAreaResult` | 否 | 在竖屏正方向下的安全区域 |
| locationReducedAccuracy | `boolean` | 否 | `true` 表示模糊定位，`false` 表示精确定位，仅 iOS 支持 |
| theme | `keyof Theme` | 否 | 系统当前主题，取值为light或dark，全局配置"darkmode":true时才能获取，否则为 undefined （不支持小游戏） |
| host | `Host` | 否 | 当前小程序运行的宿主环境 |
| enableDebug | `boolean` | 否 | 是否已打开调试。可通过右上角菜单或 [Taro.setEnableDebug](/docs/apis/base/debug/setEnableDebug) 打开调试。 |
| deviceOrientation | `keyof DeviceOrientation` | 否 | 设备方向 |
| environment | `string` | 否 | 小程序当前运行环境 |

### Theme

系统主题合法值

| 参数 | 说明 |
| --- | --- |
| dark | 深色主题 |
| light | 浅色主题 |

### Host

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| appId | `string` | 宿主 app 对应的 appId |

### DeviceOrientation

设备方向合法值

| 参数 | 说明 |
| --- | --- |
| portrait | 竖屏 |
| landscape | 横屏 |

## 示例代码

```tsx
try {
  const res = Taro.getSystemInfoSync()
  console.log(res.model)
  console.log(res.pixelRatio)
  console.log(res.windowWidth)
  console.log(res.windowHeight)
  console.log(res.language)
  console.log(res.version)
  console.log(res.platform)
} catch (e) {
  // Do something when catch error
}
```
</file>

<file path="docs/apis/base/system/getSystemSetting.md">
---
title: Taro.getSystemSetting()
sidebar_label: getSystemSetting
---

获取设备设置

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> H5: 不支持 bluetoothEnabled、locationEnabled、wifiEnabled

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.getSystemSetting.html)

## 类型

```tsx
() => Result
```

## 参数

### Result

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| bluetoothEnabled | `boolean` | 否 | 蓝牙的系统开关 |
| locationEnabled | `boolean` | 否 | 地理位置的系统开关 |
| wifiEnabled | `boolean` | 否 | Wi-Fi 的系统开关 |
| deviceOrientation | `keyof DeviceOrientation` | 否 | 设备方向 |

### DeviceOrientation

设备方向合法值

| 参数 | 说明 |
| --- | --- |
| portrait | 竖屏 |
| landscape | 横屏 |

## 示例代码

```tsx
const systemSetting = Taro.getSystemSetting()

console.log(systemSetting.bluetoothEnabled)
console.log(systemSetting.deviceOrientation)
console.log(systemSetting.locationEnabled)
console.log(systemSetting.wifiEnabled)
```
</file>

<file path="docs/apis/base/system/getWindowInfo.md">
---
title: Taro.getWindowInfo()
sidebar_label: getWindowInfo
---

获取窗口信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> H5: 不支持 statusBarHeight、safeArea

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.getWindowInfo.html)

## 类型

```tsx
() => Result
```

## 参数

### Result

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| pixelRatio | `number` | 是 | 设备像素比 |
| screenWidth | `number` | 是 | 屏幕宽度，单位px |
| screenHeight | `number` | 是 | 屏幕高度，单位px |
| windowWidth | `number` | 是 | 可使用窗口宽度，单位px |
| windowHeight | `number` | 是 | 可使用窗口高度，单位px |
| statusBarHeight | `number` | 否 | 状态栏的高度，单位px |
| safeArea | `TaroGeneral.SafeAreaResult` | 否 | 在竖屏正方向下的安全区域 |

## 示例代码

```tsx
const windowInfo = Taro.getWindowInfo()

console.log(windowInfo.pixelRatio)
console.log(windowInfo.screenWidth)
console.log(windowInfo.screenHeight)
console.log(windowInfo.windowWidth)
console.log(windowInfo.windowHeight)
console.log(windowInfo.statusBarHeight)
console.log(windowInfo.safeArea)
console.log(windowInfo.screenTop)
```
</file>

<file path="docs/apis/base/system/openAppAuthorizeSetting.md">
---
title: Taro.openAppAuthorizeSetting(option)
sidebar_label: openAppAuthorizeSetting
---

跳转系统微信授权管理页

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.openAppAuthorizeSetting.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

## 示例代码

```tsx
Taro.openAppAuthorizeSetting({
  success (res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/base/system/openSystemBluetoothSetting.md">
---
title: Taro.openSystemBluetoothSetting(option)
sidebar_label: openSystemBluetoothSetting
---

跳转系统蓝牙设置页

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.openSystemBluetoothSetting.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

## 示例代码

```tsx
Taro.openSystemBluetoothSetting({
  success (res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/base/update/getUpdateManager.md">
---
title: Taro.getUpdateManager()
sidebar_label: getUpdateManager
---

获取**全局唯一**的版本更新管理器，用于管理小程序更新。
关于小程序的更新机制，可以查看[运行机制](https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/operating-mechanism.html)文档。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/update/wx.getUpdateManager.html)

## 类型

```tsx
() => UpdateManager
```

## 示例代码

```tsx
const updateManager = Taro.getUpdateManager()
  updateManager.onCheckForUpdate(function (res) {
  // 请求完新版本信息的回调
  console.log(res.hasUpdate)
})
updateManager.onUpdateReady(function () {
  Taro.showModal({
    title: '更新提示',
    content: '新版本已经准备好，是否重启应用？',
    success: function (res) {
      if (res.confirm) {
        // 新的版本已经下载好，调用 applyUpdate 应用新版本并重启
        updateManager.applyUpdate()
      }
    }
  })
})
updateManager.onUpdateFailed(function () {
  // 新的版本下载失败
})
```
</file>

<file path="docs/apis/base/update/UpdateManager.md">
---
title: UpdateManager
sidebar_label: UpdateManager
---

UpdateManager 对象，用来管理更新，可通过 Taro.getUpdateManager 接口获取实例。

**Tips**
- 微信开发者工具上可以通过「编译模式」下的「下次编译模拟更新」开关来调试
- 小程序开发版/体验版没有「版本」概念，所以无法在开发版/体验版上测试更版本更新情况

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/update/UpdateManager.html)

## 方法

### applyUpdate

强制小程序重启并使用新版本。在小程序新版本下载完成后（即收到 `onUpdateReady` 回调）调用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/update/UpdateManager.applyUpdate.html)

```tsx
() => void
```

### onCheckForUpdate

监听向微信后台请求检查更新结果事件。微信在小程序冷启动时自动检查更新，不需由开发者主动触发。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/update/UpdateManager.onCheckForUpdate.html)

```tsx
(callback: OnCheckForUpdateCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnCheckForUpdateCallback` | 向微信后台请求检查更新结果事件的回调函数 |

### onUpdateReady

监听小程序有版本更新事件。客户端主动触发下载（无需开发者触发），下载成功后回调

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/update/UpdateManager.onUpdateReady.html)

```tsx
(callback: (res: TaroGeneral.CallbackResult) => void) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.CallbackResult) => void` | 小程序有版本更新事件的回调函数 |

### onUpdateFailed

监听小程序更新失败事件。小程序有新版本，客户端主动触发下载（无需开发者触发），下载失败（可能是网络原因等）后回调

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/update/UpdateManager.onUpdateFailed.html)

```tsx
(callback: (res: TaroGeneral.CallbackResult) => void) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.CallbackResult) => void` | 小程序更新失败事件的回调函数 |

## 参数

### OnCheckForUpdateCallback

向微信后台请求检查更新结果事件的回调函数

```tsx
(result: OnCheckForUpdateResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnCheckForUpdateResult` |

### OnCheckForUpdateResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| hasUpdate | `boolean` | 是否有新版本 |

## 示例代码

```tsx
const updateManager = Taro.getUpdateManager()

updateManager.onCheckForUpdate(function (res) {
  // 请求完新版本信息的回调
  console.log(res.hasUpdate)
})

updateManager.onUpdateReady(function () {
  wx.showModal({
    title: '更新提示',
    content: '新版本已经准备好，是否重启应用？',
    success: function (res) {
      if (res.confirm) {
        // 新的版本已经下载好，调用 applyUpdate 应用新版本并重启
        updateManager.applyUpdate()
      }
    }
  })
})

updateManager.onUpdateFailed(function () {
  // 新版本下载失败
})
```

## API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| UpdateManager | ✔️ | ✔️ |  |  |  |
| UpdateManager.applyUpdate | ✔️ | ✔️ |  |  |  |
| UpdateManager.onCheckForUpdate | ✔️ | ✔️ |  |  |  |
| UpdateManager.onUpdateReady | ✔️ | ✔️ |  |  |  |
| UpdateManager.onUpdateFailed | ✔️ | ✔️ |  |  |  |
</file>

<file path="docs/apis/base/update/updateWeChatApp.md">
---
title: Taro.updateWeChatApp(option)
sidebar_label: updateWeChatApp
---

更新客户端版本。当判断用户小程序所在客户端版本过低时，可使用该接口跳转到更新微信页面。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/update/wx.updateWeChatApp.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
</file>

<file path="docs/apis/base/weapp/app-event/offAppHide.md">
---
title: Taro.offAppHide(callback)
sidebar_label: offAppHide
---

取消监听小程序切后台事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.offAppHide.html)

## 类型

```tsx
(callback: (res: CallbackResult) => void) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: CallbackResult) => void` | 小程序切后台事件的回调函数 |
</file>

<file path="docs/apis/base/weapp/app-event/offAppShow.md">
---
title: Taro.offAppShow(callback)
sidebar_label: offAppShow
---

取消监听小程序切前台事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.offAppShow.html)

## 类型

```tsx
(callback: (res: CallbackResult) => void) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: CallbackResult) => void` | 小程序切前台事件的回调函数 |
</file>

<file path="docs/apis/base/weapp/app-event/offAudioInterruptionBegin.md">
---
title: Taro.offAudioInterruptionBegin(callback)
sidebar_label: offAudioInterruptionBegin
---

取消监听音频因为受到系统占用而被中断开始事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.offAudioInterruptionBegin.html)

## 类型

```tsx
(callback: (res: TaroGeneral.CallbackResult) => void) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.CallbackResult) => void` | 音频因为受到系统占用而被中断开始事件的回调函数 |
</file>

<file path="docs/apis/base/weapp/app-event/offAudioInterruptionEnd.md">
---
title: Taro.offAudioInterruptionEnd(callback)
sidebar_label: offAudioInterruptionEnd
---

取消监听音频中断结束事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.offAudioInterruptionEnd.html)

## 类型

```tsx
(callback: (res: TaroGeneral.CallbackResult) => void) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.CallbackResult) => void` | 音频中断结束事件的回调函数 |
</file>

<file path="docs/apis/base/weapp/app-event/offError.md">
---
title: Taro.offError(callback)
sidebar_label: offError
---

取消监听音频播放错误事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/InnerAudioContext.offError.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 音频播放错误事件的回调函数 |
</file>

<file path="docs/apis/base/weapp/app-event/offPageNotFound.md">
---
title: Taro.offPageNotFound(callback)
sidebar_label: offPageNotFound
---

取消监听小程序要打开的页面不存在事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.offPageNotFound.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 小程序要打开的页面不存在事件的回调函数 |
</file>

<file path="docs/apis/base/weapp/app-event/offThemeChange.md">
---
title: Taro.offThemeChange(callback)
sidebar_label: offThemeChange
---

取消监听系统主题改变事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.offThemeChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |
</file>

<file path="docs/apis/base/weapp/app-event/offUnhandledRejection.md">
---
title: Taro.offUnhandledRejection(callback)
sidebar_label: offUnhandledRejection
---

取消监听未处理的 Promise 拒绝事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.offUnhandledRejection.html)

## 类型

```tsx
<T = any>(callback: Callback<T>) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `T` |
</file>

<file path="docs/apis/base/weapp/app-event/onAppHide.md">
---
title: Taro.onAppHide(callback)
sidebar_label: onAppHide
---

监听小程序切后台事件。该事件与 [`App.onHide`](https://developers.weixin.qq.com/miniprogram/dev/reference/api/App.html#onhide) 的回调时机一致。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onAppHide.html)

## 类型

```tsx
(callback: (res: CallbackResult) => void) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: CallbackResult) => void` | 小程序切后台事件的回调函数 |
</file>

<file path="docs/apis/base/weapp/app-event/onAppShow.md">
---
title: Taro.onAppShow(callback)
sidebar_label: onAppShow
---

监听小程序切前台事件。该事件与 [`App.onShow`](https://developers.weixin.qq.com/miniprogram/dev/reference/api/App.html#onshowobject-object) 的回调参数一致。

**返回有效 referrerInfo 的场景**

| 场景值 | 场景                            | appId含义  |
| ------ | ------------------------------- | ---------- |
| 1020   | 公众号 profile 页相关小程序列表 | 来源公众号 |
| 1035   | 公众号自定义菜单                | 来源公众号 |
| 1036   | App 分享消息卡片                | 来源App    |
| 1037   | 小程序打开小程序                | 来源小程序 |
| 1038   | 从另一个小程序返回              | 来源小程序 |
| 1043   | 公众号模板消息                  | 来源公众号 |

**注意**

部分版本在无`referrerInfo`的时候会返回 `undefined`，建议使用 `options.referrerInfo && options.referrerInfo.appId` 进行判断。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onAppShow.html)

## 类型

```tsx
(callback: (res: CallbackResult) => void) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: CallbackResult) => void` | 小程序切前台事件的回调函数 |

### CallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| path | `string` | 是 | 小程序切前台的路径 |
| query | `TaroGeneral.IAnyObject` | 是 | 小程序切前台的 query 参数 |
| shareTicket | `string` | 是 | shareTicket，详见[获取更多转发信息](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share.html) |
| scene | `number` | 是 | 小程序切前台的[场景值](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/scene.html) |
| referrerInfo | `ResultReferrerInfo` | 是 | 来源信息。从另一个小程序、公众号或 App 进入小程序时返回。否则返回 `{}`。(参见后文注意) |
| forwardMaterials | `ForwardMaterial[]` | 否 | 打开的文件信息数组，只有从聊天素材场景打开（scene为1173）才会携带该参数 |
| chatType | `keyof ChatType` | 否 | 从微信群聊/单聊打开小程序时，chatType 表示具体微信群聊/单聊类型 |
| apiCategory | `keyof ApiCategory` | 否 | API 类别 |

### ResultReferrerInfo

来源信息。从另一个小程序、公众号或 App 进入小程序时返回。否则返回 `{}`。(参见后文注意)

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| appId | `string` | 否 | 来源小程序、公众号或 App 的 appId |
| extraData | `TaroGeneral.IAnyObject` | 否 | 来源小程序传过来的数据，scene=1037或1038时支持 |

### ForwardMaterial

ChatType 类型合法值

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `string` | 文件的mimetype类型 |
| name | `string` | 文件名 |
| path | `string` | 文件路径（如果是webview则是url） |
| size | `number` | 文件大小 |

### ChatType

ChatType 类型合法值

| 参数 | 说明 |
| --- | --- |
| 1 | 微信联系人单聊 |
| 2 | 企业微信联系人单聊 |
| 3 | 普通微信群聊 |
| 4 | 企业微信互通群聊 |

### ApiCategory

API 类别合法值

| 参数 | 说明 |
| --- | --- |
| default | 默认类别 |
| nativeFunctionalized | 原生功能化，视频号直播商品、商品橱窗等场景打开的小程序 |
| browseOnly | 仅浏览，朋友圈快照页等场景打开的小程序 |
| embedded | 内嵌，通过打开半屏小程序能力打开的小程序 |
</file>

<file path="docs/apis/base/weapp/app-event/onAudioInterruptionBegin.md">
---
title: Taro.onAudioInterruptionBegin(callback)
sidebar_label: onAudioInterruptionBegin
---

监听音频因为受到系统占用而被中断开始事件。以下场景会触发此事件：闹钟、电话、FaceTime 通话、微信语音聊天、微信视频聊天。此事件触发后，小程序内所有音频会暂停。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onAudioInterruptionBegin.html)

## 类型

```tsx
(callback: (res: TaroGeneral.CallbackResult) => void) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.CallbackResult) => void` | 音频因为受到系统占用而被中断开始事件的回调函数 |
</file>

<file path="docs/apis/base/weapp/app-event/onAudioInterruptionEnd.md">
---
title: Taro.onAudioInterruptionEnd(callback)
sidebar_label: onAudioInterruptionEnd
---

监听音频中断结束事件。在收到 onAudioInterruptionBegin 事件之后，小程序内所有音频会暂停，收到此事件之后才可再次播放成功

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onAudioInterruptionEnd.html)

## 类型

```tsx
(callback: (res: TaroGeneral.CallbackResult) => void) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.CallbackResult) => void` | 音频中断结束事件的回调函数 |
</file>

<file path="docs/apis/base/weapp/app-event/onError.md">
---
title: Taro.onError(callback)
sidebar_label: onError
---

监听小程序错误事件。如脚本错误或 API 调用报错等。该事件与 [`App.onError`](https://developers.weixin.qq.com/miniprogram/dev/reference/api/App.html#onerrorstring-error) 的回调时机与参数一致。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onError.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |

### Callback

小程序错误事件的回调函数

```tsx
(error: string | ErrorEvent | Error) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| error | string or ErrorEvent or Error | 错误信息，包含堆栈 |
</file>

<file path="docs/apis/base/weapp/app-event/onPageNotFound.md">
---
title: Taro.onPageNotFound(callback)
sidebar_label: onPageNotFound
---

监听小程序要打开的页面不存在事件。该事件与 [`App.onPageNotFound`](https://developers.weixin.qq.com/miniprogram/dev/reference/api/App.html#onpagenotfoundobject-object) 的回调时机一致。

**注意**
- 开发者可以在回调中进行页面重定向，但必须在回调中**同步**处理，异步处理（例如 `setTimeout` 异步执行）无效。
- 若开发者没有调用 [Taro.onPageNotFound](/docs/apis/base/weapp/app-event/onPageNotFound) 绑定监听，也没有声明 `App.onPageNotFound`，当跳转页面不存在时，将推入微信客户端原生的页面不存在提示页面。
- 如果回调中又重定向到另一个不存在的页面，将推入微信客户端原生的页面不存在提示页面，并且不再第二次回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onPageNotFound.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |

### Result

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| isEntryPage | `boolean` | 是否本次启动的首个页面（例如从分享等入口进来，首个页面是开发者配置的分享页面） |
| path | `string` | 不存在页面的路径 |
| query | `TaroGeneral.IAnyObject` | 打开不存在页面的 query 参数 |

### Callback

小程序要打开的页面不存在事件的回调函数

```tsx
(res: Result) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `Result` |
</file>

<file path="docs/apis/base/weapp/app-event/onThemeChange.md">
---
title: Taro.onThemeChange(callback)
sidebar_label: onThemeChange
---

监听系统主题改变事件。该事件与 [`App.onThemeChange`](https://developers.weixin.qq.com/miniprogram/dev/reference/api/App.html#onThemeChange-Object-object) 的回调时机一致。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onThemeChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |

### Callback

系统主题改变事件的回调函数

```tsx
(res: Result) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `Result` |

### Result

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| theme | `keyof ITheme` | 系统当前的主题，取值为`light`或`dark` |

### ITheme

| 参数 | 说明 |
| --- | --- |
| light | 浅色主题 |
| dark | 深色主题 |
</file>

<file path="docs/apis/base/weapp/app-event/onUnhandledRejection.md">
---
title: Taro.onUnhandledRejection(callback)
sidebar_label: onUnhandledRejection
---

监听未处理的 Promise 拒绝事件。该事件与 [`App.onUnhandledRejection`](https://developers.weixin.qq.com/miniprogram/dev/reference/api/App.html#onUnhandledRejection-Object-object) 的回调时机与参数一致。

**注意**
- 所有的 unhandledRejection 都可以被这一监听捕获，但只有 Error 类型的才会在小程序后台触发报警。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onUnhandledRejection.html)

## 类型

```tsx
<T = any>(callback: Callback<T>) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `T` |

### Callback

```tsx
(res: Result<T>) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `Result<T>` |

### Result

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| reason | string or Error | 拒绝原因，一般是一个 Error 对象 |
| promise | `Promise<T>` | 被拒绝的 Promise 对象 |
</file>

<file path="docs/apis/base/weapp/life-cycle/getEnterOptionsSync.md">
---
title: Taro.getEnterOptionsSync()
sidebar_label: getEnterOptionsSync
---

获取本次小程序启动时的参数。如果当前是冷启动，则返回值与 [`App.onLaunch`](https://developers.weixin.qq.com/miniprogram/dev/reference/api/App.html#onLaunch-Object-object) 的回调参数一致；如果当前是热启动，则返回值与 [`App.onShow`](https://developers.weixin.qq.com/miniprogram/dev/reference/api/App.html#onShow-Object-object) 一致。

**注意**
部分版本在无 `referrerInfo` 的时候会返回 `undefined`，建议使用 `options.referrerInfo && options.referrerInfo.appId` 进行判断。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/life-cycle/wx.getEnterOptionsSync.html)

## 类型

```tsx
() => EnterOptions
```

## 参数

### EnterOptions

启动参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| path | `string` | 是 | 启动小程序的路径 |
| scene | `number` | 是 | 启动小程序的[场景值](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/scene.html) |
| query | `TaroGeneral.IAnyObject` | 是 | 启动小程序的 query 参数 |
| shareTicket | `string` | 是 | shareTicket，详见[获取更多转发信息](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share.html) |
| referrerInfo | `ReferrerInfo` | 是 | 来源信息。从另一个小程序、公众号或 App 进入小程序时返回。否则返回 `{}`。(参见后文注意) |
| forwardMaterials | `ForwardMaterial[]` | 否 | 打开的文件信息数组，只有从聊天素材场景打开（scene为1173）才会携带该参数 |
| chatType | `keyof ChatType` | 否 | 从微信群聊/单聊打开小程序时，chatType 表示具体微信群聊/单聊类型 |
| apiCategory | `keyof ApiCategory` | 否 | API 类别 |

#### ReferrerInfo

来源信息

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| appId | `string` | 否 | 来源小程序、公众号或 App 的 appId |
| extraData | `TaroGeneral.IAnyObject` | 否 | 来源小程序传过来的数据，scene=1037或1038时支持 |

#### ForwardMaterial

ChatType 类型合法值

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `string` | 文件的mimetype类型 |
| name | `string` | 文件名 |
| path | `string` | 文件路径（如果是webview则是url） |
| size | `number` | 文件大小 |

#### ChatType

ChatType 类型合法值

| 参数 | 说明 |
| --- | --- |
| 1 | 微信联系人单聊 |
| 2 | 企业微信联系人单聊 |
| 3 | 普通微信群聊 |
| 4 | 企业微信互通群聊 |

#### ApiCategory

API 类别合法值

| 参数 | 说明 |
| --- | --- |
| default | 默认类别 |
| nativeFunctionalized | 原生功能化，视频号直播商品、商品橱窗等场景打开的小程序 |
| browseOnly | 仅浏览，朋友圈快照页等场景打开的小程序 |
| embedded | 内嵌，通过打开半屏小程序能力打开的小程序 |
</file>

<file path="docs/apis/base/weapp/life-cycle/getLaunchOptionsSync.md">
---
title: Taro.getLaunchOptionsSync()
sidebar_label: getLaunchOptionsSync
---

获取小程序启动时的参数。与 [`App.onLaunch`](https://developers.weixin.qq.com/miniprogram/dev/reference/api/App.html#onlaunchobject-object) 的回调参数一致。

**注意**
部分版本在无`referrerInfo`的时候会返回 `undefined`，建议使用 `options.referrerInfo && options.referrerInfo.appId` 进行判断。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/life-cycle/wx.getLaunchOptionsSync.html)

## 类型

```tsx
() => LaunchOptions
```

## 参数

### LaunchOptions

启动参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| path | `string` | 是 | 启动小程序的路径 |
| query | `TaroGeneral.IAnyObject` | 是 | 启动小程序的 query 参数 |
| scene | `number` | 是 | 启动小程序的[场景值](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/scene.html) |
| shareTicket | `string` | 是 | shareTicket，详见[获取更多转发信息](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share.html) |
| referrerInfo | `ReferrerInfo` | 是 | 来源信息。从另一个小程序、公众号或 App 进入小程序时返回。否则返回 `{}`。(参见后文注意) |
| forwardMaterials | `ForwardMaterial[]` | 否 | 打开的文件信息数组，只有从聊天素材场景打开（scene为1173）才会携带该参数 |
| chatType | `keyof ChatType` | 否 | 从微信群聊/单聊打开小程序时，chatType 表示具体微信群聊/单聊类型 |
| apiCategory | `keyof ApiCategory` | 否 | API 类别 |

#### ReferrerInfo

来源信息

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| appId | `string` | 否 | 来源小程序、公众号或 App 的 appId |
| extraData | `TaroGeneral.IAnyObject` | 否 | 来源小程序传过来的数据，scene=1037或1038时支持 |

#### ForwardMaterial

ChatType 类型合法值

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `string` | 文件的mimetype类型 |
| name | `string` | 文件名 |
| path | `string` | 文件路径（如果是webview则是url） |
| size | `number` | 文件大小 |

#### ChatType

ChatType 类型合法值

| 参数 | 说明 |
| --- | --- |
| 1 | 微信联系人单聊 |
| 2 | 企业微信联系人单聊 |
| 3 | 普通微信群聊 |
| 4 | 企业微信互通群聊 |

#### ApiCategory

API 类别合法值

| 参数 | 说明 |
| --- | --- |
| default | 默认类别 |
| nativeFunctionalized | 原生功能化，视频号直播商品、商品橱窗等场景打开的小程序 |
| browseOnly | 仅浏览，朋友圈快照页等场景打开的小程序 |
| embedded | 内嵌，通过打开半屏小程序能力打开的小程序 |
</file>

<file path="docs/apis/base/arrayBufferToBase64.md">
---
title: Taro.arrayBufferToBase64(buffer)
sidebar_label: arrayBufferToBase64
---

将 ArrayBuffer 数据转成 Base64 字符串。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/wx.arrayBufferToBase64.html)

## 类型

```tsx
(buffer: ArrayBuffer) => string
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| buffer | `ArrayBuffer` | 要转换成 Base64 字符串的 ArrayBuffer 对象 |

## 示例代码

```tsx
const arrayBuffer = new Uint8Array([11, 22, 33])
const base64 = Taro.arrayBufferToBase64(arrayBuffer)
```
</file>

<file path="docs/apis/base/base64ToArrayBuffer.md">
---
title: Taro.base64ToArrayBuffer(base64)
sidebar_label: base64ToArrayBuffer
---

将 Base64 字符串转成 ArrayBuffer 数据。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/wx.base64ToArrayBuffer.html)

## 类型

```tsx
(base64: string) => ArrayBuffer
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| base64 | `string` | 要转化成 ArrayBuffer 对象的 Base64 字符串 |

## 示例代码

```tsx
const base64 = 'CxYh'
const arrayBuffer = Taro.base64ToArrayBuffer(base64)
```
</file>

<file path="docs/apis/base/canIUse.md">
---
title: Taro.canIUse(schema)
sidebar_label: canIUse
---

判断小程序的 API，回调，参数，组件等是否在当前版本可用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/wx.canIUse.html)

## 类型

```tsx
(schema: string) => boolean
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| schema | `string` | 使用 `${API}.${method}.${param}.${option}` 或者 `${component}.${attribute}.${option}` 方式来调用<br /><br />**参数说明**<br /><br />- `${API}` 代表 API 名字<br />- `${method}` 代表调用方式，有效值为return, success, object, callback<br />- `${param}` 代表参数或者返回值<br />- `${option}` 代表参数的可选值或者返回值的属性<br />- `${component}` 代表组件名字<br />- `${attribute}` 代表组件属性<br />- `${option}` 代表组件属性的可选值 |

## 示例代码

```tsx
Taro.canIUse('openBluetoothAdapter')
Taro.canIUse('getSystemInfoSync.return.screenWidth')
Taro.canIUse('getSystemInfo.success.screenWidth')
Taro.canIUse('showToast.object.image')
Taro.canIUse('onCompassChange.callback.direction')
Taro.canIUse('request.object.method.GET')
Taro.canIUse('live-player')
Taro.canIUse('text.selectable')
Taro.canIUse('button.open-type.contact')
```
</file>

<file path="docs/apis/base/canIUseWebp.md">
---
title: Taro.canIUseWebp()
sidebar_label: canIUseWebp
---

判断能否使用 WebP 格式

> 在小程序平台中仅在 android 和 devtools 设备时可用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
() => boolean
```
</file>

<file path="docs/apis/base/env.md">
---
title: env
sidebar_label: env
---

环境变量

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/base/wx.env.html)

## 类型

```tsx
TaroGeneral.IAnyObject
```
</file>

<file path="docs/apis/base/preload.md">
---
title: Taro.preload(options)
sidebar_label: preload
---

跳转预加载 API

## 类型

```tsx
{ (options: Record<string, any>): any; (key: string, value: any): any; }
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| options | `Record<string, any>` | 预加载的数据<br />param: options 预加载的数据 |

## 示例代码

### 示例 1

```tsx
Taro.preload({ key: 'value' })
```

### 示例 2

```tsx
Taro.preload('key', 'value')
```
</file>

<file path="docs/apis/canvas/Canvas.md">
---
title: Canvas
sidebar_label: Canvas
---

Canvas 实例，可通过 SelectorQuery 获取。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Canvas.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| height | `number` | 画布高度 |
| width | `number` | 画布宽度 |

### cancelAnimationFrame

取消由 requestAnimationFrame 添加到计划中的动画帧请求。支持在 2D Canvas 和 WebGL Canvas 下使用, 但不支持混用 2D 和 WebGL 的方法。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Canvas.cancelAnimationFrame.html)

```tsx
(requestID: number) => void
```

| 参数 | 类型 |
| --- | --- |
| requestID | `number` |

### createImageData

创建一个 ImageData 对象。仅支持在 2D Canvas 中使用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Canvas.createImageData.html)

```tsx
() => ImageData
```

### createImage

创建一个图片对象。 支持在 2D Canvas 和 WebGL Canvas 下使用, 但不支持混用 2D 和 WebGL 的方法。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Canvas.createImage.html)

```tsx
() => Image
```

### createPath2D

创建 Path2D 对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Path2D.html)

```tsx
(path: Path2D) => Path2D
```

| 参数 | 类型 |
| --- | --- |
| path | `Path2D` |

### getContext

支持获取 2D 和 WebGL 绘图上下文

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Canvas.getContext.html)

```tsx
(contextType: string) => RenderingContext
```

| 参数 | 类型 |
| --- | --- |
| contextType | `string` |

### requestAnimationFrame

在下次进行重绘时执行。 支持在 2D Canvas 和 WebGL Canvas 下使用, 但不支持混用 2D 和 WebGL 的方法。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Canvas.requestAnimationFrame.html)

```tsx
(callback: (...args: any[]) => any) => number
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(...args: any[]) => any` | 执行的 callback |

### toDataURL

返回一个包含图片展示的 data URI 。可以使用 type 参数其类型，默认为 PNG 格式。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Canvas.toDataURL.html)

```tsx
(type: string, encoderOptions: number) => string
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `string` | 图片格式，默认为 image/png |
| encoderOptions | `number` | 在指定图片格式为 image/jpeg 或 image/webp的情况下，可以从 0 到 1 的区间内选择图片的质量。如果超出取值范围，将会使用默认值 0.92。其他参数会被忽略。 |

### toTempFilePath

把当前画布指定区域保存为图片

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://opendocs.alipay.com/mini/api/toTempFilePath?pathHash=e79fe218)

```tsx
(oprion: Option) => void
```

| 参数 | 类型 |
| --- | --- |
| oprion | `Option` |

## API 支持度

| API | 微信小程序 | 支付宝小程序 | 抖音小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| Canvas.cancelAnimationFrame | ✔️ | ✔️ | ✔️ |  |  |  |
| Canvas.createImageData | ✔️ |  |  |  |  |  |
| Canvas.createImage | ✔️ | ✔️ | ✔️ |  |  |  |
| Canvas.createPath2D | ✔️ |  |  |  |  |  |
| Canvas.getContext | ✔️ | ✔️ | ✔️ |  |  |  |
| Canvas.requestAnimationFrame | ✔️ |  |  |  |  |  |
| Canvas.toDataURL | ✔️ |  |  |  |  |  |
| Canvas.toTempFilePath |  | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/canvas/CanvasContext.md">
---
title: CanvasContext
sidebar_label: CanvasContext
---

canvas 组件的绘图上下文

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fillStyle | `string` | 填充颜色。用法同 [CanvasContext.setFillStyle()]。 |
| strokeStyle | `string` | 边框颜色。用法同 [CanvasContext.setFillStyle()]。 |
| shadowOffsetX | `number` | 阴影相对于形状在水平方向的偏移 |
| shadowOffsetY | `number` | 阴影相对于形状在竖直方向的偏移 |
| shadowBlur | `number` | 阴影的模糊级别 |
| shadowColor | `string` | 阴影的颜色 |
| lineWidth | `number` | 线条的宽度。用法同 [CanvasContext.setLineWidth()]。 |
| lineCap | `keyof LineCap` | 线条的端点样式。用法同 [CanvasContext.setLineCap()]。 |
| lineJoin | `keyof LineJoin` | 线条的交点样式。用法同 [CanvasContext.setLineJoin()]。 |
| miterLimit | `number` | 最大斜接长度。用法同 [CanvasContext.setMiterLimit()]。 |
| lineDashOffset | `number` | 虚线偏移量，初始值为0 |
| font | `string` | 当前字体样式的属性。符合 [CSS font 语法](https://developer.mozilla.org/zh-CN/docs/Web/CSS/font) 的 DOMString 字符串，至少需要提供字体大小和字体族名。默认值为 10px sans-serif。 |
| globalAlpha | `number` | 全局画笔透明度。范围 0-1，0 表示完全透明，1 表示完全不透明。 |
| globalCompositeOperation | `string` | 在绘制新形状时应用的合成操作的类型。目前安卓版本只适用于 `fill` 填充块的合成，用于 `stroke` 线段的合成效果都是 `source-over`。<br /><br />目前支持的操作有<br />- 安卓：xor, source-over, source-atop, destination-out, lighter, overlay, darken, lighten, hard-light<br />- iOS：xor, source-over, source-atop, destination-over, destination-out, lighter, multiply, overlay, darken, lighten, color-dodge, color-burn, hard-light, soft-light, difference, exclusion, saturation, luminosity |

### arc

创建一条弧线。

- 创建一个圆可以指定起始弧度为 0，终止弧度为 2 * Math.PI。
- 用 `stroke` 或者 `fill` 方法来在 `canvas` 中画弧线。

针对 arc(100, 75, 50, 0, 1.5 * Math.PI)的三个关键坐标如下：

- 绿色: 圆心 (100, 75)
- 红色: 起始弧度 (0)
- 蓝色: 终止弧度 (1.5 * Math.PI)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.arc.html)

```tsx
(x: number, y: number, r: number, sAngle: number, eAngle: number, counterclockwise?: boolean, anticlockwise?: boolean) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 圆心的 x 坐标 |
| y | `number` | 圆心的 y 坐标 |
| r | `number` | 圆的半径 |
| sAngle | `number` | 起始弧度，单位弧度（在3点钟方向） |
| eAngle | `number` | 终止弧度 |
| counterclockwise | `boolean` | 弧度的方向是否是逆时针 |
| anticlockwise | `boolean` | 弧度的方向是否是逆时针<br />API 支持度: tt |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
// Draw coordinates
ctx.arc(100, 75, 50, 0, 2 * Math.PI)
ctx.setFillStyle('#EEEEEE')
ctx.fill()
ctx.beginPath()
ctx.moveTo(40, 75)
ctx.lineTo(160, 75)
ctx.moveTo(100, 15)
ctx.lineTo(100, 135)
ctx.setStrokeStyle('#AAAAAA')
ctx.stroke()
ctx.setFontSize(12)
ctx.setFillStyle('black')
ctx.fillText('0', 165, 78)
ctx.fillText('0.5*PI', 83, 145)
ctx.fillText('1*PI', 15, 78)
ctx.fillText('1.5*PI', 83, 10)
// Draw points
ctx.beginPath()
ctx.arc(100, 75, 2, 0, 2 * Math.PI)
ctx.setFillStyle('lightgreen')
ctx.fill()
ctx.beginPath()
ctx.arc(100, 25, 2, 0, 2 * Math.PI)
ctx.setFillStyle('blue')
ctx.fill()
ctx.beginPath()
ctx.arc(150, 75, 2, 0, 2 * Math.PI)
ctx.setFillStyle('red')
ctx.fill()
// Draw arc
ctx.beginPath()
ctx.arc(100, 75, 50, 0, 1.5 * Math.PI)
ctx.setStrokeStyle('#333333')
ctx.stroke()
ctx.draw()
```

### arcTo

根据控制点和半径绘制圆弧路径。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.arcTo.html)

```tsx
(x1: number, y1: number, x2: number, y2: number, radius: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x1 | `number` | 第一个控制点的 x 轴坐标 |
| y1 | `number` | 第一个控制点的 y 轴坐标 |
| x2 | `number` | 第二个控制点的 x 轴坐标 |
| y2 | `number` | 第二个控制点的 y 轴坐标 |
| radius | `number` | 圆弧的半径 |

### beginPath

开始创建一个路径。需要调用 `fill` 或者 `stroke` 才会使用路径进行填充或描边

 - 在最开始的时候相当于调用了一次 `beginPath`。
 - 同一个路径内的多次 `setFillStyle`、`setStrokeStyle`、`setLineWidth`等设置，以最后一次设置为准。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.beginPath.html)

```tsx
() => void
```

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
// begin path
ctx.rect(10, 10, 100, 30)
ctx.setFillStyle('yellow')
ctx.fill()
// begin another path
ctx.beginPath()
ctx.rect(10, 40, 100, 30)
// only fill this rect, not in current path
ctx.setFillStyle('blue')
ctx.fillRect(10, 70, 100, 30)
ctx.rect(10, 100, 100, 30)
// it will fill current path
ctx.setFillStyle('red')
ctx.fill()
ctx.draw()
```

### bezierCurveTo

创建三次方贝塞尔曲线路径。曲线的起始点为路径中前一个点。

针对 moveTo(20, 20) bezierCurveTo(20, 100, 200, 100, 200, 20) 的三个关键坐标如下：

- 红色：起始点(20, 20)
- 蓝色：两个控制点(20, 100) (200, 100)
- 绿色：终止点(200, 20)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.bezierCurveTo.html)

```tsx
(cp1x: number, cp1y: number, cp2x: number, cp2y: number, x: number, y: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| cp1x | `number` | 第一个贝塞尔控制点的 x 坐标 |
| cp1y | `number` | 第一个贝塞尔控制点的 y 坐标 |
| cp2x | `number` | 第二个贝塞尔控制点的 x 坐标 |
| cp2y | `number` | 第二个贝塞尔控制点的 y 坐标 |
| x | `number` | 结束点的 x 坐标 |
| y | `number` | 结束点的 y 坐标 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
// Draw points
ctx.beginPath()
ctx.arc(20, 20, 2, 0, 2 * Math.PI)
ctx.setFillStyle('red')
ctx.fill()
ctx.beginPath()
ctx.arc(200, 20, 2, 0, 2 * Math.PI)
ctx.setFillStyle('lightgreen')
ctx.fill()
ctx.beginPath()
ctx.arc(20, 100, 2, 0, 2 * Math.PI)
ctx.arc(200, 100, 2, 0, 2 * Math.PI)
ctx.setFillStyle('blue')
ctx.fill()
ctx.setFillStyle('black')
ctx.setFontSize(12)
// Draw guides
ctx.beginPath()
ctx.moveTo(20, 20)
ctx.lineTo(20, 100)
ctx.lineTo(150, 75)
ctx.moveTo(200, 20)
ctx.lineTo(200, 100)
ctx.lineTo(70, 75)
ctx.setStrokeStyle('#AAAAAA')
ctx.stroke()
// Draw quadratic curve
ctx.beginPath()
ctx.moveTo(20, 20)
ctx.bezierCurveTo(20, 100, 200, 100, 200, 20)
ctx.setStrokeStyle('black')
ctx.stroke()
ctx.draw()
```

### clearRect

清除画布上在该矩形区域内的内容

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.clearRect.html)

```tsx
(x: number, y: number, width: number, height: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 矩形路径左上角的横坐标 |
| y | `number` | 矩形路径左上角的纵坐标 |
| width | `number` | 矩形路径的宽度 |
| height | `number` | 矩形路径的高度 |

#### 示例代码

clearRect 并非画一个白色的矩形在地址区域，而是清空，为了有直观感受，对 canvas 加了一层背景色。
```html
<canvas canvas-id="myCanvas" style="border: 1px solid; background: #123456;"/>
```
```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.setFillStyle('red')
ctx.fillRect(0, 0, 150, 200)
ctx.setFillStyle('blue')
ctx.fillRect(150, 0, 150, 200)
ctx.clearRect(10, 10, 150, 75)
ctx.draw()
```

### clip

从原始画布中剪切任意形状和尺寸。一旦剪切了某个区域，则所有之后的绘图都会被限制在被剪切的区域内（不能访问画布上的其他区域）。可以在使用 `clip` 方法前通过使用 `save` 方法对当前画布区域进行保存，并在以后的任意时间通过`restore`方法对其进行恢复。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.clip.html)

```tsx
() => void
```

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
Taro.downloadFile({
  url: 'http://is5.mzstatic.com/image/thumb/Purple128/v4/75/3b/90/753b907c-b7fb-5877-215a-759bd73691a4/source/50x50bb.jpg',
  success: function(res) {
    ctx.save()
    ctx.beginPath()
    ctx.arc(50, 50, 25, 0, 2*Math.PI)
    ctx.clip()
    ctx.drawImage(res.tempFilePath, 25, 25)
    ctx.restore()
    ctx.draw()
  }
})
```

### closePath

关闭一个路径。会连接起点和终点。如果关闭路径后没有调用 `fill` 或者 `stroke` 并开启了新的路径，那之前的路径将不会被渲染。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.closePath.html)

```tsx
() => void
```

#### 示例代码

##### 示例 1

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.moveTo(10, 10)
ctx.lineTo(100, 10)
ctx.lineTo(100, 100)
ctx.closePath()
ctx.stroke()
ctx.draw()
```

##### 示例 2

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
// begin path
ctx.rect(10, 10, 100, 30)
ctx.closePath()
// begin another path
ctx.beginPath()
ctx.rect(10, 40, 100, 30)
// only fill this rect, not in current path
ctx.setFillStyle('blue')
ctx.fillRect(10, 70, 100, 30)
ctx.rect(10, 100, 100, 30)
// it will fill current path
ctx.setFillStyle('red')
ctx.fill()
ctx.draw()
```

### createCircularGradient

创建一个圆形的渐变颜色。起点在圆心，终点在圆环。返回的`CanvasGradient`对象需要使用 [CanvasGradient.addColorStop()](/docs/apis/canvas/CanvasGradient#addcolorstop) 来指定渐变点，至少要两个。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.createCircularGradient.html)

```tsx
(x: number, y: number, r: number) => CanvasGradient
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 圆心的 x 坐标 |
| y | `number` | 圆心的 y 坐标 |
| r | `number` | 圆的半径 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
// Create circular gradient
const grd = ctx.createCircularGradient(75, 50, 50)
grd.addColorStop(0, 'red')
grd.addColorStop(1, 'white')
// Fill with gradient
ctx.setFillStyle(grd)
ctx.fillRect(10, 10, 150, 80)
ctx.draw()
```

### createLinearGradient

创建一个线性的渐变颜色。返回的`CanvasGradient`对象需要使用 [CanvasGradient.addColorStop()](/docs/apis/canvas/CanvasGradient#addcolorstop) 来指定渐变点，至少要两个。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.createLinearGradient.html)

```tsx
(x0: number, y0: number, x1: number, y1: number) => CanvasGradient
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x0 | `number` | 起点的 x 坐标 |
| y0 | `number` | 起点的 y 坐标 |
| x1 | `number` | 终点的 x 坐标 |
| y1 | `number` | 终点的 y 坐标 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
// Create linear gradient
const grd = ctx.createLinearGradient(0, 0, 200, 0)
grd.addColorStop(0, 'red')
grd.addColorStop(1, 'white')
// Fill with gradient
ctx.setFillStyle(grd)
ctx.fillRect(10, 10, 150, 80)
ctx.draw()
```

### createPattern

对指定的图像创建模式的方法，可在指定的方向上重复元图像

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.createPattern.html)

```tsx
(image: string, repetition: keyof Repetition) => CanvasPattern | Promise<CanvasPattern>
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| image | `string` | 重复的图像源，仅支持包内路径和临时路径 |
| repetition | `keyof Repetition` | 如何重复图像 |

### draw

将之前在绘图上下文中的描述（路径、变形、样式）画到 canvas 中。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> H5: 第二次调用 draw 前需要等待上一次 draw 调用结束后再调用，否则新的一次 draw 调用栈不会清空而导致结果异常。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.draw.html)

```tsx
(reserve?: boolean, callback?: (...args: any[]) => any, useHardwareAccelerate?: boolean) => void | Promise<void>
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| reserve | `boolean` | 本次绘制是否接着上一次绘制。即 reserve 参数为 false，则在本次调用绘制之前 native 层会先清空画布再继续绘制；若 reserve 参数为 true，则保留当前画布上的内容，本次调用 drawCanvas 绘制的内容覆盖在上面，默认 false。 |
| callback | `(...args: any[]) => any` | 绘制完成后执行的回调函数 |
| useHardwareAccelerate | `boolean` | 是否使用硬件加速<br />API 支持度: jd |

#### 示例代码

##### 示例 1

第二次 draw() reserve 为 true。所以保留了上一次的绘制结果，在上下文设置的 fillStyle 'red' 也变成了默认的 'black'。

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.setFillStyle('red')
ctx.fillRect(10, 10, 150, 100)
ctx.draw(false, () => {
  ctx.fillRect(50, 50, 150, 100)
  ctx.draw(true)
})
```

##### 示例 2

第二次 draw() reserve 为 false。所以没有保留了上一次的绘制结果和在上下文设置的 fillStyle 'red'。

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.setFillStyle('red')
ctx.fillRect(10, 10, 150, 100)
ctx.draw(false, () => {
  ctx.fillRect(50, 50, 150, 100)
  ctx.draw()
})
```

### drawImage

绘制图像到画布

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.drawImage.html)

```tsx
{ (imageResource: string, dx: number, dy: number): void; (imageResource: string, dx: number, dy: number, dWidth: number, dHeight: number): void; (imageResource: string, sx: number, sy: number, sWidth: number, sHeight: number, dx: number, dy: number, dWidth: number, dHeight: number): void; }
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| imageResource | `string` | 所要绘制的图片资源（网络图片要通过 getImageInfo / downloadFile 先下载） |
| sx | `number` | 需要绘制到画布中的，imageResource的矩形（裁剪）选择框的左上角 x 坐标 |
| sy | `number` | 需要绘制到画布中的，imageResource的矩形（裁剪）选择框的左上角 y 坐标 |
| sWidth | `number` | 需要绘制到画布中的，imageResource的矩形（裁剪）选择框的宽度 |
| sHeight | `number` | 需要绘制到画布中的，imageResource的矩形（裁剪）选择框的高度 |
| dx | `number` | imageResource的左上角在目标 canvas 上 x 轴的位置 |
| dy | `number` | imageResource的左上角在目标 canvas 上 y 轴的位置 |
| dWidth | `number` | 在目标画布上绘制imageResource的宽度，允许对绘制的imageResource进行缩放 |
| dHeight | `number` | 在目标画布上绘制imageResource的高度，允许对绘制的imageResource进行缩放 |

#### 示例代码

##### 示例 1

有三个版本的写法：

- drawImage(imageResource, dx, dy)
- drawImage(imageResource, dx, dy, dWidth, dHeight)
- drawImage(imageResource, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight) 从 1.9.0 起支持

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
Taro.chooseImage({
  success: function(res){
    ctx.drawImage(res.tempFilePaths[0], 0, 0, 150, 100)
    ctx.draw()
  }
})
```

##### 示例 2

有三个版本的写法：

- drawImage(imageResource, dx, dy)
- drawImage(imageResource, dx, dy, dWidth, dHeight)
- drawImage(imageResource, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight) 从 1.9.0 起支持

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
Taro.chooseImage({
  success: function(res){
    ctx.drawImage(res.tempFilePaths[0], 0, 0, 150, 100)
    ctx.draw()
  }
})
```

##### 示例 3

有三个版本的写法：

- drawImage(imageResource, dx, dy)
- drawImage(imageResource, dx, dy, dWidth, dHeight)
- drawImage(imageResource, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight) 从 1.9.0 起支持

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
Taro.chooseImage({
  success: function(res){
    ctx.drawImage(res.tempFilePaths[0], 0, 0, 150, 100)
    ctx.draw()
  }
})
```

### fill

对当前路径中的内容进行填充。默认的填充色为黑色。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.fill.html)

```tsx
() => void
```

#### 示例代码

##### 示例 1

如果当前路径没有闭合，fill() 方法会将起点和终点进行连接，然后填充。

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.moveTo(10, 10)
ctx.lineTo(100, 10)
ctx.lineTo(100, 100)
ctx.fill()
ctx.draw()
```

##### 示例 2

fill() 填充的的路径是从 beginPath() 开始计算，但是不会将 fillRect() 包含进去。

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
// begin path
ctx.rect(10, 10, 100, 30)
ctx.setFillStyle('yellow')
ctx.fill()
// begin another path
ctx.beginPath()
ctx.rect(10, 40, 100, 30)
// only fill this rect, not in current path
ctx.setFillStyle('blue')
ctx.fillRect(10, 70, 100, 30)
ctx.rect(10, 100, 100, 30)
// it will fill current path
ctx.setFillStyle('red')
ctx.fill()
ctx.draw()
```

### fillRect

填充一个矩形。用 [`setFillStyle`](/docs/apis/canvas/CanvasContext#setfillstyle) 设置矩形的填充色，如果没设置默认是黑色。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.fillRect.html)

```tsx
(x: number, y: number, width: number, height: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 矩形路径左上角的横坐标 |
| y | `number` | 矩形路径左上角的纵坐标 |
| width | `number` | 矩形路径的宽度 |
| height | `number` | 矩形路径的高度 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.setFillStyle('red')
ctx.fillRect(10, 10, 150, 75)
ctx.draw()
```

### fillText

在画布上绘制被填充的文本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.fillText.html)

```tsx
(text: string, x: number, y: number, maxWidth?: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| text | `string` | 在画布上输出的文本 |
| x | `number` | 绘制文本的左上角 x 坐标位置 |
| y | `number` | 绘制文本的左上角 y 坐标位置 |
| maxWidth | `number` | 需要绘制的最大宽度，可选 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.setFontSize(20)
ctx.fillText('Hello', 20, 20)
ctx.fillText('MINA', 100, 100)
ctx.draw()
```

### lineTo

增加一个新点，然后创建一条从上次指定点到目标点的线。用 `stroke` 方法来画线条

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.lineTo.html)

```tsx
(x: number, y: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 目标位置的 x 坐标 |
| y | `number` | 目标位置的 y 坐标 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.moveTo(10, 10)
ctx.rect(10, 10, 100, 50)
ctx.lineTo(110, 60)
ctx.stroke()
ctx.draw()
```

### measureText

测量文本尺寸信息。目前仅返回文本宽度(width)。同步接口。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.measureText.html)

```tsx
(text: string) => TextMetrics
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| text | `string` | 要测量的文本 |

### moveTo

把路径移动到画布中的指定点，不创建线条。用 `stroke` 方法来画线条

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.moveTo.html)

```tsx
(x: number, y: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 目标位置的 x 坐标 |
| y | `number` | 目标位置的 y 坐标 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.moveTo(10, 10)
ctx.lineTo(100, 10)
ctx.moveTo(10, 50)
ctx.lineTo(100, 50)
ctx.stroke()
ctx.draw()
```

### quadraticCurveTo

创建二次贝塞尔曲线路径。曲线的起始点为路径中前一个点。

针对 moveTo(20, 20) quadraticCurveTo(20, 100, 200, 20) 的三个关键坐标如下：

- 红色：起始点(20, 20)
- 蓝色：控制点(20, 100)
- 绿色：终止点(200, 20)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.quadraticCurveTo.html)

```tsx
(cpx: number, cpy: number, x: number, y: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| cpx | `number` | 贝塞尔控制点的 x 坐标 |
| cpy | `number` | 贝塞尔控制点的 y 坐标 |
| x | `number` | 结束点的 x 坐标 |
| y | `number` | 结束点的 y 坐标 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
// Draw points
ctx.beginPath()
ctx.arc(20, 20, 2, 0, 2 * Math.PI)
ctx.setFillStyle('red')
ctx.fill()
ctx.beginPath()
ctx.arc(200, 20, 2, 0, 2 * Math.PI)
ctx.setFillStyle('lightgreen')
ctx.fill()
ctx.beginPath()
ctx.arc(20, 100, 2, 0, 2 * Math.PI)
ctx.setFillStyle('blue')
ctx.fill()
ctx.setFillStyle('black')
ctx.setFontSize(12)
// Draw guides
ctx.beginPath()
ctx.moveTo(20, 20)
ctx.lineTo(20, 100)
ctx.lineTo(200, 20)
ctx.setStrokeStyle('#AAAAAA')
ctx.stroke()
// Draw quadratic curve
ctx.beginPath()
ctx.moveTo(20, 20)
ctx.quadraticCurveTo(20, 100, 200, 20)
ctx.setStrokeStyle('black')
ctx.stroke()
ctx.draw()
```

### rect

创建一个矩形路径。需要用 [`fill`](/docs/apis/canvas/CanvasContext#fill) 或者 [`stroke`](/docs/apis/canvas/CanvasContext#stroke) 方法将矩形真正的画到 `canvas` 中

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.rect.html)

```tsx
(x: number, y: number, width: number, height: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 矩形路径左上角的横坐标 |
| y | `number` | 矩形路径左上角的纵坐标 |
| width | `number` | 矩形路径的宽度 |
| height | `number` | 矩形路径的高度 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.rect(10, 10, 150, 75)
ctx.setFillStyle('red')
ctx.fill()
ctx.draw()
```

### reset

重置绘图上下文状态

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/reset)

```tsx
() => void
```

### restore

恢复之前保存的绘图上下文

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.restore.html)

```tsx
() => void
```

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
// save the default fill style
ctx.save()
ctx.setFillStyle('red')
ctx.fillRect(10, 10, 150, 100)
// restore to the previous saved state
ctx.restore()
ctx.fillRect(50, 50, 150, 100)
ctx.draw()
```

### rotate

以原点为中心顺时针旋转当前坐标轴。多次调用旋转的角度会叠加。原点可以用 `translate` 方法修改。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.rotate.html)

```tsx
(rotate: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| rotate | `number` | 旋转角度，以弧度计 degrees * Math.PI/180；degrees 范围为 0-360 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.strokeRect(100, 10, 150, 100)
ctx.rotate(20 * Math.PI / 180)
ctx.strokeRect(100, 10, 150, 100)
ctx.rotate(20 * Math.PI / 180)
ctx.strokeRect(100, 10, 150, 100)
ctx.draw()
```

### save

保存绘图上下文。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.save.html)

```tsx
() => void
```

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
// save the default fill style
ctx.save()
ctx.setFillStyle('red')
ctx.fillRect(10, 10, 150, 100)
// restore to the previous saved state
ctx.restore()
ctx.fillRect(50, 50, 150, 100)
ctx.draw()
```

### scale

在调用后，之后创建的路径其横纵坐标会被缩放。多次调用倍数会相乘。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.scale.html)

```tsx
(scaleWidth: number, scaleHeight: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| scaleWidth | `number` | 横坐标缩放的倍数 (1 = 100%，0.5 = 50%，2 = 200%) |
| scaleHeight | `number` | 纵坐标轴缩放的倍数 (1 = 100%，0.5 = 50%，2 = 200%) |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.strokeRect(10, 10, 25, 15)
ctx.scale(2, 2)
ctx.strokeRect(10, 10, 25, 15)
ctx.scale(2, 2)
ctx.strokeRect(10, 10, 25, 15)
ctx.draw()
```

### setFillStyle

设置填充色。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.setFillStyle.html)

```tsx
(color: string | CanvasGradient) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| color | string or CanvasGradient | 填充的颜色，默认颜色为 black。 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.setFillStyle('red')
ctx.fillRect(10, 10, 150, 75)
ctx.draw()
```

### setFontSize

设置字体的字号

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.setFontSize.html)

```tsx
(fontSize: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fontSize | `number` | 字体的字号 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.setFontSize(20)
ctx.fillText('20', 20, 20)
ctx.setFontSize(30)
ctx.fillText('30', 40, 40)
ctx.setFontSize(40)
ctx.fillText('40', 60, 60)
ctx.setFontSize(50)
ctx.fillText('50', 90, 90)
ctx.draw()
```

### setGlobalAlpha

设置全局画笔透明度。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.setGlobalAlpha.html)

```tsx
(alpha: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| alpha | `number` | 透明度。范围 0-1，0 表示完全透明，1 表示完全不透明。 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.setFillStyle('red')
ctx.fillRect(10, 10, 150, 100)
ctx.setGlobalAlpha(0.2)
ctx.setFillStyle('blue')
ctx.fillRect(50, 50, 150, 100)
ctx.setFillStyle('yellow')
ctx.fillRect(100, 100, 150, 100)
ctx.draw()
```

### setLineCap

设置线条的端点样式

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.setLineCap.html)

```tsx
(lineCap: keyof LineCap) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| lineCap | `keyof LineCap` | 线条的结束端点样式 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.beginPath()
ctx.moveTo(10, 10)
ctx.lineTo(150, 10)
ctx.stroke()
ctx.beginPath()
ctx.setLineCap('butt')
ctx.setLineWidth(10)
ctx.moveTo(10, 30)
ctx.lineTo(150, 30)
ctx.stroke()
ctx.beginPath()
ctx.setLineCap('round')
ctx.setLineWidth(10)
ctx.moveTo(10, 50)
ctx.lineTo(150, 50)
ctx.stroke()
ctx.beginPath()
ctx.setLineCap('square')
ctx.setLineWidth(10)
ctx.moveTo(10, 70)
ctx.lineTo(150, 70)
ctx.stroke()
ctx.draw()
```

### setLineDash

设置虚线样式。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.setLineDash.html)

```tsx
(pattern: number[], offset: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| pattern | `number[]` | 一组描述交替绘制线段和间距（坐标空间单位）长度的数字 |
| offset | `number` | 虚线偏移量 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.setLineDash([10, 20], 5);
ctx.beginPath();
ctx.moveTo(0,100);
ctx.lineTo(400, 100);
ctx.stroke();
ctx.draw()
```

### setLineJoin

设置线条的交点样式

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.setLineJoin.html)

```tsx
(lineJoin: keyof LineJoin) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| lineJoin | `keyof LineJoin` | 线条的结束交点样式 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.beginPath()
ctx.moveTo(10, 10)
ctx.lineTo(100, 50)
ctx.lineTo(10, 90)
ctx.stroke()
ctx.beginPath()
ctx.setLineJoin('bevel')
ctx.setLineWidth(10)
ctx.moveTo(50, 10)
ctx.lineTo(140, 50)
ctx.lineTo(50, 90)
ctx.stroke()
ctx.beginPath()
ctx.setLineJoin('round')
ctx.setLineWidth(10)
ctx.moveTo(90, 10)
ctx.lineTo(180, 50)
ctx.lineTo(90, 90)
ctx.stroke()
ctx.beginPath()
ctx.setLineJoin('miter')
ctx.setLineWidth(10)
ctx.moveTo(130, 10)
ctx.lineTo(220, 50)
ctx.lineTo(130, 90)
ctx.stroke()
ctx.draw()
```

### setLineWidth

设置线条的宽度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.setLineWidth.html)

```tsx
(lineWidth: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| lineWidth | `number` | 线条的宽度，单位px |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.beginPath()
ctx.moveTo(10, 10)
ctx.lineTo(150, 10)
ctx.stroke()
ctx.beginPath()
ctx.setLineWidth(5)
ctx.moveTo(10, 30)
ctx.lineTo(150, 30)
ctx.stroke()
ctx.beginPath()
ctx.setLineWidth(10)
ctx.moveTo(10, 50)
ctx.lineTo(150, 50)
ctx.stroke()
ctx.beginPath()
ctx.setLineWidth(15)
ctx.moveTo(10, 70)
ctx.lineTo(150, 70)
ctx.stroke()
ctx.draw()
```

### setMiterLimit

设置最大斜接长度。斜接长度指的是在两条线交汇处内角和外角之间的距离。当 [CanvasContext.setLineJoin()](/docs/apis/canvas/CanvasContext#setlinejoin) 为 miter 时才有效。超过最大倾斜长度的，连接处将以 lineJoin 为 bevel 来显示。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.setMiterLimit.html)

```tsx
(miterLimit: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| miterLimit | `number` | 最大斜接长度 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.beginPath()
ctx.setLineWidth(10)
ctx.setLineJoin('miter')
ctx.setMiterLimit(1)
ctx.moveTo(10, 10)
ctx.lineTo(100, 50)
ctx.lineTo(10, 90)
ctx.stroke()
ctx.beginPath()
ctx.setLineWidth(10)
ctx.setLineJoin('miter')
ctx.setMiterLimit(2)
ctx.moveTo(50, 10)
ctx.lineTo(140, 50)
ctx.lineTo(50, 90)
ctx.stroke()
ctx.beginPath()
ctx.setLineWidth(10)
ctx.setLineJoin('miter')
ctx.setMiterLimit(3)
ctx.moveTo(90, 10)
ctx.lineTo(180, 50)
ctx.lineTo(90, 90)
ctx.stroke()
ctx.beginPath()
ctx.setLineWidth(10)
ctx.setLineJoin('miter')
ctx.setMiterLimit(4)
ctx.moveTo(130, 10)
ctx.lineTo(220, 50)
ctx.lineTo(130, 90)
ctx.stroke()
ctx.draw()
```

### setShadow

设定阴影样式。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.setShadow.html)

```tsx
(offsetX: number, offsetY: number, blur: number, color: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| offsetX | `number` | 阴影相对于形状在水平方向的偏移，默认值为 0。 |
| offsetY | `number` | 阴影相对于形状在竖直方向的偏移，默认值为 0。 |
| blur | `number` | 阴影的模糊级别，数值越大越模糊。范围 0- 100。，默认值为 0。 |
| color | `string` | 阴影的颜色。默认值为 black。 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.setFillStyle('red')
ctx.setShadow(10, 50, 50, 'blue')
ctx.fillRect(10, 10, 150, 75)
ctx.draw()
```

### setStrokeStyle

设置描边颜色。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.setStrokeStyle.html)

```tsx
(color: string | CanvasGradient) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| color | string or CanvasGradient | 描边的颜色，默认颜色为 black。 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.setStrokeStyle('red')
ctx.strokeRect(10, 10, 150, 75)
ctx.draw()
```

### setTextAlign

设置文字的对齐

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.setTextAlign.html)

```tsx
(align: keyof Align) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| align | `keyof Align` | 文字的对齐方式 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.setStrokeStyle('red')
ctx.moveTo(150, 20)
ctx.lineTo(150, 170)
ctx.stroke()
ctx.setFontSize(15)
ctx.setTextAlign('left')
ctx.fillText('textAlign=left', 150, 60)
await ctx.draw(true)
ctx.setTextAlign('center')
ctx.fillText('textAlign=center', 150, 80)
await ctx.draw(true)
ctx.setTextAlign('right')
ctx.fillText('textAlign=right', 150, 100)
await ctx.draw(true)
```

### setTextBaseline

设置文字的竖直对齐

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.setTextBaseline.html)

```tsx
(textBaseline: keyof TextBaseline) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| textBaseline | `keyof TextBaseline` | 文字的竖直对齐方式 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.setStrokeStyle('red')
ctx.moveTo(5, 75)
ctx.lineTo(295, 75)
ctx.stroke()
ctx.setFontSize(20)
ctx.setTextBaseline('top')
ctx.fillText('top', 5, 75)
await ctx.draw(true)
ctx.setTextBaseline('middle')
ctx.fillText('middle', 50, 75)
await ctx.draw(true)
ctx.setTextBaseline('bottom')
ctx.fillText('bottom', 120, 75)
await ctx.draw(true)
ctx.setTextBaseline('normal')
ctx.fillText('normal', 200, 75)
await ctx.draw(true)
```

### setTransform

使用矩阵重新设置（覆盖）当前变换的方法

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.setTransform.html)

```tsx
{ (scaleX: number, skewX: number, skewY: number, scaleY: number, translateX: number, translateY: number): void; (scaleX: number, skewY: number, skewX: number, scaleY: number, translateX: number, translateY: number): void; (scaleX: number, scaleY: number, skewX: number, skewY: number, translateX: number, translateY: ...
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| scaleX | `number` | 水平缩放 |
| skewX | `number` | 水平倾斜 |
| skewY | `number` | 垂直倾斜 |
| scaleY | `number` | 垂直缩放 |
| translateX | `number` | 水平移动 |
| translateY | `number` | 垂直移动 |

### stroke

画出当前路径的边框。默认颜色色为黑色。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.stroke.html)

```tsx
() => void
```

#### 示例代码

##### 示例 1

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.moveTo(10, 10)
ctx.lineTo(100, 10)
ctx.lineTo(100, 100)
ctx.stroke()
ctx.draw()
```

##### 示例 2

stroke() 描绘的的路径是从 beginPath() 开始计算，但是不会将 strokeRect() 包含进去。

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
// begin path
ctx.rect(10, 10, 100, 30)
ctx.setStrokeStyle('yellow')
ctx.stroke()
// begin another path
ctx.beginPath()
ctx.rect(10, 40, 100, 30)
// only stoke this rect, not in current path
ctx.setStrokeStyle('blue')
ctx.strokeRect(10, 70, 100, 30)
ctx.rect(10, 100, 100, 30)
// it will stroke current path
ctx.setStrokeStyle('red')
ctx.stroke()
ctx.draw()
```

### strokeRect

画一个矩形(非填充)。 用 [`setStrokeStyle`](/docs/apis/canvas/CanvasContext#setstrokestyle) 设置矩形线条的颜色，如果没设置默认是黑色。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.strokeRect.html)

```tsx
(x: number, y: number, width: number, height: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 矩形路径左上角的横坐标 |
| y | `number` | 矩形路径左上角的纵坐标 |
| width | `number` | 矩形路径的宽度 |
| height | `number` | 矩形路径的高度 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.setStrokeStyle('red')
ctx.strokeRect(10, 10, 150, 75)
ctx.draw()
```

### strokeText

给定的 (x, y) 位置绘制文本描边的方法

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.strokeText.html)

```tsx
(text: string, x: number, y: number, maxWidth?: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| text | `string` | 要绘制的文本 |
| x | `number` | 文本起始点的 x 轴坐标 |
| y | `number` | 文本起始点的 y 轴坐标 |
| maxWidth | `number` | 需要绘制的最大宽度，可选 |

### transform

使用矩阵多次叠加当前变换的方法
使用矩阵叠加当前变换。矩阵由方法的参数进行描述，可以缩放、旋转、移动和倾斜上下文

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.transform.html)

```tsx
{ (scaleX: number, skewX: number, skewY: number, scaleY: number, translateX: number, translateY: number): void; (scaleX: number, skewY: number, skewX: number, scaleY: number, translateX: number, translateY: number): void; (scaleX: number, scaleY: number, skewX: number, skewY: number, translateX: number, translateY: ...
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| scaleX | `number` | 水平缩放 |
| skewX | `number` | 水平倾斜 |
| skewY | `number` | 垂直倾斜 |
| scaleY | `number` | 垂直缩放 |
| translateX | `number` | 水平移动 |
| translateY | `number` | 垂直移动 |

### translate

对当前坐标系的原点 (0, 0) 进行变换。默认的坐标系原点为页面左上角。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.translate.html)

```tsx
(x: number, y: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 水平坐标平移量 |
| y | `number` | 竖直坐标平移量 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
ctx.strokeRect(10, 10, 150, 100)
ctx.translate(20, 20)
ctx.strokeRect(10, 10, 150, 100)
ctx.translate(20, 20)
ctx.strokeRect(10, 10, 150, 100)
ctx.draw()
```

## 参数

### Repetition

参数 repetition 可选值

| 参数 | 说明 |
| --- | --- |
| repeat | 水平竖直方向都重复 |
| repeat-x | 水平方向重复 |
| repeat-y | 竖直方向重复 |
| no-repeat | 不重复 |

### LineCap

参数 lineCap 可选值

| 参数 | 说明 |
| --- | --- |
| butt | 向线条的每个末端添加平直的边缘。 |
| round | 向线条的每个末端添加圆形线帽。 |
| square | 向线条的每个末端添加正方形线帽。 |

### LineJoin

参数 lineJoin 可选值

| 参数 | 说明 |
| --- | --- |
| bevel | 斜角 |
| round | 圆角 |
| miter | 尖角 |

### Align

参数 align 可选值

| 参数 | 说明 |
| --- | --- |
| left | 左对齐 |
| center | 居中对齐 |
| right | 右对齐 |

### TextBaseline

参数 textBaseline 可选值

| 参数 | 说明 |
| --- | --- |
| top | 顶部对齐<br />API 支持度: weapp, alipay, swan, jd, qq, tt, h5 |
| bottom | 底部对齐<br />API 支持度: weapp, alipay, swan, jd, qq, tt, h5 |
| middle | 居中对齐<br />API 支持度: weapp, alipay, swan, jd, qq, tt, h5 |
| normal | <br />API 支持度: weapp, alipay, swan, jd, qq, tt, h5 |
| hanging | 文本基线为悬挂基线。<br />API 支持度: alipay, tt, h5 |
| alphabetic | 文本基线是标准的字母基线<br />API 支持度: alipay, tt, h5 |
| ideographic | 文字基线是表意字基线。如果字符本身超出了alphabetic 基线，那么ideograhpic基线位置在字符本身的底部。<br />API 支持度: alipay, tt, h5 |

## API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| CanvasContext.arc | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.arcTo | ✔️ |  | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.beginPath | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.bezierCurveTo | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.clearRect | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.clip | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.closePath | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.createCircularGradient | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.createLinearGradient | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.createPattern | ✔️ |  | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.draw | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️(第二次调用 draw 前需要等待上一次 draw 调用结束后再调用，否则新的一次 draw 调用栈不会清空而导致结果异常。) |  |  | ✔️ | ✔️ |
| CanvasContext.drawImage | ✔️ |  |  |  |  |  | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.fill | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.fillRect | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.fillText | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.lineTo | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.measureText | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.moveTo | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.quadraticCurveTo | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.rect | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.reset |  |  |  |  |  |  | ✔️ |  |  | ✔️ |  |
| CanvasContext.restore | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.rotate | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.save | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.scale | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.setFillStyle | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.setFontSize | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.setGlobalAlpha | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.setLineCap | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.setLineDash | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.setLineJoin | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.setLineWidth | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.setMiterLimit | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.setShadow | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.setStrokeStyle | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.setTextAlign | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.setTextBaseline | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.setTransform | ✔️ | ✔️ |  | ✔️ |  | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.stroke | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.strokeRect | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.strokeText | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.transform | ✔️ |  |  | ✔️ |  | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasContext.translate | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
</file>

<file path="docs/apis/canvas/canvasGetImageData.md">
---
title: Taro.canvasGetImageData(option, component)
sidebar_label: canvasGetImageData
---

获取 canvas 区域隐含的像素数据。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.canvasGetImageData.html)

## 类型

```tsx
(option: Option, component?: TaroGeneral.IAnyObject) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| option | `Option` |  |
| component | `TaroGeneral.IAnyObject` | 在自定义组件下，当前组件实例的this，以操作组件内 [canvas](/docs/components/canvas) 组件 |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| canvasId | `string` | 是 | 画布标识，传入 [canvas](/docs/components/canvas) 组件的 `canvas-id` 属性。 |
| height | `number` | 是 | 将要被提取的图像数据矩形区域的高度 |
| width | `number` | 是 | 将要被提取的图像数据矩形区域的宽度 |
| x | `number` | 是 | 将要被提取的图像数据矩形区域的左上角横坐标 |
| y | `number` | 是 | 将要被提取的图像数据矩形区域的左上角纵坐标 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | `Uint8ClampedArray` | 图像像素点数据，一维数组，每四项表示一个像素点的 rgba |
| height | `number` | 图像数据矩形的高度 |
| width | `number` | 图像数据矩形的宽度 |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
Taro.canvasGetImageData({
  canvasId: 'myCanvas',
  x: 0,
  y: 0,
  width: 100,
  height: 100,
  success: function (res) {
    console.log(res.width) // 100
    console.log(res.height) // 100
    console.log(res.data instanceof Uint8ClampedArray) // true
    console.log(res.data.length) // 100 * 100 * 4
  }
})
```
</file>

<file path="docs/apis/canvas/CanvasGradient.md">
---
title: CanvasGradient
sidebar_label: CanvasGradient
---

创建 canvas 的绘图上下文 CanvasContext 对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasGradient.html)

## 方法

### addColorStop

添加颜色的渐变点。小于最小 stop 的部分会按最小 stop 的 color 来渲染，大于最大 stop 的部分会按最大 stop 的 color 来渲染

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasGradient.addColorStop.html)

```tsx
(stop: number, color: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| stop | `number` | 表示渐变中开始与结束之间的位置，范围 0-1。 |
| color | `string` | 渐变点的颜色。 |

#### 示例代码

```tsx
const ctx = Taro.createCanvasContext('myCanvas')
// Create circular gradient
const grd = ctx.createLinearGradient(30, 10, 120, 10)
grd.addColorStop(0, 'red')
grd.addColorStop(0.16, 'orange')
grd.addColorStop(0.33, 'yellow')
grd.addColorStop(0.5, 'green')
grd.addColorStop(0.66, 'cyan')
grd.addColorStop(0.83, 'blue')
grd.addColorStop(1, 'purple')
// Fill with gradient
ctx.setFillStyle(grd)
ctx.fillRect(10, 10, 150, 80)
ctx.draw()
```

## API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| CanvasGradient | ✔️ |  |  |  |  |  |  |  |  | ✔️ |
| CanvasGradient.addColorStop | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
</file>

<file path="docs/apis/canvas/canvasPutImageData.md">
---
title: Taro.canvasPutImageData(option, component)
sidebar_label: canvasPutImageData
---

将像素数据绘制到画布。在自定义组件下，第二个参数传入自定义组件实例 this，以操作组件内 `<canvas>` 组件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.canvasPutImageData.html)

## 类型

```tsx
(option: Option, component?: TaroGeneral.IAnyObject) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| option | `Option` |  |
| component | `TaroGeneral.IAnyObject` | 在自定义组件下，当前组件实例的this，以操作组件内 [canvas](/docs/components/canvas) 组件 |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| canvasId | `string` | 是 | 画布标识，传入 [canvas](/docs/components/canvas) 组件的 canvas-id 属性。 |
| data | `Uint8ClampedArray` | 是 | 图像像素点数据，一维数组，每四项表示一个像素点的 rgba |
| height | `number` | 是 | 源图像数据矩形区域的高度 |
| width | `number` | 是 | 源图像数据矩形区域的宽度 |
| x | `number` | 是 | 源图像数据在目标画布中的位置偏移量（x 轴方向的偏移量） |
| y | `number` | 是 | 源图像数据在目标画布中的位置偏移量（y 轴方向的偏移量） |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
const data = new Uint8ClampedArray([255, 0, 0, 1])
Taro.canvasPutImageData({
  canvasId: 'myCanvas',
  x: 0,
  y: 0,
  width: 1,
  data: data,
  success: function (res) {}
})
```
</file>

<file path="docs/apis/canvas/canvasToTempFilePath.md">
---
title: Taro.canvasToTempFilePath(option, component)
sidebar_label: canvasToTempFilePath
---

把当前画布指定区域的内容导出生成指定大小的图片。在 `draw()` 回调里调用该方法才能保证图片导出成功。

**Bug & Tip：**

1.  `tip`: 在 `draw` 回调里调用该方法才能保证图片导出成功。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.canvasToTempFilePath.html)

## 类型

```tsx
(option: Option, component?: TaroGeneral.IAnyObject) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| option | `Option` |  |
| component | `TaroGeneral.IAnyObject` | 在自定义组件下，当前组件实例的this，以操作组件内 [canvas](/docs/components/canvas) 组件 |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| canvas | `Canvas` |  | 否 | 画布标识，传入 [canvas](/docs/components/canvas) 组件实例 （canvas type="2d" 时使用该属性）。 |
| canvasId | `string` |  | 否 | 画布标识，传入 [canvas](/docs/components/canvas) 组件的 canvas-id |
| quality | `number` |  | 否 | 图片的质量，目前仅对 jpg 有效。取值范围为 (0, 1]，不在范围内时当作 1.0 处理。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| destHeight | `number` |  | 否 | 输出的图片的高度 |
| destWidth | `number` |  | 否 | 输出的图片的宽度 |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| fileType | `keyof FileType` | `"png"` | 否 | 目标文件的类型 |
| height | `number` |  | 否 | 指定的画布区域的高度 |
| success | `(result: SuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |
| width | `number` |  | 否 | 指定的画布区域的宽度 |
| x | `number` |  | 否 | 指定的画布区域的左上角横坐标 |
| y | `number` |  | 否 | 指定的画布区域的左上角纵坐标 |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tempFilePath | `string` | 是 | 生成文件的临时路径 |
| apFilePath | `string` | 否 | 图片路径(本地临时文件)。<br />API 支持度: alipay |
| errMsg | `string` | 是 | 调用结果 |

### FileType

| 参数 | 说明 |
| --- | --- |
| jpg | jpg 图片 |
| png | png 图片 |

### CanvasProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| type | `string` |  | 否 | 指定 canvas 类型，支持 2d 和 webgl |
| canvasId | `string` |  | 否 | canvas 组件的唯一标识符，若指定了 type 则无需再指定该属性 |
| disableScroll | `boolean` | `false` | 否 | 当在 canvas 中移动时且有绑定手势事件时，禁止屏幕滚动以及下拉刷新 |
| onTouchStart | `TaroGeneral.CommonEventFunction` |  | 否 | 手指触摸动作开始 |
| onTouchMove | `TaroGeneral.CommonEventFunction` |  | 否 | 手指触摸后移动 |
| onTouchEnd | `TaroGeneral.CommonEventFunction` |  | 否 | 手指触摸动作结束 |
| onTouchCancel | `TaroGeneral.CommonEventFunction` |  | 否 | 手指触摸动作被打断，如来电提醒，弹窗 |
| onLongTap | `TaroGeneral.CommonEventFunction` |  | 否 | 手指长按 500ms 之后触发，触发了长按事件后进行移动不会触发屏幕的滚动 |
| onError | `TaroGeneral.CommonEventFunction<onErrorEventDetail>` |  | 否 | 当发生错误时触发 error 事件，detail = {errMsg: 'something wrong'} |

#### onErrorEventDetail

| 参数 | 类型 |
| --- | --- |
| errMsg | `string` |

## 示例代码

```tsx
Taro.canvasToTempFilePath({
  x: 100,
  y: 200,
  width: 50,
  height: 50,
  destWidth: 100,
  destHeight: 100,
  canvasId: 'myCanvas',
  success: function (res) {
    console.log(res.tempFilePath)
  }
})
```
</file>

<file path="docs/apis/canvas/Color.md">
---
title: Color
sidebar_label: Color
---

颜色。可以用以下几种方式来表示 canvas 中使用的颜色：

- RGB 颜色： 如 `'rgb(255, 0, 0)'`
- RGBA 颜色：如 `'rgba(255, 0, 0, 0.3)'`
- 16 进制颜色： 如 `'#FF0000'`
- 预定义的颜色： 如 `'red'`

其中预定义颜色有以下148个：
*注意**: Color Name 大小写不敏感

| Color Name           | HEX     |
| -------------------- | ------- |
| AliceBlue            | #F0F8FF |
| AntiqueWhite         | #FAEBD7 |
| Aqua                 | #00FFFF |
| Aquamarine           | #7FFFD4 |
| Azure                | #F0FFFF |
| Beige                | #F5F5DC |
| Bisque               | #FFE4C4 |
| Black                | #000000 |
| BlanchedAlmond       | #FFEBCD |
| Blue                 | #0000FF |
| BlueViolet           | #8A2BE2 |
| Brown                | #A52A2A |
| BurlyWood            | #DEB887 |
| CadetBlue            | #5F9EA0 |
| Chartreuse           | #7FFF00 |
| Chocolate            | #D2691E |
| Coral                | #FF7F50 |
| CornflowerBlue       | #6495ED |
| Cornsilk             | #FFF8DC |
| Crimson              | #DC143C |
| Cyan                 | #00FFFF |
| DarkBlue             | #00008B |
| DarkCyan             | #008B8B |
| DarkGoldenRod        | #B8860B |
| DarkGray             | #A9A9A9 |
| DarkGrey             | #A9A9A9 |
| DarkGreen            | #006400 |
| DarkKhaki            | #BDB76B |
| DarkMagenta          | #8B008B |
| DarkOliveGreen       | #556B2F |
| DarkOrange           | #FF8C00 |
| DarkOrchid           | #9932CC |
| DarkRed              | #8B0000 |
| DarkSalmon           | #E9967A |
| DarkSeaGreen         | #8FBC8F |
| DarkSlateBlue        | #483D8B |
| DarkSlateGray        | #2F4F4F |
| DarkSlateGrey        | #2F4F4F |
| DarkTurquoise        | #00CED1 |
| DarkViolet           | #9400D3 |
| DeepPink             | #FF1493 |
| DeepSkyBlue          | #00BFFF |
| DimGray              | #696969 |
| DimGrey              | #696969 |
| DodgerBlue           | #1E90FF |
| FireBrick            | #B22222 |
| FloralWhite          | #FFFAF0 |
| ForestGreen          | #228B22 |
| Fuchsia              | #FF00FF |
| Gainsboro            | #DCDCDC |
| GhostWhite           | #F8F8FF |
| Gold                 | #FFD700 |
| GoldenRod            | #DAA520 |
| Gray                 | #808080 |
| Grey                 | #808080 |
| Green                | #008000 |
| GreenYellow          | #ADFF2F |
| HoneyDew             | #F0FFF0 |
| HotPink              | #FF69B4 |
| IndianRed            | #CD5C5C |
| Indigo               | #4B0082 |
| Ivory                | #FFFFF0 |
| Khaki                | #F0E68C |
| Lavender             | #E6E6FA |
| LavenderBlush        | #FFF0F5 |
| LawnGreen            | #7CFC00 |
| LemonChiffon         | #FFFACD |
| LightBlue            | #ADD8E6 |
| LightCoral           | #F08080 |
| LightCyan            | #E0FFFF |
| LightGoldenRodYellow | #FAFAD2 |
| LightGray            | #D3D3D3 |
| LightGrey            | #D3D3D3 |
| LightGreen           | #90EE90 |
| LightPink            | #FFB6C1 |
| LightSalmon          | #FFA07A |
| LightSeaGreen        | #20B2AA |
| LightSkyBlue         | #87CEFA |
| LightSlateGray       | #778899 |
| LightSlateGrey       | #778899 |
| LightSteelBlue       | #B0C4DE |
| LightYellow          | #FFFFE0 |
| Lime                 | #00FF00 |
| LimeGreen            | #32CD32 |
| Linen                | #FAF0E6 |
| Magenta              | #FF00FF |
| Maroon               | #800000 |
| MediumAquaMarine     | #66CDAA |
| MediumBlue           | #0000CD |
| MediumOrchid         | #BA55D3 |
| MediumPurple         | #9370DB |
| MediumSeaGreen       | #3CB371 |
| MediumSlateBlue      | #7B68EE |
| MediumSpringGreen    | #00FA9A |
| MediumTurquoise      | #48D1CC |
| MediumVioletRed      | #C71585 |
| MidnightBlue         | #191970 |
| MintCream            | #F5FFFA |
| MistyRose            | #FFE4E1 |
| Moccasin             | #FFE4B5 |
| NavajoWhite          | #FFDEAD |
| Navy                 | #000080 |
| OldLace              | #FDF5E6 |
| Olive                | #808000 |
| OliveDrab            | #6B8E23 |
| Orange               | #FFA500 |
| OrangeRed            | #FF4500 |
| Orchid               | #DA70D6 |
| PaleGoldenRod        | #EEE8AA |
| PaleGreen            | #98FB98 |
| PaleTurquoise        | #AFEEEE |
| PaleVioletRed        | #DB7093 |
| PapayaWhip           | #FFEFD5 |
| PeachPuff            | #FFDAB9 |
| Peru                 | #CD853F |
| Pink                 | #FFC0CB |
| Plum                 | #DDA0DD |
| PowderBlue           | #B0E0E6 |
| Purple               | #800080 |
| RebeccaPurple        | #663399 |
| Red                  | #FF0000 |
| RosyBrown            | #BC8F8F |
| RoyalBlue            | #4169E1 |
| SaddleBrown          | #8B4513 |
| Salmon               | #FA8072 |
| SandyBrown           | #F4A460 |
| SeaGreen             | #2E8B57 |
| SeaShell             | #FFF5EE |
| Sienna               | #A0522D |
| Silver               | #C0C0C0 |
| SkyBlue              | #87CEEB |
| SlateBlue            | #6A5ACD |
| SlateGray            | #708090 |
| SlateGrey            | #708090 |
| Snow                 | #FFFAFA |
| SpringGreen          | #00FF7F |
| SteelBlue            | #4682B4 |
| Tan                  | #D2B48C |
| Teal                 | #008080 |
| Thistle              | #D8BFD8 |
| Tomato               | #FF6347 |
| Turquoise            | #40E0D0 |
| Violet               | #EE82EE |
| Wheat                | #F5DEB3 |
| White                | #FFFFFF |
| WhiteSmoke           | #F5F5F5 |
| Yellow               | #FFFF00 |
| YellowGreen          | #9ACD32 |

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Color.html)
</file>

<file path="docs/apis/canvas/createCanvasContext.md">
---
title: Taro.createCanvasContext(canvasId, component)
sidebar_label: createCanvasContext
---

创建 canvas 的绘图上下文 [CanvasContext](/docs/apis/canvas/CanvasContext) 对象

**Tip**: 需要指定 canvasId，该绘图上下文只作用于对应的 `<canvas/>`；另外，Web 端需要在 `useReady` 回调中执行它，否则会因为底层 canvas 渲染出来之前而去获取 CanvasContext，导致其底层的 context 为 `undefined`，从而不能正常绘图。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.createCanvasContext.html)

## 类型

```tsx
(canvasId: string, component?: TaroGeneral.IAnyObject) => CanvasContext
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| canvasId | `string` | 要获取上下文的 [canvas](/docs/components/canvas) 组件 canvas-id 属性 |
| component | `TaroGeneral.IAnyObject` | 在自定义组件下，当前组件实例的this，表示在这个自定义组件下查找拥有 canvas-id 的 [canvas](/docs/components/canvas) ，如果省略则不在任何自定义组件内查找 |

## 示例代码

```tsx
import { useReady } from '@tarojs/taro'

useReady(() => {
  const context = Taro.createCanvasContext('canvas')
  context.setStrokeStyle("#00ff00")
  context.setLineWidth(5)
  context.rect(0, 0, 200, 200)
  context.stroke()
  context.setStrokeStyle("#ff0000")
  context.setLineWidth(2)
  context.moveTo(160, 100)
  context.arc(100, 100, 60, 0, 2 * Math.PI, true)
  context.moveTo(140, 100)
  context.arc(100, 100, 40, 0, Math.PI, false)
  context.moveTo(85, 80)
  context.arc(80, 80, 5, 0, 2 * Math.PI, true)
  context.moveTo(125, 80)
  context.arc(120, 80, 5, 0, 2 * Math.PI, true)
  context.stroke()
  context.draw()
})
```
</file>

<file path="docs/apis/canvas/createContext.md">
---
title: Taro.createContext(不推荐使用)
sidebar_label: createContext
---


创建并返回绘图上下文。

## API支持度

| API | 微信小程序 | H5 | React Native |
| :-: | :-: | :-: | :-: |
| Taro.createContext | ✔️ |  |  |
</file>

<file path="docs/apis/canvas/createOffscreenCanvas.md">
---
title: Taro.createOffscreenCanvas(options)
sidebar_label: createOffscreenCanvas
---

创建离屏 canvas 实例

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.createOffscreenCanvas.html

有两个版本的写法：

- createOffscreenCanvas(options) 从 2.16.1 起支持
- createOffscreenCanvas(width, height, this) 从 2.7.0 起支持)

## 类型

```tsx
(options: Option) => OffscreenCanvas
```

## 参数

| 参数 | 类型 |
| --- | --- |
| options | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| type | "webgl" or "2d" | `: 'webgl'` | 否 | 创建的离屏 canvas 类型 |
| height | `number` |  | 否 | 画布高度 |
| width | `number` |  | 否 | 画布宽度 |
| compInst | `TaroGeneral.IAnyObject` |  | 否 | 在自定义组件下，当前组件实例的 this，以操作组件内 [canvas](/docs/components/canvas) 组件 |

## 示例代码

```tsx
// 创建离屏 2D canvas 实例
const canvas = Taro.createOffscreenCanvas({type: '2d', width: 300, height: 150})
// 获取 context。注意这里必须要与创建时的 type 一致
const context = canvas.getContext('2d')

// 创建一个图片
const image = canvas.createImage()
// 等待图片加载
await new Promise(resolve => {
  image.onload = resolve
  image.src = IMAGE_URL // 要加载的图片 url
})

// 把图片画到离屏 canvas 上
context.clearRect(0, 0, 300, 150)
context.drawImage(image, 0, 0, 300, 150)

// 获取画完后的数据
const imgData = context.getImageData(0, 0, 300, 150)
```
</file>

<file path="docs/apis/canvas/drawCanvas.md">
---
title: Taro.drawCanvas(不推荐使用)
sidebar_label: drawCanvas
---


使用方式同 [`wx.drawCanvas`](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/draw-canvas.html)。

## API支持度

| API | 微信小程序 | H5 | React Native |
| :-: | :-: | :-: | :-: |
| Taro.drawCanvas | ✔️ |  |  |
</file>

<file path="docs/apis/canvas/Image.md">
---
title: Image
sidebar_label: Image
---

图片对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Image.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| src | `string` | 图片的 URL |
| height | `number` | 图片的真实高度 |
| width | `number` | 图片的真实宽度 |
| referrerPolicy | `string` | origin: 发送完整的referrer; no-referrer: 不发送。<br /><br />格式固定为 https://servicewechat.com/{appid}/{version}/page-frame.html，其中 {appid} 为小程序的 appid，{version} 为小程序的版本号，版本号为 0 表示为开发版、体验版以及审核版本，版本号为 devtools 表示为开发者工具，其余为正式版本<br />API 支持度: weapp |
| onerror | `(...args: any[]) => any` | 图片加载发生错误后触发的回调函数 |
| onload | `(...args: any[]) => any` | 图片加载完成后触发的回调函数 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| Image | ✔️ |  |  |  |
| Image.referrerPolicy | ✔️ |  |  |  |
</file>

<file path="docs/apis/canvas/ImageData.md">
---
title: ImageData
sidebar_label: ImageData
---

ImageData 对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/ImageData.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| width | `number` | 使用像素描述 ImageData 的实际宽度 |
| height | `number` | 使用像素描述 ImageData 的实际高度 |
| data | `Uint8ClampedArray` | 一维数组，包含以 RGBA 顺序的数据，数据使用 0 至 255（包含）的整数表示 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| ImageData | ✔️ |  |  |  |
</file>

<file path="docs/apis/canvas/OffscreenCanvas.md">
---
title: OffscreenCanvas
sidebar_label: OffscreenCanvas
---

离屏 canvas 实例，可通过 Taro.createOffscreenCanvas 创建。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/OffscreenCanvas.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| width | `number` | 画布宽度 |
| height | `number` | 画布高度 |

### createImage

创建一个图片对象。支持在 2D Canvas 和 WebGL Canvas 下使用, 但不支持混用 2D 和 WebGL 的方法

> 注意不允许混用 webgl 和 2d 画布创建的图片对象，使用时请注意尽量使用 canvas 自身的 createImage 创建图片对象。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/OffscreenCanvas.createImage.html)

```tsx
() => Image
```

### getContext

该方法返回 OffscreenCanvas 的绘图上下文

> 当前仅支持获取 WebGL 绘图上下文

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/OffscreenCanvas.getContext.html)

```tsx
(contextType: "webgl" | "2d") => RenderingContext
```

| 参数 | 类型 |
| --- | --- |
| contextType | "webgl" or "2d" |

## API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| OffscreenCanvas | ✔️ |  |  |  |  |  |
| OffscreenCanvas.createImage | ✔️ |  |  |  |  |  |
| OffscreenCanvas.getContext | ✔️ | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/canvas/Path2D.md">
---
title: Path2D
sidebar_label: Path2D
---

Canvas 2D API 的接口 Path2D 用来声明路径，此路径稍后会被CanvasRenderingContext2D 对象使用。CanvasRenderingContext2D 接口的 路径方法 也存在于 Path2D 这个接口中，允许你在 canvas 中根据需要创建可以保留并重用的路径。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Path2D.html)

## 方法

### addPath

添加路径到当前路径。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(path: Path2D) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| path | `Path2D` | 添加的 Path2D 路径 |

### arc

添加一段圆弧路径

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(x: number, y: number, radius: number, startAngle: number, endAngle: number, counterclockwise: boolean) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 圆心横坐标 |
| y | `number` | 圆心纵坐标 |
| radius | `number` | 圆形半径，必须为正数 |
| startAngle | `number` | 圆弧开始角度 |
| endAngle | `number` | 圆弧结束角度 |
| counterclockwise | `boolean` | 是否逆时针绘制。如果传 true, 则会从 endAngle 开始绘制到 startAngle |

### arcTo

通过给定控制点添加一段圆弧路径

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(x1: number, y1: number, x2: number, y2: number, radius: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x1 | `number` | 第一个控制点横坐标 |
| y1 | `number` | 第一个控制点纵坐标 |
| x2 | `number` | 第二个控制点横坐标 |
| y2 | `number` | 第二个控制点纵坐标 |
| radius | `number` | 圆形半径，必须为非负数 |

### bezierCurveTo

添加三次贝塞尔曲线路径

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(cp1x: number, cp1y: number, cp2x: number, cp2y: number, x: number, y: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| cp1x | `number` | 第一个控制点横坐标 |
| cp1y | `number` | 第一个控制点纵坐标 |
| cp2x | `number` | 第二个控制点横坐标 |
| cp2y | `number` | 第二个控制点纵坐标 |
| x | `number` | 结束点横坐标 |
| y | `number` | 结束点纵坐标 |

### closePath

闭合路径到起点

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
() => void
```

### ellipse

添加椭圆弧路径

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(x: number, y: number, radiusX: number, radiusY: number, rotation: number, startAngle: number, endAngle: number, counterclockwise: boolean) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 椭圆圆心横坐标 |
| y | `number` | 椭圆圆心纵坐标 |
| radiusX | `number` | 椭圆长轴半径，必须为非负数 |
| radiusY | `number` | 椭圆短轴半径，必须为非负数 |
| rotation | `number` | 椭圆旋转角度 |
| startAngle | `number` | 圆弧开始角度 |
| endAngle | `number` | 圆弧结束角度 |
| counterclockwise | `boolean` | 是否逆时针绘制。如果传 true, 则会从 endAngle 开始绘制到 startAngle |

### lineTo

添加直线路径

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(x: number, y: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 结束点横坐标 |
| y | `number` | 结束点纵坐标 |

### moveTo

移动路径开始点

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(x: number, y: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 横坐标 |
| y | `number` | 纵坐标 |

### quadraticCurveTo

添加二次贝塞尔曲线路径

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(cpx: number, cpy: number, x: number, y: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| cpx | `number` | 控制点横坐标 |
| cpy | `number` | 控制点纵坐标 |
| x | `number` | 结束点横坐标 |
| y | `number` | 结束点纵坐标 |

### rect

添加方形路径

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(x: number, y: number, width: number, height: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 开始点横坐标 |
| y | `number` | 开始点纵坐标 |
| width | `number` | 方形宽度，正数向右，负数向左 |
| height | `number` | 方形高度，正数向下，负数向上 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| Path2D | ✔️ |  |  |  |  |
| Path2D.addPath | ✔️ |  |  |  |  |
| Path2D.arc | ✔️ |  |  |  |  |
| Path2D.arcTo | ✔️ |  |  |  |  |
| Path2D.bezierCurveTo | ✔️ |  |  |  |  |
| Path2D.closePath | ✔️ |  |  |  |  |
| Path2D.ellipse | ✔️ |  |  |  |  |
| Path2D.lineTo | ✔️ |  |  |  |  |
| Path2D.moveTo | ✔️ |  |  |  |  |
| Path2D.quadraticCurveTo | ✔️ |  |  |  |  |
| Path2D.rect | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/canvas/RenderingContext.md">
---
title: RenderingContext
sidebar_label: RenderingContext
---

Canvas 绘图上下文。

****

- 通过 Canvas.getContext('2d') 接口可以获取 CanvasRenderingContext2D 对象，实现了 [HTML Canvas 2D Context](https://www.w3.org/TR/2dcontext/) 定义的属性、方法。
- 通过 Canvas.getContext('webgl') 或 OffscreenCanvas.getContext('webgl') 接口可以获取 WebGLRenderingContext 对象，实现了 [WebGL 1.0](https://www.khronos.org/registry/webgl/specs/latest/1.0/) 定义的所有属性、方法、常量。
- CanvasRenderingContext2D 的 drawImage 方法 2.10.0 起支持传入通过 SelectorQuery 获取的 video 对象，2.29.0 起支持传入开启了自定义渲染的 LivePusherContext 对象。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/RenderingContext.html)
</file>

<file path="docs/apis/canvas/toTempFilePath.md">
---
title: toTempFilePath
sidebar_label: toTempFilePath
---

## 参数

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| x | `number` |  | 否 | 指定的画布区域的左上角横坐标 |
| y | `number` |  | 否 | 指定的画布区域的左上角纵坐标 |
| width | `number` |  | 否 | 指定的画布区域的宽度 |
| height | `number` |  | 否 | 指定的画布区域的高度 |
| destHeight | `number` |  | 否 | 输出的图片的高度 |
| destWidth | `number` |  | 否 | 输出的图片的宽度 |
| fileType | `keyof FileType` | `"png"` | 否 | 目标文件的类型 |
| quality | `number` |  | 否 | 图片的质量，目前仅对 jpg 有效。取值范围为 (0, 1]，不在范围内时当作 1.0 处理。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### FileType

| 参数 | 说明 |
| --- | --- |
| jpg | jpg 图片 |
| png | png 图片 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempFilePath | `string` | 生成文件的临时路径 |
</file>

<file path="docs/apis/cloud/cloud.md">
---
title: cloud
sidebar_label: cloud
---

云开发 SDK 实例

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/Cloud.html)

## 类型

```tsx
cloud & Cloud
```

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| Cloud | `new (options: IOptions) => Cloud` | 声明新的云开发操作实例<br />API 支持度: weapp<br />example: 声明新的操作实例<br /><br />```tsx<br />const c1 = new Taro.cloud.Cloud({<br />  resourceEnv: '我的某个环境ID',<br />})<br />```<br />example: 资源共享时跨账号访问资源<br /><br />```tsx<br />// 声明<br />const c1 = new Taro.cloud.Cloud({<br />  resourceAppid: '资源方 AppID',<br />  resourceEnv: '我的某个环境ID',<br />})<br />// 等待初始化完成<br />await c1.init()<br /><br />// 然后照常访问指定环境下的资源<br />c1.callFunction({<br /> name: '',<br /> data: {},<br />})<br />```<br />[参考地址](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/utils/Cloud.Cloud.html) |

### init

在调用云开发各 API 前，需先调用初始化方法 init 一次（全局只需一次，多次调用时只有第一次生效）

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/init/client.init.html)

```tsx
(config?: IInitConfig) => void
```

| 参数 | 类型 |
| --- | --- |
| config | `IInitConfig` |

#### 示例代码

```tsx
Taro.cloud.init({
  env: 'test-x1dzi'
})
```

### CloudID

声明字符串为 CloudID（开放数据 ID），该接口传入一个字符串，返回一个 CloudID 特殊对象，将该对象传至云函数可以获取其对应的开放数据。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/open/Cloud.CloudID.html)

```tsx
(cloudID: string) => void
```

| 参数 | 类型 |
| --- | --- |
| cloudID | `string` |

### callFunction

调用云函数

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/functions/Cloud.callFunction.html)

```tsx
{ (param: OQ<CallFunctionParam>): void; (param: RQ<CallFunctionParam>): Promise<CallFunctionResult>; }
```

| 参数 | 类型 |
| --- | --- |
| param | `OQ<CallFunctionParam>` |

#### 示例代码

假设已有一个云函数 add，在小程序端发起对云函数 add 的调用：

```tsx
Taro.cloud.callFunction({
// 要调用的云函数名称
name: 'add',
  // 传递给云函数的event参数
  data: {
    x: 1,
    y: 2,
  }
}).then(res => {
  // output: res.result === 3
}).catch(err => {
  // handle error
})
```

### uploadFile

将本地资源上传至云存储空间，如果上传至同一路径则是覆盖写

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/storage/uploadFile/client.uploadFile.html)

```tsx
{ (param: OQ<UploadFileParam>): Taro.UploadTask; (param: RQ<UploadFileParam>): Promise<UploadFileResult>; }
```

| 参数 | 类型 |
| --- | --- |
| param | `OQ<UploadFileParam>` |

#### 示例代码

##### 示例 1

```tsx
Taro.cloud.uploadFile({
  cloudPath: 'example.png',
  filePath: '', // 文件路径
  success: res => {
    // get resource ID
    console.log(res.fileID)
  },
  fail: err => {
    // handle error
  }
})
```

##### 示例 2

```tsx
Taro.cloud.uploadFile({
  cloudPath: 'example.png',
  filePath: '', // 文件路径
}).then(res => {
  // get resource ID
  console.log(res.fileID)
}).catch(error => {
  // handle error
})
```

### downloadFile

从云存储空间下载文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/storage/downloadFile/client.downloadFile.html)

```tsx
{ (param: OQ<DownloadFileParam>): DownloadTask; (param: RQ<DownloadFileParam>): Promise<DownloadFileResult>; }
```

| 参数 | 类型 |
| --- | --- |
| param | `OQ<DownloadFileParam>` |

#### 示例代码

##### 示例 1

```tsx
Taro.cloud.downloadFile({
  fileID: 'a7xzcb',
  success: res => {
    // get temp file path
    console.log(res.tempFilePath)
  },
  fail: err => {
    // handle error
  }
})
```

##### 示例 2

```tsx
Taro.cloud.downloadFile({
  fileID: 'a7xzcb'
}).then(res => {
  // get temp file path
  console.log(res.tempFilePath)
}).catch(error => {
  // handle error
})
```

### getTempFileURL

用云文件 ID 换取真实链接，公有读的文件获取的链接不会过期，私有的文件获取的链接十分钟有效期。一次最多取 50 个。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/storage/Cloud.getTempFileURL.html)

```tsx
{ (param: OQ<GetTempFileURLParam>): void; (param: RQ<GetTempFileURLParam>): Promise<GetTempFileURLResult>; }
```

| 参数 | 类型 |
| --- | --- |
| param | `OQ<GetTempFileURLParam>` |

#### 示例代码

##### 示例 1

```tsx
Taro.cloud.getTempFileURL({
  fileList: [{
    fileID: 'a7xzcb',
    maxAge: 60 * 60, // one hour
  }]
}).then(res => {
  // get temp file URL
  console.log(res.fileList)
}).catch(error => {
  // handle error
})
```

##### 示例 2

```tsx
Taro.cloud.getTempFileURL({
  fileList: ['cloud://xxx', 'cloud://yyy'],
  success: res => {
    // get temp file URL
    console.log(res.fileList)
  },
  fail: err => {
    // handle error
  }
})
```

### deleteFile

从云存储空间删除文件，一次最多 50 个

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/storage/Cloud.deleteFile.html)

```tsx
{ (param: OQ<DeleteFileParam>): void; (param: RQ<DeleteFileParam>): Promise<DeleteFileResult>; }
```

| 参数 | 类型 |
| --- | --- |
| param | `OQ<DeleteFileParam>` |

#### 示例代码

##### 示例 1

```tsx
.cloud.deleteFile({
  fileList: ['a7xzcb']
}).then(res => {
  // handle success
  console.log(res.fileList)
}).catch(error => {
  // handle error
})
```

##### 示例 2

```tsx
Taro.cloud.deleteFile({
  fileList: ['a7xzcb'],
  success: res => {
    // handle success
    console.log(res.fileList)
  },
  fail: err => {
    // handle error
  },
  complete: res => {
    // ...
  }
})
```

### database

获取数据库实例

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/Cloud.database.html)

```tsx
(config?: IConfig) => Database
```

| 参数 | 类型 |
| --- | --- |
| config | `IConfig` |

#### 示例代码

##### 示例 1

以下调用获取默认环境的数据库的引用：

```tsx
const db = Taro.cloud.database()
```

##### 示例 2

假设有一个环境名为 test-123，用做测试环境，那么可以如下获取测试环境数据库：

```tsx
const testDB = Taro.cloud.database({
  env: 'test-123'
})
```

### callContainer

调用云托管服务

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/container/Cloud.callContainer.html)

```tsx
<R = any, P = any>(params: CallContainerParam<P>) => Promise<CallContainerResult<R>>
```

| 参数 | 类型 |
| --- | --- |
| params | `R` |

#### 示例代码

假设已经初始化了一个叫c1的云开发实例，并发起云托管调用

``` tsx
const r = await c1.callContainer({
  path: '/path/to/container', // 填入容器的访问路径
  method: 'POST',
})
```

## 参数

### CallFunctionResult

云函数通用返回

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| result | `any` | 云函数返回的结果 |
| errMsg | `string` | 调用结果 |

### IApiParam

云函数通用参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| config | `IConfig` | 否 | 配置 |
| success | `(res: T) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(err: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(val: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### IInitConfig

初始化配置

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| env | string or { database?: string; functions?: string; storage?: string; } | 否 | 默认环境配置，传入字符串形式的环境 ID 可以指定所有服务的默认环境，传入对象可以分别指定各个服务的默认环境 |
| traceUser | `boolean` | 否 | 是否在将用户访问记录到用户管理中，在控制台中可见 |

### IConfig

配置

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| env | `string` | 否 | 使用的环境 ID，填写后忽略 init 指定的环境 |
| traceUser | `boolean` | 否 | 是否在将用户访问记录到用户管理中，在控制台中可见 |

### ICloudAPIParam

云函数 API 通用参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| config | `IConfig` | 否 | 配置 |

### CallFunctionParam

调用云函数参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| name | `string` | 是 | 云函数名 |
| data | `TaroGeneral.IAnyObject` | 否 | 传递给云函数的参数，在云函数中可通过 event 参数获取 |
| slow | `boolean` | 否 |  |
| config | `IConfig` | 否 | 配置 |
| complete | `(res: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: CallFunctionResult) => void` | 否 | 接口调用成功的回调函数 |

### UploadFileResult

上传文件结果

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fileID | `string` | 文件 ID |
| statusCode | `number` | 服务器返回的 HTTP 状态码 |
| errMsg | `string` | 调用结果 |

### UploadFileParam

上传文件参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| cloudPath | `string` | 是 | 云存储路径，命名限制见[文件名命名限制](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/guide/storage/naming.html) |
| filePath | `string` | 是 | 要上传文件资源的路径 |
| header | `TaroGeneral.IAnyObject` | 否 |  |
| config | `IConfig` | 否 | 配置 |
| complete | `(res: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: UploadFileResult) => void` | 否 | 接口调用成功的回调函数 |

### DownloadFileResult

下载文件结果

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempFilePath | `string` | 临时文件路径 |
| statusCode | `number` | 服务器返回的 HTTP 状态码 |
| errMsg | `string` | 调用结果 |

### DownloadFileParam

下载文件参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| fileID | `string` | 是 | 云文件 ID |
| cloudPath | `string` | 否 |  |
| config | `IConfig` | 否 | 配置 |
| complete | `(res: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: DownloadFileResult) => void` | 否 | 接口调用成功的回调函数 |

### GetTempFileURLResult

获取临时文件结果

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fileList | `GetTempFileURLResultItem[]` | 文件列表 |
| errMsg | `string` | 调用结果 |

### GetTempFileURLResultItem

临时文件列表

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fileID | `string` | 云文件 ID |
| tempFileURL | `string` | 临时文件路径 |
| maxAge | `number` |  |
| status | `number` | 状态码 |
| errMsg | `string` | 调用结果 |

### GetTempFileURLParam

获取临时文件参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| fileList | `string[]` | 是 |  |
| config | `IConfig` | 否 | 配置 |
| complete | `(res: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: GetTempFileURLResult) => void` | 否 | 接口调用成功的回调函数 |

### DeleteFileResult

删除文件结果

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fileList | `DeleteFileResultItem[]` | 文件列表 |
| errMsg | `string` | 调用结果 |

### DeleteFileResultItem

删除文件列表

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fileID | `string` | 云文件 ID |
| status | `number` | 状态码 |
| errMsg | `string` | 调用结果 |

### DeleteFileParam

删除文件参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| fileList | `string[]` | 是 | 文件列表 |
| config | `IConfig` | 否 | 配置 |
| complete | `(res: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: DeleteFileResult) => void` | 否 | 接口调用成功的回调函数 |

### IOptions

新建云开发操作实例

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| resourceAppid | `string` | 否 | 资源方 AppID, 不填则表示已登录的当前账号（如小程序中） |
| resourceEnv | `string` | 是 | 资源方云环境 ID |

### CallContainerParam

调用云托管参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| path | `string` | 是 | 服务路径 |
| method | string or number or symbol | 否 | HTTP请求方法，默认 GET |
| data | `P` | 否 | 请求数据 |
| header | `TaroGeneral.IAnyObject` | 否 | 设置请求的 header，header 中不能设置 Referer。content-type 默认为 application/json |
| timeout | `number` | 否 | 超时时间，单位为毫秒 |
| dataType | `request.DataType` | 否 | 返回的数据格式 |
| responseType | "text" or "arraybuffer" | 否 | 响应的数据类型 |
| complete | `(res: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: CallFunctionResult) => void` | 否 | 接口调用成功的回调函数 |

### CallContainerResult

调用云托管返回值

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `R` | 是 | 开发者云托管服务返回的数据 |
| header | `TaroGeneral.IAnyObject` | 是 | 开发者云托管返回的 HTTP Response Header |
| statusCode | `number` | 是 | 开发者云托管服务返回的 HTTP 状态码 |
| cookies | `TaroGeneral.IAnyObject` | 否 | 开发者云托管返回的 cookies，格式为字符串数组，仅小程序端有此字段 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| cloud.init | ✔️ |  |  |  |  |
| cloud.callFunction | ✔️ |  |  |  |  |
| cloud.uploadFile | ✔️ |  |  |  |  |
| cloud.downloadFile | ✔️ |  |  |  |  |
| cloud.getTempFileURL | ✔️ |  |  |  |  |
| cloud.deleteFile | ✔️ |  |  |  |  |
| cloud.database | ✔️ |  |  |  |  |
| cloud.Cloud | ✔️ |  |  |  |  |
| cloud.callContainer | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/cloud/DB.md">
---
title: DB
sidebar_label: DB
---

## 参数

### Database

云开发 SDK 数据库实例

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Database.html)

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| config | `IConfig` | 数据库配置 |
| command | `Command` | 数据库操作符，通过 db.command 获取<br />API 支持度: weapp<br />[参考地址](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Command.html) |
| Geo | `IGeo` | 数据库地理位置结构集<br />API 支持度: weapp<br />[参考地址](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Geo.html) |

#### serverDate

构造一个服务端时间的引用。可用于查询条件、更新字段值或新增记录时的字段值。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Database.serverDate.html)

```tsx
(options?: IOptions) => ServerDate
```

| 参数 | 类型 |
| --- | --- |
| options | `IOptions` |

##### 示例代码

新增记录时设置字段为服务端时间：

```tsx
db.collection('todos').add({
  description: 'eat an apple',
  createTime: db.serverDate()
})
```
更新字段为服务端时间往后一小时：

```tsx
db.collection('todos').doc('my-todo-id').update({
  due: db.serverDate({
    offset: 60 * 60 * 1000
  })
})
```

#### RegExp

构造正则表达式，仅需在普通 js 正则表达式无法满足的情况下使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Database.RegExp.html)

```tsx
(options: IRegExpOptions) => IRegExp
```

| 参数 | 类型 |
| --- | --- |
| options | `IRegExpOptions` |

##### 示例代码

```tsx
// 原生 JavaScript 对象
db.collection('todos').where({
  description: /miniprogram/i
})

// 数据库正则对象
db.collection('todos').where({
  description: db.RegExp({
    regexp: 'miniprogram',
    options: 'i',
  })
})

// 用 new 构造也是可以的
db.collection('todos').where({
  description: new db.RegExp({
    regexp: 'miniprogram',
    options: 'i',
  })
})
```

#### collection

获取集合的引用。方法接受一个 `name` 参数，指定需引用的集合名称。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Database.collection.html)

```tsx
(collectionName: string) => Collection
```

| 参数 | 类型 |
| --- | --- |
| collectionName | `string` |

##### 示例代码

```tsx
const db = Taro.cloud.database()
const todosCollection = db.collection('todos')
```

#### ServerDate

可用于查询条件、更新字段值或新增记录时的字段值。

| 参数 | 类型 |
| --- | --- |
| options | `IOptions` |

##### IOptions

| 参数 | 类型 |
| --- | --- |
| offset | `number` |

#### IRegExp

构造正则表达式

| 参数 | 类型 |
| --- | --- |
| regexp | `string` |
| options | `string` |

##### IRegExpOptions

| 参数 | 类型 | 必填 |
| --- | --- | :---: |
| regexp | `string` | 是 |
| options | `string` | 否 |

#### InternalSymbol

内部符号

### Collection

数据库集合引用

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Collection.html)

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| collectionName | `string` | 集合名称 |
| database | `Database` | 集合所在数据库引用 |

#### doc

获取集合中指定记录的引用。方法接受一个 `id` 参数，指定需引用的记录的 `_id`。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.doc.html)

```tsx
(docId: string | number) => Document
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| docId | string or number | 记录 _id |

##### 示例代码

```tsx
const myTodo = db.collection('todos').doc('my-todo-id')
```

#### aggregate

发起聚合操作，定义完聚合流水线阶段之后需调用 end 方法标志结束定义并实际发起聚合操作

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.aggregate.html)

```tsx
() => Aggregate
```

##### 示例代码

###### 示例 1

```tsx
const $ = db.command.aggregate
db.collection('books').aggregate()
  .group({
    // 按 category 字段分组
    _id: '$category',
    // 让输出的每组记录有一个 avgSales 字段，其值是组内所有记录的 sales 字段的平均值
    avgSales: $.avg('$sales')
  })
  .end()
  .then(res => console.log(res))
  .catch(err => console.error(err))
```

###### 示例 2

```tsx
const $ = db.command.aggregate
db.collection('books').aggregate()
  .group({
    // 按 category 字段分组
    _id: '$category',
    // 让输出的每组记录有一个 avgSales 字段，其值是组内所有记录的 sales 字段的平均值
    avgSales: $.avg('$sales')
  })
  .end({
    success: function(res) {
      console.log(res)
    },
    fail: function(err) {
      console.error(err)
    }
  })
```

#### where

指定查询条件，返回带新查询条件的新的集合引用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.where.html)

```tsx
(condition: IQueryCondition) => Collection
```

| 参数 | 类型 |
| --- | --- |
| condition | `IQueryCondition` |

##### 示例代码

```tsx
const _ = db.command
const result = await db.collection('todos').where({
  price: _.lt(100)
}).get()
```

#### limit

指定查询结果集数量上限

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.limit.html)

```tsx
(value: number) => Collection
```

| 参数 | 类型 |
| --- | --- |
| value | `number` |

##### 示例代码

```tsx
db.collection('todos').limit(10)
  .get()
  .then(console.log)
  .catch(console.error)
```

#### orderBy

指定查询排序条件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.orderBy.html)

```tsx
(fieldPath: string, string: "asc" | "desc") => Collection
```

| 参数 | 类型 |
| --- | --- |
| fieldPath | `string` |
| string | "asc" or "desc" |

##### 示例代码

按一个字段排序：按进度排升序取待办事项

```tsx
db.collection('todos').orderBy('progress', 'asc')
  .get()
  .then(console.log)
  .catch(console.error)
```

按多个字段排序：先按 progress 排降序（progress 越大越靠前）、再按 description 排升序（字母序越前越靠前）取待办事项

```tsx
db.collection('todos')
  .orderBy('progress', 'desc')
  .orderBy('description', 'asc')
  .get()
  .then(console.log)
  .catch(console.error)
```

#### skip

指定查询返回结果时从指定序列后的结果开始返回，常用于分页

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.skip.html)

```tsx
(offset: number) => Collection
```

| 参数 | 类型 |
| --- | --- |
| offset | `number` |

##### 示例代码

```tsx
db.collection('todos').skip(10)
  .get()
  .then(console.log)
  .catch(console.error)
```

#### field

指定返回结果中记录需返回的字段

**说明**

方法接受一个必填对象用于指定需返回的字段，对象的各个 key 表示要返回或不要返回的字段，value 传入 true|false（或 1|-1）表示要返回还是不要返回。
如果指定的字段是数组字段，还可以用以下方法只返回数组的第一个元素：在该字段 key 后面拼接上 `.$` 成为 `字段.$` 的形式。
如果指定的字段是数组字段，还可以用 `db.command.project.slice` 方法返回数组的子数组：
方法既可以接收一个正数表示返回前 n 个元素，也可以接收一个负数表示返回后 n 个元素；还可以接收一个包含两个数字 `[ skip, limit ]` 的数组，如果 `skip` 是正数，表示跳过 `skip` 个元素后再返回接下来的 `limit` 个元素，如果 `skip` 是负数，表示从倒数第 `skip` 个元素开始，返回往后数的 `limit` 个元素

- 返回数组的前 5 个元素：`{ tags: db.command.project.slice(5) }`
- 返回数组的后 5 个元素：`{ tags: db.command.project.slice(-5) }`
- 跳过前 5 个元素，返回接下来 10 个元素：`{ tags: db.command.project.slice(5, 10) }`
- 从倒数第 5 个元素开始，返回接下来正方向数的 10 个元素：`{ tags: db.command.project.slice(-5, 10) }`

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.field.html)

```tsx
(object: TaroGeneral.IAnyObject) => Collection
```

| 参数 | 类型 |
| --- | --- |
| object | `TaroGeneral.IAnyObject` |

##### 示例代码

返回 description, done 和 progress 三个字段：

```tsx
db.collection('todos').field({
  description: true,
  done: true,
  progress: true,
  // 只返回 tags 数组前 3 个元素
  tags: db.command.project.slice(3),
})
  .get()
  .then(console.log)
  .catch(console.error)
```

#### get

获取集合数据，或获取根据查询条件筛选后的集合数据。

**使用说明**

统计集合记录数或统计查询语句对应的结果记录数

小程序端与云函数端的表现会有如下差异：

- 小程序端：如果没有指定 limit，则默认且最多取 20 条记录。
- 云函数端：如果没有指定 limit，则默认且最多取 100 条记录。

如果没有指定 skip，则默认从第 0 条记录开始取，skip 常用于分页。

如果需要取集合中所有的数据，仅在数据量不大且在云函数中时

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.get.html)

```tsx
() => Promise<IQueryResult>
```

##### 示例代码

```tsx
const db = Taro.cloud.database()
db.collection('todos').where({
  _openid: 'xxx' // 填入当前用户 openid
}).get().then(res => {
  console.log(res.data)
})
```

#### count

统计匹配查询条件的记录的条数

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.count.html)

```tsx
() => Promise<ICountResult>
```

##### 示例代码

###### 示例 1

```tsx
const db = Taro.cloud.database()
db.collection('todos').where({
  _openid: 'xxx' // 填入当前用户 openid
}).count().then(res => {
  console.log(res.total)
})
```

###### 示例 2

```tsx
const db = Taro.cloud.database()
db.collection('todos').where({
  _openid: 'xxx' // 填入当前用户 openid
}).count({
  success: function(res) {
    console.log(res.total)
  },
  fail: console.error
})
```

#### add

新增记录，如果传入的记录对象没有 _id 字段，则由后台自动生成 _id；若指定了 _id，则不能与已有记录冲突

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.add.html)

```tsx
{ (options: OQ<IAddDocumentOptions>): void; (options: RQ<IAddDocumentOptions>): Promise<IAddResult>; }
```

| 参数 | 类型 |
| --- | --- |
| options | `OQ<IAddDocumentOptions>` |

##### 示例代码

###### 示例 1

```tsx
db.collection('todos').add({
  // data 字段表示需新增的 JSON 数据
  data: {
    description: "learn cloud database",
    due: new Date("2018-09-01"),
    tags: [
      "cloud",
      "database"
    ],
    location: new db.Geo.Point(113, 23),
    done: false
  }
})
.then(res => {
  console.log(res)
})
.catch(console.error)
```

###### 示例 2

```tsx
db.collection('todos').add({
  // data 字段表示需新增的 JSON 数据
  data: {
    // _id: 'todo-identifiant-aleatoire', // 可选自定义 _id，在此处场景下用数据库自动分配的就可以了
    description: "learn cloud database",
    due: new Date("2018-09-01"),
    tags: [
      "cloud",
      "database"
    ],
    // 为待办事项添加一个地理位置（113°E，23°N）
    location: new db.Geo.Point(113, 23),
    done: false
  },
  success: function(res) {
    // res 是一个对象，其中有 _id 字段标记刚创建的记录的 id
    console.log(res)
  },
  fail: console.error,
  complete: cosnole.log
})
```

#### watch

监听集合中符合查询条件的数据的更新事件。注意使用 watch 时，只有 where 语句会生效，orderBy、limit 等不生效。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.watch.html)

```tsx
(options: IWatchDocumentOptions) => IWatcher
```

| 参数 | 类型 |
| --- | --- |
| options | `IWatchDocumentOptions` |

##### 示例代码

###### 示例 1

根据查询条件监听

```tsx
const db = Taro.cloud.database()
const watcher = db.collection('todos').where({
  _openid: 'xxx' // 填入当前用户 openid
}).watch({
  onChange: function(snapshot) {
    console.log('snapshot', snapshot)
  },
  onError: function(err) {
    console.error('the watch closed because of error', err)
  }
})
```

###### 示例 2

监听一个记录的变化

```tsx
const db = Taro.cloud.database()
const watcher = db.collection('todos').doc('x').watch({
  onChange: function(snapshot) {
    console.log('snapshot', snapshot)
  },
  onError: function(err) {
    console.error('the watch closed because of error', err)
  }
})
```

###### 示例 3

关闭监听

```tsx
const db = Taro.cloud.database()
const watcher = db.collection('todos').where({
  _openid: 'xxx' // 填入当前用户 openid
}).watch({
  onChange: function(snapshot) {
    console.log('snapshot', snapshot)
  },
  onError: function(err) {
    console.error('the watch closed because of error', err)
  }
})
// ...
// 关闭
await watcher.close()
```

### Document

数据库记录引用

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Document.html)

#### get

获取记录数据，或获取根据查询条件筛选后的记录数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/document/Document.get.html)

```tsx
{ (options: OQ<IDBAPIParam>): void; (options: RQ<IDBAPIParam>): Promise<IQuerySingleResult>; }
```

| 参数 | 类型 |
| --- | --- |
| options | `OQ<IDBAPIParam>` |

##### 示例代码

###### 示例 1

```tsx
const db = Taro.cloud.database()
db.collection('todos').doc('<some-todo-id>').get().then(res => {
  console.log(res.data)
})
```

###### 示例 2

```tsx
const db = Taro.cloud.database()
db.collection('todos').doc('<some-todo-id>').get({
  success: function(res) {
    console.log(res.data)
  },
  fail: console.error
})
```

#### set

替换更新一条记

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/document/Document.set.html)

```tsx
{ (options: OQ<ISetSingleDocumentOptions>): void; (options: RQ<ISetSingleDocumentOptions>): Promise<ISetResult>; }
```

| 参数 | 类型 |
| --- | --- |
| options | `OQ<ISetSingleDocumentOptions>` |

##### 示例代码

###### 示例 1

```tsx
const _ = db.command
db.collection('todos').doc('todo-identifiant-aleatoire').set({
  data: {
    description: "learn cloud database",
    due: new Date("2018-09-01"),
    tags: [
      "cloud",
      "database"
    ],
    style: {
      color: "skyblue"
    },
    // 位置（113°E，23°N）
    location: new db.Geo.Point(113, 23),
    done: false
  }
}).then(res => {
  console.log(res)
}).catch(err => {
  console.error(err)
})
```

###### 示例 2

```tsx
const _ = db.command
db.collection('todos').doc('todo-identifiant-aleatoire').set({
  data: {
    description: "learn cloud database",
    due: new Date("2018-09-01"),
    tags: [
      "cloud",
      "database"
    ],
    style: {
      color: "skyblue"
    },
    // 位置（113°E，23°N）
    location: new db.Geo.Point(113, 23),
    done: false
  },
  success: function(res) {
    console.log(res.data)
  },
  fail: console.error
})
```

#### update

更新一条记录

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/document/Document.update.html)

```tsx
{ (options: OQ<IUpdateSingleDocumentOptions>): void; (options: RQ<IUpdateSingleDocumentOptions>): Promise<...>; }
```

| 参数 | 类型 |
| --- | --- |
| options | `OQ<IUpdateSingleDocumentOptions>` |

##### 示例代码

###### 示例 1

```tsx
db.collection('todos').doc('todo-identifiant-aleatoire').update({
  // data 传入需要局部更新的数据
  data: {
    // 表示将 done 字段置为 true
    done: true
  }
})
.then(console.log)
.catch(console.error)
```

###### 示例 2

db.collection('todos').doc('todo-identifiant-aleatoire').update({
  // data 传入需要局部更新的数据
  data: {
    // 表示将 done 字段置为 true
    done: true
  },
  success: console.log,
  fail: console.error
})
```

#### remove

删除一条记录

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/document/Document.remove.html)

```tsx
{ (options: OQ<IDBAPIParam>): void; (options: RQ<IDBAPIParam>): Promise<IRemoveResult>; }
```

| 参数 | 类型 |
| --- | --- |
| options | `OQ<IDBAPIParam>` |

##### 示例代码

###### 示例 1

```tsx
db.collection('todos').doc('todo-identifiant-aleatoire').remove()
  .then(console.log)
  .catch(console.error)
```

###### 示例 2

```tsx
db.collection('todos').doc('todo-identifiant-aleatoire').remove({
  success: console.log,
  fail: console.error
})
```

#### DocumentId

记录 ID

#### IDocumentData

记录结构

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| _id | `DocumentId` | 否 | 新增的记录 _id |
| __index | `__index` | 是 |  |

#### IDBAPIParam

数据库 API 通用参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| config | `IConfig` | 否 | 配置 |
| success | `(res: T) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(err: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(val: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

#### IAddDocumentOptions

新增记录的定义

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `IDocumentData` | 是 | 新增记录的定义 |
| config | `IConfig` | 否 | 配置 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### IWatchDocumentOptions

监听集合中符合查询条件的数据的更新事件

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| onChange | `(res: TaroGeneral.CallbackResult) => void` | 否 | 成功回调，回调传入的参数 snapshot 是变更快照 |
| onError | `(res: TaroGeneral.CallbackResult) => void` | 否 | 失败回调 |

#### ISnapshot

变更快照

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| docChanges | `ChangeEvent[]` | 更新事件数组 |
| docs | `TaroGeneral.IAnyObject[]` | 数据快照，表示此更新事件发生后查询语句对应的查询结果 |
| type | `string` | 快照类型，仅在第一次初始化数据时有值为 init |
| id | `number` | 变更事件 id |

#### ChangeEvent

更新事件

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `number` | 更新事件 id |
| queueType | `keyof QueueType` | 列表更新类型，表示更新事件对监听列表的影响，枚举值 |
| dataType | `keyof DataType` | 数据更新类型，表示记录的具体更新类型，枚举值 |
| docId | `string` | 更新的记录 id |
| doc | `TaroGeneral.IAnyObject` | 更新的完整记录 |
| updatedFields | `TaroGeneral.IAnyObject` | 所有更新的字段及字段更新后的值，`key` 为更新的字段路径，`value` 为字段更新后的值，仅在 `update` 操作时有此信息 |
| removedFields | `string[]` | 所有被删除的字段，仅在 `update` 操作时有此信息 |

#### QueueType

列表更新类型，表示更新事件对监听列表的影响，枚举值

| 参数 | 说明 |
| --- | --- |
| init | 初始化列表 |
| update | 列表中的记录内容有更新，但列表包含的记录不变 |
| enqueue | 记录进入列表 |
| dequeue | 记录离开列表 |

#### DataType

数据更新类型，表示记录的具体更新类型，枚举值

| 参数 | 说明 |
| --- | --- |
| init | 初始化列表 |
| update | 记录内容更新，对应 `update` 操作 |
| replace | 记录内容被替换，对应 `set` 操作 |
| add | 记录新增，对应 `add` 操作 |
| remove | 记录被删除，对应 `remove` 操作 |

#### IWatcher

##### close

关闭监听，无需参数，返回 Promise，会在关闭完成时 resolve

```tsx
() => Promise<any>
```

#### IGetDocumentOptions

获取记录参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| config | `IConfig` | 否 | 配置 |
| success | `(res: T) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(err: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(val: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

#### ICountDocumentOptions

获取记录条数参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| config | `IConfig` | 否 | 配置 |
| success | `(res: T) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(err: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(val: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

#### IUpdateDocumentOptions

更新记录参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `IUpdateCondition` | 是 |  |
| config | `IConfig` | 否 | 配置 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### IUpdateSingleDocumentOptions

更新单条记录参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `IUpdateCondition` | 是 | 替换记录的定义 |
| config | `IConfig` | 否 | 配置 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### ISetDocumentOptions

替换记录参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `IUpdateCondition` | 是 | 替换记录的定义 |
| config | `IConfig` | 否 | 配置 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### ISetSingleDocumentOptions

替换一条记录参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `IUpdateCondition` | 是 |  |
| config | `IConfig` | 否 | 配置 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### IRemoveDocumentOptions

删除记录参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| query | `IQueryCondition` | 是 |  |
| config | `IConfig` | 否 | 配置 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### IRemoveSingleDocumentOptions

删除一条记录参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| config | `IConfig` | 否 | 配置 |
| success | `(res: T) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(err: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(val: any) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

#### IUpdateCondition

更新记录定义

| 参数 | 类型 |
| --- | --- |
| __index | `__index` |

### Query

数据库 Query 引用

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Query.html)

#### where

指定查询条件，返回带新查询条件的新的集合引用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.where.html)

```tsx
(condition: IQueryCondition) => Query
```

| 参数 | 类型 |
| --- | --- |
| condition | `IQueryCondition` |

##### 示例代码

```tsx
const _ = db.command
const result = await db.collection('todos').where({
  price: _.lt(100)
}).get()
```

#### orderBy

指定查询排序条件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.orderBy.html)

```tsx
(fieldPath: string, order: string) => Query
```

| 参数 | 类型 |
| --- | --- |
| fieldPath | `string` |
| order | `string` |

##### 示例代码

按一个字段排序：按进度排升序取待办事项

```tsx
db.collection('todos').orderBy('progress', 'asc')
  .get()
  .then(console.log)
  .catch(console.error)
```

按多个字段排序：先按 progress 排降序（progress 越大越靠前）、再按 description 排升序（字母序越前越靠前）取待办事项

```tsx
db.collection('todos')
  .orderBy('progress', 'desc')
  .orderBy('description', 'asc')
  .get()
  .then(console.log)
  .catch(console.error)
```

#### limit

指定查询结果集数量上限

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.limit.html)

```tsx
(max: number) => Query
```

| 参数 | 类型 |
| --- | --- |
| max | `number` |

##### 示例代码

```tsx
db.collection('todos').limit(10)
  .get()
  .then(console.log)
  .catch(console.error)
```

#### skip

指定查询返回结果时从指定序列后的结果开始返回，常用于分页

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.skip.html)

```tsx
(offset: number) => Query
```

| 参数 | 类型 |
| --- | --- |
| offset | `number` |

##### 示例代码

```tsx
db.collection('todos').skip(10)
  .get()
  .then(console.log)
  .catch(console.error)
```

#### field

指定返回结果中记录需返回的字段

**说明**

方法接受一个必填对象用于指定需返回的字段，对象的各个 key 表示要返回或不要返回的字段，value 传入 true|false（或 1|-1）表示要返回还是不要返回。
如果指定的字段是数组字段，还可以用以下方法只返回数组的第一个元素：在该字段 key 后面拼接上 `.$` 成为 `字段.$` 的形式。
如果指定的字段是数组字段，还可以用 `db.command.project.slice` 方法返回数组的子数组：
方法既可以接收一个正数表示返回前 n 个元素，也可以接收一个负数表示返回后 n 个元素；还可以接收一个包含两个数字 `[ skip, limit ]` 的数组，如果 `skip` 是正数，表示跳过 `skip` 个元素后再返回接下来的 `limit` 个元素，如果 `skip` 是负数，表示从倒数第 `skip` 个元素开始，返回往后数的 `limit` 个元素

- 返回数组的前 5 个元素：`{ tags: db.command.project.slice(5) }`
- 返回数组的后 5 个元素：`{ tags: db.command.project.slice(-5) }`
- 跳过前 5 个元素，返回接下来 10 个元素：`{ tags: db.command.project.slice(5, 10) }`
- 从倒数第 5 个元素开始，返回接下来正方向数的 10 个元素：`{ tags: db.command.project.slice(-5, 10) }`

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.field.html)

```tsx
(object: TaroGeneral.IAnyObject) => Query
```

| 参数 | 类型 |
| --- | --- |
| object | `TaroGeneral.IAnyObject` |

##### 示例代码

返回 description, done 和 progress 三个字段：

```tsx
db.collection('todos').field({
  description: true,
  done: true,
  progress: true,
  // 只返回 tags 数组前 3 个元素
  tags: db.command.project.slice(3),
})
  .get()
  .then(console.log)
  .catch(console.error)
```

#### get

获取集合数据，或获取根据查询条件筛选后的集合数据。

**使用说明**

统计集合记录数或统计查询语句对应的结果记录数

小程序端与云函数端的表现会有如下差异：

- 小程序端：如果没有指定 limit，则默认且最多取 20 条记录。
- 云函数端：如果没有指定 limit，则默认且最多取 100 条记录。

如果没有指定 skip，则默认从第 0 条记录开始取，skip 常用于分页。

如果需要取集合中所有的数据，仅在数据量不大且在云函数中时

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.get.html)

```tsx
{ (options: OQ<IDBAPIParam>): void; (options: RQ<IDBAPIParam>): Promise<IQueryResult>; }
```

| 参数 | 类型 |
| --- | --- |
| options | `OQ<IDBAPIParam>` |

##### 示例代码

```tsx
const db = Taro.cloud.database()
db.collection('todos').where({
  _openid: 'xxx' // 填入当前用户 openid
}).get().then(res => {
  console.log(res.data)
})
```

#### count

统计匹配查询条件的记录的条数

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.count.html)

```tsx
{ (options: OQ<IDBAPIParam>): void; (options: RQ<IDBAPIParam>): Promise<ICountResult>; }
```

| 参数 | 类型 |
| --- | --- |
| options | `OQ<IDBAPIParam>` |

##### 示例代码

###### 示例 1

```tsx
const db = Taro.cloud.database()
db.collection('todos').where({
  _openid: 'xxx' // 填入当前用户 openid
}).count().then(res => {
  console.log(res.total)
})
```

###### 示例 2

```tsx
const db = Taro.cloud.database()
db.collection('todos').where({
  _openid: 'xxx' // 填入当前用户 openid
}).count({
  success: function(res) {
    console.log(res.total)
  },
  fail: console.error
})
```

#### IQueryCondition

| 参数 | 类型 |
| --- | --- |
| __index | `__index` |

#### IStringQueryCondition

#### IQueryResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | `IDocumentData[]` | 查询的结果数组，数据的每个元素是一个 Object，代表一条记录 |
| errMsg | `string` | 调用结果 |

#### IQuerySingleResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | `IDocumentData` |  |
| errMsg | `string` | 调用结果 |

#### IAddResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| _id | `DocumentId` |  |
| errMsg | `string` | 调用结果 |

#### IUpdateResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| stats | `{ updated: number; }` |  |
| errMsg | `string` | 调用结果 |

#### ISetResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| _id | `DocumentId` |  |
| stats | `{ updated: number; created: number; }` |  |
| errMsg | `string` | 调用结果 |

#### IRemoveResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| stats | `{ removed: number; }` |  |
| errMsg | `string` | 调用结果 |

#### ICountResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| total | `number` | 结果数量 |
| errMsg | `string` | 调用结果 |

### Command

数据库操作符，通过 db.command 获取

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Command.html)

#### eq

查询筛选条件，表示字段等于某个值。eq 指令接受一个字面量 (literal)，可以是 number, boolean, string, object, array, Date。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.eq.html)

```tsx
(val: any) => DatabaseQueryCommand
```

#### neq

查询筛选条件，表示字段不等于某个值。eq 指令接受一个字面量 (literal)，可以是 number, boolean, string, object, array, Date。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.neq.html)

```tsx
(val: any) => DatabaseQueryCommand
```

#### gt

查询筛选操作符，表示需大于指定值。可以传入 Date 对象用于进行日期比较。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.gt.html)

```tsx
(val: any) => DatabaseQueryCommand
```

#### gte

查询筛选操作符，表示需大于或等于指定值。可以传入 Date 对象用于进行日期比较。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.gte.html)

```tsx
(val: any) => DatabaseQueryCommand
```

#### lt

查询筛选操作符，表示需小于指定值。可以传入 Date 对象用于进行日期比较。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.lt.html)

```tsx
(val: any) => DatabaseQueryCommand
```

#### lte

查询筛选操作符，表示需小于或等于指定值。可以传入 Date 对象用于进行日期比较。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.lte.html)

```tsx
(val: any) => DatabaseQueryCommand
```

#### in

查询筛选操作符，表示要求值在给定的数组内。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.in.html)

```tsx
(val: any[]) => DatabaseQueryCommand
```

| 参数 | 类型 |
| --- | --- |
| val | `any[]` |

#### nin

查询筛选操作符，表示要求值不在给定的数组内。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.nin.html)

```tsx
(val: any[]) => DatabaseQueryCommand
```

| 参数 | 类型 |
| --- | --- |
| val | `any[]` |

#### geoNear

按从近到远的顺序，找出字段值在给定点的附近的记录。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.geoNear.html)

```tsx
(options: NearCommandOptions) => DatabaseQueryCommand
```

| 参数 | 类型 |
| --- | --- |
| options | `NearCommandOptions` |

#### geoWithin

找出字段值在指定区域内的记录，无排序。指定的区域必须是多边形（Polygon）或多边形集合（MultiPolygon）。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.geoWithin.html)

```tsx
(options: WithinCommandOptions) => DatabaseQueryCommand
```

| 参数 | 类型 |
| --- | --- |
| options | `WithinCommandOptions` |

#### geoIntersects

找出给定的地理位置图形相交的记录

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.geoIntersects.html)

```tsx
(options: IntersectsCommandOptions) => DatabaseQueryCommand
```

| 参数 | 类型 |
| --- | --- |
| options | `IntersectsCommandOptions` |

#### and

查询操作符，用于表示逻辑 "与" 的关系，表示需同时满足多个查询筛选条件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.and.html)

```tsx
(...expressions: (IQueryCondition | DatabaseLogicCommand)[]) => DatabaseLogicCommand
```

| 参数 | 类型 |
| --- | --- |
| expressions | (IQueryCondition or DatabaseLogicCommand)[] |

#### or

查询操作符，用于表示逻辑 "或" 的关系，表示需同时满足多个查询筛选条件。或指令有两种用法，一是可以进行字段值的 “或” 操作，二是也可以进行跨字段的 “或” 操作。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.or.html)

```tsx
(...expressions: (IQueryCondition | DatabaseLogicCommand)[]) => DatabaseLogicCommand
```

| 参数 | 类型 |
| --- | --- |
| expressions | (IQueryCondition or DatabaseLogicCommand)[] |

#### set

查询操作符，用于表示逻辑 "与" 的关系，表示需同时满足多个查询筛选条件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.set.html)

```tsx
(val: any) => DatabaseUpdateCommand
```

#### remove

更新操作符，用于表示删除某个字段。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.remove.html)

```tsx
() => DatabaseUpdateCommand
```

#### inc

更新操作符，原子操作，用于指示字段自增

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.inc.html)

```tsx
(val: number) => DatabaseUpdateCommand
```

| 参数 | 类型 |
| --- | --- |
| val | `number` |

#### mul

更新操作符，原子操作，用于指示字段自乘某个值

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.mul.html)

```tsx
(val: number) => DatabaseUpdateCommand
```

| 参数 | 类型 |
| --- | --- |
| val | `number` |

#### push

数组更新操作符。对一个值为数组的字段，往数组添加一个或多个值。或字段原为空，则创建该字段并设数组为传入值。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.push.html)

```tsx
(...values: any[]) => DatabaseUpdateCommand
```

| 参数 | 类型 |
| --- | --- |
| values | `any[]` |

#### pop

数组更新操作符，对一个值为数组的字段，将数组尾部元素删除

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.pop.html)

```tsx
() => DatabaseUpdateCommand
```

#### shift

数组更新操作符，对一个值为数组的字段，将数组头部元素删除。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.shift.html)

```tsx
() => DatabaseUpdateCommand
```

#### unshift

数组更新操作符，对一个值为数组的字段，往数组头部添加一个或多个值。或字段原为空，则创建该字段并设数组为传入值。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.unshift.html)

```tsx
(...values: any[]) => DatabaseUpdateCommand
```

| 参数 | 类型 |
| --- | --- |
| values | `any[]` |

#### DatabaseLogicCommand

数据库逻辑操作符

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fieldName | string or InternalSymbol | 作用域名称 |
| operator | `string` | 操作符 |
| operands | `any[]` | 操作数 |
| _setFieldName | `(fieldName: string) => DatabaseLogicCommand` | 设置作用域名称 |

##### and

查询操作符，用于表示逻辑 "与" 的关系，表示需同时满足多个查询筛选条件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.and.html)

```tsx
(...expressions: (IQueryCondition | DatabaseLogicCommand)[]) => DatabaseLogicCommand
```

| 参数 | 类型 |
| --- | --- |
| expressions | (IQueryCondition or DatabaseLogicCommand)[] |

##### or

查询操作符，用于表示逻辑 "或" 的关系，表示需同时满足多个查询筛选条件。或指令有两种用法，一是可以进行字段值的 “或” 操作，二是也可以进行跨字段的 “或” 操作。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.or.html)

```tsx
(...expressions: (IQueryCondition | DatabaseLogicCommand)[]) => DatabaseLogicCommand
```

| 参数 | 类型 |
| --- | --- |
| expressions | (IQueryCondition or DatabaseLogicCommand)[] |

#### DatabaseQueryCommand

数据库查询操作符

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| operator | `string` | 操作符 |
| _setFieldName | `(fieldName: string) => DatabaseQueryCommand` | 设置作用域名称 |

##### eq

查询筛选条件，表示字段等于某个值。eq 指令接受一个字面量 (literal)，可以是 number, boolean, string, object, array, Date。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.eq.html)

```tsx
(val: any) => DatabaseLogicCommand
```

##### neq

查询筛选条件，表示字段不等于某个值。eq 指令接受一个字面量 (literal)，可以是 number, boolean, string, object, array, Date。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.neq.html)

```tsx
(val: any) => DatabaseLogicCommand
```

##### gt

查询筛选操作符，表示需大于指定值。可以传入 Date 对象用于进行日期比较。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.gt.html)

```tsx
(val: any) => DatabaseLogicCommand
```

##### gte

查询筛选操作符，表示需大于或等于指定值。可以传入 Date 对象用于进行日期比较。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.gte.html)

```tsx
(val: any) => DatabaseLogicCommand
```

##### lt

查询筛选操作符，表示需小于指定值。可以传入 Date 对象用于进行日期比较。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.lt.html)

```tsx
(val: any) => DatabaseLogicCommand
```

##### lte

查询筛选操作符，表示需小于或等于指定值。可以传入 Date 对象用于进行日期比较。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.lte.html)

```tsx
(val: any) => DatabaseLogicCommand
```

##### in

查询筛选操作符，表示要求值在给定的数组内。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.in.html)

```tsx
(val: any[]) => DatabaseLogicCommand
```

| 参数 | 类型 |
| --- | --- |
| val | `any[]` |

##### nin

查询筛选操作符，表示要求值不在给定的数组内。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.nin.html)

```tsx
(val: any[]) => DatabaseLogicCommand
```

| 参数 | 类型 |
| --- | --- |
| val | `any[]` |

##### geoNear

按从近到远的顺序，找出字段值在给定点的附近的记录。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.geoNear.html)

```tsx
(options: NearCommandOptions) => DatabaseLogicCommand
```

| 参数 | 类型 |
| --- | --- |
| options | `NearCommandOptions` |

##### geoWithin

找出字段值在指定区域内的记录，无排序。指定的区域必须是多边形（Polygon）或多边形集合（MultiPolygon）。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.geoWithin.html)

```tsx
(options: WithinCommandOptions) => DatabaseLogicCommand
```

| 参数 | 类型 |
| --- | --- |
| options | `WithinCommandOptions` |

##### geoIntersects

找出给定的地理位置图形相交的记录

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/command/Command.geoIntersects.html)

```tsx
(options: IntersectsCommandOptions) => DatabaseLogicCommand
```

| 参数 | 类型 |
| --- | --- |
| options | `IntersectsCommandOptions` |

#### DatabaseUpdateCommand

数据库更新操作符

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fieldName | string or InternalSymbol | 作用域名称 |
| operator | `keyof UPDATE_COMMANDS_LITERAL` | 操作符 |
| operands | `any[]` | 操作数 |
| _setFieldName | `(fieldName: string) => DatabaseUpdateCommand` | 设置作用域名称 |

#### LOGIC_COMMANDS_LITERAL

逻辑命令字面量

| 参数 | 说明 |
| --- | --- |
| and | 与 |
| or | 或 |
| not | 非 |
| nor | 都不 |

#### QUERY_COMMANDS_LITERAL

查询命令字面量

| 参数 | 说明 |
| --- | --- |
| eq | 等于 |
| neq | 不等于 |
| gt | 大于 |
| gte | 大于等于 |
| lt | 小于 |
| lte | 小于等于 |
| in | 范围内 |
| nin | 范围外 |
| geoNear | 附近排序 |
| geoWithin | 指定区域内 |
| geoIntersects | 相交区域 |

#### UPDATE_COMMANDS_LITERAL

更新命令字面量

| 参数 | 说明 |
| --- | --- |
| set | 等于 |
| remove | 删除 |
| inc | 自增 |
| mul | 自乘 |
| push | 尾部添加 |
| pop | 尾部删除 |
| shift | 头部删除 |
| unshift | 头部添加 |

#### NearCommandOptions

按从近到远的顺序，找出字段值在给定点的附近的记录参数

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| geometry | `GeoPoint` | 是 | 地理位置点 (Point) |
| maxDistance | `number` | 否 | 最大距离，单位为米 |
| minDistance | `number` | 否 | 最小距离，单位为米 |

#### WithinCommandOptions

找出字段值在指定区域内的记录，无排序参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| geometry | GeoPolygon or GeoMultiPolygon | 地理信息结构，Polygon，MultiPolygon，或 { centerSphere } |

#### IntersectsCommandOptions

找出给定的地理位置图形相交的记录

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| geometry | GeoPoint or GeoPolygon or GeoMultiPolygon or GeoMultiPoint or GeoLineString or GeoMultiLineString | 地理信息结构 |

### Aggregate

数据库集合的聚合操作实例

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.html)

#### addFields

聚合阶段。添加新字段到输出的记录。经过 addFields 聚合阶段，输出的所有记录中除了输入时带有的字段外，还将带有 addFields 指定的字段。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.addFields.html)

```tsx
(object: Object) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| object | `Object` |

#### bucket

聚合阶段。将输入记录根据给定的条件和边界划分成不同的组，每组即一个 bucket。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.bucket.html)

```tsx
(object: Object) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| object | `Object` |

#### bucketAuto

聚合阶段。将输入记录根据给定的条件划分成不同的组，每组即一个 bucket。与 bucket 的其中一个不同之处在于无需指定 boundaries，bucketAuto 会自动尝试将记录尽可能平均的分散到每组中。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.bucketAuto.html)

```tsx
(object: Object) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| object | `Object` |

#### count

聚合阶段。计算上一聚合阶段输入到本阶段的记录数，输出一个记录，其中指定字段的值为记录数。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.count.html)

```tsx
(fieldName: string) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| fieldName | `string` |

#### end

标志聚合操作定义完成，发起实际聚合操作

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.end.html)

```tsx
() => Promise<Object>
```

#### geoNear

聚合阶段。将记录按照离给定点从近到远输出。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.geoNear.html)

```tsx
(options: Object) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| options | `Object` |

#### group

聚合阶段。将输入记录按给定表达式分组，输出时每个记录代表一个分组，每个记录的 _id 是区分不同组的 key。输出记录中也可以包括累计值，将输出字段设为累计值即会从该分组中计算累计值。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.group.html)

```tsx
(object: Object) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| object | `Object` |

#### limit

聚合阶段。限制输出到下一阶段的记录数。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.limit.html)

```tsx
(value: number) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| value | `number` |

#### lookup

聚合阶段。聚合阶段。联表查询。与同个数据库下的一个指定的集合做 left outer join(左外连接)。对该阶段的每一个输入记录，lookup 会在该记录中增加一个数组字段，该数组是被联表中满足匹配条件的记录列表。lookup 会将连接后的结果输出给下个阶段。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.lookup.html)

```tsx
(object: Object) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| object | `Object` |

#### match

聚合阶段。根据条件过滤文档，并且把符合条件的文档传递给下一个流水线阶段。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.match.html)

```tsx
(object: Object) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| object | `Object` |

#### project

聚合阶段。把指定的字段传递给下一个流水线，指定的字段可以是某个已经存在的字段，也可以是计算出来的新字段。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.project.html)

```tsx
(object: Object) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| object | `Object` |

#### replaceRoot

聚合阶段。指定一个已有字段作为输出的根节点，也可以指定一个计算出的新字段作为根节点。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.replaceRoot.html)

```tsx
(object: Object) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| object | `Object` |

#### sample

聚合阶段。随机从文档中选取指定数量的记录。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.sample.html)

```tsx
(size: number) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| size | `number` |

#### skip

聚合阶段。指定一个正整数，跳过对应数量的文档，输出剩下的文档。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.skip.html)

```tsx
(value: number) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| value | `number` |

#### sort

聚合阶段。根据指定的字段，对输入的文档进行排序。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.sort.html)

```tsx
(object: Object) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| object | `Object` |

#### sortByCount

聚合阶段。根据传入的表达式，将传入的集合进行分组（group）。然后计算不同组的数量，并且将这些组按照它们的数量进行排序，返回排序后的结果。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.sortByCount.html)

```tsx
(object: Object) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| object | `Object` |

#### unwind

聚合阶段。使用指定的数组字段中的每个元素，对文档进行拆分。拆分后，文档会从一个变为一个或多个，分别对应数组的每个元素。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/aggregate/Aggregate.unwind.html)

```tsx
(value: string | object) => Aggregate
```

| 参数 | 类型 |
| --- | --- |
| value | string or object |

### IGeo

数据库地理位置结构集

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Geo.html)

#### Point

构造一个地理位置 ”点“。方法接受两个必填参数，第一个是经度（longitude），第二个是纬度（latitude），务必注意顺序。

如存储地理位置信息的字段有被查询的需求，务必对字段建立地理位置索引

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/geo/Geo.Point.html)

```tsx
(longitude: number, latitide: number) => GeoPoint
```

| 参数 | 类型 |
| --- | --- |
| longitude | `number` |
| latitide | `number` |

##### 示例代码

###### 示例 1

```tsx
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: db.Geo.Point(113, 23)
  }
}).then(console.log).catch(console.error)
```

###### 示例 2

除了使用接口构造一个点外，也可以使用等价的 GeoJSON 的 点 (Point) 的 JSON 表示，其格式如下：

```json
{
  "type": "Point",
  "coordinates": [longitude, latitude] // 数字数组：[经度, 纬度]
}
```

```tsx
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: {
      type: 'Point',
      coordinates: [113, 23]
    }
  }
}).then(console.log).catch(console.error)
```

#### LineString

构造一个地理位置的 ”线“。一个线由两个或更多的点有序连接组成。

如存储地理位置信息的字段有被查询的需求，务必对字段建立地理位置索引

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/geo/Geo.LineString.html)

```tsx
(points: JSONMultiPoint | GeoPoint[]) => GeoMultiPoint
```

| 参数 | 类型 |
| --- | --- |
| points | JSONMultiPoint or GeoPoint[] |

##### 示例代码

###### 示例 1

```tsx
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: db.Geo.LineString([
      db.Geo.Point(113, 23),
      db.Geo.Point(120, 50),
      // ... 可选更多点
    ])
  }
}).then(console.log).catch(console.error)
```

###### 示例 2

除了使用接口构造一条 LineString 外，也可以使用等价的 GeoJSON 的 线 (LineString) 的 JSON 表示，其格式如下：

```json
{
  "type": "LineString",
  "coordinates": [
    [p1_lng, p1_lat],
    [p2_lng, p2_lng]
    // ... 可选更多点
  ]
}
```

```tsx
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: {
      type: 'LineString',
      coordinates: [
        [113, 23],
        [120, 50]
      ]
    }
  }
}).then(console.log).catch(console.error)
```

#### Polygon

构造一个地理位置 ”多边形“

如存储地理位置信息的字段有被查询的需求，务必对字段建立地理位置索引

**说明**

一个多边形由一个或多个线性环（Linear Ring）组成，一个线性环即一个闭合的线段。一个闭合线段至少由四个点组成，其中最后一个点和第一个点的坐标必须相同，以此表示环的起点和终点。如果一个多边形由多个线性环组成，则第一个线性环表示外环（外边界），接下来的所有线性环表示内环（即外环中的洞，不计在此多边形中的区域）。如果一个多边形只有一个线性环组成，则这个环就是外环。

多边形构造规则：

1. 第一个线性环必须是外环
2. 外环不能自交
3. 所有内环必须完全在外环内
4. 各个内环间不能相交或重叠，也不能有共同的边
5. 外环应为逆时针，内环应为顺时针

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/geo/Geo.Polygon.html)

```tsx
(lineStrings: JSONPolygon | GeoLineString[]) => GeoPolygon
```

| 参数 | 类型 |
| --- | --- |
| lineStrings | JSONPolygon or GeoLineString[] |

##### 示例代码

###### 示例 1

单环多边形

```tsx
const { Polygon, LineString, Point } = db.Geo
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: Polygon([
      LineString([
        Point(0, 0),
        Point(3, 2),
        Point(2, 3),
        Point(0, 0)
      ])
    ])
  }
}).then(console.log).catch(console.error)
```

###### 示例 2

含一个外环和一个内环的多边形

```tsx
const { Polygon, LineString, Point } = db.Geo
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: Polygon([
      // 外环
      LineString([ Point(0, 0), Point(30, 20), Point(20, 30), Point(0, 0) ]),
      // 内环
      LineString([ Point(10, 10), Point(16, 14), Point(14, 16), Point(10, 10) ])
    ])
  }
}).then(console.log).catch(console.error)
```

###### 示例 3

除了使用接口构造一个 Polygon 外，也可以使用等价的 GeoJSON 的 多边形 (Polygon) 的 JSON 表示，其格式如下：

```json
{
  "type": "Polygon",
  "coordinates": [
    [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ], // 外环
    [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ], // 可选内环 1
    ...
    [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ], // 可选内环 n
  ]
}
```

```tsx
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: {
      type: 'Polygon',
      coordinates: [
        [ [0, 0], [30, 20], [20, 30], [0, 0] ],
        [ [10, 10], [16, 14], [14, 16], [10, 10]]
      ]
    }
  }
}).then(console.log).catch(console.error)
```

#### MultiPoint

构造一个地理位置的 ”点“ 的集合。一个点集合由一个或更多的点组成。

如存储地理位置信息的字段有被查询的需求，务必对字段建立地理位置索引

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/geo/Geo.MultiPoint.html)

```tsx
(polygons: JSONMultiPolygon | GeoPolygon[]) => GeoMultiPolygon
```

| 参数 | 类型 |
| --- | --- |
| polygons | JSONMultiPolygon or GeoPolygon[] |

##### 示例代码

###### 示例 1

```tsx
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: db.Geo.MultiPoint([
      db.Geo.Point(113, 23),
      db.Geo.Point(120, 50),
      // ... 可选更多点
    ])
  }
}).then(console.log).catch(console.error)
```

###### 示例 2

除了使用接口构造 MultiPoint 外，也可以使用等价的 GeoJSON 的 点集合 (MultiPoint) 的 JSON 表示，其格式如下：

```json
{
  "type": "MultiPoint",
  "coordinates": [
    [p1_lng, p1_lat],
    [p2_lng, p2_lng]
    // ... 可选更多点
  ]
}
```

```tsx
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: {
      type: 'MultiPoint',
      coordinates: [
        [113, 23],
        [120, 50]
      ]
    }
  }
}).then(console.log).catch(console.error)
```

#### MultiLineString

构造一个地理位置 ”线“ 集合。一个线集合由多条线组成。

如存储地理位置信息的字段有被查询的需求，务必对字段建立地理位置索引

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/geo/Geo.MultiLineString.html)

```tsx
(lineStrings: JSONMultiLineString | GeoLineString[]) => GeoMultiLineString
```

| 参数 | 类型 |
| --- | --- |
| lineStrings | JSONMultiLineString or GeoLineString[] |

##### 示例代码

###### 示例 1

```tsx
const { LineString, MultiLineString, Point } = db.Geo
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: MultiLineString([
      LineString([ Point(0, 0), Point(30, 20), Point(20, 30), Point(0, 0) ]),
      LineString([ Point(10, 10), Point(16, 14), Point(14, 16), Point(10, 10) ])
    ])
  }
}).then(console.log).catch(console.error)
```

###### 示例 2

除了使用接口构造一个 MultiLineString 外，也可以使用等价的 GeoJSON 的 线集合 (MultiLineString) 的 JSON 表示，其格式如下：

```json
{
  "type": "MultiLineString",
  "coordinates": [
    [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ],
    [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ],
    ...
    [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ]
  ]
}
```

```tsx
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: {
      type: 'MultiLineString',
      coordinates: [
        [ [0, 0], [3, 3] ],
        [ [5, 10], [20, 30] ]
      ]
    }
  }
}).then(console.log).catch(console.error)
```

#### MultiPolygon

构造一个地理位置 ”多边形“ 集合。一个多边形集合由多个多边形组成。

如存储地理位置信息的字段有被查询的需求，务必对字段建立地理位置索引

**说明**

一个多边形由一个或多个线性环（Linear Ring）组成，一个线性环即一个闭合的线段。一个闭合线段至少由四个点组成，其中最后一个点和第一个点的坐标必须相同，以此表示环的起点和终点。如果一个多边形由多个线性环组成，则第一个线性环表示外环（外边界），接下来的所有线性环表示内环（即外环中的洞，不计在此多边形中的区域）。如果一个多边形只有一个线性环组成，则这个环就是外环。

多边形构造规则：

1. 第一个线性环必须是外环
2. 外环不能自交
3. 所有内环必须完全在外环内
4. 各个内环间不能相交或重叠，也不能有共同的边
5. 外环应为逆时针，内环应为顺时针

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/geo/Geo.MultiPolygon.html)

```tsx
(polygons: JSONMultiPolygon | GeoPolygon[]) => GeoMultiPolygon
```

| 参数 | 类型 |
| --- | --- |
| polygons | JSONMultiPolygon or GeoPolygon[] |

##### 示例代码

###### 示例 1

```tsx
const { MultiPolygon, Polygon, LineString, Point } = db.Geo
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: MultiPolygon([
      Polygon([
        LineString([ Point(50, 50), Point(60, 80), Point(80, 60), Point(50, 50) ]),
      ]),
      Polygon([
        LineString([ Point(0, 0), Point(30, 20), Point(20, 30), Point(0, 0) ]),
        LineString([ Point(10, 10), Point(16, 14), Point(14, 16), Point(10, 10) ])
      ]),
    ])
  }
}).then(console.log).catch(console.error)
```

###### 示例 2

除了使用接口构造一个 MultiPolygon 外，也可以使用等价的 GeoJSON 的 多边形 (MultiPolygon) 的 JSON 表示，其格式如下：

```json
{
  "type": "MultiPolygon",
  "coordinates": [
    // polygon 1
    [
      [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ],
      [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ],
      ...
      [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ]
    ],
    ...
    // polygon n
    [
      [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ],
      [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ],
      ...
      [ [lng, lat], [lng, lat], [lng, lat], ..., [lng, lat] ]
    ],
  ]
}
```

```tsx
db.collection('todos').add({
  data: {
    description: 'eat an apple',
    location: {
      type: 'MultiPolygon',
      coordinates: [
        [
          [ [50, 50], [60, 80], [80, 60], [50, 50] ]
        ],
        [
          [ [0, 0], [30, 20], [20, 30], [0, 0] ],
          [ [10, 10], [16, 14], [14, 16], [10, 10]]
        ]
      ]
    }
  }
}).then(console.log).catch(console.error)
```

#### GeoPoint

地理位置 “点”

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/geo/GeoPoint.html)

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| longitude | `number` | 经度 |
| latitude | `number` | 纬度 |

##### toJSON

格式化为 JSON 结构

```tsx
() => object
```

##### toString

格式化为字符串

```tsx
() => string
```

#### GeoLineString

地理位置的 ”线“。一个线由两个或更多的点有序连接组成。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/geo/GeoLineString.html)

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| points | `GeoPoint[]` | 点集合 |

##### toJSON

格式化为 JSON 结构

```tsx
() => JSONLineString
```

##### toString

格式化为字符串

```tsx
() => string
```

#### GeoPolygon

地理位置 ”多边形“

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/geo/GeoPolygon.html)

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| lines | `GeoLineString[]` | 线集合 |

##### toJSON

格式化为 JSON 结构

```tsx
() => JSONPolygon
```

##### toString

格式化为字符串

```tsx
() => string
```

#### GeoMultiPoint

地理位置的 ”点“ 的集合。一个点集合由一个或更多的点组成。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/geo/GeoMultiPoint.html)

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| points | `GeoPoint[]` | 点集合 |

##### toJSON

格式化为 JSON 结构

```tsx
() => JSONMultiPoint
```

##### toString

格式化为字符串

```tsx
() => string
```

#### GeoMultiLineString

地理位置 ”线“ 集合。一个线集合由多条线组成。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/geo/GeoMultiLineString.html)

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| lines | `GeoLineString[]` | 线集合 |

##### toJSON

格式化为 JSON 结构

```tsx
() => JSONMultiLineString
```

##### toString

格式化为字符串

```tsx
() => string
```

#### GeoMultiPolygon

地理位置 ”多边形“ 集合。一个多边形集合由多个多边形组成。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/geo/GeoMultiPolygon.html)

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| polygons | `GeoPolygon[]` | 多边形集合 |

##### toJSON

格式化为 JSON 结构

```tsx
() => JSONMultiPolygon
```

##### toString

格式化为字符串

```tsx
() => string
```

#### JSONPoint

地理位置 “点” 的 JSON 结构

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `"Point"` | 类型 |
| coordinates | `[number, number]` | 坐标 |

#### JSONLineString

地理位置 ”线“ 的 JSON 结构

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `"LineString"` | 类型 |
| coordinates | `[number, number][]` | 坐标 |

#### JSONPolygon

地理位置 ”多边形“ 的 JSON 结构

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `"Polygon"` | 类型 |
| coordinates | `[number, number][][]` | 坐标 |

#### JSONMultiPoint

地理位置的 ”点“ 集合的 JSON 结构

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `"MultiPoint"` | 类型 |
| coordinates | `[number, number][]` | 坐标 |

#### JSONMultiLineString

地理位置 ”线“ 集合的 JSON 结构

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `"MultiLineString"` | 类型 |
| coordinates | `[number, number][][]` | 坐标 |

#### JSONMultiPolygon

地理位置 ”多边形“ 集合的 JSON 结构

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `"MultiPolygon"` | 类型 |
| coordinates | `[number, number][][][]` | 坐标 |
</file>

<file path="docs/apis/data-analysis/getCommonConfig.md">
---
title: Taro.getCommonConfig(option)
sidebar_label: getCommonConfig
---

给定实验参数数组，获取对应的实验参数值

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/data-analysis/wx.getCommonConfig.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| keys | `string[]` | 否 | 需要获取的数据指标的对象数组，每个string的格式约定：配置类型_分表key |
| mode | 0 or 1 | 是 | 0：通用配置模式 1：实验模式, 参数与返回结果的使用等效于接口wx.getExptInfoSync |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errcode | `number` | 错误码 |
| errmsg | `string` | 错误信息 |
| conf_type | `number` | 配置类型, 1-表类型 2-kv类型 |
| conf | `string` | 根据conf_type来确定conf内容, conf_type为1时conf是一个json数组, 类似"[{xxx},{xxx}]", 每一项对应表类型每一行配置内容, 其中conf_type为2时conf是一个json对象，类似"{xxxx}" |
| expire_sec | `number` | 过期时间,单位秒. 0表示当次有效 |

## 示例代码

```tsx
Taro.getCommonConfig({
  keys:["key1", "key2"],
  mode: 0,
  success: (res) => {
    console.log("success")
    console.log(res)
  },
  fail: (res) => {
    console.log("fail")
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/data-analysis/getExptInfoSync.md">
---
title: Taro.getExptInfoSync(keys)
sidebar_label: getExptInfoSync
---

给定实验参数数组，获取对应的实验参数值

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/data-analysis/wx.getExptInfoSync.html)

## 类型

```tsx
(keys?: string[]) => TaroGeneral.IAnyObject
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| keys | `string[]` | 实验参数数组，不填则获取所有实验参数 |

## 示例代码

```tsx
Taro.getExptInfoSync(['color'])
```
</file>

<file path="docs/apis/data-analysis/reportAnalytics.md">
---
title: Taro.reportAnalytics(eventName, data)
sidebar_label: reportAnalytics
---

自定义分析数据上报接口。使用前，需要在小程序管理后台自定义分析中新建事件，配置好事件名与字段。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/data-analysis/wx.reportAnalytics.html)

## 类型

```tsx
(eventName: string, data: TaroGeneral.IAnyObject) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| eventName | `string` | 事件名 |
| data | `TaroGeneral.IAnyObject` | 上报的自定义数据，key 为配置中的字段名，value 为上报的数据。 |

## 示例代码

```tsx
Taro.reportAnalytics('purchase', {
  price: 120,
  color: 'red'
})
```
</file>

<file path="docs/apis/data-analysis/reportEvent.md">
---
title: Taro.reportEvent(eventId, data)
sidebar_label: reportEvent
---

事件上报

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/data-analysis/wx.reportEvent.html)

## 类型

```tsx
(eventId: string, data: TaroGeneral.IAnyObject) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| eventId | `string` | 事件名 |
| data | `TaroGeneral.IAnyObject` | 上报的自定义数据，key 为配置中的字段名，value 为上报的数据。 |

## 示例代码

```tsx
Taro.reportEvent('purchase', {
  price: 120,
  color: 'red'
})
```
</file>

<file path="docs/apis/data-analysis/reportMonitor.md">
---
title: Taro.reportMonitor(name, value)
sidebar_label: reportMonitor
---

自定义业务数据监控上报接口。

**使用说明**
使用前，需要在「小程序管理后台-运维中心-性能监控-业务数据监控」中新建监控事件，配置监控描述与告警类型。每一个监控事件对应唯一的监控ID，开发者最多可以创建128个监控事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/data-analysis/wx.reportMonitor.html)

## 类型

```tsx
(name: string, value: number) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| name | `string` | 监控ID，在「小程序管理后台」新建数据指标后获得 |
| value | `number` | 上报数值，经处理后会在「小程序管理后台」上展示每分钟的上报总量 |

## 示例代码

```tsx
Taro.reportMonitor('1', 1)
```
</file>

<file path="docs/apis/device/accelerometer/offAccelerometerChange.md">
---
title: Taro.offAccelerometerChange(callback)
sidebar_label: offAccelerometerChange
---

取消监听加速度数据事件，参数为空，则取消所有的事件监听。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/accelerometer/wx.offAccelerometerChange.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 加速度数据事件的回调函数 |
</file>

<file path="docs/apis/device/accelerometer/onAccelerometerChange.md">
---
title: Taro.onAccelerometerChange(callback)
sidebar_label: onAccelerometerChange
---

监听加速度数据，频率：5次/秒，接口调用后会自动开始监听，可使用 `Taro.stopAccelerometer` 停止监听。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/accelerometer/wx.onAccelerometerChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |

### Callback

```tsx
(res: Result) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `Result` |

### Result

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | X 轴 |
| y | `number` | Y 轴 |
| z | `number` | Z 轴 |

## 示例代码

```tsx
Taro.onAccelerometerChange(res => {
  console.log(res.x)
  console.log(res.y)
  console.log(res.z)
})
```
</file>

<file path="docs/apis/device/accelerometer/startAccelerometer.md">
---
title: Taro.startAccelerometer(res)
sidebar_label: startAccelerometer
---

开始监听加速度数据。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/accelerometer/wx.startAccelerometer.html)

## 类型

```tsx
(res?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| res | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| interval | `keyof Interval` | `"normal"` | 否 | 监听加速度数据回调函数的执行频率 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### Interval

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| game | `"game"` | 适用于更新游戏的回调频率，在 20ms/次 左右 |
| ui | `"ui"` | 适用于更新 UI 的回调频率，在 60ms/次 左右 |
| normal | `"normal"` | 普通的回调频率，在 200ms/次 左右 |

## 示例代码

```tsx
Taro.startAccelerometer({ interval: 'game' })
```
</file>

<file path="docs/apis/device/accelerometer/stopAccelerometer.md">
---
title: Taro.stopAccelerometer(res)
sidebar_label: stopAccelerometer
---

停止监听加速度数据。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/accelerometer/wx.stopAccelerometer.html)

## 类型

```tsx
(res?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| res | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.stopAccelerometer()
```
</file>

<file path="docs/apis/device/accessibility/checkIsOpenAccessibility.md">
---
title: Taro.checkIsOpenAccessibility(option)
sidebar_label: checkIsOpenAccessibility
---

检测是否开启视觉无障碍功能。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/accessibility/wx.checkIsOpenAccessibility.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| open | `boolean` | iOS 上开启辅助功能旁白，安卓开启 talkback 时返回 true |
</file>

<file path="docs/apis/device/battery/getBatteryInfo.md">
---
title: Taro.getBatteryInfo(option)
sidebar_label: getBatteryInfo
---

获取设备电量。同步 API Taro.getBatteryInfoSync 在 iOS 上不可用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/battery/wx.getBatteryInfo.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| isCharging | `boolean` | 是否正在充电中 |
| level | `number` | 设备电量，范围 1 - 100 |
| errMsg | `string` | 调用结果 |
</file>

<file path="docs/apis/device/battery/getBatteryInfoSync.md">
---
title: Taro.getBatteryInfoSync()
sidebar_label: getBatteryInfoSync
---

Taro.getBatteryInfo 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/battery/wx.getBatteryInfoSync.html)

## 类型

```tsx
() => Result
```

## 参数

### Result

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| isCharging | `boolean` | 是否正在充电中 |
| level | `number` | 设备电量，范围 1 - 100 |
</file>

<file path="docs/apis/device/bluetooth/closeBluetoothAdapter.md">
---
title: Taro.closeBluetoothAdapter(option)
sidebar_label: closeBluetoothAdapter
---

关闭蓝牙模块。调用该方法将断开所有已建立的连接并释放系统资源。建议在使用蓝牙流程后，与 Taro.openBluetoothAdapter 成对调用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth/wx.closeBluetoothAdapter.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.closeBluetoothAdapter({
  success: function (res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/device/bluetooth/getBluetoothAdapterState.md">
---
title: Taro.getBluetoothAdapterState(option)
sidebar_label: getBluetoothAdapterState
---

获取本机蓝牙适配器状态。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth/wx.getBluetoothAdapterState.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| available | `boolean` | 蓝牙适配器是否可用 |
| discovering | `boolean` | 是否正在搜索设备 |
| errMsg | `string` | 成功：ok，错误：详细信息 |

## 示例代码

```tsx
Taro.getBluetoothAdapterState({
  success: function (res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/device/bluetooth/getBluetoothDevices.md">
---
title: Taro.getBluetoothDevices(option)
sidebar_label: getBluetoothDevices
---

获取在蓝牙模块生效期间所有已发现的蓝牙设备。包括已经和本机处于连接状态的设备。

**注意事项**
- 该接口获取到的设备列表为**蓝牙模块生效期间所有搜索到的蓝牙设备**，若在蓝牙模块使用流程结束后未及时调用 Taro.closeBluetoothAdapter 释放资源，会存在调用该接口会返回之前的蓝牙使用流程中搜索到的蓝牙设备，可能设备已经不在用户身边，无法连接。
- 蓝牙设备在被搜索到时，系统返回的 name 字段一般为广播包中的 LocalName 字段中的设备名称，而如果与蓝牙设备建立连接，系统返回的 name 字段会改为从蓝牙设备上获取到的 `GattName`。若需要动态改变设备名称并展示，建议使用 `localName` 字段。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth/wx.getBluetoothDevices.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| devices | `SuccessCallbackResultBlueToothDevice[]` | uuid 对应的的已连接设备列表 |
| errMsg | `string` | 成功：ok，错误：详细信息 |

### SuccessCallbackResultBlueToothDevice

uuid 对应的的已连接设备列表

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| RSSI | `number` | 是 | 当前蓝牙设备的信号强度 |
| advertisData | `ArrayBuffer` | 是 | 当前蓝牙设备的广播数据段中的 ManufacturerData 数据段。 |
| advertisServiceUUIDs | `string[]` | 是 | 当前蓝牙设备的广播数据段中的 ServiceUUIDs 数据段 |
| deviceId | `string` | 是 | 用于区分设备的 id |
| localName | `string` | 是 | 当前蓝牙设备的广播数据段中的 LocalName 数据段 |
| name | `string` | 是 | 蓝牙设备名称，某些设备可能没有 |
| serviceData | `TaroGeneral.IAnyObject` | 是 | 当前蓝牙设备的广播数据段中的 ServiceData 数据段 |
| connectable | `boolean` | 否 | 当前蓝牙设备是否可连接（ Android 8.0 以下不支持返回该值 ） |

## 示例代码

```tsx
// ArrayBuffer转16进度字符串示例
function ab2hex(buffer) {
  var hexArr = Array.prototype.map.call(
    new Uint8Array(buffer),
    function(bit) {
      return ('00' + bit.toString(16)).slice(-2)
    }
  )
  return hexArr.join('');
}
Taro.getBluetoothDevices({
  success: function (res) {
    console.log(res)
    if (res.devices[0]) {
      console.log(ab2hex(res.devices[0].advertisData))
    }
  }
})
```
</file>

<file path="docs/apis/device/bluetooth/getConnectedBluetoothDevices.md">
---
title: Taro.getConnectedBluetoothDevices(option)
sidebar_label: getConnectedBluetoothDevices
---

根据 uuid 获取处于已连接状态的设备。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth/wx.getConnectedBluetoothDevices.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| services | `string[]` | 是 | 蓝牙设备主 service 的 uuid 列表 |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| devices | `BluetoothDeviceInfo[]` | 搜索到的设备列表 |
| errMsg | `string` | 成功：ok，错误：详细信息 |

### BluetoothDeviceInfo

搜索到的设备

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| deviceId | `string` | 用于区分设备的 id |
| name | `string` | 蓝牙设备名称，某些设备可能没有 |

## 示例代码

```tsx
Taro.getConnectedBluetoothDevices({
  success: function (res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/device/bluetooth/isBluetoothDevicePaired.md">
---
title: Taro.isBluetoothDevicePaired(option)
sidebar_label: isBluetoothDevicePaired
---

查询蓝牙设备是否配对，仅安卓支持

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth/wx.isBluetoothDevicePaired.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| deviceId | `string` | 是 | 蓝牙设备 id |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/device/bluetooth/makeBluetoothPair.md">
---
title: Taro.makeBluetoothPair(option)
sidebar_label: makeBluetoothPair
---

蓝牙配对接口，仅安卓支持

通常情况下（需要指定 pin 码或者密码时）系统会接管配对流程，直接调用 [Taro.createBLEConnection](/docs/apis/device/bluetooth-ble/createBLEConnection) 即可。该接口只应当在开发者不想让用户手动输入 pin 码且真机验证确认可以正常生效情况下用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth/wx.makeBluetoothPair.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| deviceId | `string` |  | 是 | 蓝牙设备 id |
| pin | `string` |  | 是 | pin 码，Base64 格式 |
| timeout | `string` | `20000` | 否 | 超时时间，单位 ms |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/device/bluetooth/offBluetoothAdapterStateChange.md">
---
title: Taro.offBluetoothAdapterStateChange(callback)
sidebar_label: offBluetoothAdapterStateChange
---

取消监听蓝牙适配器状态变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth/wx.offBluetoothAdapterStateChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 蓝牙适配器状态变化事件的回调函数 |
</file>

<file path="docs/apis/device/bluetooth/offBluetoothDeviceFound.md">
---
title: Taro.offBluetoothDeviceFound(callback)
sidebar_label: offBluetoothDeviceFound
---

取消监听寻找到新设备的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth/wx.offBluetoothDeviceFound.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 寻找到新设备的事件的回调函数 |
</file>

<file path="docs/apis/device/bluetooth/onBluetoothAdapterStateChange.md">
---
title: Taro.onBluetoothAdapterStateChange(callback)
sidebar_label: onBluetoothAdapterStateChange
---

监听蓝牙适配器状态变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth/wx.onBluetoothAdapterStateChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 蓝牙适配器状态变化事件的回调函数 |

### Callback

蓝牙适配器状态变化事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| available | `boolean` | 蓝牙适配器是否可用 |
| discovering | `boolean` | 蓝牙适配器是否处于搜索状态 |

## 示例代码

```tsx
Taro.onBluetoothAdapterStateChange(function (res) {
  console.log('adapterState changed, now is', res)
})
```
</file>

<file path="docs/apis/device/bluetooth/onBluetoothDeviceFound.md">
---
title: Taro.onBluetoothDeviceFound(callback)
sidebar_label: onBluetoothDeviceFound
---

监听寻找到新设备的事件

**注意**
- 若在 Taro.onBluetoothDeviceFound 回调了某个设备，则此设备会添加到 Taro.getBluetoothDevices 接口获取到的数组中。
- 安卓下部分机型需要有位置权限才能搜索到设备，需留意是否开启了位置权限

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth/wx.onBluetoothDeviceFound.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 寻找到新设备的事件的回调函数 |

### Callback

寻找到新设备的事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| devices | `CallbackResultBlueToothDevice[]` | 新搜索到的设备列表 |

### CallbackResultBlueToothDevice

新搜索到的设备

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| RSSI | `number` | 是 | 当前蓝牙设备的信号强度，单位 dBm |
| advertisData | `ArrayBuffer` | 是 | 当前蓝牙设备的广播数据段中的 ManufacturerData 数据段。 |
| advertisServiceUUIDs | `string[]` | 是 | 当前蓝牙设备的广播数据段中的 ServiceUUIDs 数据段 |
| deviceId | `string` | 是 | 用于区分设备的 id |
| localName | `string` | 是 | 当前蓝牙设备的广播数据段中的 LocalName 数据段 |
| name | `string` | 是 | 蓝牙设备名称，某些设备可能没有 |
| serviceData | `TaroGeneral.IAnyObject` | 是 | 当前蓝牙设备的广播数据段中的 ServiceData 数据段 |
| connectable | `boolean` | 否 | 当前蓝牙设备是否可连接（ Android 8.0 以下不支持返回该值 ） |

## 示例代码

```tsx
// ArrayBuffer转16进度字符串示例
function ab2hex(buffer) {
  var hexArr = Array.prototype.map.call(
    new Uint8Array(buffer),
    function(bit) {
      return ('00' + bit.toString(16)).slice(-2)
    }
  )
  return hexArr.join('');
}
Taro.onBluetoothDeviceFound(function (res) {
  var devices = res.devices;
  console.log('new device list has founded')
  console.dir(devices)
  console.log(ab2hex(devices[0].advertisData))
})
```
</file>

<file path="docs/apis/device/bluetooth/openBluetoothAdapter.md">
---
title: Taro.openBluetoothAdapter(option)
sidebar_label: openBluetoothAdapter
---

初始化蓝牙模块

**注意**
- 其他蓝牙相关 API 必须在 Taro.openBluetoothAdapter 调用之后使用。否则 API 会返回错误（errCode=10000）。
- 在用户蓝牙开关未开启或者手机不支持蓝牙功能的情况下，调用 Taro.openBluetoothAdapter 监听手机蓝牙状态的改变，也可以调用蓝牙模块的所有API。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth/wx.openBluetoothAdapter.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| mode | `keyof Mode` | 否 | 蓝牙模式，可作为主/从设备，仅 iOS 需要。 |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用成功的回调函数 |

### Mode

| 参数 | 说明 |
| --- | --- |
| central | 主机模式 |
| peripheral | 从机（外围设备）模式 |

### state

object.fail 回调函数返回的 state 参数（仅 iOS）

| 参数 | 说明 |
| --- | --- |
| 0 | 未知 |
| 1 | 重置中 |
| 2 | 不支持 |
| 3 | 未授权 |
| 4 | 未开启 |

## 示例代码

```tsx
Taro.openBluetoothAdapter({
  success: function (res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/device/bluetooth/startBluetoothDevicesDiscovery.md">
---
title: Taro.startBluetoothDevicesDiscovery(option)
sidebar_label: startBluetoothDevicesDiscovery
---

开始搜寻附近的蓝牙外围设备。**此操作比较耗费系统资源，请在搜索并连接到设备后调用 Taro.stopBluetoothDevicesDiscovery 方法停止搜索。**

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth/wx.startBluetoothDevicesDiscovery.html)

## 类型

```tsx
(option: Option) => Promise<Promised>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Promised

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 成功：ok，错误：详细信息 |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| allowDuplicatesKey | `boolean` | 否 | 是否允许重复上报同一设备。如果允许重复上报，则 Taro.onBlueToothDeviceFound 方法会多次上报同一设备，但是 RSSI 值会有不同。 |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| interval | `number` | 否 | 上报设备的间隔。0 表示找到新设备立即上报，其他数值根据传入的间隔上报。 |
| services | `string[]` | 否 | 要搜索的蓝牙设备主 service 的 uuid 列表。某些蓝牙设备会广播自己的主 service 的 uuid。如果设置此参数，则只搜索广播包有对应 uuid 的主服务的蓝牙设备。建议主要通过该参数过滤掉周边不需要处理的其他蓝牙设备。 |
| powerLevel | `keyof PowerLevel` | 否 | 扫描模式，越高扫描越快，也越耗电。仅安卓微信客户端 7.0.12 及以上支持。 |
| success | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用成功的回调函数 |

### PowerLevel

| 参数 | 说明 |
| --- | --- |
| low | 低 |
| medium | 中 |
| high | 高 |

## 示例代码

```tsx
// 以微信硬件平台的蓝牙智能灯为例，主服务的 UUID 是 FEE7。传入这个参数，只搜索主服务 UUID 为 FEE7 的设备
Taro.startBluetoothDevicesDiscovery({
  services: ['FEE7'],
  success: function (res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/device/bluetooth/stopBluetoothDevicesDiscovery.md">
---
title: Taro.stopBluetoothDevicesDiscovery(option)
sidebar_label: stopBluetoothDevicesDiscovery
---

停止搜寻附近的蓝牙外围设备。若已经找到需要的蓝牙设备并不需要继续搜索时，建议调用该接口停止蓝牙搜索。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth/wx.stopBluetoothDevicesDiscovery.html)

## 类型

```tsx
(option?: Option) => Promise<Promised>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Promised

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 成功：ok，错误：详细信息 |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.stopBluetoothDevicesDiscovery({
  success: function (res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/device/bluetooth-ble/closeBLEConnection.md">
---
title: Taro.closeBLEConnection(option)
sidebar_label: closeBLEConnection
---

断开与低功耗蓝牙设备的连接。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.closeBLEConnection.html)

## 类型

```tsx
(option: Option) => Promise<Promised>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Promised

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 成功：ok，错误：详细信息 |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| deviceId | `string` | 是 | 用于区分设备的 id |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.closeBLEConnection({
  deviceId,
  success: function (res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/device/bluetooth-ble/createBLEConnection.md">
---
title: Taro.createBLEConnection(option)
sidebar_label: createBLEConnection
---

连接低功耗蓝牙设备。

若小程序在之前已有搜索过某个蓝牙设备，并成功建立连接，可直接传入之前搜索获取的 deviceId 直接尝试连接该设备，无需进行搜索操作。

**注意**
- 请保证尽量成对的调用 `createBLEConnection` 和 `closeBLEConnection` 接口。安卓如果多次调用 `createBLEConnection` 创建连接，有可能导致系统持有同一设备多个连接的实例，导致调用 `closeBLEConnection` 的时候并不能真正的断开与设备的连接。
- 蓝牙连接随时可能断开，建议监听 Taro.onBLEConnectionStateChange 回调事件，当蓝牙设备断开时按需执行重连操作
- 若对未连接的设备或已断开连接的设备调用数据读写操作的接口，会返回 10006 错误，建议进行重连操作。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.createBLEConnection.html)

## 类型

```tsx
(option: Option) => Promise<Promised>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Promised

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 成功：ok，错误：详细信息 |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| deviceId | `string` | 是 | 用于区分设备的 id |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用成功的回调函数 |
| timeout | `number` | 否 | 超时时间，单位ms，不填表示不会超时 |

## 示例代码

```tsx
Taro.createBLEConnection({
  // 这里的 deviceId 需要已经通过 createBLEConnection 与对应设备建立链接
  deviceId,
  success: function (res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/device/bluetooth-ble/getBLEDeviceCharacteristics.md">
---
title: Taro.getBLEDeviceCharacteristics(option)
sidebar_label: getBLEDeviceCharacteristics
---

获取蓝牙设备某个服务中所有特征值(characteristic)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.getBLEDeviceCharacteristics.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| deviceId | `string` | 是 | 蓝牙设备 id |
| serviceId | `string` | 是 | 蓝牙服务 uuid，需要使用 `getBLEDeviceServices` 获取 |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| characteristics | `BLECharacteristic[]` | 设备特征值列表 |
| errMsg | `string` | 成功：ok，错误：详细信息 |

### BLECharacteristic

设备特征值列表

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| properties | `Properties` | 该特征值支持的操作类型 |
| uuid | `string` | 蓝牙设备特征值的 uuid |

### Properties

该特征值支持的操作类型

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| indicate | `boolean` | 该特征值是否支持 indicate 操作 |
| notify | `boolean` | 该特征值是否支持 notify 操作 |
| read | `boolean` | 该特征值是否支持 read 操作 |
| write | `boolean` | 该特征值是否支持 write 操作 |
| writeNoResponse | `boolean` | 该特征是否支持无回复写操作 |
| writeDefault | `boolean` | 该特征是否支持有回复写操作 |

## 示例代码

```tsx
Taro.getBLEDeviceCharacteristics({
  // 这里的 deviceId 需要已经通过 createBLEConnection 与对应设备建立链接
  deviceId,
  // 这里的 serviceId 需要在 getBLEDeviceServices 接口中获取
  serviceId,
  success: function (res) {
    console.log('device getBLEDeviceCharacteristics:', res.characteristics)
  }
})
```
</file>

<file path="docs/apis/device/bluetooth-ble/getBLEDeviceRSSI.md">
---
title: Taro.getBLEDeviceRSSI(option)
sidebar_label: getBLEDeviceRSSI
---

获取蓝牙低功耗设备的信号强度 (Received Signal Strength Indication, RSSI)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.getBLEDeviceRSSI.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| deviceId | `string` | 是 | 蓝牙设备 id |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| RSSI | `number` | 信号强度，单位 dBm |
</file>

<file path="docs/apis/device/bluetooth-ble/getBLEDeviceServices.md">
---
title: Taro.getBLEDeviceServices(option)
sidebar_label: getBLEDeviceServices
---

获取蓝牙设备所有服务(service)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.getBLEDeviceServices.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| deviceId | `string` | 是 | 蓝牙设备 id |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| services | `BLEService[]` | 设备服务列表 |
| errMsg | `string` | 成功：ok，错误：详细信息 |

### BLEService

设备服务列表

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| isPrimary | `boolean` | 该服务是否为主服务 |
| uuid | `string` | 蓝牙设备服务的 uuid |

## 示例代码

```tsx
Taro.getBLEDeviceServices({
  // 这里的 deviceId 需要已经通过 createBLEConnection 与对应设备建立链接
  deviceId,
  success: function (res) {
    console.log('device services:', res.services)
  }
})
```
</file>

<file path="docs/apis/device/bluetooth-ble/getBLEMTU.md">
---
title: Taro.getBLEMTU(option)
sidebar_label: getBLEMTU
---

获取蓝牙低功耗的最大传输单元。需在 [Taro.createBLEConnection](/docs/apis/device/bluetooth-ble/createBLEConnection) 调用成功后调用。

注意:
- 小程序中 MTU 为 ATT_MTU，包含 Op-Code 和 Attribute Handle 的长度，实际可以传输的数据长度为 ATT_MTU - 3
- iOS 系统中 MTU 为固定值；安卓系统中，MTU 会在系统协商成功之后发生改变，建议使用 [Taro.onBLEMTUChange](/docs/apis/device/bluetooth-ble/onBLEMTUChange) 监听。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.getBLEMTU.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| deviceId | `string` |  | 是 | 蓝牙设备 id |
| writeType | `keyof WriteType` | `"write"` | 否 | 写模式 （iOS 特有参数） |
| complete | `(res: TaroGeneral.BluetoothError) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| mtu | `number` | 最大传输单元 |

### WriteType

写模式合法值

| 参数 | 说明 |
| --- | --- |
| write | 有回复写 |
| writeNoResponse | 无回复写 |

## 示例代码

```tsx
Taro.getBLEMTU({
  deviceId: '',
  writeType: 'write',
  success (res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/device/bluetooth-ble/notifyBLECharacteristicValueChange.md">
---
title: Taro.notifyBLECharacteristicValueChange(option)
sidebar_label: notifyBLECharacteristicValueChange
---

启用低功耗蓝牙设备特征值变化时的 notify 功能，订阅特征值。注意：必须设备的特征值支持 notify 或者 indicate 才可以成功调用。

另外，必须先启用 `notifyBLECharacteristicValueChange` 才能监听到设备 `characteristicValueChange` 事件

**注意**
- 订阅操作成功后需要设备主动更新特征值的 value，才会触发 Taro.onBLECharacteristicValueChange 回调。
- 安卓平台上，在调用 `notifyBLECharacteristicValueChange` 成功后立即调用 `writeBLECharacteristicValue` 接口，在部分机型上会发生 10008 系统错误

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.notifyBLECharacteristicValueChange.html)

## 类型

```tsx
(option: Option) => Promise<Promised>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Promised

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 成功：ok，错误：详细信息 |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| characteristicId | `string` |  | 是 | 蓝牙特征值的 uuid |
| deviceId | `string` |  | 是 | 蓝牙设备 id |
| serviceId | `string` |  | 是 | 蓝牙特征值对应服务的 uuid |
| state | `boolean` |  | 是 | 是否启用 notify |
| type | `keyof Type` | `"indication"` | 否 | 设置特征订阅类型，有效值有 notification 和 indication |
| complete | `(res: TaroGeneral.BluetoothError) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.BluetoothError) => void` |  | 否 | 接口调用成功的回调函数 |

### Type

## 示例代码

```tsx
Taro.notifyBLECharacteristicValueChange({
  state: true, // 启用 notify 功能
  // 这里的 deviceId 需要已经通过 createBLEConnection 与对应设备建立链接
  deviceId,
  // 这里的 serviceId 需要在 getBLEDeviceServices 接口中获取
  serviceId,
  // 这里的 characteristicId 需要在 getBLEDeviceCharacteristics 接口中获取
  characteristicId,
  success: function (res) {
    console.log('notifyBLECharacteristicValueChange success', res.errMsg)
  }
})
```
</file>

<file path="docs/apis/device/bluetooth-ble/offBLECharacteristicValueChange.md">
---
title: Taro.offBLECharacteristicValueChange(callback)
sidebar_label: offBLECharacteristicValueChange
---

取消监听蓝牙低功耗设备的特征值变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.offBLECharacteristicValueChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 低功耗蓝牙设备的特征值变化事件的回调函数 |
</file>

<file path="docs/apis/device/bluetooth-ble/offBLEConnectionStateChange.md">
---
title: Taro.offBLEConnectionStateChange(callback)
sidebar_label: offBLEConnectionStateChange
---

取消监听蓝牙低功耗连接状态的改变事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.offBLEConnectionStateChange.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 蓝牙低功耗连接状态的改变事件的回调函数 |
</file>

<file path="docs/apis/device/bluetooth-ble/offBLEMTUChange.md">
---
title: Taro.offBLEMTUChange(callback)
sidebar_label: offBLEMTUChange
---

取消监听蓝牙低功耗的最大传输单元变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.offBLEMTUChange.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 蓝牙低功耗的最大传输单元变化事件的回调函数 |
</file>

<file path="docs/apis/device/bluetooth-ble/onBLECharacteristicValueChange.md">
---
title: Taro.onBLECharacteristicValueChange(callback)
sidebar_label: onBLECharacteristicValueChange
---

监听低功耗蓝牙设备的特征值变化事件。必须先启用 `notifyBLECharacteristicValueChange` 接口才能接收到设备推送的 notification。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.onBLECharacteristicValueChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 低功耗蓝牙设备的特征值变化事件的回调函数 |

### Callback

低功耗蓝牙设备的特征值变化事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| characteristicId | `string` | 蓝牙特征值的 uuid |
| deviceId | `string` | 蓝牙设备 id |
| serviceId | `string` | 蓝牙特征值对应服务的 uuid |
| value | `ArrayBuffer` | 特征值最新的值 |

## 示例代码

```tsx
// ArrayBuffer转16进制字符串示例
function ab2hex(buffer) {
  let hexArr = Array.prototype.map.call(
    new Uint8Array(buffer),
    function(bit) {
      return ('00' + bit.toString(16)).slice(-2)
    }
  )
  return hexArr.join('');
}
Taro.onBLECharacteristicValueChange(function (res) {
  console.log(`characteristic ${res.characteristicId} has changed, now is ${res.value}`)
  console.log(ab2hex(res.value))
})
```
</file>

<file path="docs/apis/device/bluetooth-ble/onBLEConnectionStateChange.md">
---
title: Taro.onBLEConnectionStateChange(callback)
sidebar_label: onBLEConnectionStateChange
---

监听低功耗蓝牙连接状态的改变事件。包括开发者主动连接或断开连接，设备丢失，连接异常断开等等

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.onBLEConnectionStateChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 低功耗蓝牙连接状态的改变事件的回调函数 |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| connected | `boolean` | 是否处于已连接状态 |
| deviceId | `string` | 蓝牙设备ID |

### Callback

低功耗蓝牙连接状态的改变事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

## 示例代码

```tsx
Taro.onBLEConnectionStateChange(function (res) {
  // 该方法回调中可以用于处理连接意外断开等异常情况
  console.log(`device ${res.deviceId} state has changed, connected: ${res.connected}`)
})
```
</file>

<file path="docs/apis/device/bluetooth-ble/onBLEMTUChange.md">
---
title: Taro.onBLEMTUChange(callback)
sidebar_label: onBLEMTUChange
---

监听蓝牙低功耗的最大传输单元变化事件（仅安卓触发）

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.onBLEMTUChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 蓝牙低功耗的最大传输单元变化事件的回调函数 |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| deviceId | `string` | 蓝牙设备ID |
| mtu | `string` | 最大传输单元 |

### Callback

蓝牙低功耗的最大传输单元变化事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

## 示例代码

```tsx
Taro.onBLEMTUChange(function (res) {
  console.log('bluetooth mtu is', res.mtu)
})
```
</file>

<file path="docs/apis/device/bluetooth-ble/readBLECharacteristicValue.md">
---
title: Taro.readBLECharacteristicValue(option)
sidebar_label: readBLECharacteristicValue
---

读取低功耗蓝牙设备的特征值的二进制数据值。注意：必须设备的特征值支持 read 才可以成功调用。

**注意**
- 并行调用多次会存在读失败的可能性。
- 接口读取到的信息需要在 `onBLECharacteristicValueChange` 方法注册的回调中获取。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.readBLECharacteristicValue.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.BluetoothError>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| characteristicId | `string` | 是 | 蓝牙特征值的 uuid |
| deviceId | `string` | 是 | 蓝牙设备 id |
| serviceId | `string` | 是 | 蓝牙特征值对应服务的 uuid |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
// 必须在这里的回调才能获取
Taro.onBLECharacteristicValueChange(function(characteristic) {
  console.log('characteristic value comed:', characteristic)
})
Taro.readBLECharacteristicValue({
  // 这里的 deviceId 需要已经通过 createBLEConnection 与对应设备建立链接
  deviceId,
  // 这里的 serviceId 需要在 getBLEDeviceServices 接口中获取
  serviceId,
  // 这里的 characteristicId 需要在 getBLEDeviceCharacteristics 接口中获取
  characteristicId,
  success: function (res) {
    console.log('readBLECharacteristicValue:', res.errCode)
  }
})
```
</file>

<file path="docs/apis/device/bluetooth-ble/setBLEMTU.md">
---
title: Taro.setBLEMTU(option)
sidebar_label: setBLEMTU
---

协商设置蓝牙低功耗的最大传输单元 (Maximum Transmission Unit, MTU)

- 需在 Taro.createBLEConnection 调用成功后调用
- 仅安卓系统 5.1 以上版本有效，iOS 因系统限制不支持。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.setBLEMTU.html)

## 类型

```tsx
(option: Option) => Promise<Promised>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Promised

```tsx
FailCallbackResult | SuccessCallbackResult
```

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| deviceId | `string` | 是 | 蓝牙设备 id |
| mtu | `number` | 是 | 最大传输单元。设置范围为 (22,512) 区间内，单位 bytes |
| complete | `(res: Promised) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: FailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### FailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| mtu | `string` | 最终协商的 MTU 值。如果协商失败则无此参数。安卓客户端 8.0.9 开始支持。 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| mtu | `string` | 最终协商的 MTU 值，与传入参数一致。安卓客户端 8.0.9 开始支持。 |
</file>

<file path="docs/apis/device/bluetooth-ble/writeBLECharacteristicValue.md">
---
title: Taro.writeBLECharacteristicValue(option)
sidebar_label: writeBLECharacteristicValue
---

向低功耗蓝牙设备特征值中写入二进制数据。注意：必须设备的特征值支持 write 才可以成功调用。

**注意**
- 并行调用多次会存在写失败的可能性。
- 小程序不会对写入数据包大小做限制，但系统与蓝牙设备会限制蓝牙4.0单次传输的数据大小，超过最大字节数后会发生写入错误，建议每次写入不超过20字节。
- 若单次写入数据过长，iOS 上存在系统不会有任何回调的情况（包括错误回调）。
- 安卓平台上，在调用 `notifyBLECharacteristicValueChange` 成功后立即调用 `writeBLECharacteristicValue` 接口，在部分机型上会发生 10008 系统错误

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-ble/wx.writeBLECharacteristicValue.html)

## 类型

```tsx
(option: Option) => Promise<Promised>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Promised

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 成功：ok，错误：详细信息 |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| characteristicId | `string` | 是 | 蓝牙特征值的 uuid |
| deviceId | `string` | 是 | 蓝牙设备 id |
| serviceId | `string` | 是 | 蓝牙特征值对应服务的 uuid |
| value | `ArrayBuffer` | 是 | 蓝牙设备特征值对应的二进制值 |
| writeType | `keyof WriteType` | 否 | 蓝牙特征值的写模式设置，有两种模式，iOS 优先 write，安卓优先 writeNoResponse 。（基础库 2.22.0 开始支持） |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用成功的回调函数 |

### WriteType

| 参数 | 说明 |
| --- | --- |
| write | 强制回复写，不支持时报错 |
| writeNoResponse | 强制无回复写，不支持时报错 |

## 示例代码

```tsx
// 向蓝牙设备发送一个0x00的16进制数据
let buffer = new ArrayBuffer(1)
let dataView = new DataView(buffer)
dataView.setUint8(0, 0)
Taro.writeBLECharacteristicValue({
  // 这里的 deviceId 需要在 getBluetoothDevices 或 onBluetoothDeviceFound 接口中获取
  deviceId,
  // 这里的 serviceId 需要在 getBLEDeviceServices 接口中获取
  serviceId,
  // 这里的 characteristicId 需要在 getBLEDeviceCharacteristics 接口中获取
  characteristicId,
  // 这里的value是ArrayBuffer类型
  value: buffer,
  success: function (res) {
    console.log('writeBLECharacteristicValue success', res.errMsg)
  }
})
```
</file>

<file path="docs/apis/device/bluetooth-peripheral/BLEPeripheralServer.md">
---
title: BLEPeripheralServer
sidebar_label: BLEPeripheralServer
---

外围设备的服务端

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.html)

## 方法

### addService

添加服务

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.addService.html)

```tsx
(option: Option) => Promise<TaroGeneral.BluetoothError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### close

关闭当前服务端

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.close.html)

```tsx
(option: Option) => Promise<TaroGeneral.BluetoothError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### offCharacteristicReadRequest

取消监听已连接的设备请求读当前外围设备的特征值事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.offCharacteristicReadRequest.html)

```tsx
(callback?: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 已连接的设备请求读当前外围设备的特征值事件的回调函数 |

### offCharacteristicSubscribed

取消监听特征订阅事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.offCharacteristicSubscribed.html)

```tsx
(callback?: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 特征订阅事件的回调函数 |

### offCharacteristicUnsubscribed

取消监听取消特征订阅事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.offCharacteristicUnsubscribed.html)

```tsx
(callback?: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 取消特征订阅事件的回调函数 |

### offCharacteristicWriteRequest

取消监听已连接的设备请求写当前外围设备的特征值事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.offCharacteristicWriteRequest.html)

```tsx
(callback?: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 已连接的设备请求写当前外围设备的特征值事件的回调函数 |

### onCharacteristicReadRequest

监听已连接的设备请求读当前外围设备的特征值事件

收到该消息后需要立刻调用 [writeCharacteristicValue](/docs/apis/device/bluetooth-peripheral/BLEPeripheralServer#writecharacteristicvalue) 写回数据，否则主机不会收到响应。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.onCharacteristicReadRequest.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 已连接的设备请求读当前外围设备的特征值事件的回调函数 |

### onCharacteristicSubscribed

监听特征订阅事件，仅 iOS 支持

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.onCharacteristicSubscribed.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 特征订阅事件的回调函数 |

### onCharacteristicUnsubscribed

监听取消特征订阅事件，仅 iOS 支持

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.onCharacteristicUnsubscribed.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 取消特征订阅事件的回调函数 |

### onCharacteristicWriteRequest

监听已连接的设备请求写当前外围设备的特征值事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.onCharacteristicWriteRequest.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 已连接的设备请求写当前外围设备的特征值事件的回调函数 |

### removeService

移除服务

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.removeService.html)

```tsx
(option: Option) => Promise<TaroGeneral.BluetoothError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### startAdvertising

开始广播本地创建的外围设备

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.startAdvertising.html)

```tsx
(option: Option) => Promise<TaroGeneral.BluetoothError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### stopAdvertising

停止广播

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.stopAdvertising.html)

```tsx
(option: Option) => Promise<TaroGeneral.BluetoothError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### writeCharacteristicValue

往指定特征写入二进制数据值，并通知已连接的主机，从机的特征值已发生变化，该接口会处理是走回包还是走订阅

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/BLEPeripheralServer.writeCharacteristicValue.html)

```tsx
(option: Option) => Promise<TaroGeneral.BluetoothError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

## 参数

### addService

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| service | `service` | 是 | 描述 service 的 Object |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用成功的回调函数 |

#### service

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| uuid | `string` | 蓝牙服务的 UUID |
| characteristics | `characteristic[]` | characteristics 列表 |

#### characteristic

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| uuid | `string` | 是 | characteristic 的 UUID |
| properties | `properties` | 否 | 特征支持的操作 |
| permission | `characteristicPermission` | 否 | 特征权限 |
| value | `ArrayBuffer` | 否 | 特征对应的二进制值 |
| descriptors | `descriptor[]` | 否 | 描述符数据 |

#### properties

特征支持的操作

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| write | `boolean` | `false` | 否 | 写 |
| writeNoResponse | `boolean` | `false` | 否 | 无回复写 |
| read | `boolean` | `false` | 否 | 读 |
| notify | `boolean` | `false` | 否 | 订阅 |
| indicate | `boolean` | `false` | 否 | 回包 |

#### characteristicPermission

特征权限

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| readable | `boolean` | `false` | 否 | 可读 |
| writeable | `boolean` | `false` | 否 | 可写 |
| readEncryptionRequired | `boolean` | `false` | 否 | 加密读请求 |
| writeEncryptionRequired | `boolean` | `false` | 否 | 加密写请求 |

#### descriptor

描述符数据

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| uuid | `string` | 是 | Descriptor 的 UUID |
| permission | `descriptorPermission` | 否 | 描述符的权限 |
| value | `ArrayBuffer` | 是 | 描述符数据 |

#### descriptorPermission

描述符的权限

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| write | `boolean` | `false` | 否 | 写 |
| read | `boolean` | `false` | 否 | 读 |

### close

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用成功的回调函数 |

### onCharacteristicReadRequest

#### Callback

已连接的设备请求读当前外围设备的特征值事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

#### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| serviceId | `string` | 蓝牙特征对应服务的 UUID |
| characteristicId | `string` | 蓝牙特征的 UUID |
| callbackId | `number` | 唯一标识码，调用 [writeCharacteristicValue](/docs/apis/device/bluetooth-peripheral/BLEPeripheralServer#writecharacteristicvalue) 时使用 |

### onCharacteristicSubscribed

#### Callback

特征订阅事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

#### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| serviceId | `string` | 蓝牙特征对应服务的 UUID |
| characteristicId | `string` | 蓝牙特征的 UUID |

### onCharacteristicUnsubscribed

#### Callback

取消特征订阅事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

#### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| serviceId | `string` | 蓝牙特征对应服务的 UUID |
| characteristicId | `string` | 蓝牙特征的 UUID |

### onCharacteristicWriteRequest

#### Callback

已连接的设备请求写当前外围设备的特征值事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

#### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| serviceId | `string` | 蓝牙特征对应服务的 UUID |
| characteristicId | `string` | 蓝牙特征的 UUID |
| callbackId | `number` | 唯一标识码，调用 [writeCharacteristicValue](/docs/apis/device/bluetooth-peripheral/BLEPeripheralServer#writecharacteristicvalue) 时使用 |
| value | `ArrayBuffer` | 请求写入特征的二进制数据值 |

### removeService

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| serviceId | `string` | 是 | service 的 UUID |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用成功的回调函数 |

### startAdvertising

#### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| advertiseRequest | `advertiseRequest` |  | 是 | 广播自定义参数 |
| powerLevel | `keyof PowerLevel` | `"medium"` | 否 | 广播功率 |
| complete | `(res: TaroGeneral.BluetoothError) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.BluetoothError) => void` |  | 否 | 接口调用成功的回调函数 |

#### advertiseRequest

广播自定义参数

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| connectable | `boolean` | `true` | 否 | 当前设备是否可连接 |
| deviceName | `string` | `""` | 否 | 广播中 deviceName 字段，默认为空 |
| serviceUuids | `string[]` |  | 否 | 要广播的服务 UUID 列表。使用 16/32 位 UUID 时请参考注意事项。 |
| manufacturerData | `manufacturerData[]` |  | 否 | 广播的制造商信息。仅安卓支持，iOS 因系统限制无法定制。 |
| beacon | `beacon` |  | 否 | 以 beacon 设备形式广播的参数。 |

#### manufacturerData

广播的制造商信息。仅安卓支持，iOS 因系统限制无法定制。

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| manufacturerId | `string` | 是 | 制造商ID，0x 开头的十六进制 |
| manufacturerSpecificData | `ArrayBuffer` | 否 | 制造商信息 |

#### beacon

以 beacon 设备形式广播的参数。

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| uuid | `string` | 是 | Beacon 设备广播的 UUID |
| major | `number` | 是 | Beacon 设备的主 ID |
| minor | `number` | 是 | Beacon 设备的次 ID |
| measuredPower | `number` | 否 | 用于判断距离设备 1 米时 RSSI 大小的参考值 |

#### PowerLevel

广播功率合法值

| 参数 | 说明 |
| --- | --- |
| low | 功率低 |
| medium | 功率适中 |
| high | 功率高 |

### stopAdvertising

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用成功的回调函数 |

### writeCharacteristicValue

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| serviceId | `string` | 是 | 蓝牙特征对应服务的 UUID |
| characteristicId | `string` | 是 | 蓝牙特征的 UUID |
| value | `ArrayBuffer` | 是 | characteristic 对应的二进制值 |
| needNotify | `boolean` | 是 | 是否需要通知主机 value 已更新 |
| callbackId | `number` | 否 | 可选，处理回包时使用 |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用成功的回调函数 |

## API 支持度

| API | 微信小程序 | 京东小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| BLEPeripheralServer | ✔️ |  |  |  |  |  |
| BLEPeripheralServer.addService | ✔️ | ✔️ |  |  |  |  |
| BLEPeripheralServer.close | ✔️ |  |  |  |  |  |
| BLEPeripheralServer.offCharacteristicReadRequest | ✔️ | ✔️ |  |  |  |  |
| BLEPeripheralServer.offCharacteristicSubscribed | ✔️ | ✔️ |  |  |  |  |
| BLEPeripheralServer.offCharacteristicUnsubscribed | ✔️ |  |  |  |  |  |
| BLEPeripheralServer.offCharacteristicWriteRequest | ✔️ | ✔️ |  |  |  |  |
| BLEPeripheralServer.onCharacteristicReadRequest | ✔️ | ✔️ |  |  |  |  |
| BLEPeripheralServer.onCharacteristicSubscribed | ✔️ | ✔️ |  |  |  |  |
| BLEPeripheralServer.onCharacteristicUnsubscribed | ✔️ | ✔️ |  |  |  |  |
| BLEPeripheralServer.onCharacteristicWriteRequest | ✔️ | ✔️ |  |  |  |  |
| BLEPeripheralServer.removeService | ✔️ | ✔️ |  |  |  |  |
| BLEPeripheralServer.startAdvertising | ✔️ | ✔️ |  |  |  |  |
| BLEPeripheralServer.stopAdvertising | ✔️ | ✔️ |  |  |  |  |
| BLEPeripheralServer.writeCharacteristicValue | ✔️ | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/device/bluetooth-peripheral/createBLEPeripheralServer.md">
---
title: Taro.createBLEPeripheralServer(option)
sidebar_label: createBLEPeripheralServer
---

建立本地作为蓝牙低功耗外围设备的服务端，可创建多个

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/wx.createBLEPeripheralServer.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.BluetoothError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| server | `BLEPeripheralServer` | 外围设备的服务端 |
</file>

<file path="docs/apis/device/bluetooth-peripheral/offBLEPeripheralConnectionStateChanged.md">
---
title: Taro.offBLEPeripheralConnectionStateChanged(callback)
sidebar_label: offBLEPeripheralConnectionStateChanged
---

取消监听当前外围设备被连接或断开连接事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/wx.offBLEPeripheralConnectionStateChanged.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 当前外围设备被连接或断开连接事件的回调函数 |
</file>

<file path="docs/apis/device/bluetooth-peripheral/onBLEPeripheralConnectionStateChanged.md">
---
title: Taro.onBLEPeripheralConnectionStateChanged(callback)
sidebar_label: onBLEPeripheralConnectionStateChanged
---

监听当前外围设备被连接或断开连接事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/bluetooth-peripheral/wx.onBLEPeripheralConnectionStateChanged.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 监听当前外围设备被连接或断开连接事件 |

### Callback

当前外围设备被连接或断开连接事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| deviceId | `string` | 蓝牙设备 id |
| serverId | `string` | server 的 UUID |
| connected | `boolean` | 连接目前状态 |
</file>

<file path="docs/apis/device/calendar/addPhoneCalendar.md">
---
title: Taro.addPhoneCalendar(option)
sidebar_label: addPhoneCalendar
---

向系统日历添加事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/calendar/wx.addPhoneCalendar.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| title | `string` |  | 是 | 日历事件标题 |
| startTime | `number` |  | 是 | 开始时间的 unix 时间戳 (1970年1月1日开始所经过的秒数) |
| allDay | `boolean` | `false` | 否 | 是否全天事件 |
| description | `string` |  | 否 | 事件说明 |
| location | `string` |  | 否 | 事件位置 |
| endTime | `string` |  | 否 | 结束时间的 unix 时间戳，默认与开始时间相同 |
| alarm | `boolean` | `true` | 否 | 是否提醒 |
| alarmOffset | `number` | `0` | 否 | 提醒提前量，单位秒，默认 0 表示开始时提醒 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/device/calendar/addPhoneRepeatCalendar.md">
---
title: Taro.addPhoneRepeatCalendar(option)
sidebar_label: addPhoneRepeatCalendar
---

向系统日历添加重复事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/calendar/wx.addPhoneRepeatCalendar.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| title | `string` |  | 是 | 日历事件标题 |
| startTime | `number` |  | 是 | 开始时间的 unix 时间戳 (1970年1月1日开始所经过的秒数) |
| allDay | `boolean` | `false` | 否 | 是否全天事件 |
| description | `string` |  | 否 | 事件说明 |
| location | `string` |  | 否 | 事件位置 |
| endTime | `string` |  | 否 | 结束时间的 unix 时间戳，默认与开始时间相同 |
| alarm | `boolean` | `true` | 否 | 是否提醒 |
| alarmOffset | `number` | `0` | 否 | 提醒提前量，单位秒，默认 0 表示开始时提醒 |
| repeatInterval | `keyof RepeatInterval` | `"month"` | 否 | 重复周期，默认 month 每月重复 |
| repeatEndTime | `number` |  | 否 | 重复周期结束时间的 unix 时间戳，不填表示一直重复 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(result: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### RepeatInterval

| 参数 | 说明 |
| --- | --- |
| day | 每天重复 |
| week | 每周重复 |
| month | 每月重复。该模式日期不能大于 28 日 |
| year | 每年重复 |
</file>

<file path="docs/apis/device/clipboard/getClipboardData.md">
---
title: Taro.getClipboardData(res)
sidebar_label: getClipboardData
---

获取系统剪贴板内容

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> H5: 部分实现

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/clipboard/wx.getClipboardData.html)

## 类型

```tsx
(res?: Option) => Promise<Promised>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| res | `Option` |

### Promised

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 调用信息 |
| data | `string` | 剪贴板的内容 |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackOption) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackOption

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | `string` | 剪贴板的内容 |

## 示例代码

```tsx
Taro.getClipboardData({
  success: function (res){
    console.log(res.data)
  }
})
```
</file>

<file path="docs/apis/device/clipboard/setClipboardData.md">
---
title: Taro.setClipboardData(option)
sidebar_label: setClipboardData
---

设置系统剪贴板的内容。调用成功后，会弹出 toast 提示"内容已复制"，持续 1.5s

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> H5: 部分实现

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/clipboard/wx.setClipboardData.html)

## 类型

```tsx
(option: Option) => Promise<Promised>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Promised

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 调用信息 |
| data | `string` | 剪贴板的内容 |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `string` | 是 | 剪贴板的内容 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.setClipboardData({
  data: 'data',
  success: function (res) {
    Taro.getClipboardData({
      success: function (res) {
        console.log(res.data) // data
      }
    })
  }
})
```
</file>

<file path="docs/apis/device/compass/offCompassChange.md">
---
title: Taro.offCompassChange(callback)
sidebar_label: offCompassChange
---

取消监听罗盘数据变化事件，参数为空，则取消所有的事件监听。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/compass/wx.offCompassChange.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 罗盘数据变化事件的回调函数 |
</file>

<file path="docs/apis/device/compass/onCompassChange.md">
---
title: Taro.onCompassChange(callback)
sidebar_label: onCompassChange
---

监听罗盘数据变化事件。频率：5 次/秒，接口调用后会自动开始监听，可使用 Taro.stopCompass 停止监听。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/compass/wx.onCompassChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 罗盘数据变化事件的回调函数 |

### Callback

罗盘数据变化事件的回调函数

```tsx
(result: OnCompassChangeCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnCompassChangeCallbackResult` |

### OnCompassChangeCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| accuracy | string or number | 精度<br /><br />由于平台差异，accuracy 在 iOS/Android 的值不同。<br /><br />- iOS：accuracy 是一个 number 类型的值，表示相对于磁北极的偏差。0 表示设备指向磁北，90 表示指向东，180 表示指向南，依此类推。<br />- Android：accuracy 是一个 string 类型的枚举值。 |
| direction | `number` | 面对的方向度数 |

### accuracy

| 参数 | 说明 |
| --- | --- |
| high | 高精度 |
| medium | 中等精度 |
| low | 低精度 |
| no-contact | 不可信，传感器失去连接 |
| unreliable | 不可信，原因未知 |
| unknow ${value} | 未知的精度枚举值，即该 Android 系统此时返回的表示精度的 value 不是一个标准的精度枚举值 |

## 示例代码

```tsx
Taro.onCompassChange(function (res) {
  console.log(res.direction)
})
```
</file>

<file path="docs/apis/device/compass/startCompass.md">
---
title: Taro.startCompass(option)
sidebar_label: startCompass
---

开始监听罗盘数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/compass/wx.startCompass.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```js
Taro.startCompass()
```
</file>

<file path="docs/apis/device/compass/stopCompass.md">
---
title: Taro.stopCompass(option)
sidebar_label: stopCompass
---

停止监听罗盘数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/compass/wx.stopCompass.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.stopCompass()
```
</file>

<file path="docs/apis/device/contact/addPhoneContact.md">
---
title: Taro.addPhoneContact(option)
sidebar_label: addPhoneContact
---

添加手机通讯录联系人。用户可以选择将该表单以「新增联系人」或「添加到已有联系人」的方式，写入手机系统通讯录。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/contact/wx.addPhoneContact.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| firstName | `string` | 是 | 名字 |
| photoFilePath | `string` | 否 | 头像本地文件路径 |
| nickName | `string` | 否 | 昵称 |
| middleName | `string` | 否 | 中间名 |
| lastName | `string` | 否 | 姓氏 |
| remark | `string` | 否 | 备注 |
| mobilePhoneNumber | `string` | 否 | 手机号 |
| weChatNumber | `string` | 否 | 微信号 |
| addressCountry | `string` | 否 | 联系地址国家 |
| addressState | `string` | 否 | 联系地址省份 |
| addressCity | `string` | 否 | 联系地址城市 |
| addressStreet | `string` | 否 | 联系地址街道 |
| addressPostalCode | `string` | 否 | 联系地址邮政编码 |
| organization | `string` | 否 | 公司 |
| title | `string` | 否 | 职位 |
| workFaxNumber | `string` | 否 | 工作传真 |
| workPhoneNumber | `string` | 否 | 工作电话 |
| hostNumber | `string` | 否 | 公司电话 |
| email | `string` | 否 | 电子邮件 |
| url | `string` | 否 | 网站 |
| workAddressCountry | `string` | 否 | 工作地址国家 |
| workAddressState | `string` | 否 | 工作地址省份 |
| workAddressCity | `string` | 否 | 工作地址城市 |
| workAddressStreet | `string` | 否 | 工作地址街道 |
| workAddressPostalCode | `string` | 否 | 工作地址邮政编码 |
| homeFaxNumber | `string` | 否 | 住宅传真 |
| homePhoneNumber | `string` | 否 | 住宅电话 |
| homeAddressCountry | `string` | 否 | 住宅地址国家 |
| homeAddressState | `string` | 否 | 住宅地址省份 |
| homeAddressCity | `string` | 否 | 住宅地址城市 |
| homeAddressStreet | `string` | 否 | 住宅地址街道 |
| homeAddressPostalCode | `string` | 否 | 住宅地址邮政编码 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/device/contact/chooseContact.md">
---
title: Taro.chooseContact(option)
sidebar_label: chooseContact
---

添加手机通讯录联系人。用户可以选择将该表单以「新增联系人」或「添加到已有联系人」的方式，写入手机系统通讯录。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/contact/wx.chooseContact.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| phoneNumber | `string` | 手机号 |
| displayName | `string` | 联系人姓名 |
| phoneNumberList | `string` | 选定联系人的所有手机号（部分 Android 系统只能选联系人而不能选特定手机号） |
</file>

<file path="docs/apis/device/gyroscope/offGyroscopeChange.md">
---
title: Taro.offGyroscopeChange(callback)
sidebar_label: offGyroscopeChange
---

取消监听陀螺仪数据变化事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/gyroscope/wx.offGyroscopeChange.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 陀螺仪数据变化事件的回调函数 |
</file>

<file path="docs/apis/device/gyroscope/onGyroscopeChange.md">
---
title: Taro.onGyroscopeChange(callback)
sidebar_label: onGyroscopeChange
---

监听陀螺仪数据变化事件。频率根据 Taro.startGyroscope() 的 interval 参数。可以使用 Taro.stopGyroscope() 停止监听。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/gyroscope/wx.onGyroscopeChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 陀螺仪数据变化事件的回调函数 |

### Callback

陀螺仪数据变化事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | x 轴的角速度 |
| y | `number` | y 轴的角速度 |
| z | `number` | z 轴的角速度 |
</file>

<file path="docs/apis/device/gyroscope/startGyroscope.md">
---
title: Taro.startGyroscope(option)
sidebar_label: startGyroscope
---

开始监听陀螺仪数据。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/gyroscope/wx.startGyroscope.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| interval | `keyof Interval` | 否 | 监听陀螺仪数据回调函数的执行频率 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### Interval

监听陀螺仪数据回调函数的执行频率

| 参数 | 说明 |
| --- | --- |
| game | 适用于更新游戏的回调频率，在 20ms/次 左右 |
| ui | 适用于更新 UI 的回调频率，在 60ms/次 左右 |
| normal | 普通的回调频率，在 200ms/次 左右 |
</file>

<file path="docs/apis/device/gyroscope/stopGyroscope.md">
---
title: Taro.stopGyroscope(option)
sidebar_label: stopGyroscope
---

停止监听陀螺仪数据。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/gyroscope/wx.stopGyroscope.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/device/iBeacon/getBeacons.md">
---
title: Taro.getBeacons(option)
sidebar_label: getBeacons
---

获取所有已搜索到的 iBeacon 设备

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/ibeacon/wx.getBeacons.html)

## 类型

```tsx
(option?: Option) => Promise<CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.IBeaconError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.IBeaconError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| beacons | `IBeaconInfo[]` | iBeacon 设备列表 |
| errMsg | `string` | 调用结果 |
</file>

<file path="docs/apis/device/iBeacon/IBeaconInfo.md">
---
title: IBeaconInfo
sidebar_label: IBeaconInfo
---

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| uuid | `string` | Beacon 设备广播的 uuid |
| major | `string` | Beacon 设备的主 ID |
| minor | `string` | Beacon 设备的次 ID |
| proximity | `keyof Proximity` | 表示设备距离的枚举值（仅iOS） |
| accuracy | `number` | Beacon 设备的距离，单位 m。iOS 上，proximity 为 0 时，accuracy 为 -1。 |
| rssi | `number` | 表示设备的信号强度，单位 dBm |

## 参数

### Proximity

proximity 的合法值

| 参数 | 说明 |
| --- | --- |
| 0 | 信号太弱不足以计算距离，或非 iOS 设备 |
| 1 | 十分近 |
| 2 | 比较近 |
| 3 | 远 |
</file>

<file path="docs/apis/device/iBeacon/offBeaconServiceChange.md">
---
title: Taro.offBeaconServiceChange(callback)
sidebar_label: offBeaconServiceChange
---

取消监听 iBeacon 服务状态变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/ibeacon/wx.offBeaconServiceChange.html)

## 类型

```tsx
(callback: (res: TaroGeneral.IBeaconError) => void) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.IBeaconError) => void` | iBeacon 服务状态变化事件的回调函数 |
</file>

<file path="docs/apis/device/iBeacon/offBeaconUpdate.md">
---
title: Taro.offBeaconUpdate(callback)
sidebar_label: offBeaconUpdate
---

取消监听 iBeacon 设备更新事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/ibeacon/wx.offBeaconUpdate.html)

## 类型

```tsx
(callback: (res: TaroGeneral.IBeaconError) => void) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.IBeaconError) => void` | iBeacon 设备更新事件的回调函数 |
</file>

<file path="docs/apis/device/iBeacon/onBeaconServiceChange.md">
---
title: Taro.onBeaconServiceChange(callback)
sidebar_label: onBeaconServiceChange
---

监听 iBeacon 服务状态变化事件，仅能注册一个监听

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/ibeacon/wx.onBeaconServiceChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | iBeacon 服务状态变化事件的回调函数 |

### Callback

iBeacon 服务状态变化事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| available | `boolean` | 服务目前是否可用 |
| discovering | `boolean` | 目前是否处于搜索状态 |
</file>

<file path="docs/apis/device/iBeacon/onBeaconUpdate.md">
---
title: Taro.onBeaconUpdate(callback)
sidebar_label: onBeaconUpdate
---

监听 iBeacon 设备更新事件，仅能注册一个监听

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/ibeacon/wx.onBeaconUpdate.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | iBeacon 设备更新事件的回调函数 |

### Callback

iBeacon 设备更新事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| beacons | `IBeaconInfo[]` | 当前搜寻到的所有 iBeacon 设备列表 |
</file>

<file path="docs/apis/device/iBeacon/startBeaconDiscovery.md">
---
title: Taro.startBeaconDiscovery(option)
sidebar_label: startBeaconDiscovery
---

开始搜索附近的 iBeacon 设备

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/ibeacon/wx.startBeaconDiscovery.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.IBeaconError>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| uuids | `string[]` |  | 是 | iBeacon 设备广播的 uuid 列表 |
| complete | `(res: TaroGeneral.IBeaconError) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.IBeaconError) => void` |  | 否 | 接口调用失败的回调函数 |
| ignoreBluetoothAvailable | `boolean` | `false` | 否 | 是否校验蓝牙开关，仅在 iOS 下有效 |
| success | `(res: TaroGeneral.IBeaconError) => void` |  | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.startBeaconDiscovery({
  success: function (res) { }
})
```
</file>

<file path="docs/apis/device/iBeacon/stopBeaconDiscovery.md">
---
title: Taro.stopBeaconDiscovery(option)
sidebar_label: stopBeaconDiscovery
---

停止搜索附近的 iBeacon 设备

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/ibeacon/wx.stopBeaconDiscovery.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.IBeaconError>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.IBeaconError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.IBeaconError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.IBeaconError) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.stopBeaconDiscovery(params).then(...)
```
</file>

<file path="docs/apis/device/keyboard/getSelectedTextRange.md">
---
title: Taro.getSelectedTextRange(option)
sidebar_label: getSelectedTextRange
---

在input、textarea等focus之后，获取输入框的光标位置。注意：只有在focus的时候调用此接口才有效。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/keyboard/wx.getSelectedTextRange.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| end | `number` | 输入框光标结束位置 |
| start | `number` | 输入框光标起始位置 |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
Taro.getSelectedTextRange({
  complete: res => {
    console.log('getSelectedTextRange res', res.start, res.end)
  }
})
```
</file>

<file path="docs/apis/device/keyboard/hideKeyboard.md">
---
title: Taro.hideKeyboard(option)
sidebar_label: hideKeyboard
---

在input、textarea等focus拉起键盘之后，手动调用此接口收起键盘

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/keyboard/wx.hideKeyboard.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.hideKeyboard({
  complete: res => {
    console.log('hideKeyboard res', res)
  }
})
```
</file>

<file path="docs/apis/device/keyboard/offKeyboardHeightChange.md">
---
title: Taro.offKeyboardHeightChange(callback)
sidebar_label: offKeyboardHeightChange
---

取消监听键盘高度变化事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/keyboard/wx.offKeyboardHeightChange.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 键盘高度变化事件的回调函数 |
</file>

<file path="docs/apis/device/keyboard/onKeyboardHeightChange.md">
---
title: Taro.onKeyboardHeightChange(callback)
sidebar_label: onKeyboardHeightChange
---

监听键盘高度变化

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/keyboard/wx.onKeyboardHeightChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |

### Callback

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| height | `number` | 键盘高度 |

## 示例代码

```tsx
Taro.onKeyboardHeightChange(res => {
  console.log(res.height)
})
```
</file>

<file path="docs/apis/device/memory/offMemoryWarning.md">
---
title: Taro.offMemoryWarning(callback)
sidebar_label: offMemoryWarning
---

取消监听内存不足告警事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/memory/wx.offMemoryWarning.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 取消监听内存不足告警事件 |
</file>

<file path="docs/apis/device/memory/onMemoryWarning.md">
---
title: Taro.onMemoryWarning(callback)
sidebar_label: onMemoryWarning
---

监听内存不足告警事件。

当 iOS/Android 向小程序进程发出内存警告时，触发该事件。触发该事件不意味小程序被杀，大部分情况下仅仅是告警，开发者可在收到通知后回收一些不必要资源避免进一步加剧内存紧张。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/performance/wx.onMemoryWarning.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 内存不足告警事件的回调函数 |

### Callback

内存不足告警事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| level | `keyof Level` | 内存告警等级，只有 Android 才有，对应系统宏定义 |

### Level

| 参数 | 说明 |
| --- | --- |
| 5 | TRIM_MEMORY_RUNNING_MODERATE |
| 10 | TRIM_MEMORY_RUNNING_LOW |
| 15 | TRIM_MEMORY_RUNNING_CRITICAL |

## 示例代码

```tsx
Taro.onMemoryWarning(function () {
  console.log('onMemoryWarningReceive')
})
```
</file>

<file path="docs/apis/device/motion/offDeviceMotionChange.md">
---
title: Taro.offDeviceMotionChange(callback)
sidebar_label: offDeviceMotionChange
---

取消监听设备方向变化事件，参数为空，则取消所有的事件监听。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/motion/wx.offDeviceMotionChange.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 设备方向变化事件的回调函数 |
</file>

<file path="docs/apis/device/motion/onDeviceMotionChange.md">
---
title: Taro.onDeviceMotionChange(callback)
sidebar_label: onDeviceMotionChange
---

监听设备方向变化事件。频率根据 Taro.startDeviceMotionListening() 的 interval 参数。可以使用 Taro.stopDeviceMotionListening() 停止监听。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/motion/wx.onDeviceMotionChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |

### Callback

设备方向变化事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| alpha | `number` | 当 手机坐标 X/Y 和 地球 X/Y 重合时，绕着 Z 轴转动的夹角为 alpha，范围值为 [0, 2*PI)。逆时针转动为正。 |
| beta | `number` | 当手机坐标 Y/Z 和地球 Y/Z 重合时，绕着 X 轴转动的夹角为 beta。范围值为 [-1*PI, PI) 。顶部朝着地球表面转动为正。也有可能朝着用户为正。 |
| gamma | `number` | 当手机 X/Z 和地球 X/Z 重合时，绕着 Y 轴转动的夹角为 gamma。范围值为 [-1*PI/2, PI/2)。右边朝着地球表面转动为正。 |
</file>

<file path="docs/apis/device/motion/startDeviceMotionListening.md">
---
title: Taro.startDeviceMotionListening(option)
sidebar_label: startDeviceMotionListening
---

开始监听设备方向的变化。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/motion/wx.startDeviceMotionListening.html)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| interval | `keyof Interval` | `"normal"` | 否 | 监听设备方向的变化回调函数的执行频率 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### Interval

| 参数 | 说明 |
| --- | --- |
| game | 适用于更新游戏的回调频率，在 20ms/次 左右 |
| ui | 适用于更新 UI 的回调频率，在 60ms/次 左右 |
| normal | 普通的回调频率，在 200ms/次 左右 |
</file>

<file path="docs/apis/device/motion/stopDeviceMotionListening.md">
---
title: Taro.stopDeviceMotionListening(option)
sidebar_label: stopDeviceMotionListening
---

停止监听设备方向的变化。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/motion/wx.stopDeviceMotionListening.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/device/network/getLocalIPAddress.md">
---
title: Taro.getLocalIPAddress(option)
sidebar_label: getLocalIPAddress
---

获取局域网IP地址。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/network/wx.getLocalIPAddress.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| localip | `string` | 是 | 本机局域网IP地址 |
| netmask | `string` | 否 | ，基础库 2.24.0 开始支持 |
| errMsg | `string` | 是 | 调用结果 |

## 示例代码

```tsx
Taro.getLocalIPAddress()
  .then(res => {
    const localip = res.localip
  })
```
</file>

<file path="docs/apis/device/network/getNetworkType.md">
---
title: Taro.getNetworkType(option)
sidebar_label: getNetworkType
---

获取网络类型。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/network/wx.getNetworkType.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| networkType | `keyof NetworkType` | 是 | 网络类型 |
| signalStrength | `number` | 否 | 信号强弱，单位 dbm |
| hasSystemProxy | `boolean` | 否 | 设备是否使用了网络代理 |
| errMsg | `string` | 是 | 调用结果 |

### NetworkType

网络类型

| 参数 | 说明 |
| --- | --- |
| wifi | wifi 网络 |
| 2g | 2g 网络 |
| 3g | 3g 网络 |
| 4g | 4g 网络 |
| 5g | 5g 网络 |
| unknown | Android 下不常见的网络类型 |
| none | 无网络 |

## 示例代码

```tsx
Taro.getNetworkType({
  success: function (res) {
    // 返回网络类型, 有效值：
    // wifi/2g/3g/4g/unknown(Android下不常见的网络类型)/none(无网络)
    var networkType = res.networkType
  }
})
```
</file>

<file path="docs/apis/device/network/offNetworkStatusChange.md">
---
title: Taro.offNetworkStatusChange(callback)
sidebar_label: offNetworkStatusChange
---

取消监听网络状态变化事件，参数为空，则取消所有的事件监听。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/network/wx.offNetworkStatusChange.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 取消监听网络状态变化事件，参数为空，则取消所有的事件监听 |
</file>

<file path="docs/apis/device/network/offNetworkWeakChange.md">
---
title: Taro.offNetworkWeakChange(callback)
sidebar_label: offNetworkWeakChange
---

取消监听弱网状态变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/network/wx.offNetworkWeakChange.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 弱网状态变化事件的回调函数 |
</file>

<file path="docs/apis/device/network/onNetworkStatusChange.md">
---
title: Taro.onNetworkStatusChange(callback)
sidebar_label: onNetworkStatusChange
---

监听网络状态变化。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/network/wx.onNetworkStatusChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 网络状态变化事件的回调函数 |

### Callback

网络状态变化事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| isConnected | `boolean` | 当前是否有网络连接 |
| networkType | `keyof NetworkType` | 网络类型 |

## 示例代码

```tsx
Taro.onNetworkStatusChange(function (res) {
  console.log(res.isConnected)
  console.log(res.networkType)
})
```
</file>

<file path="docs/apis/device/network/onNetworkWeakChange.md">
---
title: Taro.onNetworkWeakChange(callback)
sidebar_label: onNetworkWeakChange
---

监听弱网状态变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/network/wx.onNetworkWeakChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 弱网状态变化事件的回调函数 |

### Callback

弱网状态变化事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| weakNet | `boolean` | 当前是否处于弱网状态 |
| networkType | `keyof NetworkType` | 当前网络类型 |

## 示例代码

```tsx
Taro.onNetworkWeakChange(function (res) {
  console.log(res.weakNet)
  console.log(res.networkType)
})
// 取消监听
Taro.offNetworkWeakChange()
```
</file>

<file path="docs/apis/device/nfc/getHCEState.md">
---
title: Taro.getHCEState(option)
sidebar_label: getHCEState
---

判断当前设备是否支持 HCE 能力。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/wx.getHCEState.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.getHCEState({
  success: function (res) {
    console.log(res.errCode)
  }
})
```
</file>

<file path="docs/apis/device/nfc/getNFCAdapter.md">
---
title: Taro.getNFCAdapter()
sidebar_label: getNFCAdapter
---

获取 NFC 实例

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/wx.getNFCAdapter.html)

## 类型

```tsx
() => NFCAdapter
```
</file>

<file path="docs/apis/device/nfc/IsoDep.md">
---
title: IsoDep
sidebar_label: IsoDep
---

IsoDep 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/IsoDep.html)

## 方法

### close

断开连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/IsoDep.close.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### connect

连接 NFC 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/IsoDep.connect.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### getHistoricalBytes

获取复位信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/IsoDep.getHistoricalBytes.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### getMaxTransceiveLength

获取最大传输长度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/IsoDep.getMaxTransceiveLength.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### isConnected

检查是否已连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/IsoDep.isConnected.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### setTimeout

设置超时时间

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/IsoDep.setTimeout.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### transceive

发送数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/IsoDep.transceive.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

## 参数

### close

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### connect

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### getHistoricalBytes

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| histBytes | `ArrayBuffer` | 返回历史二进制数据 |

### getMaxTransceiveLength

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| length | `number` | 最大传输长度 |

### isConnected

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### setTimeout

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| timeout | `number` | 是 | 设置超时时间 (ms) |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### transceive

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `ArrayBuffer` | 是 | 需要传递的二进制数据 |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 |
| --- | --- |
| data | `ArrayBuffer` |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| IsoDep | ✔️ |  |  |  |  |
| IsoDep.close | ✔️ |  |  |  |  |
| IsoDep.connect | ✔️ |  |  |  |  |
| IsoDep.getHistoricalBytes | ✔️ |  |  |  |  |
| IsoDep.getMaxTransceiveLength | ✔️ |  |  |  |  |
| IsoDep.isConnected | ✔️ |  |  |  |  |
| IsoDep.setTimeout | ✔️ |  |  |  |  |
| IsoDep.transceive | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/device/nfc/MifareClassic.md">
---
title: MifareClassic
sidebar_label: MifareClassic
---

MifareClassic 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/MifareClassic.html)

## 方法

### close

断开连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/MifareClassic.close.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### connect

连接 NFC 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/MifareClassic.connect.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### getMaxTransceiveLength

获取最大传输长度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/MifareClassic.getMaxTransceiveLength.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### isConnected

检查是否已连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/MifareClassic.isConnected.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### setTimeout

设置超时时间

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/MifareClassic.setTimeout.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### transceive

发送数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/MifareClassic.transceive.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

## 参数

### close

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### connect

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### getMaxTransceiveLength

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| length | `number` | 最大传输长度 |

### isConnected

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### setTimeout

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| timeout | `number` | 是 | 设置超时时间 (ms) |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### transceive

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `ArrayBuffer` | 是 | 需要传递的二进制数据 |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 |
| --- | --- |
| data | `ArrayBuffer` |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| MifareClassic | ✔️ |  |  |  |  |
| MifareClassic.close | ✔️ |  |  |  |  |
| MifareClassic.connect | ✔️ |  |  |  |  |
| MifareClassic.getMaxTransceiveLength | ✔️ |  |  |  |  |
| MifareClassic.isConnected | ✔️ |  |  |  |  |
| MifareClassic.setTimeout | ✔️ |  |  |  |  |
| MifareClassic.transceive | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/device/nfc/MifareUltralight.md">
---
title: MifareUltralight
sidebar_label: MifareUltralight
---

MifareUltralight 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/MifareUltralight.html)

## 方法

### close

断开连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/MifareUltralight.close.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### connect

连接 NFC 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/MifareUltralight.connect.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### getMaxTransceiveLength

获取最大传输长度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/MifareUltralight.getMaxTransceiveLength.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### isConnected

检查是否已连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/MifareUltralight.isConnected.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### setTimeout

设置超时时间

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/MifareUltralight.setTimeout.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### transceive

发送数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/MifareUltralight.transceive.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

## 参数

### close

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### connect

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### getMaxTransceiveLength

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| length | `number` | 最大传输长度 |

### isConnected

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### setTimeout

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| timeout | `number` | 是 | 设置超时时间 (ms) |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### transceive

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `ArrayBuffer` | 是 | 需要传递的二进制数据 |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 |
| --- | --- |
| data | `ArrayBuffer` |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| MifareUltralight | ✔️ |  |  |  |  |
| MifareUltralight.close | ✔️ |  |  |  |  |
| MifareUltralight.connect | ✔️ |  |  |  |  |
| MifareUltralight.getMaxTransceiveLength | ✔️ |  |  |  |  |
| MifareUltralight.isConnected | ✔️ |  |  |  |  |
| MifareUltralight.setTimeout | ✔️ |  |  |  |  |
| MifareUltralight.transceive | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/device/nfc/Ndef.md">
---
title: Ndef
sidebar_label: Ndef
---

Ndef 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/Ndef.html)

## 方法

### close

断开连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/Ndef.close.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### connect

连接 NFC 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/Ndef.connect.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### isConnected

检查是否已连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/Ndef.isConnected.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### offNdefMessage

取消监听 Ndef 消息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/Ndef.offNdefMessage.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 监听 Ndef 消息回调函数 |

### onNdefMessage

监听 Ndef 消息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/Ndef.onNdefMessage.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 监听 Ndef 消息回调函数 |

### setTimeout

设置超时时间

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/Ndef.setTimeout.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### writeNdefMessage

重写 Ndef 标签内容

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/Ndef.writeNdefMessage.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

## 参数

### close

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### connect

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### isConnected

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### onNdefMessage

#### Callback

监听 Ndef 消息回调函数

```tsx
(args: unknown[]) => void
```

| 参数 | 类型 |
| --- | --- |
| args | `unknown[]` |

### setTimeout

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| timeout | `number` | 是 | 设置超时时间 (ms) |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### writeNdefMessage

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| uris | `string[]` | 否 | uri 数组 |
| texts | `string[]` | 否 | text 数组 |
| records | `record[]` | 否 | 二进制对象数组, 需要指明 id, type 以及 payload (均为 ArrayBuffer 类型) |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

#### record

| 参数 | 类型 |
| --- | --- |
| id | `ArrayBuffer` |
| type | `ArrayBuffer` |
| payload | `ArrayBuffer` |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| Ndef | ✔️ |  |  |  |  |
| Ndef.close | ✔️ |  |  |  |  |
| Ndef.connect | ✔️ |  |  |  |  |
| Ndef.isConnected | ✔️ |  |  |  |  |
| Ndef.offNdefMessage | ✔️ |  |  |  |  |
| Ndef.onNdefMessage | ✔️ |  |  |  |  |
| Ndef.setTimeout | ✔️ |  |  |  |  |
| Ndef.writeNdefMessage | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/device/nfc/NfcA.md">
---
title: NfcA
sidebar_label: NfcA
---

NfcA 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcA.html)

## 方法

### close

断开连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcA.close.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### connect

连接 NFC 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcA.connect.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### getAtqa

获取 ATQA 信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcA.getAtqa.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### getMaxTransceiveLength

获取最大传输长度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcA.getMaxTransceiveLength.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### getSak

获取 SAK 信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcA.getSak.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### isConnected

检查是否已连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcA.isConnected.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### setTimeout

设置超时时间

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcA.setTimeout.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### transceive

发送数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcA.transceive.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

## 参数

### close

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### connect

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### getAtqa

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| atqa | `ArrayBuffer` | 返回 ATQA/SENS_RES 数据 |

### getMaxTransceiveLength

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| length | `number` | 最大传输长度 |

### getSak

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| sak | `number` | 返回 SAK/SEL_RES 数据 |

### isConnected

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### setTimeout

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| timeout | `number` | 是 | 设置超时时间 (ms) |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### transceive

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `ArrayBuffer` | 是 | 需要传递的二进制数据 |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 |
| --- | --- |
| data | `ArrayBuffer` |

## API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| NfcA | ✔️ | ✔️ |  |  |  |  |
| NfcA.close | ✔️ | ✔️ |  |  |  |  |
| NfcA.connect | ✔️ | ✔️ |  |  |  |  |
| NfcA.getAtqa | ✔️ | ✔️ |  |  |  |  |
| NfcA.getMaxTransceiveLength | ✔️ | ✔️ |  |  |  |  |
| NfcA.getSak | ✔️ | ✔️ |  |  |  |  |
| NfcA.isConnected | ✔️ | ✔️ |  |  |  |  |
| NfcA.setTimeout | ✔️ | ✔️ |  |  |  |  |
| NfcA.transceive | ✔️ | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/device/nfc/NFCAdapter.md">
---
title: NFCAdapter
sidebar_label: NFCAdapter
---

NFC 实例

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NFCAdapter.html)

## 方法

### getIsoDep

获取IsoDep实例，实例支持ISO-DEP (ISO 14443-4)标准的读写

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NFCAdapter.getIsoDep.html)

```tsx
() => IsoDep
```

### getMifareClassic

获取MifareClassic实例，实例支持MIFARE Classic标签的读写

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NFCAdapter.getMifareClassic.html)

```tsx
() => MifareClassic
```

### getMifareUltralight

获取MifareUltralight实例，实例支持MIFARE Ultralight标签的读写

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NFCAdapter.getMifareUltralight.html)

```tsx
() => MifareUltralight
```

### getNdef

获取Ndef实例，实例支持对NDEF格式的NFC标签上的NDEF数据的读写

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NFCAdapter.getNdef.html)

```tsx
() => Ndef
```

### getNfcA

获取NfcA实例，实例支持NFC-A (ISO 14443-3A)标准的读写

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NFCAdapter.getNfcA.html)

```tsx
() => NfcA
```

### getNfcB

获取NfcB实例，实例支持NFC-B (ISO 14443-3B)标准的读写

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NFCAdapter.getNfcB.html)

```tsx
() => NfcB
```

### getNfcF

获取NfcF实例，实例支持NFC-F (JIS 6319-4)标准的读写

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NFCAdapter.getNfcF.html)

```tsx
() => NfcB
```

### getNfcV

获取NfcV实例，实例支持NFC-V (ISO 15693)标准的读写

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NFCAdapter.getNfcV.html)

```tsx
() => NfcV
```

### offDiscovered

取消监听 NFC Tag

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NFCAdapter.offDiscovered.html)

```tsx
(callback?: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 监听 NFC Tag的回调函数 |

### onDiscovered

监听 NFC Tag

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NFCAdapter.onDiscovered.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 监听 NFC Tag的回调函数 |

### startDiscovery

开始扫描NFC标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NFCAdapter.startDiscovery.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### stopDiscovery

关闭NFC标签扫描

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NFCAdapter.stopDiscovery.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

## 参数

### onDiscovered

#### Callback

监听 NFC Tag的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

#### CallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| techs | `string[]` | 是 | tech 数组，用于匹配NFC卡片具体可以使用什么标准（NfcA等实例）处理 |
| messages | `NdefMessage[]` | 是 | NdefMessage 数组，消息格式为 {id: ArrayBuffer, type: ArrayBuffer, payload: ArrayBuffer} |
| id | `ArrayBuffer` | 否 | NFC标签的UID<br />API 支持度: tt |

#### NdefMessage

| 参数 | 类型 |
| --- | --- |
| id | `ArrayBuffer` |
| type | `ArrayBuffer` |
| payload | `ArrayBuffer` |

### startDiscovery

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### stopDiscovery

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

## API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| NFCAdapter | ✔️ |  |  |  |  |  |
| NFCAdapter.getIsoDep | ✔️ |  |  |  |  |  |
| NFCAdapter.getMifareClassic | ✔️ | ✔️ |  |  |  |  |
| NFCAdapter.getMifareUltralight | ✔️ |  |  |  |  |  |
| NFCAdapter.getNdef | ✔️ |  |  |  |  |  |
| NFCAdapter.getNfcA | ✔️ | ✔️ |  |  |  |  |
| NFCAdapter.getNfcB | ✔️ |  |  |  |  |  |
| NFCAdapter.getNfcF | ✔️ |  |  |  |  |  |
| NFCAdapter.getNfcV | ✔️ |  |  |  |  |  |
| NFCAdapter.offDiscovered | ✔️ | ✔️ |  |  |  |  |
| NFCAdapter.onDiscovered | ✔️ | ✔️ |  |  |  |  |
| NFCAdapter.startDiscovery | ✔️ | ✔️ |  |  |  |  |
| NFCAdapter.stopDiscovery | ✔️ | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/device/nfc/NfcB.md">
---
title: NfcB
sidebar_label: NfcB
---

NfcB 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcB.html)

## 方法

### close

断开连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcB.close.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### connect

连接 NFC 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcB.connect.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### getMaxTransceiveLength

获取最大传输长度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcB.getMaxTransceiveLength.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### isConnected

检查是否已连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcB.isConnected.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### setTimeout

设置超时时间

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcB.setTimeout.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### transceive

发送数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcB.transceive.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

## 参数

### close

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### connect

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### getMaxTransceiveLength

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| length | `number` | 最大传输长度 |

### isConnected

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### setTimeout

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| timeout | `number` | 是 | 设置超时时间 (ms) |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### transceive

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `ArrayBuffer` | 是 | 需要传递的二进制数据 |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 |
| --- | --- |
| data | `ArrayBuffer` |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| NfcB | ✔️ |  |  |  |  |
| NfcB.close | ✔️ |  |  |  |  |
| NfcB.connect | ✔️ |  |  |  |  |
| NfcB.getMaxTransceiveLength | ✔️ |  |  |  |  |
| NfcB.isConnected | ✔️ |  |  |  |  |
| NfcB.setTimeout | ✔️ |  |  |  |  |
| NfcB.transceive | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/device/nfc/NfcF.md">
---
title: NfcF
sidebar_label: NfcF
---

NfcF 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcF.html)

## 方法

### close

断开连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcF.close.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### connect

连接 NFC 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcF.connect.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### getMaxTransceiveLength

获取最大传输长度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcF.getMaxTransceiveLength.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### isConnected

检查是否已连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcF.isConnected.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### setTimeout

设置超时时间

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcF.setTimeout.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### transceive

发送数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcF.transceive.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

## 参数

### close

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### connect

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### getMaxTransceiveLength

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| length | `number` | 最大传输长度 |

### isConnected

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### setTimeout

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| timeout | `number` | 是 | 设置超时时间 (ms) |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### transceive

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `ArrayBuffer` | 是 | 需要传递的二进制数据 |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 |
| --- | --- |
| data | `ArrayBuffer` |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| NfcF | ✔️ |  |  |  |  |
| NfcF.close | ✔️ |  |  |  |  |
| NfcF.connect | ✔️ |  |  |  |  |
| NfcF.getMaxTransceiveLength | ✔️ |  |  |  |  |
| NfcF.isConnected | ✔️ |  |  |  |  |
| NfcF.setTimeout | ✔️ |  |  |  |  |
| NfcF.transceive | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/device/nfc/NfcV.md">
---
title: NfcV
sidebar_label: NfcV
---

NfcV 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcV.html)

## 方法

### close

断开连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcV.close.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### connect

连接 NFC 标签

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcV.connect.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### getMaxTransceiveLength

获取最大传输长度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcV.getMaxTransceiveLength.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### isConnected

检查是否已连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcV.isConnected.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### setTimeout

设置超时时间

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcV.setTimeout.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### transceive

发送数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/NfcV.transceive.html)

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

## 参数

### close

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### connect

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### getMaxTransceiveLength

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| length | `number` | 最大传输长度 |

### isConnected

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### setTimeout

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| timeout | `number` | 是 | 设置超时时间 (ms) |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

### transceive

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `ArrayBuffer` | 是 | 需要传递的二进制数据 |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 |
| --- | --- |
| data | `ArrayBuffer` |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| NfcV | ✔️ |  |  |  |  |
| NfcV.close | ✔️ |  |  |  |  |
| NfcV.connect | ✔️ |  |  |  |  |
| NfcV.getMaxTransceiveLength | ✔️ |  |  |  |  |
| NfcV.isConnected | ✔️ |  |  |  |  |
| NfcV.setTimeout | ✔️ |  |  |  |  |
| NfcV.transceive | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/device/nfc/offHCEMessage.md">
---
title: Taro.offHCEMessage(callback)
sidebar_label: offHCEMessage
---

接收 NFC 设备消息事件，取消事件监听。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/wx.offHCEMessage.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 接收 NFC 设备消息事件的回调函数 |
</file>

<file path="docs/apis/device/nfc/onHCEMessage.md">
---
title: Taro.onHCEMessage(callback)
sidebar_label: onHCEMessage
---

监听接收 NFC 设备消息事件，仅能注册一个监听

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/wx.onHCEMessage.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 接收 NFC 设备消息事件的回调函数 |

### Callback

接收 NFC 设备消息事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | `ArrayBuffer` | `messageType=1` 时 ,客户端接收到 NFC 设备的指令 |
| messageType | `keyof MessageType` | 消息类型 |
| reason | `number` | `messageType=2` 时，原因 |

### MessageType

消息类型

| 参数 | 说明 |
| --- | --- |
| 1 | HCE APDU Command类型，小程序需对此指令进行处理，并调用 sendHCEMessage 接口返回处理指令 |
| 2 | 设备离场事件类型 |
</file>

<file path="docs/apis/device/nfc/sendHCEMessage.md">
---
title: Taro.sendHCEMessage(option)
sidebar_label: sendHCEMessage
---

发送 NFC 消息。仅在安卓系统下有效。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/wx.sendHCEMessage.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.NFCError>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `ArrayBuffer` | 是 | 二进制数据 |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
const buffer = new ArrayBuffer(1)
const dataView = new DataView(buffer)
dataView.setUint8(0, 0)
      Taro.startHCE({
  success: function (res) {
    Taro.onHCEMessage(function (res) {
      if (res.messageType === 1) {
        Taro.sendHCEMessage({data: buffer})
      }
    })
  }
})
```
</file>

<file path="docs/apis/device/nfc/startHCE.md">
---
title: Taro.startHCE(option)
sidebar_label: startHCE
---

初始化 NFC 模块。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/wx.startHCE.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.NFCError>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| aid_list | `string[]` | 是 | 需要注册到系统的 AID 列表 |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.startHCE({
  aid_list: ['F222222222']
  success: function (res) {
    console.log(res.errMsg)
  }
})
```
</file>

<file path="docs/apis/device/nfc/stopHCE.md">
---
title: Taro.stopHCE(option)
sidebar_label: stopHCE
---

关闭 NFC 模块。仅在安卓系统下有效。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/nfc/wx.stopHCE.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.NFCError>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.NFCError) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.stopHCE({
  success: function (res) {
    console.log(res.errMsg)
  }
})
```
</file>

<file path="docs/apis/device/phone/makePhoneCall.md">
---
title: Taro.makePhoneCall(option)
sidebar_label: makePhoneCall
---

拨打电话

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/phone/wx.makePhoneCall.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| phoneNumber | `string` | 是 | 需要拨打的电话号码 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.makePhoneCall({
  phoneNumber: '1340000' //仅为示例，并非真实的电话号码
})
```
</file>

<file path="docs/apis/device/scan/scanCode.md">
---
title: Taro.scanCode(option)
sidebar_label: scanCode
---

调起客户端扫码界面，扫码成功后返回对应的结果

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/scan/wx.scanCode.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| onlyFromCamera | `boolean` | `false` | 否 | 是否只能从相机扫码，不允许从相册选择图片 |
| scanType | `(keyof ScanType)[]` |  | 否 | 扫码类型 |
| success | `(result: SuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| charSet | `string` | 所扫码的字符集 |
| path | `string` | 当所扫的码为当前小程序二维码时，会返回此字段，内容为二维码携带的 path |
| rawData | `string` | 原始数据，base64编码 |
| result | `string` | 所扫码的内容 |
| scanType | `keyof QRType` | 所扫码的类型 |
| errMsg | `string` | 调用结果 |

### ScanType

扫码类型

| 参数 | 说明 |
| --- | --- |
| barCode | 一维码 |
| qrCode | 二维码 |
| datamatrix | Data Matrix 码 |
| pdf417 | PDF417 条码 |

### QRType

所扫码的类型

| 参数 | 说明 |
| --- | --- |
| QR_CODE | 二维码 |
| AZTEC | 一维码 |
| CODABAR | 一维码 |
| CODE_39 | 一维码 |
| CODE_93 | 一维码 |
| CODE_128 | 一维码 |
| DATA_MATRIX | 二维码 |
| EAN_8 | 一维码 |
| EAN_13 | 一维码 |
| ITF | 一维码 |
| MAXICODE | 一维码 |
| PDF_417 | 二维码 |
| RSS_14 | 一维码 |
| RSS_EXPANDED | 一维码 |
| UPC_A | 一维码 |
| UPC_E | 一维码 |
| UPC_EAN_EXTENSION | 一维码 |
| WX_CODE | 二维码 |
| CODE_25 | 一维码 |

## 示例代码

```tsx
// 允许从相机和相册扫码
Taro.scanCode({
  success: (res) => {
    console.log(res)
  }
})
// 只允许从相机扫码
Taro.scanCode({
  onlyFromCamera: true,
  success: (res) => {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/device/screen/getScreenBrightness.md">
---
title: Taro.getScreenBrightness(option)
sidebar_label: getScreenBrightness
---

获取屏幕亮度。

**说明**
- 若安卓系统设置中开启了自动调节亮度功能，则屏幕亮度会根据光线自动调整，该接口仅能获取自动调节亮度之前的值，而非实时的亮度值。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/screen/wx.getScreenBrightness.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackOption>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(option: SuccessCallbackOption) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackOption

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | `number` | 屏幕亮度值，范围 0 ~ 1，0 最暗，1 最亮 |
</file>

<file path="docs/apis/device/screen/getScreenRecordingState.md">
---
title: Taro.getScreenRecordingState(option)
sidebar_label: getScreenRecordingState
---

查询用户是否在录屏

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/screen/wx.getScreenRecordingState.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(option: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### ScreenRecordingState

| 参数 | 说明 |
| --- | --- |
| on | 开启 |
| off | 关闭 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| state | `keyof ScreenRecordingState` | 录屏状态 |

## 示例代码

```tsx
Taro.getScreenRecordingState({
    success: function (res) {
        console.log(res.state)
    },
})
```
</file>

<file path="docs/apis/device/screen/offScreenRecordingStateChanged.md">
---
title: Taro.offScreenRecordingStateChanged(callback)
sidebar_label: offScreenRecordingStateChanged
---

取消用户录屏事件的监听函数

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/screen/wx.offScreenRecordingStateChanged.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 用户录屏事件的监听函数 |
</file>

<file path="docs/apis/device/screen/offUserCaptureScreen.md">
---
title: Taro.offUserCaptureScreen(callback)
sidebar_label: offUserCaptureScreen
---

用户主动截屏事件。取消事件监听。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/screen/wx.offUserCaptureScreen.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 用户主动截屏事件的回调函数 |
</file>

<file path="docs/apis/device/screen/onScreenRecordingStateChanged.md">
---
title: Taro.onScreenRecordingStateChanged(callback)
sidebar_label: onScreenRecordingStateChanged
---

监听用户录屏事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/screen/wx.onScreenRecordingStateChanged.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 用户录屏事件的监听函数 |

### ScreenRecordingState

| 参数 | 说明 |
| --- | --- |
| start | 开始录屏 |
| stop | 结束录屏 |

### Callback

用户录屏事件的监听函数

```tsx
(state: keyof ScreenRecordingState) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| state | `keyof ScreenRecordingState` | 录屏状态 |

## 示例代码

```tsx
// 监听用户录屏事件
const handler = function (res) {
    console.log(res.state)
}
Taro.onScreenRecordingStateChanged(handler)
```
</file>

<file path="docs/apis/device/screen/onUserCaptureScreen.md">
---
title: Taro.onUserCaptureScreen(callback)
sidebar_label: onUserCaptureScreen
---

监听用户主动截屏事件，用户使用系统截屏按键截屏时触发此事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/screen/wx.onUserCaptureScreen.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 用户主动截屏事件的回调函数 |

### Callback

用户主动截屏事件的回调函数

```tsx
(result: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `TaroGeneral.CallbackResult` |

## 示例代码

```tsx
Taro.onUserCaptureScreen(function (res) {
    console.log('用户截屏了')
})
```
</file>

<file path="docs/apis/device/screen/setKeepScreenOn.md">
---
title: Taro.setKeepScreenOn(option)
sidebar_label: setKeepScreenOn
---

设置是否保持常亮状态。仅在当前小程序生效，离开小程序后设置失效。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/screen/wx.setKeepScreenOn.html)

## 类型

```tsx
(option: Option) => Promise<Promised>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Promised

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 调用结果 |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| keepScreenOn | `boolean` | 是 | 是否保持屏幕常亮 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
// 保持屏幕常亮
Taro.setKeepScreenOn({
    keepScreenOn: true
})
```
</file>

<file path="docs/apis/device/screen/setScreenBrightness.md">
---
title: Taro.setScreenBrightness(option)
sidebar_label: setScreenBrightness
---

设置屏幕亮度。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/screen/wx.setScreenBrightness.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| value | `number` | 是 | 屏幕亮度值，范围 0 ~ 1。0 最暗，1 最亮 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.setScreenBrightness(params).then(...)
```
</file>

<file path="docs/apis/device/screen/setVisualEffectOnCapture.md">
---
title: Taro.setVisualEffectOnCapture(option)
sidebar_label: setVisualEffectOnCapture
---

设置截屏/录屏时屏幕表现，仅支持在 Android 端调用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/screen/wx.setVisualEffectOnCapture.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| visualEffect | "none" or "hidden" | `"none"` | 否 | 截屏/录屏时的表现，仅支持 none / hidden，传入 hidden 则表示在截屏/录屏时隐藏屏幕 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/device/sms/sendSms.md">
---
title: Taro.sendSms(option)
sidebar_label: sendSms
---

拉起手机发送短信界面

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](declare module '../../index')

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResul>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| phoneNumber | `string` | 否 | 预填到发送短信面板的手机号 |
| content | `string` | 否 | 预填到发送短信面板的内容 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/device/vibrate/vibrateLong.md">
---
title: Taro.vibrateLong(option)
sidebar_label: vibrateLong
---

使手机发生较长时间的振动（400ms）

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/vibrate/wx.vibrateLong.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.vibrateLong(params).then(...)
```
</file>

<file path="docs/apis/device/vibrate/vibrateShort.md">
---
title: Taro.vibrateShort(option)
sidebar_label: vibrateShort
---

使手机发生较短时间的振动（15 ms）。仅在 iPhone `7 / 7 Plus` 以上及 Android 机型生效

仅微信小程序平台支持 type 参数

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/vibrate/wx.vibrateShort.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| type | "heavy" or "medium" or "light" | 否 | 震动强度类型，有效值为：heavy、medium、light |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.vibrateShort(params).then(...)
```
</file>

<file path="docs/apis/device/wifi/connectWifi.md">
---
title: Taro.connectWifi(option)
sidebar_label: connectWifi
---

连接 Wi-Fi。若已知 Wi-Fi 信息，可以直接利用该接口连接。仅 Android 与 iOS 11 以上版本支持。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/wifi/wx.connectWifi.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.WifiError>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| SSID | `string` |  | 是 | Wi-Fi 设备 SSID |
| password | `string` |  | 是 | Wi-Fi 设备密码 |
| BSSID | `string` |  | 否 | Wi-Fi 设备 BSSID |
| maunal | `boolean` | `false` | 否 | 跳转到系统设置页进行连接 |
| partialInfo | `boolean` | `false` | 否 | 是否需要返回部分 Wi-Fi 信息，仅安卓生效 |
| complete | `(res: TaroGeneral.WifiError) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.WifiError) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.WifiError) => void` |  | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.connectWifi({
  SSID: '',
  BSSID: '',
  success: function (res) {
    console.log(res.errMsg)
  }
})
```
</file>

<file path="docs/apis/device/wifi/getConnectedWifi.md">
---
title: Taro.getConnectedWifi(option)
sidebar_label: getConnectedWifi
---

获取已连接中的 Wi-Fi 信息。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/wifi/wx.getConnectedWifi.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.WifiError>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| partialInfo | `boolean` | `false` | 否 | 是否需要返回部分 Wi-Fi 信息 |
| complete | `(res: TaroGeneral.WifiError) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.WifiError) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| wifi | `WifiInfo` | Wi-Fi 信息 |
| errMsg | `string` | 调用结果 |
</file>

<file path="docs/apis/device/wifi/getWifiList.md">
---
title: Taro.getWifiList(option)
sidebar_label: getWifiList
---

请求获取 Wi-Fi 列表。在 `onGetWifiList` 注册的回调中返回 `wifiList` 数据。 **Android 调用前需要 [用户授权](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html) scope.userLocation。**

iOS 将跳转到系统的 Wi-Fi 界面，Android 不会跳转。 iOS 11.0 及 iOS 11.1 两个版本因系统问题，该方法失效。但在 iOS 11.2 中已修复。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/wifi/wx.getWifiList.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.WifiError>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.WifiError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.WifiError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.WifiError) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/device/wifi/offGetWifiList.md">
---
title: Taro.offGetWifiList(callback)
sidebar_label: offGetWifiList
---

取消监听获取到 Wi-Fi 列表数据事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/wifi/wx.offGetWifiList.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 获取到 Wi-Fi 列表数据事件的回调函数 |
</file>

<file path="docs/apis/device/wifi/offWifiConnected.md">
---
title: Taro.offWifiConnected(callback)
sidebar_label: offWifiConnected
---

取消监听连接上 Wi-Fi 的事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/wifi/wx.offWifiConnected.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 连接上 Wi-Fi 的事件的回调函数 |
</file>

<file path="docs/apis/device/wifi/offWifiConnectedWithPartialInfo.md">
---
title: Taro.offWifiConnectedWithPartialInfo(callback)
sidebar_label: offWifiConnectedWithPartialInfo
---

取消监听连接上 Wi-Fi 的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/wifi/wx.offWifiConnectedWithPartialInfo.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 连接上 Wi-Fi 的事件的回调函数 |
</file>

<file path="docs/apis/device/wifi/onGetWifiList.md">
---
title: Taro.onGetWifiList(callback)
sidebar_label: onGetWifiList
---

监听获取到 Wi-Fi 列表数据事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/wifi/wx.onGetWifiList.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 获取到 Wi-Fi 列表数据事件的回调函数 |

### Callback

获取到 Wi-Fi 列表数据事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| wifiList | `WifiInfo[]` | Wi-Fi 列表数据 |
</file>

<file path="docs/apis/device/wifi/onWifiConnected.md">
---
title: Taro.onWifiConnected(callback)
sidebar_label: onWifiConnected
---

监听连接上 Wi-Fi 的事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/wifi/wx.onWifiConnected.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 连接上 Wi-Fi 的事件的回调函数 |

### Callback

连接上 Wi-Fi 的事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| wifi | `WifiInfo` | Wi-Fi 信息 |
</file>

<file path="docs/apis/device/wifi/onWifiConnectedWithPartialInfo.md">
---
title: Taro.onWifiConnectedWithPartialInfo(callback)
sidebar_label: onWifiConnectedWithPartialInfo
---

监听连接上 Wi-Fi 的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/wifi/wx.onWifiConnectedWithPartialInfo.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 连接上 Wi-Fi 的事件的回调函数 |

### Callback

连接上 Wi-Fi 的事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| wifi | `Pick<WifiInfo, "SSID">` | 只包含 SSID 属性的 WifiInfo 对象 |
</file>

<file path="docs/apis/device/wifi/setWifiList.md">
---
title: Taro.setWifiList(option)
sidebar_label: setWifiList
---

设置 `wifiList` 中 AP 的相关信息。在 `onGetWifiList` 回调后调用，**iOS特有接口**。

**注意**
- 该接口只能在 `onGetWifiList` 回调之后才能调用。
- 此时客户端会挂起，等待小程序设置 Wi-Fi 信息，请务必尽快调用该接口，若无数据请传入一个空数组。
- 有可能随着周边 Wi-Fi 列表的刷新，单个流程内收到多次带有存在重复的 Wi-Fi 列表的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/wifi/wx.setWifiList.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.WifiError>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| wifiList | `WifiData[]` | 是 | 提供预设的 Wi-Fi 信息列表 |
| complete | `(res: TaroGeneral.WifiError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.WifiError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.WifiError) => void` | 否 | 接口调用成功的回调函数 |

### WifiData

提供预设的 Wi-Fi 信息列表

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| BSSID | `string` | 否 | Wi-Fi 的 BSSID |
| SSID | `string` | 否 | Wi-Fi 的 SSID |
| password | `string` | 否 | Wi-Fi 设备密码 |

## 示例代码

```tsx
Taro.onGetWifiList(function (res) {
  if (res.wifiList.length) {
    Taro.setWifiList({
      wifiList: [{
        SSID: res.wifiList[0].SSID,
        BSSID: res.wifiList[0].BSSID,
        password: '123456'
      }]
    })
  } else {
    Taro.setWifiList({
      wifiList: []
    })
  }
})
Taro.getWifiList()
```
</file>

<file path="docs/apis/device/wifi/startWifi.md">
---
title: Taro.startWifi(option)
sidebar_label: startWifi
---

初始化 Wi-Fi 模块。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/wifi/wx.startWifi.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.WifiError>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.WifiError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.WifiError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.WifiError) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.startWifi({
  success: function (res) {
    console.log(res.errMsg)
  }
})
```
</file>

<file path="docs/apis/device/wifi/stopWifi.md">
---
title: Taro.stopWifi(option)
sidebar_label: stopWifi
---

关闭 Wi-Fi 模块。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/device/wifi/wx.stopWifi.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.WifiError>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.WifiError) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.WifiError) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.WifiError) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.stopWifi({
  success: function (res) {
    console.log(res.errMsg)
  }
})
```
</file>

<file path="docs/apis/device/wifi/WifiInfo.md">
---
title: WifiInfo
sidebar_label: WifiInfo
---

Wifi 信息

注意:
安卓 Taro.connectWifi / Taro.getConnectedWifi 若设置了 partialInfo:true ，或者调用了 Taro.onWifiConnectedWithPartialInfo 事件。将会返回只包含 SSID 属性的 WifiInfo 对象。 在某些情况下，可能 Wi-Fi 已经连接成功，但会因为获取不到完整的 WifiInfo 对象报错。具体错误信息为 errCode: 12010, errMsg: can't gain current wifi 。如果开发者不需要完整的 WifiInfo 对象，则可以通过采取上述策略解决报错问题。

## 方法

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| SSID | `string` | 是 | Wi-Fi 的 SSID |
| BSSID | `string` | 是 | Wi-Fi 的 BSSID |
| secure | `boolean` | 是 | Wi-Fi 是否安全 |
| signalStrength | `number` | 是 | Wi-Fi 信号强度, 安卓取值 0 ～ 100 ，iOS 取值 0 ～ 1 ，值越大强度越大 |
| frequency | `number` | 否 | Wi-Fi 频段单位 MHz |
</file>

<file path="docs/apis/ext/getExtConfig.md">
---
title: Taro.getExtConfig(option)
sidebar_label: getExtConfig
---

获取[第三方平台](https://developers.weixin.qq.com/miniprogram/dev/devtools/ext.html)自定义的数据字段。

**Tips**
1. 本接口暂时无法通过 Taro.canIUse 判断是否兼容，开发者需要自行判断 Taro.getExtConfig 是否存在来兼容

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ext/wx.getExtConfig.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| extConfig | `TaroGeneral.IAnyObject` | 第三方平台自定义的数据 |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
if(Taro.getExtConfig) {
  Taro.getExtConfig({
    success: function (res) {
      console.log(res.extConfig)
    }
  })
}
```
</file>

<file path="docs/apis/ext/getExtConfigSync.md">
---
title: Taro.getExtConfigSync()
sidebar_label: getExtConfigSync
---

Taro.getExtConfig 的同步版本。

**Tips**
1. 本接口暂时无法通过 Taro.canIUse 判断是否兼容，开发者需要自行判断 Taro.getExtConfigSync 是否存在来兼容

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ext/wx.getExtConfigSync.html)

## 类型

```tsx
() => TaroGeneral.IAnyObject
```

## 参数

### ExtInfo

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| extConfig | `TaroGeneral.IAnyObject` | 第三方平台自定义的数据 |

## 示例代码

```tsx
let extConfig = Taro.getExtConfigSync? Taro.getExtConfigSync(): {}

console.log(extConfig)
```
</file>

<file path="docs/apis/files/FileSystemManager.md">
---
title: FileSystemManager
sidebar_label: FileSystemManager
---

文件管理器，可通过 [Taro.getFileSystemManager](./getFileSystemManager) 获取。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.html)

## 方法

### access

判断文件/目录是否存在

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.access.html)

```tsx
(option: AccessOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `AccessOption` |

### accessSync

[FileSystemManager.access](#access) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.accessSync.html)

```tsx
(path: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| path | `string` | 要判断是否存在的文件/目录路径 |

### appendFile

在文件结尾追加内容

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.appendFile.html)

```tsx
(option: AppendFileOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `AppendFileOption` |

### appendFileSync

[FileSystemManager.appendFile](#appendfile) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.appendFileSync.html)

```tsx
(filePath: string, data: string | ArrayBuffer, encoding?: keyof Encoding) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| filePath | `string` | 要追加内容的文件路径 |
| data | string or ArrayBuffer | 要追加的文本或二进制数据 |
| encoding | `keyof Encoding` | 指定写入文件的字符编码 |

### close

关闭文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.close.html)

```tsx
(option: CloseOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `CloseOption` |

### closeSync

[FileSystemManager.close](#close) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.closeSync.html)

```tsx
(option: CloseSyncOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `CloseSyncOption` |

### copyFile

复制文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.copyFile.html)

```tsx
(option: CopyFileOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `CopyFileOption` |

### copyFileSync

[FileSystemManager.copyFile](#copyfile) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.copyFileSync.html)

```tsx
(srcPath: string, destPath: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| srcPath | `string` | 源文件路径，只可以是普通文件 |
| destPath | `string` | 目标文件路径 |

### fstat

获取文件的状态信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.fstat.html)

```tsx
(option: FstatOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `FstatOption` |

### fstatSync

[FileSystemManager.fstat](#fstat) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.fstatSync.html)

```tsx
(option: FstatSyncOption) => Stats
```

| 参数 | 类型 |
| --- | --- |
| option | `FstatSyncOption` |

### ftruncate

对文件内容进行截断操作

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.ftruncate.html)

```tsx
(option: FtruncateOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `FtruncateOption` |

### ftruncateSync

[FileSystemManager.ftruncate](#ftruncate) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.ftruncateSync.html)

```tsx
(option: FtruncateSyncOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `FtruncateSyncOption` |

### getFileInfo

获取该小程序下的 `本地临时文件` 或 `本地缓存文件` 信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.getFileInfo.html)

```tsx
(option: getFileInfoOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `getFileInfoOption` |

### getSavedFileList

获取该小程序下已保存的本地缓存文件列表

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.getSavedFileList.html)

```tsx
(option?: getSavedFileListOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `getSavedFileListOption` |

### mkdir

创建目录

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.mkdir.html)

```tsx
(option: MkdirOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `MkdirOption` |

### mkdirSync

[FileSystemManager.mkdir](#mkdir) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.mkdirSync.html)

```tsx
(dirPath: string, recursive?: boolean) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| dirPath | `string` | 创建的目录路径 |
| recursive | `boolean` | 是否在递归创建该目录的上级目录后再创建该目录。如果对应的上级目录已经存在，则不创建该上级目录。如 dirPath 为 a/b/c/d 且 recursive 为 true，将创建 a 目录，再在 a 目录下创建 b 目录，以此类推直至创建 a/b/c 目录下的 d 目录。 |

### open

打开文件，返回文件描述符

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.open.html)

```tsx
(option: OpenOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `OpenOption` |

### openSync

[FileSystemManager.openSync](#opensync) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.ftruncateSync.html)

```tsx
(option: OpenSyncOption) => string
```

| 参数 | 类型 |
| --- | --- |
| option | `OpenSyncOption` |

### read

读文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.read.html)

```tsx
(option: ReadOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `ReadOption` |

### readCompressedFile

读取指定压缩类型的本地文件内容

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.readCompressedFile.html)

```tsx
(option: Option) => Promise<Promised>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### readCompressedFileSync

同步读取指定压缩类型的本地文件内容

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.readCompressedFileSync.html)

```tsx
(option: Option) => ArrayBuffer
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### readdir

读取目录内文件列表

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.readdir.html)

```tsx
(option: ReaddirOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `ReaddirOption` |

### readdirSync

[FileSystemManager.readdir](#readdir) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.readdirSync.html)

```tsx
(dirPath: string) => string[]
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| dirPath | `string` | 要读取的目录路径 |

### readFile

读取本地文件内容

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.readFile.html)

```tsx
(option: ReadFileOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `ReadFileOption` |

### readFileSync

[FileSystemManager.readFile](#readfile) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.readFileSync.html)

```tsx
(filePath: string, encoding?: keyof Encoding, position?: number, length?: number) => string | ArrayBuffer
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| filePath | `string` | 要读取的文件的路径 |
| encoding | `keyof Encoding` | 指定读取文件的字符编码，如果不传 encoding，则以 ArrayBuffer 格式读取文件的二进制内容 |
| position | `number` | 从文件指定位置开始读，如果不指定，则从文件头开始读。读取的范围应该是左闭右开区间 [position, position+length)。有效范围：[0, fileLength - 1]。单位：byte |
| length | `number` | 指定文件的长度，如果不指定，则读到文件末尾。有效范围：[1, fileLength]。单位：byte |

### readSync

[FileSystemManager.read](#read) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.readSync.html)

```tsx
(option: ReadSyncOption) => { bytesRead: number; arrayBuffer: ArrayBuffer; }
```

| 参数 | 类型 |
| --- | --- |
| option | `ReadSyncOption` |

### readZipEntry

读取压缩包内的文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.readZipEntry.html)

```tsx
(option: Option) => Promise<Promised>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### removeSavedFile

删除该小程序下已保存的本地缓存文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.removeSavedFile.html)

```tsx
(option: RemoveSavedFileOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `RemoveSavedFileOption` |

### rename

重命名文件。可以把文件从 oldPath 移动到 newPath

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.rename.html)

```tsx
(option: RenameOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `RenameOption` |

### renameSync

[FileSystemManager.rename](#rename) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.renameSync.html)

```tsx
(oldPath: string, newPath: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| oldPath | `string` | 源文件路径，可以是普通文件或目录 |
| newPath | `string` | 新文件路径 |

### rmdir

删除目录

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.rmdir.html)

```tsx
(option: RmdirOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `RmdirOption` |

### rmdirSync

[FileSystemManager.rmdir](#rmdir) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.rmdirSync.html)

```tsx
(dirPath: string, recursive?: boolean) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| dirPath | `string` | 要删除的目录路径 |
| recursive | `boolean` | 是否递归删除目录。如果为 true，则删除该目录和该目录下的所有子目录以及文件。 |

### saveFile

保存临时文件到本地。此接口会移动临时文件，因此调用成功后，tempFilePath 将不可用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.saveFile.html)

```tsx
(option: SaveFileOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `SaveFileOption` |

### saveFileSync

[FileSystemManager.saveFile](#savefile) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.saveFileSync.html)

```tsx
(tempFilePath: string, filePath?: string) => string
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempFilePath | `string` | 临时存储文件路径 |
| filePath | `string` | 要存储的文件路径 |

### stat

获取文件 Stats 对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(option: StatOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `StatOption` |

### statSync

[FileSystemManager.stat](#stat) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.statSync.html)

```tsx
(path: string, recursive?: boolean) => any
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| path | `string` | 文件/目录路径 |
| recursive | `boolean` | 是否递归获取目录下的每个文件的 Stats 信息 |

### truncate

对文件内容进行截断操作

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.truncate.html)

```tsx
(option: TruncateOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `TruncateOption` |

### truncateSync

对文件内容进行截断操作 ([truncate](#truncate) 的同步版本)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.truncateSync.html)

```tsx
(option: TruncateSyncOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `TruncateSyncOption` |

### unlink

删除文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.unlink.html)

```tsx
(option: UnlinkOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `UnlinkOption` |

### unlinkSync

[FileSystemManager.unlink](#unlink) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.unlinkSync.html)

```tsx
(filePath: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| filePath | `string` | 要删除的文件路径 |

### unzip

解压文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.unzip.html)

```tsx
(option: UnzipOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `UnzipOption` |

### write

写入文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.write.html)

```tsx
(option: WriteOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `WriteOption` |

### writeFile

写文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.writeFile.html)

```tsx
(option: WriteFileOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `WriteFileOption` |

### writeFileSync

[FileSystemManager.writeFile](#writefile) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.writeFileSync.html)

```tsx
(filePath: string, data: string | ArrayBuffer, encoding?: keyof Encoding) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| filePath | `string` | 要写入的文件路径 |
| data | string or ArrayBuffer | 要写入的文本或二进制数据 |
| encoding | `keyof Encoding` | 指定写入文件的字符编码 |

### writeSync

[write](#write) 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.writeSync.html)

```tsx
(option: WriteSyncOption) => { bytesWritten: number; }
```

| 参数 | 类型 |
| --- | --- |
| option | `WriteSyncOption` |

## 参数

### Encoding

字符编码

| 参数 | 说明 |
| --- | --- |
| ascii |  |
| base64 |  |
| binary |  |
| hex |  |
| ucs2 | 以小端序读取 |
| ucs-2 | 以小端序读取 |
| utf16le | 以小端序读取 |
| utf-16le | 以小端序读取 |
| utf-8 |  |
| utf8 |  |
| latin1 |  |

### flag

文件系统标志

### AccessOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| path | `string` | 是 | 要判断是否存在的文件/目录路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: AccessFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### AccessFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail no such file or directory ${path}': 文件/目录不存在; |

### AppendFileOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | string or ArrayBuffer | 是 | 要追加的文本或二进制数据 |
| filePath | `string` | 是 | 要追加内容的文件路径 |
| encoding | `keyof Encoding` | 否 | 指定写入文件的字符编码 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: AppendFileFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### AppendFileFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail no such file or directory, open ${filePath}': 指定的 filePath 文件不存在;<br />- 'fail illegal operation on a directory, open "${filePath}"': 指定的 filePath 是一个已经存在的目录;<br />- 'fail permission denied, open ${dirPath}': 指定的 filePath 路径没有写权限;<br />- 'fail sdcard not mounted': 指定的 filePath 是一个已经存在的目录; |

### CopyFileOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| destPath | `string` | 是 | 目标文件路径 |
| srcPath | `string` | 是 | 源文件路径，只可以是普通文件 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: CopyFileFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### CopyFileFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail permission denied, copyFile ${srcPath} -> ${destPath}': 指定目标文件路径没有写权限;<br />- 'fail no such file or directory, copyFile ${srcPath} -> ${destPath}': 源文件不存在，或目标文件路径的上层目录不存在;<br />- 'fail the maximum size of the file storage limit is exceeded': 存储空间不足; |

### getFileInfoOption

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| filePath | `string` |  | 是 | 要读取的文件路径 |
| digestAlgorithm | "md5" or "sha1" | `'md5'` | 否 | 计算文件摘要的算法 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: GetFileInfoFailCallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(result: GetFileInfoSuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### GetFileInfoFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail file not exist': 指定的 filePath 找不到文件; |

### GetFileInfoSuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| size | `number` | 是 | 文件大小，以字节为单位 |
| digest | `string` | 否 | 按照传入的 digestAlgorithm 计算得出的的文件摘要 |
| errMsg | `string` | 是 | 调用结果 |

### getSavedFileListOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: GetSavedFileListSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### GetSavedFileListSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fileList | `GetSavedFileListSuccessCallbackResultFileItem[]` | 文件数组 |
| errMsg | `string` | 调用结果 |

### GetSavedFileListSuccessCallbackResultFileItem

文件数组

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| createTime | `number` | 文件保存时的时间戳，从1970/01/01 08:00:00 到当前时间的秒数 |
| filePath | `string` | 本地路径 |
| size | `number` | 本地文件大小，以字节为单位 |

### MkdirOption

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| dirPath | `string` |  | 是 | 创建的目录路径 |
| recursive | `boolean` | `false` | 否 | 是否在递归创建该目录的上级目录后再创建该目录。如果对应的上级目录已经存在，则不创建该上级目录。<br />如 dirPath 为 a/b/c/d 且 recursive 为 true，将创建 a 目录，再在 a 目录下创建 b 目录，以此类推直至创建 a/b/c 目录下的 d 目录。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: MkdirFailCallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### MkdirFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail no such file or directory ${dirPath}': 上级目录不存在;<br />- 'fail permission denied, open ${dirPath}': 指定的 filePath 路径没有写权限;<br />- 'fail file already exists ${dirPath}': 有同名文件或目录; |

### ReadFileOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 要读取的文件的路径 |
| position | `number` | 否 | 从文件指定位置开始读，如果不指定，则从文件头开始读。读取的范围应该是左闭右开区间 [position, position+length)。有效范围：[0, fileLength - 1]。单位：byte |
| length | `number` | 否 | 指定文件的长度，如果不指定，则读到文件末尾。有效范围：[1, fileLength]。单位：byte |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| encoding | `keyof Encoding` | 否 | 指定读取文件的字符编码，如果不传 encoding，则以 ArrayBuffer 格式读取文件的二进制内容 |
| fail | `(result: ReadFileFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: ReadFileSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### ReadFileSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | string or ArrayBuffer | 文件内容 |
| errMsg | `string` | 调用结果 |

### ReadFileFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail no such file or directory, open ${filePath}': 指定的 filePath 所在目录不存在;<br />- 'fail permission denied, open ${dirPath}': 指定的 filePath 路径没有读权限; |

### ReaddirOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| dirPath | `string` | 是 | 要读取的目录路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: ReaddirFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: ReaddirSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### ReaddirFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail no such file or directory ${dirPath}': 目录不存在;<br />- 'fail not a directory ${dirPath}': dirPath 不是目录;<br />- 'fail permission denied, open ${dirPath}': 指定的 filePath 路径没有读权限; |

### ReaddirSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| files | `string[]` | 指定目录下的文件名数组。 |
| errMsg | `string` | 调用结果 |

### readZipEntry

#### Promised

```tsx
FailCallbackResult | SuccessCallbackResult
```

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 要读取的压缩包的路径 (本地路径) |
| encoding | `string` | 否 | 统一指定读取文件的字符编码，只在 entries 值为"all"时有效。如果 entries 值为"all"且不传 encoding，则以 ArrayBuffer 格式读取文件的二进制内容 |
| entries | File[] or "all" | 是 | 要读取的压缩包内的文件列表（当传入"all" 时表示读取压缩包内所有文件） |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: FailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### File

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| path | `string` | 是 | 压缩包内文件路径 |
| encoding | `string` | 否 | 指定读取文件的字符编码，如果不传 encoding，则以 ArrayBuffer 格式读取文件的二进制内容 |
| position | `number` | 否 | 从文件指定位置开始读，如果不指定，则从文件头开始读。读取的范围应该是左闭右开区间 [position, position+length)。有效范围：[0, fileLength - 1]。单位：byte |
| length | `number` | 否 | 指定文件的长度，如果不指定，则读到文件末尾。有效范围：[1, fileLength]。单位：byte |

#### Encoding

字符编码合法值

| 参数 | 异常情况 |
| --- | :---: |
| ascii |  |
| base64 |  |
| binary |  |
| hex |  |
| ucs2 | `以小端序读取` |
| ucs-2 | `以小端序读取` |
| utf16le | `以小端序读取` |
| utf-16le | `以小端序读取` |
| utf-8 |  |
| utf8 |  |
| latin1 |  |

#### FailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail no such file or directory, open ${filePath}': 指定的 filePath 所在目录不存在<br />- 'fail permission denied, open ${dirPath}': 指定的 filePath 路径没有读权限<br />- 'fail sdcard not mounted': Android sdcard 挂载失败 |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| entries | `{ [path: string]: FileItem; }` | 文件读取结果。res.entries 是一个对象，key是文件路径，value是一个对象 FileItem ，表示该文件的读取结果。每个 FileItem 包含 data （文件内容） 和 errMsg （错误信息） 属性。 |

#### FileItem

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | string or ArrayBuffer | 文件内容 |
| errMsg | `string` | 错误信息 |

### RemoveSavedFileOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 需要删除的文件路径 |
| apFilePath | `string` | 否 | 本地缓存文件路径<br />API 支持度: alipay |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: RemoveSavedFileFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### RemoveSavedFileFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail file not exist': 指定的 tempFilePath 找不到文件; |

### RenameOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| newPath | `string` | 是 | 新文件路径 |
| oldPath | `string` | 是 | 源文件路径，可以是普通文件或目录 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: RenameFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### RenameFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail permission denied, rename ${oldPath} -> ${newPath}': 指定源文件或目标文件没有写权限;<br />- 'fail no such file or directory, rename ${oldPath} -> ${newPath}': 源文件不存在，或目标文件路径的上层目录不存在; |

### RmdirOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| dirPath | `string` | 是 | 要删除的目录路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: RmdirFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| recursive | `boolean` | 否 | 是否递归删除目录。如果为 true，则删除该目录和该目录下的所有子目录以及文件。 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### RmdirFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail no such file or directory ${dirPath}': 目录不存在;<br />- 'fail directory not empty': 目录不为空;<br />- 'fail permission denied, open ${dirPath}': 指定的 dirPath 路径没有写权限; |

### SaveFileOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tempFilePath | `string` | 是 | 临时存储文件路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: SaveFileFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| filePath | `string` | 否 | 要存储的文件路径 |
| success | `(result: SaveFileSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SaveFileFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail tempFilePath file not exist': 指定的 tempFilePath 找不到文件;<br />- 'fail permission denied, open "${filePath}"': 指定的 filePath 路径没有写权限;<br />- 'fail no such file or directory "${dirPath}"': 上级目录不存在;<br />- 'fail the maximum size of the file storage limit is exceeded': 存储空间不足; |

### SaveFileSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| savedFilePath | `string` | 存储后的文件路径 |
| errMsg | `string` | 调用结果 |

### StatOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| path | `string` | 是 | 文件/目录路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: StatFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| recursive | `boolean` | 否 | 是否递归获取目录下的每个文件的 Stats 信息 |
| success | `(result: StatSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### StatFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail permission denied, open ${path}': 指定的 path 路径没有读权限;<br />- 'fail no such file or directory ${path}': 文件不存在; |

### StatSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| stats | `any` | [Stats](/docs/apis/files/Stats) or Object<br /><br />当 recursive 为 false 时，res.stats 是一个 Stats 对象。当 recursive 为 true 且 path 是一个目录的路径时，res.stats 是一个 Object，key 以 path 为根路径的相对路径，value 是该路径对应的 Stats 对象。 |
| errMsg | `string` | 调用结果 |

### UnlinkOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 要删除的文件路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: UnlinkFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### UnlinkFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail permission denied, open ${path}': 指定的 path 路径没有读权限;<br />- 'fail no such file or directory ${path}': 文件不存在;<br />- 'fail operation not permitted, unlink ${filePath}': 传入的 filePath 是一个目录; |

### UnzipOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| targetPath | `string` | 是 | 目标目录路径 |
| zipFilePath | `string` | 是 | 源文件路径，只可以是 zip 压缩文件 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: UnzipFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### UnzipFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail permission denied, unzip ${zipFilePath} -> ${destPath}': 指定目标文件路径没有写权限;<br />- 'fail no such file or directory, unzip ${zipFilePath} -> "${destPath}': 源文件不存在，或目标文件路径的上层目录不存在; |

### WriteFileOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | string or ArrayBuffer | 是 | 要写入的文本或二进制数据 |
| filePath | `string` | 是 | 要写入的文件路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| encoding | `keyof Encoding` | 否 | 指定写入文件的字符编码 |
| fail | `(result: WriteFileFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### WriteFileFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail no such file or directory, open ${filePath}': 指定的 filePath 所在目录不存在;<br />- 'fail permission denied, open ${dirPath}': 指定的 filePath 路径没有写权限;<br />- 'fail the maximum size of the file storage limit is exceeded': 存储空间不足; |

### FstatOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| fd | `string` | 是 | 文件描述符。fd 通过 FileSystemManager.open 或 FileSystemManager.openSync 接口获得 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: FstatFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: FstatSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### FstatFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'bad file descriptor': 无效的文件描述符;<br />- 'fail permission denied': 指定的 fd 路径没有读权限; |

### FstatSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| stats | `Stats` | Stats 对象，包含了文件的状态信息 |
| errMsg | `string` | 调用结果 |

### FstatSyncOption

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fd | `string` | 文件描述符。fd 通过 FileSystemManager.open 或 FileSystemManager.openSync 接口获得 |

### CloseOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| fd | `string` | 是 | 需要被关闭的文件描述符。fd 通过 FileSystemManager.open 或 FileSystemManager.openSync 接口获得 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: CloseFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### CloseFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'bad file descriptor': 无效的文件描述符 |

### CloseSyncOption

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fd | `string` | 需要被关闭的文件描述符。fd 通过 FileSystemManager.open 或 FileSystemManager.openSync 接口获得 |

### FtruncateOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| fd | `string` | 是 | 文件描述符。fd 通过 FileSystemManager.open 或 FileSystemManager.openSync 接口获得 |
| length | `number` | 是 | 截断位置，默认0。如果 length 小于文件长度（单位：字节），则只有前面 length 个字节会保留在文件中，其余内容会被删除；如果 length 大于文件长度，则会对其进行扩展，并且扩展部分将填充空字节（'\0'） |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: FtruncateFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### FtruncateFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'bad file descriptor': 无效的文件描述符<br />- 'fail permission denied': 指定的 fd 没有写权限<br />- 'fail the maximum size of the file storage limit is exceeded': 存储空间不足<br />- 'fail sdcard not mounted android sdcard': 挂载失败 |

### FtruncateSyncOption

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fd | `string` | 文件描述符。fd 通过 FileSystemManager.open 或 FileSystemManager.openSync 接口获得 |
| length | `number` | 截断位置，默认0。如果 length 小于文件长度（单位：字节），则只有前面 length 个字节会保留在文件中，其余内容会被删除；如果 length 大于文件长度，则会对其进行扩展，并且扩展部分将填充空字节（'\0'） |

### OpenOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 文件路径 (本地路径) |
| flag | `keyof flag` | 否 | 文件系统标志，默认值: 'r' |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: OpenFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: OpenSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### OpenFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail no such file or directory "${filePath}"': 上级目录不存在 |

### OpenSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fd | `string` | 文件描述符 |
| errMsg | `string` | 调用结果 |

### OpenSyncOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 文件路径 (本地路径) |
| flag | `keyof flag` | 否 | 文件系统标志，默认值: 'r' |

### ReadOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| fd | `string` | 是 | 文件描述符。fd 通过 FileSystemManager.open 或 FileSystemManager.openSync 接口获得 |
| arrayBuffer | `ArrayBuffer` | 是 | 数据写入的缓冲区，必须是 ArrayBuffer 实例 |
| offset | `number` | 否 | 缓冲区中的写入偏移量，默认0 |
| length | `number` | 否 | 要从文件中读取的字节数，默认0 |
| position | `number` | 否 | 文件读取的起始位置，如不传或传 null，则会从当前文件指针的位置读取。如果 position 是正整数，则文件指针位置会保持不变并从 position 读取文件。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: ReadFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: ReadSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### ReadFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'bad file descriptor': 无效的文件描述符<br />- 'fail permission denied': 指定的 fd 路径没有读权限<br />- 'fail the value of "offset" is out of range': 传入的 offset 不合法<br />- 'fail the value of "length" is out of range': 传入的 length 不合法<br />- 'fail sdcard not mounted': android sdcard 挂载失败<br />- 'bad file descriptor': 无效的文件描述符 |

### ReadSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| bytesRead | `string` | 实际读取的字节数 |
| arrayBuffer | `ArrayBuffer` | 被写入的缓存区的对象，即接口入参的 arrayBuffer |
| errMsg | `string` | 调用结果 |

### readCompressedFile

#### Promised

```tsx
FailCallbackResult | SuccessCallbackResult
```

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 要读取的文件的路径 (本地用户文件或代码包文件) |
| compressionAlgorithm | `string` | 是 | 文件压缩类型，目前仅支持 'br'。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: FailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### CompressionAlgorithm

文件压缩类型合法值

| 参数 | 说明 |
| --- | --- |
| br | brotli压缩文件 |

#### FailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail decompress fail': 指定的 compressionAlgorithm 与文件实际压缩格式不符<br />- 'fail no such file or directory, open ${filePath}': 指定的 filePath 所在目录不存在<br />- 'fail permission denied, open ${dirPath}': 指定的 filePath 路径没有读权限 |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | `ArrayBuffer` | 文件内容 |

### readCompressedFileSync

#### Option

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| filePath | `string` | 要读取的文件的路径 (本地用户文件或代码包文件) |
| compressionAlgorithm | `string` | 文件压缩类型，目前仅支持 'br'。 |

#### CompressionAlgorithm

文件压缩类型合法值

| 参数 | 说明 |
| --- | --- |
| br | brotli压缩文件 |

### ReadSyncOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| fd | `string` | 是 | 文件描述符。fd 通过 FileSystemManager.open 或 FileSystemManager.openSync 接口获得 |
| arrayBuffer | `ArrayBuffer` | 是 | 数据写入的缓冲区，必须是 ArrayBuffer 实例 |
| offset | `number` | 否 | 缓冲区中的写入偏移量，默认0 |
| length | `number` | 否 | 要从文件中读取的字节数，默认0 |
| position | `number` | 否 | 文件读取的起始位置，如不传或传 null，则会从当前文件指针的位置读取。如果 position 是正整数，则文件指针位置会保持不变并从 position 读取文件。 |

### TruncateOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 要截断的文件路径 (本地路径) |
| length | `number` | 否 | 截断位置，默认0。如果 length 小于文件长度（字节），则只有前面 length 个字节会保留在文件中，其余内容会被删除；如果 length 大于文件长度，则会对其进行扩展，并且扩展部分将填充空字节（'\0'） |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: TruncateFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### TruncateFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail no such file or directory, open ${filePath}': 指定的 filePath 所在目录不存在<br />- 'fail illegal operation on a directory, open "${filePath}"': 指定的 filePath 是一个已经存在的目录<br />- 'fail permission denied, open ${dirPath}': 指定的 filePath 路径没有写权限<br />- 'fail the maximum size of the file storage limit is exceeded': 存储空间不足<br />- 'fail sdcard not mounted': android sdcard 挂载失败 |

### TruncateSyncOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 要截断的文件路径 (本地路径) |
| length | `number` | 否 | 截断位置，默认0。如果 length 小于文件长度（字节），则只有前面 length 个字节会保留在文件中，其余内容会被删除；如果 length 大于文件长度，则会对其进行扩展，并且扩展部分将填充空字节（'\0'） |

### WriteOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| fd | `string` | 是 | 文件描述符。fd 通过 FileSystemManager.open 或 FileSystemManager.openSync 接口获得 |
| data | string or ArrayBuffer | 是 | 写入的内容，类型为 String 或 ArrayBuffer |
| offset | `number` | 否 | 只在 data 类型是 ArrayBuffer 时有效，决定 arrayBuffe 中要被写入的部位，即 arrayBuffer 中的索引，默认0 |
| length | `number` | 否 | 只在 data 类型是 ArrayBuffer 时有效，指定要写入的字节数，默认为 arrayBuffer 从0开始偏移 offset 个字节后剩余的字节数 |
| encoding | `keyof Encoding` | 否 | 只在 data 类型是 String 时有效，指定写入文件的字符编码，默认为 utf8 |
| position | `number` | 否 | 指定文件开头的偏移量，即数据要被写入的位置。当 position 不传或者传入非 Number 类型的值时，数据会被写入当前指针所在位置。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: WriteFailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: WriteSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### WriteFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />'bad file descriptor': 无效的文件描述符<br />'fail permission denied': 指定的 fd 路径没有写权限<br />'fail sdcard not mounted': android sdcard 挂载失败 |

### WriteSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| bytesWritten | `number` | 实际被写入到文件中的字节数（注意，被写入的字节数不一定与被写入的字符串字符数相同） |
| errMsg | `string` | 调用结果 |

### WriteSyncOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| fd | `string` | 是 | 文件描述符。fd 通过 FileSystemManager.open 或 FileSystemManager.openSync 接口获得 |
| data | string or ArrayBuffer | 是 | 写入的内容，类型为 String 或 ArrayBuffer |
| offset | `number` | 否 | 只在 data 类型是 ArrayBuffer 时有效，决定 arrayBuffe 中要被写入的部位，即 arrayBuffer 中的索引，默认0 |
| length | `number` | 否 | 只在 data 类型是 ArrayBuffer 时有效，指定要写入的字节数，默认为 arrayBuffer 从0开始偏移 offset 个字节后剩余的字节数 |
| encoding | `keyof Encoding` | 否 | 只在 data 类型是 String 时有效，指定写入文件的字符编码，默认为 utf8 |
| position | `number` | 否 | 指定文件开头的偏移量，即数据要被写入的位置。当 position 不传或者传入非 Number 类型的值时，数据会被写入当前指针所在位置。 |

## API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| FileSystemManager | ✔️ |  |  | ✔️ |  |  |  |  |  | ✔️ | ✔️ |
| FileSystemManager.access | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ | ✔️ |
| FileSystemManager.accessSync | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.appendFile | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.appendFileSync | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.close | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| FileSystemManager.closeSync | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| FileSystemManager.copyFile | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.copyFileSync | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.fstat | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| FileSystemManager.fstatSync | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| FileSystemManager.ftruncate | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| FileSystemManager.ftruncateSync | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| FileSystemManager.getFileInfo | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ | ✔️ |
| FileSystemManager.getSavedFileList | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.mkdir | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.mkdirSync | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.open | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| FileSystemManager.openSync | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| FileSystemManager.read | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| FileSystemManager.readCompressedFile | ✔️ |  |  |  |  |  |  |  |  |  |  |
| FileSystemManager.readCompressedFileSync | ✔️ |  |  |  |  |  |  |  |  |  |  |
| FileSystemManager.readdir | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.readdirSync | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.readFile | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ | ✔️ |
| FileSystemManager.readFileSync | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ | ✔️ |
| FileSystemManager.readSync | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| FileSystemManager.readZipEntry | ✔️ |  |  |  |  |  |  |  |  |  |  |
| FileSystemManager.removeSavedFile | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.rename | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.renameSync | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.rmdir | ✔️ |  |  | ✔️ |  |  |  |  |  |  | ✔️ |
| FileSystemManager.rmdirSync | ✔️ |  |  | ✔️ |  |  |  |  |  |  | ✔️ |
| FileSystemManager.saveFile | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.saveFileSync | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.stat | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.statSync | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.truncate | ✔️ |  |  | ✔️ |  |  |  |  |  |  | ✔️ |
| FileSystemManager.truncateSync | ✔️ |  |  | ✔️ |  |  |  |  |  |  | ✔️ |
| FileSystemManager.unlink | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.unlinkSync | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.unzip | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.write | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| FileSystemManager.writeFile | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.writeFileSync | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| FileSystemManager.writeSync | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
</file>

<file path="docs/apis/files/getFileInfo.md">
---
title: Taro.getFileInfo(option)
sidebar_label: getFileInfo
---

获取该小程序下的 本地临时文件 或 本地缓存文件 信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/wx.getFileInfo.html)

## 类型

```tsx
(option: Option) => Promise<FailCallbackResult | SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| filePath | `string` |  | 是 | 要读取的文件路径 |
| apFilePath | `string` |  | 否 | 本地文件路径<br />API 支持度: alipay |
| digestAlgorithm | "md5" or "sha1" | `'md5'` | 否 | 计算文件摘要的算法 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: FailCallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### FailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail file not exist': 指定的 filePath 找不到文件; |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| size | `number` | 文件大小，以字节为单位 |
| digest | `string` | 按照传入的 digestAlgorithm 计算得出的的文件摘要 |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
Taro.getFileInfo({
    success: function (res) {
        console.log(res.size)
        console.log(res.digest)
    }
})
```
</file>

<file path="docs/apis/files/getFileSystemManager.md">
---
title: Taro.getFileSystemManager()
sidebar_label: getFileSystemManager
---

获取全局唯一的文件管理器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/wx.getFileSystemManager.html)

## 类型

```tsx
() => FileSystemManager
```
</file>

<file path="docs/apis/files/getSavedFileInfo.md">
---
title: Taro.getSavedFileInfo(option)
sidebar_label: getSavedFileInfo
---

获取本地文件的文件信息。此接口只能用于获取已保存到本地的文件，若需要获取临时文件信息，请使用 [Taro.getFileInfo](/docs/apis/files/getFileInfo) 接口。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/wx.getSavedFileInfo.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 文件路径 |
| apFilePath | `string` | 否 | 文件路径<br />API 支持度: alipay |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| createTime | `number` | 文件保存时的时间戳，从1970/01/01 08:00:00 到该时刻的秒数 |
| size | `number` | 文件大小，单位 B |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
Taro.getSavedFileInfo({
  filePath: 'wxfile://somefile', //仅做示例用，非真正的文件路径
  success: function (res) {
    console.log(res.size)
    console.log(res.createTime)
  }
})
```
</file>

<file path="docs/apis/files/getSavedFileList.md">
---
title: Taro.getSavedFileList(option)
sidebar_label: getSavedFileList
---

获取本地已保存的文件列表

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/wx.getSavedFileList.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fileList | `FileItem[]` | 文件数组 |
| errMsg | `string` | 调用结果 |

### FileItem

文件数组

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| createTime | `number` | 是 | 文件保存时的时间戳，从1970/01/01 08:00:00 到当前时间的秒数 |
| filePath | `string` | 是 | 本地路径 |
| apFilePath | `string` | 否 | 文件路径<br />API 支持度: alipay |
| size | `number` | 是 | 本地文件大小，以字节为单位 |

## 示例代码

```tsx
Taro.getSavedFileList({
  success: function (res) {
    console.log(res.fileList)
  }
})
```
</file>

<file path="docs/apis/files/openDocument.md">
---
title: Taro.openDocument(option)
sidebar_label: openDocument
---

新开页面打开文档，支持格式

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/wx.openDocument.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 文件路径，可通过 downloadFile 获得 |
| showMenu | `boolean` | 否 | 是否显示右上角菜单 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| fileType | `keyof FileType` | 否 | 文件类型，指定文件类型打开文件 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### FileType

文件类型

| 参数 | 说明 |
| --- | --- |
| doc | doc 格式 |
| docx | docx 格式 |
| xls | xls 格式 |
| xlsx | xlsx 格式 |
| ppt | ppt 格式 |
| pptx | pptx 格式 |
| pdf | pdf 格式 |

## 示例代码

```tsx
Taro.downloadFile({
  url: 'https://example.com/somefile.pdf',
  success: function (res) {
    var filePath = res.tempFilePath
    Taro.openDocument({
      filePath: filePath,
      success: function (res) {
        console.log('打开文档成功')
      }
    })
  }
})
```
</file>

<file path="docs/apis/files/ReadResult.md">
---
title: ReadResult
sidebar_label: ReadResult
---

文件读取结果。 通过 [FileSystemManager.readSync](./FileSystemManager#readsync) 接口返回

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/ReadResult.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| bytesRead | `number` | 实际读取的字节数 |
| arrayBuffer | `ArrayBuffer` | 被写入的缓存区的对象，即接口入参的 arrayBuffer |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| ReadResult | ✔️ |  |  |  | ✔️ |
</file>

<file path="docs/apis/files/removeSavedFile.md">
---
title: Taro.removeSavedFile(option)
sidebar_label: removeSavedFile
---

删除该小程序下已保存的本地缓存文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/wx.removeSavedFile.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 需要删除的文件路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### RemoveSavedFileFailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail file not exist': 指定的 tempFilePath 找不到文件; |

## 示例代码

```tsx
Taro.getSavedFileList({
  success: function (res) {
    if (res.fileList.length > 0){
      Taro.removeSavedFile({
        filePath: res.fileList[0].filePath,
        complete: function (res) {
          console.log(res)
        }
      })
    }
  }
})
```
</file>

<file path="docs/apis/files/saveFile.md">
---
title: Taro.saveFile(option)
sidebar_label: saveFile
---

保存文件到本地。**注意：saveFile 会把临时文件移动，因此调用成功后传入的 tempFilePath 将不可用**

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/wx.saveFile.html)

## 类型

```tsx
(option: Option) => Promise<FailCallbackResult | SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tempFilePath | `string` | 是 | 临时存储文件路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: FailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| filePath | `string` | 否 | 要存储的文件路径 |
| apFilePath | `string` | 否 | 要保存的本地临时文件路径<br />API 支持度: alipay |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### FailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'fail tempFilePath file not exist': 指定的 tempFilePath 找不到文件;<br />- 'fail permission denied, open "${filePath}"': 指定的 filePath 路径没有写权限;<br />- 'fail no such file or directory "${dirPath}"': 上级目录不存在;<br />- 'fail the maximum size of the file storage limit is exceeded': 存储空间不足; |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| savedFilePath | `string` | 存储后的文件路径 |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
Taro.chooseImage({
  success: function (res) {
    var tempFilePaths = res.tempFilePaths
    Taro.saveFile({
      tempFilePath: tempFilePaths[0],
      success: function (res) {
        var savedFilePath = res.savedFilePath
      }
    })
  }
})
```
</file>

<file path="docs/apis/files/saveFileToDisk.md">
---
title: Taro.saveFileToDisk(option)
sidebar_label: saveFileToDisk
---

保存文件系统的文件到用户磁盘，仅在 PC 端支持

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/wx.saveFileToDisk.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 待保存文件路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.saveFileToDisk({
  filePath: `${Taro.env.USER_DATA_PATH}/hello.txt`,
  success(res) {
    console.log(res)
  },
  fail(res) {
    console.error(res)
  }
})
```
</file>

<file path="docs/apis/files/Stats.md">
---
title: Stats
sidebar_label: Stats
---

描述文件状态的对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/Stats.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| mode | `string` | 文件的类型和存取的权限，对应 POSIX stat.st_mode |
| size | `number` | 文件大小，单位：B，对应 POSIX stat.st_size |
| lastAccessedTime | `number` | 文件最近一次被存取或被执行的时间，UNIX 时间戳，对应 POSIX stat.st_atime |
| lastModifiedTime | `number` | 文件最后一次被修改的时间，UNIX 时间戳，对应 POSIX stat.st_mtime |

### isDirectory

判断当前文件是否一个目录

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/Stats.isDirectory.html)

```tsx
() => boolean
```

### isFile

判断当前文件是否一个普通文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/Stats.isFile.html)

```tsx
() => boolean
```

## API 支持度

| API | 微信小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| Stats | ✔️ |  |  |  |  |  |  |  | ✔️ |
| Stats.isDirectory | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
| Stats.isFile | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
</file>

<file path="docs/apis/files/WriteResult.md">
---
title: WriteResult
sidebar_label: WriteResult
---

文件写入结果。 通过 [FileSystemManager.writeSync](./FileSystemManager#writesync) 接口返回

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/file/WriteResult.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| bytesWritten | `number` | 实际被写入到文件中的字节数（注意，被写入的字节数不一定与被写入的字符串字符数相同） |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| WriteResult | ✔️ |  |  |  | ✔️ |
</file>

<file path="docs/apis/framework/App.md">
---
title: App
sidebar_label: App
---

注册小程序。接受一个 `Object` 参数，其指定小程序的生命周期回调等。

## 方法
</file>

<file path="docs/apis/framework/getApp.md">
---
title: Taro.getApp(opts)
sidebar_label: getApp
---

获取到小程序全局唯一的 App 实例。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/reference/api/getApp.html)

## 类型

```tsx
<T = TaroGeneral.IAnyObject>(opts?: Option) => Instance<T>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| opts | `T` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| allowDefault | `boolean` | 否 | 在 `App` 未定义时返回默认实现。当App被调用时，默认实现中定义的属性会被覆盖合并到App中。一般用于独立分包 |

### Instance

```tsx
Option | T
```
</file>

<file path="docs/apis/framework/getCurrentPages.md">
---
title: Taro.getCurrentPages()
sidebar_label: getCurrentPages
---

获取当前页面栈。数组中第一个元素为首页，最后一个元素为当前页面。
__注意：__
- __不要尝试修改页面栈，会导致路由以及页面状态错误。__
- 不要在 `App.onLaunch` 的时候调用 `getCurrentPages()`，此时 `page` 还没有生成。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/reference/api/getCurrentPages.html)

## 类型

```tsx
() => Page[]
```

## 示例代码

```tsx
Taro.getCurrentPages().length
```
</file>

<file path="docs/apis/framework/Page.md">
---
title: Page
sidebar_label: Page
---

注册小程序中的一个页面。接受一个 `Object` 类型参数，其指定页面的初始数据、生命周期回调、事件处理函数等。

## 方法

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| route | `string` | 否 | 当前页面的路径<br />note: 推荐使用 Taro.getCurrentInstance().router?.path 方法 |
| __route__ | `string` | 否 |  |
</file>

<file path="docs/apis/location/chooseLocation.md">
---
title: Taro.chooseLocation(option)
sidebar_label: chooseLocation
---

打开地图选择位置。

`chooseLocation` api功能是依赖于腾讯位置服务，所以需要使用 api 密钥。如果您没有，可以前往腾讯位置服务[开发者控制台](https://lbs.qq.com/console/mykey.html?console=mykey)进行申请。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.chooseLocation.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| latitude | `number` | 否 | 目标地纬度 |
| longitude | `number` | 否 | 目标地经度 |
| mapOpts | `Record<string, unknown>` | 否 | 地图选点组件参数<br />API 支持度: h5<br />h5: 仅支持 H5 使用<br />[参考地址](https://lbs.qq.com/webApi/component/componentGuide/componentPicker) |
| title | `string` | 否 | 页面显示标题<br />API 支持度: alipay<br />alipay: 安卓默认值为 位置，iOS、IDE 默认值为 你在哪里?<br />[参考地址](https://opendocs.alipay.com/mini/api/location?pathHash=951b46a1) |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| address | `string` | 是 | 详细地址 |
| latitude | `number` | 是 | 纬度，浮点数，范围为-90~90，负数表示南纬。使用 gcj02 国测局坐标系 |
| longitude | `number` | 是 | 经度，浮点数，范围为-180~180，负数表示西经。使用 gcj02 国测局坐标系 |
| name | `string` | 是 | 位置名称 |
| adCode | `number` | 否 | 区县代码<br />API 支持度: alipay |
| adName | `string` | 否 | 区县名称<br />API 支持度: alipay |
| cityCode | `string` | 否 | 城市代码<br />API 支持度: alipay |
| cityName | `string` | 否 | 城市名称<br />API 支持度: alipay |
| provinceCode | `number` | 否 | 省份代码<br />API 支持度: alipay |
| provinceName | `string` | 否 | 省份名称<br />API 支持度: alipay |
| errMsg | `string` | 是 | 调用结果 |

## 示例代码

```tsx
// config/index.js

// 获得 api 密钥后，您需要将它填入项目的常量配置`defineConstants.LOCATION_APIKEY`中：
const config = {
  defineConstants: {
    LOCATION_APIKEY: JSON.stringify('XXXXX-XXXXX-XXXXX-XXXXX-XXXXX-XXXXX')
  },
  // ...
}
```
</file>

<file path="docs/apis/location/choosePoi.md">
---
title: Taro.choosePoi(option)
sidebar_label: choosePoi
---

打开POI列表选择位置，支持模糊定位（精确到市）和精确定位混选。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.choosePoi.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `number` | 选择城市时，值为 1，选择精确位置时，值为 2 |
| city | `number` | 城市名称 |
| name | `string` | 位置名称 |
| address | `string` | 详细地址 |
| latitude | `number` | 纬度，浮点数，范围为-90~90，负数表示南纬。使用 gcj02 国测局坐标系 |
| longitude | `number` | 经度，浮点数，范围为-180~180，负数表示西经。使用 gcj02 国测局坐标系 |
</file>

<file path="docs/apis/location/getFuzzyLocation.md">
---
title: Taro.getFuzzyLocation(option)
sidebar_label: getFuzzyLocation
---

获取当前的模糊地理位置

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.getFuzzyLocation.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| type | `keyof Type` | 否 | wgs84 返回 gps 坐标，gcj02 返回可用于 Taro.openLocation 的坐标 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### Type

| 参数 | 说明 |
| --- | --- |
| wgs84 | 返回 gps 坐标 |
| gcj02 | 返回 gcj02 坐标 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| latitude | `number` | 纬度，范围为 -90~90，负数表示南纬 |
| longitude | `number` | 经度，范围为 -180~180，负数表示西经 |

## 示例代码

```tsx
Taro.getFuzzyLocation({
  type: 'wgs84',
  success (res) {
    const latitude = res.latitude
    const longitude = res.longitude
  },
})
```
</file>

<file path="docs/apis/location/getLocation.md">
---
title: Taro.getLocation(option)
sidebar_label: getLocation
---

获取当前的地理位置、速度。当用户离开小程序后，此接口无法调用。开启高精度定位，接口耗时会增加，可指定 highAccuracyExpireTime 作为超时时间。

**注意**
- 工具中定位模拟使用IP定位，可能会有一定误差。且工具目前仅支持 gcj02 坐标。
- 使用第三方服务进行逆地址解析时，请确认第三方服务默认的坐标系，正确进行坐标转换。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.getLocation.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| altitude | `boolean` | `false` | 否 | 传入 true 会返回高度信息，由于获取高度需要较高精确度，会减慢接口返回速度 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| highAccuracyExpireTime | `number` |  | 否 | 高精度定位超时时间(ms)，指定时间内返回最高精度，该值3000ms以上高精度定位才有效果 |
| isHighAccuracy | `boolean` | `false` | 否 | 开启高精度定位 |
| success | `(result: SuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |
| type | `string` | `"wgs84"` | 否 | wgs84 返回 gps 坐标，gcj02 返回可用于 Taro.openLocation 的坐标 |
| needFullAccuracy | `boolean` | `false` | 否 | 针对 iOS14/Android12 及以上的新特性，其他情况本参数忽略。默认情况宿主是精确定位就返回精确定位信息。<br />传入 true 会强制使用精确定位信息，iOS14/Android12 及以上如果没有精确定位权限，会弹出精确定位授权弹框<br />API 支持度: swan |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| accuracy | `number` | 是 | 位置的精确度 |
| altitude | `number` | 是 | 高度，单位 m |
| horizontalAccuracy | `number` | 是 | 水平精度，单位 m |
| latitude | `number` | 是 | 纬度，范围为 -90~90，负数表示南纬 |
| longitude | `number` | 是 | 经度，范围为 -180~180，负数表示西经 |
| speed | `number` | 是 | 速度，单位 m/s |
| verticalAccuracy | `number` | 是 | 垂直精度，单位 m（Android 无法获取，返回 0） |
| street | `string` | 否 | 城市名称<br />API 支持度: swan |
| cityCode | `string` | 否 | 国家代码<br />API 支持度: swan |
| city | `string` | 否 | 城市名称<br />API 支持度: swan, tt |
| country | `string` | 否 | 国家<br />API 支持度: swan |
| countryCode | `string` | 否 | 国家代码<br />API 支持度: swan |
| province | `string` | 否 | 省份<br />API 支持度: swan |
| streetNumber | `string` | 否 | 街道号码<br />API 支持度: swan |
| district | `string` | 否 | 区<br />API 支持度: swan |
| isFullAccuracy | `boolean` | 否 | 是不是精确定位信息<br />API 支持度: swan |
| errMsg | `string` | 是 | 调用结果 |

## 示例代码

 ```tsx
Taro.getLocation({
 type: 'wgs84',
 success: function (res) {
   const latitude = res.latitude
   const longitude = res.longitude
   const speed = res.speed
   const accuracy = res.accuracy
 }
})
```
</file>

<file path="docs/apis/location/offLocationChange.md">
---
title: Taro.offLocationChange(callback)
sidebar_label: offLocationChange
---

取消监听实时地理位置变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.offLocationChange.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 实时地理位置变化事件的回调函数 |
</file>

<file path="docs/apis/location/offLocationChangeError.md">
---
title: Taro.offLocationChangeError(callback)
sidebar_label: offLocationChangeError
---

取消监听持续定位接口返回失败时触发

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.offLocationChangeError.html)

## 类型

```tsx
(callback?: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 监听持续定位接口返回失败时触发的回调函数 |
</file>

<file path="docs/apis/location/onLocationChange.md">
---
title: Taro.onLocationChange(callback)
sidebar_label: onLocationChange
---

监听实时地理位置变化事件，需结合 Taro.startLocationUpdateBackground、Taro.startLocationUpdate 使用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.onLocationChange.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 实时地理位置变化事件的回调函数 |

### Callback

实时地理位置变化事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| accuracy | `number` | 是 | 位置的精确度 |
| altitude | `number` | 是 | 高度，单位 m |
| horizontalAccuracy | `number` | 是 | 水平精度，单位 m |
| latitude | `number` | 是 | 纬度，范围为 -90~90，负数表示南纬 |
| longitude | `number` | 是 | 经度，范围为 -180~180，负数表示西经 |
| speed | `number` | 是 | 速度，单位 m/s |
| verticalAccuracy | `number` | 是 | 垂直精度，单位 m（Android 无法获取，返回 0） |
| street | `string` | 否 | 街道名称<br />API 支持度: swan |
| cityCode | `string` | 否 | 城市编码<br />API 支持度: swan |
| city | `string` | 否 | 城市名称<br />API 支持度: swan, tt<br />tt: iOS 不支持 |
| country | `string` | 否 | 国家<br />API 支持度: swan |
| countryCode | `string` | 否 | 国家代码<br />API 支持度: swan |
| province | `string` | 否 | 省份<br />API 支持度: swan |
| streetNumber | `string` | 否 | 街道号码<br />API 支持度: swan |
| district | `string` | 否 | 区<br />API 支持度: swan |
| isFullAccuracy | `boolean` | 否 | 是不是精确定位信息<br />API 支持度: swan |

## 示例代码

```tsx
const _locationChangeFn = function (res) {
 console.log('location change', res)
}
Taro.onLocationChange(_locationChangeFn)
Taro.offLocationChange(_locationChangeFn)
```
</file>

<file path="docs/apis/location/onLocationChangeError.md">
---
title: Taro.onLocationChangeError(callback)
sidebar_label: onLocationChangeError
---

监听持续定位接口返回失败时触发

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.onLocationChangeError.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 监听持续定位接口返回失败时触发的回调函数 |

### Callback

监听持续定位接口返回失败时触发的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| errCode | `number` | 是 | 错误码 |
| errMsg | `string` | 否 | 错误信息<br />API 支持度: tt<br />tt: 最低支持版本 2.48.0 |
</file>

<file path="docs/apis/location/openLocation.md">
---
title: Taro.openLocation(option)
sidebar_label: openLocation
---

使用微信内置地图查看位置

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.openLocation.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| latitude | `number` | 是 | 纬度，范围为-90~90，负数表示南纬。使用 gcj02 国测局坐标系 |
| longitude | `number` | 是 | 经度，范围为-180~180，负数表示西经。使用 gcj02 国测局坐标系 |
| scale | `number` | 否 | 缩放比例<br />weapp: 范围 5~18，默认值18<br />alipay: 范围 3~19，默认值15 |
| name | `string` | 否 | 位置名 |
| address | `string` | 否 | 地址的详细说明 |
| ignoredApps | `any[]` | 否 | 定义在拉起的地图 App 面板中需要被屏蔽的地图类 App<br />API 支持度: swan |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.getLocation({
 type: 'gcj02', //返回可以用于 Taro.openLocation的经纬度
 success: function (res) {
   const latitude = res.latitude
   const longitude = res.longitude
   Taro.openLocation({
     latitude,
     longitude,
     scale: 18
   })
 }
})
```
</file>

<file path="docs/apis/location/startLocationUpdate.md">
---
title: Taro.startLocationUpdate(option)
sidebar_label: startLocationUpdate
---

开启小程序进入前台时接收位置消息

**注意**
- 获取位置信息需配置[地理位置用途说明](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#permission)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.startLocationUpdate.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| type | `string` | `"gcj02"` | 否 | wgs84 返回 gps 坐标，gcj02 返回可用于 wx.openLocation 的坐标 |
| needFullAccuracy | `boolean` | `false` | 否 | 针对 iOS14/Android12 及以上的新特性，其他情况本参数忽略。默认情况宿主是精确定位就返回精确定位信息。<br />传入 true 会强制使用精确定位信息，iOS14/Android12 及以上如果没有精确定位权限，会弹出精确定位授权弹框<br />API 支持度: swan |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/location/startLocationUpdateBackground.md">
---
title: Taro.startLocationUpdateBackground(option)
sidebar_label: startLocationUpdateBackground
---

开启小程序进入前后台时均接收位置消息，需引导用户开启[授权](../open-api/authorize/authorize.md#后台定位)。授权以后，小程序在运行中或进入后台均可接受位置消息变化。

**注意**
- 安卓微信7.0.6版本，iOS 7.0.5版本起支持该接口
- 需在app.json中配置requiredBackgroundModes: ['location']后使用
- 获取位置信息需配置[地理位置用途说明](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#permission)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.startLocationUpdateBackground.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| type | `string` | `"gcj02"` | 否 | wgs84 返回 gps 坐标，gcj02 返回可用于 wx.openLocation 的坐标 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/location/stopLocationUpdate.md">
---
title: Taro.stopLocationUpdate(option)
sidebar_label: stopLocationUpdate
---

关闭监听实时位置变化，前后台都停止消息接收

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.stopLocationUpdate.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/media/audio/AudioBuffer.md">
---
title: AudioBuffer
sidebar_label: AudioBuffer
---

AudioBuffer 接口表示存在内存里的一段短小的音频资源，利用 [WebAudioContext.decodeAudioData](./WebAudioContext#decodeaudiodata) 方法从一个音频文件构建，或者利用 [AudioContext.createBuffer](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/(AudioContext.createBuffer).html) 从原始数据构建。把音频放入 AudioBuffer 后，可以传入到一个 AudioBufferSourceNode 进行播放。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/AudioBuffer.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| sampleRate | `number` | 存储在缓存区的PCM数据的采样率（单位为sample/s) |
| length | `number` | 返回存储在缓存区的PCM数据的采样帧率 |
| duration | `number` | 返回存储在缓存区的PCM数据的时长（单位为秒） |
| numberOfChannels | `number` | 储存在缓存区的PCM数据的通道数 |

### getChannelData

返回一个 Float32Array，包含了带有频道的PCM数据，由频道参数定义（有0代表第一个频道）

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/AudioBuffer.getChannelData.html)

```tsx
(channel: number) => Float32Array
```

| 参数 | 类型 |
| --- | --- |
| channel | `number` |

#### 示例代码

```tsx
const audioCtx = Taro.createWebAudioContext()
const myArrayBuffer = audioCtx.createBuffer(2, frameCount, audioCtx.sampleRate);
const nowBuffering = myArrayBuffer.getChannelData(channel);
```

### copyFromChannel

从 AudioBuffer 的指定频道复制到数组终端。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/AudioBuffer.copyFromChannel.html)

```tsx
() => void
```

#### 示例代码

```tsx
const audioCtx = Taro.createWebAudioContext()
const audioBuffer = audioCtx.createFromAudioFile({
  filePath:'/pages/res/bgm.mp3', // 静态资源
  mixToMono:true,
  sampleRate:44100
});
const channels = audioBuffer.numberOfChannels
const anotherArray = new Float32Array(frameCount);
const rate = audioBuffer.sampleRate
const startOffSet = 0
const endOffset = rate * 3;
const newAudioBuffer = audioCtx.createBuffer(channels,endOffset - startOffset,rate)
const offset = 0

for (let channel = 0; channel < channels; channel++) {
  audioBuffer.copyFromChannel(anotherArray, channel, startOffset);
  newAudioBuffer.copyToChannel(anotherArray, channel, offset);
}
```

### copyToChannel

从指定数组复制样本到 audioBuffer 的特定通道

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/AudioBuffer.copyToChannel.html)

```tsx
(source: Float32Array, channelNumber: number, startInChannel: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| source | `Float32Array` | 需要复制的源数组 |
| channelNumber | `number` | 需要复制到的目的通道号 |
| startInChannel | `number` | 复制偏移数据量 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| AudioBuffer | ✔️ |  |  |  |  |
| AudioBuffer.getChannelData | ✔️ |  |  |  |  |
| AudioBuffer.copyFromChannel | ✔️ |  |  |  |  |
| AudioBuffer.copyToChannel | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/media/audio/AudioContext.md">
---
title: AudioContext
sidebar_label: AudioContext
---

`AudioContext` 实例，可通过 `Taro.createAudioContext` 获取。

`AudioContext` 通过 `id` 跟一个 `audio` 组件绑定，操作对应的 audio 组件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/AudioContext.html)

## 方法

### pause

暂停音频。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/AudioContext.pause.html)

```tsx
() => void
```

### play

播放音频。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/AudioContext.play.html)

```tsx
() => void
```

### seek

跳转到指定位置。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/AudioContext.seek.html)

```tsx
(position: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| position | `number` | 跳转位置，单位 s |

### setSrc

设置音频地址

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/AudioContext.setSrc.html)

```tsx
(src: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| src | `string` | 音频地址 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| AudioContext | ✔️ |  |  |  | ✔️ | ✔️ |
| AudioContext.pause | ✔️ |  |  |  | ✔️ | ✔️ |
| AudioContext.play | ✔️ |  |  |  | ✔️ | ✔️ |
| AudioContext.seek | ✔️ |  |  |  |  | ✔️ |
| AudioContext.setSrc | ✔️ |  |  |  |  | ✔️ |
</file>

<file path="docs/apis/media/audio/createAudioContext.md">
---
title: Taro.createAudioContext(id, component)
sidebar_label: createAudioContext
---

创建 audio 上下文 AudioContext 对象。
**注意：1.6.0 版本开始，本接口不再维护。建议使用能力更强的 [Taro.createInnerAudioContext](./createInnerAudioContext) 接口**

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/wx.createAudioContext.html)

## 类型

```tsx
(id: string, component?: TaroGeneral.IAnyObject) => AudioContext
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `string` | [audio](/docs/components/media/audio) 组件的 id |
| component | `TaroGeneral.IAnyObject` | 在自定义组件下，当前组件实例的this，以操作组件内 [audio](/docs/components/media/audio) 组件 |

## 示例代码

```tsx
const audioCtx = Taro.createAudioContext('myAudio')
```
</file>

<file path="docs/apis/media/audio/createInnerAudioContext.md">
---
title: Taro.createInnerAudioContext(option)
sidebar_label: createInnerAudioContext
---

创建内部 audio 上下文 InnerAudioContext 对象。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/wx.createInnerAudioContext.html)

## 类型

```tsx
(option?: Option) => InnerAudioContext
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| useWebAudioImplement | `boolean` | 是否使用 WebAudio 作为底层音频驱动，默认关闭。对于短音频、播放频繁的音频建议开启此选项，开启后将获得更优的性能表现。由于开启此选项后也会带来一定的内存增长，因此对于长音频建议关闭此选项。<br />API 支持度: weapp |

## 示例代码

```tsx
const innerAudioContext = Taro.createInnerAudioContext()
innerAudioContext.autoplay = true
innerAudioContext.src = 'https://storage.360buyimg.com/jdrd-blog/27.mp3'
innerAudioContext.onPlay(() => {
  console.log('开始播放')
})
innerAudioContext.onError((res) => {
  console.log(res.errMsg)
  console.log(res.errCode)
})
```
</file>

<file path="docs/apis/media/audio/createMediaAudioPlayer.md">
---
title: Taro.createMediaAudioPlayer()
sidebar_label: createMediaAudioPlayer
---

创建媒体音频播放器对象 [MediaAudioPlayer](./MediaAudioPlayer) 对象，可用于播放视频解码器 [VideoDecoder](/docs/apis/media/video-decoder/VideoDecoder) 输出的音频

**注意事项**
- iOS 7.0.15 mediaAudioPlayer 播放网络视频资源会出现音频卡顿，本地视频没有这个问题，将下一个客户端版本修复。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/wx.createMediaAudioPlayer.html)

## 类型

```tsx
() => MediaAudioPlayer
```

## 示例代码

```tsx
// 创建视频解码器，具体参数见 createVideoDecoder 文档
const videoDecoder = Taro.createVideoDecoder()
// 创建媒体音频播放器
const mediaAudioPlayer = Taro.createMediaAudioPlayer()
// 启动视频解码器
videoDecoder.start()
// 启动播放器
mediaAudioPlayer.start().then(() => {
  // 添加播放器音频来源
  mediaAudioPlayer.addAudioSource(videoDecoder).then(res => {
    videoDecoder.getFrameData() // 建议在 requestAnimationFrame 里获取每一帧视频数据
    console.log(res)
  })

  // 移除播放器音频来源
  mediaAudioPlayer.removeAudioSource(videoDecoder).then()
  // 停止播放器
  mediaAudioPlayer.stop().then()
  // 销毁播放器
  mediaAudioPlayer.destroy().then()
  // 设置播放器音量
  mediaAudioPlayer.volume = 0.5
})
```
</file>

<file path="docs/apis/media/audio/createWebAudioContext.md">
---
title: Taro.createWebAudioContext()
sidebar_label: createWebAudioContext
---

创建 WebAudio 上下文。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/wx.createWebAudioContext.html)

## 类型

```tsx
() => WebAudioContext
```

## 示例代码

一个简单的播放demo

```tsx
const audioCtx = Taro.createWebAudioContext()

const loadAudio = (url) => {
  return new Promise((resolve) => {
    Taro.request({
      url,
      responseType: 'arraybuffer',
      success: res => {
        console.log('res.data', res.data)
        audioCtx.decodeAudioData(res.data, buffer => {
          resolve(buffer)
        }, err => {
          console.error('decodeAudioData fail', err)
          reject()
        })
      },
      fail: res => {
        console.error('request fail', res)
        reject()
      }
    })
  })
}

const play = () => {
  loadAudio('xxx-test.mp3').then(buffer => {
    const source = audioCtx.createBufferSource()
    source.buffer = buffer
    source.connect(audioCtx.destination)
    source.start()
  }).catch(() => {
    console.log('fail')
  })
}

play()
```
</file>

<file path="docs/apis/media/audio/getAvailableAudioSources.md">
---
title: Taro.getAvailableAudioSources(option)
sidebar_label: getAvailableAudioSources
---

获取当前支持的音频输入源

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/wx.getAvailableAudioSources.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| audioSources | `(keyof audioSources)[]` | 支持的音频输入源列表，可在 [RecorderManager.start()](/docs/apis/media/recorder/RecorderManager#start)用。返回值定义参考 https://developer.android.com/reference/kotlin/android/media/MediaRecorder.AudioSource |
| errMsg | `string` | 调用结果 |

### audioSources

支持的音频输入源

| 参数 | 说明 |
| --- | --- |
| auto | 自动设置，默认使用手机麦克风，插上耳麦后自动切换使用耳机麦克风，所有平台适用 |
| buildInMic | 手机麦克风，仅限 iOS |
| headsetMic | 耳机麦克风，仅限 iOS |
| mic | 麦克风（没插耳麦时是手机麦克风，插耳麦时是耳机麦克风），仅限 Android |
| camcorder | 同 mic，适用于录制音视频内容，仅限 Android |
| voice_communication | 同 mic，适用于实时沟通，仅限 Android |
| voice_recognition | 同 mic，适用于语音识别，仅限 Android |
</file>

<file path="docs/apis/media/audio/InnerAudioContext.md">
---
title: InnerAudioContext
sidebar_label: InnerAudioContext
---

InnerAudioContext 实例，可通过 [Taro.createInnerAudioContext](./createInnerAudioContext) 接口获取实例。

**支持格式**

| 格式 | iOS  | Android |
| ---- | ---- | ------- |
| flac | x    | √       |
| m4a  | √    | √       |
| ogg  | x    | √       |
| ape  | x    | √       |
| amr  | x    | √       |
| wma  | x    | √       |
| wav  | √    | √       |
| mp3  | √    | √       |
| mp4  | x    | √       |
| aac  | √    | √       |
| aiff | √    | x       |
| caf  | √    | x       |

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/InnerAudioContext.html)

## 方法

| 参数 | 类型 | 默认值 | 只读 | 必填 | 说明 |
| --- | --- | :---: | :---: | :---: | --- |
| src | `string` |  | 否 | 是 | 音频资源的地址，用于直接播放。 |
| startTime | `number` | `0` | 否 | 是 | 开始播放的位置（单位：s） |
| autoplay | `boolean` | `false` | 否 | 是 | 是否自动开始播放 |
| loop | `boolean` | `false` | 否 | 是 | 是否循环播放 |
| obeyMuteSwitch | `boolean` | `true` | 否 | 是 | 是否遵循系统静音开关。当此参数为 `false` 时，即使用户打开了静音开关，也能继续发出声音。从 2.3.0 版本开始此参数不生效，使用 [Taro.setInnerAudioOption](/docs/apis/media/audio/setInnerAudioOption) 接口统一设置。 |
| volume | `number` | `1` | 否 | 是 | 音量。范围 0~1。 |
| playbackRate | `number` | `1` | 否 | 是 | 播放速度。范围 0.5-2.0。 |
| duration | `number` |  | 是 | 是 | 当前音频的长度（单位 s）。只有在当前有合法的 src 时返回 |
| currentTime | `number` |  | 是 | 是 | 当前音频的播放位置（单位 s）。只有在当前有合法的 src 时返回，时间保留小数点后 6 位 |
| paused | `boolean` |  | 是 | 是 | 当前是是否暂停或停止状态 |
| buffered | `number` |  | 是 | 是 | 音频缓冲的时间点，仅保证当前播放时间点到此时间点内容已缓冲 |
| referrerPolicy | `string` |  | 否 | 否 | origin: 发送完整的 referrer; no-referrer: 不发送 |

### play

播放

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

```tsx
() => void
```

### pause

暂停

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
() => void
```

### stop

停止

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

```tsx
() => void
```

### seek

跳转到指定位置，单位 s

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(position: number) => void
```

| 参数 | 类型 |
| --- | --- |
| position | `number` |

### destroy

销毁当前实例

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
() => void
```

### onCanplay

音频进入可以播放状态，但不保证后面可以流畅播放

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnCanplayCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnCanplayCallback` |

### onPlay

音频播放事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

```tsx
(callback?: OnPlayCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnPlayCallback` |

### onPause

音频暂停事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnPauseCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnPauseCallback` |

### onStop

音频停止事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

```tsx
(callback?: OnStopCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnStopCallback` |

### onEnded

音频自然播放结束事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

```tsx
(callback?: OnEndedCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnEndedCallback` |

### onTimeUpdate

音频播放进度更新事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnTimeUpdateCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnTimeUpdateCallback` |

### onError

音频播放错误事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

```tsx
(callback?: OnErrorCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnErrorCallback` |

### onWaiting

音频加载中事件，当音频因为数据不足，需要停下来加载时会触发

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnWaitingCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnWaitingCallback` |

### onSeeking

音频进行 seek 操作事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnSeekingCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnSeekingCallback` |

### onSeeked

音频完成 seek 操作事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnSeekedCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnSeekedCallback` |

### offCanplay

取消监听 canplay 事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnCanplayCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnCanplayCallback` |

### offPlay

取消监听 play 事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnPlayCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnPlayCallback` |

### offPause

取消监听 pause 事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnPauseCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnPauseCallback` |

### offStop

取消监听 stop 事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnStopCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnStopCallback` |

### offEnded

取消监听 ended 事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnEndedCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnEndedCallback` |

### offTimeUpdate

取消监听 timeUpdate 事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnTimeUpdateCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnTimeUpdateCallback` |

### offError

取消监听 error 事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnErrorCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnErrorCallback` |

### offWaiting

取消监听 waiting 事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnWaitingCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnWaitingCallback` |

### offSeeking

取消监听 seeking 事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnSeekingCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnSeekingCallback` |

### offSeeked

取消监听 seeked 事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(callback?: OnSeekedCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `OnSeekedCallback` |

## 参数

### onErrorDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errCode | `number` | 错误码 |
| errMsg | `string` | 错误信息 |

### onErrorDetailErrCode

| 参数 | 说明 |
| --- | --- |
| 10001 | 系统错误 |
| 10002 | 网络错误 |
| 10003 | 文件错误 |
| 10004 | 格式错误 |
| -1 | 未知错误 |

### OnCanplayCallback

音频进入可以播放状态事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |

### OnPlayCallback

音频播放事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |

### OnPauseCallback

音频暂停事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |

### OnStopCallback

音频停止事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |

### OnEndedCallback

音频自然播放结束事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |

### OnTimeUpdateCallback

音频播放进度更新事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |

### OnErrorCallback

音频播放错误事件的回调函数

```tsx
(res: onErrorDetail) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `onErrorDetail` |

### OnWaitingCallback

音频加载中事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |

### OnSeekingCallback

音频进行 seek 操作事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |

### OnSeekedCallback

音频完成 seek 操作事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |

## 示例代码

```tsx
const innerAudioContext = Taro.createInnerAudioContext()
innerAudioContext.autoplay = true
innerAudioContext.src = 'https://ws.stream.qqmusic.qq.com/M500001VfvsJ21xFqb.mp3?guid=ffffffff82def4af4b12b3cd9337d5e7&uin=346897220&vkey=6292F51E1E384E061FF02C31F716658E5C81F5594D561F2E88B854E81CAAB7806D5E4F103E55D33C16F3FAC506D1AB172DE8600B37E43FAD&fromtag=46'
innerAudioContext.onPlay(() => {
  console.log('开始播放')
})
innerAudioContext.onError((res) => {
  console.log(res.errMsg)
  console.log(res.errCode)
})
```

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| InnerAudioContext.play | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| InnerAudioContext.pause | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.stop | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| InnerAudioContext.seek | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.destroy | ✔️ | ✔️ |  |  |  | ✔️ |
| InnerAudioContext.onCanplay | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.onPlay | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| InnerAudioContext.onPause | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.onStop | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| InnerAudioContext.onEnded | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| InnerAudioContext.onTimeUpdate | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.onError | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| InnerAudioContext.onWaiting | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.onSeeking | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.onSeeked | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.offCanplay | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.offPlay | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.offPause | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.offStop | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.offEnded | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.offTimeUpdate | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.offError | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.offWaiting | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.offSeeking | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| InnerAudioContext.offSeeked | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
</file>

<file path="docs/apis/media/audio/MediaAudioPlayer.md">
---
title: MediaAudioPlayer
sidebar_label: MediaAudioPlayer
---

MediaAudioPlayer 实例，可通过 [Taro.createMediaAudioPlayer](./createMediaAudioPlayer) 接口获取实例。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/MediaAudioPlayer.html)

## 方法

| 参数 | 类型 | 默认值 | 说明 |
| --- | --- | :---: | --- |
| volume | `number` | `1` | 音量。范围 0~1 |

### start

启动播放器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/MediaAudioPlayer.start.html)

```tsx
() => Promise<void>
```

### addAudioSource

添加音频源

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/MediaAudioPlayer.addAudioSource.html)

```tsx
(source: VideoDecoder) => Promise<void>
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| source | `VideoDecoder` | 视频解码器实例。作为音频源添加到音频播放器中 |

### removeAudioSource

移除音频源

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/MediaAudioPlayer.removeAudioSource.html)

```tsx
(source: VideoDecoder) => Promise<void>
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| source | `VideoDecoder` | 视频解码器实例 |

### stop

停止播放器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/MediaAudioPlayer.stop.html)

```tsx
() => Promise<void>
```

### destroy

销毁播放器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/MediaAudioPlayer.destroy.html)

```tsx
() => Promise<void>
```

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| MediaAudioPlayer | ✔️ |  |  |  |  |
| MediaAudioPlayer.start | ✔️ |  |  |  |  |
| MediaAudioPlayer.addAudioSource | ✔️ |  |  |  |  |
| MediaAudioPlayer.removeAudioSource | ✔️ |  |  |  |  |
| MediaAudioPlayer.stop | ✔️ |  |  |  |  |
| MediaAudioPlayer.destroy | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/media/audio/pauseVoice.md">
---
title: Taro.pauseVoice(option)
sidebar_label: pauseVoice
---

暂停正在播放的语音。再次调用 [Taro.playVoice](/docs/apis/media/audio/stopVoice)。
**注意：1.6.0 版本开始，本接口不再维护。建议使用能力更强的 [Taro.createInnerAudioContext](./createInnerAudioContext) 接口**

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/wx.pauseVoice.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.startRecord({
  success: function (res) {
    var tempFilePath = res.tempFilePath
      Taro.playVoice({
      filePath: tempFilePath
    })
    setTimeout(function() {
        //暂停播放
      Taro.pauseVoice()
    }, 5000)
  }
})
```
</file>

<file path="docs/apis/media/audio/playVoice.md">
---
title: Taro.playVoice(option)
sidebar_label: playVoice
---

开始播放语音。同时只允许一个语音文件正在播放，如果前一个语音文件还没播放完，将中断前一个语音播放。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/wx.playVoice.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 需要播放的语音文件的文件路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| duration | `number` | 否 | 指定录音时长，到达指定的录音时长后会自动停止录音，单位：秒 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.startRecord({
  success: function (res) {
    const tempFilePath = res.tempFilePath
    Taro.playVoice({
      filePath: tempFilePath,
      complete: function () { }
    })
  }
})
```
</file>

<file path="docs/apis/media/audio/setInnerAudioOption.md">
---
title: Taro.setInnerAudioOption(option)
sidebar_label: setInnerAudioOption
---

设置 [InnerAudioContext](/docs/apis/media/audio/InnerAudioContext)项。设置之后对当前小程序全局生效。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/wx.setInnerAudioOption.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| mixWithOther | `boolean` | 否 | 是否与其他音频混播，设置为 true 之后，不会终止其他应用或微信内的音乐 |
| obeyMuteSwitch | `boolean` | 否 | （仅在 iOS 生效）是否遵循静音开关，设置为 false 之后，即使是在静音模式下，也能播放声音 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/media/audio/stopVoice.md">
---
title: Taro.stopVoice(option)
sidebar_label: stopVoice
---

结束播放语音。
**注意：1.6.0 版本开始，本接口不再维护。建议使用能力更强的 [Taro.createInnerAudioContext](./createInnerAudioContext) 接口**

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/wx.stopVoice.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

### 示例 1

```tsx
Taro.startRecord({
  success: function (res) {
    const filePath = res.tempFilePath
    Taro.playVoice({ filePath })

    setTimeout(Taro.stopVoice, 5000)
  }
})
```

### 示例 2

```tsx
Taro.startRecord(params).then(res => {
  const filePath = res.tempFilePath
  Taro.playVoice({ filePath })

  setTimeout(Taro.stopVoice, 5000)
})
```
</file>

<file path="docs/apis/media/audio/WebAudioContext.md">
---
title: WebAudioContext
sidebar_label: WebAudioContext
---

WebAudioContext 实例，通过 [Taro.createWebAudioContext](./createWebAudioContext) 接口获取该实例。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| state | `string` | 当前 WebAudio 上下文的状态。<br /><br />可能的值如下：suspended（暂停）、running（正在运行）、closed（已关闭）。<br />需要注意的是，不要在 audioContext close 后再访问 state 属性 |
| onstatechange | `() => void` | 可写属性，开发者可以对该属性设置一个监听函数，当 WebAudio 状态改变的时候，会触发开发者设置的监听函数。 |
| currentTime | `number` | 获取当前上下文的时间戳。 |
| destination | `WebAudioContextNode` | 当前上下文的最终目标节点，一般是音频渲染设备。 |
| listener | `AudioListener` | 空间音频监听器。 |
| sampleRate | `number` | 采样率，通常在 8000-96000 之间，通常 44100hz 的采样率最为常见。 |

### close

关闭WebAudioContext

**注意事项**
同步关闭对应的 WebAudio 上下文。close 后会立即释放当前上下文的资源，**不要在 close 后再次访问 state 属性**。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.close.html)

```tsx
() => Promise<void>
```

#### 示例代码

```tsx
const audioCtx = Taro.createWebAudioContext()
audioCtx.close().then(() => {
  console.log(audioCtx.state) // bad case：不应该在close后再访问state
})
```

### resume

同步恢复已经被暂停的 WebAudioContext 上下文

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.resume.html)

```tsx
() => Promise<void>
```

### suspend

同步暂停 WebAudioContext 上下文

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.suspend.html)

```tsx
() => Promise<void>
```

### createIIRFilter

创建一个 IIRFilterNode

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createIIRFilter.html)

```tsx
(feedforward: number[], feedback: number[]) => IIRFilterNode
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| feedforward | `number[]` | 一个浮点值数组，指定IIR滤波器传递函数的前馈(分子)系数。 |
| feedback | `number[]` | 一个浮点值数组，指定IIR滤波器传递函数的反馈(分母)系数。 |

#### 示例代码

```tsx
let lowPassCoefs = [
  {
    frequency: 200,
    feedforward: [0.00020298, 0.0004059599, 0.00020298],
    feedback: [1.0126964558, -1.9991880801, 0.9873035442]
  },
  {
    frequency: 500,
    feedforward: [0.0012681742, 0.0025363483, 0.0012681742],
    feedback: [1.0317185917, -1.9949273033, 0.9682814083]
  },
  {
    frequency: 1000,
    feedforward: [0.0050662636, 0.0101325272, 0.0050662636],
    feedback: [1.0632762845, -1.9797349456, 0.9367237155]
  },
  {
    frequency: 5000,
    feedforward: [0.1215955842, 0.2431911684, 0.1215955842],
    feedback: [1.2912769759, -1.5136176632, 0.7087230241]
  }
]

const feedForward = lowPassCoefs[filterNumber].feedforward
const feedBack = lowPassCoefs[filterNumber].feedback
const iirFilter = audioContext.createIIRFilter(feedForward, feedBack)
```

### createWaveShaper

创建一个 WaveShaperNode

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createWaveShaper.html)

```tsx
() => WaveShaperNode
```

### createConstantSource

创建一个 ConstantSourceNode

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createConstantSource.html)

```tsx
() => ConstantSourceNode
```

### createOscillator

创建一个 OscillatorNode

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createOscillator.html)

```tsx
() => OscillatorNode
```

### createGain

创建一个 GainNode

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createGain.html)

```tsx
() => GainNode
```

### createPeriodicWave

创建一个 PeriodicWaveNode

**注意**
`real` 和 `imag` 数组必须拥有一样的长度，否则抛出错误

```tsx
const real = new Float32Array(2)
const imag = new Float32Array(2)
real[0] = 0
imag[0] = 0
real[1] = 1
imag[1] = 0

const waveNode = audioContext.createPeriodicWave(real, imag, {disableNormalization: true})
```

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createPeriodicWave.html)

```tsx
(real: Float32Array, imag: Float32Array, constraints: Constraints) => PeriodicWave
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| real | `Float32Array` | 一组余弦项(传统上是A项) |
| imag | `Float32Array` | 一组余弦项(传统上是A项) |
| constraints | `Constraints` | 一个字典对象，它指定是否应该禁用规范化(默认启用规范化) |

### createBiquadFilter

创建一个BiquadFilterNode

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createBiquadFilter.html)

```tsx
() => BiquadFilterNode
```

### createBufferSource

创建一个 BufferSourceNode 实例，通过 AudioBuffer 对象来播放音频数据。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createBufferSource.html)

```tsx
() => AudioBufferSourceNode
```

### createChannelMerger

创建一个ChannelMergerNode

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createChannelMerger.html)

```tsx
(numberOfInputs: number) => ChannelMergerNode
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| numberOfInputs | `number` | 输出流中需要保持的输入流的个数 |

### createChannelSplitter

创建一个ChannelSplitterNode

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createChannelSplitter.html)

```tsx
(numberOfOutputs: number) => ChannelSplitterNode
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| numberOfOutputs | `number` | 要分别输出的输入音频流中的通道数 |

### createDelay

创建一个DelayNode

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createDelay.html)

```tsx
(maxDelayTime: number) => DelayNode
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| maxDelayTime | `number` | 最大延迟时间 |

#### 示例代码

```tsx
let audioCtx = Taro.createWebAudioContext()
const delayNode = audioCtx.createDelay(5)
```

### createDynamicsCompressor

创建一个DynamicsCompressorNode

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createDynamicsCompressor.html)

```tsx
() => DynamicsCompressorNode
```

#### 示例代码

```tsx
let audioCtx = Taro.createWebAudioContext()
let compressor = audioCtx.createDynamicsCompressor()

compressor.threshold.value = -50
compressor.knee.value = 40
compressor.ratio.value = 12
compressor.attack.value = 0
compressor.release.value = 0.25
```

### createScriptProcessor

创建一个ScriptProcessorNode

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createScriptProcessor.html)

```tsx
(bufferSize: number, numberOfInputChannels: number, numberOfOutputChannels: number) => ScriptProcessorNode
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| bufferSize | `number` | 缓冲区大小，以样本帧为单位 |
| numberOfInputChannels | `number` | 用于指定输入 node 的声道的数量 |
| numberOfOutputChannels | `number` | 用于指定输出 node 的声道的数量 |

#### 示例代码

```tsx
let audioCtx = Taro.createWebAudioContext()
const sampleSize = 4096
audioContext.createScriptProcessor(sampleSize, 1, 1)
```

### createPanner

创建一个PannerNode

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createPanner.html)

```tsx
() => PannerNode
```

### createBuffer

创建一个AudioBuffer，代表着一段驻留在内存中的短音频

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.createBuffer.html)

```tsx
(numOfChannels: number, length: number, sampleRate: number) => AudioBuffer
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| numOfChannels | `number` | 定义了 buffer 中包含的声频通道数量的整数 |
| length | `number` | 代表 buffer 中的样本帧数的整数 |
| sampleRate | `number` | 线性音频样本的采样率，即每一秒包含的关键帧的个数 |

#### 示例代码

```tsx
const audioCtx = Taro.createWebAudioContext()
const channels = 2, frameCount = audioCtx.sampleRate * 2.0
const myArrayBuffer = audioCtx.createBuffer(channels, frameCount, audioCtx.sampleRate)
```

### decodeAudioData

异步解码一段资源为AudioBuffer。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContext.decodeAudioData.html)

```tsx
() => AudioBuffer
```

#### 示例代码

```tsx
Taro.request({
  url: url, // 音频 url
  responseType: 'arraybuffer',
  success: res => {
    audioCtx.decodeAudioData(res.data, buffer => {
      console.log(buffer)
    }, err => {
      console.error('decodeAudioData fail', err)
    })
  }
})
```

## 参数

### createPeriodicWave

#### Constraints

字典对象

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| disableNormalization | `boolean` | `false` | 否 | 如果指定为 true 则禁用标准化 |

## 示例代码

监听状态

```tsx
const audioCtx = Taro.createWebAudioContext()
audioCtx.onstatechange = () => {
  console.log(ctx.state)
}
setTimeout(audioCtx.suspend, 1000)
setTimeout(audioCtx.resume, 2000)
```

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| WebAudioContext | ✔️ |  |  |  |  |
| WebAudioContext.close | ✔️ |  |  |  |  |
| WebAudioContext.resume | ✔️ |  |  |  |  |
| WebAudioContext.suspend | ✔️ |  |  |  |  |
| WebAudioContext.createIIRFilter | ✔️ |  |  |  |  |
| WebAudioContext.createWaveShaper | ✔️ |  |  |  |  |
| WebAudioContext.createConstantSource | ✔️ |  |  |  |  |
| WebAudioContext.createOscillator | ✔️ |  |  |  |  |
| WebAudioContext.createGain | ✔️ |  |  |  |  |
| WebAudioContext.createPeriodicWave | ✔️ |  |  |  |  |
| WebAudioContext.createBiquadFilter | ✔️ |  |  |  |  |
| WebAudioContext.createBufferSource | ✔️ |  |  |  |  |
| WebAudioContext.createChannelMerger | ✔️ |  |  |  |  |
| WebAudioContext.createChannelSplitter | ✔️ |  |  |  |  |
| WebAudioContext.createDelay | ✔️ |  |  |  |  |
| WebAudioContext.createDynamicsCompressor | ✔️ |  |  |  |  |
| WebAudioContext.createScriptProcessor | ✔️ |  |  |  |  |
| WebAudioContext.createPanner | ✔️ |  |  |  |  |
| WebAudioContext.createBuffer | ✔️ |  |  |  |  |
| WebAudioContext.decodeAudioData | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/media/audio/WebAudioContextNode.md">
---
title: WebAudioContextNode
sidebar_label: WebAudioContextNode
---

一类音频处理模块，不同的Node具备不同的功能，如GainNode(音量调整)等。一个 WebAudioContextNode 可以通过上下文来创建。

> 目前已经支持以下Node： IIRFilterNode WaveShaperNode ConstantSourceNode ChannelMergerNode OscillatorNode GainNode BiquadFilterNode PeriodicWaveNode BufferSourceNode ChannelSplitterNode ChannelMergerNode DelayNode DynamicsCompressorNode ScriptProcessorNode PannerNode

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/WebAudioContextNode.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| positionX | `number` | 右手笛卡尔坐标系中X轴的位置。 |
| positionY | `number` | 右手笛卡尔坐标系中Y轴的位置。 |
| positionZ | `number` | 右手笛卡尔坐标系中Z轴的位置。 |
| forwardX | `number` | 表示监听器的前向系统在同一笛卡尔坐标系中的水平位置，作为位置（位置x，位置和位置和位置）值。 |
| forwardY | `number` | 表示听众的前向方向在同一笛卡尔坐标系中作为位置（位置x，位置和位置和位置）值的垂直位置。 |
| forwardZ | `number` | 表示与position (positionX、positionY和positionZ)值在同一笛卡尔坐标系下的听者前进方向的纵向(前后)位置。 |
| upX | `number` | 表示在与position (positionX、positionY和positionZ)值相同的笛卡尔坐标系中侦听器向前方向的水平位置。 |
| upY | `number` | 表示在与position (positionX、positionY和positionZ)值相同的笛卡尔坐标系中侦听器向上方向的水平位置。 |
| upZ | `number` | 表示在与position (positionX、positionY和positionZ)值相同的笛卡尔坐标系中侦听器向后方向的水平位置。 |

### setOrientation

设置监听器的方向

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(...args: any[]) => void
```

| 参数 | 类型 |
| --- | --- |
| args | `any[]` |

### setPosition

设置监听器的位置

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

```tsx
(...args: any[]) => void
```

| 参数 | 类型 |
| --- | --- |
| args | `any[]` |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| WebAudioContextNode | ✔️ |  |  |  |  |
| WebAudioContextNode.setOrientation | ✔️ |  |  |  |  |
| WebAudioContextNode.setPosition | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/media/background-audio/BackgroundAudioManager.md">
---
title: BackgroundAudioManager
sidebar_label: BackgroundAudioManager
---

BackgroundAudioManager 实例，可通过 [Taro.getBackgroundAudioManager](/docs/apis/media/background-audio/getBackgroundAudioManager) 获取。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/background-audio/BackgroundAudioManager.html)

## 方法

| 参数 | 类型 | 默认值 | 只读 | 必填 | 说明 |
| --- | --- | :---: | :---: | :---: | --- |
| src | `string` |  | 否 | 是 | 音频的数据源（[2.2.3](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) 开始支持云文件ID）。默认为空字符串，**当设置了新的 src 时，会自动开始播放**，目前支持的格式有 m4a, aac, mp3, wav。 |
| startTime | `number` |  | 否 | 是 | 音频开始播放的位置（单位：s）。 |
| title | `string` |  | 否 | 是 | 音频标题，用于原生音频播放器音频标题（必填）。原生音频播放器中的分享功能，分享出去的卡片标题，也将使用该值。 |
| epname | `string` |  | 否 | 是 | 专辑名，原生音频播放器中的分享功能，分享出去的卡片简介，也将使用该值。 |
| singer | `string` |  | 否 | 是 | 歌手名，原生音频播放器中的分享功能，分享出去的卡片简介，也将使用该值。 |
| coverImgUrl | `string` |  | 否 | 是 | 封面图 URL，用于做原生音频播放器背景图。原生音频播放器中的分享功能，分享出去的卡片配图及背景也将使用该图。 |
| webUrl | `string` |  | 否 | 是 | 页面链接，原生音频播放器中的分享功能，分享出去的卡片简介，也将使用该值。 |
| protocol | `string` |  | 否 | 是 | 音频协议。默认值为 'http'，设置 'hls' 可以支持播放 HLS 协议的直播音频。 |
| playbackRate | `number` | `1` | 否 | 否 | 播放速度。范围 0.5-2.0。 |
| duration | `number` |  | 是 | 是 | 当前音频的长度（单位：s），只有在有合法 src 时返回。 |
| currentTime | `number` |  | 是 | 是 | 当前音频的播放位置（单位：s），只有在有合法 src 时返回。 |
| paused | `boolean` |  | 是 | 是 | 当前是否暂停或停止。 |
| buffered | `number` |  | 是 | 是 | 音频已缓冲的时间，仅保证当前播放时间点到此时间点内容已缓冲。 |
| referrerPolicy | `string` |  | 否 | 否 | origin: 发送完整的 referrer; no-referrer: 不发送 |

### play

播放

```tsx
() => void
```

### pause

暂停

```tsx
() => void
```

### seek

跳转到指定位置，单位 s

```tsx
(position: any) => void
```

### stop

停止

```tsx
() => void
```

### onCanplay

背景音频进入可以播放状态，但不保证后面可以流畅播放

```tsx
(callback?: () => void) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |

### onWaiting

音频加载中事件，当音频因为数据不足，需要停下来加载时会触发

```tsx
(callback?: () => void) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |

### onError

背景音频播放错误事件

```tsx
(callback?: () => void) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |

### onPlay

背景音频播放事件

```tsx
(callback?: () => void) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |

### onPause

背景音频暂停事件

```tsx
(callback?: () => void) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |

### onSeeking

背景音频开始跳转操作事件

```tsx
(callback?: () => void) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |

### onSeeked

背景音频完成跳转操作事件

```tsx
(callback?: () => void) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |

### onEnded

背景音频自然播放结束事件

```tsx
(callback?: () => void) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |

### onStop

背景音频停止事件

```tsx
(callback?: () => void) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |

### onTimeUpdate

背景音频播放进度更新事件

```tsx
(callback?: () => void) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |

### onPrev

用户在系统音乐播放面板点击上一曲事件（iOS only）

```tsx
(callback?: () => void) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |

### onNext

用户在系统音乐播放面板点击下一曲事件（iOS only）

```tsx
(callback?: () => void) => void
```

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |

## 示例代码

```tsx
const backgroundAudioManager = Taro.getBackgroundAudioManager()
backgroundAudioManager.title = '此时此刻'
backgroundAudioManager.epname = '此时此刻'
backgroundAudioManager.singer = '许巍'
backgroundAudioManager.coverImgUrl = 'https://y.gtimg.cn/music/photo_new/T002R300x300M000003rsKF44GyaSk.jpg?max_age=2592000'
// 设置了 src 之后会自动播放
backgroundAudioManager.src = 'https://ws.stream.qqmusic.qq.com/M500001VfvsJ21xFqb.mp3?guid=ffffffff82def4af4b12b3cd9337d5e7&uin=346897220&vkey=6292F51E1E384E061FF02C31F716658E5C81F5594D561F2E88B854E81CAAB7806D5E4F103E55D33C16F3FAC506D1AB172DE8600B37E43FAD&fromtag=46'
```
</file>

<file path="docs/apis/media/background-audio/getBackgroundAudioManager.md">
---
title: Taro.getBackgroundAudioManager()
sidebar_label: getBackgroundAudioManager
---

获取**全局唯一**的背景音频管理器。
小程序切入后台，如果音频处于播放状态，可以继续播放。但是后台状态不能通过调用API操纵音频的播放状态。

从微信客户端6.7.2版本开始，若需要在小程序切后台后继续播放音频，需要在 [app.json](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html) 中配置 `requiredBackgroundModes` 属性。开发版和体验版上可以直接生效，正式版还需通过审核。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/background-audio/wx.getBackgroundAudioManager.html)

## 类型

```tsx
() => BackgroundAudioManager
```

## 示例代码

```tsx
const backgroundAudioManager = Taro.getBackgroundAudioManager()
backgroundAudioManager.title = '此时此刻'
backgroundAudioManager.epname = '此时此刻'
backgroundAudioManager.singer = '许巍'
backgroundAudioManager.coverImgUrl = 'https://y.gtimg.cn/music/photo_new/T002R300x300M000003rsKF44GyaSk.jpg?max_age=2592000'
backgroundAudioManager.src = 'https://ws.stream.qqmusic.qq.com/M500001VfvsJ21xFqb.mp3?guid=ffffffff82def4af4b12b3cd9337d5e7&uin=346897220&vkey=6292F51E1E384E061FF02C31F716658E5C81F5594D561F2E88B854E81CAAB7806D5E4F103E55D33C16F3FAC506D1AB172DE8600B37E43FAD&fromtag=46' // 设置了 src 之后会自动播放
```
</file>

<file path="docs/apis/media/background-audio/getBackgroundAudioPlayerState.md">
---
title: Taro.getBackgroundAudioPlayerState(option)
sidebar_label: getBackgroundAudioPlayerState
---

获取后台音乐播放状态。
**注意：1.2.0 版本开始，本接口不再维护。建议使用能力更强的 [Taro.getBackgroundAudioManager](/docs/apis/media/background-audio/getBackgroundAudioManager) 接口**

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/background-audio/wx.getBackgroundAudioPlayerState.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| currentPosition | `number` | 选定音频的播放位置（单位：s），只有在音乐播放中时返回 |
| dataUrl | `string` | 歌曲数据链接，只有在音乐播放中时返回 |
| downloadPercent | `number` | 音频的下载进度百分比，只有在音乐播放中时返回 |
| duration | `number` | 选定音频的长度（单位：s），只有在音乐播放中时返回 |
| status | `keyof Status` | 播放状态 |
| errMsg | `string` | 调用结果 |

### Status

| 参数 | 说明 |
| --- | --- |
| 0 | 暂停中 |
| 1 | 播放中 |
| 2 | 没有音乐播放 |

## 示例代码

```tsx
Taro.getBackgroundAudioPlayerState({
  success: function (res) {
    var status = res.status
    var dataUrl = res.dataUrl
    var currentPosition = res.currentPosition
    var duration = res.duration
    var downloadPercent = res.downloadPercent
  }
})
```
</file>

<file path="docs/apis/media/background-audio/onBackgroundAudioPause.md">
---
title: Taro.onBackgroundAudioPause(callback)
sidebar_label: onBackgroundAudioPause
---

监听音乐暂停。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/background-audio/wx.onBackgroundAudioPause.html)

## 类型

```tsx
(callback: (res: TaroGeneral.CallbackResult) => void) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.CallbackResult) => void` | 音乐暂停事件的回调函数 |
</file>

<file path="docs/apis/media/background-audio/onBackgroundAudioPlay.md">
---
title: Taro.onBackgroundAudioPlay(callback)
sidebar_label: onBackgroundAudioPlay
---

监听音乐播放。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/background-audio/wx.onBackgroundAudioPlay.html)

## 类型

```tsx
(callback: (res: TaroGeneral.CallbackResult) => void) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.CallbackResult) => void` | 音乐播放事件的回调函数 |
</file>

<file path="docs/apis/media/background-audio/onBackgroundAudioStop.md">
---
title: Taro.onBackgroundAudioStop(callback)
sidebar_label: onBackgroundAudioStop
---

监听音乐停止。

**bug & tip：**

1.  `bug`: `iOS` `6.3.30` Taro.seekBackgroundAudio 会有短暂延迟

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/background-audio/wx.onBackgroundAudioStop.html)

## 类型

```tsx
(callback: (res: TaroGeneral.CallbackResult) => void) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.CallbackResult) => void` | 音乐停止事件的回调函数 |
</file>

<file path="docs/apis/media/background-audio/pauseBackgroundAudio.md">
---
title: Taro.pauseBackgroundAudio(option)
sidebar_label: pauseBackgroundAudio
---

暂停播放音乐。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/background-audio/wx.pauseBackgroundAudio.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.pauseBackgroundAudio()
```
</file>

<file path="docs/apis/media/background-audio/playBackgroundAudio.md">
---
title: Taro.playBackgroundAudio(option)
sidebar_label: playBackgroundAudio
---

使用后台播放器播放音乐，对于微信客户端来说，只能同时有一个后台音乐在播放。当用户离开小程序后，音乐将暂停播放；当用户点击“显示在聊天顶部”时，音乐不会暂停播放；当用户在其他小程序占用了音乐播放器，原有小程序内的音乐将停止播放。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/background-audio/wx.playBackgroundAudio.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| dataUrl | `string` | 是 | 音乐链接，目前支持的格式有 m4a, aac, mp3, wav |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| coverImgUrl | `string` | 否 | 封面URL |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| title | `string` | 否 | 音乐标题 |

## 示例代码

```tsx
Taro.playBackgroundAudio({
  dataUrl: '',
  title: '',
  coverImgUrl: ''
})
```
</file>

<file path="docs/apis/media/background-audio/seekBackgroundAudio.md">
---
title: Taro.seekBackgroundAudio(option)
sidebar_label: seekBackgroundAudio
---

控制音乐播放进度。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/background-audio/wx.seekBackgroundAudio.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| position | `number` | 是 | 音乐位置，单位：秒 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.seekBackgroundAudio({
  position: 30
})
```
</file>

<file path="docs/apis/media/background-audio/stopBackgroundAudio.md">
---
title: Taro.stopBackgroundAudio(option)
sidebar_label: stopBackgroundAudio
---

停止播放音乐。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/background-audio/wx.stopBackgroundAudio.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.stopBackgroundAudio()
```
</file>

<file path="docs/apis/media/camera/CameraContext.md">
---
title: CameraContext
sidebar_label: CameraContext
---

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/camera/CameraContext.html)

## 方法

### onCameraFrame

获取 Camera 实时帧数据

****

注： 使用该接口需同时在 [camera](/docs/components/media/camera) 组件属性中指定 frame-size。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/camera/CameraContext.onCameraFrame.html)

```tsx
(callback: OnCameraFrameCallback) => CameraFrameListener
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnCameraFrameCallback` | 回调函数 |

#### 示例代码

```tsx
const context = wx.createCameraContext()
const listener = context.onCameraFrame((frame) => {
  console.log(frame.data instanceof ArrayBuffer, frame.width, frame.height)
})
listener.start()
```

### setZoom

设置缩放级别

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/camera/CameraContext.setZoom.html)

```tsx
(option: SetZoomOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `SetZoomOption` |

### startRecord

开始录像

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/camera/CameraContext.startRecord.html)

```tsx
(option: StartRecordOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `StartRecordOption` |

### stopRecord

结束录像

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/camera/CameraContext.stopRecord.html)

```tsx
(option?: StopRecordOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `StopRecordOption` |

### takePhoto

拍摄照片

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/camera/CameraContext.takePhoto.html)

```tsx
(option: TakePhotoOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `TakePhotoOption` |

## 参数

### SetZoomOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: StartRecordSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| zoom | `number` | 是 | 缩放级别，范围[1, maxZoom]。zoom 可取小数，精确到小数后一位。maxZoom 可在 bindinitdone 返回值中获取。 |

### StartRecordSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| zoom | `number` | 实际设置的缩放级别。由于系统限制，某些机型可能无法设置成指定值，会改用最接近的可设值。 |
| setZoom | `number` | <br />API 支持度: alipay<br />alipay: on android |

### StartRecordOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| timeoutCallback | `StartRecordTimeoutCallback` | 否 | 超过30s或页面 `onHide` 时会结束录像 |

### StartRecordTimeoutCallback

超过30s或页面 `onHide` 时会结束录像

```tsx
(result: StartRecordTimeoutCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `StartRecordTimeoutCallbackResult` |

### StartRecordTimeoutCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempThumbPath | `string` | 封面图片文件的临时路径 |
| tempVideoPath | `string` | 视频的文件的临时路径 |
| height | `string` | 视频文件的高度。<br />API 支持度: alipay |
| width | `string` | 视频文件的宽度。<br />API 支持度: alipay |
| size | `string` | 视频文件的尺寸。<br />API 支持度: alipay |
| duration | `string` | 录制的持续时间。<br />API 支持度: alipay |

### StopRecordOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: StopRecordSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### StopRecordSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempThumbPath | `string` | 封面图片文件的临时路径 |
| tempVideoPath | `string` | 视频的文件的临时路径 |
| errMsg | `string` | 调用结果 |

### TakePhotoOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| quality | `keyof Quality` | 否 | 成像质量 |
| success | `(result: TakePhotoSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### TakePhotoSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempImagePath | `string` | 照片文件的临时路径，安卓是jpg图片格式，ios是png |
| errMsg | `string` | 调用结果 |

### OnCameraFrameCallback

回调函数

```tsx
(result: OnCameraFrameCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnCameraFrameCallbackResult` |

### OnCameraFrameCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | `ArrayBuffer` | 图像像素点数据，一维数组，每四项表示一个像素点的 rgba |
| height | `number` | 图像数据矩形的高度 |
| width | `number` | 图像数据矩形的宽度 |

### Quality

| 参数 | 说明 |
| --- | --- |
| high | 高质量 |
| normal | 普通质量 |
| low | 低质量 |
| original | 原图 |

## API 支持度

| API | 微信小程序 | 支付宝小程序 | 抖音小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| CameraContext.onCameraFrame | ✔️ | ✔️ | ✔️ |  |  |  |  |
| CameraContext.setZoom | ✔️ | ✔️ | ✔️ |  |  |  |  |
| CameraContext.startRecord | ✔️ | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| CameraContext.stopRecord | ✔️ | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| CameraContext.takePhoto | ✔️ | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
</file>

<file path="docs/apis/media/camera/CameraFrameListener.md">
---
title: CameraFrameListener
sidebar_label: CameraFrameListener
---

CameraContext.onCameraFrame() 返回的监听器。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/camera/CameraFrameListener.html)

## 方法

### start

开始监听帧数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform " width="25px icon_platform--not-support"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/camera/CameraFrameListener.start.html)

```tsx
(option?: StartOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `StartOption` |

### stop

停止监听帧数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/camera/CameraFrameListener.stop.html)

```tsx
(option?: StopOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `StopOption` |

## 参数

### StartOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### StopOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| CameraFrameListener.start | ✔️ | ✔️ |  |  |  |  |
| CameraFrameListener.stop | ✔️ | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/media/camera/createCameraContext.md">
---
title: Taro.createCameraContext(id)
sidebar_label: createCameraContext
---

创建 camera 上下文 CameraContext 对象。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> 支付宝小程序: 支付宝小程序需指定 camera 组件中的 id 属性

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/camera/wx.createCameraContext.html)

## 类型

```tsx
(id?: string) => CameraContext
```

## 参数

| 参数 | 类型 |
| --- | --- |
| id | `string` |

## 示例代码

```tsx
const cameraContext = Taro.createCameraContext()
```
</file>

<file path="docs/apis/media/editor/EditorContext.md">
---
title: EditorContext
sidebar_label: EditorContext
---

`EditorContext` 实例，可通过 `Taro.createSelectorQuery` 获取。
`EditorContext` 通过 `id` 跟一个 `editor` 组件绑定，操作对应的 `editor` 组件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/editor/EditorContext.html)

## 方法

### blur

编辑器失焦，同时收起键盘。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/editor/EditorContext.blur.html)

```tsx
(option?: BlurOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `BlurOption` |

### clear

清空编辑器内容

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/editor/EditorContext.clear.html)

```tsx
(option?: ClearOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `ClearOption` |

### format

修改样式

****

## 支持设置的样式列表
| name | value |
| ------| ------ |
| bold  |        |
| italic  |        |
| underline  |        |
| strike  |        |
| ins  |        |
| script  | sub / super |
| header  | H1 / H2 / h3 / H4 / h5 /  H6 |
| align  | left / center / right / justify |
| direction  | rtl  |
| indent | -1 / +1 |
| list | ordered / bullet / check |
| color | hex color |
| backgroundColor| hex color |
| margin/marginTop/marginBottom/marginLeft/marginRight  |  css style  |
| padding/paddingTop/paddingBottom/paddingLeft/paddingRight  | css style |
| font/fontSize/fontStyle/fontVariant/fontWeight/fontFamily  |  css style |
| lineHeight | css style |
| letterSpacing |  css style |
| textDecoration |  css style |
| textIndent    | css style |

对已经应用样式的选区设置会取消样式。css style 表示 css 中规定的允许值。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/editor/EditorContext.format.html)

```tsx
(name: string, value?: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| name | `string` | 属性 |
| value | `string` | 值 |

### getContents

获取编辑器内容

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/editor/EditorContext.getContents.html)

```tsx
(option?: GetContentsOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `GetContentsOption` |

### getSelectionText

获取编辑器已选区域内的纯文本内容。当编辑器失焦或未选中一段区间时，返回内容为空。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/editor/EditorContext.getSelectionText.html)

```tsx
(option?: Option) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### insertDivider

插入分割线

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/editor/EditorContext.insertDivider.html)

```tsx
(option?: InsertDividerOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `InsertDividerOption` |

### insertImage

插入图片。

地址为临时文件时，获取的编辑器html格式内容中 `<img>` 标签增加属性 data-local，delta 格式内容中图片 attributes 属性增加 data-local 字段，该值为传入的临时文件地址。

开发者可选择在提交阶段上传图片到服务器，获取到网络地址后进行替换。替换时对于html内容应替换掉 `<img>` 的 src 值，对于 delta 内容应替换掉 `insert { image: abc }` 值。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/editor/EditorContext.insertImage.html)

```tsx
(option: InsertImageOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `InsertImageOption` |

#### 示例代码

```tsx
this.editorCtx.insertImage({
  src: 'xx',
  width: '100px',
  height: '50px',
  extClass: className
})
```

### insertText

覆盖当前选区，设置一段文本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/editor/EditorContext.insertText.html)

```tsx
(option: InsertTextOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `InsertTextOption` |

### redo

恢复

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/editor/EditorContext.redo.html)

```tsx
(option?: RedoOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `RedoOption` |

### removeFormat

清除当前选区的样式

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/editor/EditorContext.removeFormat.html)

```tsx
(option?: RemoveFormatOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `RemoveFormatOption` |

### scrollIntoView

使得编辑器光标处滚动到窗口可视区域内。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/editor/EditorContext.scrollIntoView.html)

```tsx
() => void
```

### setContents

初始化编辑器内容，html和delta同时存在时仅delta生效

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/editor/EditorContext.setContents.html)

```tsx
(option: SetContentsOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `SetContentsOption` |

### undo

撤销

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/editor/EditorContext.undo.html)

```tsx
(option?: UndoOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `UndoOption` |

## 参数

### BlurOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### ClearOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### GetContentsOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### getSelectionText

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| text | `string` | 纯文本内容 |

### InsertDividerOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### InsertImageOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| src | `string` | 是 | 图片地址，仅支持 http(s)、base64、云图片(2.8.0)、临时文件(2.8.3)。 |
| nowrap | `boolean` | 否 | 插入图片后是否自动换行，默认换行 |
| alt | `string` | 否 | 图像无法显示时的替代文本 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| data | `TaroGeneral.IAnyObject` | 否 | data 被序列化为 name=value;name1=value2 的格式挂在属性 data-custom 上 |
| extClass | `string` | 否 | 添加到图片 img 标签上的类名 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| height | `string` | 否 | 图片高度 (pixels/百分比) |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| width | `string` | 否 | 图片宽度（pixels/百分比) |

### InsertTextOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| text | `string` | 否 | 文本内容 |

### RedoOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### RemoveFormatOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SetContentsOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| delta | `TaroGeneral.IAnyObject` | 否 | 表示内容的delta对象 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| html | `string` | 否 | 带标签的HTML内容 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### UndoOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| EditorContext | ✔️ |  |  |  |  |
| EditorContext.blur | ✔️ |  |  |  |  |
| EditorContext.clear | ✔️ |  |  |  |  |
| EditorContext.format | ✔️ |  |  |  |  |
| EditorContext.getContents | ✔️ |  |  |  |  |
| EditorContext.getSelectionText | ✔️ |  |  |  |  |
| EditorContext.insertDivider | ✔️ |  |  |  |  |
| EditorContext.insertImage | ✔️ |  |  |  |  |
| EditorContext.insertText | ✔️ |  |  |  |  |
| EditorContext.redo | ✔️ |  |  |  |  |
| EditorContext.removeFormat | ✔️ |  |  |  |  |
| EditorContext.scrollIntoView | ✔️ |  |  |  |  |
| EditorContext.setContents | ✔️ |  |  |  |  |
| EditorContext.undo | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/media/image/chooseImage.md">
---
title: Taro.chooseImage(option)
sidebar_label: chooseImage
---

从本地相册选择图片或使用相机拍照。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseImage.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| count | `number` | `9` | 否 | 最多可以选择的图片张数<br />API 支持度: weapp, alipay, swan, tt, h5, rn |
| sizeType | `(keyof sizeType)[]` | `['original', 'compressed']` | 否 | 所选的图片的尺寸<br />API 支持度: weapp, alipay, swan, tt, rn |
| sourceType | `(keyof sourceType)[]` | `['album', 'camera']` | 否 | 选择图片的来源<br />API 支持度: weapp, alipay, swan, tt, h5, rn |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |
| imageId | `string` |  | 否 | 用来上传的input元素ID（仅h5端<br />API 支持度: h5 |

### sizeType

图片的尺寸

| 参数 | 说明 |
| --- | --- |
| original | 原图 |
| compressed | compressed |

### sourceType

图片的来源

| 参数 | 说明 |
| --- | --- |
| album | 从相册选图 |
| camera | 使用相机 |
| user | 使用前置摄像头(仅H5纯浏览器使用) |
| environment | 使用后置摄像头(仅H5纯浏览器) |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempFilePaths | `string[]` | 图片的本地临时文件路径列表 |
| tempFiles | `ImageFile[]` | 图片的本地临时文件列表 |
| errMsg | `string` | 调用结果 |

### ImageFile

图片的本地临时文件列表

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| path | `string` | 是 | 本地临时文件路径 |
| size | `number` | 是 | 本地临时文件大小，单位 B |
| type | `string` | 否 | 文件的 MIME 类型<br />API 支持度: h5 |
| originalFileObj | `File` | 否 | 原始的浏览器 File 对象<br />API 支持度: h5 |

## 示例代码

```tsx
Taro.chooseImage({
  count: 1, // 默认9
  sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
  sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有，在H5浏览器端支持使用 `user` 和 `environment`分别指定为前后摄像头
  success: function (res) {
    // 返回选定照片的本地文件路径列表，tempFilePath可以作为img标签的src属性显示图片
    var tempFilePaths = res.tempFilePaths
  }
})
```
</file>

<file path="docs/apis/media/image/chooseMessageFile.md">
---
title: Taro.chooseMessageFile(option)
sidebar_label: chooseMessageFile
---

从客户端会话选择文件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseMessageFile.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| count | `number` | 是 | 最多可以选择的文件个数，可以 0～100 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| extension | `string[]` | 否 | 根据文件拓展名过滤，仅 type==file 时有效。每一项都不能是空字符串。默认不过滤。 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| type | `keyof SelectType` | 否 | 所选的文件的类型 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempFiles | `ChooseFile[]` | 返回选择的文件的本地临时文件对象数组 |
| errMsg | `string` | 调用结果 |

### ChooseFile

返回选择的文件的本地临时文件对象数组

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| name | `string` | 选择的文件名称 |
| path | `string` | 本地临时文件路径 |
| size | `number` | 本地临时文件大小，单位 B |
| time | `number` | 选择的文件的会话发送时间，Unix时间戳，工具暂不支持此属性 |
| type | `keyof SelectedType` | 选择的文件类型 |

### SelectType

| 参数 | 说明 |
| --- | --- |
| all | 从所有文件选择 |
| video | 只能选择视频文件 |
| image | 只能选择图片文件 |
| file | 可以选择除了图片和视频之外的其它的文件 |

### SelectedType

| 参数 | 说明 |
| --- | --- |
| video | 选择了视频文件 |
| image | 选择了图片文件 |
| file | 选择了除图片和视频的文件 |

## 示例代码

```tsx
Taro.chooseMessageFile({
  count: 10,
  type: 'image',
  success: function (res) {
    // tempFilePath可以作为img标签的src属性显示图片
    const tempFilePaths = res.tempFiles
  }
})
```
</file>

<file path="docs/apis/media/image/compressImage.md">
---
title: Taro.compressImage(option)
sidebar_label: compressImage
---

压缩图片接口，可选压缩质量

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.compressImage.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| src | `string` | 是 | 图片路径，图片的路径，可以是相对路径、临时文件路径、存储文件路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| quality | `number` | 否 | 压缩质量，范围0～100，数值越小，质量越低，压缩率越高（仅对jpg有效）。 |
| compressedWidth | `number` | 否 | 压缩后图片的宽度，单位为px，若不填写则默认以 compressedHeight 为准等比缩放。 |
| compressedHeight | `number` | 否 | 压缩后图片的高度，单位为px，若不填写则默认以 compressedWidth 为准等比缩放。 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempFilePath | `string` | 压缩后图片的临时文件路径 |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
Taro.compressImage({
  src: '', // 图片路径
  quality: 80 // 压缩质量
})
```
</file>

<file path="docs/apis/media/image/cropImage.md">
---
title: Taro.cropImage(option)
sidebar_label: cropImage
---

裁剪图片接口

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.cropImage.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| src | `string` | 是 | 图片路径，图片的路径，支持本地路径、代码包路径 |
| cropScale | `keyof CropScale` | 是 | 裁剪比例 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempFilePath | `string` | 剪裁后图片的临时文件路径 (本地路径) |

### CropScale

| 参数 | 说明 |
| --- | --- |
| 1:1 | 宽高比为1比1 |
| 3:4 | 宽高比为3比4 |
| 4:3 | 宽高比为4比3 |
| 4:5 | 宽高比为4比5 |
| 5:4 | 宽高比为5比4 |
| 9:16 | 宽高比为9比16 |
| 16:9 | 宽高比为16比9 |

## 示例代码

```tsx
Taro.cropImage({
  src: '', // 图片路径
  cropScale: '1:1', // 裁剪比例
  success: function (res) {
    // 返回选定照片的本地文件路径列表，tempFilePath可以作为img标签的src属性显示图片
    var tempFilePaths = res.tempFilePaths
  }
})
```
</file>

<file path="docs/apis/media/image/editImage.md">
---
title: Taro.editImage(option)
sidebar_label: editImage
---

编辑图片接口

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.editImage.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| src | `string` | 是 | 图片路径，图片的路径，支持本地路径、代码包路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempFilePath | `string` | 编辑后图片的临时文件路径 (本地路径) |

## 示例代码

```tsx
Taro.editImage({
  src: '', // 图片路径
})
```
</file>

<file path="docs/apis/media/image/getImageInfo.md">
---
title: Taro.getImageInfo(option)
sidebar_label: getImageInfo
---

获取图片信息。网络图片需先配置download域名才能生效。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.getImageInfo.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| src | `string` | 是 | 图片的路径，可以是相对路径、临时文件路径、存储文件路径、网络图片路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 默认值 | 说明 |
| --- | --- | :---: | --- |
| height | `number` |  | 图片原始高度，单位px。不考虑旋转。 |
| orientation | `keyof Orientation` | `"up"` | [拍照时设备方向](http://sylvana.net/jpegcrop/exif_orientation.html) |
| path | `string` |  | 图片的本地路径 |
| type | `string` |  | 图片格式 |
| width | `number` |  | 图片原始宽度，单位px。不考虑旋转。 |
| errMsg | `string` |  | 调用结果 |

### Orientation

| 参数 | 说明 |
| --- | --- |
| up | 默认方向（手机横持拍照），对应 Exif 中的 1。或无 orientation 信息。 |
| up-mirrored | 同 up，但镜像翻转，对应 Exif 中的 2 |
| down | 旋转180度，对应 Exif 中的 3 |
| down-mirrored | 同 down，但镜像翻转，对应 Exif 中的 4 |
| left-mirrored | 同 left，但镜像翻转，对应 Exif 中的 5 |
| right | 顺时针旋转90度，对应 Exif 中的 6 |
| right-mirrored | 同 right，但镜像翻转，对应 Exif 中的 7 |
| left | 逆时针旋转90度，对应 Exif 中的 8 |

## 示例代码

```tsx
Taro.getImageInfo({
  src: 'images/a.jpg',
  success: function (res) {
    console.log(res.width)
    console.log(res.height)
  }
})
Taro.chooseImage({
  success: function (res) {
    Taro.getImageInfo({
      src: res.tempFilePaths[0],
      success: function (res) {
        console.log(res.width)
        console.log(res.height)
      }
    })
  }
})
```
</file>

<file path="docs/apis/media/image/previewImage.md">
---
title: Taro.previewImage(option)
sidebar_label: previewImage
---

在新页面中全屏预览图片。预览的过程中用户可以进行保存图片、发送给朋友等操作。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.previewImage.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| urls | `string[]` | 是 | 需要预览的图片链接列表。 |
| current | string or number | 否 | 当前显示图片的http链接 |
| enablesavephoto | `boolean` | 否 | 是否支持长按下载图片<br />API 支持度: alipay 基础库: 1.13.0 |
| enableShowPhotoDownload | `boolean` | 否 | 是否在右下角显示下载入口<br />API 支持度: alipay 基础库: 1.13.0 |
| showmenu | `boolean` | 否 | <br />API 支持度: weapp 最低版本：2.13.0。是否显示长按菜单，默认值：true |
| referrerPolicy | `string` | 否 | <br />API 支持度: weapp 最低版本：2.13.0。origin: 发送完整的referrer; no-referrer: 不发送。格式固定为 https://servicewechat.com/{appid}/{version}/page-frame.html，其中 {appid} 为小程序的 appid，{version} 为小程序的版本号，版本号为 0 表示为开发版、体验版以及审核版本，版本号为 devtools 表示为开发者工具，其余为正式版本；默认值：no-referrer |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.previewImage({
  current: '', // 当前显示图片的http链接
  urls: [] // 需要预览的图片http链接列表
})
```
</file>

<file path="docs/apis/media/image/previewMedia.md">
---
title: Taro.previewMedia(option)
sidebar_label: previewMedia
---

预览图片和视频。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.previewMedia.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Sources

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| url | `string` | 是 | 图片或视频的地址 |
| type | "image" or "video" | 否 | 资源的类型（图片或视频），默认值：image |
| poster | `string` | 否 | 视频的封面图片 |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| sources | `Sources[]` | 是 | 需要预览的资源列表 |
| current | `number` | 否 | 当前显示的资源序号，默认值：0 |
| showmenu | `boolean` | 否 | 是否显示长按菜单	2.13.0，默认值：true |
| referrerPolicy | `string` | 否 | origin: 发送完整的referrer; no-referrer: 不发送。格式固定为 https://servicewechat.com/{appid}/{version}/page-frame.html，其中 {appid} 为小程序的 appid，{version} 为小程序的版本号，版本号为 0 表示为开发版、体验版以及审核版本，版本号为 devtools 表示为开发者工具，其余为正式版本；默认值：no-referrer |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.previewMedia({
  sources: []
})
```
</file>

<file path="docs/apis/media/image/saveImageToPhotosAlbum.md">
---
title: Taro.saveImageToPhotosAlbum(option)
sidebar_label: saveImageToPhotosAlbum
---

保存图片到系统相册。需要[用户授权](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html) scope.writePhotosAlbum

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.saveImageToPhotosAlbum.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 图片文件路径，可以是临时文件路径或永久文件路径，不支持网络图片路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.saveImageToPhotosAlbum({
  success: function (res) { }
})
```
</file>

<file path="docs/apis/media/live/createLivePlayerContext.md">
---
title: Taro.createLivePlayerContext(id, component)
sidebar_label: createLivePlayerContext
---

创建 [live-player](/docs/components/media/live-player) 上下文 [LivePlayerContext](/docs/apis/media/live/LivePlayerContext) 对象。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/wx.createLivePlayerContext.html)

## 类型

```tsx
(id: string, component?: TaroGeneral.IAnyObject) => LivePlayerContext
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `string` | [live-player](/docs/components/media/live-player) 组件的 id |
| component | `TaroGeneral.IAnyObject` | 在自定义组件下，当前组件实例的this，以操作组件内 [live-player](/docs/components/media/live-player) 组件 |
</file>

<file path="docs/apis/media/live/createLivePusherContext.md">
---
title: Taro.createLivePusherContext()
sidebar_label: createLivePusherContext
---

创建 [live-pusher](/docs/components/media/live-pusher) 上下文 [LivePusherContext](/docs/apis/media/live/LivePusherContext) 对象。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/wx.createLivePusherContext.html)

## 类型

```tsx
() => LivePusherContext
```
</file>

<file path="docs/apis/media/live/LivePlayerContext.md">
---
title: LivePlayerContext
sidebar_label: LivePlayerContext
---

`LivePlayerContext` 实例，可通过 `Taro.createLivePlayerContext` 获取。
`LivePlayerContext` 通过 `id` 跟一个 `live-player` 组件绑定，操作对应的 `live-player` 组件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.html)

## 方法

### exitCasting

退出投屏。仅支持在 tap 事件回调内调用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.exitCasting.html)

```tsx
(option?: ExitCastingOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `ExitCastingOption` |

### exitFullScreen

退出全屏

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.exitFullScreen.html)

```tsx
(option?: ExitFullScreenOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `ExitFullScreenOption` |

### exitPictureInPicture

退出小窗，该方法可在任意页面调用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.exitPictureInPicture.html)

```tsx
(option?: ExitPictureInPictureOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `ExitPictureInPictureOption` |

### mute

静音

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.mute.html)

```tsx
(option?: MuteOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `MuteOption` |

### pause

暂停

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.pause.html)

```tsx
(option?: PauseOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `PauseOption` |

### play

播放

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.play.html)

```tsx
(option?: PlayOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `PlayOption` |

### reconnectCasting

重连投屏设备。仅支持在 tap 事件回调内调用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.reconnectCasting.html)

```tsx
(option?: ReconnectCastingOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `ReconnectCastingOption` |

### requestFullScreen

进入全屏

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.requestFullScreen.html)

```tsx
(option: RequestFullScreenOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `RequestFullScreenOption` |

### requestPictureInPicture

进入全屏

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.requestPictureInPicture.html)

```tsx
(option: RequestPictureInPictureOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `RequestPictureInPictureOption` |

### resume

恢复

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.resume.html)

```tsx
(option?: ResumeOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `ResumeOption` |

### snapshot

截图

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.snapshot.html)

```tsx
(option?: SnapshotOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `SnapshotOption` |

### startCasting

开始投屏, 拉起半屏搜索设备。仅支持在 tap 事件回调内调用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.startCasting.html)

```tsx
(option?: StartCastingOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `StartCastingOption` |

### stop

停止

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.stop.html)

```tsx
(option?: StopOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `StopOption` |

### switchCasting

切换投屏设备。仅支持在 tap 事件回调内调用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePlayerContext.switchCasting.html)

```tsx
(option?: SwitchCastingOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `SwitchCastingOption` |

## 参数

### ExitCastingOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### ExitFullScreenOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### ExitPictureInPictureOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### MuteOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### PauseOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### PlayOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### ReconnectCastingOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### RequestFullScreenOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| direction | 0 or 90 or -90 | 否 | 设置全屏时的方向<br /><br />可选值：<br />- 0: 正常竖向;<br />- 90: 屏幕逆时针90度;<br />- -90: 屏幕顺时针90度; |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### RequestPictureInPictureOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### ResumeOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SnapshotOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SnapshotSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SnapshotSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| height | `string` | 图片的高度 |
| tempImagePath | `string` | 图片文件的临时路径 |
| width | `string` | 图片的宽度 |
| errMsg | `string` | 调用结果 |

### StartCastingOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### StopOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SwitchCastingOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| LivePlayerContext | ✔️ |  |  |  |  |
| LivePlayerContext.exitCasting | ✔️ |  |  |  |  |
| LivePlayerContext.exitFullScreen | ✔️ |  |  |  |  |
| LivePlayerContext.exitPictureInPicture | ✔️ |  |  |  |  |
| LivePlayerContext.mute | ✔️ |  |  |  |  |
| LivePlayerContext.pause | ✔️ |  |  |  |  |
| LivePlayerContext.play | ✔️ |  |  |  |  |
| LivePlayerContext.reconnectCasting | ✔️ |  |  |  |  |
| LivePlayerContext.requestFullScreen | ✔️ |  |  |  |  |
| LivePlayerContext.requestPictureInPicture | ✔️ |  |  |  |  |
| LivePlayerContext.resume | ✔️ |  |  |  |  |
| LivePlayerContext.snapshot | ✔️ |  |  |  |  |
| LivePlayerContext.startCasting | ✔️ |  |  |  |  |
| LivePlayerContext.stop | ✔️ |  |  |  |  |
| LivePlayerContext.switchCasting | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/media/live/LivePusherContext.md">
---
title: LivePusherContext
sidebar_label: LivePusherContext
---

`LivePusherContext` 实例，可通过 `Taro.createLivePusherContext` 获取。
`LivePusherContext` 与页面内唯一的 `live-pusher` 组件绑定，操作对应的 `live-pusher` 组件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.html)

## 方法

### pause

暂停推流

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.pause.html)

```tsx
(option?: PauseOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `PauseOption` |

### pauseBGM

暂停背景音

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.pauseBGM.html)

```tsx
(option?: PauseBGMOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `PauseBGMOption` |

### playBGM

播放背景音

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.playBGM.html)

```tsx
(option: PlayBGMOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `PlayBGMOption` |

### resume

恢复推流

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.resume.html)

```tsx
(option?: ResumeOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `ResumeOption` |

### resumeBGM

恢复背景音

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.resumeBGM.html)

```tsx
(option?: ResumeBGMOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `ResumeBGMOption` |

### sendMessage

发送SEI消息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.sendMessage.html)

```tsx
(option?: SendMessageOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `SendMessageOption` |

### setBGMVolume

设置背景音音量

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.setBGMVolume.html)

```tsx
(option: SetBGMVolumeOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `SetBGMVolumeOption` |

### setMICVolume

设置麦克风音量

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.setMICVolume.html)

```tsx
(option: SetMICVolumeOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `SetMICVolumeOption` |

### snapshot

快照

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.snapshot.html)

```tsx
(option?: SnapshotOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `SnapshotOption` |

### start

开始推流，同时开启摄像头预览

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.start.html)

```tsx
(option?: StartOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `StartOption` |

### startPreview

开启摄像头预览

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.startPreview.html)

```tsx
(option?: StartPreviewOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `StartPreviewOption` |

### stop

停止推流，同时停止摄像头预览

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.stop.html)

```tsx
(option?: StopOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `StopOption` |

### stopBGM

停止背景音

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.stopBGM.html)

```tsx
(option?: StopBGMOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `StopBGMOption` |

### stopPreview

关闭摄像头预览

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.stopPreview.html)

```tsx
(option?: StopPreviewOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `StopPreviewOption` |

### switchCamera

切换前后摄像头

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.switchCamera.html)

```tsx
(option?: SwitchCameraOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `SwitchCameraOption` |

### toggleTorch

切换手电筒

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/live/LivePusherContext.toggleTorch.html)

```tsx
(option?: ToggleTorchOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `ToggleTorchOption` |

## 参数

### PauseOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### PauseBGMOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### PlayBGMOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| url | `string` | 是 | 加入背景混音的资源地址 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### ResumeOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### ResumeBGMOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SendMessageOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| msg | `string` | 是 | SEI消息 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SetBGMVolumeOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| volume | `number` | 是 | 音量大小，范围是 0-1 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SetMICVolumeOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| volume | `number` | 是 | 音量大小，范围是 0-1 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SnapshotOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### StartOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### StartPreviewOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### StopOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### StopBGMOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### StopPreviewOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SwitchCameraOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### ToggleTorchOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| LivePusherContext | ✔️ |  |  |  |  |
| LivePusherContext.pause | ✔️ |  |  |  |  |
| LivePusherContext.pauseBGM | ✔️ |  |  |  |  |
| LivePusherContext.playBGM | ✔️ |  |  |  |  |
| LivePusherContext.resume | ✔️ |  |  |  |  |
| LivePusherContext.resumeBGM | ✔️ |  |  |  |  |
| LivePusherContext.sendMessage | ✔️ |  |  |  |  |
| LivePusherContext.setBGMVolume | ✔️ |  |  |  |  |
| LivePusherContext.setMICVolume | ✔️ |  |  |  |  |
| LivePusherContext.snapshot | ✔️ |  |  |  |  |
| LivePusherContext.start | ✔️ |  |  |  |  |
| LivePusherContext.startPreview | ✔️ |  |  |  |  |
| LivePusherContext.stop | ✔️ |  |  |  |  |
| LivePusherContext.stopBGM | ✔️ |  |  |  |  |
| LivePusherContext.stopPreview | ✔️ |  |  |  |  |
| LivePusherContext.switchCamera | ✔️ |  |  |  |  |
| LivePusherContext.toggleTorch | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/media/map/createMapContext.md">
---
title: Taro.createMapContext(mapId, component)
sidebar_label: createMapContext
---

创建 [map](/docs/components/maps/map) 上下文 [MapContext](/docs/apis/media/map/MapContext) 对象。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/wx.createMapContext.html)

## 类型

```tsx
(mapId: string, component?: TaroGeneral.IAnyObject) => MapContext
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| mapId | `string` | Map 组件的 id |
| component | `TaroGeneral.IAnyObject` | 在自定义组件下，当前组件实例的this，以操作组件内 Map 组件 |

## 示例代码

```tsx
const mapCtx = Taro.createMapContext('myMap')
```
</file>

<file path="docs/apis/media/map/MapContext.md">
---
title: MapContext
sidebar_label: MapContext
---

`MapContext` 实例，可通过 [Taro.createMapContext](./createMapContext) 获取。
`MapContext` 通过 id 跟一个 map 组件绑定，操作对应的 map 组件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.html)

## 方法

### getCenterLocation

获取当前地图中心的经纬度。返回的是 gcj02 坐标系，可以用于 [Taro.openLocation()](/docs/apis/location/openLocation)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.getCenterLocation.html)

```tsx
(option?: GetCenterLocationOption) => Promise<GetCenterLocationSuccessCallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `GetCenterLocationOption` |

### setLocMarkerIcon

设置定位点图标，支持网络路径、本地路径、代码包路径

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.setLocMarkerIcon.html)

```tsx
(option?: SetLocMarkerIconOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `SetLocMarkerIconOption` |

### moveToLocation

将地图中心移置当前定位点，此时需设置地图组件 show-location 为true。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.moveToLocation.html)

```tsx
(option: MoveToLocationOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `MoveToLocationOption` |

### translateMarker

平移marker，带动画

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.translateMarker.html)

```tsx
(option: TranslateMarkerOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `TranslateMarkerOption` |

### moveAlong

沿指定路径移动 marker，用于轨迹回放等场景。动画完成时触发回调事件，若动画进行中，对同一 marker 再次调用 moveAlong 方法，前一次的动画将被打断。

```tsx
(object: any) => any
```

### includePoints

缩放视野展示所有经纬度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.includePoints.html)

```tsx
(option: IncludePointsOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `IncludePointsOption` |

### getRegion

获取当前地图的视野范围

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.getRegion.html)

```tsx
(option?: GetRegionOption) => Promise<GetRegionSuccessCallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `GetRegionOption` |

### getRotate

获取当前地图的旋转角

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.getRotate.html)

```tsx
(option?: GetRotateOption) => Promise<GetRotateSuccessCallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `GetRotateOption` |

### getSkew

获取当前地图的倾斜角

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.getSkew.html)

```tsx
(option?: GetSkewOption) => Promise<GetSkewSuccessCallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `GetSkewOption` |

### getScale

获取当前地图的缩放级别

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.getScale.html)

```tsx
(option?: GetScaleOption) => Promise<GetScaleSuccessCallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `GetScaleOption` |

### setCenterOffset

设置地图中心点偏移，向后向下为增长，屏幕比例范围(0.25~0.75)，默认偏移为[0.5, 0.5]

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.setCenterOffset.html)

```tsx
(option: SetCenterOffsetOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `SetCenterOffsetOption` |

### removeCustomLayer

移除个性化图层。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.removeCustomLayer.html)

```tsx
(option: RemoveCustomLayerOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `RemoveCustomLayerOption` |

### addCustomLayer

添加个性化图层。图层创建参考文档

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.addCustomLayer.html)

```tsx
(option: AddCustomLayerOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `AddCustomLayerOption` |

### addGroundOverlay

创建自定义图片图层，图片会随着地图缩放而缩放。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.addGroundOverlay.html)

```tsx
(option: AddGroundLayerOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `AddGroundLayerOption` |

### addVisualLayer

添加可视化图层。需要刷新时，interval 可设置的最小值为 15 s。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.addVisualLayer.html)

```tsx
(option: AddVisualLayerOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `AddVisualLayerOption` |

### removeVisualLayer

移除可视化图层。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.removeVisualLayer.html)

```tsx
(option: RemoveVisualLayerOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `RemoveVisualLayerOption` |

### addArc

添加弧线，途经点与夹角必须设置一个。途经点必须在起终点有效坐标范围内，否则不能生成正确的弧线，同时设置夹角角度时，以夹角角度为准。夹角定义为起点到终点，与起点外切线逆时针旋转的角度。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.addArc.html)

```tsx
(option: AddArcOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `AddArcOption` |

### removeArc

删除弧线。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.removeArc.html)

```tsx
(option: RemoveArcOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `RemoveArcOption` |

### setBoundary

限制地图的显示范围。此接口同时会限制地图的最小缩放整数级别。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.setBoundary.html)

```tsx
(option: SetBoundaryOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `SetBoundaryOption` |

### updateGroundOverlay

更新自定义图片图层。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.updateGroundOverlay.html)

```tsx
(option: UpdateGroundOverlayOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `UpdateGroundOverlayOption` |

### removeGroundOverlay

移除自定义图片图层。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.removeGroundOverlay.html)

```tsx
(option: RemoveGroundOverlayOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `RemoveGroundOverlayOption` |

### toScreenLocation

获取经纬度对应的屏幕坐标，坐标原点为地图左上角。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.toScreenLocation.html)

```tsx
(option: ToScreenLocationOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `ToScreenLocationOption` |

### fromScreenLocation

获取屏幕上的点对应的经纬度，坐标原点为地图左上角。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.fromScreenLocation.html)

```tsx
(option: FromScreenLocationOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `FromScreenLocationOption` |

### openMapApp

拉起地图APP选择导航。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.openMapApp.html)

```tsx
(option: OpenMapAppOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `OpenMapAppOption` |

### addMarkers

添加 marker。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.addMarkers.html)

```tsx
(option: AddMarkersOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `AddMarkersOption` |

### removeMarkers

移除 marker。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.removeMarkers.html)

```tsx
(option: RemoveMarkersOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `RemoveMarkersOption` |

### initMarkerCluster

初始化点聚合的配置，未调用时采用默认配置。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.initMarkerCluster.html)

```tsx
(option?: InitMarkerClusterOption) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `InitMarkerClusterOption` |

### on

监听地图事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/map/MapContext.on.html)

```tsx
(event: keyof MapEvent, callback: (res: MapEventMarkerClusterCreate | MapEventMarkerClusterClick) => void) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| event | `keyof MapEvent` | 事件名 |
| callback | (res: MapEventMarkerClusterCreate or MapEventMarkerClusterClick) => void | 事件的回调函数 |

#### 示例代码

```tsx
MapContext.on('markerClusterCreate', (res) => {})
MapContext.on('markerClusterClick', (res) => {})
```

## 参数

### GetCenterLocationOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: GetCenterLocationSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### GetCenterLocationSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| latitude | `number` | 纬度 |
| longitude | `number` | 经度 |
| errMsg | `string` | 调用结果 |

### SetLocMarkerIconOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| iconPath | `string` | 是 | 图标路径，支持网络路径、本地路径、代码包路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### GetRegionOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: GetRegionSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### GetRegionSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| northeast | `MapPosition` | 东北角经纬度 |
| southwest | `MapPosition` | 西南角经纬度 |

### GetRotateOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: GetRotateSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### GetRotateSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| rotate | `number` | 旋转角 |
| errMsg | `string` | 调用结果 |

### GetScaleOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: GetScaleSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### GetScaleSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| scale | `number` | 缩放值 |
| errMsg | `string` | 调用结果 |

### GetSkewOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: GetSkewSuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### GetSkewSuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| skew | `number` | 倾斜角 |
| errMsg | `string` | 调用结果 |

### IncludePointsOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| points | `MapPosition[]` | 是 | 要显示在可视区域内的坐标点列表 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| padding | `number[]` | 否 | 坐标点形成的矩形边缘到地图边缘的距离，单位像素。格式为[上,右,下,左]，安卓上只能识别数组第一项，上下左右的padding一致。开发者工具暂不支持padding参数。 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### MapPosition

坐标点

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| latitude | `number` | 纬度 |
| longitude | `number` | 经度 |

### MapBoundary

经纬度范围

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| southwest | `MapPosition` | 西南角经纬度 |
| northeast | `MapPosition` | 东北角经纬度 |

### MoveToLocationOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| latitude | `number` | 否 | 纬度 |
| longitude | `number` | 否 | 经度 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### TranslateMarkerOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| autoRotate | `boolean` | 是 | 移动过程中是否自动旋转 marker |
| destination | `MapPosition` | 是 | 指定 marker 移动到的目标点 |
| markerId | `number` | 是 | 指定 marker |
| rotate | `number` | 是 | marker 的旋转角度 |
| animationEnd | `(...args: any[]) => any` | 否 | 动画结束回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| duration | `number` | 否 | 动画持续时长，平移与旋转分别计算 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SetCenterOffsetOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| offset | `number[]` | 是 | 偏移量，两位数组 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### RemoveCustomLayerOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| layerId | `number` | 是 | 个性化图层id |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### AddCustomLayerOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| layerId | `number` | 是 | 个性化图层id |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### AddGroundLayerOption

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| id | `number` |  | 是 | 图片图层 id |
| src | `string` |  | 是 | 图片路径，支持网络图片、临时路径、代码包路径 |
| bounds | `MapBoundary` |  | 是 | 图片覆盖的经纬度范围 |
| visible | `boolean` | `true` | 否 | 是否可见 |
| zIndex | `number` | `1` | 否 | 图层绘制顺序 |
| opacity | `number` | `1` | 否 | 图层透明度 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### AddVisualLayerOption

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| layerId | `number` |  | 是 | 个性化图层id（[创建图层指引](https://lbs.qq.com/dev/console/layers/layerEdit)) |
| interval | `number` | `0` | 否 | 刷新周期，单位秒 |
| zIndex | `number` | `1` | 否 | 图层绘制顺序 |
| opacity | `number` | `1` | 否 | 图层透明度 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### RemoveVisualLayerOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| layerId | `number` | 是 | 可视化图层 id |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### AddArcOption

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| id | `number` |  | 是 | 圆弧 id |
| start | `MapPosition` |  | 是 | 起始点 |
| end | `MapPosition` |  | 是 | 终点 |
| pass | `MapPosition` |  | 否 | 途经点 |
| angle | `number` | `0` | 否 | 夹角角度 |
| width | `number` | `5` | 否 | 线宽 |
| color | `string` | `"#000000"` | 否 | 线的颜色 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### RemoveArcOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| id | `number` | 是 | 圆弧 id |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SetBoundaryOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| southwest | `MapPosition` | 是 | 西南角经纬度 |
| northeast | `MapPosition` | 是 | 东北角经纬度 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### UpdateGroundOverlayOption

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| id | `number` |  | 是 | 图片图层 id |
| src | `string` |  | 是 | 图片路径，支持网络图片、临时路径、代码包路径 |
| bounds | `MapBoundary` |  | 是 | 图片覆盖的经纬度范围 |
| visible | `boolean` | `true` | 否 | 是否可见 |
| zIndex | `number` | `1` | 否 | 图层绘制顺序 |
| opacity | `number` | `1` | 否 | 图层透明度 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### RemoveGroundOverlayOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| id | `number` | 是 | 图片图层 id |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### ToScreenLocationOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| latitude | `number` | 是 | 纬度 |
| longitude | `number` | 是 | 经度 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### FromScreenLocationOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| x | `number` | 是 | x 坐标值 |
| y | `number` | 是 | y 坐标值 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### OpenMapAppOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| longitude | `number` | 是 | 目的地经度 |
| latitude | `number` | 是 | 目的地纬度 |
| destination | `string` | 是 | 目的地名称 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### AddMarkersOption

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| markers | `MapProps.marker[]` |  | 是 | 同传入 map 组件的 marker 属性 |
| clear | `boolean` | `false` | 否 | 是否先清空地图上所有 marker |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### RemoveMarkersOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| markerIds | `string[]` | 是 | marker 的 id 集合。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### InitMarkerClusterOption

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| enableDefaultStyle | `boolean` | `true` | 否 | 启用默认的聚合样式 |
| zoomOnClick | `boolean` | `true` | 否 | 点击已经聚合的标记点时是否实现聚合分离 |
| gridSize | `number` | `60` | 否 | 聚合算法的可聚合距离，即距离小于该值的点会聚合至一起，以像素为单位 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### MapEvent

event 的合法值

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| markerClusterCreate | `MapEventMarkerClusterCreate` | 缩放或拖动导致新的聚合簇产生时触发，仅返回新创建的聚合簇信息 |
| markerClusterClick | `MapEventMarkerClusterClick` | 聚合簇的点击事件 |

### MapEventMarkerClusterCreate

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| clusters | `ClusterInfo[]` | 聚合簇数据 |

### MapEventMarkerClusterClick

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| cluster | `ClusterInfo` | 聚合簇 |

### ClusterInfo

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| clusterId | `number` | 聚合簇的 id |
| center | `LatLng` | 聚合簇的坐标 |
| markerIds | `string[]` | 该聚合簇内的点标记数据数组 |

### LatLng

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| lat | `number` | 纬度值 |
| lng | `number` | 经度值 |

## API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| MapContext | ✔️ | ✔️ |  |  |  | ✔️ |
| MapContext.getCenterLocation | ✔️ | ✔️ |  |  |  | ✔️ |
| MapContext.setLocMarkerIcon | ✔️ | ✔️ |  |  |  |  |
| MapContext.moveToLocation | ✔️ | ✔️ |  |  |  | ✔️ |
| MapContext.translateMarker | ✔️ | ✔️ |  |  |  | ✔️ |
| MapContext.includePoints | ✔️ | ✔️ |  |  |  | ✔️ |
| MapContext.getRegion | ✔️ | ✔️ |  |  |  | ✔️ |
| MapContext.getRotate | ✔️ | ✔️ |  |  |  | ✔️ |
| MapContext.getSkew | ✔️ | ✔️ |  |  |  | ✔️ |
| MapContext.getScale | ✔️ | ✔️ |  |  |  | ✔️ |
| MapContext.setCenterOffset | ✔️ | ✔️ |  |  |  |  |
| MapContext.removeCustomLayer | ✔️ |  |  |  |  |  |
| MapContext.addCustomLayer | ✔️ |  |  |  |  |  |
| MapContext.addGroundOverlay | ✔️ | ✔️ |  |  |  |  |
| MapContext.addVisualLayer | ✔️ |  |  |  |  |  |
| MapContext.removeVisualLayer | ✔️ |  |  |  |  |  |
| MapContext.addArc | ✔️ |  |  |  |  |  |
| MapContext.removeArc | ✔️ |  |  |  |  |  |
| MapContext.setBoundary | ✔️ |  |  |  |  |  |
| MapContext.updateGroundOverlay | ✔️ | ✔️ |  |  |  |  |
| MapContext.removeGroundOverlay | ✔️ | ✔️ |  |  |  |  |
| MapContext.toScreenLocation | ✔️ |  |  |  |  |  |
| MapContext.fromScreenLocation | ✔️ |  |  |  |  |  |
| MapContext.openMapApp | ✔️ |  |  |  |  |  |
| MapContext.addMarkers | ✔️ |  |  |  |  |  |
| MapContext.removeMarkers | ✔️ |  |  |  |  |  |
| MapContext.initMarkerCluster | ✔️ |  |  |  |  |  |
| MapContext.on | ✔️ |  |  |  |  |  |
</file>

<file path="docs/apis/media/media-recorder/createMediaRecorder.md">
---
title: Taro.createMediaRecorder(canvas, option)
sidebar_label: createMediaRecorder
---

创建 WebGL 画面录制器，可逐帧录制在 WebGL 上渲染的画面并导出视频文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/media-recorder/wx.createMediaRecorder.html)

## 类型

```tsx
(canvas?: any, option?: Option) => MediaRecorder
```

## 参数

| 参数 | 类型 |
| --- | --- |
| canvas | `any` |
| option | `Option` |

### Option

createMediaRecorder Option

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/media-recorder/wx.createMediaRecorder.html)

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| duration | `number` | `600` | 否 | 指定录制的时长（s)，到达自动停止。最大 7200，最小 5 |
| videoBitsPerSecond | `number` | `1000` | 否 | 视频比特率（kbps），最小值 600，最大值 3000 |
| gop | `number` | `12` | 否 | 视频关键帧间隔 |
| fps | `number` | `24` | 否 | 视频 fps |
</file>

<file path="docs/apis/media/media-recorder/MediaRecorder.md">
---
title: MediaRecorder
sidebar_label: MediaRecorder
---

## 方法

### destroy

销毁录制器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/MediaRecorder.destroy.html)

```tsx
() => Promise<void>
```

### off

取消监听录制事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/MediaRecorder.off.html)

```tsx
(eventName: keyof EventName, callback: Callback) => Promise<void>
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| eventName | `keyof EventName` | 事件名 |
| callback | `Callback` | 事件触发时执行的回调函数 |

### on

注册监听录制事件的回调函数

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/MediaRecorder.on.html)

```tsx
(eventName: keyof EventName, callback: Callback) => Promise<void>
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| eventName | `keyof EventName` | 事件名 |
| callback | `Callback` | 事件触发时执行的回调函数 |

### pause

暂停录制

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/MediaRecorder.pause.html)

```tsx
() => Promise<void>
```

### requestFrame

请求下一帧录制，在 callback 里完成一帧渲染后开始录制当前帧

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/MediaRecorder.requestFrame.html)

```tsx
(callback: Callback) => Promise<void>
```

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |

### resume

恢复录制

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/MediaRecorder.resume.html)

```tsx
() => Promise<void>
```

### start

开始录制

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/MediaRecorder.start.html)

```tsx
() => Promise<void>
```

### stop

结束录制

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/MediaRecorder.stop.html)

```tsx
() => Promise<void>
```

## 参数

### on

#### EventName

eventName 的合法值

| 参数 | 说明 |
| --- | --- |
| start | 录制开始事件。 |
| stop | 录制结束事件。返回 {tempFilePath, duration, fileSize} |
| pause | 录制暂停事件。 |
| resume | 录制继续事件。 |
| timeupdate | 录制时间更新事件。 |

#### Callback

事件触发时执行的回调函数

```tsx
(res: { tempFilePath: string; duration: number; fileSize: number; }) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `{ tempFilePath: string; duration: number; fileSize: number; }` |

### requestFrame

#### Callback

事件触发时执行的回调函数

```tsx
() => void
```

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| MediaRecorder.destroy | ✔️ |  |  |  |  |
| MediaRecorder.off | ✔️ |  |  |  |  |
| MediaRecorder.on | ✔️ |  |  |  |  |
| MediaRecorder.pause | ✔️ |  |  |  |  |
| MediaRecorder.requestFrame | ✔️ |  |  |  |  |
| MediaRecorder.resume | ✔️ |  |  |  |  |
| MediaRecorder.start | ✔️ |  |  |  |  |
| MediaRecorder.stop | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/media/recorder/getRecorderManager.md">
---
title: Taro.getRecorderManager()
sidebar_label: getRecorderManager
---

获取**全局唯一**的录音管理器 RecorderManager

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/wx.getRecorderManager.html)

## 类型

```tsx
() => RecorderManager
```

## 示例代码

```tsx
const recorderManager = Taro.getRecorderManager()
recorderManager.onStart(() => {
  console.log('recorder start')
})
recorderManager.onPause(() => {
  console.log('recorder pause')
})
recorderManager.onStop((res) => {
  console.log('recorder stop', res)
  const { tempFilePath } = res
})
recorderManager.onFrameRecorded((res) => {
  const { frameBuffer } = res
  console.log('frameBuffer.byteLength', frameBuffer.byteLength)
})
const options = {
  duration: 10000,
  sampleRate: 44100,
  numberOfChannels: 1,
  encodeBitRate: 192000,
  format: 'aac',
  frameSize: 50
}
recorderManager.start(options)
```
</file>

<file path="docs/apis/media/recorder/RecorderManager.md">
---
title: RecorderManager
sidebar_label: RecorderManager
---

全局唯一的录音管理器

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/RecorderManager.html)

## 方法

### onError

监听录音错误事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/RecorderManager.onError.html)

```tsx
(callback: OnErrorCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnErrorCallback` | 录音错误事件的回调函数 |

### onFrameRecorded

监听已录制完指定帧大小的文件事件。如果设置了 frameSize，则会回调此事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/RecorderManager.onFrameRecorded.html)

```tsx
(callback: OnFrameRecordedCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnFrameRecordedCallback` | 已录制完指定帧大小的文件事件的回调函数 |

### onInterruptionBegin

监听录音因为受到系统占用而被中断开始事件。以下场景会触发此事件：微信语音聊天、微信视频聊天。此事件触发后，录音会被暂停。pause 事件在此事件后触发

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/RecorderManager.onInterruptionBegin.html)

```tsx
(callback: (res: TaroGeneral.CallbackResult) => void) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.CallbackResult) => void` | 录音因为受到系统占用而被中断开始事件的回调函数 |

### onInterruptionEnd

监听录音中断结束事件。在收到 interruptionBegin 事件之后，小程序内所有录音会暂停，收到此事件之后才可再次录音成功。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/RecorderManager.onInterruptionEnd.html)

```tsx
(callback: (res: TaroGeneral.CallbackResult) => void) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.CallbackResult) => void` | 录音中断结束事件的回调函数 |

### onPause

监听录音暂停事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/RecorderManager.onPause.html)

```tsx
(callback: (res: TaroGeneral.CallbackResult) => void) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.CallbackResult) => void` | 录音暂停事件的回调函数 |

### onResume

监听录音继续事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/RecorderManager.onResume.html)

```tsx
(callback: (res: TaroGeneral.CallbackResult) => void) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.CallbackResult) => void` | 录音继续事件的回调函数 |

### onStart

监听录音开始事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/RecorderManager.onStart.html)

```tsx
(callback: (res: TaroGeneral.CallbackResult) => void) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(res: TaroGeneral.CallbackResult) => void` | 录音开始事件的回调函数 |

### onStop

监听录音结束事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/RecorderManager.onStop.html)

```tsx
(callback: OnStopCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnStopCallback` | 录音结束事件的回调函数 |

### pause

暂停录音

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/RecorderManager.pause.html)

```tsx
() => void
```

### resume

继续录音

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/RecorderManager.resume.html)

```tsx
() => void
```

### start

开始录音

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/RecorderManager.start.html)

```tsx
(option: StartOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `StartOption` |

### stop

停止录音

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/RecorderManager.stop.html)

```tsx
() => void
```

## 参数

### OnErrorCallback

录音错误事件的回调函数

```tsx
(result: OnErrorCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnErrorCallbackResult` |

### OnErrorCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |

### OnFrameRecordedCallback

已录制完指定帧大小的文件事件的回调函数

```tsx
(result: OnFrameRecordedCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnFrameRecordedCallbackResult` |

### OnFrameRecordedCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| frameBuffer | `ArrayBuffer` | 录音分片数据 |
| isLastFrame | `boolean` | 当前帧是否正常录音结束前的最后一帧 |

### OnStopCallback

录音结束事件的回调函数

```tsx
(result: OnStopCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnStopCallbackResult` |

### OnStopCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| duration | `number` | 录音总时长，单位：ms |
| fileSize | `number` | 录音文件大小，单位：Byte |
| tempFilePath | `string` | 录音文件的临时路径 |

### StartOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| audioSource | `keyof AudioSource` | 否 | 指定录音的音频输入源，可通过 [Taro.getAvailableAudioSources()](/docs/apis/media/audio/getAvailableAudioSources) 获取当前可用的音频源 |
| duration | `number` | 否 | 录音的时长，单位 ms，最大值 600000（10 分钟） |
| encodeBitRate | `number` | 否 | 编码码率，有效值见下表格 |
| format | `keyof Format` | 否 | 音频格式 |
| frameSize | `number` | 否 | 指定帧大小，单位 KB。传入 frameSize 后，每录制指定帧大小的内容后，会回调录制的文件内容，不指定则不会回调。暂仅支持 mp3 格式。 |
| numberOfChannels | `keyof NumberOfChannels` | 否 | 录音通道数 |
| sampleRate | `keyof SampleRate` | 否 | 采样率 |

### AudioSource

指定录音的音频输入源

| 参数 | 说明 |
| --- | --- |
| auto | 自动设置，默认使用手机麦克风，插上耳麦后自动切换使用耳机麦克风，所有平台适用 |
| buildInMic | 手机麦克风，仅限 iOS |
| headsetMic | 耳机麦克风，仅限 iOS |
| mic | 麦克风（没插耳麦时是手机麦克风，插耳麦时是耳机麦克风），仅限 Android |
| camcorder | 同 mic，适用于录制音视频内容，仅限 Android |
| voice_communication | 同 mic，适用于实时沟通，仅限 Android |
| voice_recognition | 同 mic，适用于语音识别，仅限 Android |

### Format

音频格式

| 参数 | 说明 |
| --- | --- |
| mp3 | mp3 格式 |
| aac | aac 格式 |
| wav | wav 格式 |
| PCM | pcm 格式 |

### NumberOfChannels

录音通道数

| 参数 | 说明 |
| --- | --- |
| 1 | 1 个通道 |
| 2 | 2 个通道 |

### SampleRate

采样率

| 参数 | 说明 | 编码码率 |
| --- | --- | --- |
| 8000 | 8000 采样率 | `16000 ~ 48000` |
| 11025 | 11025 采样率 | `16000 ~ 48000` |
| 12000 | 12000 采样率 | `24000 ~ 64000` |
| 16000 | 16000 采样率 | `24000 ~ 96000` |
| 22050 | 22050 采样率 | `32000 ~ 128000` |
| 24000 | 24000 采样率 | `32000 ~ 128000` |
| 32000 | 32000 采样率 | `48000 ~ 192000` |
| 44100 | 44100 采样率 | `64000 ~ 320000` |
| 48000 | 48000 采样率 | `64000 ~ 320000` |

## API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| RecorderManager.onError | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| RecorderManager.onFrameRecorded | ✔️ | ✔️ |  |  |  |  |
| RecorderManager.onInterruptionBegin | ✔️ |  |  |  |  |  |
| RecorderManager.onInterruptionEnd | ✔️ |  |  |  |  |  |
| RecorderManager.onPause | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| RecorderManager.onResume | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| RecorderManager.onStart | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| RecorderManager.onStop | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| RecorderManager.pause | ✔️ |  |  | ✔️ |  | ✔️ |
| RecorderManager.resume | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| RecorderManager.start | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| RecorderManager.stop | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
</file>

<file path="docs/apis/media/recorder/startRecord.md">
---
title: Taro.startRecord(option)
sidebar_label: startRecord
---

开始录音。当主动调用`Taro.stopRecord`，或者录音超过1分钟时自动结束录音，返回录音文件的临时文件路径。当用户离开小程序时，此接口无法调用。
**注意：1.6.0 版本开始，本接口不再维护。建议使用能力更强的 [Taro.getRecorderManager](/docs/apis/media/recorder/getRecorderManager) 接口**
需要[用户授权](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html) scope.record

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/wx.startRecord.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempFilePath | `string` | 录音文件的临时路径 |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
Taro.startRecord({
  success: function (res) {
    const tempFilePath = res.tempFilePath
  }
})
setTimeout(function () {
  Taro.stopRecord() // 结束录音
}, 10000)
```
</file>

<file path="docs/apis/media/recorder/stopRecord.md">
---
title: Taro.stopRecord(option)
sidebar_label: stopRecord
---

停止录音。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/wx.stopRecord.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.startRecord({
  success: function (res) {
    var tempFilePath = res.tempFilePath
  },
  fail: function (res) {
     //录音失败
  }
})
setTimeout(function() {
  //结束录音
  Taro.stopRecord()
}, 10000)
```
</file>

<file path="docs/apis/media/video/chooseMedia.md">
---
title: Taro.chooseMedia(option)
sidebar_label: chooseMedia
---

拍摄或从手机相册中选择图片或视频。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/wx.chooseMedia.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| count | `number` | `9` | 否 | 最多可以选择的文件个数<br />API 支持度: weapp, h5 |
| mediaType | `(keyof mediaType)[]` | `['image', 'video']` | 否 | 文件类型<br />API 支持度: weapp, h5 |
| sourceType | `(keyof sourceType)[]` | `['album', 'camera']` | 否 | 图片和视频选择的来源<br />API 支持度: weapp, h5 |
| maxDuration | `number` | `10` | 否 | 拍摄视频最长拍摄时间，单位秒。时间范围为 3s 至 60s 之间<br />API 支持度: weapp |
| sizeType | ("original" or "compressed")[] | `['original', 'compressed']` | 否 | 是否压缩所选文件<br />API 支持度: weapp |
| camera | `string` | `"back"` | 否 | 仅在 sourceType 为 camera 时生效，使用前置或后置摄像头<br />API 支持度: weapp, h5 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |
| mediaId | `string` |  | 否 | 用来上传的input元素ID<br />API 支持度: h5 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempFiles | `ChooseMedia[]` | 本地临时文件列表 |
| type | `string` | 文件类型，有效值有 image 、video、mix |

### ChooseMedia

本地临时文件列表

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tempFilePath | `string` | 是 | 本地临时文件路径 (本地路径) |
| size | `number` | 是 | 本地临时文件大小，单位 B |
| duration | `number` | 是 | 视频的时间长度 |
| height | `number` | 是 | 视频的高度 |
| width | `number` | 是 | 视频的宽度 |
| thumbTempFilePath | `string` | 是 | 视频缩略图临时文件路径 |
| fileType | `string` | 是 | 选择的文件的类型 |
| originalFileObj | `File` | 否 | 原始的浏览器 File 对象<br />API 支持度: h5 |

### mediaType

| 参数 | 说明 |
| --- | --- |
| video | 只能拍摄视频或从相册选择视频 |
| image | 只能拍摄图片或从相册选择图片 |
| mix | 可同时选择图片和视频 |

### sourceType

| 参数 | 说明 |
| --- | --- |
| album | 从相册选择 |
| camera | 使用相机拍摄 |

### camera

| 参数 | 说明 |
| --- | --- |
| back | 使用后置摄像头 |
| front | 使用前置摄像头 |

## 示例代码

```tsx
Taro.chooseMedia({
  count: 9,
  mediaType: ['image','video'],
  sourceType: ['album', 'camera'],
  maxDuration: 30,
  camera: 'back',
  success: (res) => {
    console.log(res.tempFiles)
    console.log(res.type)
  }
})
```
</file>

<file path="docs/apis/media/video/chooseVideo.md">
---
title: Taro.chooseVideo(option)
sidebar_label: chooseVideo
---

拍摄视频或从手机相册中选视频。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/wx.chooseVideo.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| camera | `keyof Camera` | `"back"` | 否 | 默认拉起的是前置或者后置摄像头。部分 Android 手机下由于系统 ROM 不支持无法生效<br />API 支持度: weapp, h5 |
| compressed | `boolean` | `true` | 否 | 是否压缩所选择的视频文件<br />API 支持度: weapp |
| maxDuration | `number` | `60` | 否 | 拍摄视频最长拍摄时间，单位秒<br />API 支持度: weapp |
| sourceType | `(keyof sourceType)[]` | `['album', 'camera']` | 否 | 视频选择的来源<br />API 支持度: weapp, h5 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempFilePath | `string` | 选定视频的临时文件路径 |
| duration | `number` | 选定视频的时间长度 |
| size | `number` | 选定视频的数据量大小 |
| height | `number` | 返回选定视频的高度 |
| width | `number` | 返回选定视频的宽度 |
| errMsg | `string` | 调用结果 |

### Camera

| 参数 | 说明 |
| --- | --- |
| back | 默认拉起后置摄像头 |
| front | 默认拉起前置摄像头 |

### sourceType

| 参数 | 说明 |
| --- | --- |
| album | 从相册选择视频 |
| camera | 使用相机拍摄视频 |

## 示例代码

```tsx
Taro.chooseVideo({
  sourceType: ['album','camera'],
  maxDuration: 60,
  camera: 'back',
  success: function (res) {
    console.log(res.tempFilePath)
  }
})
```
</file>

<file path="docs/apis/media/video/compressVideo.md">
---
title: Taro.compressVideo(option)
sidebar_label: compressVideo
---

压缩视频接口。
开发者可指定压缩质量 `quality` 进行压缩。当需要更精细的控制时，可指定 `bitrate`、`fps`、和 `resolution`，当 `quality` 传入时，这三个参数将被忽略。原视频的相关信息可通过 [getVideoInfo](/docs/apis/media/video/getVideoInfo) 获取。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/wx.compressVideo.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| src | `string` | 是 | 视频文件路径，可以是临时文件路径也可以是永久文件路径 |
| quality | `keyof Quality` | 是 | 压缩质量 |
| bitrate | `number` | 是 | 码率，单位 kbps |
| fps | `number` | 是 | 帧率 |
| resolution | `number` | 是 | 相对于原视频的分辨率比例，取值范围(0, 1] |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempFilePath | `string` | 压缩后的临时文件地址 |
| size | `number` | 压缩后的大小，单位 kB |

### Quality

| 参数 | 说明 |
| --- | --- |
| low | 低 |
| medium | 中 |
| high | 高 |

## 示例代码

```tsx
Taro.chooseVideo({
  sourceType: ['album', 'camera'],
  maxDuration: 60,
  camera: 'back',
  compressed: false,
  success (res) {
    Taro.compressVideo({
      src: res.tempFilePath,
      quality: quality,
      bitrate: 1032,
      fps: 24,
      resolution:0.5,
      success (res) {
        console.log("压缩成功")
      },
      fail (err) {
        console.log("压缩失败")
      }
    })
  }
})
```
</file>

<file path="docs/apis/media/video/createVideoContext.md">
---
title: Taro.createVideoContext(id, component)
sidebar_label: createVideoContext
---

创建 video 上下文 VideoContext 对象。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/wx.createVideoContext.html)

## 类型

```tsx
(id: string, component?: TaroGeneral.IAnyObject) => VideoContext
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `string` | video 组件的 id |
| component | `TaroGeneral.IAnyObject` | 在自定义组件下，当前组件实例的this，以操作组件内 video 组件 |

## 示例代码

```tsx
videoContext = Taro.createVideoContext('myVideo')
```
</file>

<file path="docs/apis/media/video/getVideoInfo.md">
---
title: Taro.getVideoInfo(option)
sidebar_label: getVideoInfo
---

获取视频详细信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/wx.getVideoInfo.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| src | `string` | 是 | 视频文件路径，可以是临时文件路径也可以是永久文件路径 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| orientation | `keyof Orientation` | 画面方向 |
| type | `string` | 视频格式 |
| duration | `number` | 视频长度 |
| size | `number` | 视频大小，单位 kB |
| height | `number` | 视频的长，单位 px |
| width | `number` | 视频的宽，单位 px |
| fps | `number` | 视频帧率 |
| bitrate | `number` | 视频码率，单位 kbps |

### Orientation

| 参数 | 说明 |
| --- | --- |
| up | 默认 |
| down | 180 度旋转 |
| left | 逆时针旋转 90 度 |
| right | 顺时针旋转 90 度 |
| up-mirrored | 同 up，但水平翻转 |
| down-mirrored | 同 down，但水平翻转 |
| left-mirrored | 同 left，但垂直翻转 |
| right-mirrored | 同 right，但垂直翻转 |

## 示例代码

```tsx
Taro.downloadFile({
  url: 'https://mock.taro.org/mock_video.mp4',
  success(res) {
    Taro.getVideoInfo({
      src: res.tempFilePath,
      success (res) {
        console.log('获取文件地址成功')
        console.log(res)
      },
      fail (res) {
        console.log('获取文件地址失败')
        console.log(res)
      },
      complete (res) {
        console.log('获取文件地址')
      }
    })
  }
})
```
</file>

<file path="docs/apis/media/video/openVideoEditor.md">
---
title: Taro.openVideoEditor(option)
sidebar_label: openVideoEditor
---

打开视频编辑器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/wx.openVideoEditor.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 视频源的路径，只支持本地路径 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| duration | `number` | 剪辑后生成的视频文件的时长，单位毫秒（ms） |
| size | `number` | 剪辑后生成的视频文件大小，单位字节数（byte） |
| tempFilePath | `string` | 编辑后生成的视频文件的临时路径 |
| tempThumbPath | `string` | 编辑后生成的缩略图文件的临时路径 |

## 示例代码

```tsx
Taro.openVideoEditor({
 filePath: ''
})
```
</file>

<file path="docs/apis/media/video/saveVideoToPhotosAlbum.md">
---
title: Taro.saveVideoToPhotosAlbum(option)
sidebar_label: saveVideoToPhotosAlbum
---

保存视频到系统相册。支持mp4视频格式。需要[用户授权](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html) scope.writePhotosAlbum

**Bug & Tip：**

1.  `tip`: camera 参数在部分 Android 手机下由于系统 ROM 不支持无法生效

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/wx.saveVideoToPhotosAlbum.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 视频文件路径，可以是临时文件路径也可以是永久文件路径 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.saveVideoToPhotosAlbum({
  filePath: 'file://xxx',
  success: function (res) {
    console.log(res.errMsg)
  }
})
```
</file>

<file path="docs/apis/media/video/VideoContext.md">
---
title: VideoContext
sidebar_label: VideoContext
---

VideoContext 实例，可通过 [Taro.createVideoContext](./createVideoContext) 获取。

VideoContext 通过 id 跟一个 video 组件绑定，操作对应的 video 组件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/VideoContext.html)

## 方法

### exitBackgroundPlayback

退出后台音频播放模式。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/VideoContext.exitBackgroundPlayback.html)

```tsx
() => void
```

### exitFullScreen

退出全屏

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/VideoContext.exitFullScreen.html)

```tsx
() => void
```

### exitPictureInPicture

退出小窗，该方法可在任意页面调用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/VideoContext.exitPictureInPicture.html)

```tsx
(option: ExitPictureInPictureOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `ExitPictureInPictureOption` |

### hideStatusBar

隐藏状态栏，仅在iOS全屏下有效

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/VideoContext.hideStatusBar.html)

```tsx
() => void
```

### pause

暂停视频

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/VideoContext.pause.html)

```tsx
() => void
```

### play

播放视频

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/VideoContext.play.html)

```tsx
() => void
```

### playbackRate

设置倍速播放

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/VideoContext.playbackRate.html)

```tsx
(rate: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| rate | `number` | 倍率，支持 0.5/0.8/1.0/1.25/1.5，2.6.3 起支持 2.0 倍速 |

### requestBackgroundPlayback

进入后台音频播放模式。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/VideoContext.requestBackgroundPlayback.html)

```tsx
() => void
```

### requestFullScreen

进入全屏

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/VideoContext.requestFullScreen.html)

```tsx
(option: RequestFullScreenOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `RequestFullScreenOption` |

### seek

跳转到指定位置

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/VideoContext.seek.html)

```tsx
(position: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| position | `number` | 跳转到的位置，单位 s |

### sendDanmu

发送弹幕

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/VideoContext.sendDanmu.html)

```tsx
(data: Danmu) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | `Danmu` | 弹幕内容 |

### showStatusBar

显示状态栏，仅在iOS全屏下有效

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/VideoContext.showStatusBar.html)

```tsx
() => void
```

### stop

停止视频

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video/VideoContext.stop.html)

```tsx
() => void
```

## 参数

### ExitPictureInPictureOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| success | `(result: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### RequestFullScreenOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| direction | 0 or 90 or -90 | 否 | 设置全屏时视频的方向，不指定则根据宽高比自动判断。<br /><br />可选值：<br />- 0: 正常竖向;<br />- 90: 屏幕逆时针90度;<br />- -90: 屏幕顺时针90度; |

### Danmu

弹幕内容

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| text | `string` | 是 | 弹幕文字 |
| color | `string` | 否 | 弹幕颜色 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| VideoContext | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| VideoContext.exitBackgroundPlayback | ✔️ |  |  |  |  | ✔️ |
| VideoContext.exitFullScreen | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| VideoContext.exitPictureInPicture | ✔️ |  |  |  |  |  |
| VideoContext.hideStatusBar | ✔️ |  |  |  |  |  |
| VideoContext.pause | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| VideoContext.play | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| VideoContext.playbackRate | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| VideoContext.requestBackgroundPlayback | ✔️ |  |  |  |  | ✔️ |
| VideoContext.requestFullScreen | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| VideoContext.seek | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| VideoContext.sendDanmu | ✔️ |  |  |  |  |  |
| VideoContext.showStatusBar | ✔️ |  |  |  |  |  |
| VideoContext.stop | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
</file>

<file path="docs/apis/media/video-decoder/createVideoDecoder.md">
---
title: Taro.createVideoDecoder()
sidebar_label: createVideoDecoder
---

创建视频解码器，可逐帧获取解码后的数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/wx.createVideoDecoder.html)

## 类型

```tsx
() => VideoDecoder
```
</file>

<file path="docs/apis/media/video-decoder/VideoDecoder.md">
---
title: VideoDecoder
sidebar_label: VideoDecoder
---

## 方法

### getFrameData

获取下一帧的解码数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/VideoDecoder.getFrameData.html)

```tsx
() => Promise<Result>
```

### off

取消监听录制事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/VideoDecoder.off.html)

```tsx
(eventName: keyof EventName, callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| eventName | `keyof EventName` | 事件名 |
| callback | `Callback` | 事件触发时执行的回调函数 |

### on

注册监听录制事件的回调函数

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/VideoDecoder.on.html)

```tsx
(eventName: keyof EventName, callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| eventName | `keyof EventName` | 事件名 |
| callback | `Callback` | 事件触发时执行的回调函数 |

### remove

移除解码器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/VideoDecoder.remove.html)

```tsx
() => Promise<void>
```

### seek

跳到某个时间点解码

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/VideoDecoder.seek.html)

```tsx
(position: number) => Promise<void>
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| position | `number` | 跳转的解码位置，单位 ms |

### start

开始解码

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/VideoDecoder.start.html)

```tsx
(option: Option) => Promise<void>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### stop

停止解码

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-decoder/VideoDecoder.stop.html)

```tsx
() => Promise<void>
```

## 参数

### getFrameData

#### Result

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| width | `number` | 帧数据宽度 |
| height | `number` | 帧数据高度 |
| data | `ArrayBuffer` | 帧数据 |
| pkPts | `number` | 帧原始 pts |
| pkDts | `number` | 帧原始 dts |

### on

#### EventName

eventName 的合法值

| 参数 | 说明 |
| --- | --- |
| start | 开始事件。返回 {width, height} |
| stop | 结束事件。 |
| seek | seek 完成事件。 |
| bufferchange | 缓冲区变化事件。 |
| ended | 解码结束事件。 |

#### Callback

事件触发时执行的回调函数

```tsx
(res: { width: number; height: number; }) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `{ width: number; height: number; }` |

### start

#### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| source | `string` |  | 是 | 需要解码的视频源文件。 |
| mode | `number` | `1` | 否 | 解码模式。0：按 pts 解码；1：以最快速度解码 |
| abortAudio | `boolean` | `false` | 否 | 是否不需要音频轨道 |
| abortVideo | `boolean` | `false` | 否 | 是否不需要视频轨道 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| VideoDecoder.getFrameData | ✔️ |  |  |  |  |
| VideoDecoder.off | ✔️ |  |  |  |  |
| VideoDecoder.on | ✔️ |  |  |  |  |
| VideoDecoder.remove | ✔️ |  |  |  |  |
| VideoDecoder.seek | ✔️ |  |  |  |  |
| VideoDecoder.start | ✔️ |  |  |  |  |
| VideoDecoder.stop | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/media/video-processing/createMediaContainer.md">
---
title: Taro.createMediaContainer()
sidebar_label: createMediaContainer
---

创建音视频处理容器，最终可将容器中的轨道合成一个视频

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-processing/wx.createMediaContainer.html)

## 类型

```tsx
() => MediaContainer
```
</file>

<file path="docs/apis/media/video-processing/MediaContainer.md">
---
title: MediaContainer
sidebar_label: MediaContainer
---

创建音视频处理容器，最终可将容器中的轨道合成一个视频

> 可通过 [Taro.createMediaContainer](./createMediaContainer) 创建

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-processing/MediaContainer.html)

## 方法

### addTrack

将音频或视频轨道添加到容器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-processing/MediaContainer.addTrack.html)

```tsx
(track: MediaTrack) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| track | `MediaTrack` | 要添加的音频或视频轨道 |

### destroy

将容器销毁，释放资源

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-processing/MediaContainer.destroy.html)

```tsx
() => void
```

### export

将容器内的轨道合并并导出视频文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-processing/MediaContainer.export.html)

```tsx
() => void
```

### extractDataSource

将传入的视频源分离轨道。不会自动将轨道添加到待合成的容器里。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-processing/MediaContainer.extractDataSource.html)

```tsx
(option: ExtractDataSourceOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `ExtractDataSourceOption` |

### removeTrack

将音频或视频轨道从容器中移除

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-processing/MediaContainer.removeTrack.html)

```tsx
(track: MediaTrack) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| track | `MediaTrack` | 要移除的音频或视频轨道 |

## 参数

### ExtractDataSourceOption

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| source | `string` | 视频源地址，只支持本地文件 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| MediaContainer | ✔️ |  |  |  |  |
| MediaContainer.addTrack | ✔️ |  |  |  |  |
| MediaContainer.destroy | ✔️ |  |  |  |  |
| MediaContainer.export | ✔️ |  |  |  |  |
| MediaContainer.extractDataSource | ✔️ |  |  |  |  |
| MediaContainer.removeTrack | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/media/video-processing/MediaTrack.md">
---
title: MediaTrack
sidebar_label: MediaTrack
---

可通过 [MediaContainer.extractDataSource](/docs/apis/media/video-processing/MediaContainer#extractdatasource) 返回。
[MediaTrack](/docs/apis/media/video-processing/MediaTrack) 音频或视频轨道，可以对轨道进行一些操作

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/video-processing/MediaTrack.html)

## 方法

| 参数 | 类型 | 只读 | 说明 |
| --- | --- | :---: | --- |
| kind | `keyof Kind` | 是 | 轨道类型 |
| duration | `number` | 是 | 轨道长度 |
| volume | `number` | 否 | 音量，音频轨道下有效，可写 |

## 参数

### Kind

| 参数 | 说明 |
| --- | --- |
| audio | 音频轨道 |
| video | 视频轨道 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| MediaTrack | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/media/voip/exitVoIPChat.md">
---
title: Taro.exitVoIPChat(option)
sidebar_label: exitVoIPChat
---

退出（销毁）实时语音通话

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.exitVoIPChat.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/media/voip/join1v1Chat.md">
---
title: Taro.join1v1Chat(option)
sidebar_label: join1v1Chat
---

加入（创建）双人通话

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.join1v1Chat.html)

## 类型

```tsx
(option: Option) => Promise<Promised>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Caller

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| nickname | `string` | 是 | 昵称 |
| headImage | `string` | 否 | 头像 |
| openid | `string` | 是 | 小程序内 openid |

### Listener

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| nickname | `string` | 是 | 昵称 |
| headImage | `string` | 否 | 头像 |
| openid | `string` | 是 | 小程序内 openid |

### RoomType

| 参数 | 说明 |
| --- | --- |
| voice | 语音通话 |
| video | 视频通话 |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| caller | `Caller` |  | 是 | 呼叫方信息 |
| listener | `Listener` |  | 是 | 接听方信息 |
| backgroundType | `keyof ColorType` | `0` | 否 | 窗口背景色 |
| roomType | `keyof RoomType` |  | 否 | 通话类型 |
| minWindowType | `keyof ColorType` | `1` | 否 | 小窗样式 |
| disableSwitchVoice | `boolean` | `false` | 否 | 不允许切换到语音通话 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### ChatErrCode

| 参数 | 说明 |
| --- | --- |
| -20000 | 未开通双人通话 |
| -20001 | 当前设备不支持 |
| -20002 | 正在通话中 |
| -20003 | 其它小程序正在通话中 |
| -30000 | 内部系统错误 |
| -30001 | 微信缺失相机权限 |
| -30002 | 微信缺失录音权限 |
| -30003 | 小程序缺失录音权限 |
| -30004 | 小程序缺失相机权限 |
| -1 | 当前已在房间内 |
| -2 | 录音设备被占用，可能是当前正在使用微信内语音通话或系统通话 |
| -3 | 加入会话期间退出（可能是用户主动退出，或者退后台、来电等原因），因此加入失败 |
| -1000 | 系统错误 |

### FailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |
| errCode | `keyof ChatErrCode` | 错误码 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errCode | `number` | 错误码 |
| errMsg | `string` | 调用结果 |

### Promised

```tsx
FailCallbackResult | SuccessCallbackResult
```
</file>

<file path="docs/apis/media/voip/joinVoIPChat.md">
---
title: Taro.joinVoIPChat(option)
sidebar_label: joinVoIPChat
---

加入 (创建) 实时语音通话，更多信息可见 [实时语音指南](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/voip-chat.html)

调用前需要用户授权 `scope.record`，若房间类型为视频房间需要用户授权 `scope.camera`。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.joinVoIPChat.html)

## 类型

```tsx
(option: Option) => Promise<Promised>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Promised

```tsx
FailCallbackResult | SuccessCallbackResult
```

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| roomType | `RoomType` | `"voice"` | 否 | 房间类型 |
| signature | `string` |  | 是 | 签名，用于验证小游戏的身份 |
| nonceStr | `string` |  | 是 | 验证所需的随机字符串 |
| timeStamp | `number` |  | 是 | 验证所需的时间戳 |
| groupId | `string` |  | 是 | 小游戏内此房间/群聊的 ID。同一时刻传入相同 groupId 的用户会进入到同个实时语音房间。 |
| muteConfig | `MuteConfig` |  | 否 | 静音设置 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### RoomType

房间类型

| 参数 | 说明 |
| --- | --- |
| voice | 音频房间，用于语音通话 |
| video | 视频房间，结合 [voip-room](/docs/components/media/voip-room) 组件可显示成员画面 |

### MuteConfig

静音设置

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| muteMicrophone | `boolean` | 否 | 是否静音麦克风 |
| muteEarphone | `boolean` | 否 | 是否静音耳机 |

### FailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |
| errCode | `keyof VoipErrCode` | 错误码 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| openIdList | `string[]` | 还在实时语音通话中的成员 openId 名单 |
| errCode | `number` | 错误码 |
| errMsg | `string` | 调用结果 |

### VoipErrCode

Voip 错误码

| 参数 | 说明 |
| --- | --- |
| -1 | 当前已在房间内 |
| -2 | 录音设备被占用，可能是当前正在使用微信内语音通话或系统通话 |
| -3 | 加入会话期间退出（可能是用户主动退出，或者退后台、来电等原因），因此加入失败 |
| -1000 | 系统错误 |
</file>

<file path="docs/apis/media/voip/offVoIPChatInterrupted.md">
---
title: Taro.offVoIPChatInterrupted(callback)
sidebar_label: offVoIPChatInterrupted
---

取消监听被动断开实时语音通话事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.offVoIPChatInterrupted.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |
</file>

<file path="docs/apis/media/voip/offVoIPChatMembersChanged.md">
---
title: Taro.offVoIPChatMembersChanged(callback)
sidebar_label: offVoIPChatMembersChanged
---

取消监听实时语音通话成员在线状态变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.offVoIPChatMembersChanged.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |
</file>

<file path="docs/apis/media/voip/offVoIPChatSpeakersChanged.md">
---
title: Taro.offVoIPChatSpeakersChanged(callback)
sidebar_label: offVoIPChatSpeakersChanged
---

取消监听实时语音通话成员通话状态变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.offVoIPChatSpeakersChanged.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |
</file>

<file path="docs/apis/media/voip/offVoIPChatStateChanged.md">
---
title: Taro.offVoIPChatStateChanged(callback)
sidebar_label: offVoIPChatStateChanged
---

取消监听房间状态变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.offVoIPChatStateChanged.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |
</file>

<file path="docs/apis/media/voip/offVoIPVideoMembersChanged.md">
---
title: Taro.offVoIPVideoMembersChanged(callback)
sidebar_label: offVoIPVideoMembersChanged
---

取消监听实时语音通话成员视频状态变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.offVoIPVideoMembersChanged.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |
</file>

<file path="docs/apis/media/voip/onVoIPChatInterrupted.md">
---
title: Taro.onVoIPChatInterrupted(callback)
sidebar_label: onVoIPChatInterrupted
---

监听被动断开实时语音通话事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.onVoIPChatInterrupted.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |

### Result

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| openIdList | `string[]` | 还在实时语音通话中的成员 openId 名单 |
| errCode | `number` | 错误码 |
| errMsg | `string` | 调用结果 |

### Callback

房间状态变化事件的回调函数

```tsx
(res: Result) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `Result` |
</file>

<file path="docs/apis/media/voip/onVoIPChatMembersChanged.md">
---
title: Taro.onVoIPChatMembersChanged(callback)
sidebar_label: onVoIPChatMembersChanged
---

监听实时语音通话成员在线状态变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.onVoIPChatMembersChanged.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |

### Result

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| openIdList | `string[]` | 还在实时语音通话中的成员 openId 名单 |
| errCode | `number` | 错误码 |
| errMsg | `string` | 调用结果 |

### Callback

房间状态变化事件的回调函数

```tsx
(res: Result) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `Result` |
</file>

<file path="docs/apis/media/voip/onVoIPChatSpeakersChanged.md">
---
title: Taro.onVoIPChatSpeakersChanged(callback)
sidebar_label: onVoIPChatSpeakersChanged
---

监听实时语音通话成员通话状态变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.onVoIPChatSpeakersChanged.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |

### Result

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| openIdList | `string[]` | 还在实时语音通话中的成员 openId 名单 |
| errCode | `number` | 错误码 |
| errMsg | `string` | 调用结果 |

### Callback

房间状态变化事件的回调函数

```tsx
(res: Result) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `Result` |
</file>

<file path="docs/apis/media/voip/onVoIPChatStateChanged.md">
---
title: Taro.onVoIPChatStateChanged(callback)
sidebar_label: onVoIPChatStateChanged
---

监听房间状态变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.onVoIPChatStateChanged.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |

### Result

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| code | `number` | 事件码 |
| data | `Record<any, any>` | 附加信息 |
| errCode | `number` | 错误码 |
| errMsg | `string` | 调用结果 |

### Callback

房间状态变化事件的回调函数

```tsx
(res: Result) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `Result` |
</file>

<file path="docs/apis/media/voip/onVoIPVideoMembersChanged.md">
---
title: Taro.onVoIPVideoMembersChanged(callback)
sidebar_label: onVoIPVideoMembersChanged
---

监听实时语音通话成员视频状态变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.onVoIPVideoMembersChanged.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `Callback` |

### Result

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| openIdList | `string[]` | 开启视频的成员名单 |
| errCode | `number` | 错误码 |
| errMsg | `string` | 调用结果 |

### Callback

实时语音通话成员视频状态变化事件的回调函数

```tsx
(res: Result) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `Result` |
</file>

<file path="docs/apis/media/voip/setEnable1v1Chat.md">
---
title: Taro.setEnable1v1Chat(option)
sidebar_label: setEnable1v1Chat
---

开启双人通话

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.setEnable1v1Chat.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| enable | `boolean` |  | 是 | 是否开启 |
| backgroundType | `keyof ColorType` | `0` | 否 | 窗口背景色 |
| minWindowType | `keyof ColorType` | `1` | 否 | 小窗样式 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### ColorType

音频通话背景以及小窗模式背景

| 参数 | 说明 |
| --- | --- |
| 0 | #262930 |
| 1 | #FA5151 |
| 2 | #FA9D3B |
| 3 | #3D7257 |
| 4 | #1485EE |
| 5 | #6467F0 |
</file>

<file path="docs/apis/media/voip/subscribeVoIPVideoMembers.md">
---
title: Taro.subscribeVoIPVideoMembers(option)
sidebar_label: subscribeVoIPVideoMembers
---

订阅视频画面成员

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.subscribeVoIPVideoMembers.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| openIdList | `string[]` | 是 | 订阅的成员列表 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/media/voip/updateVoIPChatMuteConfig.md">
---
title: Taro.updateVoIPChatMuteConfig(option)
sidebar_label: updateVoIPChatMuteConfig
---

更新实时语音静音设置

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/voip/wx.updateVoIPChatMuteConfig.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| muteConfig | `MuteConfig` | 是 | 静音设置 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### MuteConfig

静音设置

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| muteMicrophone | `boolean` | 否 | 是否静音麦克风 |
| muteEarphone | `boolean` | 否 | 是否静音耳机 |
</file>

<file path="docs/apis/navigate/exitMiniProgram.md">
---
title: Taro.exitMiniProgram(option)
sidebar_label: exitMiniProgram
---

退出当前小程序。必须有点击行为才能调用成功。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/navigate/wx.exitMiniProgram.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

## 示例代码

```tsx
Taro.exitMiniProgram()
···
</file>

<file path="docs/apis/navigate/navigateBackMiniProgram.md">
---
title: Taro.navigateBackMiniProgram(option)
sidebar_label: navigateBackMiniProgram
---

返回到上一个小程序。只有在当前小程序是被其他小程序打开时可以调用成功

注意：**微信客户端 iOS 6.5.9，Android 6.5.10 及以上版本支持**

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/miniprogram-navigate/wx.navigateBackMiniProgram.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| extraData | `TaroGeneral.IAnyObject` | 否 | 需要返回给上一个小程序的数据，上一个小程序可在 `App.onShow` 中获取到这份数据。 [详情](https://developers.weixin.qq.com/miniprogram/dev/reference/api/App.html)。 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

## 示例代码

```tsx
Taro.navigateBackMiniProgram({
  extraData: {
    foo: 'bar'
  },
  success: function (res) {
    // 返回成功
  }
})
```
</file>

<file path="docs/apis/navigate/navigateToMiniProgram.md">
---
title: Taro.navigateToMiniProgram(option)
sidebar_label: navigateToMiniProgram
---

打开另一个小程序

**使用限制**
##### 需要用户触发跳转
从 2.3.0 版本开始，若用户未点击小程序页面任意位置，则开发者将无法调用此接口自动跳转至其他小程序。
##### 需要用户确认跳转
从 2.3.0 版本开始，在跳转至其他小程序前，将统一增加弹窗，询问是否跳转，用户确认后才可以跳转其他小程序。如果用户点击取消，则回调 `fail cancel`。
##### 每个小程序可跳转的其他小程序数量限制为不超过 10 个
从 2.4.0 版本以及指定日期（具体待定）开始，开发者提交新版小程序代码时，如使用了跳转其他小程序功能，则需要在代码配置中声明将要跳转的小程序名单，限定不超过 10 个，否则将无法通过审核。该名单可在发布新版时更新，不支持动态修改。配置方法详见 [小程序全局配置](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html)。调用此接口时，所跳转的 appId 必须在配置列表中，否则回调 `fail appId "${appId}" is not in navigateToMiniProgramAppIdList`。

**关于调试**
- 在开发者工具上调用此 API 并不会真实的跳转到另外的小程序，但是开发者工具会校验本次调用跳转是否成功。[详情](https://developers.weixin.qq.com/miniprogram/dev/devtools/different.html#跳转小程序调试支持)
- 开发者工具上支持被跳转的小程序处理接收参数的调试。[详情](https://developers.weixin.qq.com/miniprogram/dev/devtools/different.html#跳转小程序调试支持)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/miniprogram-navigate/wx.navigateToMiniProgram.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| appId | `string` | 否 | 要打开的小程序 appId |
| path | `string` | 否 | 打开的页面路径，如果为空则打开首页。path 中 ? 后面的部分会成为 query，在小程序的 `App.onLaunch`、`App.onShow` 和 `Page.onLoad` 的回调函数或小游戏的 [Taro.onShow](#) 回调函数、[Taro.getLaunchOptionsSync](/docs/apis/base/weapp/life-cycle/getLaunchOptionsSync) 中可以获取到 query 数据。对于小游戏，可以只传入 query 部分，来实现传参效果，如：传入 "?foo=bar"。 |
| extraData | `TaroGeneral.IAnyObject` | 否 | 需要传递给目标小程序的数据，目标小程序可在 `App.onLaunch`，`App.onShow` 中获取到这份数据。如果跳转的是小游戏，可以在 [Taro.onShow](#)、[Taro.getLaunchOptionsSync](/docs/apis/base/weapp/life-cycle/getLaunchOptionsSync) 中可以获取到这份数据数据。 |
| envVersion | `keyof EnvVersion` | 否 | 要打开的小程序版本。仅在当前小程序为开发版或体验版时此参数有效。如果当前小程序是正式版，则打开的小程序必定是正式版。 |
| shortLink | `string` | 否 | 小程序链接，当传递该参数后，可以不传 appId 和 path。链接可以通过【小程序菜单】->【复制链接】获取。 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### EnvVersion

| 参数 | 说明 |
| --- | --- |
| develop | 开发版 |
| trial | 体验版 |
| release | 正式版 |

## 示例代码

```tsx
Taro.navigateToMiniProgram({
  appId: '',
  path: 'page/index/index?id=123',
  extraData: {
    foo: 'bar'
  },
  envVersion: 'develop',
  success: function(res) {
    // 打开成功
  }
})
```
</file>

<file path="docs/apis/navigate/openBusinessView.md">
---
title: Taro.openBusinessView(option)
sidebar_label: openBusinessView
---

商户通过调用订单详情接口打开微信支付分小程序，引导用户查看订单详情（小程序端）

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://pay.weixin.qq.com/wiki/doc/apiv3/apis/chapter6_1_25.shtml)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### ScoreEnableExtraData

wxpayScoreEnable 业务参数

> [参考文档](https://pay.weixin.qq.com/wiki/doc/apiv3/apis/chapter6_1_9.shtml)

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| apply_permissions_token | `string` | 用于跳转到微信侧小程序授权数据,跳转到微信侧小程序传入，有效期为1小时；apply_permissions_token可以从[《商户预授权API》](https://pay.weixin.qq.com/wiki/doc/apiv3/apis/chapter6_1_2.shtml)接口的返回参数中获取。<br />示例值：1230000109 |

### ScoreUsedExtraData

wxpayScoreUse 业务参数

> [参考文档](https://pay.weixin.qq.com/wiki/doc/apiv3/apis/chapter6_1_13.shtml)

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| mch_id | `string` | 商户号：微信支付分配的商户号。<br />示例值：1230000109 |
| package | `string` | 可在【创建订单】接口的返回字段package中获取。<br />示例值：XXXXXXXX |
| timestamp | `string` | 时间戳：生成签名时间戳，单位秒。<br />示例值：1530097563 |
| nonce_str | `string` | 随机字符串：生成签名随机串。由数字、大小写字母组成，长度不超过32位。<br />示例值：zyx53Nkey8o4bHpxTQvd8m7e92nG5mG2 |
| sign_type | `string` | 签名方式：签名类型，仅支持HMAC-SHA256。<br />示例值：HMAC-SHA256 |
| sign | `string` | 签名：使用字段mch_id、service_id、out_order_no、timestamp、nonce_str、sign_type按照签名生成算法计算得出的签名值。<br />示例值：029B52F67573D7E3BE74904BF9AEA |

### ScoreDetailExtraData

wxpayScoreDetail 业务参数

> [参考文档](https://pay.weixin.qq.com/wiki/doc/apiv3/apis/chapter6_1_25.shtml)

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| mch_id | `string` | 商户号：微信支付分配的商户号。<br />示例值：1230000109 |
| service_id | `string` | 服务ID<br />示例值：88888888000011 |
| out_order_no | `string` | 商户服务订单号：商户系统内部服务订单号（不是交易单号）。<br />示例值：234323JKHDFE1243252 |
| timestamp | `string` | 时间戳：生成签名时间戳，单位秒。<br />示例值：1530097563 |
| nonce_str | `string` | 随机字符串：生成签名随机串。由数字、大小写字母组成，长度不超过32位。<br />示例值：zyx53Nkey8o4bHpxTQvd8m7e92nG5mG2 |
| sign_type | `string` | 签名方式：签名类型，仅支持HMAC-SHA256。<br />示例值：HMAC-SHA256 |
| sign | `string` | 签名：使用字段mch_id、service_id、out_order_no、timestamp、nonce_str、sign_type按照签名生成算法计算得出的签名值。<br />示例值：029B52F67573D7E3BE74904BF9AEA |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| businessType | `string` | 是 | 跳转类型：固定配置：wxpayScoreDetail<br />示例值：wxpayScoreDetail<br />memberof: Option |
| extraData | ScoreEnableExtraData or ScoreUsedExtraData or ScoreDetailExtraData | 是 | 业务参数：需要传递给支付分的业务数据 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

## 示例代码

```tsx
if (Taro.openBusinessView) {
  Taro.openBusinessView({
    businessType: 'wxpayScoreDetail',
    extraData: {
      mch_id: '1230000109',
      service_id: '88888888000011',
      out_order_no: '1234323JKHDFE1243252',
      timestamp: '1530097563',
      nonce_str: 'zyx53Nkey8o4bHpxTQvd8m7e92nG5mG2',
      sign_type: 'HMAC-SHA256',
      sign: '029B52F67573D7E3BE74904BF9AEA'
    },
    success() {
      //dosomething
    },
    fail() {
      //dosomething
    },
    complete() {
      //dosomething
    }
  });
} else {
  //引导用户升级微信版本
}
```
</file>

<file path="docs/apis/navigate/openEmbeddedMiniProgram.md">
---
title: Taro.openEmbeddedMiniProgram(option)
sidebar_label: openEmbeddedMiniProgram
---

打开半屏小程序。接入指引请参考 [半屏小程序能力](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/openEmbeddedMiniProgram.html)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/><img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/navigate/wx.openEmbeddedMiniProgram.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| appId | `string` | 否 | 要打开的小程序 appId |
| path | `string` | 否 | 打开的页面路径，如果为空则打开首页。path 中 ? 后面的部分会成为 query，在小程序的 `App.onLaunch`、`App.onShow` 和 `Page.onLoad` 的回调函数或小游戏的 [Taro.onShow](#) 回调函数、[Taro.getLaunchOptionsSync](/docs/apis/base/weapp/life-cycle/getLaunchOptionsSync) 中可以获取到 query 数据。对于小游戏，可以只传入 query 部分，来实现传参效果，如：传入 "?foo=bar"。 |
| extraData | `TaroGeneral.IAnyObject` | 否 | 需要传递给目标小程序的数据，目标小程序可在 `App.onLaunch`，`App.onShow` 中获取到这份数据。如果跳转的是小游戏，可以在 [Taro.onShow](#)、[Taro.getLaunchOptionsSync](/docs/apis/base/weapp/life-cycle/getLaunchOptionsSync) 中可以获取到这份数据数据。 |
| envVersion | `keyof EnvVersion` | 否 | 要打开的小程序版本。仅在当前小程序为开发版或体验版时此参数有效。如果当前小程序是正式版，则打开的小程序必定是正式版。 |
| shortLink | `string` | 否 | 小程序链接，当传递该参数后，可以不传 appId 和 path。链接可以通过【小程序菜单】->【复制链接】获取。 |
| verify | `keyof Verify` | 否 | 校验方式 。默认为binding |
| noRelaunchIfPathUnchanged | `boolean` | 否 | 不 reLaunch 目标小程序，直接打开目标跳转的小程序退后台时的页面，需满足以下条件：1. 目标跳转的小程序生命周期未被销毁；2. 且目标当次启动的path、query、apiCategory与上次启动相同。默认值为 false 。 |
| allowFullScreen | `boolean` | 否 | 打开的小程序是否支持全屏 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### Verify

| 参数 | 说明 |
| --- | --- |
| binding | 校验小程序管理后台的绑定关系 |
| unionProduct | 校验目标打开链接是否为小程序联盟商品。 |

### EnvVersion

| 参数 | 说明 |
| --- | --- |
| develop | 开发版 |
| trial | 体验版 |
| release | 正式版 |
</file>

<file path="docs/apis/network/download/downloadFile.md">
---
title: Taro.downloadFile(option)
sidebar_label: downloadFile
---

下载文件资源到本地。客户端直接发起一个 HTTPS GET 请求，返回文件的本地临时路径，单次下载允许的最大文件为 50MB。使用前请注意阅读[相关说明](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html)。

注意：请在服务端响应的 header 中指定合理的 `Content-Type` 字段，以保证客户端正确处理文件类型。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/download/wx.downloadFile.html)

## 类型

```tsx
(option: Option) => DownloadTaskPromise
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| url | `string` |  | 是 | 下载资源的 url |
| filePath | `string` |  | 否 | 指定文件下载后存储的路径 |
| header | `TaroGeneral.IAnyObject` |  | 否 | HTTP 请求的 Header，Header 中不能设置 Referer |
| timeout | `number` |  | 否 | 超时时间，单位为毫秒 |
| withCredentials | `boolean` | `true` | 否 | 是否应使用传出凭据 (cookie) 发送此请求<br />API 支持度: h5 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(result: FileSuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### FileSuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 用户文件路径。传入 filePath 时会返回，跟传入的 filePath 一致 |
| statusCode | `number` | 是 | 开发者服务器返回的 HTTP 状态码 |
| tempFilePath | `string` | 是 | 临时文件路径。没传入 filePath 指定文件存储路径时会返回，下载后的文件会存储到一个临时文件 |
| errMsg | `string` | 是 | 调用结果 |
| header | `TaroGeneral.IAnyObject` | 否 | 开发者服务器返回的 HTTP Response Header<br />API 支持度: weapp<br />weapp: 非官方文档标注属性 |
| dataLength | `number` | 否 | 数据长度，单位 Byte<br />API 支持度: weapp<br />weapp: 非官方文档标注属性 |
| cookies | `string[]` | 否 | cookies<br />API 支持度: weapp<br />weapp: 非官方文档标注属性 |
| profile | `TaroGeneral.IAnyObject` | 否 | 网络请求过程中一些调试信息 |

## 示例代码

```tsx
Taro.downloadFile({
  url: 'https://example.com/audio/123', //仅为示例，并非真实的资源
  success: function (res) {
    // 只要服务器有响应数据，就会把响应内容写入文件并进入 success 回调，业务需要自行判断是否下载到了想要的内容
    if (res.statusCode === 200) {
      Taro.playVoice({
        filePath: res.tempFilePath
      })
    }
  }
})
```
</file>

<file path="docs/apis/network/download/DownloadTask.md">
---
title: DownloadTask
sidebar_label: DownloadTask
---

一个可以监听下载进度变化事件，以及取消下载任务的对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/download/DownloadTask.html)

## 方法

### abort

中断下载任务

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/download/DownloadTask.abort.html)

```tsx
() => void
```

### onProgressUpdate

监听下载进度变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/download/DownloadTask.onProgressUpdate.html)

```tsx
(callback: OnProgressUpdateCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnProgressUpdateCallback` | 下载进度变化事件的回调函数 |

### offProgressUpdate

取消监听下载进度变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/download/DownloadTask.offProgressUpdate.html)

```tsx
(callback: OnProgressUpdateCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnProgressUpdateCallback` | 下载进度变化事件的回调函数 |

### onHeadersReceived

监听 HTTP Response Header 事件。会比请求完成事件更早

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/download/DownloadTask.onHeadersReceived.html)

```tsx
(callback: OnHeadersReceivedCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnHeadersReceivedCallback` | HTTP Response Header 事件的回调函数 |

### offHeadersReceived

取消监听 HTTP Response Header 事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/download/DownloadTask.offHeadersReceived.html)

```tsx
(callback: OnHeadersReceivedCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnHeadersReceivedCallback` | HTTP Response Header 事件的回调函数 |

## 参数

### OnHeadersReceivedCallback

HTTP Response Header 事件的回调函数

```tsx
(result: OnHeadersReceivedCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnHeadersReceivedCallbackResult` |

### OnProgressUpdateCallback

下载进度变化事件的回调函数

```tsx
(result: OnProgressUpdateCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnProgressUpdateCallbackResult` |

### OnHeadersReceivedCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| header | `TaroGeneral.IAnyObject` | 开发者服务器返回的 HTTP Response Header |

### OnProgressUpdateCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| progress | `number` | 下载进度百分比 |
| totalBytesExpectedToWrite | `number` | 预期需要下载的数据总长度，单位 Bytes |
| totalBytesWritten | `number` | 已经下载的数据长度，单位 Bytes |

### DownloadTaskPromise

## 示例代码

```tsx
const downloadTask = Taro.downloadFile({
  url: 'http://example.com/audio/123', //仅为示例，并非真实的资源
  success (res) {
    Taro.playVoice({
      filePath: res.tempFilePath
    })
  }
})

downloadTask.onProgressUpdate((res) => {
  console.log('下载进度', res.progress)
  console.log('已经下载的数据长度', res.totalBytesWritten)
  console.log('预期需要下载的数据总长度', res.totalBytesExpectedToWrite)
})

downloadTask.abort() // 取消下载任务
```

## API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| DownloadTask | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| DownloadTask.abort | ✔️ |  |  | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| DownloadTask.onProgressUpdate | ✔️ |  |  | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| DownloadTask.offProgressUpdate | ✔️ |  |  | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| DownloadTask.onHeadersReceived | ✔️ |  |  |  | ✔️ |  |  |  | ✔️ |
| DownloadTask.offHeadersReceived | ✔️ |  |  |  | ✔️ |  |  |  | ✔️ |
</file>

<file path="docs/apis/network/mdns/offLocalServiceDiscoveryStop.md">
---
title: Taro.offLocalServiceDiscoveryStop(callback)
sidebar_label: offLocalServiceDiscoveryStop
---

取消监听 mDNS 服务停止搜索的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/mdns/wx.offLocalServiceDiscoveryStop.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | mDNS 服务停止搜索的事件的回调函数 |

### Callback

mDNS 服务停止搜索的事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |
</file>

<file path="docs/apis/network/mdns/offLocalServiceFound.md">
---
title: Taro.offLocalServiceFound(callback)
sidebar_label: offLocalServiceFound
---

取消监听 mDNS 服务发现的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/mdns/wx.offLocalServiceFound.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | mDNS 服务发现的事件的回调函数 |

### Callback

mDNS 服务发现的事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |
</file>

<file path="docs/apis/network/mdns/offLocalServiceLost.md">
---
title: Taro.offLocalServiceLost(callback)
sidebar_label: offLocalServiceLost
---

取消监听 mDNS 服务离开的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/mdns/wx.offLocalServiceLost.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | mDNS 服务离开的事件的回调函数 |

### Callback

mDNS 服务离开的事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |
</file>

<file path="docs/apis/network/mdns/offLocalServiceResolveFail.md">
---
title: Taro.offLocalServiceResolveFail(callback)
sidebar_label: offLocalServiceResolveFail
---

取消监听 mDNS 服务解析失败的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/mdns/wx.offLocalServiceResolveFail.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | mDNS 服务解析失败的事件的回调函数 |

### Callback

mDNS 服务解析失败的事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |
</file>

<file path="docs/apis/network/mdns/onLocalServiceDiscoveryStop.md">
---
title: Taro.onLocalServiceDiscoveryStop(callback)
sidebar_label: onLocalServiceDiscoveryStop
---

监听 mDNS 服务停止搜索的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/mdns/wx.onLocalServiceDiscoveryStop.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | mDNS 服务停止搜索的事件的回调函数 |

### Callback

mDNS 服务停止搜索的事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |
</file>

<file path="docs/apis/network/mdns/onLocalServiceFound.md">
---
title: Taro.onLocalServiceFound(callback)
sidebar_label: onLocalServiceFound
---

监听 mDNS 服务发现的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/mdns/wx.onLocalServiceFound.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | mDNS 服务发现的事件的回调函数 |

### Callback

mDNS 服务发现的事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| ip | `string` | 服务的 ip 地址 |
| port | `number` | 服务的端口 |
| serviceName | `string` | 服务的名称 |
| serviceType | `string` | 服务的类型 |
</file>

<file path="docs/apis/network/mdns/onLocalServiceLost.md">
---
title: Taro.onLocalServiceLost(callback)
sidebar_label: onLocalServiceLost
---

监听 mDNS 服务离开的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/mdns/wx.onLocalServiceLost.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | mDNS 服务离开的事件的回调函数 |

### Callback

mDNS 服务离开的事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| serviceName | `string` | 服务的名称 |
| serviceType | `string` | 服务的类型 |
</file>

<file path="docs/apis/network/mdns/onLocalServiceResolveFail.md">
---
title: Taro.onLocalServiceResolveFail(callback)
sidebar_label: onLocalServiceResolveFail
---

监听 mDNS 服务解析失败的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/mdns/wx.onLocalServiceResolveFail.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | mDNS 服务解析失败的事件的回调函数 |

### Callback

mDNS 服务解析失败的事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| serviceName | `string` | 服务的名称 |
| serviceType | `string` | 服务的类型 |
</file>

<file path="docs/apis/network/mdns/startLocalServiceDiscovery.md">
---
title: Taro.startLocalServiceDiscovery(option)
sidebar_label: startLocalServiceDiscovery
---

开始搜索局域网下的 mDNS 服务。搜索的结果会通过 wx.onLocalService* 事件返回。

**注意**
1. wx.startLocalServiceDiscovery 是一个消耗性能的行为，开始 30 秒后会自动 stop 并执行 wx.onLocalServiceDiscoveryStop 注册的回调函数。
2. 在调用 wx.startLocalServiceDiscovery 后，在这次搜索行为停止后才能发起下次 wx.startLocalServiceDiscovery。停止本次搜索行为的操作包括调用 wx.stopLocalServiceDiscovery 和 30 秒后系统自动 stop 本次搜索。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/mdns/wx.startLocalServiceDiscovery.html)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: FailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### FailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'invalid param': serviceType 为空;<br />- 'scan task already exist': 在当前 startLocalServiceDiscovery 发起的搜索未停止的情况下，再次调用 startLocalServiceDiscovery; |
</file>

<file path="docs/apis/network/mdns/stopLocalServiceDiscovery.md">
---
title: Taro.stopLocalServiceDiscovery(option)
sidebar_label: stopLocalServiceDiscovery
---

停止搜索 mDNS 服务

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/mdns/wx.stopLocalServiceDiscovery.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: FailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### FailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息<br /><br />可选值：<br />- 'task not found': 在当前没有处在搜索服务中的情况下调用 stopLocalServiceDiscovery; |
</file>

<file path="docs/apis/network/request/addInterceptor.md">
---
title: Taro.addInterceptor(interceptor)
sidebar_label: addInterceptor
---

> 最低 Taro 版本: 1.2.16

可以使用拦截器在请求发出前或发出后做一些额外操作。

在调用 `Taro.request` 发起请求之前，调用 `Taro.addInterceptor` 方法为请求添加拦截器，拦截器的调用顺序遵循洋葱模型。
拦截器是一个函数，接受 chain 对象作为参数。chain 对象中含有 **requestParmas** 属性，代表请求参数。拦截器内最后需要调用 `chain.proceed(requestParams)` 以调用下一个拦截器或发起请求。

Taro 提供了两个内置拦截器 `logInterceptor` 与 `timeoutInterceptor`，分别用于打印请求的相关信息和在请求超时时抛出错误。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
(interceptor: interceptor) => any
```

## 参数

| 参数 | 类型 |
| --- | --- |
| interceptor | `interceptor` |

## 示例代码

### 示例 1

```tsx
const interceptor = function (chain) {
  const requestParams = chain.requestParams
  const { method, data, url } = requestParams

  console.log(`http ${method || 'GET'} --> ${url} data: `, data)

  return chain.proceed(requestParams)
    .then(res => {
      console.log(`http <-- ${url} result:`, res)
      return res
    })
  }
Taro.addInterceptor(interceptor)
Taro.request({ url })
```

### 示例 2

```tsx
Taro.addInterceptor(Taro.interceptors.logInterceptor)
Taro.addInterceptor(Taro.interceptors.timeoutInterceptor)
Taro.request({ url })
```
</file>

<file path="docs/apis/network/request/cleanInterceptors.md">
---
title: Taro.cleanInterceptors()
sidebar_label: cleanInterceptors
---

清除所有拦截器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
() => void
```

## 示例代码

```tsx
Taro.cleanInterceptors()
```
</file>

<file path="docs/apis/network/request/request.md">
---
title: Taro.request(option)
sidebar_label: request
---

发起 HTTPS 网络请求。使用前请注意阅读[相关说明](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html)。

**data 参数说明**
最终发送给服务器的数据是 String 类型，如果传入的 data 不是 String 类型，会被转换成 String 。转换规则如下：
- 对于 `GET` 方法的数据，会将数据转换成 query string（`encodeURIComponent(k)=encodeURIComponent(v)&encodeURIComponent(k)=encodeURIComponent(v)...`）
- 对于 `POST` 方法且 `header['content-type']` 为 `application/json` 的数据，会对数据进行 JSON 序列化
- 对于 `POST` 方法且 `header['content-type']` 为 `application/x-www-form-urlencoded` 的数据，会将数据转换成 query string `（encodeURIComponent(k)=encodeURIComponent(v)&encodeURIComponent(k)=encodeURIComponent(v)...）`

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html)

## 类型

```tsx
<T = any, U = any>(option: Option<T, U>) => RequestTask<T>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `T` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| url | `string` |  | 是 | 开发者服务器接口地址 |
| data | `U` |  | 否 | 请求的参数 |
| header | `TaroGeneral.IAnyObject` |  | 否 | 设置请求的 header，header 中不能设置 Referer。<br /><br />`content-type` 默认为 `application/json` |
| timeout | `number` | `60000` | 否 | 超时时间，单位为毫秒<br />API 支持度: weapp, h5, tt, alipay, rn |
| method | `keyof Method` | `"GET"` | 否 | HTTP 请求方法 |
| dataType | `string` |  | 否 | 返回的数据格式 |
| responseType | `keyof ResponseType` |  | 否 | 响应的数据类型 |
| enableHttp2 | `boolean` | `false` | 否 | 开启 http2<br />API 支持度: weapp |
| enableQuic | `boolean` | `false` | 否 | 开启 quic<br />API 支持度: weapp |
| enableCache | `boolean` | `false` | 否 | 开启 cache<br />API 支持度: weapp, tt |
| enableHttpDNS | `boolean` | `false` | 否 | 是否开启 HttpDNS 服务。如开启，需要同时填入 httpDNSServiceId 。 HttpDNS 用法详见 移动解析HttpDNS<br />API 支持度: weapp |
| httpDNSServiceId | `string` |  | 否 | HttpDNS 服务商 Id。 HttpDNS 用法详见 移动解析HttpDNS<br />API 支持度: weapp |
| enableChunked | `boolean` | `false` | 否 | 开启 transfer-encoding chunked。<br />API 支持度: weapp |
| forceCellularNetwork | `boolean` | `false` | 否 | wifi下使用移动网络发送请求<br />API 支持度: weapp |
| enableCookie | `boolean` | `false` | 否 | headers 中设置 cookie 字段是否生效。如果为 false，则 headers 中的 cookie 字段将被忽略，请求头中将包含服务端上一次返回的 cookie（如果有）。<br />API 支持度: alipay 支付宝: 10.2.33+ |
| referrerStrategy | `keyof ReferrerStrategy` | `"querystring"` | 否 | referer 策略，用于控制当前请求 header 对象中 referer 字段格式。该参数默认值可通过 app.json 中的配置进行修改。<br />API 支持度: alipay 支付宝: 10.3.50+ APPX: 2.8.7 开发者工具: 3.5.1<br />[参考地址](https://opendocs.alipay.com/mini/api/owycmh#referrerStrategy%20%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E) |
| success | `(result: SuccessCallbackResult<T>) => void` |  | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| complete | `(res: Partial<SuccessCallbackResult> & TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| jsonp | string or boolean | `false` | 否 | 设置是否使用 jsonp 方式获取数据<br />API 支持度: h5 |
| jsonpCache | `RequestCache` |  | 否 | 设置 jsonp 请求 url 是否需要被缓存<br />API 支持度: h5 |
| mode | `keyof CorsMode` | `"same-origin"` | 否 | 设置是否允许跨域请求<br />API 支持度: h5 |
| credentials | `keyof Credentials` | `"omit"` | 否 | 设置是否携带 Cookie<br />API 支持度: h5 |
| cache | `keyof Cache` | `"default"` | 否 | 设置缓存模式<br />API 支持度: h5 |
| retryTimes | `number` | `2` | 否 | 设置请求重试次数<br />API 支持度: h5<br />h5: 仅在 jsonp 模式下生效 |
| backup | string or string[] |  | 否 | 设置请求的兜底接口<br />API 支持度: h5<br />h5: 仅在 jsonp 模式下生效 |
| signal | `AbortSignal` |  | 否 | 设置请求中止信号<br />API 支持度: h5 |
| dataCheck | `() => boolean` |  | 否 | 设置请求响应的数据校验函数，若返回 false，则请求兜底接口，若无兜底接口，则报请求失败<br />API 支持度: h5<br />h5: 仅在 jsonp 模式下生效 |
| useStore | `boolean` | `false` | 否 | 设置请求是否使用缓存<br />API 支持度: h5<br />h5: 仅在 jsonp 模式下生效 |
| storeCheckKey | `string` |  | 否 | 设置请求缓存校验的 key<br />API 支持度: h5<br />h5: 仅在 jsonp 模式下生效 |
| storeSign | `string` |  | 否 | 设置请求缓存签名<br />API 支持度: h5<br />h5: 仅在 jsonp 模式下生效 |
| storeCheck | `() => boolean` |  | 否 | 设置请求校验函数，一般不需要设置<br />API 支持度: h5 |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `T` | 是 | 开发者服务器返回的数据 |
| header | `TaroGeneral.IAnyObject` | 是 | 开发者服务器返回的 HTTP Response Header |
| statusCode | `number` | 是 | 开发者服务器返回的 HTTP 状态码 |
| errMsg | `string` | 是 | 调用结果 |
| cookies | `string[]` | 否 | cookies |

### DataType

返回的数据格式

| 参数 | 说明 |
| --- | --- |
| json | 返回的数据为 JSON，返回后会对返回的数据进行一次 JSON.parse<br />其他: 不对返回的内容进行 JSON.parse |
| text | 返回的数据为文本字符串<br />API 支持度: alipay |
| base64 | 返回的数据将转换为 base64 格式字符串<br />API 支持度: alipay |
| arraybuffer | 返回的数据将保持 ArrayBuffer 数据<br />API 支持度: alipay 支付宝: 10.1.70+ |

### Method

HTTP 请求方法

| 参数 | 说明 |
| --- | --- |
| OPTIONS | HTTP 请求 OPTIONS |
| GET | HTTP 请求 GET |
| HEAD | HTTP 请求 HEAD |
| POST | HTTP 请求 POST |
| PUT | HTTP 请求 PUT |
| PATCH | HTTP 请求 PATCH |
| DELETE | HTTP 请求 DELETE |
| TRACE | HTTP 请求 TRACE |
| CONNECT | HTTP 请求 CONNECT |

### ResponseType

响应的数据类型

| 参数 | 说明 |
| --- | --- |
| text | 响应的数据为文本 |
| arraybuffer | 响应的数据为 ArrayBuffer |

### CorsMode

跨域策略

| 参数 | 说明 |
| --- | --- |
| no-cors | 跨域请求将获取不透明的响应 |
| cors | 允许跨域请求 |
| same-origin | 请求总是向当前的源发起的 |

### Credentials

证书

| 参数 | 说明 |
| --- | --- |
| include | 不论是不是跨域的请求,总是发送请求资源域在本地的 cookies、 HTTP Basic authentication 等验证信息 |
| same-origin | 只有当URL与响应脚本同源才发送 cookies、 HTTP Basic authentication 等验证信息 |
| omit | 从不发送cookies |

### Cache

缓存策略

| 参数 | 说明 |
| --- | --- |
| default | 浏览器从HTTP缓存中寻找匹配的请求 |
| no-cache | 浏览器在其HTTP缓存中寻找匹配的请求 |
| reload | 浏览器直接从远程服务器获取资源，不查看缓存，然后使用下载的资源更新缓存 |
| force-cache | 浏览器在其HTTP缓存中寻找匹配的请求 |
| only-if-cached | 浏览器在其HTTP缓存中寻找匹配的请求 |

### ReferrerStrategy

referer 策略

| 参数 | 说明 |
| --- | --- |
| index | referer 值为 https://{appid}.hybrid.alipay-eco.com/{appid}/{version}/index.html |
| page | 保留 page（pages/xxx/yyy），referer 值为 https://{appid}.hybrid.alipay-eco.com/{appid}/{version}/index.html#{page} |
| querystring | 默认值。会将发起请求时所在页面的 URL 作为 referer 值，会保留 page（pages/xxx/yyy）和 querystring（x=1&y=2）并可能有框架添加的其他参数，referer 值为 https://{appid}.hybrid.alipay-eco.com/{appid}/{version}/index.html#{page}?{querysrtring}{框架其他参数} |

## 示例代码

### 示例 1

```tsx
Taro.request({
  url: 'test.php', //仅为示例，并非真实的接口地址
  data: {
    x: '',
    y: ''
  },
  header: {
    'content-type': 'application/json' // 默认值
  },
  success: function (res) {
    console.log(res.data)
  }
})
```

### 示例 2

async/await 用法：

```tsx
const res = await Taro.request(params)
```
</file>

<file path="docs/apis/network/request/RequestTask.md">
---
title: RequestTask
sidebar_label: RequestTask
---

网络请求任务对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/request/RequestTask.html)

## 方法

### abort

中断请求任务

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/request/RequestTask.abort.html)

```tsx
() => void
```

### onHeadersReceived

监听 HTTP Response Header 事件。会比请求完成事件更早

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/request/RequestTask.onHeadersReceived.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | HTTP Response Header 事件的回调函数 |

### offHeadersReceived

取消监听 HTTP Response Header 事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/request/RequestTask.offHeadersReceived.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | HTTP Response Header 事件的回调函数 |

### onChunkReceived

监听 Transfer-Encoding Chunk Received 事件。当接收到新的chunk时触发。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/request/RequestTask.onChunkReceived.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | Transfer-Encoding Chunk Received 事件的回调函数 |

### offChunkReceived

移除 Transfer-Encoding Chunk Received 事件的监听函数

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/request/RequestTask.offChunkReceived.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | Transfer-Encoding Chunk Received 事件的回调函数 |

## 参数

### onHeadersReceived

#### Callback

HTTP Response Header 事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

#### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| header | `TaroGeneral.IAnyObject` | 开发者服务器返回的 HTTP Response Header |

### onChunkReceived

#### Callback

Transfer-Encoding Chunk Received 事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

#### CallbackResult

开发者服务器每次返回新 chunk 时的 Response

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | `ArrayBuffer` | 返回的chunk buffer |

## 示例代码

### 示例 1

回调函数(Callback)用法：

```tsx
const requestTask = Taro.request({
  url: 'test.php', //仅为示例，并非真实的接口地址
  data: {
    x: '' ,
    y: ''
  },
  header: {
    'content-type': 'application/json' // 默认值
  },
  success: function (res) {
    console.log(res.data)
  }
})
requestTask.abort()
```

### 示例 2

Promise 用法：

```tsx
const requestTask = Taro.request({
  url: 'test.php', //仅为示例，并非真实的接口地址
  data: {
    x: '' ,
    y: ''
  },
  header: {
    'content-type': 'application/json' // 默认值
  },
  success: function (res) {
    console.log(res.data)
  }
})
requestTask.then(res => {
  console.log(res.data)
})
requestTask.abort()
```

### 示例 3

async/await 用法：

```tsx
const requestTask = Taro.request(params)
const res = await requestTask
requestTask.abort()
```

## API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| RequestTask | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| RequestTask.abort | ✔️ |  |  | ✔️ |  |  |  |  | ✔️ | ✔️ |
| RequestTask.onHeadersReceived | ✔️ |  |  |  |  |  |  |  | ✔️ | ✔️ |
| RequestTask.offHeadersReceived | ✔️ |  |  |  |  |  |  |  | ✔️ | ✔️ |
| RequestTask.onChunkReceived | ✔️ |  |  |  |  |  |  |  |  |  |
| RequestTask.offChunkReceived | ✔️ |  |  |  |  |  |  |  |  |  |
</file>

<file path="docs/apis/network/tcp/createTCPSocket.md">
---
title: Taro.createTCPSocket()
sidebar_label: createTCPSocket
---

创建一个 TCP Socket 实例。使用前请注意阅读[相关说明](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html)。

**连接限制**

- 允许与局域网内的非本机 IP 通信
- 允许与配置过的服务器域名通信，详见[相关说明](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html)
- 禁止与以下端口号连接：1024 以下 1099 1433 1521 1719 1720 1723 2049 2375 3128 3306 3389 3659 4045 5060 5061 5432 5984 6379 6000 6566 7001 7002 8000-8100 8443 8888 9200 9300 10051 10080 11211 27017 27018 27019
- 每 5 分钟内最多创建 20 个 TCPSocket

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/tcp/wx.createTCPSocket.html)

## 类型

```tsx
() => TCPSocket
```
</file>

<file path="docs/apis/network/tcp/TCPSocket.md">
---
title: TCPSocket
sidebar_label: TCPSocket
---

一个 TCP Socket 实例，默认使用 IPv4 协议

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/tcp/TCPSocket.html)

## 方法

### connect

在给定的套接字上启动连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/tcp/TCPSocket.connect.html)

```tsx
(option: Option) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

#### 示例代码

```tsx
const tcp = Taro.createTCPSocket()
tcp.connect({ address: '192.168.193.2', port: 8848 })
```

### write

在 socket 上发送数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/tcp/TCPSocket.write.html)

```tsx
(data: string | ArrayBuffer) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | string or ArrayBuffer | 要发送的数据 |

#### 示例代码

```tsx
const tcp = Taro.createTCPSocket()
tcp.write('hello, how are you')
```

### close

关闭连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/tcp/TCPSocket.close.html)

```tsx
() => void
```

#### 示例代码

```tsx
const tcp = Taro.createTCPSocket()
tcp.close()
```

### onClose

监听关闭事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/tcp/TCPSocket.onClose.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 当一个 socket 完全关闭就发出该事件的回调函数 |

### offClose

取消监听当一个 socket 完全关闭就发出该事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/tcp/TCPSocket.offClose.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 当一个 socket 完全关闭就发出该事件的回调函数 |

### onConnect

监听当一个 socket 连接成功建立的时候触发该事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/tcp/TCPSocket.onConnect.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 当一个 socket 连接成功建立的时候触发该事件的回调函数 |

### offConnect

取消监听当一个 socket 连接成功建立的时候触发该事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/tcp/TCPSocket.offConnect.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 当一个 socket 连接成功建立的时候触发该事件的回调函数 |

### onError

监听当错误发生时触发

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/tcp/TCPSocket.onError.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 监听当错误发生时触发的回调函数 |

### offError

取消监听当错误发生时触发

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/tcp/TCPSocket.offError.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 监听当错误发生时触发的回调函数 |

### onMessage

监听当接收到数据的时触发该事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/tcp/TCPSocket.onMessage.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 当接收到数据的时触发该事件的回调函数 |

### offMessage

取消监听当接收到数据的时触发该事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/tcp/TCPSocket.offMessage.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 当接收到数据的时触发该事件的回调函数 |

## 参数

### connect

#### Option

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| address | `string` | 套接字要连接的地址 |
| port | `number` | 套接字要连接的端口 |

### onClose

#### Callback

当一个 socket 完全关闭就发出该事件的回调函数

```tsx
(args: unknown[]) => void
```

| 参数 | 类型 |
| --- | --- |
| args | `unknown[]` |

### onConnect

#### Callback

当一个 socket 连接成功建立的时候触发该事件的回调函数

```tsx
(args: unknown[]) => void
```

| 参数 | 类型 |
| --- | --- |
| args | `unknown[]` |

### onError

#### Callback

监听当错误发生时触发的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

#### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |

### onMessage

#### Callback

当接收到数据的时触发该事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

#### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| message | `ArrayBuffer` | 收到的消息 |
| remoteInfo | `RemoteInfo` | 发送端地址信息 |
| localInfo | `LocalInfo` | 接收端地址信息 |

#### RemoteInfo

发送端地址信息

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| address | `string` | 发送消息的 socket 的地址 |
| family | `string` | 使用的协议族，为 IPv4 或者 IPv6 |
| port | `number` | 端口号 |
| size | `number` | message 的大小，单位：字节 |

#### LocalInfo

接收端地址信息

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| address | `string` | 接收消息的 socket 的地址 |
| family | `string` | 使用的协议族，为 IPv4 或者 IPv6 |
| port | `number` | 端口号 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| TCPSocket | ✔️ |  |  |  |  |
| TCPSocket.connect | ✔️ |  |  |  |  |
| TCPSocket.write | ✔️ |  |  |  |  |
| TCPSocket.close | ✔️ |  |  |  |  |
| TCPSocket.onClose | ✔️ |  |  |  |  |
| TCPSocket.offClose | ✔️ |  |  |  |  |
| TCPSocket.onConnect | ✔️ |  |  |  |  |
| TCPSocket.offConnect | ✔️ |  |  |  |  |
| TCPSocket.onError | ✔️ |  |  |  |  |
| TCPSocket.offError | ✔️ |  |  |  |  |
| TCPSocket.onMessage | ✔️ |  |  |  |  |
| TCPSocket.offMessage | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/network/udp/createUDPSocket.md">
---
title: Taro.createUDPSocket()
sidebar_label: createUDPSocket
---

创建一个 UDP Socket 实例。使用前请注意阅读[相关说明](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/wx.createUDPSocket.html)

## 类型

```tsx
() => UDPSocket
```
</file>

<file path="docs/apis/network/udp/UDPSocket.md">
---
title: UDPSocket
sidebar_label: UDPSocket
---

一个 UDP Socket 实例，默认使用 IPv4 协议。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.html)

## 方法

### bind

绑定一个系统随机分配的可用端口，或绑定一个指定的端口号

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.bind.html)

```tsx
(port: number) => number
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| port | `number` | 指定要绑定的端口号，不传则返回系统随机分配的可用端口 |

#### 示例代码

```tsx
const udp = Taro.createUDPSocket()
udp.close()
```

### setTTL

设置 IP_TTL 套接字选项，用于设置一个 IP 数据包传输时允许的最大跳步数

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.setTTL.html)

```tsx
(ttl: number) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| ttl | `number` | ttl 参数可以是 0 到 255 之间 |

#### 示例代码

```tsx
const udp = Taro.createUDPSocket()
udp.onListening(function () {
  udp.setTTL(64)
})
udp.bind()
```

### send

向指定的 IP 和 port 发送消息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.send.html)

```tsx
(option: Option) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

#### 示例代码

```tsx
const udp = Taro.createUDPSocket()
udp.bind()
udp.send({
  address: '192.168.193.2',
  port: 8848,
  message: 'hello, how are you'
})
```

### connect

预先连接到指定的 IP 和 port，需要配合 write 方法一起使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.connect.html)

```tsx
(option: Option) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### write

用法与 send 方法相同，如果没有预先调用 connect 则与 send 无差异（注意即使调用了 connect 也需要在本接口填入地址和端口参数）

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.write.html)

```tsx
() => void
```

### close

关闭 UDP Socket 实例，相当于销毁。 在关闭之后，UDP Socket 实例不能再发送消息，每次调用 `UDPSocket.send` 将会触发错误事件，并且 message 事件回调函数也不会再也执行。在 `UDPSocket` 实例被创建后将被 Native 强引用，保证其不被 GC。在 `UDPSocket.close` 后将解除对其的强引用，让 UDPSocket 实例遵从 GC。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.close.html)

```tsx
() => void
```

### onClose

监听关闭事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.onClose.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 关闭事件的回调函数 |

### offClose

取消监听关闭事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.offClose.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 关闭事件的回调函数 |

### onError

监听错误事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.onError.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 错误事件的回调函数 |

### offError

取消监听错误事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.offError.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 错误事件的回调函数 |

### onListening

监听开始监听数据包消息的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.onListening.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 监听开始监听数据包消息的事件 |

### offListening

取消监听开始监听数据包消息的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.offListening.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 监听开始监听数据包消息的事件 |

### onMessage

监听收到消息的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.onMessage.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 收到消息的事件的回调函数 |

### offMessage

取消监听收到消息的事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/udp/UDPSocket.offMessage.html)

```tsx
(callback: Callback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 收到消息的事件的回调函数 |

## 参数

### connect

#### Option

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| address | `string` | 要发消息的地址 |
| port | `number` | 要发送消息的端口号 |

### onClose

#### Callback

当一个 socket 完全关闭就发出该事件的回调函数

```tsx
(args: unknown[]) => void
```

| 参数 | 类型 |
| --- | --- |
| args | `unknown[]` |

### onError

#### Callback

错误事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

#### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |

### onListening

#### Callback

监听开始监听数据包消息的事件

```tsx
(args: unknown[]) => void
```

| 参数 | 类型 |
| --- | --- |
| args | `unknown[]` |

### onMessage

#### Callback

收到消息的事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

#### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| message | `ArrayBuffer` | 收到的消息 |
| remoteInfo | `RemoteInfo` | 发送端地址信息 |
| localInfo | `LocalInfo` | 接收端地址信息 |

#### RemoteInfo

发送端地址信息

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| address | `string` | 发送消息的 socket 的地址 |
| family | `string` | 使用的协议族，为 IPv4 或者 IPv6 |
| port | `number` | 端口号 |

#### LocalInfo

接收端地址信息

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| address | `string` | 接收消息的 socket 的地址 |
| family | `string` | 使用的协议族，为 IPv4 或者 IPv6 |
| port | `number` | 端口号 |
| size | `number` | message 的大小，单位：字节 |

### send

#### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| address | `string` |  | 是 | 要发消息的地址。在基础库 <= 2.9.3 版本必须是和本机同网段的 IP 地址，或安全域名列表内的域名地址；之后版本可以是任意 IP 和域名 |
| port | `number` |  | 是 | 要发送消息的端口号 |
| message | string or ArrayBuffer |  | 是 | 要发送的数据 |
| offset | `number` | `0` | 否 | 发送数据的偏移量，仅当 message 为 ArrayBuffer 类型时有效 |
| length | `number` | `message.byteLength` | 否 | 发送数据的长度，仅当 message 为 ArrayBuffer 类型时有效 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| UDPSocket | ✔️ |  |  |  |  |
| UDPSocket.bind | ✔️ |  |  |  |  |
| UDPSocket.setTTL | ✔️ |  |  |  |  |
| UDPSocket.send | ✔️ |  |  |  |  |
| UDPSocket.connect | ✔️ |  |  |  |  |
| UDPSocket.write | ✔️ |  |  |  |  |
| UDPSocket.close | ✔️ |  |  |  |  |
| UDPSocket.onClose | ✔️ |  |  |  |  |
| UDPSocket.offClose | ✔️ |  |  |  |  |
| UDPSocket.onError | ✔️ |  |  |  |  |
| UDPSocket.offError | ✔️ |  |  |  |  |
| UDPSocket.onListening | ✔️ |  |  |  |  |
| UDPSocket.offListening | ✔️ |  |  |  |  |
| UDPSocket.onMessage | ✔️ |  |  |  |  |
| UDPSocket.offMessage | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/network/upload/uploadFile.md">
---
title: Taro.uploadFile(option)
sidebar_label: uploadFile
---

将本地资源上传到服务器。客户端发起一个 HTTPS POST 请求，其中 `content-type` 为 `multipart/form-data`。使用前请注意阅读[相关说明](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/wx.uploadFile.html)

## 类型

```tsx
(option: Option) => UploadTaskPromise
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| url | `string` |  | 是 | 开发者服务器地址 |
| filePath | `string` |  | 是 | 要上传文件资源的路径 |
| name | `string` |  | 是 | 文件对应的 key，开发者在服务端可以通过这个 key 获取文件的二进制内容 |
| header | `TaroGeneral.IAnyObject` |  | 否 | HTTP 请求 Header，Header 中不能设置 Referer |
| formData | `TaroGeneral.IAnyObject` |  | 否 | HTTP 请求中其他额外的 form data |
| timeout | `number` |  | 否 | 超时时间，单位为毫秒 |
| fileName | `string` |  | 否 | 上传的文件名<br />API 支持度: h5 |
| withCredentials | `boolean` | `true` | 否 | 是否应使用传出凭据 (cookie) 发送此请求<br />API 支持度: h5 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `string` | 是 | 开发者服务器返回的数据 |
| statusCode | `number` | 是 | 开发者服务器返回的 HTTP 状态码 |
| errMsg | `string` | 是 | 调用结果 |
| header | `TaroGeneral.IAnyObject` | 否 | 开发者服务器返回的 HTTP Response Header<br />API 支持度: weapp<br />weapp: 非官方文档标注属性 |
| cookies | `string[]` | 否 | cookies<br />API 支持度: weapp<br />weapp: 非官方文档标注属性 |

## 示例代码

### 示例 1

```tsx
Taro.chooseImage({
  success (res) {
    const tempFilePaths = res.tempFilePaths
    Taro.uploadFile({
      url: 'https://example.weixin.qq.com/upload', //仅为示例，非真实的接口地址
      filePath: tempFilePaths[0],
      name: 'file',
      formData: {
        'user': 'test'
      },
      success (res){
        const data = res.data
        //do something
      }
    })
  }
})
```

### 示例 2

```tsx
const uploadTask = Taro.uploadFile({
  url: 'https://example.weixin.qq.com/upload', //仅为示例，非真实的接口地址
  filePath: tempFilePaths[0],
  name: 'file',
  formData:{
    'user': 'test'
  },
  success: function (res){
    var data = res.data
    //do something
  }
})
uploadTask.progress((res) => {
  console.log('上传进度', res.progress)
  console.log('已经上传的数据长度', res.totalBytesSent)
  console.log('预期需要上传的数据总长度', res.totalBytesExpectedToSend)
})
uploadTask.abort() // 取消上传任务
```
</file>

<file path="docs/apis/network/upload/UploadTask.md">
---
title: UploadTask
sidebar_label: UploadTask
---

一个可以监听上传进度变化事件，以及取消上传任务的对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/UploadTask.html)

## 方法

### abort

中断上传任务

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/UploadTask.abort.html)

```tsx
() => void
```

### onProgressUpdate

监听上传进度变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/UploadTask.onProgressUpdate.html)

```tsx
(callback: OnProgressUpdateCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnProgressUpdateCallback` | 上传进度变化事件的回调函数 |

### offProgressUpdate

取消监听上传进度变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/UploadTask.offProgressUpdate.html)

```tsx
(callback: OnProgressUpdateCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnProgressUpdateCallback` | 上传进度变化事件的回调函数 |

### onHeadersReceived

监听 HTTP Response Header 事件。会比请求完成事件更早

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/UploadTask.onHeadersReceived.html)

```tsx
(callback: OnHeadersReceivedCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnHeadersReceivedCallback` | HTTP Response Header 事件的回调函数 |

### offHeadersReceived

取消监听 HTTP Response Header 事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/UploadTask.offHeadersReceived.html)

```tsx
(callback: OnHeadersReceivedCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnHeadersReceivedCallback` | HTTP Response Header 事件的回调函数 |

## 参数

### OnHeadersReceivedCallback

HTTP Response Header 事件的回调函数

```tsx
(result: OnHeadersReceivedCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnHeadersReceivedCallbackResult` |

### OnProgressUpdateCallback

上传进度变化事件的回调函数

```tsx
(result: OnProgressUpdateCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnProgressUpdateCallbackResult` |

### OnHeadersReceivedCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| header | `TaroGeneral.IAnyObject` | 开发者服务器返回的 HTTP Response Header |

### OnProgressUpdateCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| progress | `number` | 上传进度百分比 |
| totalBytesExpectedToSend | `number` | 预期需要上传的数据总长度，单位 Bytes |
| totalBytesSent | `number` | 已经上传的数据长度，单位 Bytes |

### UploadTaskPromise

## 示例代码

```tsx
const uploadTask = Taro.uploadFile({
  url: 'http://example.weixin.qq.com/upload', //仅为示例，非真实的接口地址
  filePath: tempFilePaths[0],
  name: 'file',
  formData:{
    'user': 'test'
  },
  success (res){
    const data = res.data
    //do something
  }
})

uploadTask.onProgressUpdate((res) => {
  console.log('上传进度', res.progress)
  console.log('已经上传的数据长度', res.totalBytesSent)
  console.log('预期需要上传的数据总长度', res.totalBytesExpectedToSend)
})

uploadTask.abort() // 取消上传任务
```

## API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| UploadTask | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| UploadTask.abort | ✔️ |  |  | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| UploadTask.onProgressUpdate | ✔️ |  |  | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| UploadTask.offProgressUpdate | ✔️ |  |  | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| UploadTask.onHeadersReceived | ✔️ |  |  |  | ✔️ |  |  | ✔️ | ✔️ |
| UploadTask.offHeadersReceived | ✔️ |  |  |  | ✔️ |  |  | ✔️ | ✔️ |
</file>

<file path="docs/apis/network/websocket/closeSocket.md">
---
title: Taro.closeSocket(option)
sidebar_label: closeSocket
---

关闭 WebSocket 连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/wx.closeSocket.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| code | `number` | 否 | 一个数字值表示关闭连接的状态号，表示连接被关闭的原因。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| reason | `string` | 否 | 一个可读的字符串，表示连接被关闭的原因。这个字符串必须是不长于 123 字节的 UTF-8 文本（不是字符）。 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.connectSocket({
  url: 'test.php'
})
//注意这里有时序问题，
//如果 Taro.connectSocket 还没回调 Taro.onSocketOpen，而先调用 Taro.closeSocket，那么就做不到关闭 WebSocket 的目的。
//必须在 WebSocket 打开期间调用 Taro.closeSocket 才能关闭。
Taro.onSocketOpen(function() {
  Taro.closeSocket()
})
Taro.onSocketClose(function(res) {
  console.log('WebSocket 已关闭！')
})
```
</file>

<file path="docs/apis/network/websocket/connectSocket.md">
---
title: Taro.connectSocket(option)
sidebar_label: connectSocket
---

创建一个 WebSocket 连接。使用前请注意阅读[相关说明](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html)。

**并发数**
- 1.7.0 及以上版本，最多可以同时存在 5 个 WebSocket 连接。
- 1.7.0 以下版本，一个小程序同时只能有一个 WebSocket 连接，如果当前已存在一个 WebSocket 连接，会自动关闭该连接，并重新创建一个 WebSocket 连接。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/wx.connectSocket.html)

## 类型

```tsx
(option: Option) => Promise<SocketTask>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| url | `string` | 是 | 开发者服务器 wss 接口地址 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| header | `TaroGeneral.IAnyObject` | 否 | HTTP Header，Header 中不能设置 Referer |
| protocols | `string[]` | 否 | 子协议数组 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| tcpNoDelay | `boolean` | 否 | 建立 TCP 连接的时候的 TCP_NODELAY 设置 |

## 示例代码

### 示例 1

```tsx
Taro.connectSocket({
  url: 'wss://example.qq.com',
  header:{
    'content-type': 'application/json'
  },
  protocols: ['protocol1']
})
```

### 示例 2

```tsx
Taro.connectSocket({
  url: 'ws://echo.websocket.org/echo',
  success: function () {
    console.log('connect success')
  }
}).then(task => {
  task.onOpen(function () {
    console.log('onOpen')
    task.send({ data: 'xxx' })
  })
  task.onMessage(function (msg) {
    console.log('onMessage: ', msg)
    task.close()
  })
  task.onError(function () {
    console.log('onError')
  })
  task.onClose(function (e) {
    console.log('onClose: ', e)
  })
})
```
</file>

<file path="docs/apis/network/websocket/onSocketClose.md">
---
title: Taro.onSocketClose(callback)
sidebar_label: onSocketClose
---

监听 WebSocket 连接关闭事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/wx.onSocketClose.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | WebSocket 连接关闭事件的回调函数 |

### Callback

WebSocket 连接关闭事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| code | `number` | 一个数字值表示关闭连接的状态号，表示连接被关闭的原因。 |
| reason | `string` | 一个可读的字符串，表示连接被关闭的原因。 |

## 示例代码

```tsx
Taro.connectSocket({
  url: 'test.php'
})
//注意这里有时序问题，
//如果 Taro.connectSocket 还没回调 Taro.onSocketOpen，而先调用 Taro.closeSocket，那么就做不到关闭 WebSocket 的目的。
//必须在 WebSocket 打开期间调用 Taro.closeSocket 才能关闭。
Taro.onSocketOpen(function () {
  Taro.closeSocket()
})
Taro.onSocketClose(function (res) {
  console.log('WebSocket 已关闭！')
})
```
</file>

<file path="docs/apis/network/websocket/onSocketError.md">
---
title: Taro.onSocketError(callback)
sidebar_label: onSocketError
---

监听 WebSocket 错误事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/wx.onSocketError.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | WebSocket 错误事件的回调函数 |

### Callback

WebSocket 错误事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |

## 示例代码

```tsx
Taro.connectSocket({
  url: 'test.php'
})
Taro.onSocketOpen(function (res){
  console.log('WebSocket连接已打开！')
})
Taro.onSocketError(function (res){
  console.log('WebSocket连接打开失败，请检查！')
})
```
</file>

<file path="docs/apis/network/websocket/onSocketMessage.md">
---
title: Taro.onSocketMessage(callback)
sidebar_label: onSocketMessage
---

监听 WebSocket 接受到服务器的消息事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/wx.onSocketMessage.html)

## 类型

```tsx
<T = any>(callback: Callback<T>) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `T` | WebSocket 接受到服务器的消息事件的回调函数 |

### Callback

WebSocket 接受到服务器的消息事件的回调函数

```tsx
(result: CallbackResult<T>) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult<T>` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | `T` | 服务器返回的消息 |

## 示例代码

```tsx
Taro.connectSocket({
  url: 'test.php'
})
Taro.onSocketMessage(function (res) {
  console.log('收到服务器内容：' + res.data)
})
```
</file>

<file path="docs/apis/network/websocket/onSocketOpen.md">
---
title: Taro.onSocketOpen(callback)
sidebar_label: onSocketOpen
---

监听 WebSocket 连接打开事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/wx.onSocketOpen.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | WebSocket 连接打开事件的回调函数 |

### Callback

WebSocket 连接打开事件的回调函数

```tsx
(result: OpenCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OpenCallbackResult` |

### OpenCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| header | `TaroGeneral.IAnyObject` | 连接成功的 HTTP 响应 Header |

## 示例代码

```tsx
Taro.connectSocket({
  url: 'test.php'
})
Taro.onSocketOpen(function (res) {
  console.log('WebSocket连接已打开！')
})
```
</file>

<file path="docs/apis/network/websocket/sendSocketMessage.md">
---
title: Taro.sendSocketMessage(option)
sidebar_label: sendSocketMessage
---

通过 WebSocket 连接发送数据。需要先 Taro.connectSocket，并在 Taro.onSocketOpen 回调之后才能发送。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/wx.sendSocketMessage.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | string or ArrayBuffer | 是 | 需要发送的内容 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
let socketOpen = false
const socketMsgQueue = []
Taro.connectSocket({
  url: 'test.php'
})
Taro.onSocketOpen(function(res) {
  socketOpen = true
  for (let i = 0; i < socketMsgQueue.length; i++){
    sendSocketMessage(socketMsgQueue[i])
  }
  socketMsgQueue = []
})
function sendSocketMessage(msg) {
  if (socketOpen) {
    Taro.sendSocketMessage({
      data:msg
    })
  } else {
    socketMsgQueue.push(msg)
  }
}
```
</file>

<file path="docs/apis/network/websocket/SocketTask.md">
---
title: SocketTask
sidebar_label: SocketTask
---

WebSocket 任务，可通过 [Taro.connectSocket()](/docs/apis/network/websocket/SocketTask) 接口创建返回。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/SocketTask.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| socketTaskId | `number` | websocket 当前的连接 ID。 |
| readyState | `number` | websocket 当前的连接状态。 |
| errMsg | `string` | websocket 接口调用结果。 |
| CONNECTING | `number` | websocket 状态值：连接中。 |
| OPEN | `number` | websocket 状态值：已连接。 |
| CLOSING | `number` | websocket 状态值：关闭中。 |
| CLOSED | `number` | websocket 状态值：已关闭。 |
| ws | `WebSocket` | 浏览器 websocket 实例。（h5 端独有） |

### send

通过 WebSocket 连接发送数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/SocketTask.send.html)

```tsx
(option: SendOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `SendOption` |

### close

关闭 WebSocket 连接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/SocketTask.close.html)

```tsx
(option: CloseOption) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `CloseOption` |

### onOpen

监听 WebSocket 连接打开事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/SocketTask.onOpen.html)

```tsx
(callback: OnOpenCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnOpenCallback` | WebSocket 连接打开事件的回调函数 |

### onClose

监听 WebSocket 连接关闭事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/SocketTask.onClose.html)

```tsx
(callback: OnCloseCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnCloseCallback` | WebSocket 连接关闭事件的回调函数 |

### onError

监听 WebSocket 错误事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/SocketTask.onError.html)

```tsx
(callback: OnErrorCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnErrorCallback` | WebSocket 错误事件的回调函数 |

### onMessage

监听 WebSocket 接受到服务器的消息事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/SocketTask.onMessage.html)

```tsx
<T = any>(callback: OnMessageCallback<T>) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `T` | WebSocket 接受到服务器的消息事件的回调函数 |

## 参数

### CloseOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| code | `number` | 否 | 一个数字值表示关闭连接的状态号，表示连接被关闭的原因。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| reason | `string` | 否 | 一个可读的字符串，表示连接被关闭的原因。这个字符串必须是不长于 123 字节的 UTF-8 文本（不是字符）。 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### OnCloseCallback

WebSocket 连接关闭事件的回调函数

```tsx
(result: OnCloseCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnCloseCallbackResult` |

### OnCloseCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| code | `number` | 一个数字值表示关闭连接的状态号，表示连接被关闭的原因。 |
| reason | `string` | 一个可读的字符串，表示连接被关闭的原因。 |

### OnErrorCallback

WebSocket 错误事件的回调函数

```tsx
(result: OnErrorCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnErrorCallbackResult` |

### OnErrorCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |

### OnMessageCallback

WebSocket 接受到服务器的消息事件的回调函数

```tsx
(result: OnMessageCallbackResult<T>) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnMessageCallbackResult<T>` |

### OnMessageCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | `T` | 服务器返回的消息 |

### OnOpenCallback

WebSocket 连接打开事件的回调函数

```tsx
(result: OnOpenCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnOpenCallbackResult` |

### OnOpenCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| header | `TaroGeneral.IAnyObject` | 连接成功的 HTTP 响应 Header |

### SendOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | string or ArrayBuffer | 是 | 需要发送的内容 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| SocketTask | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |  | ✔️ | ✔️ |
| SocketTask.send | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| SocketTask.close | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| SocketTask.onOpen | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| SocketTask.onClose | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| SocketTask.onError | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| SocketTask.onMessage | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
</file>

<file path="docs/apis/open-api/account/getAccountInfoSync.md">
---
title: Taro.getAccountInfoSync()
sidebar_label: getAccountInfoSync
---

获取当前帐号信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/account-info/wx.getAccountInfoSync.html)

## 类型

```tsx
() => AccountInfo
```

## 参数

### AccountInfo

帐号信息

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| miniProgram | `MiniProgram` | 小程序帐号信息 |
| plugin | `Plugin` | 插件帐号信息（仅在插件中调用时包含这一项） |

### MiniProgram

小程序帐号信息

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| appId | `string` | 小程序 appId |
| envVersion | "develop" or "trial" or "release" | 小程序版本<br />since: 2.10.0 |
| version | `string` | 线上小程序版本号<br />since: 2.10.2 |

### Plugin

插件帐号信息（仅在插件中调用时包含这一项）

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| appId | `string` | 插件 appId |
| version | `string` | 插件版本号 |

## 示例代码

```tsx
const accountInfo = Taro.getAccountInfoSync();

console.log(accountInfo.miniProgram.appId) // 小程序 appId
console.log(accountInfo.plugin.appId) // 插件 appId
console.log(accountInfo.plugin.version) // 插件版本号， 'a.b.c' 这样的形式
```
</file>

<file path="docs/apis/open-api/address/chooseAddress.md">
---
title: Taro.chooseAddress(option)
sidebar_label: chooseAddress
---

获取用户收货地址。调起用户编辑收货地址原生界面，并在编辑完成后返回用户选择的地址。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/address/wx.chooseAddress.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: SuccessCallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| userName | `string` | 收货人姓名 |
| postalCode | `string` | 邮编<br />API 支持度: weapp, qq |
| provinceName | `string` | 国标收货地址第一级地址 |
| cityName | `string` | 国标收货地址第二级地址 |
| countyName | `string` | 国标收货地址第三级地址 |
| streetName | `string` | 国标收货地址第四级地址<br />API 支持度: weapp, qq |
| detailInfo | `string` | 详细收货地址信息 |
| detailInfoNew | `string` | 新选择器详细收货地址信息<br />API 支持度: weapp, qq |
| nationalCode | `string` | 收货地址国家码<br />API 支持度: weapp, qq |
| telNumber | `string` | 收货人手机号码 |

## 示例代码

```tsx
Taro.chooseAddress({
  success: function (res) {
    console.log(res.userName)
    console.log(res.postalCode)
    console.log(res.provinceName)
    console.log(res.cityName)
    console.log(res.countyName)
    console.log(res.detailInfo)
    console.log(res.nationalCode)
    console.log(res.telNumber)
  }
})
```
</file>

<file path="docs/apis/open-api/authorize/authorize.md">
---
title: Taro.authorize(option)
sidebar_label: authorize
---

提前向用户发起授权请求。调用后会立刻弹窗询问用户是否同意授权小程序使用某项功能或获取用户的某些数据，但不会实际调用对应接口。如果用户之前已经同意授权，则不会出现弹窗，直接返回成功。更多用法详见 [用户授权](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/authorize/wx.authorize.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| scope | `string` | 是 | 需要获取权限的 scope，详见 [scope 列表](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html#scope-%E5%88%97%E8%A1%A8) |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
// 可以通过 Taro.getSetting 先查询一下用户是否授权了 "scope.record" 这个 scope
Taro.getSetting({
  success: function (res) {
    if (!res.authSetting['scope.record']) {
      Taro.authorize({
        scope: 'scope.record',
        success: function () {
          // 用户已经同意小程序使用录音功能，后续调用 Taro.startRecord 接口不会弹窗询问
          Taro.startRecord()
        }
      })
    }
  }
})
```
</file>

<file path="docs/apis/open-api/authorize/authorizeForMiniProgram.md">
---
title: Taro.authorizeForMiniProgram(option)
sidebar_label: authorizeForMiniProgram
---

**仅小程序插件中能调用该接口**，用法同 [Taro.authorize](../authorize)。目前仅支持三种 scope

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/authorize/wx.authorizeForMiniProgram.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| scope | `string` | 是 | 需要获取权限的 scope，详见 [scope 列表](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html#scope-%E5%88%97%E8%A1%A8) |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### Scope

scope 合法值

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html#scope-%E5%88%97%E8%A1%A8)

## 示例代码

```tsx
// 可以通过 Taro.getSetting 先查询一下用户是否授权了 "scope.record" 这个 scope
Taro.authorizeForMiniProgram({
  scope: 'scope.record',
  success () {
    // 用户已经同意小程序使用录音功能，后续调用 Taro.startRecord 接口不会弹窗询问
    Taro.startRecord()
  }
})
```
</file>

<file path="docs/apis/open-api/card/addCard.md">
---
title: Taro.addCard(option)
sidebar_label: addCard
---

批量添加卡券。只有通过 [认证](https://developers.weixin.qq.com/miniprogram/product/renzheng.html) 的小程序或文化互动类目的小游戏才能使用。更多文档请参考 [微信卡券接口文档](https://mp.weixin.qq.com/cgi-bin/announce?action=getannouncement&key=1490190158&version=1&lang=zh_CN&platform=2)。

**cardExt 说明**
cardExt 是卡券的扩展参数，其值是一个 JSON 字符串。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/card/wx.addCard.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| cardList | `RequestInfo[]` | 是 | 需要添加的卡券列表 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### RequestInfo

需要添加的卡券列表

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| cardExt | `string` | 卡券的扩展参数。需将 CardExt 对象 JSON 序列化为**字符串**传入 |
| cardId | `string` | 卡券 ID |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| cardList | `AddCardResponseInfo[]` | 卡券添加结果列表 |
| errMsg | `string` | 调用结果 |

### AddCardResponseInfo

卡券添加结果列表

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| cardExt | `string` | 卡券的扩展参数，结构请参考下文 |
| cardId | `string` | 用户领取到卡券的 ID |
| code | `string` | 加密 code，为用户领取到卡券的code加密后的字符串，解密请参照：[code 解码接口](https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1499332673_Unm7V) |
| isSuccess | `boolean` | 是否成功 |

## 示例代码

```tsx
Taro.addCard({
  cardList: [
    {
      cardId: '',
      cardExt: '{"code": "", "openid": "", "timestamp": "", "signature":""}'
    }, {
      cardId: '',
      cardExt: '{"code": "", "openid": "", "timestamp": "", "signature":""}'
    }
  ],
  success: function (res) {
    console.log(res.cardList) // 卡券添加结果
  }
})
```
</file>

<file path="docs/apis/open-api/card/card.md">
---
title: 卡券
sidebar_label: 卡券
---

## Taro.addCard(OBJECT)

使用方式同 [`wx.addCard`](https://developers.weixin.qq.com/miniprogram/dev/api/wx.addCard.html)，支持 `Promise` 化使用。

**示例代码：**

```jsx
import Taro from '@tarojs/taro'

Taro.addCard(params).then(...)
```

## Taro.openCard(OBJECT)

使用方式同 [`wx.openCard`](https://developers.weixin.qq.com/miniprogram/dev/api/wx.openCard.html)，支持 `Promise` 化使用。

**示例代码：**

```jsx
import Taro from '@tarojs/taro'

Taro.openCard(params).then(...)
```

> API 支持度

| API | 微信小程序 | H5 | React Native |
| :-: | :-: | :-: | :-: |
| Taro.addCard | ✔️ |  |  |
| Taro.openCard | ✔️ |  |  |
</file>

<file path="docs/apis/open-api/card/openCard.md">
---
title: Taro.openCard(option)
sidebar_label: openCard
---

查看微信卡包中的卡券。只有通过 [认证](https://developers.weixin.qq.com/miniprogram/product/renzheng.html) 的小程序或文化互动类目的小游戏才能使用。更多文档请参考 [微信卡券接口文档](https://mp.weixin.qq.com/cgi-bin/announce?action=getannouncement&key=1490190158&version=1&lang=zh_CN&platform=2)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/card/wx.openCard.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| cardList | `RequestInfo[]` | 是 | 需要打开的卡券列表 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### RequestInfo

需要打开的卡券列表

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| cardId | `string` | 卡券 ID |
| code | `string` | 由 Taro.addCard 的返回对象中的加密 code 通过解密后得到，解密请参照：[code 解码接口](https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1499332673_Unm7V) |

## 示例代码

```tsx
Taro.openCard({
  cardList: [{
    cardId: '',
    code: ''
  }, {
    cardId: '',
    code: ''
  }],
  success: function (res) { }
})
```
</file>

<file path="docs/apis/open-api/channels/getChannelsLiveInfo.md">
---
title: Taro.getChannelsLiveInfo(option)
sidebar_label: getChannelsLiveInfo
---

获取视频号直播信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/channels/wx.getChannelsLiveInfo.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| finderUserName | `string` | 是 | 视频号 id，以“sph”开头的id，可在视频号助手获取 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| feedId | `string` | 是 | 直播 feedId |
| nonceId | `string` | 是 | 直播 nonceId |
| description | `string` | 是 | 直播主题 |
| status | `number` | 是 | 直播状态，2直播中，3直播结束 |
| headUrl | `string` | 是 | 视频号头像 |
| nickname | `string` | 是 | 视频号昵称 |
| replayStatus | `number` | 是 | 直播回放状态 |
| otherInfos | `string[]` | 否 | 除最近的一条直播外，其他的直播列表（注意：每次最多返回按时间戳增序排列的15个直播信息，其中时间最近的那个直播会在接口其他的返回参数中展示，其余的直播会在该字段中展示）。 |

### Status

| 参数 | 说明 |
| --- | --- |
| 2 | 直播中 |
| 3 | 直播结束 |

### ReplayStatus

| 参数 | 说明 |
| --- | --- |
| 0 | 未生成 |
| 1 | 已生成 |
| 3 | 生成中 |
| 6 | 已过期 |
</file>

<file path="docs/apis/open-api/channels/getChannelsLiveNoticeInfo.md">
---
title: Taro.getChannelsLiveNoticeInfo(option)
sidebar_label: getChannelsLiveNoticeInfo
---

获取视频号直播预告信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/channels/wx.getChannelsLiveNoticeInfo.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| finderUserName | `string` | 是 | 视频号 id，以“sph”开头的id，可在视频号助手获取 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| nonceId | `string` | 是 | 预告 nonceId |
| status | `number` | 是 | 预告状态：0可用 1取消 2已用 |
| startTime | `string` | 是 | 开始时间 |
| headUrl | `string` | 是 | 直播封面 |
| nickname | `string` | 是 | 视频号昵称 |
| reservable | `boolean` | 是 | 是否可预约 |
| otherInfos | `string[]` | 否 | 除最近的一条预告信息外，其他的预告信息列表（注意：每次最多返回按时间戳增序排列的15个预告信息，其中时间最近的那个预告信息会在接口其他的返回参数中展示，其余的预告信息会在该字段中展示）。 |

### Status

| 参数 | 说明 |
| --- | --- |
| 0 | 可用 |
| 1 | 取消 |
| 2 | 已用 |
</file>

<file path="docs/apis/open-api/channels/getChannelsShareKey.md">
---
title: Taro.getChannelsShareKey(option)
sidebar_label: getChannelsShareKey
---

获取视频号直播卡片/视频卡片的分享来源，
仅当卡片携带了分享信息、同时用户已授权该小程序获取视频号分享信息且启动场景值为 1177、1184、1195、1208 时可用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/channels/wx.getChannelsShareKey.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| sharerOpenId | `string` | 分享者 openid |
| promoter | `Promoter` | 推广员 |

### Promoter

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| finderNickname | `string` | 推广员昵称 |
| promoterId | `string` | 推广员id |
| promoterOpenId | `string` | 推广员openid |
</file>

<file path="docs/apis/open-api/channels/openChannelsActivity.md">
---
title: Taro.openChannelsActivity(option)
sidebar_label: openChannelsActivity
---

打开视频号视频

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/channels/wx.openChannelsActivity.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| finderUserName | `string` | 是 | 视频号 id，以“sph”开头的id，可在视频号助手获取 |
| feedId | `string` | 是 | 视频 feedId |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/open-api/channels/openChannelsEvent.md">
---
title: Taro.openChannelsEvent(option)
sidebar_label: openChannelsEvent
---

打开视频号活动页

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/channels/wx.openChannelsEvent.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| finderUserName | `string` | 是 | 视频号 id，以“sph”开头的id，可在视频号助手获取 |
| eventId | `string` | 是 | 活动 id |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/open-api/channels/openChannelsLive.md">
---
title: Taro.openChannelsLive(option)
sidebar_label: openChannelsLive
---

打开视频号直播

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/channels/wx.openChannelsLive.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| finderUserName | `string` | 是 | 视频号 id，以“sph”开头的id，可在视频号助手获取 |
| feedId | `string` | 否 | 直播 feedId，通过 getChannelsLiveInfo 接口获取 |
| nonceId | `string` | 否 | 直播 nonceId，通过 getChannelsLiveInfo 接口获取 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/open-api/channels/openChannelsUserProfile.md">
---
title: Taro.openChannelsUserProfile(option)
sidebar_label: openChannelsUserProfile
---

打开视频号主页

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/channels/wx.openChannelsUserProfile.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| finderUserName | `string` | 是 | 视频号 id |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/open-api/channels/reserveChannelsLive.md">
---
title: Taro.reserveChannelsLive(option)
sidebar_label: reserveChannelsLive
---

预约视频号直播

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/channels/wx.reserveChannelsLive.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| noticeId | `string` | 预告 id，通过 [getChannelsLiveNoticeInfo](./getChannelsLiveNoticeInfo) 接口获取 |
</file>

<file path="docs/apis/open-api/customer-service/openCustomerServiceChat.md">
---
title: Taro.openCustomerServiceChat(option)
sidebar_label: openCustomerServiceChat
---

打开微信客服。了解更多信息，可以参考微信客服介绍：https://work.weixin.qq.com/kf/。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/service-chat/wx.openCustomerServiceChat.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### ExtInfo

| 参数 | 类型 |
| --- | --- |
| url | `string` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| extInfo | `ExtInfo` | 是 | 客服信息 |
| corpId | `string` | 是 | 企业ID |
| showMessageCard | `boolean` | 否 | 是否发送小程序气泡消息，默认值：false |
| sendMessageTitle | `string` | 否 | 气泡消息标题 |
| sendMessagePath | `string` | 否 | 气泡消息小程序路径 |
| sendMessageImg | `string` | 否 | 气泡消息图片 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.openCustomerServiceChat({
  extInfo: {url: ''},
  corpId: '',
  success: function (res) { }
})
```
</file>

<file path="docs/apis/open-api/device-voip/getDeviceVoIPList.md">
---
title: Taro.getDeviceVoIPList(option)
sidebar_label: getDeviceVoIPList
---

查询当前用户授权的音视频通话设备（组）信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/device-voip/wx.getDeviceVoIPList.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 |
| --- | --- |
| list | `DeviceVoIP[]` |

### DeviceVoIP

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| sn | `string` | 设备唯一序列号。（仅单台设备时） |
| model_id | `string` | 设备型号 id。通过微信公众平台注册设备获得。（仅单台设备时） |
| group_id | `string` | 设备组的唯一标识 id（仅设备组时） |
| status | `number` | 设备（组）授权状态。0：未授权；1：已授权 |

## 示例代码

```tsx
Taro.getDeviceVoIPList({
  success(res) {
    console.log(res)
  },
  fail(res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/open-api/device-voip/requestDeviceVoIP.md">
---
title: Taro.requestDeviceVoIP(option)
sidebar_label: requestDeviceVoIP
---

请求用户授权与设备（组）间进行音视频通话

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/device-voip/wx.requestDeviceVoIP.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| sn | `string` | 是 | 设备唯一序列号。由厂商分配，长度不能超过128字节。字符只接受数字，大小写字母，下划线（_）和连字符（-） |
| snTicket | `string` | 是 | 设备票据，5分钟内有效 |
| modelId | `string` | 是 | 设备型号 id。通过微信公众平台注册设备获得。 |
| deviceName | `string` | 是 | 设备名称，将显示在授权弹窗内（长度不超过13）。授权框中「设备名字」= 「deviceName」 + 「modelId 对应设备型号」 |
| isGroup | `boolean` | 否 | 是否为授权设备组，默认 false |
| groupId | `string` | 是 | 设备组的唯一标识 id 。isGroup 为 true 时只需要传该参数，isGroup 为 false 时不需要传该参数，但需要传 sn、snTicket、modelId、deviceName 。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
// 授权单台设备
Taro.requestDeviceVoIP({
  sn: 'xxxx',
  snTicket: 'xxxxx',
  modelId: 'xxx',
  deviceName: 'xxx',
  success(res) {
    console.log(res)
  },
  fail(res) {
    console.log(res)
  }
})

// 批量授权（授权设备组）
Taro.requestDeviceVoIP({
  isGroup: true,
  groupId: '设备组 ID',
  success(res) {
    console.log(res)
  },
  fail(res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/open-api/facial/checkIsSupportFacialRecognition.md">
---
title: Taro.checkIsSupportFacialRecognition(option)
sidebar_label: checkIsSupportFacialRecognition
---

检查是否支持面部识别

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
(option?: Option) => Promise<CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| checkAliveType | `number` | 否 | 交互方式 |
| complete | `(res: CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |
| errCode | `number` | 错误码 |
</file>

<file path="docs/apis/open-api/facial/startFacialRecognitionVerify.md">
---
title: Taro.startFacialRecognitionVerify(option)
sidebar_label: startFacialRecognitionVerify
---

开始人脸识别认证

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
(option?: Option) => Promise<CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| name | `string` | 是 | 身份证名称 |
| idCardNumber | `string` | 是 | 身份证名称 |
| checkAliveType | `number` | 否 | 交互方式 |
| complete | `(res: CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |
| errCode | `number` | 错误码 |
| verifyResult | `string` | 认证结果 |
</file>

<file path="docs/apis/open-api/facial/startFacialRecognitionVerifyAndUploadVideo.md">
---
title: Taro.startFacialRecognitionVerifyAndUploadVideo(option)
sidebar_label: startFacialRecognitionVerifyAndUploadVideo
---

开始人脸识别认证并上传认证视频

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
(option?: Option) => Promise<CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| name | `string` | 是 | 身份证名称 |
| idCardNumber | `string` | 是 | 身份证名称 |
| checkAliveType | `number` | 否 | 交互方式 |
| complete | `(res: CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |
| errCode | `number` | 错误码 |
| verifyResult | `string` | 认证结果 |
</file>

<file path="docs/apis/open-api/favorites/addFileToFavorites.md">
---
title: Taro.addFileToFavorites(option)
sidebar_label: addFileToFavorites
---

收藏文件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/favorites/wx.addFileToFavorites.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 要收藏的文件地址，必须为本地路径或临时路径 |
| fileName | `string` | 否 | 自定义文件名，若留空则使用filePath中的文件名 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

### 示例 1

```tsx
// callback 写法
Taro.downloadFile({
  url: URL, // 下载url
  success (res) {
    // 下载完成后收藏
    Taro.addFileToFavorites({
      filePath: res.tempFilePath,
      success() {},
      fail: console.error,
    })
  },
  fail: console.error,
})
```

### 示例 2

```tsx
// async await 写法
const { tempFilePath } = await Taro.downloadFile({
  url: URL, // 下载url
})
// 下载完成后收藏
await Taro.addFileToFavorites({
  filePath: res.tempFilePath,
})
```
</file>

<file path="docs/apis/open-api/favorites/addVideoToFavorites.md">
---
title: Taro.addVideoToFavorites(option)
sidebar_label: addVideoToFavorites
---

收藏视频

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/favorites/wx.addVideoToFavorites.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| videoPath | `string` | 是 | 要收藏的视频地址，必须为本地路径或临时路径 |
| thumbPath | `string` | 否 | 缩略图路径，若留空则使用视频首帧 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

### 示例 1

```tsx
// callback 写法
Taro.downloadFile({
  url: URL, // 下载url
  success (res) {
    // 下载完成后收藏
    Taro.addVideoToFavorites({
      videoPath: res.tempFilePath,
      success() {},
      fail: console.error,
    })
  },
  fail: console.error,
})
```

### 示例 2

```tsx
// async await 写法
const { tempFilePath } = await Taro.downloadFile({
  url: URL, // 下载url
})
// 下载完成后收藏
await Taro.addVideoToFavorites({
  videoPath: res.tempFilePath,
})
```
</file>

<file path="docs/apis/open-api/group/getGroupEnterInfo.md">
---
title: Taro.getGroupEnterInfo(option)
sidebar_label: getGroupEnterInfo
---

获取微信群聊场景下的小程序启动信息。群聊场景包括群聊小程序消息卡片、群待办、群工具。可用于获取当前群的 opengid。

**Tips**
- 如需要展示群名称，小程序可以使用[开放数据组件](/docs/components/open/open-data)
- 小游戏可以通过 `Taro.getGroupInfo` 接口获取群名称

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/group/wx.getGroupEnterInfo.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| errMsg | `string` | 是 | 错误信息 |
| encryptedData | `string` | 是 | 包括敏感数据在内的完整转发信息的加密数据，详细见[加密数据解密算法](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html) |
| iv | `string` | 是 | 加密算法的初始向量，详细见[加密数据解密算法](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html) |
| cloudID | `string` | 否 | 敏感数据对应的云 ID，开通[云开发](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)的小程序才会返回，可通过云调用直接获取开放数据，详细见[云调用直接获取开放数据](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#method-cloud) |

## 示例代码

```tsx
Taro.getGroupEnterInfo({
  success(res) {
    // res
    {
      errMsg: 'getGroupEnterInfo:ok',
      encryptedData: '',
      iv: ''
    }
  },
  fail() { }
})
```

敏感数据有两种获取方式，一是使用 [加密数据解密算法](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95) 。 获取得到的开放数据为以下 json 结构（其中 opengid 为当前群的唯一标识）：

```json
{
  "opengid": "OPENGID"
}
```
</file>

<file path="docs/apis/open-api/invoice/chooseInvoice.md">
---
title: Taro.chooseInvoice(option)
sidebar_label: chooseInvoice
---

选择用户已有的发票。

**通过 cardId 和 encryptCode 获得报销发票的信息**
请参考[微信电子发票文档](https://mp.weixin.qq.com/wiki?t=resource/res_main&id=21517918939oae3U)中，「查询报销发票信息」部分。
其中 `access_token` 的获取请参考[auth.getAccessToken](https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/access-token/auth.getAccessToken.html)文档

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/invoice/wx.chooseInvoice.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| invoiceInfo | `string` | 用户选中的发票信息，格式为一个 JSON 字符串，包含三个字段： card_id：所选发票卡券的 cardId，encrypt_code：所选发票卡券的加密 code，报销方可以通过 cardId 和 encryptCode 获得报销发票的信息，app_id： 发票方的 appId。 |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
Taro.chooseInvoice({
  success: function (res) {}
})
```
</file>

<file path="docs/apis/open-api/invoice/chooseInvoiceTitle.md">
---
title: Taro.chooseInvoiceTitle(option)
sidebar_label: chooseInvoiceTitle
---

选择用户的发票抬头。当前小程序必须关联一个公众号，且这个公众号是完成了[微信认证](https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1496554031_RD4xe)的，才能调用 chooseInvoiceTitle。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/invoice/wx.chooseInvoiceTitle.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| bankAccount | `string` | 银行账号 |
| bankName | `string` | 银行名称 |
| companyAddress | `string` | 单位地址 |
| errMsg | `string` | 错误信息 |
| taxNumber | `string` | 抬头税号 |
| telephone | `string` | 手机号码 |
| title | `string` | 抬头名称 |
| type | `keyof InvoiceType` | 抬头类型 |

### InvoiceType

抬头类型

| 参数 | 类型 |
| --- | --- |
| 0 | `"单位"` |
| 1 | `"个人"` |

## 示例代码

```tsx
Taro.chooseInvoiceTitle({
  success: function(res) {}
})
```
</file>

<file path="docs/apis/open-api/license-plate/chooseLicensePlate.md">
---
title: Taro.chooseLicensePlate(option)
sidebar_label: chooseLicensePlate
---

选择车牌号

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/license-plate/wx.chooseLicensePlate.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| plateNumber | `string` | 用户选择的车牌号 |
</file>

<file path="docs/apis/open-api/login/checkSession.md">
---
title: Taro.checkSession(option)
sidebar_label: checkSession
---

检查登录态是否过期。

通过 Taro.login 接口获得的用户登录态拥有一定的时效性。用户越久未使用小程序，用户登录态越有可能失效。反之如果用户一直在使用小程序，则用户登录态一直保持有效。具体时效逻辑由微信维护，对开发者透明。开发者只需要调用 Taro.checkSession 接口检测当前用户登录态是否有效。

登录态过期后开发者可以再调用 Taro.login 获取新的用户登录态。调用 Taro.checkSession 成功说明当前 session_key 未过期，调用失败说明 session_key 已过期。更多使用方法详见 [小程序登录](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.checkSession.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.checkSession({
  success: function () {
    //session_key 未过期，并且在本生命周期一直有效
  },
  fail: function () {
    // session_key 已经失效，需要重新执行登录流程
    Taro.login() //重新登录
  }
})
```
</file>

<file path="docs/apis/open-api/login/login.md">
---
title: Taro.login(option)
sidebar_label: login
---

调用接口获取登录凭证（code）。通过凭证进而换取用户登录态信息，包括用户的唯一标识（openid）及本次登录的会话密钥（session_key）等。用户数据的加解密通讯需要依赖会话密钥完成。更多使用方法详见 [小程序登录](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |
| timeout | `number` |  | 否 | 超时时间，单位ms |
| force | `boolean` | `true` | 否 | 未登录时, 是否强制调起登录框<br />API 支持度: tt |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| code | `string` | 是 | 用户登录凭证（有效期五分钟）。开发者需要在开发者服务器后台调用 [auth.code2Session](https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/login/auth.code2Session.html)，使用 code 换取 openid 和 session_key 等信息 |
| errMsg | `string` | 是 | 调用结果 |
| anonymousCode | `string` | 否 | 用于标识当前设备, 无论登录与否都会返回, 有效期 5 分钟。<br />API 支持度: tt |
| isLogin | `boolean` | 否 | 判断在当前 APP（头条、抖音等）是否处于登录状态。<br />API 支持度: tt |

## 示例代码

```tsx
Taro.login({
  success: function (res) {
    if (res.code) {
      //发起网络请求
      Taro.request({
        url: 'https://test.com/onLogin',
        data: {
          code: res.code
        }
      })
    } else {
      console.log('登录失败！' + res.errMsg)
    }
  }
})
```
</file>

<file path="docs/apis/open-api/login/pluginLogin.md">
---
title: Taro.pluginLogin(option)
sidebar_label: pluginLogin
---

**该接口仅在小程序插件中可调用**，调用接口获得插件用户标志凭证（code）。插件可以此凭证换取用于识别用户的标识 openpid。用户不同、宿主小程序不同或插件不同的情况下，该标识均不相同，即当且仅当同一个用户在同一个宿主小程序中使用同一个插件时，openpid 才会相同

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.pluginLogin.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| code | `string` | 用于换取 openpid 的凭证（有效期五分钟）。插件开发者可以用此 code 在开发者服务器后台调用 [auth.getPluginOpenPId](https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/user-info/auth.getPluginOpenPId.html) 换取 openpid。 |
</file>

<file path="docs/apis/open-api/my-miniprogram/checkIsAddedToMyMiniProgram.md">
---
title: Taro.checkIsAddedToMyMiniProgram(option)
sidebar_label: checkIsAddedToMyMiniProgram
---

检查小程序是否被添加至 「我的小程序」

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/my-miniprogram/wx.checkIsAddedToMyMiniProgram.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| added | `boolean` | 是否被添加至 「我的小程序」 |
</file>

<file path="docs/apis/open-api/privacy/getPrivacySetting.md">
---
title: Taro.getPrivacySetting(option)
sidebar_label: getPrivacySetting
---

查询隐私授权情况。隐私合规开发指南详情可见《小程序隐私协议开发指南》

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/privacy/wx.getPrivacySetting.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| needAuthorization | `boolean` | 是否需要用户授权隐私协议（如果开发者没有在[mp后台-设置-服务内容声明-用户隐私保护指引]中声明隐私收集类型则会返回false；如果开发者声明了隐私收集，且用户之前同意过隐私协议则会返回false；如果开发者声明了隐私收集，且用户还没同意过则返回true；如果用户之前同意过、但后来小程序又新增了隐私收集类型也会返回true） |
| privacyContractName | `string` | 隐私授权协议的名称 |
</file>

<file path="docs/apis/open-api/privacy/onNeedPrivacyAuthorization.md">
---
title: Taro.onNeedPrivacyAuthorization(listener)
sidebar_label: onNeedPrivacyAuthorization
---

监听隐私接口需要用户授权事件。当需要用户进行隐私授权时会触发。触发该事件时，开发者需要弹出隐私协议说明，并在用户同意或拒绝授权后调用回调接口 resolve 触发原隐私接口或组件继续执行。隐私合规开发指南详情可见《小程序隐私协议开发指南》

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/privacy/wx.onNeedPrivacyAuthorization.html)

## 类型

```tsx
(listener: Listener) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| listener | `Listener` |

### ResolveOption

resolve 是 onNeedPrivacyAuthorization 的回调参数，是一个接口函数。
当触发 needPrivacyAuthorization 事件时，触发该事件的隐私接口或组件会处于 pending 状态。
如果调用 resolve({ buttonId: 'disagree-btn'， event:'agree' })，则触发当前 needPrivacyAuthorization 事件的原隐私接口或组件会继续执行。其中 buttonId 为隐私同意授权按钮的id，为确保用户有同意的操作，基础库会检查对应的同意按钮是否被点击过。
如果调用 resolve({ event: 'disagree' })，则触发当前 needPrivacyAuthorization 事件的原隐私接口或组件会失败并返回 API:fail privacy permission is not authorized 的错误信息。
在调用 resolve({ event: 'agree'/'disagree' }) 之前，开发者可以调用 resolve({ event: 'exposureAuthorization' }) 把隐私弹窗曝光告知平台。

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| event | "exposureAuthorization" or "agree" or "disagree" | 是 | 用户操作类型 |
| buttonId | `string` | 否 | 同意授权按钮的id （仅event=agree时必填） |

### EventInfo

触发本次 onNeedPrivacyAuthorization 事件的关联信息

| 参数 | 类型 |
| --- | --- |
| referrer | `string` |

### Listener

隐私授权监听函数

```tsx
(resolve: (option: ResolveOption) => void,eventInfo: EventInfo) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| resolve | `(option: ResolveOption) => void` | 事件回调函数 |
| eventInfo | `EventInfo` | 关联事件信息 |
</file>

<file path="docs/apis/open-api/privacy/openPrivacyContract.md">
---
title: Taro.openPrivacyContract(option)
sidebar_label: openPrivacyContract
---

跳转至隐私协议页面。隐私合规开发指南详情可见《小程序隐私协议开发指南》

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/privacy/wx.openPrivacyContract.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.openPrivacyContract({
  success: () => {}, // 打开成功
  fail: () => {}, // 打开失败
  complete: () => {}
})
```
</file>

<file path="docs/apis/open-api/privacy/requirePrivacyAuthorize.md">
---
title: Taro.requirePrivacyAuthorize(option)
sidebar_label: requirePrivacyAuthorize
---

模拟隐私接口调用，并触发隐私弹窗逻辑。隐私合规开发指南详情可见《小程序隐私协议开发指南》

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/privacy/wx.requirePrivacyAuthorize.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/open-api/redpackage/showRedPackage.md">
---
title: Taro.showRedPackage(option)
sidebar_label: showRedPackage
---

拉取h5领取红包封面页。获取参考红包封面地址参考 [微信红包封面开发平台](https://cover.weixin.qq.com/cgi-bin/mmcover-bin/readtemplate?t=page/index#/doc?page=introduce)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/redpackage/wx.showRedPackage.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| url | `string` | 是 | 封面地址 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/open-api/settings/AuthSetting.md">
---
title: AuthSetting
sidebar_label: AuthSetting
---

用户授权设置信息，详情参考[权限](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html)

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html)

## 方法

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| scope.userInfo | `boolean` | 否 | 是否授权用户信息，对应接口 [Taro.getUserInfo](/docs/apis/open-api/user-info/getUserInfo) |
| scope.userLocation | `boolean` | 否 | 是否授权地理位置，对应接口 [Taro.getLocation](/docs/apis/location/getLocation), [Taro.chooseLocation](/docs/apis/location/chooseLocation) |
| scope.address | `boolean` | 否 | 是否授权通讯地址，对应接口 [Taro.chooseAddress](/docs/apis/open-api/address/chooseAddress) |
| scope.invoiceTitle | `boolean` | 否 | 是否授权发票抬头，对应接口 [Taro.chooseInvoiceTitle](/docs/apis/open-api/invoice/chooseInvoiceTitle) |
| scope.invoice | `boolean` | 否 | 是否授权获取发票，对应接口 [Taro.chooseInvoice](/docs/apis/open-api/invoice/chooseInvoice) |
| scope.werun | `boolean` | 否 | 是否授权微信运动步数，对应接口 [Taro.getWeRunData](/docs/apis/open-api/werun/getWeRunData) |
| scope.record | `boolean` | 否 | 是否授权录音功能，对应接口 [Taro.startRecord](/docs/apis/media/recorder/startRecord) |
| scope.writePhotosAlbum | `boolean` | 否 | 是否授权保存到相册 [Taro.saveImageToPhotosAlbum](/docs/apis/media/image/saveImageToPhotosAlbum), [Taro.saveVideoToPhotosAlbum](/docs/apis/media/video/saveVideoToPhotosAlbum) |
| scope.camera | `boolean` | 否 | 是否授权摄像头，对应 [camera](/docs/components/media/camera) 组件 |
| scope.bluetoothBackground | `boolean` | 否 | 是否授权小程序在后台运行蓝牙，对应接口 [Taro.openBluetoothAdapterBackground](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/setting/(wx.openBluetoothAdapterBackground).html) |
</file>

<file path="docs/apis/open-api/settings/getSetting.md">
---
title: Taro.getSetting(option)
sidebar_label: getSetting
---

获取用户的当前设置。**返回值中只会出现小程序已经向用户请求过的[权限](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html)**。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/setting/wx.getSetting.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| withSubscriptions | `boolean` | 否 | 是否同时获取用户订阅消息的订阅状态，默认不获取。注意：withSubscriptions 只返回用户勾选过订阅面板中的“总是保持以上选择，不再询问”的订阅消息。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| authSetting | `AuthSetting` | 用户授权结果 |
| subscriptionsSetting | `SubscriptionsSetting` | 用户订阅消息设置，接口参数 withSubscriptions 值为 true 时才会返回。 |
| miniprogramAuthSetting | `AuthSetting` | 在插件中调用时，当前宿主小程序的用户授权结果 |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
Taro.getSetting({
  success: function (res) {
    console.log(res.authSetting)
    // res.authSetting = {
    //   "scope.userInfo": true,
    //   "scope.userLocation": true
    // }
  }
})
```
</file>

<file path="docs/apis/open-api/settings/openSetting.md">
---
title: Taro.openSetting(option)
sidebar_label: openSetting
---

调起客户端小程序设置界面，返回用户设置的操作结果。**设置界面只会出现小程序已经向用户请求过的[权限](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html)**。

注意：[2.3.0](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) 版本开始，用户发生点击行为后，才可以跳转打开设置页，管理授权信息。[详情](https://developers.weixin.qq.com/community/develop/doc/000cea2305cc5047af5733de751008)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/setting/wx.openSetting.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| withSubscriptions | `boolean` | `false` | 否 | 是否同时获取用户订阅消息的订阅状态，默认不获取。注意：withSubscriptions 只返回用户勾选过订阅面板中的“总是保持以上选择，不再询问”的订阅消息。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| authSetting | `AuthSetting` | 用户授权结果 |
| subscriptionsSetting | `SubscriptionsSetting` | 用户订阅消息设置，接口参数 withSubscriptions 值为 true 时才会返回。 |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
Taro.openSetting({
  success: function (res) {
    console.log(res.authSetting)
    // res.authSetting = {
    //   "scope.userInfo": true,
    //   "scope.userLocation": true
    // }
  }
})
```
</file>

<file path="docs/apis/open-api/settings/SubscriptionsSetting.md">
---
title: SubscriptionsSetting
sidebar_label: SubscriptionsSetting
---

订阅消息设置

注意事项
- itemSettings 只返回用户勾选过订阅面板中的“总是保持以上选择，不再询问”的订阅消息。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/setting/SubscriptionsSetting.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| mainSwitch | `boolean` | 订阅消息总开关，true 为开启，false 为关闭 |
| itemSettings | `{ [TEMPLATE_ID: string]: string; }` | 每一项订阅消息的订阅状态。itemSettings对象的键为一次性订阅消息的模板id或系统订阅消息的类型<br />- 一次性订阅消息使用方法详见 [Taro.requestSubscribeMessage](/docs/apis/open-api/subscribe-message/requestSubscribeMessage)<br />- 永久订阅消息（仅小游戏可用）使用方法详见 [Taro.requestSubscribeSystemMessage](https://developers.weixin.qq.com/minigame/dev/api/open-api/subscribe-message/wx.requestSubscribeSystemMessage.html) |

## 参数

### TemplateReflex

模版消息订阅类型

| 参数 | 说明 |
| --- | --- |
| accept | 表示用户同意订阅该条id对应的模板消息 |
| reject | 表示用户拒绝订阅该条id对应的模板消息 |
| ban | 表示已被后台封禁 |

## 示例代码

```tsx
Taro.getSetting({
  withSubscriptions: true,
  success (res) {
    console.log(res.authSetting)
    // res.authSetting = {
    //   "scope.userInfo": true,
    //   "scope.userLocation": true
    // }
    console.log(res.subscriptionsSetting)
    // res.subscriptionsSetting = {
    //   mainSwitch: true, // 订阅消息总开关
    //   itemSettings: {   // 每一项开关
    //     SYS_MSG_TYPE_INTERACTIVE: 'accept', // 小游戏系统订阅消息
    //     SYS_MSG_TYPE_RANK: 'accept'
    //     zun-LzcQyW-edafCVvzPkK4de2Rllr1fFpw2A_x0oXE: 'reject', // 普通一次性订阅消息
    //     ke_OZC_66gZxALLcsuI7ilCJSP2OJ2vWo2ooUPpkWrw: 'ban',
    //   }
    // }
  }
})
```
</file>

<file path="docs/apis/open-api/soter/checkIsSoterEnrolledInDevice.md">
---
title: Taro.checkIsSoterEnrolledInDevice(option)
sidebar_label: checkIsSoterEnrolledInDevice
---

获取设备内是否录入如指纹等生物信息的接口

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/soter/wx.checkIsSoterEnrolledInDevice.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| checkAuthMode | `keyof RequestAuthModes` | 是 | 认证方式 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### RequestAuthModes

| 参数 | 说明 |
| --- | --- |
| fingerPrint | 指纹识别 |
| facial | 人脸识别 |
| speech | 声纹识别<br />API 支持度: 暂未支持 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |
| isEnrolled | `boolean` | 是否已录入信息 |

## 示例代码

```tsx
Taro.checkIsSoterEnrolledInDevice({
  checkAuthMode: 'fingerPrint',
  success: function (res) {
    console.log(res.isEnrolled)
  }
})
```
</file>

<file path="docs/apis/open-api/soter/checkIsSupportSoterAuthentication.md">
---
title: Taro.checkIsSupportSoterAuthentication(option)
sidebar_label: checkIsSupportSoterAuthentication
---

获取本机支持的 SOTER 生物认证方式

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/soter/wx.checkIsSupportSoterAuthentication.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| supportMode | `(keyof requestAuthModes)[]` | 该设备支持的可被SOTER识别的生物识别方式 |
| errMsg | `string` | 调用信息 |

### requestAuthModes

| 参数 | 说明 |
| --- | --- |
| fingerPrint | 指纹识别 |
| facial | 人脸识别 |
| speech | 声纹识别<br />API 支持度: 暂未支持 |

## 示例代码

```tsx
Taro.checkIsSupportSoterAuthentication({
  success: function (res) {
    // res.supportMode = [] 不具备任何被SOTER支持的生物识别方式
    // res.supportMode = ['fingerPrint'] 只支持指纹识别
    // res.supportMode = ['fingerPrint', 'facial'] 支持指纹识别和人脸识别
  }
})
```
</file>

<file path="docs/apis/open-api/soter/startSoterAuthentication.md">
---
title: Taro.startSoterAuthentication(option)
sidebar_label: startSoterAuthentication
---

开始 SOTER 生物认证。验证流程请参考[说明](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/bio-auth.html)。

**resultJSON 说明**
此数据为设备TEE中，将传入的challenge和TEE内其他安全信息组成的数据进行组装而来的JSON，对下述字段的解释如下表。例子如下：
| 字段名 | 说明 |
|---|----|
| raw | 调用者传入的challenge |
| fid | （仅Android支持）本次生物识别认证的生物信息编号（如指纹识别则是指纹信息在本设备内部编号） |
| counter | 防重放特征参数 |
| tee_n | TEE名称（如高通或者trustonic等） |
| tee_v | TEE版本号 |
| fp_n | 指纹以及相关逻辑模块提供商（如FPC等） |
| fp_v | 指纹以及相关模块版本号 |
| cpu_id | 机器唯一识别ID |
| uid | 概念同Android系统定义uid，即应用程序编号 |

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/soter/wx.startSoterAuthentication.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| challenge | `string` | 是 | 挑战因子。挑战因子为调用者为此次生物鉴权准备的用于签名的字符串关键识别信息，将作为 `resultJSON` 的一部分，供调用者识别本次请求。例如：如果场景为请求用户对某订单进行授权确认，则可以将订单号填入此参数。 |
| requestAuthModes | `(keyof requestAuthModes)[]` | 是 | 请求使用的可接受的生物认证方式 |
| authContent | `string` | 否 | 验证描述，即识别过程中显示在界面上的对话框提示内容 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| authMode | `string` | 生物认证方式 |
| errCode | `number` | 错误码 |
| errMsg | `string` | 错误信息 |
| resultJSON | `string` | 在设备安全区域（TEE）内获得的本机安全信息（如TEE名称版本号等以及防重放参数）以及本次认证信息（仅Android支持，本次认证的指纹ID）。具体说明见下文 |
| resultJSONSignature | `string` | 用SOTER安全密钥对 `resultJSON` 的签名(SHA256 with RSA/PSS, saltlen=20) |

### requestAuthModes

| 参数 | 说明 |
| --- | --- |
| fingerPrint | 指纹识别 |
| facial | 人脸识别 |
| speech | 声纹识别<br />API 支持度: 暂未支持 |

## 示例代码

```tsx
Taro.startSoterAuthentication({
   requestAuthModes: ['fingerPrint'],
   challenge: '123456',
   authContent: '请用指纹解锁',
   success: function (res) { }
})
```

```json
{
  "raw":"msg",
  "fid":"2",
  "counter":123,
  "tee_n":"TEE Name",
  "tee_v":"TEE Version",
  "fp_n":"Fingerprint Sensor Name",
  "fp_v":"Fingerprint Sensor Version",
  "cpu_id":"CPU Id",
  "uid":"21"
}
```
</file>

<file path="docs/apis/open-api/sticker/openSingleStickerView.md">
---
title: Taro.openSingleStickerView(option)
sidebar_label: openSingleStickerView
---

打开单个表情

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/sticker/wx.openSingleStickerView.html)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| url | `Object` | 是 | 表情链接，可前往(表情开放平台)[https://sticker.weixin.qq.com/cgi-bin/mmemoticonwebnode-bin/pages/home]，在详情页中的「小程序跳转链接」入口复制 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.openSingleStickerView({
  url: '',
  success(res) {}
})
```
</file>

<file path="docs/apis/open-api/sticker/openStickerIPView.md">
---
title: Taro.openStickerIPView(option)
sidebar_label: openStickerIPView
---

打开表情IP合辑

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/sticker/wx.openStickerIPView.html)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| url | `Object` | 是 | 表情IP合辑链接，可前往[表情开放平台](https://sticker.weixin.qq.com/cgi-bin/mmemoticonwebnode-bin/pages/home)，在详情页中的「小程序跳转链接」入口复制 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.openStickerIPView({
  url: '',
  success(res) {}
})
```
</file>

<file path="docs/apis/open-api/sticker/openStickerSetView.md">
---
title: Taro.openStickerSetView(option)
sidebar_label: openStickerSetView
---

打开表情专辑

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/sticker/wx.openStickerSetView.html)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| url | `Object` | 是 | 表情专辑链接，可前往[表情开放平台](https://sticker.weixin.qq.com/cgi-bin/mmemoticonwebnode-bin/pages/home)，在详情页中的「小程序跳转链接」入口复制 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.openStickerSetView({
  url: '',
  success(res) {}
})
```
</file>

<file path="docs/apis/open-api/subscribe-message/requestSubscribeDeviceMessage.md">
---
title: Taro.requestSubscribeDeviceMessage(option)
sidebar_label: requestSubscribeDeviceMessage
---

订阅设备消息接口，调用后弹出授权框，用户同意后会允许开发者给用户发送订阅模版消息。当用户点击“允许”按钮时，模板消息会被添加到用户的小程序设置页，通过 wx.getSetting 接口可获取用户对相关模板消息的订阅状态。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeDeviceMessage.html)

## 类型

```tsx
(option: Option) => Promise<FailCallbackResult | SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tmplIds | `string[]` | 是 | 需要订阅的消息模板的 id 的集合，一次调用最多可订阅3条消息 |
| sn | `string` | 是 | 设备唯一序列号。由厂商分配，长度不能超过128字节。字符只接受数字，大小写字母，下划线（_）和连字符（-）。 |
| snTicket | `string` | 是 | 设备票据，5分钟内有效。 |
| modelId | `string` | 是 | 设备型号 id 。通过微信公众平台注册设备获得。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: FailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### FailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errCode | `number` | 接口调用失败错误码，有可能为空 |
| errMsg | `string` | 接口调用失败错误信息 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| [TEMPLATE_ID] | "accept" or "reject" or "ban" or "filter" or "acceptWithAudio" | [TEMPLATE_ID]是动态的键，即模板id |
| errMsg | `string` | 接口调用成功时errMsg值为'requestSubscribeMessage:ok' |

#### 示例代码

表示用户同意订阅 zun-LzcQyW-edafCVvzPkK4de2Rllr1fFpw2A_x0oXE 这条消息
```json
{
  "errMsg": "requestSubscribeDeviceMessage:ok",
  "zun-LzcQyW-edafCVvzPkK4de2Rllr1fFpw2A_x0oXE": "accept"
}
```

### TemplateReflex

模版消息订阅类型

| 参数 | 说明 |
| --- | --- |
| accept | 表示用户同意订阅该条id对应的模板消息 |
| reject | 表示用户拒绝订阅该条id对应的模板消息 |
| ban | 表示已被后台封禁 |
| filter | 表示该模板因为模板标题同名被后台过滤 |
| acceptWithAudio | 表示用户接收订阅消息并开启了语音提醒 |

## 示例代码

```tsx
Taro.requestSubscribeDeviceMessage({
  tmplIds: ['xxxxx'],
  sn: 'xxxx',
  snTicket: 'xxxxx',
  modelId: 'xxx',
  success(res) {
    console.log(res)
  },
  fail(res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/open-api/subscribe-message/requestSubscribeMessage.md">
---
title: Taro.requestSubscribeMessage(option)
sidebar_label: requestSubscribeMessage
---

请求订阅消息

注意：[2.8.2](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) 版本开始，用户发生点击行为或者发起支付回调后，才可以调起订阅消息界面。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeMessage.html)

## 类型

```tsx
(option: Option) => Promise<FailCallbackResult | SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tmplIds | `string[]` | 是 | 需要订阅的消息模板的id的集合（注意：iOS客户端7.0.6版本、Android客户端7.0.7版本之后的一次性订阅/长期订阅才支持多个模板消息，iOS客户端7.0.5版本、Android客户端7.0.6版本之前的一次订阅只支持一个模板消息）消息模板id在[微信公众平台(mp.weixin.qq.com)-功能-订阅消息]中配置<br />API 支持度: weapp, tt |
| entityIds | `string[]` | 是 | 需要订阅的消息模板 id 集合（注意：1、一次性模板 id 和长期性模板 id 不可同时使用，2、一次最多传入三个模板 id<br />API 支持度: alipay |
| thirdTypeAppId | `string` | 否 | 模板小程序 appId，仅在服务商代调用场景下需要传入<br />API 支持度: alipay |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(result: FailCallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### FailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errCode | `number` | 接口调用失败错误码 |
| errMsg | `string` | 接口调用失败错误信息 |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| [TEMPLATE_ID] | "accept" or "reject" or "ban" | 是 | 动态的键，即模板id |
| behavior | `string` | 否 | 用户订阅操作结果。<br /><br />or 枚举值 or 描述 or<br />or --- or ---- or<br />or subscribe or 订阅成功 or<br />API 支持度: alipay |
| keep | `boolean` | 否 | 一次性订阅，是否勾选 总是保持以上选择，不再询问。<br /><br />or 枚举值 or 描述 or<br />or --- or ---- or<br />or true or 勾选 or<br />or false or 未勾选 or<br />API 支持度: alipay |
| refuse | `boolean` | 否 | 长期性订阅，是否点击 拒绝，不再询问。<br /><br />or 枚举值 or 描述 or<br />or --- or ---- or<br />or true or 点击 or<br />or false or 未点击 or<br />API 支持度: alipay |
| result | `ISubscribeResult` | 否 | 订阅数据<br />API 支持度: alipay |
| show | `boolean` | 否 | 本次订阅过程是否弹出了订阅面板。<br /><br />or 枚举值 or 描述 or<br />or --- or ---- or<br />or true or 弹出 or<br />or false or 未弹出 or<br />API 支持度: alipay |
| errMsg | `string` | 是 | 接口调用成功时errMsg值为'requestSubscribeMessage:ok' |

#### 示例代码

表示用户同意订阅 zun-LzcQyW-edafCVvzPkK4de2Rllr1fFpw2A_x0oXE 这条消息

```json
{
  "errMsg": "requestSubscribeMessage:ok",
  "zun-LzcQyW-edafCVvzPkK4de2Rllr1fFpw2A_x0oXE": "accept"
}
```

### ISubscribeResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| subscribeEntityIds | `string[]` | 订阅成功的模板列表 |
| subscribedEntityIds | `string[]` | 最终订阅成功的模板列表 |
| unsubscribedEntityIds | `string[]` | 未订阅的模板列表 |
| currentSubscribedEntityIds | `string[]` | 本次新增订阅成功的模板列表 |

### TemplateReflex

模版消息订阅类型

| 参数 | 说明 |
| --- | --- |
| accept | 表示用户同意订阅该条id对应的模板消息<br />API 支持度: weapp, alipay, tt |
| reject | 表示用户拒绝订阅该条id对应的模板消息<br />API 支持度: weapp, alipay, tt |
| ban | 表示已被后台封禁<br />API 支持度: weapp, tt |
| filter | 表示该模板因为模板标题同名被后台过滤<br />API 支持度: weapp |
| fail | 表示该条 id 对应的模版消息授权失败<br />API 支持度: tt |

## 示例代码

```tsx
Taro.requestSubscribeMessage({
  tmplIds: [''],
  success: function (res) { }
})
```
</file>

<file path="docs/apis/open-api/subscribe-message/subscribeService.md">
---
title: Taro.subscribeService(option)
sidebar_label: subscribeService
---

小程序消息订阅服务，包括取消订阅和查询订阅；订阅操作详见 [form 表单](https://smartprogram.baidu.com/docs/develop/component/formlist_form/)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-subscribeService/)

## 类型

```tsx
(option: subscribeService.Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `subscribeService.Option` |

## 示例代码

```tsx
Taro.subscribeService({
  templateId: 'BD0003',
  subscribeId: '8026',
  type: 'query',
  success(res) {
    Taro.showModal({
      title: 'success',
      content: JSON.stringify(res)
    })
  },
  fail(err) {
    Taro.showModal({
      title: 'fail',
      content: JSON.stringify(err)
    })
  }
})
```
</file>

<file path="docs/apis/open-api/subscribe-message/unsubscribeMessage.md">
---
title: Taro.unsubscribeMessage(option)
sidebar_label: unsubscribeMessage
---

取消当前用户已订阅的消息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://opendocs.alipay.com/mini/07vg26?pathHash=8c9630ac)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| entityIds | `string[]` | 是 | 需要取消订阅的消息模板 id 集合（注意：1、一次性模板 id 和长期性模板 id 不可同时使用，2、一次最多传入三个模板 id）。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.unsubscribeMessage({
  entityIds: [
    'ac768fca1ce245ccae9404bb5243c49b',
    '9aa357acb7c6434aba294aded1cdfb7c',
  ],
  success(res) {
    console.log(res);
  },
  fail(err) {
    console.log(err);
  }
})
```
</file>

<file path="docs/apis/open-api/user-info/getUserInfo.md">
---
title: Taro.getUserInfo(option)
sidebar_label: getUserInfo
---

获取用户信息。

**接口调整说明**
在用户未授权过的情况下调用此接口，将不再出现授权弹窗，会直接进入 fail 回调（详见[《公告》](https://developers.weixin.qq.com/community/develop/doc/0000a26e1aca6012e896a517556c01))。在用户已授权的情况下调用此接口，可成功获取用户信息。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/wx.getUserInfo.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| lang | `keyof Language` | 否 | 显示用户信息的语言 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| withCredentials | `boolean` | 否 | 是否带上登录态信息。当 withCredentials 为 true 时，要求此前有调用过 Taro.login 且登录态尚未过期，此时返回的数据会包含 encryptedData, iv 等敏感信息；当 withCredentials 为 false 时，不要求有登录态，返回的数据不包含 encryptedData, iv 等敏感信息。 |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| cloudID | `string` | 否 | 敏感数据对应的云 ID，开通[云开发](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)的小程序才会返回，可通过云调用直接获取开放数据，详细见[云调用直接获取开放数据](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#method-cloud) |
| encryptedData | `string` | 是 | 包括敏感数据在内的完整用户信息的加密数据，详见 [用户数据的签名验证和加解密](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95) |
| iv | `string` | 是 | 加密算法的初始向量，详见 [用户数据的签名验证和加解密](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95) |
| rawData | `string` | 是 | 不包括敏感信息的原始数据字符串，用于计算签名 |
| signature | `string` | 是 | 使用 sha1( rawData + sessionkey ) 得到字符串，用于校验用户信息，详见 [用户数据的签名验证和加解密](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html) |
| userInfo | `UserInfo` | 是 | 用户信息对象，不包含 openid 等敏感信息 |
| errMsg | `string` | 是 | 调用结果 |

## 示例代码

```tsx
// 必须是在用户已经授权的情况下调用

Taro.getUserInfo({
  success: function(res) {
    var userInfo = res.userInfo
    var nickName = userInfo.nickName
    var avatarUrl = userInfo.avatarUrl
    var gender = userInfo.gender //性别 0：未知、1：男、2：女
    var province = userInfo.province
    var city = userInfo.city
    var country = userInfo.country
  }
})
```

敏感数据有两种获取方式，一是使用 [加密数据解密算法](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95) 。
获取得到的开放数据为以下 json 结构：

```json
{
  "openId": "OPENID",
  "nickName": "NICKNAME",
  "gender": GENDER,
  "city": "CITY",
  "province": "PROVINCE",
  "country": "COUNTRY",
  "avatarUrl": "AVATARURL",
  "unionId": "UNIONID",
  "watermark": {
    "appid":"APPID",
    "timestamp": TIMESTAMP
  }
}
```
</file>

<file path="docs/apis/open-api/user-info/getUserProfile.md">
---
title: Taro.getUserProfile(option)
sidebar_label: getUserProfile
---

> 最低 Taro 版本: 2.2.17+，3.0.29+

获取用户信息。每次请求都会弹出授权窗口，用户同意后返回 `userInfo`。

若开发者需要获取用户的个人信息（头像、昵称、性别与地区），可以通过 Taro.getUserProfile 接口进行获取，

微信该接口从基础库 **2.10.4** 版本开始支持，该接口只返回用户个人信息，不包含用户身份标识符。该接口中 desc 属性（声明获取用户个人信息后的用途）后续会展示在弹窗中，请开发者谨慎填写。

开发者每次通过该接口获取用户个人信息均需用户确认，请开发者妥善保管用户快速填写的头像昵称，避免重复弹窗。

[微信端调整背景和说明，请参考文档](https://developers.weixin.qq.com/community/develop/doc/000cacfa20ce88df04cb468bc52801)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/wx.getUserProfile.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| lang | `keyof Language` |  | 否 | 显示用户信息的语言 |
| desc | `string` |  | 是 | 声明获取用户个人信息后的用途，不超过30个字符 |
| force | `boolean` | `false` | 否 | 当宿主未登录时，是否强制拉起登录框<br />API 支持度: tt |
| success | `(result: SuccessCallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| userInfo | `UserInfo` | 用户信息对象 |
| rawData | `string` | 不包括敏感信息的原始数据字符串，用于计算签名 |
| signature | `string` | 使用 sha1( rawData + sessionkey ) 得到字符串，用于校验用户信息，详见 [用户数据的签名验证和加解密](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html) |
| encryptedData | `string` | 包括敏感数据在内的完整用户信息的加密数据，详见 [用户数据的签名验证和加解密](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95) |
| iv | `string` | 加密算法的初始向量，详见 [用户数据的签名验证和加解密](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95) |
| cloudID | `string` | 敏感数据对应的云 ID，开通云开发的小程序才会返回，可通过云调用直接获取开放数据，详细 [见云调用直接获取开放数据](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#method-cloud) |

## 示例代码

推荐使用 Taro.getUserProfile 获取用户信息，开发者每次通过该接口获取用户个人信息均需用户确认

```tsx
Taro.getUserProfile({
  desc: '用于完善会员资料', // 声明获取用户个人信息后的用途，后续会展示在弹窗中，请谨慎填写
  success: (res) => {
    // 开发者妥善保管用户快速填写的头像昵称，避免重复弹窗
    this.setState({
      userInfo: res.userInfo,
      hasUserInfo: true
    })
  }
})
```
</file>

<file path="docs/apis/open-api/user-info/UserInfo.md">
---
title: UserInfo
sidebar_label: UserInfo
---

用户信息

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/UserInfo.html)

## 方法

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| nickName | `string` | 是 | 用户昵称 |
| avatarUrl | `string` | 是 | 用户头像图片的 URL。URL 最后一个数值代表正方形头像大小（有 0、46、64、96、132 数值可选，0 代表 640x640 的正方形头像，46 表示 46x46 的正方形头像，剩余数值以此类推。默认132），用户没有头像时该项为空。若用户更换头像，原有头像 URL 将失效。 |
| gender | `keyof Gender` | 否 | 用户性别。不再返回，参考 [相关公告](https://developers.weixin.qq.com/community/develop/doc/00028edbe3c58081e7cc834705b801) |
| country | `string` | 是 | 用户所在国家。不再返回，参考 [相关公告](https://developers.weixin.qq.com/community/develop/doc/00028edbe3c58081e7cc834705b801) |
| province | `string` | 是 | 用户所在省份。不再返回，参考 [相关公告](https://developers.weixin.qq.com/community/develop/doc/00028edbe3c58081e7cc834705b801) |
| city | `string` | 是 | 用户所在城市。不再返回，参考 [相关公告](https://developers.weixin.qq.com/community/develop/doc/00028edbe3c58081e7cc834705b801) |
| language | `keyof Language` | 是 | 显示 country，province，city 所用的语言。强制返回 “zh_CN”，参考 [相关公告](https://developers.weixin.qq.com/community/develop/doc/00028edbe3c58081e7cc834705b801) |

## 参数

### Language

| 参数 | 类型 |
| --- | --- |
| en | `"英文"` |
| zh_CN | `"简体中文"` |
| zh_TW | `"繁体中文"` |

### Gender

| 参数 | 类型 |
| --- | --- |
| 0 | `"未知"` |
| 1 | `"男性"` |
| 2 | `"女性"` |
</file>

<file path="docs/apis/open-api/werun/getWeRunData.md">
---
title: Taro.getWeRunData(option)
sidebar_label: getWeRunData
---

获取用户过去三十天微信运动步数。需要先调用 Taro.login 接口。步数信息会在用户主动进入小程序时更新。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/werun/wx.getWeRunData.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| cloudID | `string` | 否 | 敏感数据对应的云 ID，开通云开发的小程序才会返回，可通过云调用直接获取开放数据，详细见[云调用直接获取开放数据](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#method-cloud) |
| encryptedData | `string` | 是 | 包括敏感数据在内的完整用户信息的加密数据，详细见[加密数据解密算法](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html)。解密后得到的数据结构见后文 |
| iv | `string` | 是 | 加密算法的初始向量，详细见[加密数据解密算法](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html) |
| errMsg | `string` | 是 | 调用结果 |

## 示例代码

```tsx
Taro.getWeRunData({
  success: function (res) {
    // 拿 encryptedData 到开发者后台解密开放数据
    const encryptedData = res.encryptedData
    // 或拿 cloudID 通过云调用直接获取开放数据
    const cloudID = res.cloudID
  }
})
```

**开放数据 JSON 结构**
敏感数据有两种获取方式，一是使用 [加密数据解密算法](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95) 。
获取得到的开放数据为以下 json 结构：

```json
{
  "stepInfoList": [
    {
      "timestamp": 1445866601,
      "step": 100
    },
    {
      "timestamp": 1445876601,
      "step": 120
    }
  ]
}
```

stepInfoList 中，每一项结构如下：

| 属性 | 类型 | 说明 |
| --- | ---- | --- |
| timestamp | number | 时间戳，表示数据对应的时间 |
| step | number | 微信运动步数 |
</file>

<file path="docs/apis/open-api/werun/shareToWeRun.md">
---
title: Taro.shareToWeRun(option)
sidebar_label: shareToWeRun
---

分享数据到微信运动。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/werun/wx.shareToWeRun.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| recordList | `record[]` | 是 | 运动数据列表 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### record

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| typeId | `number` | 运动项目id |
| time | `number` | 运动时长 |
| distance | `number` | 运动距离 |
| calorie | `number` | 消耗卡路里 |
</file>

<file path="docs/apis/payment/faceVerifyForPay.md">
---
title: Taro.faceVerifyForPay(option)
sidebar_label: faceVerifyForPay
---

支付各个安全场景验证人脸

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/payment/wx.faceVerifyForPay.html)

## 类型

```tsx
(option: any) => Promise<any>
```

## 示例代码

```tsx
Taro.faceVerifyForPay(params).then(...)
```
</file>

<file path="docs/apis/payment/requestOrderPayment.md">
---
title: Taro.requestOrderPayment(option)
sidebar_label: requestOrderPayment
---

创建自定义版交易组件订单，并发起支付。 仅接入了[自定义版交易组件](https://developers.weixin.qq.com/miniprogram/dev/framework/ministore/minishopopencomponent2/Introduction2)的小程序需要使用，普通小程序可直接使用 `Taro.requestPayment`。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/payment/wx.requestOrderPayment.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| timeStamp | `string` | 是 | 时间戳，从 1970 年 1 月 1 日 00:00:00 至今的秒数，即当前的时间 |
| nonceStr | `string` | 是 | 随机字符串，长度为32个字符以下 |
| package | `string` | 是 | 统一下单接口返回的 prepay_id 参数值，提交格式如：prepay_id=*** |
| orderInfo | `any` | 否 | 订单信息，仅在需要校验的场景下需要传递，具体见[接口说明](https://developers.weixin.qq.com/miniprogram/dev/framework/ministore/minishopopencomponent2/API/order/requestOrderPayment) |
| extUserUin | `string` | 否 | 外部 APP 用户 ID |
| signType | `keyof SignType` | 否 | 签名算法 |
| paySign | `string` | 是 | 签名，具体签名方案参见 [小程序支付接口文档](https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=7_7&index=3) |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SignType

| 参数 | 说明 |
| --- | --- |
| MD5 | 仅在微信支付 v2 版本接口适用 |
| HMAC-SHA256 | 仅在微信支付 v2 版本接口适用 |
| RSA | 仅在微信支付 v3 版本接口适用 |

## 示例代码

除 orderInfo 以外，其余字段与 [Taro.requestPayment](./requestPayment) 一致

```tsx
Taro.requestOrderPayment({
  orderInfo: {},
  timeStamp: '',
  nonceStr: '',
  package: '',
  signType: 'MD5',
  paySign: '',
  success (res) { },
  fail (res) { }
})
```
</file>

<file path="docs/apis/payment/requestPayment.md">
---
title: Taro.requestPayment(option)
sidebar_label: requestPayment
---

发起微信支付。了解更多信息，请查看[微信支付接口文档](https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=7_3&index=1)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/payment/wx.requestPayment.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| timeStamp | `string` | 是 | 时间戳，从 1970 年 1 月 1 日 00:00:00 至今的秒数，即当前的时间 |
| nonceStr | `string` | 是 | 随机字符串，长度为32个字符以下 |
| package | `string` | 是 | 统一下单接口返回的 prepay_id 参数值，提交格式如：prepay_id=*** |
| signType | `keyof SignType` | 否 | 签名算法 |
| paySign | `string` | 是 | 签名，具体签名方案参见 [小程序支付接口文档](https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=7_7&index=3) |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SignType

| 参数 | 说明 |
| --- | --- |
| MD5 | 仅在微信支付 v2 版本接口适用 |
| HMAC-SHA256 | 仅在微信支付 v2 版本接口适用 |
| RSA | 仅在微信支付 v3 版本接口适用 |

## 示例代码

```tsx
Taro.requestPayment({
  timeStamp: '',
  nonceStr: '',
  package: '',
  signType: 'MD5',
  paySign: '',
  success: function (res) { },
  fail: function (res) { }
})
```
</file>

<file path="docs/apis/qq/addRecentColorSign.md">
---
title: Taro.addRecentColorSign(option)
sidebar_label: addRecentColorSign
---

添加当前小程序页面到最近浏览彩签，需要授权基础库 1.20.0 开始支持。
提示：在手 Q 8.9.0 前的版本，当系统未授予手 Q 悬浮穿权限时，每次调用该接口都会弹出系统授权窗口。自手 Q 8.9.0 起交互调整如下:
  1. 系统没有授予手 Q 悬浮窗权限时，接口执行 fail 回调函数并附带 ”No floating window permission“的错误信息，开发者可针对此信息在业务代码里弹窗提示用户手动授予手 Q 悬浮窗权限。
  2. 安卓系统部分机型存在获取悬浮窗权限不准确情况。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://q.qq.com/wiki/develop/miniprogram/API/open_port/port_addColorSign.html#qq-addrecentcolorsign)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| query | `string` | 否 | 做为点击最近彩签打开的小程序页面的启动参数，如 a=1&b=2<br />默认值：当前页面的查询参数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.addRecentColorSign({
  query: 'a=1&b=2',
  success(res) {
    console.log('addRecentColorSign success: ', res)
  },
  fail(err) {
    console.log('addRecentColorSign fail: ', err)
  },
  complete(res) {
    console.log('addRecentColorSign complete: ', res)
  }
})
```
</file>

<file path="docs/apis/qq/applyAddToMyApps.md">
---
title: Taro.applyAddToMyApps(option)
sidebar_label: applyAddToMyApps
---

申请用户将本小程序添加到下拉页面中“我的小程序”当中，手Q8.9.13及以上版本支持

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://q.qq.com/wiki/develop/miniprogram/API/open_port/port_addToMyApps.html#qq-applyaddtomyapps)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| confirm | `boolean` | true 代表用户选择了同意 |
| cancel | `boolean` | true 代表用户选择了不同意 |

## 示例代码

```tsx
Taro.applyAddToMyApps({
  success(res) {
    if (res.confirm) {
      // 用户同意添加
    }
    if (res.cancel) {
      // 用户不同意添加
    }
    // 原则上，confirm和cancel是互斥的
  }
})
```
</file>

<file path="docs/apis/qq/getGuildInfo.md">
---
title: Taro.getGuildInfo(option)
sidebar_label: getGuildInfo
---

获取频道信息与当前人身份（FOR 机器人服务入口）

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://q.qq.com/wiki/develop/miniprogram/API/open_port/port_guild.html)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| open_guild_id | `string` | 是 | 频道id |
| channel_id | `string` | 否 | 子频道Id |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| encryptedData | `string` | 加密之后的数据，需要解密 |
| iv | `string` | 对称解密算法初始向量(base64) |
| signature | `string` | 签名(base64) |
</file>

<file path="docs/apis/qq/getQQRunData.md">
---
title: Taro.getQQRunData(option)
sidebar_label: getQQRunData
---

获取用户过去三十天QQ运动步数。需要先调用 qq.login 接口。步数信息会在用户主动进入小程序时更新。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://q.qq.com/wiki/develop/miniprogram/API/open_port/port_sport.html)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| encryptedData | `string` | 包括敏感数据在内的完整用户信息的加密数据，详细见加密数据解密算法。 |
| iv | `string` | 加密算法的初始向量，详细见加密数据解密算法 |

## 示例代码

```tsx
Taro.getQQRunData({
  success(res) {
    // 拿 encryptedData 到开发者后台解密开放数据
    const encryptedData = res.encryptedData
  }
})
```

**开放数据 JSON 结构**
敏感数据有两种获取方式，一是使用 加密数据解密算法 。 获取得到的开放数据为以下 json 结构：

```json
{
  "stepInfoList": [
    {
      "timestamp": 1445866601,
      "step": 100
    },
    {
      "timestamp": 1445876601,
      "step": 120
    }
  ]
}
```
* stepInfoList 中，每一项结构如下：

| 属性 | 类型 | 说明 |
| --- | ---- | --- |
| timestamp | number | 时间戳，表示数据对应的时间 |
| step | number | QQ运动步数 |
</file>

<file path="docs/apis/qq/isAddedToMyApps.md">
---
title: Taro.isAddedToMyApps(option)
sidebar_label: isAddedToMyApps
---

查询用户是否已经将本小程序添加到下拉页面中“我的小程序”当中，手Q8.9.13及以上版本支持，建议使用qq.applyAddToMyApps之前先调用qq.isAddedToMyApps来作前置判断

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://q.qq.com/wiki/develop/miniprogram/API/open_port/port_addToMyApps.html#qq-isaddedtomyapps)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| isAdded | `boolean` | true 代表用户已经添加，false 则还没添加 |

## 示例代码

```tsx
Taro.isAddedToMyApps({
  success(res) {
    if (res.isAdded) {
      // 用户已经添加
    } else {
      // 用户还未添加
    }
  }
})
```
</file>

<file path="docs/apis/qq/openQzonePublish.md">
---
title: Taro.openQzonePublish(option)
sidebar_label: openQzonePublish
---

此接口可打开手Q说说发表界面，并将文字内容和图片/视频内容传递到手Q说说发表界面。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://q.qq.com/wiki/develop/miniprogram/API/open_port/port_openQzonePublish.html)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| text | `string` | 传递的文字内容 |
| media | `Media[]` | 传递的视频/图片内容，显示顺序为元素下标顺序 |
| path | `string` | 说说小尾巴跳转到的页面路径，不填则默认跳到主页 |
| footnote | `string` | 说说小尾巴显示的文案，不填则默认显示小程序的简介文案 |

### Media

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `MediaType` | 图片填"photo"，视频填"video" |
| path | `string` | 文件路径，必须为本地文件 |

### MediaType

```tsx
"photo" | "video"
```

## 示例代码

```tsx
Taro.openQzonePublish({
  footnote: '使用同款滤镜',
  path: 'pages/index/index',
  text: '我爱中国',
  media: [
    {
      type: 'photo',
      path: 'qqfile://1.png'
    },
    {
      type: 'video',
      path: 'qqfile://2.mp4'
    }
  ]
})
```
</file>

<file path="docs/apis/qq/setCustomDress.md">
---
title: Taro.setCustomDress(option)
sidebar_label: setCustomDress
---

QQ美化平台内测阶段，仅被邀请的商户可使用此接口。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://q.qq.com/wiki/develop/miniprogram/API/open_port/personalize.html#qq-setcustomdress)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| action | `string` | 是 | 方法名，设置头像填"uploadAvatar"，其他方法后续开放 |
| path | `string` | 是 | 素材路径，必须为本地文件，路径为 wxfile:// 的形式 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.setCustomDress({
  action: "uploadAvatar",
  path:"wxfile://images/1.png"
  success(res) {
    console.log("success"+res);
  },
  fail(res) {
    console.log("fail"+res);
  }
})
```
</file>

<file path="docs/apis/qq/setOfficialDress.md">
---
title: Taro.setOfficialDress(option)
sidebar_label: setOfficialDress
---

QQ美化平台内测阶段，仅被邀请的商户可使用此接口。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://q.qq.com/wiki/develop/miniprogram/API/open_port/personalize.html#qq-setofficialdress)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| action | `string` | 是 | 方法名，设置头像填"setAvatar"，其他方法后续开放 |
| uin | `string` | 是 | openid，给自己设置头像填"self" |
| item_id | `string` | 否 | 物品id |
| busi_info | `string` | 否 | 设置头像"setAvatar"此处不用填 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.setOfficialDress({
  action: "setAvatar",
  uin: "self",
  item_id: "2740",
  success(res) {
    console.log("success"+res);
  },
  fail(res) {
    console.log("fail"+res);
  }
})
```
</file>

<file path="docs/apis/qq/updateQQApp.md">
---
title: Taro.updateQQApp(option)
sidebar_label: updateQQApp
---

更新 QQ 版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://q.qq.com/wiki/develop/miniprogram/API/open_port/port_updateQQ.html#qq-updateqqapp)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.updateQQApp({
  success: function(res) {
    console.log('updateQQApp success',res)
  },
  fail: function(err) {
    console.log('updateQQApp fail',err)
  },
  complete: function(res) {
    console.log('updateQQApp info',res)
  }
})
```
</file>

<file path="docs/apis/route/EventChannel.md">
---
title: EventChannel
sidebar_label: EventChannel
---

页面间事件通信通道

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/route/EventChannel.html)

## 方法

### emit

触发一个事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/route/EventChannel.emit.html)

```tsx
(eventName: string, ...args: any) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| eventName | `string` | 事件名称 |
| args | `any` | 事件参数 |

### on

持续监听一个事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/route/EventChannel.on.html)

```tsx
(eventName: string, fn: TaroGeneral.EventCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| eventName | `string` | 事件名称 |
| fn | `TaroGeneral.EventCallback` | 事件监听函数 |

### once

监听一个事件一次，触发后失效

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/route/EventChannel.once.html)

```tsx
(eventName: string, fn: TaroGeneral.EventCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| eventName | `string` | 事件名称 |
| fn | `TaroGeneral.EventCallback` | 事件监听函数 |

### off

取消监听一个事件。给出第二个参数时，只取消给出的监听函数，否则取消所有监听函数

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/route/EventChannel.off.html)

```tsx
(eventName: string, fn: TaroGeneral.EventCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| eventName | `string` | 事件名称 |
| fn | `TaroGeneral.EventCallback` | 事件监听函数 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| EventChannel | ✔️ |  |  |  |  |
| EventChannel.emit | ✔️ |  |  |  |  |
| EventChannel.on | ✔️ |  |  |  |  |
| EventChannel.once | ✔️ |  |  |  |  |
| EventChannel.off | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/route/navigateBack.md">
---
title: Taro.navigateBack(option)
sidebar_label: navigateBack
---

关闭当前页面，返回上一页面或多级页面。可通过 getCurrentPages 获取当前的页面栈，决定需要返回几层。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> H5: 若入参 delta 大于现有页面数时，返回应用打开的第一个页面（如果想要返回首页请使用 reLaunch 方法）。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateBack.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| delta | `number` | 否 | 返回的页面数，如果 delta 大于现有页面数，则返回到首页。 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
// 注意：调用 navigateTo 跳转时，调用该方法的页面会被加入堆栈，而 redirectTo 方法则不会。见下方示例代码
// 此处是A页面
Taro.navigateTo({
  url: 'B?id=1'
})
// 此处是B页面
Taro.navigateTo({
  url: 'C?id=1'
})
// 在C页面内 navigateBack，将返回A页面
Taro.navigateBack({
  delta: 2
})
```
</file>

<file path="docs/apis/route/navigateTo.md">
---
title: Taro.navigateTo(option)
sidebar_label: navigateTo
---

保留当前页面，跳转到应用内的某个页面。但是不能跳到 tabbar 页面。使用 Taro.navigateBack 可以返回到原页面。小程序中页面栈最多十层。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> H5: 未针对 tabbar 页面做限制处理

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateTo.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| url | `string` | 是 | 需要跳转的应用内非 tabBar 的页面的路径, 路径后可以带参数。参数与路径之间使用 `?` 分隔，参数键与参数值用 `=` 相连，不同参数用 `&` 分隔；如 'path?key=value&key2=value2' |
| events | `TaroGeneral.IAnyObject` | 否 | 页面间通信接口，用于监听被打开页面发送到当前页面的数据。 |
| routeType | `string` | 否 | 2.29.2 自定义路由类型 |
| routeConfig | `TaroGeneral.IAnyObject` | 否 | 3.4.0 自定义路由配置 |
| routeOptions | `TaroGeneral.IAnyObject` | 否 | 3.4.0 自定义路由参数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: any) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.navigateTo({
  url: 'test?id=1',
  events: {
    // 为指定事件添加一个监听器，获取被打开页面传送到当前页面的数据
    acceptDataFromOpenedPage: function(data) {
      console.log(data)
    },
    someEvent: function(data) {
      console.log(data)
    }
    ...
  },
  success: function (res) {
    // 通过eventChannel向被打开页面传送数据
    res.eventChannel.emit('acceptDataFromOpenerPage', { data: 'test' })
  }
})
```
</file>

<file path="docs/apis/route/redirectTo.md">
---
title: Taro.redirectTo(option)
sidebar_label: redirectTo
---

关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到 tabbar 页面。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> H5: 未针对 tabbar 页面做限制处理

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.redirectTo.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| url | `string` | 是 | 需要跳转的应用内非 tabBar 的页面的路径, 路径后可以带参数。参数与路径之间使用 `?` 分隔，参数键与参数值用 `=` 相连，不同参数用 `&` 分隔；如 'path?key=value&key2=value2' |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.redirectTo({
  url: 'test?id=1'
})
```
</file>

<file path="docs/apis/route/reLaunch.md">
---
title: Taro.reLaunch(option)
sidebar_label: reLaunch
---

关闭所有页面，打开到应用内的某个页面

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.reLaunch.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| url | `string` | 是 | 需要跳转的应用内页面路径，路径后可以带参数。参数与路径之间使用?分隔，参数键与参数值用=相连，不同参数用&分隔；如 'path?key=value&key2=value2' |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.reLaunch({
  url: 'test?id=1'
})
```
</file>

<file path="docs/apis/route/router.md">
---
title: router
sidebar_label: router
---

## 类型

```tsx
router
```

## 参数

### CustomRouteBuilder

```tsx
(routeContext: CustomRouteContext,routeOptions: Record<string, any>) => CustomRouteConfig
```

| 参数 | 类型 |
| --- | --- |
| routeContext | `CustomRouteContext` |
| routeOptions | `Record<string, any>` |

### SharedValue

| 参数 | 类型 |
| --- | --- |
| value | `T` |

### CustomRouteContext

| 参数 | 类型 |
| --- | --- |
| primaryAnimation | `SharedValue<number>` |
| primaryAnimationStatus | `SharedValue<number>` |
| secondaryAnimation | `SharedValue<number>` |
| secondaryAnimationStatus | `SharedValue<number>` |
| userGestureInProgress | `SharedValue<number>` |
| startUserGesture | `() => void` |
| stopUserGesture | `() => void` |
| didPop | `() => void` |

### CustomRouteConfig

| 参数 | 类型 | 必填 |
| --- | --- | :---: |
| opaque | `boolean` | 否 |
| maintainState | `boolean` | 否 |
| transitionDuration | `number` | 否 |
| reverseTransitionDuration | `number` | 否 |
| barrierColor | `string` | 否 |
| barrierDismissible | `boolean` | 否 |
| barrierLabel | `string` | 否 |
| canTransitionTo | `boolean` | 否 |
| canTransitionFrom | `boolean` | 否 |
| handlePrimaryAnimation | `RouteAnimationHandler` | 否 |
| handleSecondaryAnimation | `RouteAnimationHandler` | 否 |
| handlePreviousPageAnimation | `RouteAnimationHandler` | 否 |
| allowEnterRouteSnapshotting | `boolean` | 否 |
| allowExitRouteSnapshotting | `boolean` | 否 |
| fullscreenDrag | `boolean` | 否 |
| popGestureDirection | "horizontal" or "vertical" or "multi" | 否 |

### RouteAnimationHandler

```tsx
() => { [key: string]: any; }
```

### router

自定义路由

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/route/router/wx.router.html)

#### addRouteBuilder

添加自定义路由配置

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/route/router/base/router.addRouteBuilder.html)

```tsx
(routeType: string, routeBuilder: CustomRouteBuilder) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| routeType | `string` | 路由类型 |
| routeBuilder | `CustomRouteBuilder` | 路由动画定义函数 |

#### getRouteContext

获取页面对应的自定义路由上下文对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/route/router/base/router.getRouteContext.html)

```tsx
(instance: TaroGeneral.IAnyObject) => CustomRouteContext
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| instance | `TaroGeneral.IAnyObject` | 页面/自定义组件实例 |

#### removeRouteBuilder

移除自定义路由配置

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/route/router/base/router.removeRouteBuilder.html)

```tsx
(routeType: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| routeType | `string` | 路由类型 |
</file>

<file path="docs/apis/route/switchTab.md">
---
title: Taro.switchTab(option)
sidebar_label: switchTab
---

跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.switchTab.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| url | `string` | 是 | 需要跳转的 tabBar 页面的路径（需在 app.json 的 [tabBar](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#tabbar) 字段定义的页面），路径后不能带参数。 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```json
{
  "tabBar": {
    "list": [{
      "pagePath": "index",
      "text": "首页"
    },{
      "pagePath": "other",
      "text": "其他"
    }]
  }
}
```

```tsx
Taro.switchTab({
  url: '/index'
})
```
</file>

<file path="docs/apis/share/authPrivateMessage.md">
---
title: Taro.authPrivateMessage(option)
sidebar_label: authPrivateMessage
---

验证私密消息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/share/wx.authPrivateMessage.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| shareTicket | `string` | 是 | shareTicket |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| cloudID | `string` | 否 | 敏感数据对应的云 ID，开通[云开发](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)的小程序才会返回，可通过云调用直接获取开放数据，详细见[云调用直接获取开放数据](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#method-cloud) |
| encryptedData | `string` | 是 | 包括敏感数据在内的完整转发信息的加密数据，详细见[加密数据解密算法](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html) |
| errMsg | `string` | 是 | 错误信息 |
| iv | `string` | 是 | 加密算法的初始向量，详细见[加密数据解密算法](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html) |

## 示例代码

```tsx
Taro.authPrivateMessage({
  shareTicket: 'xxxxxx',
  success(res) {
    console.log('authPrivateMessage success', res)
    // res
    // {
    //   errMsg: 'authPrivateMessage:ok'
    //   valid: true
    //   iv: 'xxxx',
    //   encryptedData: 'xxxxxx'
    // }
  },
  fail(res) {
    console.log('authPrivateMessage fail', res)
  }
})
```
</file>

<file path="docs/apis/share/getShareInfo.md">
---
title: Taro.getShareInfo(option)
sidebar_label: getShareInfo
---

获取转发详细信息

**Tips**
- 如需要展示群名称，可以使用[开放数据组件](/docs/components/open/open-data)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/share/wx.getShareInfo.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| shareTicket | `string` | 是 | shareTicket |
| timeout | `number` | 否 | 超时时间，单位 ms |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| cloudID | `string` | 否 | 敏感数据对应的云 ID，开通[云开发](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)的小程序才会返回，可通过云调用直接获取开放数据，详细见[云调用直接获取开放数据](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#method-cloud) |
| encryptedData | `string` | 是 | 包括敏感数据在内的完整转发信息的加密数据，详细见[加密数据解密算法](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html) |
| errMsg | `string` | 是 | 错误信息 |
| iv | `string` | 是 | 加密算法的初始向量，详细见[加密数据解密算法](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html) |

## 示例代码

敏感数据有两种获取方式，一是使用 [加密数据解密算法](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95) 。
获取得到的开放数据为以下 json 结构（其中 openGId 为当前群的唯一标识）：
```json
{
 "openGId": "OPENGID"
}
```
</file>

<file path="docs/apis/share/hideShareMenu.md">
---
title: Taro.hideShareMenu(option)
sidebar_label: hideShareMenu
---

隐藏当前页面的转发按钮

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/share/wx.hideShareMenu.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| menus | `string[]` | 否 | 本接口为 Beta 版本，暂只在 Android 平台支持。需要隐藏的转发按钮名称列表，默认['shareAppMessage', 'shareTimeline']。按钮名称合法值包含 "shareAppMessage"、"shareTimeline" 两种 |
| success | `(result: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

## 示例代码

```tsx
Taro.hideShareMenu()
```
</file>

<file path="docs/apis/share/offCopyUrl.md">
---
title: Taro.offCopyUrl(callback)
sidebar_label: offCopyUrl
---

取消监听用户点击右上角菜单的「复制链接」按钮时触发的事件

> 本接口为 Beta 版本，暂只在 Android 平台支持。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/share/wx.offCopyUrl.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 用户点击右上角菜单的「复制链接」按钮时触发的事件的回调函数 |
</file>

<file path="docs/apis/share/onCopyUrl.md">
---
title: Taro.onCopyUrl(callback)
sidebar_label: onCopyUrl
---

监听用户点击右上角菜单的「复制链接」按钮时触发的事件

> 本接口为 Beta 版本，暂只在 Android 平台支持。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/share/wx.onCopyUrl.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 用户点击右上角菜单的「复制链接」按钮时触发的事件的回调函数 |

### Callback

用户点击右上角菜单的「复制链接」按钮时触发的事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| query | `string` | 用短链打开小程序时当前页面携带的查询字符串。小程序中使用时，应在进入页面时调用 `Taro.onCopyUrl` 自定义 `query`，退出页面时调用 `Taro.offCopyUrl`，防止影响其它页面。 |
</file>

<file path="docs/apis/share/shareFileMessage.md">
---
title: Taro.shareFileMessage(option)
sidebar_label: shareFileMessage
---

转发文件到聊天

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/share/wx.shareFileMessage.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| filePath | `string` | 是 | 要分享的视频地址，必须为本地路径或临时路径 |
| fileName | `string` | 否 | 自定义文件名，若留空则使用 filePath 中的文件名 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
</file>

<file path="docs/apis/share/shareVideoMessage.md">
---
title: Taro.shareVideoMessage(option)
sidebar_label: shareVideoMessage
---

转发视频到聊天

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/share/wx.shareVideoMessage.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| videoPath | `string` | 是 | 要分享的视频地址，必须为本地路径或临时路径 |
| thumbPath | `string` | 否 | 缩略图路径，若留空则使用视频首帧 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

## 示例代码

callback 写法

```tsx
Taro.downloadFile({
  url: URL, // 下载url
  success (res) {
    // 下载完成后转发
    Taro.shareVideoMessage({
      videoPath: res.tempFilePath,
      success() {},
      fail: console.error,
    })
  },
  fail: console.error,
})
```

async await 写法

```tsx
const { tempFilePath } = await Taro.downloadFile({
  url: URL, // 下载url
})
// 下载完成后转发
await Taro.shareVideoMessage({
  videoPath: res.tempFilePath,
})
```
</file>

<file path="docs/apis/share/showShareImageMenu.md">
---
title: Taro.showShareImageMenu(option)
sidebar_label: showShareImageMenu
---

打开分享图片弹窗，可以将图片发送给朋友、收藏或下载

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/share/wx.showShareImageMenu.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| path | `string` | 是 | 要分享的图片地址，必须为本地路径或临时路径 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

## 示例代码

```tsx
Taro.downloadFile({
  url: 'https://res.wx.qq.com/wxdoc/dist/assets/img/demo.ef5c5bef.jpg',
  success: (res) => {
    Taro.showShareImageMenu({
      path: res.tempFilePath
    })
  }
})
```
</file>

<file path="docs/apis/share/showShareMenu.md">
---
title: Taro.showShareMenu(option)
sidebar_label: showShareMenu
---

显示当前页面的转发按钮

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/share/wx.showShareMenu.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| withShareTicket | `boolean` | 否 | 是否使用带 shareTicket 的转发[详情](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share.html) |
| showShareItems | `string[]` | 否 | QQ小程序分享功能，支持分享到QQ、QQ空间、微信好友、微信朋友圈<br />API 支持度: weapp, qq<br />qq: QQ支持的值： ['qq', 'qzone', 'wechatFriends', 'wechatMoment']<br />weapp: 微信支持：['wechatFriends', 'wechatMoment'] / ['shareAppMessage', 'shareTimeline'] |

## 示例代码

```tsx
Taro.showShareMenu({
  withShareTicket: true
})
```
</file>

<file path="docs/apis/share/updateShareMenu.md">
---
title: Taro.updateShareMenu(option)
sidebar_label: updateShareMenu
---

更新转发属性

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/share/wx.updateShareMenu.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| activityId | `string` | 否 | 动态消息的 activityId。通过 [updatableMessage.createActivityId](https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/updatable-message/updatableMessage.createActivityId.html) 接口获取 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| isUpdatableMessage | `boolean` | 否 | 是否是动态消息，详见[动态消息](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share/updatable-message.html) |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| templateInfo | `UpdatableMessageFrontEndTemplateInfo` | 否 | 动态消息的模板信息 |
| withShareTicket | `boolean` | 否 | 是否使用带 shareTicket 的转发[详情](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share.html) |

### UpdatableMessageFrontEndTemplateInfo

动态消息的模板信息

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| parameterList | `UpdatableMessageFrontEndParameter[]` | 参数列表 |

### UpdatableMessageFrontEndParameter

参数列表

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| name | `string` | 参数名 |
| value | `string` | 参数值 |

## 示例代码

```tsx
Taro.updateShareMenu({
  withShareTicket: true,
  success () { }
})
```
</file>

<file path="docs/apis/skyline/DraggableSheetContext.md">
---
title: DraggableSheetContext
sidebar_label: DraggableSheetContext
---

DraggableSheet 实例，可通过 Taro.createSelectorQuery 的 NodesRef.node 方法获取。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/skyline/DraggableSheetContext.html)

## 方法

### scrollTo

滚动到指定位置。size 取值 [0, 1]，size = 1 时表示撑满 draggable-sheet 组件。size 和 pixels 同时传入时，仅 size 生效。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/skyline/DraggableSheetContext.scrollTo.html)

```tsx
(option: Option) => void
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

## 参数

### scrollTo

#### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| size | `number` |  | 否 | 相对目标位置 |
| pixels | `number` |  | 否 | 绝对目标位置 |
| animated | `boolean` | `true` | 否 | 是否启用滚动动画 |
| duration | `number` | `300` | 否 | 滚动动画时长（ms) |
| easingFunction | `string` | `ease` | 否 | 缓动函数 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| DraggableSheetContext | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/skyline/Snapshot.md">
---
title: Snapshot
sidebar_label: Snapshot
---

Snapshot 实例，可通过 SelectorQuery 获取。

Snapshot 通过 id 跟一个 snapshot 组件绑定，操作对应的 snapshot 组件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/skyline/Snapshot.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| width | `number` | 画布宽度 |
| height | `number` | 画布高度 |

### takeSnapshot

对 snapshot 组件子树进行截图

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/skyline/Snapshot.takeSnapshot.html)

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

## 参数

### TakeSnapshot

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| type | `string` | 是 | 截图导出类型，'file' 保存到临时文件目录或 'arraybuffer' 返回图片二进制数据，默认值为 'file' |
| format | `string` | 是 | 截图文件格式，'rgba' 或 'png'，默认值为 'png' |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

#### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tempFilePath | `string` | 截图保存的临时文件路径，当 type 为 file 该字段生效 |
| data | `string` | 截图对应的二进制数据，当 type 为 arraybuffer 该字段生效 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| Snapshot | ✔️ |  |  |  |
</file>

<file path="docs/apis/skyline/worklet.md">
---
title: worklet
sidebar_label: worklet
---

worklet 对象，可以通过 wx.worklet 获取

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/wx.worklet.html)

## 类型

```tsx
worklet
```

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| scrollViewContext | `{ scrollTo(NodesRef: TaroGeneral.IAnyObject, object: Option): void; }` | ScrollView 实例，可在 worklet 函数内操作 scroll-view 组件。<br />[参考地址](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/base/worklet.scrollViewContext.html) |
| Easing | `Easing` |  |

### cancelAnimation

取消由 SharedValue 驱动的动画

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/base/worklet.cancelAnimation.html)

```tsx
(SharedValue: TaroGeneral.IAnyObject) => void
```

| 参数 | 类型 |
| --- | --- |
| SharedValue | `TaroGeneral.IAnyObject` |

### derived

衍生值 DerivedValue，可基于已有的 SharedValue 生成其它共享变量。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/base/worklet.derived.html)

```tsx
(updaterWorklet: TaroGeneral.TFunc) => TaroGeneral.IAnyObject
```

| 参数 | 类型 |
| --- | --- |
| updaterWorklet | `TaroGeneral.TFunc` |

### shared

创建共享变量 SharedValue，用于跨线程共享数据和驱动动画。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/base/worklet.shared.html)

```tsx
(initialValue: any) => TaroGeneral.IAnyObject
```

### decay

基于滚动衰减的动画。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.decay.html)

```tsx
(options?: Option, callback?: (flag: boolean) => void) => TaroGeneral.IAnyObject
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| options | `Option` | 动画配置<br />param: options 动画配置 |
| callback | `(flag: boolean) => void` | 动画完成回调。动画被取消时，返回 fasle，正常完成时返回 true。<br />param: callback 动画完成回调。动画被取消时，返回 fasle，正常完成时返回 true。 |

### spring

基于物理的动画。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.spring.html)

```tsx
(toValue: string | number, options?: Option, callback?: (flag: boolean) => void) => TaroGeneral.IAnyObject
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| toValue | string or number | 目标值<br />param: toValue 目标值 |
| options | `Option` | 动画配置<br />param: options 动画配置 |
| callback | `(flag: boolean) => void` | 动画完成回调。动画被取消时，返回 fasle，正常完成时返回 true。<br />param: callback 动画完成回调。动画被取消时，返回 fasle，正常完成时返回 true。 |

### timing

基于时间的动画。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.timing.html)

```tsx
(toValue: string | number, options?: Option, callback?: (flag: boolean) => void) => TaroGeneral.IAnyObject
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| toValue | string or number | 目标值<br />param: toValue 目标值 |
| options | `Option` | 动画配置<br />param: options 动画配置 |
| callback | `(flag: boolean) => void` | 动画完成回调。动画被取消时，返回 fasle，正常完成时返回 true。<br />param: callback 动画完成回调。动画被取消时，返回 fasle，正常完成时返回 true。 |

### delay

延迟执行动画。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/combine-animation/worklet.delay.html)

```tsx
(delayMS: number, delayedAnimation: TaroGeneral.IAnyObject) => TaroGeneral.IAnyObject
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| delayMS | `number` | 动画开始前等待的时间，单位：毫秒<br />param: delayMS 动画开始前等待的时间，单位：毫秒 |
| delayedAnimation | `TaroGeneral.IAnyObject` | 动画对象<br />param: delayedAnimation 动画对象 |

### repeat

重复执行动画。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/combine-animation/worklet.repeat.html)

```tsx
(delayedAnimation: TaroGeneral.IAnyObject, numberOfReps: number, reverse?: boolean, callback?: (flag: boolean) => void) => TaroGeneral.IAnyObject
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| delayedAnimation | `TaroGeneral.IAnyObject` |  |
| numberOfReps | `number` | 重复次数。为负值时一直循环，直到被取消动画。<br />param: numberOfReps 重复次数。为负值时一直循环，直到被取消动画。 |
| reverse | `boolean` | 反向运行动画，每周期结束动画由尾到头运行。该字段仅对 timing 和 spring 返回的动画对象生效。<br />param: reverse 反向运行动画，每周期结束动画由尾到头运行。该字段仅对 timing 和 spring 返回的动画对象生效。 |
| callback | `(flag: boolean) => void` | 动画完成回调。动画被取消时，返回 fasle，正常完成时返回 true。<br />param: callback 动画完成回调。动画被取消时，返回 fasle，正常完成时返回 true。 |

### sequence

组合动画序列，依次执行传入的动画。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/combine-animation/worklet.sequence.html)

```tsx
(...delayedAnimation: TaroGeneral.IAnyObject) => TaroGeneral.IAnyObject
```

| 参数 | 类型 |
| --- | --- |
| delayedAnimation | `TaroGeneral.IAnyObject` |

### runOnJS

worklet 函数运行在 UI 线程时，捕获的外部函数可能为 worklet 类型或普通函数，为了更明显的对其区分，要求必须使用 runOnJS 调回 JS 线程的普通函数。 有这样的要求是因为，调用其它 worklet 函数时是同步调用，但在 UI 线程执行 JS 线程的函数只能是异步，开发者容易混淆，试图同步获取 JS 线程的返回值。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/tool-function/worklet.runOnJS.html)

```tsx
(fn: TaroGeneral.TFunc) => TaroGeneral.TFunc
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fn | `TaroGeneral.TFunc` | worklet 类型函数<br />param: fn worklet 类型函数 |

### runOnUI

在 UI 线程执行 worklet 函数

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/tool-function/worklet.runOnUI.html)

```tsx
(fn: TaroGeneral.TFunc) => TaroGeneral.TFunc
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fn | `TaroGeneral.TFunc` | worklet 类型函数<br />param: fn worklet 类型函数 |

## 参数

### SharedValue

### DerivedValue

### AnimationObject

### WorkletFunction

### scrollViewContext

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| top | `number` | 否 | 顶部距离 |
| left | `number` | 否 | 左边界距离 |
| duration | `number` | 否 | 滚动动画时长 |
| animated | `boolean` | 否 | 是否启用滚动动画 |
| easingFunction | `string` | 否 | 动画曲线 |

### decay

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| velocity | `number` | 否 | 初速度 |
| deceleration | `number` | 否 | 衰减速率 |
| clamp | `number[]` | 否 | 边界值，长度为 2 的数组 |

### Easing

#### bounce

简单的反弹效果

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.Easing.html)

```tsx
(t: number) => any
```

| 参数 | 类型 |
| --- | --- |
| t | `number` |

#### ease

简单的惯性动画

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.Easing.html)

```tsx
(t: number) => any
```

| 参数 | 类型 |
| --- | --- |
| t | `number` |

#### elastic

简单的弹性动画，类似弹簧来回摆动，高阶函数。默认弹性为 1，会稍微超出一次。弹性为 0 时 不会过冲

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.Easing.html)

```tsx
(bounciness?: number) => any
```

| 参数 | 类型 |
| --- | --- |
| bounciness | `number` |

#### linear

线性函数

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.Easing.html)

```tsx
(t: number) => any
```

| 参数 | 类型 |
| --- | --- |
| t | `number` |

#### quad

二次方函数

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.Easing.html)

```tsx
(t: number) => any
```

| 参数 | 类型 |
| --- | --- |
| t | `number` |

#### cubic

立方函数

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.Easing.html)

```tsx
(t: number) => any
```

| 参数 | 类型 |
| --- | --- |
| t | `number` |

#### poly

高阶函数，返回幂函数

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.Easing.html)

```tsx
(n: number) => any
```

| 参数 | 类型 |
| --- | --- |
| n | `number` |

#### bezier

三次贝塞尔曲线，效果同 css transition-timing-function

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.Easing.html)

```tsx
(x1: number, y1: number, x2: number, y2: number) => any
```

| 参数 | 类型 |
| --- | --- |
| x1 | `number` |
| y1 | `number` |
| x2 | `number` |
| y2 | `number` |

#### circle

圆形曲线

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.Easing.html)

```tsx
(t: number) => any
```

| 参数 | 类型 |
| --- | --- |
| t | `number` |

#### sin

正弦函数

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.Easing.html)

```tsx
(t: number) => any
```

| 参数 | 类型 |
| --- | --- |
| t | `number` |

#### exp

指数函数

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.Easing.html)

```tsx
(t: number) => any
```

| 参数 | 类型 |
| --- | --- |
| t | `number` |

#### in

正向运行 easing function，高阶函数。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.Easing.html)

```tsx
(easing: (t: number) => any) => any
```

| 参数 | 类型 |
| --- | --- |
| easing | `(t: number) => any` |

#### out

反向运行 easing function，高阶函数。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.Easing.html)

```tsx
(easing: (t: number) => any) => any
```

| 参数 | 类型 |
| --- | --- |
| easing | `(t: number) => any` |

#### inOut

前半程正向，后半程反向，高阶函数。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/worklet/animation/worklet.Easing.html)

```tsx
(easing: (t: number) => any) => any
```

| 参数 | 类型 |
| --- | --- |
| easing | `(t: number) => any` |

### spring

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| damping | `number` | 否 | 阻尼系数 |
| mass | `number` | 否 | 重量系数，值越大移动越慢 |
| stiffness | `number` | 否 | 弹性系数 |
| overshootClamping | `boolean` | 否 | 动画是否可以在指定值上反弹 |
| restDisplacementThreshold | `number` | 否 | 弹簧静止时的位移 |
| restSpeedThreshold | `number` | 否 | 弹簧静止的速度 |
| velocity | `number` | 否 | 速度 |

### timing

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| duration | `number` | 否 | 动画时长 |
| easing | `(t: number) => number` | 否 | 动画曲线 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| worklet | ✔️ |  |  |  |
</file>

<file path="docs/apis/storage/background-fetch/getBackgroundFetchData.md">
---
title: Taro.getBackgroundFetchData(option)
sidebar_label: getBackgroundFetchData
---

拉取 backgroundFetch 客户端缓存数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/background-fetch/wx.getBackgroundFetchData.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| fetchType | `string` | 是 | 缓存数据类别<br />weapp: 取值为 periodic<br />qq: 取值为 periodic<br />alipay: 取值为 pre: 数据预拉取; jsapiPre: API 预调用（目前仅支持地理位置预拉取） |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| fetchedData | string or Object | 是 | 缓存数据<br />alipay: Object |
| timeStamp | `number` | 是 | 客户端拿到缓存数据的时间戳 ms。(iOS 时间戳存在异常，8.0.27 修复) |
| path | `string` | 是 | 小程序页面路径 |
| query | `string` | 是 | 传给页面的 query 参数 |
| scene | `number` | 是 | 进入小程序的场景值 |
| fetchType | `string` | 否 | 缓存数据类型，与入参 fetchType 一致<br />API 支持度: alipay |
| timestamp | `number` | 否 | 缓存数据的时间戳。单位：ms。<br />API 支持度: alipay |
</file>

<file path="docs/apis/storage/background-fetch/getBackgroundFetchToken.md">
---
title: Taro.getBackgroundFetchToken(option)
sidebar_label: getBackgroundFetchToken
---

获取设置过的自定义登录态。若无，则返回 fail。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/background-fetch/wx.getBackgroundFetchToken.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| token | `string` | 自定义的登录态 |
| errMsg | `string` | 接口调用结果 |
</file>

<file path="docs/apis/storage/background-fetch/onBackgroundFetchData.md">
---
title: Taro.onBackgroundFetchData(option)
sidebar_label: onBackgroundFetchData
---

收到 backgroundFetch 数据时的回调

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/background-fetch/wx.onBackgroundFetchData.html)

## 类型

```tsx
(option?: Option | Callback) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | Option or Callback |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### Callback

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fetchType | `string` | 缓存数据类别，取值为 periodic 或 pre |
| fetchedData | `string` | 缓存数据 |
| timeStamp | `number` | 客户端拿到缓存数据的时间戳 |
| path | `string` | 小程序页面路径 |
| query | `string` | 传给页面的 query 参数 |
| scene | `number` | 进入小程序的场景值 |
</file>

<file path="docs/apis/storage/background-fetch/setBackgroundFetchToken.md">
---
title: Taro.setBackgroundFetchToken(option)
sidebar_label: setBackgroundFetchToken
---

设置自定义登录态，在周期性拉取数据时带上，便于第三方服务器验证请求合法性

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/background-fetch/wx.setBackgroundFetchToken.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| token | `string` | 是 | 自定义的登录态 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/storage/cache-manager/CacheManager.md">
---
title: CacheManager
sidebar_label: CacheManager
---

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| mode | `keyof Mode` | 当前缓存模式 |
| origin | `string` | 全局 origin |
| maxAge | `number` | 全局缓存有效时间 |
| state | `keyof State` | 当前缓存管理器状态 |

### addRule

添加规则

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/cachemanager/CacheManager.addRule.html)

```tsx
(option: AddRuleOption) => string
```

| 参数 | 类型 |
| --- | --- |
| option | `AddRuleOption` |

#### 示例代码

```tsx
const ruleId = cacheManager.addRule({
  id: 'haha-rule',
  method: 'GET',
  url: '/haha',
  maxAge: 123455,
  dataSchema: [
    // data 字段的匹配，默认为空，表示不匹配
    // 类型可以是：string、number、boolean、null、object、any（表示任意类型均可），以及这些类型的数组表示方式
    {name: 'aaa', schema: {type: 'string'}}, // 类型为 string
    {name: 'bbb', schema: [{type: 'number'}, {type: 'string'}]}, // 类型为 number, string
    {name: 'ccc', schema: {type: 'string', value: 'abc'}}, // 值为 abc
    {name: 'ddd', schema: {type: 'string', value: /(abc|cba)/ig}}, // 值符合该正则匹配，如果该值不是字符串类型，则会被尝试转成字符串后再进行比较
    {name: 'ddd', schema: {type: 'string', value: val => val === '123'}}, // 传入函数来校验值
    {name: 'eee', schema: {type: 'object', value: [{ // 类型为对象，则通过嵌套的方式来逐层校验
      name: 'aaa', schema: {type: 'string'},
      // ...
      // 嵌套 dataSchema，同上面的方式一样来匹配嵌套的对象
    }]}},
    {name: 'fff', schema: {type: 'string[]'}}, // 类型为 string 数组
    {name: 'ggg', schema: {type: 'any'}}, // 类型为任意类型
    {name: 'hhh', schema: {type: 'any[]'}}, // 类型为任意类型的数组
  ]
})
```

### addRules

批量添加规则

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/cachemanager/CacheManager.addRules.html)

```tsx
(option: AddRulesOption) => string[]
```

| 参数 | 类型 |
| --- | --- |
| option | `AddRulesOption` |

### clearCaches

清空所有缓存

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/cachemanager/CacheManager.clearCaches.html)

```tsx
() => void
```

### clearRules

清空所有规则，同时会删除对应规则下所有缓存

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/cachemanager/CacheManager.clearRules.html)

```tsx
() => void
```

### deleteCache

删除缓存

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/cachemanager/CacheManager.deleteCache.html)

```tsx
(id: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `string` | 缓存 id |

### deleteCaches

批量删除缓存

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/cachemanager/CacheManager.deleteCaches.html)

```tsx
(ids: string[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| ids | `string[]` | 缓存 id 列表 |

### deleteRule

删除规则，同时会删除对应规则下所有缓存

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/cachemanager/CacheManager.deleteRule.html)

```tsx
(id: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `string` | 规则 id |

### deleteRules

批量删除规则，同时会删除对应规则下所有缓存

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/cachemanager/CacheManager.deleteRules.html)

```tsx
(ids: string[]) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| ids | `string[]` | 规则 id 列表 |

### match

匹配命中的缓存规则，一般需要和 request 事件搭配使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/cachemanager/CacheManager.match.html)

```tsx
(option: MatchOption) => MatchResult
```

| 参数 | 类型 |
| --- | --- |
| option | `MatchOption` |

### off

取消事件监听

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/cachemanager/CacheManager.off.html)

```tsx
(eventName: string, handler: TaroGeneral.EventCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| eventName | `string` | 事件名称 |
| handler | `TaroGeneral.EventCallback` | 事件监听函数 |

### on

监听事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/cachemanager/CacheManager.on.html)

```tsx
(eventName: keyof OnEventName, handler: TaroGeneral.EventCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| eventName | `keyof OnEventName` | 事件名称 |
| handler | `TaroGeneral.EventCallback` | 事件监听函数 |

### start

开启缓存，仅在 mode 为 none 时生效，调用后缓存管理器的 state 会置为 1

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/cachemanager/CacheManager.start.html)

```tsx
() => void
```

### stop

关闭缓存，仅在 mode 为 none 时生效，调用后缓存管理器的 state 会置为 0

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/cachemanager/CacheManager.stop.html)

```tsx
() => void
```

## 参数

### Mode

| 参数 | 说明 |
| --- | --- |
| weakNetwork | 默认值，弱网/离线使用缓存返回 |
| always | 总是使用缓存返回 |
| none | 不开启，后续可手动开启/停止使用缓存返回 |

### State

| 参数 | 说明 |
| --- | --- |
| 0 | 不使用缓存返回 |
| 1 | 使用缓存返回 |
| 2 | 未知 |

### DataSchema

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| type | `string` | 是 | 需要匹配的 data 对象的参数类型<br />string、number、boolean、null、object、any（表示任意类型），<br />同时支持数组模式（数组模式则在类型后面加 []，如 string[] 表示字符串数组） |
| value | string or Function or RegExp or DataRule[] | 否 | 需要匹配的 data 对象的参数值<br />当 type 为基本类型时，可以用 string/regexp 来匹配固定的值，<br />也可以通过 function 来确定值是否匹配，<br />如果传入的 type 是 object，那么表示需要嵌套匹配值是否正确，可以传入 Array |

### DataRule

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| name | `string` | 需要匹配的参数名 |
| schema | DataSchema or DataSchema[] |  |

### RuleObject

| 参数 | 类型 | 默认值 | 说明 |
| --- | --- | :---: | --- |
| id | `string` |  | 规则 id，如果不填则会由基础库生成 |
| method | `string` |  | 请求方法，可选值 GET/POST/PATCH/PUT/DELETE，如果为空则表示前面提到的所有方法都能被匹配到 |
| url | `any` |  | uri 匹配规则，可参考规则字符串写法和正则写法 |
| maxAge | `number` | `7 * 24 * 60 * 60 * 1000` | 缓存有效时间，单位为 ms，不填则默认取缓存管理器全局的缓存有效时间 |
| dataSchema | `DataRule[]` |  | 匹配请求参数 |

### Rule

### AddRuleOption

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| rule | `Rule` | 规则 |

### AddRulesOption

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| rules | `Rule[]` | 规则列表 |

### MatchOption

| 参数 | 说明 |
| --- | --- |
| evt | request 事件对象 |

### MatchResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| ruleId | `string` | 命中的规则id |
| cacheId | `string` | 缓存id |
| data | `any` | 缓存内容，会带有 fromCache 标记，方便开发者区分内容是否来自缓存 |
| createTime | `number` | 缓存创建时间 |
| maxAge | `number` | 缓存有效时间 |

### OnEventName

| 参数 | 说明 |
| --- | --- |
| request | 发生 wx.request 请求，只在缓存管理器开启阶段会触发 |
| enterWeakNetwork | 进入弱网/离线状态 |
| exitWeakNetwork | 离开弱网/离线状态 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| CacheManager.addRule | ✔️ |  |  |  |  |
| CacheManager.addRules | ✔️ |  |  |  |  |
| CacheManager.clearCaches | ✔️ |  |  |  |  |
| CacheManager.clearRules | ✔️ |  |  |  |  |
| CacheManager.deleteCache | ✔️ |  |  |  |  |
| CacheManager.deleteCaches | ✔️ |  |  |  |  |
| CacheManager.deleteRule | ✔️ |  |  |  |  |
| CacheManager.deleteRules | ✔️ |  |  |  |  |
| CacheManager.match | ✔️ |  |  |  |  |
| CacheManager.off | ✔️ |  |  |  |  |
| CacheManager.on | ✔️ |  |  |  |  |
| CacheManager.start | ✔️ |  |  |  |  |
| CacheManager.stop | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/storage/cache-manager/createCacheManager.md">
---
title: Taro.createCacheManager(option)
sidebar_label: createCacheManager
---

创建缓存管理器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/cachemanager/wx.createCacheManager.html)

## 类型

```tsx
(option: Option) => CacheManager
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Mode

| 参数 | 说明 |
| --- | --- |
| weakNetwork | 弱网/离线使用缓存返回 |
| always | 总是使用缓存返回 |
| none | 不开启，后续可手动开启/停止使用缓存返回 |

### Extra

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| apiList | `string[]` | 否 | 需要缓存的 wx api 接口，不传则表示支持缓存的接口全都做缓存处理。返回的如果是缓存数据，开发者可通过 fromCache 标记区分 |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| origin | `string` | 否 | 全局 origin |
| mode | `keyof Mode` | 否 | 缓存模式 |
| maxAge | `number` | 否 | 全局缓存有效时间，单位为毫秒，默认为 7 天，最长不超过 30 天 |
| extra | `Extra` | 否 | 额外的缓存处理 |
</file>

<file path="docs/apis/storage/batchGetStorage.md">
---
title: Taro.batchGetStorage(option)
sidebar_label: batchGetStorage
---

从本地缓存中异步批量获取指定 key 的内容。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.batchGetStorage.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| keyList | `string[]` | 是 | 本地缓存中指定的 keyList |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.batchGetStorage({
  keyList: ['key'],
  success(res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/storage/batchGetStorageSync.md">
---
title: Taro.batchGetStorageSync(keyList)
sidebar_label: batchGetStorageSync
---

从本地缓存中同步批量获取指定 key 的内容。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.batchGetStorageSync.html)

## 类型

```tsx
<T = any>(keyList: string[]) => T[]
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| keyList | `T` | 本地缓存中指定的 key 数组 |

## 示例代码

```tsx
try {
  var valueList = Taro.batchGetStorageSync(['key'])
  if (valueList) {
    // Do something with return value
  }
} catch (e) {
  // Do something when catch error
}
```
</file>

<file path="docs/apis/storage/batchSetStorage.md">
---
title: Taro.batchSetStorage(option)
sidebar_label: batchSetStorage
---

将数据批量存储在本地缓存中指定的 key 中。会覆盖掉原来该 key 对应的内容。
除非用户主动删除或因存储空间原因被系统清理，否则数据都一直可用。
单个 key 允许存储的最大数据长度为 1MB，所有数据存储上限为 10MB。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.batchGetStorage.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| kvList | `kv[]` | 是 | [{ key, value }] |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### kv

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| key | `string` | key 本地缓存中指定的 key |
| value | `any` | data 需要存储的内容。只支持原生类型、Date、及能够通过JSON.stringify序列化的对象。 |

## 示例代码

```tsx
Taro.batchGetStorage({
  keyList: ['key']
  success(res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/storage/batchSetStorageSync.md">
---
title: Taro.batchSetStorageSync(option)
sidebar_label: batchSetStorageSync
---

将数据批量存储在本地缓存中指定的 key 中。
会覆盖掉原来该 key 对应的内容。除非用户主动删除或因存储空间原因被系统清理，否则数据都一直可用。
单个 key 允许存储的最大数据长度为 1MB，所有数据存储上限为 10MB。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.batchGetStorageSync.html)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| kvList | `kv[]` | [{ key, value }] |

### kv

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| key | `string` | key 本地缓存中指定的 key |
| value | `any` | data 需要存储的内容。只支持原生类型、Date、及能够通过JSON.stringify序列化的对象。 |

## 示例代码

```tsx
try {
  Taro.batchSetStorageSync([{key: 'key', value: 'value'}])
} catch (e) { }
```
</file>

<file path="docs/apis/storage/clearStorage.md">
---
title: Taro.clearStorage(option)
sidebar_label: clearStorage
---

清理本地数据缓存

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.clearStorage.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.clearStorage()
```
</file>

<file path="docs/apis/storage/clearStorageSync.md">
---
title: Taro.clearStorageSync()
sidebar_label: clearStorageSync
---

Taro.clearStorage 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.clearStorageSync.html)

## 类型

```tsx
() => void
```

## 示例代码

```tsx
try {
  Taro.clearStorageSync()
} catch(e) {
// Do something when catch error
}
```
</file>

<file path="docs/apis/storage/createBufferURL.md">
---
title: Taro.createBufferURL(buffer)
sidebar_label: createBufferURL
---

根据传入的 buffer 创建一个唯一的 URL 存在内存中

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.createBufferURL.html)

## 类型

```tsx
(buffer: TypedArray | ArrayBuffer) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| buffer | TypedArray or ArrayBuffer | 需要存入内存的二进制数据 |
</file>

<file path="docs/apis/storage/getStorage.md">
---
title: Taro.getStorage(option)
sidebar_label: getStorage
---

从本地缓存中异步获取指定 key 的内容

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.getStorage.html)

## 类型

```tsx
<T = any>(option: Option<T>) => Promise<SuccessCallbackResult<T>>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `T` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| key | `string` | 是 | 本地缓存中指定的 key |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(result: SuccessCallbackResult<T>) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | `T` | key对应的内容 |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
Taro.getStorage({
  key: 'key',
  success: function (res) {
    console.log(res.data)
  }
})
```
</file>

<file path="docs/apis/storage/getStorageInfo.md">
---
title: Taro.getStorageInfo(option)
sidebar_label: getStorageInfo
---

异步获取当前storage的相关信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.getStorageInfo.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(option: SuccessCallbackOption) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackOption

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| currentSize | `number` | 当前占用的空间大小, 单位 KB |
| keys | `string[]` | 当前 storage 中所有的 key |
| limitSize | `number` | 限制的空间大小，单位 KB |

## 示例代码

```tsx
Taro.getStorageInfo({
  success: function (res) {
    console.log(res.keys)
    console.log(res.currentSize)
    console.log(res.limitSize)
  }
})
```
</file>

<file path="docs/apis/storage/getStorageInfoSync.md">
---
title: Taro.getStorageInfoSync()
sidebar_label: getStorageInfoSync
---

Taro.getStorageInfo 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.getStorageInfoSync.html)

## 类型

```tsx
() => Option
```

## 参数

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| currentSize | `number` | 是 | 当前占用的空间大小, 单位 KB |
| keys | `string[]` | 是 | 当前 storage 中所有的 key |
| limitSize | `number` | 是 | 限制的空间大小，单位 KB |
| success | `boolean` | 否 | 是否执行成功<br />API 支持度: alipay |

## 示例代码

```tsx
try {
  const res = Taro.getStorageInfoSync()
  console.log(res.keys)
  console.log(res.currentSize)
  console.log(res.limitSize)
} catch (e) {
  // Do something when catch error
}
```
</file>

<file path="docs/apis/storage/getStorageSync.md">
---
title: Taro.getStorageSync(key)
sidebar_label: getStorageSync
---

Taro.getStorage 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.getStorageSync.html)

## 类型

```tsx
<T = any>(key: string) => T
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| key | `T` | 本地缓存中指定的 key |

## 示例代码

```tsx
try {
  var value = Taro.getStorageSync('key')
  if (value) {
    // Do something with return value
  }
} catch (e) {
  // Do something when catch error
}
```
</file>

<file path="docs/apis/storage/removeStorage.md">
---
title: Taro.removeStorage(option)
sidebar_label: removeStorage
---

从本地缓存中移除指定 key

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.removeStorage.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| key | `string` | 是 | 本地缓存中指定的 key |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.removeStorage({
  key: 'key',
  success: function (res) {
    console.log(res)
  }
})
```
</file>

<file path="docs/apis/storage/removeStorageSync.md">
---
title: Taro.removeStorageSync(key)
sidebar_label: removeStorageSync
---

Taro.removeStorage 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.removeStorageSync.html)

## 类型

```tsx
(key: string) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| key | `string` | 本地缓存中指定的 key |

## 示例代码

```tsx
try {
  Taro.removeStorageSync('key')
} catch (e) {
  // Do something when catch error
}
```
</file>

<file path="docs/apis/storage/revokeBufferURL.md">
---
title: Taro.revokeBufferURL(url)
sidebar_label: revokeBufferURL
---

根据 URL 销毁存在内存中的数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.revokeBufferURL.html)

## 类型

```tsx
(url: string) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| url | `string` | 需要销毁的二进制数据 URL |
</file>

<file path="docs/apis/storage/setStorage.md">
---
title: Taro.setStorage(option)
sidebar_label: setStorage
---

将数据存储在本地缓存中指定的 key 中。会覆盖掉原来该 key 对应的内容。除非用户主动删除或因存储空间原因被系统清理，否则数据都一直可用。单个 key 允许存储的最大数据长度为 1MB，所有数据存储上限为 10MB。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.setStorage.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| data | `any` | 是 | 需要存储的内容。只支持原生类型、Date、及能够通过`JSON.stringify`序列化的对象。 |
| key | `string` | 是 | 本地缓存中指定的 key |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.setStorage({
  key:"key",
  data:"value"
})
```
```tsx
try {
  Taro.setStorageSync('key', 'value')
} catch (e) { }
```
</file>

<file path="docs/apis/storage/setStorageSync.md">
---
title: Taro.setStorageSync(key, data)
sidebar_label: setStorageSync
---

Taro.setStorage 的同步版本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.setStorageSync.html)

## 类型

```tsx
(key: string, data: any) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| key | `string` | 本地缓存中指定的 key |
| data | `any` | 需要存储的内容。只支持原生类型、Date、及能够通过`JSON.stringify`序列化的对象。 |

## 示例代码

### 示例 1

```tsx
Taro.setStorage({
  key:"key",
  data:"value"
})
```

### 示例 2

```tsx
try {
  Taro.setStorageSync('key', 'value')
} catch (e) { }
```
</file>

<file path="docs/apis/swan/bookshelf/deleteBookshelf.md">
---
title: Taro.deleteBookshelf(option)
sidebar_label: deleteBookshelf
---

删除书架中的内容（需宿主支持书架入口)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-deleteBookshelf/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| category | `string` | 是 | 要删除的内容分类 |
| contentIds | `string[]` | 是 | 要删除书架内容的 id，支持传多个，最多 100 条；注释：contentId 为内容 id，内容的唯一标识，自定义，最长 22 字符（不能含有空格、中文字符）。支持批量删除的同一个 category 下的多个 id，不同 category 下的 id 请分别调用该接口删除 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### Category

| 参数 | 说明 |
| --- | --- |
| article | 专栏模板 |
| doc | 文档模板 |
| cartoon | 动漫模板 |
| av | 影音模板 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| list | `IListItem[]` | 添加到书架的结果列表 |

### IListItem

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| contentId | `string` | 内容的唯一标识 |
| status | `keyof Status` | 删除状态：值为 0 时是失败，为 1 时是成功 |
| msg | `string` | 删除信息 |

### Status

| 参数 | 说明 |
| --- | --- |
| 0 | 失败 |
| 1 | 成功 |

## 示例代码

```tsx
Taro.deleteBookshelf({
  category: 'doc',
  contentIds: ['test1', 'test2'],
  success(res) {
    Taro.showModal({
      title: 'success',
      content: JSON.stringify(res)
    })
  },
  fail(err) {
    Taro.showModal({
      title: 'fail',
      content: JSON.stringify(err)
    })
  }
})
```
</file>

<file path="docs/apis/swan/bookshelf/insertBookshelf.md">
---
title: Taro.insertBookshelf(option)
sidebar_label: insertBookshelf
---

添加内容到宿主书架

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> 百度小程序: （需宿主支持书架入口）

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-insertBookshelf/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| category | `string` | 是 | 添加的内容分类 |
| contentIds | `string[]` | 是 | 要添加到书架内容的 id，支持传多个，最多 100 条；注释：contentId 为内容 id，内容的唯一标识，自定义，最长 22 字符（不能含有空格、中文字符） |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### Category

| 参数 | 说明 |
| --- | --- |
| article | 专栏模板 |
| doc | 文档模板 |
| cartoon | 动漫模板 |
| av | 影音模板 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| list | `IListItem[]` | 添加到书架的结果列表 |

### IListItem

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| contentId | `string` | 内容的唯一标识 |
| status | `keyof Status` | 添加状态：值为 0 时是失败，为 1 时是成功 |
| msg | `string` | 添加信息 |

### Status

| 参数 | 说明 |
| --- | --- |
| 0 | 失败 |
| 1 | 成功 |

## 示例代码

```tsx
Taro.insertBookshelf({
  category: 'doc',
  contentIds: ['test1', 'test2'],
  success(res) {
    Taro.showModal({
      title: 'success',
      content: JSON.stringify(res)
    })
  },
  fail(err) {
    Taro.showModal({
      title: 'fail',
      content: JSON.stringify(err)
    })
  }
})
</file>

<file path="docs/apis/swan/bookshelf/navigateToBookshelf.md">
---
title: Taro.navigateToBookshelf(option)
sidebar_label: navigateToBookshelf
---

跳转到宿主书架

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> 百度小程序: （需宿主支持书架入口）

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-navigateToBookshelf/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| category | `string` | 是 | 跳转到指定的内容分类<br />API 支持度: swan |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### Category

| 参数 | 说明 |
| --- | --- |
| article | 专栏模板 |
| doc | 文档模板 |
| cartoon | 动漫模板 |
| av | 影音模板 |

## 示例代码

```tsx
Taro.navigateToBookshelf({
  category: 'article',
  contentIds: 'test1',
  success(res) {
    Taro.showModal({
      title: 'navigateToBookshelf',
      content: 'success'
    })
  },
  fail(err) {
    Taro.showModal({
      title: 'fail',
      content: JSON.stringify(err)
    })
  }
})
</file>

<file path="docs/apis/swan/bookshelf/queryBookshelf.md">
---
title: Taro.queryBookshelf(option)
sidebar_label: queryBookshelf
---

查询宿主书架的相关内容

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> 百度小程序: （需宿主支持书架入口）

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-queryBookshelf/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| contentIds | `string[]` | 是 | 要查询内容的 id，支持传多个，最多 100 条；注释：contentId 为内容 id，内容的唯一标识，自定义，最长 22 字符（不能含有空格、中文字符） |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| list | `IListItem[]` | 查询的内容结果列表 |

### IListItem

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| contentId | `string` | 内容的唯一标识 |
| status | `keyof Status` | 状态 |

### Status

| 参数 | 说明 |
| --- | --- |
| 0 | 不存在 |
| 1 | 存在 |

## 示例代码

```tsx
Taro.queryBookshelf({
  contentIds: ['test1', 'test2'],
  success(res) {
    Taro.showModal({
      title: 'success',
      content: JSON.stringify(res)
    })
  },
  fail(err) {
    Taro.showModal({
      title: 'fail',
      content: JSON.stringify(err)
    })
  }
})
```
</file>

<file path="docs/apis/swan/bookshelf/updateBookshelfReadTime.md">
---
title: Taro.updateBookshelfReadTime(option)
sidebar_label: updateBookshelfReadTime
---

更新已加入宿主书架的内容的阅读时间

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> 百度小程序: （需宿主支持书架入口）

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-queryBookshelf/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| category | `string` | 是 | 添加的内容分类 |
| contentIds | `string[]` | 是 | 要更新内容的 id；注释：contentId 为内容 id，内容的唯一标识，自定义，最长 22 字符（不能含有空格、中文字符） |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### Category

| 参数 | 说明 |
| --- | --- |
| article | 专栏模板 |
| doc | 文档模板 |
| cartoon | 动漫模板 |
| av | 影音模板 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| status | `keyof Status` | 更新状态 |
| msg | `string` | 更新的结果信息 |

### Status

| 参数 | 说明 |
| --- | --- |
| 0 | 失败 |
| 1 | 成功 |

## 示例代码

```tsx
Taro.updateBookshelfReadTime({
  category: 'doc',
  contentIds: 'test1',
  success(res) {
    Taro.showModal({
      title: 'success',
      content: JSON.stringify(res)
    })
  },
  fail(err) {
    Taro.showModal({
      title: 'fail',
      content: JSON.stringify(err)
    })
  }
})
</file>

<file path="docs/apis/swan/download-package/downloadPackage.md">
---
title: Taro.downloadPackage(option)
sidebar_label: downloadPackage
---

针对在小程序中调用其他小程序的场景，预下载其他小程序的包内容。
Web 态说明：Web 态不支持预下载的能力。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-downloadPackage/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| appKey | `string` | 是 | 预下载的小程序的 appKey |
| pageUrl | `string` | 否 | 预下载的小程序的 pageUrl ，默认值为小程序的首页页面 |
| success | `(res: TaroGeneral.CallbackResult) => any` | 否 | 接口调用成功的回调函数 |
| fail | `(err: TaroGeneral.CallbackResult) => any` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => any` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
</file>

<file path="docs/apis/swan/download-package/downloadPackages.md">
---
title: Taro.downloadPackages(option)
sidebar_label: downloadPackages
---

针对在小程序中调用其他小程序的场景，预下载其他小程序的包内容。
Web 态说明：Web 态不支持预下载的能力。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-downloadPackages/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| pageList | `IPageItem[]` | 是 | 预下载的小程序的列表。 |
| success | `(res: SuccessCallbackResult) => any` | 否 | 接口调用成功的回调函数 |
| fail | `(err: TaroGeneral.CallbackResult) => any` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => any` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### IPageItem

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| appKey | `string` | 预下载的小程序的 appKey |
| pages | `string[]` | 页面路径 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| __index | `__index` | 小程序包预下载结果回调 |

### IAppKeyResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| pageUrl | `string` | 页面路径 |
| status | `string` | 预下载能力调用结果。值为 "0" 时是成功，非 "0" 时是失败 |
| message | `string` | 预下载结果信息 |
</file>

<file path="docs/apis/swan/download-package/loadSubPackage.md">
---
title: Taro.loadSubPackage(option)
sidebar_label: loadSubPackage
---

提前下载好子包的资源，目录结构配置参考[分包加载](https://smartprogram.baidu.com/docs/develop/framework/subpackages/)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-loadSubPackage/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| success | `(res: TaroGeneral.CallbackResult) => any` | 否 | 接口调用成功的回调函数 |
| fail | `(err: TaroGeneral.CallbackResult) => any` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => any` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
</file>

<file path="docs/apis/swan/pay/getOptimalPriceInfo.md">
---
title: Taro.getOptimalPriceInfo(option)
sidebar_label: getOptimalPriceInfo
---

获取商品使用百度平台券后的价格
通过百度收银台支付的商品，用户在支付时可以享受百度平台券提供的优惠。
使用 API swan.getOptimalPriceInfo 可以提前获知用户在支付时享受的优惠价格。（当用户有多张平台券时，按照平台最优优惠价格计算，与支付时默认选中的优惠券对应的优惠一致）

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/payment_swan-getOptimalPriceInfo/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| productsInfo | `ProductInfo[]` | 是 | 商品信息 |
| success | `(res: SuccessCallbackResult) => any` | 否 | 接口调用成功的回调函数 |
| fail | `(err: TaroGeneral.CallbackResult) => any` | 否 | 接口调用失败的回调函数 |

### ProductInfo

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| appKey | `string` | 支付的 appKey |
| products | `Product[]` | 商品信息 |

### Product

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| amount | `number` | 是 | 商品单价(原价) |
| promotionTag | `string` | 否 | 商品标识 |
| productId | `string` | 是 | 开发者自定义商品 ID，在success回调中，会与减免信息一起返回。 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| productsInfo | `ProductInfoSuccess[]` | 商品信息 |

### ProductInfoSuccess

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| appKey | `string` | 支付的 appKey |
| products | `ProductSuccess[]` | 减免后的商品信息 |

### ProductSuccess

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| amount | `number` | 商品单价(原价) |
| productId | `string` | 开发者自定义商品 ID |
| promotionTag | `string` | 商品标识 |
| reduceAmount | `number` | 百度平台券减免金额 |
| afterPayAmount | `number` | 百度平台券减免后金额 |
</file>

<file path="docs/apis/swan/pay/requestPolymerPayment.md">
---
title: Taro.requestPolymerPayment(option)
sidebar_label: requestPolymerPayment
---

1）百度收银台，聚合了主流的百度钱包、微信、支付宝、网银等多种支付渠道，方便开发者一站式快速接入多种支付渠道，让百度用户能在智能小程序场景下，直接完成支付、交易闭环，提升用户支付体验的同时，提高智能小程序的订单转化率。
2）上述支付渠道在 C 端收银台有两种展示方式，开发者可以选择其中一种实现。
方式一：将支付渠道内嵌在小程序提单页面中，实现方式参考文档[inline-payment-panel内嵌支付组件](https://smartprogram.baidu.com/docs/develop/component/inline_payment_panel/)。
方式二：在用户确认订单后，调起收银台半屏面板承载支付渠道，实现方式参考文档调起[百度收银台](https://smartprogram.baidu.com/docs/develop/function/tune_up_2.0/#%E7%99%BE%E5%BA%A6%E6%94%B6%E9%93%B6%E5%8F%B0%E6%8E%A5%E5%8F%A32-0-%E8%AF%B4%E6%98%8E)。

Web 态说明：为了保证用户交易行为全流程闭环体验，在 Web 态下调用该方法会做打开百度 App 对应小程序页面的降级处理。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/payment_swan-requestPolymerPayment/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| orderInfo | `OrderInfo` | 是 | 订单信息 |
| success | `(res: TaroGeneral.CallbackResult) => any` | 否 | 接口调用成功的回调函数 |
| fail | `(err: FailCallbackResult) => any` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => any` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### OrderInfo

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| dealId | `string` | 是 | 跳转百度收银台支付必带参数之一，是百度收银台的财务结算凭证，与账号绑定的结算协议一一对应，每笔交易将结算到 dealId 对应的协议主体。<br />详见[核心参数获取与组装](https://smartprogram.baidu.com/docs/develop/function/parameter/)。 |
| appKey | `string` | 是 | 支付能力开通后分配的支付 appKey，用以表示应用身份的唯一 ID ，在应用审核通过后进行分配，一经分配后不会发生更改，来唯一确定一个应用。<br />详见[核心参数获取与组装](https://smartprogram.baidu.com/docs/develop/function/parameter/)。 |
| totalAmount | `string` | 是 | 订单金额（单位：人民币分）。注：小程序测试包测试金额不可超过 1000 分 |
| tpOrderId | `string` | 是 | 小程序开发者系统创建的唯一订单 ID ，当支付状态发生变化时，会通过此订单 ID 通知开发者。 |
| notifyUrl | `string` | 否 | 通知开发者支付状态的回调地址，必须是合法的 URL ，与开发者平台填写的支付回调地址作用一致，未填写的以平台回调地址为准 |
| dealTitle | `string` | 是 | 订单的名称。 |
| signFieldsRange | `string` | 是 | 用于区分验签字段范围，signFieldsRange 的值：0：原验签字段 appKey+dealId+tpOrderId；1：包含 totalAmount 的验签，验签字段包括appKey+dealId+tpOrderId+totalAmount。固定值为 1 。 |
| rsaSign | `string` | 是 | 对appKey+dealId+totalAmount+tpOrderId进行 RSA 加密后的签名，防止订单被伪造。<br />签名过程见[签名与验签](https://smartprogram.baidu.com/docs/develop/function/sign_v2/)。 |
| bizInfo | `string` | 否 | 订单详细信息，需要是一个可解析为 JSON Object 的字符串。<br />字段内容见： [bizInfo 组装](https://smartprogram.baidu.com/docs/develop/function/parameter/#%E9%80%9A%E7%94%A8%E5%8F%82%E6%95%B0%E7%BB%84%E8%A3%85)。 |
| payResultUrl | `string` | 否 | 当前页面 path。Web 态小程序支付成功后跳回的页面路径，例如：'/pages/payResult/payResult' |
| inlinePaySign | `string` | 否 | 内嵌支付组件返回的支付信息加密 key，与[内嵌支付组件](https://smartprogram.baidu.com/docs/develop/component/inline_payment_panel)配套使用，此值不传或者传空时默认调起支付面板。 |
| promotionTag | `string` | 否 | 平台营销信息，此处传可使用平台券的 spuid，支持通过英文逗号分割传入多个 spuid 值，仅与百度合作平台类目券的开发者需要填写 |

### FailCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errCode | `number` | 错误码 |
| data | `DetailFailData` | 详细错误信息。<br />注: 目前仅在内嵌支付组件调起 swan.requestPolymerPayment 时，选择数字人民币 APP 渠道支付且用户未下载数字人民币 APP 时，返回具体错误信息 data。 |

### DetailFailData

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| subErrCode | `number` | 详细错误码。20014 表示【未下载数字人民币 APP】 |
| subErrMsg | `string` | 详细错误信息 |
</file>

<file path="docs/apis/swan/getFavorStatus.md">
---
title: Taro.getFavorStatus(option)
sidebar_label: getFavorStatus
---

获取小程序用户关注状态。
Web 态说明：Web 态小程序暂不支持关注小程序。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-getFavorStatus/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| success | `(res: SuccessCallbackResult) => any` | 否 | 接口调用成功的回调函数 |
| fail | `(err: any) => any` | 否 | 接口调用失败的回调函数 |
| complete | `(res: any) => any` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| isFavor | `string` | 用户关注关注状态，1表示已关注，0表示未关注 |
</file>

<file path="docs/apis/swan/getSystemRiskInfo.md">
---
title: Taro.getSystemRiskInfo(option)
sidebar_label: getSystemRiskInfo
---

获取用于得到风控信息的加密信息对象。更多小程序风控能力参见[风控服务](https://smartprogram.baidu.com/docs/develop/serverapi/open_risk_power/)。
Web 态说明：Web 态小程序暂不支持获取用于得到风控信息的加密信息对象。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-getSystemRiskInfo/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| success | `(res: SuccessCallbackResult) => any` | 否 | 接口调用成功的回调函数 |
| fail | `(err: any) => any` | 否 | 接口调用失败的回调函数 |
| complete | `(res: any) => any` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| content | `Object` | 用于获取风控信息的加密信息对象。<br />要获取风控信息，需要和[风控检测](https://smartprogram.baidu.com/docs/develop/serverapi/open_risk_power/#detectrisk/)接口联合使用，并作为风控检测接口的 xtoken 参数传入。 |

### IContent

| 参数 | 类型 |
| --- | --- |
| key | `string` |
| value | `string` |
</file>

<file path="docs/apis/swan/getTopStatus.md">
---
title: Taro.getTopStatus(option)
sidebar_label: getTopStatus
---

获取小程序用户置顶状态。
Web 态说明：Web 态小程序暂不支持获取置顶状态，降级调起百度 App。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-getTopStatus/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| success | `(res: SuccessCallbackResult) => any` | 否 | 接口调用成功的回调函数 |
| fail | `(err: any) => any` | 否 | 接口调用失败的回调函数 |
| complete | `(res: any) => any` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| isTop | `boolean` | 置顶状态 |
</file>

<file path="docs/apis/swan/openBdboxWebview.md">
---
title: Taro.openBdboxWebview(option)
sidebar_label: openBdboxWebview
---

小程序跳转百度 App 内特定页面。接入本 API 的开发者，需要了解跳转页面的 scheme，并根据文档调用 API 完成跳转。可在百度 App 中，通过将跳转页面 scheme 生成对应二维码，并使用百度 APP 相机扫描二维码调起的方式，来确保 scheme 是否正确。
Web 态说明：
 1.由于浏览器的限制，Web 态暂时无法准确获取跳转百度 App 成功 / 失败状态，会执行失败回调；
 2.在用户未安装手百、部分第三方浏览器封禁百度 App 的情况下，Web 态会尝试降级调起应用商店。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-openBdboxWebview/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| module | `string` | 否 | 跳转百度 App 特定页面的 scheme 的 module |
| action | `string` | 否 | 跳转百度 App 特定页面的 scheme 的 action |
| path | `string` | 否 | 跳转百度 App 特定页面的 scheme 的 path |
| authority | `string` | 否 | 跳转百度 App 特定页面的 scheme 的 authority |
| parameters | `Object` | 否 | 跳转百度 App 特定页面的 scheme 的参数 |
| success | `(res: any) => any` | 否 | 接口调用成功的回调函数 |
| fail | `(err: any) => any` | 否 | 接口调用失败的回调函数 |
| complete | `(res: any) => any` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
</file>

<file path="docs/apis/swan/setDocumentTitle.md">
---
title: Taro.setDocumentTitle(option)
sidebar_label: setDocumentTitle
---

动态设置当前页面的标题。此方法为 web 版小程序专用方法，使用前需判断方法是否存在。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-setDocumentTitle/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| title | `string` | 是 | 页面中 title 标签中的内容 |
| success | `(res: any) => any` | 否 | 接口调用成功的回调函数 |
| fail | `(err: any) => any` | 否 | 接口调用失败的回调函数 |
| complete | `(res: any) => any` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
</file>

<file path="docs/apis/swan/setMetaDescription.md">
---
title: Taro.setMetaDescription(option)
sidebar_label: setMetaDescription
---

设置 web 版小程序 description meta 信息。此方法为 web 版小程序专用方法，使用前需判断方法是否存在。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-setMetaDescription/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| content | `string` | 是 | 需要设置的 description 内容 |
| success | `(res: any) => any` | 否 | 接口调用成功的回调函数 |
| fail | `(err: any) => any` | 否 | 接口调用失败的回调函数 |
| complete | `(res: any) => any` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
</file>

<file path="docs/apis/swan/setMetaKeywords.md">
---
title: Taro.setMetaKeywords(option)
sidebar_label: setMetaKeywords
---

设置 web 版小程序 keywords meta 信息。此方法为 web 版小程序专用方法，使用前需判断方法是否存在。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-setMetaKeywords/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| content | `string` | 是 | 需要设置的 keywords 内容 |
| success | `(res: any) => any` | 否 | 接口调用成功的回调函数 |
| fail | `(err: any) => any` | 否 | 接口调用失败的回调函数 |
| complete | `(res: any) => any` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
</file>

<file path="docs/apis/swan/setPageInfo.md">
---
title: Taro.setPageInfo(option)
sidebar_label: setPageInfo
---

百度智能小程序可接入百度搜索和百度 App，setPageInfo 负责为小程序设置各类页面基础信息，包括标题、关键字、页面描述以及图片信息、视频信息等。开发者为智能小程序设置完备的页面基础信息，有助于智能小程序在搜索引擎和信息流中得到更加有效的展示和分发。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/api/open/swan-setPageInfo/)

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| title | `string` | 是 | 页面标题 |
| keywords | `string` | 是 | 页面关键字 |
| description | `string` | 是 | 页面描述信息 |
| releaseDate | `string` | 否 | 原始发布时间(年-月-日 时:分:秒 带有前导零） |
| articleTitle | `string` | 否 | 文章(内容)标题(适用于当前页面是图文、视频类的展示形式，文章标题需要准确标识当前文章的主要信息点；至少6个字，不可以全英文。) |
| image | string or string[] | 否 | 图片线上地址，用于信息流投放后的封面显示，最多3张，单图片最大2M；封面图建议尺寸：高>=210px & 宽>=375px；最小尺寸：高>=146px & 宽>=218px。多张图时，用数组表示 |
| video | `Video` | 否 | 视频信息，多个视频时，用数组表示 |
| visit | `Visit` | 否 | 浏览信息 |
| likes | `string` | 否 | 点赞量，若页面未统计可为空 |
| comments | `string` | 否 | 评论量，若页面未统计可为空 |
| collects | `string` | 否 | 收藏量，若页面未统计可为空 |
| shares | `string` | 否 | 分享量，若页面未统计可为空 |
| followers | `string` | 否 | 关注量，若页面未统计可为空 |
| success | `() => any` | 否 | 接口调用成功的回调函数 |
| fail | `(err: any) => any` | 否 | 接口调用失败的回调函数 |
| complete | `() => any` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### Video

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| url | `string` | 视频地址 |
| duration | `string` | 视频时长(单位为秒) |
| image | `string` | 视频封面图 |

### Visit

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| pv | `string` | 否 | 页面的浏览量(不去重用户） |
| uv | `string` | 否 | 页面的点击量（去重用户） |
| sessionDuration | `string` | 否 | 页面的用户人均停留时长，以秒为单位。 |

## 示例代码

```tsx
Taro.setPageInfo({
  title: '晒元宵节活动红包，爱奇艺60张年卡、600张季卡等你拿！-百度贴吧',
  keywords: '百度,百度贴吧,好运中国年,60,晒元,宵节',
  description: '晒元宵节活动红包，爱..昨天的百度APP元宵节活动中，共发出2亿现金红包、含151万个手气现金大奖和240辆红旗轿车，谁是好运锦鲤，快来分享！马上惊喜升级~摇中红包的锦鲤们即刻晒出红包金额截图，我们将会抽取660位好运锦鲤',
  articleTitle: '晒元宵节活动红包，爱奇艺60张年卡、600张季卡等你拿！',
  releaseDate: '2019-01-02 12:01:30',
  image: [
      'https://c.hiphotos.baidu.com/forum/w%3D480/sign=73c62dda83b1cb133e693d1bed5456da/f33725109313b07e8dee163d02d7912396dd8cfe.jpg',
      'https://hiphotos.baidu.com/fex/%70%69%63/item/43a7d933c895d143e7b745607ef082025baf07ab.jpg'
  ],
  video: [{
      url: 'https://www.baidu.com/mx/v12.mp4',
      duration: '100',
      image: 'https://smartprogram.baidu.com/docs/img/image-scaleToFill.png'
  }],
  visit: {
      pv: '1000',
      uv: '100',
      sessionDuration: '130'
  },
  likes: '75',
  comments: '13',
  collects: '23',
  shares: '8',
  followers: '35',
  success: res => {
      console.log('setPageInfo success');
  },
  fail: err => {
      console.log('setPageInfo fail', err);
  }
})
```
</file>

<file path="docs/apis/taro.extend/eventCenter.md">
---
title: eventCenter
sidebar_label: eventCenter
---

事件中心

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
TaroGeneral.Events
```
</file>

<file path="docs/apis/taro.extend/getAppInfo.md">
---
title: Taro.getAppInfo()
sidebar_label: getAppInfo
---

小程序获取和 Taro 相关的 App 信息

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
() => AppInfo
```

## 参数

### AppInfo

应用信息

| 参数 | 类型 |
| --- | --- |
| platform | `string` |
| taroVersion | `string` |
| designWidth | number or ((size?: string or number) => number) |
</file>

<file path="docs/apis/taro.extend/getCurrentInstance.md">
---
title: Taro.getCurrentInstance()
sidebar_label: getCurrentInstance
---

获取当前页面实例

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
() => Current
```

## 参数

### Current

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| app | `any` | 是 |  |
| router | `any` | 是 |  |
| page | `any` | 是 |  |
| onReady | `string` | 是 |  |
| onHide | `string` | 是 |  |
| onShow | `string` | 是 |  |
| preloadData | `Record<any, any>` | 否 |  |
| rnNavigationRef | `React.RefObject<any>` | 否 | RN 私有对象navigationRef，用于使用底层接口控制路由 |
</file>

<file path="docs/apis/taro.extend/getEnv.md">
---
title: Taro.getEnv()
sidebar_label: getEnv
---

获取环境变量

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
() => TaroGeneral.ENV_TYPE
```
</file>

<file path="docs/apis/taro.extend/getEnvInfoSync.md">
---
title: Taro.getEnvInfoSync()
sidebar_label: getEnvInfoSync
---

## 类型

```tsx
() => { microapp: { mpVersion: string; envType: string; appId: string; }; plugin: Record<string, unknown>; common: { USER_DATA_PATH: string; location: string; launchFrom: string; schema: string; }; }
```
</file>

<file path="docs/apis/taro.extend/getRenderer.md">
---
title: Taro.getRenderer()
sidebar_label: getRenderer
---

获取当前页面渲染引擎类型

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
() => "webview" | "skyline"
```
</file>

<file path="docs/apis/taro.extend/getTabBar.md">
---
title: Taro.getTabBar(page)
sidebar_label: getTabBar
---

获取自定义 TabBar 对应的 React 或 Vue 组件实例

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
<T>(page: any) => T
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| page | `T` | 小程序页面对象，可以通过 Taro.getCurrentInstance().page 获取<br />param: page 小程序页面对象，可以通过 Taro.getCurrentInstance().page 获取 |
</file>

<file path="docs/apis/taro.extend/initPxTransform.md">
---
title: Taro.initPxTransform(config)
sidebar_label: initPxTransform
---

尺寸转换初始化

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(config: { baseFontSize?: number; deviceRatio?: TaroGeneral.TDeviceRatio; designWidth?: number | ((size?: string | number) => number); targetUnit?: string; unitPrecision?: number; }) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| config | { baseFontSize?: number; deviceRatio?: TaroGeneral.TDeviceRatio; designWidth?: number or ((size?: string or number) => number); targetUnit?: string; unitPrecision?: number; } |
</file>

<file path="docs/apis/taro.extend/interceptorify.md">
---
title: Taro.interceptorify(promiseifyApi)
sidebar_label: interceptorify
---

包裹 promiseify api 的洋葱圈模型

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
<T, R>(promiseifyApi: promiseifyApi<T, R>) => Interceptorify<T, R>
```

## 参数

### promiseifyApi

```tsx
(requestParams: T) => Promise<R>
```

| 参数 | 类型 |
| --- | --- |
| requestParams | `T` |

### InterceptorifyChain

| 参数 | 类型 |
| --- | --- |
| requestParams | `T` |
| proceed | `promiseifyApi<T, R>` |

### InterceptorifyInterceptor

```tsx
(chain: InterceptorifyChain<T, R>) => Promise<R>
```

| 参数 | 类型 |
| --- | --- |
| chain | `InterceptorifyChain<T, R>` |

### Interceptorify

#### request

```tsx
(requestParams: T) => Promise<R>
```

| 参数 | 类型 |
| --- | --- |
| requestParams | `T` |

#### addInterceptor

```tsx
(interceptor: InterceptorifyInterceptor<T, R>) => void
```

| 参数 | 类型 |
| --- | --- |
| interceptor | `InterceptorifyInterceptor<T, R>` |

#### cleanInterceptors

```tsx
() => void
```

## 示例代码

### 示例 1

```tsx
// 创建实例
const modalInterceptorify = interceptorify(taro.showModal)
// 添加拦截器
modalInterceptorify.addInterceptor(async function (chain) {
  const res = await chain.proceed({
    ...chain.requestParams,
    title: 'interceptor1'
  })
  return res
})
modalInterceptorify.addInterceptor(async function (chain) {
  const res = await chain.proceed({
    ...chain.requestParams,
    content: 'interceptor2'
  })
  return res
})
// 使用
modalInterceptorify.request({})
```

### 示例 2

```tsx
// 创建实例
const fetchDataInterceptorify = interceptorify(taro.request)
// 添加拦截器
fetchDataInterceptorify.addInterceptor(async function (chain) {
  taro.showLoading({
    title: 'Loading...'
  })
  const res = await chain.proceed(chain.requestParams)
  taro.hideLoading()
  return res
})
fetchDataInterceptorify.addInterceptor(async function (chain) {
  const params = chain.requestParams
  const res = await chain.proceed({
    url: 'http://httpbin.org' + params.url,
  })
  return res.data
})
// 使用
fetchDataInterceptorify.request({
  url: '/ip'
}).then((res) => {
  // log my ip
  console.log(res.origin)
})
```
</file>

<file path="docs/apis/taro.extend/pxTransform.md">
---
title: Taro.pxTransform(size)
sidebar_label: pxTransform
---

尺寸转换

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(size: number) => string
```

## 参数

| 参数 | 类型 |
| --- | --- |
| size | `number` |
</file>

<file path="docs/apis/taro.extend/requirePlugin.md">
---
title: requirePlugin
sidebar_label: requirePlugin
---

小程序引用插件 JS 接口

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
{ (pluginName: string): any; (pluginName: string, success?: (mod: any) => any, error?: (e: { mod: any; errMsg: string; }) => any): any; async?: (pluginName: string) => Promise<any>; }
```

## 参数

| 参数 | 类型 |
| --- | --- |
| pluginName | `string` |
</file>

<file path="docs/apis/taro.extend/setGlobalDataPlugin.md">
---
title: setGlobalDataPlugin
sidebar_label: setGlobalDataPlugin
---

Vue3 插件，用于设置 `getApp()` 中的全局变量

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
Plugin
```

## 参数

### Plugin

Vue3 插件，用于设置 `getApp()` 中的全局变量

#### install

```tsx
(app: any, data: any) => void
```

## 示例代码

```js
// 使用插件
const App = createApp(...)
App.use(setGlobalDataPlugin, {
  xxx: 999
})
// 获取全局变量
Taro.getApp().xxx
```
</file>

<file path="docs/apis/taro.hooks/useAddToFavorites.md">
---
title: Taro.useAddToFavorites(callback)
sidebar_label: useAddToFavorites
---

用户点击右上角菜单“收藏”按钮时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
(callback: (payload: AddToFavoritesObject) => AddToFavoritesReturnObject) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `(payload: AddToFavoritesObject) => AddToFavoritesReturnObject` |
</file>

<file path="docs/apis/taro.hooks/useDidHide.md">
---
title: Taro.useDidHide(callback)
sidebar_label: useDidHide
---

页面隐藏时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(callback: () => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |
</file>

<file path="docs/apis/taro.hooks/useDidShow.md">
---
title: Taro.useDidShow(callback)
sidebar_label: useDidShow
---

页面展示时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(callback: (options?: getLaunchOptionsSync.LaunchOptions) => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `(options?: getLaunchOptionsSync.LaunchOptions) => void` |
</file>

<file path="docs/apis/taro.hooks/useError.md">
---
title: Taro.useError(callback)
sidebar_label: useError
---

小程序发生脚本错误或 API 调用报错时触发的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(callback: (error: string) => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `(error: string) => void` |
</file>

<file path="docs/apis/taro.hooks/useLaunch.md">
---
title: Taro.useLaunch(callback)
sidebar_label: useLaunch
---

小程序初始化完成时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(callback: (options: getLaunchOptionsSync.LaunchOptions) => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `(options: getLaunchOptionsSync.LaunchOptions) => void` |
</file>

<file path="docs/apis/taro.hooks/useLoad.md">
---
title: Taro.useLoad(callback)
sidebar_label: useLoad
---

页面加载完成时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
<T extends {} = Record<string, any>>(callback: (param: T) => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `T` |
</file>

<file path="docs/apis/taro.hooks/useOptionMenuClick.md">
---
title: Taro.useOptionMenuClick(callback)
sidebar_label: useOptionMenuClick
---

导航栏的额外图标被点击时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
(callback: () => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |
</file>

<file path="docs/apis/taro.hooks/usePageNotFound.md">
---
title: Taro.usePageNotFound(callback)
sidebar_label: usePageNotFound
---

小程序要打开的页面不存在时触发的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> H5: 多页面模式不支持该方法

## 类型

```tsx
(callback: (res: { [key: string]: any; path: string; query: Record<any, any>; isEntryPage: boolean; }) => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `(res: { [key: string]: any; path: string; query: Record<any, any>; isEntryPage: boolean; }) => void` |
</file>

<file path="docs/apis/taro.hooks/usePageScroll.md">
---
title: Taro.usePageScroll(callback)
sidebar_label: usePageScroll
---

页面滚动时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(callback: (payload: PageScrollObject) => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `(payload: PageScrollObject) => void` |
</file>

<file path="docs/apis/taro.hooks/usePullDownRefresh.md">
---
title: Taro.usePullDownRefresh(callback)
sidebar_label: usePullDownRefresh
---

下拉刷新时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(callback: () => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |
</file>

<file path="docs/apis/taro.hooks/usePullIntercept.md">
---
title: Taro.usePullIntercept(callback)
sidebar_label: usePullIntercept
---

下拉中断时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(callback: () => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |
</file>

<file path="docs/apis/taro.hooks/useReachBottom.md">
---
title: Taro.useReachBottom(callback)
sidebar_label: useReachBottom
---

上拉触底时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(callback: () => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |
</file>

<file path="docs/apis/taro.hooks/useReady.md">
---
title: Taro.useReady(callback)
sidebar_label: useReady
---

页面初次渲染完成的回调。
此时页面已经准备妥当，可以和视图层进行交互。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(callback: () => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |
</file>

<file path="docs/apis/taro.hooks/useResize.md">
---
title: Taro.useResize(callback)
sidebar_label: useResize
---

页面尺寸改变时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(callback: (payload: PageResizeObject) => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `(payload: PageResizeObject) => void` |
</file>

<file path="docs/apis/taro.hooks/useRouter.md">
---
title: Taro.useRouter(dynamic)
sidebar_label: useRouter
---

获取当前路由参数。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="快应用" src={require('@site/static/img/platform/quickapp.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
<TParams extends Partial<Record<string, string>> = Partial<Record<string, string>>>(dynamic?: boolean) => RouterInfo<TParams>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| dynamic | `TParams` |
</file>

<file path="docs/apis/taro.hooks/useSaveExitState.md">
---
title: Taro.useSaveExitState(callback)
sidebar_label: useSaveExitState
---

页面销毁前保留状态回调

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
(callback: () => { data: Record<any, any>; expireTimeStamp?: number; }) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `() => { data: Record<any, any>; expireTimeStamp?: number; }` |
</file>

<file path="docs/apis/taro.hooks/useShareAppMessage.md">
---
title: Taro.useShareAppMessage(callback)
sidebar_label: useShareAppMessage
---

页面转发时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
(callback: (payload: ShareAppMessageObject) => ShareAppMessageReturn) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `(payload: ShareAppMessageObject) => ShareAppMessageReturn` |
</file>

<file path="docs/apis/taro.hooks/useShareTimeline.md">
---
title: Taro.useShareTimeline(callback)
sidebar_label: useShareTimeline
---

用户点击右上角菜单“分享到朋友圈”按钮时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
(callback: () => ShareTimelineReturnObject) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `() => ShareTimelineReturnObject` |
</file>

<file path="docs/apis/taro.hooks/useTabItemTap.md">
---
title: Taro.useTabItemTap(callback)
sidebar_label: useTabItemTap
---

当前是 tab 页时，tab 被点击时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(callback: (payload: TabItemTapObject) => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `(payload: TabItemTapObject) => void` |
</file>

<file path="docs/apis/taro.hooks/useTitleClick.md">
---
title: Taro.useTitleClick(callback)
sidebar_label: useTitleClick
---

导航栏的标题被点击时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
(callback: () => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |
</file>

<file path="docs/apis/taro.hooks/useUnhandledRejection.md">
---
title: Taro.useUnhandledRejection(callback)
sidebar_label: useUnhandledRejection
---

小程序有未处理的 Promise reject 时触发。也可以使用 Taro.onUnhandledRejection 绑定监听。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(callback: (error: { reason: Error; promise: Promise<Error>; }) => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `(error: { reason: Error; promise: Promise<Error>; }) => void` |
</file>

<file path="docs/apis/taro.hooks/useUnload.md">
---
title: Taro.useUnload(callback)
sidebar_label: useUnload
---

页面卸载时的回调。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
(callback: () => void) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `() => void` |
</file>

<file path="docs/apis/ui/animation/Animation.md">
---
title: Animation
sidebar_label: Animation
---

动画对象

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.html)

## 方法

### export

导出动画队列。**export 方法每次调用后会清掉之前的动画操作**。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.export.html)

```tsx
() => { actions: TaroGeneral.IAnyObject[]; }
```

### step

表示一组动画完成。可以在一组动画中调用任意多个动画方法，一组动画中的所有动画会同时开始，一组动画完成后才会进行下一组动画。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.step.html)

```tsx
(option?: StepOption) => Animation
```

| 参数 | 类型 |
| --- | --- |
| option | `StepOption` |

### matrix

同 [transform-function matrix](https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/matrix)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.matrix.html)

```tsx
(a: number, b: number, c: number, d: number, tx: number, ty: number) => Animation
```

| 参数 | 类型 |
| --- | --- |
| a | `number` |
| b | `number` |
| c | `number` |
| d | `number` |
| tx | `number` |
| ty | `number` |

### matrix3d

同 [transform-function matrix3d](https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/matrix3d)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.matrix3d.html)

```tsx
(a1: number, b1: number, c1: number, d1: number, a2: number, b2: number, c2: number, d2: number, a3: number, b3: number, c3: number, d3: number, a4: number, b4: number, c4: number, d4: number) => Animation
```

| 参数 | 类型 |
| --- | --- |
| a1 | `number` |
| b1 | `number` |
| c1 | `number` |
| d1 | `number` |
| a2 | `number` |
| b2 | `number` |
| c2 | `number` |
| d2 | `number` |
| a3 | `number` |
| b3 | `number` |
| c3 | `number` |
| d3 | `number` |
| a4 | `number` |
| b4 | `number` |
| c4 | `number` |
| d4 | `number` |

### rotate

从原点顺时针旋转一个角度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.rotate.html)

```tsx
(angle: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| angle | `number` | 旋转的角度。范围 [-180, 180] |

### rotate3d

从 固定 轴顺时针旋转一个角度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.rotate3d.html)

```tsx
(x: number, y?: number, z?: number, angle?: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | 旋转轴的 x 坐标 |
| y | `number` | 旋转轴的 y 坐标 |
| z | `number` | 旋转轴的 z 坐标 |
| angle | `number` | 旋转的角度。范围 [-180, 180] |

### rotateX

从 X 轴顺时针旋转一个角度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.rotateX.html)

```tsx
(angle: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| angle | `number` | 旋转的角度。范围 [-180, 180] |

### rotateY

从 Y 轴顺时针旋转一个角度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.rotateY.html)

```tsx
(angle: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| angle | `number` | 旋转的角度。范围 [-180, 180] |

### rotateZ

从 Z 轴顺时针旋转一个角度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.rotateZ.html)

```tsx
(angle: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| angle | `number` | 旋转的角度。范围 [-180, 180] |

### scale

缩放

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.scale.html)

```tsx
(sx: number, sy?: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| sx | `number` | 当仅有 sx 参数时，表示在 X 轴、Y 轴同时缩放sx倍数 |
| sy | `number` | 在 Y 轴缩放 sy 倍数 |

### scale3d

缩放

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.scale3d.html)

```tsx
(sx: number, sy: number, sz: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| sx | `number` | x 轴的缩放倍数 |
| sy | `number` | y 轴的缩放倍数 |
| sz | `number` | z 轴的缩放倍数 |

### scaleX

缩放 X 轴

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.scaleX.html)

```tsx
(scale: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| scale | `number` | X 轴的缩放倍数 |

### scaleY

缩放 Y 轴

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.scaleY.html)

```tsx
(scale: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| scale | `number` | Y 轴的缩放倍数 |

### scaleZ

缩放 Z 轴

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.scaleZ.html)

```tsx
(scale: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| scale | `number` | Z 轴的缩放倍数 |

### skew

对 X、Y 轴坐标进行倾斜

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.skew.html)

```tsx
(ax: number, ay: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| ax | `number` | 对 X 轴坐标倾斜的角度，范围 [-180, 180] |
| ay | `number` | 对 Y 轴坐标倾斜的角度，范围 [-180, 180] |

### skewX

对 X 轴坐标进行倾斜

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.skewX.html)

```tsx
(angle: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| angle | `number` | 倾斜的角度，范围 [-180, 180] |

### skewY

对 Y 轴坐标进行倾斜

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.skewY.html)

```tsx
(angle: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| angle | `number` | 倾斜的角度，范围 [-180, 180] |

### translate

平移变换

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.translate.html)

```tsx
(tx?: number, ty?: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tx | `number` | 当仅有该参数时表示在 X 轴偏移 tx，单位 px |
| ty | `number` | 在 Y 轴平移的距离，单位为 px |

### translate3d

对 xyz 坐标进行平移变换

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.translate3d.html)

```tsx
(tx?: number, ty?: number, tz?: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tx | `number` | 在 X 轴平移的距离，单位为 px |
| ty | `number` | 在 Y 轴平移的距离，单位为 px |
| tz | `number` | 在 Z 轴平移的距离，单位为 px |

### translateX

对 X 轴平移

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.translateX.html)

```tsx
(translation: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| translation | `number` | 在 X 轴平移的距离，单位为 px |

### translateY

对 Y 轴平移

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.translateY.html)

```tsx
(translation: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| translation | `number` | 在 Y 轴平移的距离，单位为 px |

### translateZ

对 Z 轴平移

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.translateZ.html)

```tsx
(translation: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| translation | `number` | 在 Z 轴平移的距离，单位为 px |

### opacity

设置透明度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.opacity.html)

```tsx
(value: number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | `number` | 透明度，范围 0-1 |

### backgroundColor

设置背景色

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.backgroundColor.html)

```tsx
(value: string) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | `string` | 颜色值 |

### width

设置宽度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.width.html)

```tsx
(value: string | number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | string or number | 长度值，如果传入 number 则默认使用 px，可传入其他自定义单位的长度值 |

### height

设置高度

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.height.html)

```tsx
(value: string | number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | string or number | 长度值，如果传入 number 则默认使用 px，可传入其他自定义单位的长度值 |

### left

设置 left 值

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.left.html)

```tsx
(value: string | number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | string or number | 长度值，如果传入 number 则默认使用 px，可传入其他自定义单位的长度值 |

### right

设置 right 值

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.right.html)

```tsx
(value: string | number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | string or number | 长度值，如果传入 number 则默认使用 px，可传入其他自定义单位的长度值 |

### top

设置 top 值

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.top.html)

```tsx
(value: string | number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | string or number | 长度值，如果传入 number 则默认使用 px，可传入其他自定义单位的长度值 |

### bottom

设置 bottom 值

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/Animation.bottom.html)

```tsx
(value: string | number) => Animation
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | string or number | 长度值，如果传入 number 则默认使用 px，可传入其他自定义单位的长度值 |

## 参数

### StepOption

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| delay | `number` | 否 | 动画延迟时间，单位 ms |
| duration | `number` | 否 | 动画持续时间，单位 ms |
| timingFunction | `keyof TimingFunction` | 否 | 动画的效果 |
| transformOrigin | `string` | 否 |  |

### TimingFunction

| 参数 | 说明 |
| --- | --- |
| linear | 动画从头到尾的速度是相同的 |
| ease | 动画以低速开始，然后加快，在结束前变慢 |
| ease-in | 动画以低速开始 |
| ease-in-out | 动画以低速开始和结束 |
| ease-out | 动画以低速结束 |
| step-start | 动画第一帧就跳至结束状态直到结束 |
| step-end | 动画一直保持开始状态，最后一帧跳到结束状态 |

## API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| Animation | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.export | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.step | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.matrix | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.matrix3d | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.rotate | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.rotate3d | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.rotateX | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.rotateY | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.rotateZ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.scale | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.scale3d | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.scaleX | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.scaleY | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.scaleZ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.skew | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.skewX | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.skewY | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.translate | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.translate3d | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.translateX | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.translateY | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.translateZ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.opacity | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.backgroundColor | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.width | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.height | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.left | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.right | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.top | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| Animation.bottom | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
</file>

<file path="docs/apis/ui/animation/createAnimation.md">
---
title: Taro.createAnimation(option)
sidebar_label: createAnimation
---

创建一个动画实例 [animation](../Animation)。调用实例的方法来描述动画。最后通过动画实例的 export 方法导出动画数据传递给组件的 animation 属性。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/animation/wx.createAnimation.html)

## 类型

```tsx
(option: Option) => Animation
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| duration | `number` |  | 否 | 动画持续时间，单位 ms |
| timingFunction | `keyof TimingFunction` |  | 否 | 动画的效果 |
| delay | `number` | `0` | 否 | 动画延迟时间，单位 ms |
| transformOrigin | `string` | `"50% 50% 0"` | 否 |  |
| unit | `string` |  | 否 | 单位<br />API 支持度: h5 |

### TimingFunction

| 参数 | 说明 |
| --- | --- |
| linear | 动画从头到尾的速度是相同的 |
| ease | 动画以低速开始，然后加快，在结束前变慢 |
| ease-in | 动画以低速开始 |
| ease-in-out | 动画以低速开始和结束 |
| ease-out | 动画以低速结束 |
| step-start | 动画第一帧就跳至结束状态直到结束 |
| step-end | 动画一直保持开始状态，最后一帧跳到结束状态 |

## 示例代码

```tsx
var animation = Taro.createAnimation({
  transformOrigin: "50% 50%",
  duration: 1000,
  timingFunction: "ease",
  delay: 0
})
```
</file>

<file path="docs/apis/ui/background/setBackgroundColor.md">
---
title: Taro.setBackgroundColor(option)
sidebar_label: setBackgroundColor
---

动态设置窗口的背景色

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> React Native: 仅 Android

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/background/wx.setBackgroundColor.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| backgroundColor | `string` | 否 | 窗口的背景色，必须为十六进制颜色值 |
| backgroundColorBottom | `string` | 否 | 底部窗口的背景色，必须为十六进制颜色值，仅 iOS 支持 |
| backgroundColorTop | `string` | 否 | 顶部窗口的背景色，必须为十六进制颜色值，仅 iOS 支持 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.setBackgroundColor({
  backgroundColor: '#ffffff', // 窗口的背景色为白色
})
Taro.setBackgroundColor({
  backgroundColorTop: '#ffffff', // 顶部窗口的背景色为白色
  backgroundColorBottom: '#ffffff', // 底部窗口的背景色为白色
})
```
</file>

<file path="docs/apis/ui/background/setBackgroundTextStyle.md">
---
title: Taro.setBackgroundTextStyle(option)
sidebar_label: setBackgroundTextStyle
---

动态设置下拉背景字体、loading 图的样式

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> React Native: 仅 iOS

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/background/wx.setBackgroundTextStyle.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| textStyle | "dark" or "light" | 是 | 下拉背景字体、loading 图的样式。<br /><br />可选值：<br />- 'dark': dark 样式;<br />- 'light': light 样式; |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.setBackgroundTextStyle({
  textStyle: 'dark' // 下拉背景字体、loading 图的样式为dark
})
```
</file>

<file path="docs/apis/ui/custom-component/nextTick.md">
---
title: Taro.nextTick(callback)
sidebar_label: nextTick
---

延迟一部分操作到下一个时间片再执行。（类似于 setTimeout）

**说明**
因为自定义组件中的 setData 和 triggerEvent 等接口本身是同步的操作，当这几个接口被连续调用时，都是在一个同步流程中执行完的，因此若逻辑不当可能会导致出错。
一个极端的案例：当父组件的 setData 引发了子组件的 triggerEvent，进而使得父组件又进行了一次 setData，期间有通过 wx:if 语句对子组件进行卸载，就有可能引发奇怪的错误，所以对于不需要在一个同步流程内完成的逻辑，可以使用此接口延迟到下一个时间片再执行。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/custom-component/wx.nextTick.html)

## 类型

```tsx
(callback: (...args: any[]) => any) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| callback | `(...args: any[]) => any` |

## 示例代码

```tsx
this.setData({ number: 1 }) // 直接在当前同步流程中执行
Taro.nextTick(() => {
  this.setData({ number: 3 }) // 在当前同步流程结束后，下一个时间片执行
})
this.setData({ number: 2 }) // 直接在当前同步流程中执行
```
</file>

<file path="docs/apis/ui/fonts/loadFontFace.md">
---
title: Taro.loadFontFace(option)
sidebar_label: loadFontFace
---

动态加载网络字体。文件地址需为下载类型。iOS 仅支持 https 格式文件地址。

注意：
1. 字体文件返回的 context-type 参考 [font](https://www.iana.org/assignments/media-types/media-types.xhtml#font)，格式不正确时会解析失败。
2. 字体链接必须是https（ios不支持http)
3. 字体链接必须是同源下的，或开启了cors支持，小程序的域名是`servicewechat.com`
4. canvas等原生组件不支持使用接口添加的字体
5. 工具里提示 Failed to load font 可以忽略

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> 支付宝小程序: source 地址格式为 `url('https://...')`，而不是单纯 URL 地址
>
> H5: 不支持 global (默认全局加载)

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/font/wx.loadFontFace.html)

## 类型

```tsx
(option: Option) => Promise<CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| global | `boolean` | `false` | 否 | 是否全局生效 |
| family | `string` |  | 是 | 定义的字体名称 |
| source | `string` |  | 是 | 字体资源的地址。建议格式为 TTF 和 WOFF，WOFF2 在低版本的 iOS 上会不兼容。 |
| desc | `DescOption` |  | 否 | 可选的字体描述符 |
| success | `(res: CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |
| fail | `(res: CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| complete | `(res: CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

### CallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| status | `string` | 加载字体结果 |

### DescOption

可选的字体描述符

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| ascentOverride | `string` | 否 | <br />API 支持度: h5 |
| descentOverride | `string` | 否 | <br />API 支持度: h5 |
| featureSettings | `string` | 否 | <br />API 支持度: h5 |
| lineGapOverride | `string` | 否 | <br />API 支持度: h5 |
| stretch | `string` | 否 | <br />API 支持度: h5 |
| style | `string` | 否 | 字体样式，可选值为 normal / italic / oblique |
| unicodeRange | `string` | 否 | <br />API 支持度: h5 |
| variant | `string` | 否 | 设置小型大写字母的字体显示文本，可选值为 normal / small-caps / inherit |
| variationSettings | `string` | 否 | <br />API 支持度: h5 |
| weight | `string` | 否 | 字体粗细，可选值为 normal / bold / 100 / 200../ 900 |

## 示例代码

```tsx
Taro.loadFontFace({
  family: 'Bitstream Vera Serif Bold',
  source: 'url("https://sungd.github.io/Pacifico.ttf")',
  success: console.log
})
```
</file>

<file path="docs/apis/ui/interaction/disableAlertBeforeUnload.md">
---
title: Taro.disableAlertBeforeUnload(option)
sidebar_label: disableAlertBeforeUnload
---

关闭小程序页面返回询问对话框

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.disableAlertBeforeUnload.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/ui/interaction/enableAlertBeforeUnload.md">
---
title: Taro.enableAlertBeforeUnload(option)
sidebar_label: enableAlertBeforeUnload
---

## 类型

```tsx
(option: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| message | `string` | 是 | 询问对话框内容 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/ui/interaction/hideLoading.md">
---
title: Taro.hideLoading(option)
sidebar_label: hideLoading
---

隐藏 loading 提示框

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.hideLoading.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| noConflict | `boolean` | `false` | 否 | 目前 toast 和 loading 相关接口可以相互混用，此参数可用于取消混用特性 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.showLoading({
  title: '加载中',
})
setTimeout(function (){
  Taro.hideLoading()
},2000)
```
</file>

<file path="docs/apis/ui/interaction/hideToast.md">
---
title: Taro.hideToast(option)
sidebar_label: hideToast
---

隐藏消息提示框

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.hideToast.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| noConflict | `boolean` | `false` | 否 | 目前 toast 和 loading 相关接口可以相互混用，此参数可用于取消混用特性 |
| complete | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` |  | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/ui/interaction/showActionSheet.md">
---
title: Taro.showActionSheet(option)
sidebar_label: showActionSheet
---

显示操作菜单

**注意**
- Android 6.7.2 以下版本，点击取消或蒙层时，回调 fail, errMsg 为 "fail cancel"；
- Android 6.7.2 及以上版本 和 iOS 点击蒙层不会关闭模态弹窗，所以尽量避免使用「取消」分支中实现业务逻辑

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showActionSheet.html)

## 类型

```tsx
(option: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| alertText | `string` | 否 | 警示文案 |
| itemList | `string[]` | 是 | 按钮的文字数组，数组长度最大为 6 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| itemColor | `string` | 否 | 按钮的文字颜色 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tapIndex | `number` | 用户点击的按钮序号，从上到下的顺序，从0开始 |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
Taro.showActionSheet({
  itemList: ['A', 'B', 'C'],
  success: function (res) {
    console.log(res.tapIndex)
  },
  fail: function (res) {
    console.log(res.errMsg)
  }
})
```
</file>

<file path="docs/apis/ui/interaction/showLoading.md">
---
title: Taro.showLoading(option)
sidebar_label: showLoading
---

显示 loading 提示框。需主动调用 Taro.hideLoading 才能关闭提示框

**注意**
- Taro.showLoading 和 Taro.showToast 同时只能显示一个
- Taro.showLoading 应与 Taro.hideLoading 配对使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showLoading.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| title | `string` | 是 | 提示的内容 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| mask | `boolean` | 否 | 是否显示透明蒙层，防止触摸穿透 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.showLoading({
  title: '加载中',
})
setTimeout(function () {
  Taro.hideLoading()
}, 2000)
```
</file>

<file path="docs/apis/ui/interaction/showModal.md">
---
title: Taro.showModal(option)
sidebar_label: showModal
---

显示模态对话框
**注意**
- Android 6.7.2 以下版本，点击取消或蒙层时，回调 fail, errMsg 为 "fail cancel"；
- Android 6.7.2 及以上版本 和 iOS 点击蒙层不会关闭模态弹窗，所以尽量避免使用「取消」分支中实现业务逻辑

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showModal.html)

## 类型

```tsx
(option?: Option) => Promise<SuccessCallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| cancelColor | `string` | 否 | 取消按钮的文字颜色，必须是 16 进制格式的颜色字符串 |
| cancelText | `string` | 否 | 取消按钮的文字，最多 4 个字符 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| confirmColor | `string` | 否 | 确认按钮的文字颜色，必须是 16 进制格式的颜色字符串 |
| confirmText | `string` | 否 | 确认按钮的文字，最多 4 个字符 |
| content | `string` | 否 | 提示的内容 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| showCancel | `boolean` | 否 | 是否显示取消按钮 |
| success | `(result: SuccessCallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| title | `string` | 否 | 提示的标题 |

### SuccessCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| cancel | `boolean` | 为 true 时，表示用户点击了取消（用于 Android 系统区分点击蒙层关闭还是点击取消按钮关闭） |
| confirm | `boolean` | 为 true 时，表示用户点击了确定按钮 |
| errMsg | `string` | 调用结果 |

## 示例代码

```tsx
Taro.showModal({
  title: '提示',
  content: '这是一个模态弹窗',
  success: function (res) {
    if (res.confirm) {
      console.log('用户点击确定')
    } else if (res.cancel) {
      console.log('用户点击取消')
    }
  }
})
```
</file>

<file path="docs/apis/ui/interaction/showToast.md">
---
title: Taro.showToast(option)
sidebar_label: showToast
---

显示消息提示框

**注意**
- Taro.showLoading 和 Taro.showToast 同时只能显示一个
- Taro.showToast 应与 Taro.hideToast 配对使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showToast.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| title | `string` | 是 | 提示的内容 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| duration | `number` | 否 | 提示的延迟时间 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| icon | "success" or "error" or "loading" or "none" | 否 | 图标<br /><br />可选值：<br />- 'success': 显示成功图标，此时 title 文本最多显示 7 个汉字长度;<br />- 'error': 显示失败图标，此时 title 文本最多显示 7 个汉字长度;<br />- 'loading': 显示加载图标，此时 title 文本最多显示 7 个汉字长度;<br />- 'none': 不显示图标，此时 title 文本最多可显示两行 |
| image | `string` | 否 | 自定义图标的本地路径，image 的优先级高于 icon |
| mask | `boolean` | 否 | 是否显示透明蒙层，防止触摸穿透 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.showToast({
  title: '成功',
  icon: 'success',
  duration: 2000
})
```
</file>

<file path="docs/apis/ui/menu/getMenuButtonBoundingClientRect.md">
---
title: Taro.getMenuButtonBoundingClientRect()
sidebar_label: getMenuButtonBoundingClientRect
---

获取菜单按钮（右上角胶囊按钮）的布局位置信息。坐标信息以屏幕左上角为原点。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/menu/wx.getMenuButtonBoundingClientRect.html)

## 类型

```tsx
() => Rect
```

## 参数

### Rect

菜单按钮的布局位置信息

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| bottom | `number` | 下边界坐标，单位：px |
| height | `number` | 高度，单位：px |
| left | `number` | 左边界坐标，单位：px |
| right | `number` | 右边界坐标，单位：px |
| top | `number` | 上边界坐标，单位：px |
| width | `number` | 宽度，单位：px |
</file>

<file path="docs/apis/ui/navigation-bar/hideHomeButton.md">
---
title: Taro.hideHomeButton(option)
sidebar_label: hideHomeButton
---

隐藏返回首页按钮。微信7.0.7版本起，当用户打开的小程序最底层页面是非首页时，默认展示“返回首页”按钮，开发者可在页面 onShow 中调用 hideHomeButton 进行隐藏。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/navigation-bar/wx.hideHomeButton.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/ui/navigation-bar/hideNavigationBarLoading.md">
---
title: Taro.hideNavigationBarLoading(option)
sidebar_label: hideNavigationBarLoading
---

在当前页面隐藏导航条加载动画

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/navigation-bar/wx.hideNavigationBarLoading.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/ui/navigation-bar/setNavigationBarColor.md">
---
title: Taro.setNavigationBarColor(option)
sidebar_label: setNavigationBarColor
---

设置页面导航条颜色

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> H5: 不支持 animation 参数
>
> React Native: 不支持 animation 参数

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/navigation-bar/wx.setNavigationBarColor.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| backgroundColor | `string` | 是 | 背景颜色值，有效值为十六进制颜色 |
| frontColor | `string` | 是 | 前景颜色值，包括按钮、标题、状态栏的颜色，仅支持 #ffffff 和 #000000 |
| animation | `AnimationOption` | 否 | 动画效果 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

### AnimationOption

动画效果

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| duration | `number` | 否 | 动画变化时间，单位 ms |
| timingFunc | "linear" or "easeIn" or "easeOut" or "easeInOut" | 否 | 动画变化方式<br /><br />可选值：<br />- 'linear': 动画从头到尾的速度是相同的;<br />- 'easeIn': 动画以低速开始;<br />- 'easeOut': 动画以低速结束;<br />- 'easeInOut': 动画以低速开始和结束; |

## 示例代码

```tsx
Taro.setNavigationBarColor({
    frontColor: '#ffffff',
    backgroundColor: '#ff0000',
    animation: {
        duration: 400,
        timingFunc: 'easeIn'
    }
})
```
</file>

<file path="docs/apis/ui/navigation-bar/setNavigationBarTitle.md">
---
title: Taro.setNavigationBarTitle(option)
sidebar_label: setNavigationBarTitle
---

动态设置当前页面的标题

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/navigation-bar/wx.setNavigationBarTitle.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| title | `string` | 是 | 页面标题 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.setNavigationBarTitle({
  title: '当前页面'
})
```
</file>

<file path="docs/apis/ui/navigation-bar/showNavigationBarLoading.md">
---
title: Taro.showNavigationBarLoading(option)
sidebar_label: showNavigationBarLoading
---

在当前页面显示导航条加载动画

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/navigation-bar/wx.showNavigationBarLoading.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/ui/pull-down-refresh/startPullDownRefresh.md">
---
title: Taro.startPullDownRefresh(option)
sidebar_label: startPullDownRefresh
---

开始下拉刷新。调用后触发下拉刷新动画，效果与用户手动下拉刷新一致。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> React Native: 无动画效果

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/pull-down-refresh/wx.startPullDownRefresh.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.startPullDownRefresh()
```
</file>

<file path="docs/apis/ui/pull-down-refresh/stopPullDownRefresh.md">
---
title: Taro.stopPullDownRefresh(option)
sidebar_label: stopPullDownRefresh
---

停止当前页面下拉刷新。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/pull-down-refresh/wx.stopPullDownRefresh.html)

## 类型

```tsx
(option?: Option) => void
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
onPullDownRefresh: function (){
  Taro.stopPullDownRefresh()
}
```
</file>

<file path="docs/apis/ui/scroll/pageScrollTo.md">
---
title: Taro.pageScrollTo(option)
sidebar_label: pageScrollTo
---

将页面滚动到目标位置，支持选择器和滚动距离两种方式定位

**selector 语法**
selector类似于 CSS 的选择器，但仅支持下列语法。

- ID选择器：#the-id
- class选择器（可以连续指定多个）：.a-class.another-class
- 子元素选择器：.the-parent > .the-child
- 后代选择器：.the-ancestor .the-descendant
- 跨自定义组件的后代选择器：.the-ancestor >>> .the-descendant
- 多选择器的并集：#a-node, .some-other-nodes

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/scroll/wx.pageScrollTo.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| duration | `number` | 否 | 滚动动画的时长，单位 ms |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| scrollTop | `number` | 否 | 滚动到页面的目标位置，单位 px |
| selector | `string` | 否 | 选择器, css selector |
| offsetTop | `number` | 否 | 偏移距离，需要和 selector 参数搭配使用，可以滚动到 selector 加偏移距离的位置，单位 px |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.pageScrollTo({
  scrollTop: 0,
  duration: 300
})
```
</file>

<file path="docs/apis/ui/scroll/ScrollViewContext.md">
---
title: ScrollViewContext
sidebar_label: ScrollViewContext
---

增强 ScrollView 实例，可通过 [Taro.createSelectorQuery](/docs/apis/wxml/createSelectorQuery) 的 [NodesRef.node](/docs/apis/wxml/NodesRef#node) 方法获取。 仅在 `scroll-view` 组件开启 `enhanced` 属性后生效。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/scroll/ScrollViewContext.html)

## 方法

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| scrollEnabled | `boolean` | 滚动开关 |
| bounces | `boolean` | 设置滚动边界弹性 (仅在 iOS 下生效) |
| showScrollbar | `boolean` | 设置是否显示滚动条 |
| pagingEnabled | `boolean` | 分页滑动开关 |
| fastDeceleration | `boolean` | 设置滚动减速速率 |
| decelerationDisabled | `boolean` | 取消滚动惯性 (仅在 iOS 下生效) |

### scrollTo

滚动至指定位置

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> H5: 不支持 velocity 参数

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/scroll/ScrollViewContext.scrollTo.html)

```tsx
(object: Option) => void
```

| 参数 | 类型 |
| --- | --- |
| object | `Option` |

### scrollIntoView

滚动至指定位置

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/scroll/ScrollViewContext.scrollIntoView.html)

```tsx
(selector: string) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| selector | `string` | 元素选择器 |

## 参数

### scrollTo

#### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| top | `number` | 否 | 顶部距离 |
| left | `number` | 否 | 左边界距离 |
| velocity | `number` | 否 | 初始速度 |
| duration | `number` | 否 | 滚动动画时长 |
| animated | `boolean` | 否 | 是否启用滚动动画 |

## 示例代码

```tsx
Taro.createSelectorQuery()
  .select('#scrollview')
  .node()
  .exec((res) => {
    const scrollView = res[0].node;
    scrollView.scrollEnabled = false;
  })
```

## API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| ScrollViewContext | ✔️ |  |  |  |  |  |
| ScrollViewContext.scrollTo | ✔️ |  | ✔️(不支持 velocity 参数) |  |  |  |
| ScrollViewContext.scrollIntoView | ✔️ | ✔️ | ✔️ |  |  |  |
</file>

<file path="docs/apis/ui/sticky/setTopBarText.md">
---
title: Taro.setTopBarText(option)
sidebar_label: setTopBarText
---

动态设置置顶栏文字内容。只有当前小程序被置顶时能生效，如果当前小程序没有被置顶，也能调用成功，但是不会立即生效，只有在用户将这个小程序置顶后才换上设置的文字内容.

**注意**
- 调用成功后，需间隔 5s 才能再次调用此接口，如果在 5s 内再次调用此接口，会回调 fail，errMsg："setTopBarText: fail invoke too frequently"

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/sticky/wx.setTopBarText.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| text | `string` | 是 | 置顶栏文字 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |

## 示例代码

```tsx
Taro.setTopBarText({
  text: 'hello, world!'
})
```
</file>

<file path="docs/apis/ui/tab-bar/hideTabBar.md">
---
title: Taro.hideTabBar(option)
sidebar_label: hideTabBar
---

隐藏 tabBar

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/tab-bar/wx.hideTabBar.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| animation | `boolean` | 否 | 是否需要动画效果 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/ui/tab-bar/hideTabBarRedDot.md">
---
title: Taro.hideTabBarRedDot(option)
sidebar_label: hideTabBarRedDot
---

隐藏 tabBar 某一项的右上角的红点

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/tab-bar/wx.hideTabBarRedDot.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| index | `number` | 是 | tabBar 的哪一项，从左边算起 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/ui/tab-bar/removeTabBarBadge.md">
---
title: Taro.removeTabBarBadge(option)
sidebar_label: removeTabBarBadge
---

移除 tabBar 某一项右上角的文本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/tab-bar/wx.removeTabBarBadge.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| index | `number` | 是 | tabBar 的哪一项，从左边算起 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/ui/tab-bar/setTabBarBadge.md">
---
title: Taro.setTabBarBadge(option)
sidebar_label: setTabBarBadge
---

为 tabBar 某一项的右上角添加文本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/tab-bar/wx.setTabBarBadge.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| index | `number` | 是 | tabBar 的哪一项，从左边算起 |
| text | `string` | 是 | 显示的文本，超过 4 个字符则显示成 ... |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.setTabBarBadge({
  index: 0,
  text: '1'
})
```
</file>

<file path="docs/apis/ui/tab-bar/setTabBarItem.md">
---
title: Taro.setTabBarItem(option)
sidebar_label: setTabBarItem
---

动态设置 tabBar 某一项的内容，`2.7.0` 起图片支持临时文件和网络文件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/tab-bar/wx.setTabBarItem.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| index | `number` | 是 | tabBar 的哪一项，从左边算起 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| iconPath | `string` | 否 | 图片路径，icon 大小限制为 40kb，建议尺寸为 81px * 81px，当 postion 为 top 时，此参数无效 |
| selectedIconPath | `string` | 否 | 选中时的图片路径，icon 大小限制为 40kb，建议尺寸为 81px * 81px ，当 postion 为 top 时，此参数无效 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
| text | `string` | 否 | tab 上的按钮文字 |

## 示例代码

```tsx
Taro.setTabBarItem({
  index: 0,
  text: 'text',
  iconPath: '/path/to/iconPath',
  selectedIconPath: '/path/to/selectedIconPath'
})
```
</file>

<file path="docs/apis/ui/tab-bar/setTabBarStyle.md">
---
title: Taro.setTabBarStyle(option)
sidebar_label: setTabBarStyle
---

动态设置 tabBar 的整体样式

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/tab-bar/wx.setTabBarStyle.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| backgroundColor | `string` | 否 | tab 的背景色，HexColor |
| borderStyle | `string` | 否 | tabBar上边框的颜色， 仅支持 black/white |
| color | `string` | 否 | tab 上的文字默认颜色，HexColor |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| selectedColor | `string` | 否 | tab 上的文字选中时的颜色，HexColor |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |

## 示例代码

```tsx
Taro.setTabBarStyle({
  color: '#FF0000',
  selectedColor: '#00FF00',
  backgroundColor: '#0000FF',
  borderStyle: 'white'
})
```
</file>

<file path="docs/apis/ui/tab-bar/showTabBar.md">
---
title: Taro.showTabBar(option)
sidebar_label: showTabBar
---

显示 tabBar

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/tab-bar/wx.showTabBar.html)

## 类型

```tsx
(option?: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| animation | `boolean` | 否 | 是否需要动画效果 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/ui/tab-bar/showTabBarRedDot.md">
---
title: Taro.showTabBarRedDot(option)
sidebar_label: showTabBarRedDot
---

显示 tabBar 某一项的右上角的红点

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/tab-bar/wx.showTabBarRedDot.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| index | `number` | 是 | tabBar 的哪一项，从左边算起 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/ui/window/checkIsPictureInPictureActive.md">
---
title: Taro.checkIsPictureInPictureActive()
sidebar_label: checkIsPictureInPictureActive
---

返回当前是否存在小窗播放（小窗在 video/live-player/live-pusher 下可用）

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/window/wx.checkIsPictureInPictureActive.html)

## 类型

```tsx
() => boolean
```
</file>

<file path="docs/apis/ui/window/offWindowResize.md">
---
title: Taro.offWindowResize(callback)
sidebar_label: offWindowResize
---

取消监听窗口尺寸变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/window/wx.offWindowResize.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 窗口尺寸变化事件的回调函数 |

### Callback

窗口尺寸变化事件的回调函数

```tsx
(res: TaroGeneral.CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `TaroGeneral.CallbackResult` |
</file>

<file path="docs/apis/ui/window/onWindowResize.md">
---
title: Taro.onWindowResize(callback)
sidebar_label: onWindowResize
---

监听窗口尺寸变化事件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/window/wx.onWindowResize.html)

## 类型

```tsx
(callback: Callback) => void
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `Callback` | 窗口尺寸变化事件的回调函数 |

### Callback

窗口尺寸变化事件的回调函数

```tsx
(result: CallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `CallbackResult` |

### CallbackResult

| 参数 | 类型 |
| --- | --- |
| size | `Size` |

### Size

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| windowHeight | `number` | 变化后的窗口高度，单位 px |
| windowWidth | `number` | 变化后的窗口宽度，单位 px |
</file>

<file path="docs/apis/ui/window/setWindowSize.md">
---
title: Taro.setWindowSize(option)
sidebar_label: setWindowSize
---

设置窗口大小，该接口仅适用于 PC 平台，使用细则请参见指南

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/ui/window/wx.setWindowSize.html)

## 类型

```tsx
(option: Option) => Promise<TaroGeneral.CallbackResult>
```

## 参数

| 参数 | 类型 |
| --- | --- |
| option | `Option` |

### Option

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| width | `string` | 是 | 窗口宽度，以像素为单位 |
| height | `string` | 是 | 窗口高度，以像素为单位 |
| complete | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用结束的回调函数（调用成功、失败都会执行） |
| fail | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用失败的回调函数 |
| success | `(res: TaroGeneral.CallbackResult) => void` | 否 | 接口调用成功的回调函数 |
</file>

<file path="docs/apis/worker/createWorker.md">
---
title: Taro.createWorker(scriptPath)
sidebar_label: createWorker
---

创建一个 Worker 线程。目前限制最多只能创建一个 Worker，创建下一个 Worker 前请先调用 [Worker.terminate](/docs/apis/worker/#terminate)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/worker/wx.createWorker.html)

## 类型

```tsx
(scriptPath: string) => Worker
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| scriptPath | `string` | worker 入口文件的**绝对路径** |

## 示例代码

```tsx
const worker = Taro.createWorker('workers/request/index.js') // 文件名指定 worker 的入口文件路径，绝对路径
  worker.onMessage(function (res) {
  console.log(res)
})
worker.postMessage({
  msg: 'hello worker'
})
worker.terminate()
```
</file>

<file path="docs/apis/worker/Worker.md">
---
title: Worker
sidebar_label: Worker
---

## 方法

### onMessage

监听主线程/Worker 线程向当前线程发送的消息的事件。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/worker/Worker.onMessage.html)

```tsx
(callback: OnMessageCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnMessageCallback` | 主线程/Worker 线程向当前线程发送的消息的事件的回调函数 |

### onProcessKilled

监听 worker 线程被系统回收事件（当 iOS 系统资源紧张时，worker 线程存在被系统回收的可能，开发者可监听此事件并重新创建一个 worker）

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/worker/Worker.onProcessKilled.html)

```tsx
(callback: OnMessageCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `OnMessageCallback` | worker 线程被系统回收事件的回调函数 |

### postMessage

向主线程/Worker 线程发送的消息。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/worker/Worker.postMessage.html)

```tsx
(message: TaroGeneral.IAnyObject) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| message | `TaroGeneral.IAnyObject` | 需要发送的消息，必须是一个可序列化的 JavaScript key-value 形式的对象。 |

#### 示例代码

worker 线程中

```tsx
worker.postMessage({
  msg: 'hello from worker'
})
```

主线程中

```tsx
const worker = Taro.createWorker('workers/request/index.js')
worker.postMessage({
  msg: 'hello from main'
})
```

### terminate

结束当前 Worker 线程。仅限在主线程 worker 对象上调用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/worker/Worker.terminate.html)

```tsx
() => void
```

## 参数

### OnMessageCallback

```tsx
(result: OnMessageCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `OnMessageCallbackResult` |

### OnMessageCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| message | `TaroGeneral.IAnyObject` | 主线程/Worker 线程向当前线程发送的消息 |

## API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| Worker.onMessage | ✔️ |  |  |  |  |
| Worker.onProcessKilled | ✔️ |  |  |  |  |
| Worker.postMessage | ✔️ |  |  |  |  |
| Worker.terminate | ✔️ |  |  |  |  |
</file>

<file path="docs/apis/wxml/createIntersectionObserver.md">
---
title: Taro.createIntersectionObserver(component, options)
sidebar_label: createIntersectionObserver
---

创建并返回一个 IntersectionObserver 对象实例。在自定义组件或包含自定义组件的页面中，应使用 `this.createIntersectionObserver([options])` 来代替。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/wx.createIntersectionObserver.html)

## 类型

```tsx
(component: TaroGeneral.IAnyObject, options?: Option) => IntersectionObserver
```

## 参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| component | `TaroGeneral.IAnyObject` | 自定义组件实例 |
| options | `Option` | 选项 |

### Option

选项

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| initialRatio | `number` | 否 | 初始的相交比例，如果调用时检测到的相交比例与这个值不相等且达到阈值，则会触发一次监听器的回调函数。 |
| observeAll | `boolean` | 否 | 是否同时观测多个目标节点（而非一个），如果设为 true ，observe 的 targetSelector 将选中多个节点（注意：同时选中过多节点将影响渲染性能） |
| thresholds | `number[]` | 否 | 一个数值数组，包含所有阈值。 |

## 示例代码

```tsx
const observer = Taro.createIntersectionObserver(this, { thresholds: [0], observeAll: true })
```
</file>

<file path="docs/apis/wxml/createMediaQueryObserver.md">
---
title: Taro.createMediaQueryObserver()
sidebar_label: createMediaQueryObserver
---

创建并返回一个 MediaQueryObserver 对象实例。在自定义组件或包含自定义组件的页面中，应使用 `this.createMediaQueryObserver()` 来代替。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/framework/view/resizable.html#Media%20Query)

## 类型

```tsx
() => MediaQueryObserver
```

## 示例代码

```tsx
let createMediaQueryObserver
if (process.env.TARO_ENV === 'weapp') {
   // 小程序没有组件实例，只能获取Page级组件实例
   createMediaQueryObserver = Taro.getCurrentInstance().page.createMediaQueryObserver
} else if (process.env.TARO_ENV === 'h5') {
   createMediaQueryObserver= Taro.createMediaQueryObserver
}
const mediaQueryObserver = createMediaQueryObserver()
```
</file>

<file path="docs/apis/wxml/createSelectorQuery.md">
---
title: Taro.createSelectorQuery()
sidebar_label: createSelectorQuery
---

返回一个 SelectorQuery 对象实例。在自定义组件或包含自定义组件的页面中，应使用 `this.createSelectorQuery()` 来代替。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/wx.createSelectorQuery.html)

## 类型

```tsx
() => SelectorQuery
```

## 示例代码

```tsx
const query = Taro.createSelectorQuery()
query.select('#the-id').boundingClientRect()
query.selectViewport().scrollOffset()
query.exec(function(res){
  res[0].top       // #the-id节点的上边界坐标
  res[1].scrollTop // 显示区域的竖直滚动位置
})
```
</file>

<file path="docs/apis/wxml/IntersectionObserver.md">
---
title: IntersectionObserver
sidebar_label: IntersectionObserver
---

`IntersectionObserver` 对象，用于推断某些节点是否可以被用户看见、有多大比例可以被用户看见。

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/IntersectionObserver.html)

## 方法

### disconnect

停止监听。回调函数将不再触发

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/IntersectionObserver.disconnect.html)

```tsx
() => void
```

### observe

指定目标节点并开始监听相交状态变化情况

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/IntersectionObserver.observe.html)

```tsx
(targetSelector: string, callback: ObserveCallback) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| targetSelector | `string` | 选择器 |
| callback | `ObserveCallback` | 监听相交状态变化的回调函数 |

### relativeTo

使用选择器指定一个节点，作为参照区域之一。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/IntersectionObserver.relativeTo.html)

```tsx
(selector: string, margins?: RelativeToMargins) => IntersectionObserver
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| selector | `string` | 选择器 |
| margins | `RelativeToMargins` | 用来扩展（或收缩）参照节点布局区域的边界 |

### relativeToViewport

指定页面显示区域作为参照区域之一

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/IntersectionObserver.relativeToViewport.html)

```tsx
(margins?: RelativeToViewportMargins) => IntersectionObserver
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| margins | `RelativeToViewportMargins` | 用来扩展（或收缩）参照节点布局区域的边界 |

#### 示例代码

下面的示例代码中，如果目标节点（用选择器 .target-class 指定）进入显示区域以下 100px 时，就会触发回调函数。

```tsx
Taro.createIntersectionObserver().relativeToViewport({bottom: 100}).observe('.target-class', (res) => {
  res.intersectionRatio // 相交区域占目标节点的布局区域的比例
  res.intersectionRect // 相交区域
  res.intersectionRect.left // 相交区域的左边界坐标
  res.intersectionRect.top // 相交区域的上边界坐标
  res.intersectionRect.width // 相交区域的宽度
  res.intersectionRect.height // 相交区域的高度
})
```

## 参数

### ObserveCallback

监听相交状态变化的回调函数

```tsx
(result: ObserveCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `ObserveCallbackResult` |

### ObserveCallbackResult

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| errMsg | `string` | 否 | 错误信息，会在找不到对应元素时返回<br />API 支持度: harmony |
| boundingClientRect | `BoundingClientRectResult` | 否 | 目标边界 |
| intersectionRatio | `number` | 否 | 相交比例 |
| intersectionRect | `IntersectionRectResult` | 否 | 相交区域的边界 |
| relativeRect | `RelativeRectResult` | 否 | 参照区域的边界 |
| time | `number` | 否 | 相交检测时的时间戳 |

### RelativeRectResult

参照区域的边界

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| bottom | `number` | 下边界 |
| left | `number` | 左边界 |
| right | `number` | 右边界 |
| top | `number` | 上边界 |

### IntersectionRectResult

相交区域的边界

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| bottom | `number` | 下边界 |
| height | `number` | 高度 |
| left | `number` | 左边界 |
| right | `number` | 右边界 |
| top | `number` | 上边界 |
| width | `number` | 宽度 |

### BoundingClientRectResult

目标边界

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| bottom | `number` | 下边界 |
| height | `number` | 高度 |
| left | `number` | 左边界 |
| right | `number` | 右边界 |
| top | `number` | 上边界 |
| width | `number` | 宽度 |

### RelativeToMargins

用来扩展（或收缩）参照节点布局区域的边界

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| bottom | `number` | 否 | 节点布局区域的下边界 |
| left | `number` | 否 | 节点布局区域的左边界 |
| right | `number` | 否 | 节点布局区域的右边界 |
| top | `number` | 否 | 节点布局区域的上边界 |

### RelativeToViewportMargins

用来扩展（或收缩）参照节点布局区域的边界

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| bottom | `number` | 否 | 节点布局区域的下边界 |
| left | `number` | 否 | 节点布局区域的左边界 |
| right | `number` | 否 | 节点布局区域的右边界 |
| top | `number` | 否 | 节点布局区域的上边界 |

## API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| IntersectionObserver.disconnect | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| IntersectionObserver.observe | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| IntersectionObserver.relativeTo | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| IntersectionObserver.relativeToViewport | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
</file>

<file path="docs/apis/wxml/MediaQueryObserver.md">
---
title: MediaQueryObserver
sidebar_label: MediaQueryObserver
---

`MediaQueryObserver` 对象，用于监听页面 media query 状态的变化，如界面的长宽是不是在某个指定的范围内。

## 方法

### observe

开始监听页面 media query 变化情况

```tsx
(descriptor: descriptor, callback: observeCallback) => void
```

| 参数 | 类型 |
| --- | --- |
| descriptor | `descriptor` |
| callback | `observeCallback` |

### disconnect

停止监听。回调函数将不再触发

```tsx
() => void
```

## 参数

### descriptor

media query 描述符

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| minWidth | `number` | 页面最小宽度 (单位: px) |
| maxWidth | `number` | 页面最大宽度 (单位: px) |
| width | `number` | 页面宽度 (单位: px) |
| minHeight | `number` | 页面最小高度 (单位: px) |
| maxHeight | `number` | 页面最大高度（px 为单位） |
| height | `number` | 页面高度（px 为单位） |
| orientation | "landscape" or "portrait" | 屏幕方向 |

### observeCallback

监听 media query 状态变化的回调函数

```tsx
(res: { matches: boolean; }) => void
```

| 参数 | 类型 |
| --- | --- |
| res | `{ matches: boolean; }` |
</file>

<file path="docs/apis/wxml/NodesRef.md">
---
title: NodesRef
sidebar_label: NodesRef
---

用于获取 `WXML` 节点信息的对象

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/NodesRef.html)

## 方法

### boundingClientRect

添加节点的布局位置的查询请求。相对于显示区域，以像素为单位。其功能类似于 DOM 的 `getBoundingClientRect`。返回 `NodesRef` 对应的 `SelectorQuery`。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/NodesRef.boundingClientRect.html)

```tsx
(callback?: BoundingClientRectCallback) => SelectorQuery
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `BoundingClientRectCallback` | 回调函数，在执行 `SelectorQuery.exec` 方法后，节点信息会在 `callback` 中返回。 |

#### 示例代码

##### 示例 1

```tsx
Taro.createSelectorQuery().select('#the-id').boundingClientRect(function(rect){
  rect.id      // 节点的ID
  rect.dataset // 节点的dataset
  rect.left    // 节点的左边界坐标
  rect.right   // 节点的右边界坐标
  rect.top     // 节点的上边界坐标
  rect.bottom  // 节点的下边界坐标
  rect.width   // 节点的宽度
  rect.height  // 节点的高度
}).exec()

##### 示例 2

```
```tsx
Taro.createSelectorQuery().selectAll('.a-class').boundingClientRect(function(rects){
  rects.forEach(function(rect){
    rect.id      // 节点的ID
    rect.dataset // 节点的dataset
    rect.left    // 节点的左边界坐标
    rect.right   // 节点的右边界坐标
    rect.top     // 节点的上边界坐标
    rect.bottom  // 节点的下边界坐标
    rect.width   // 节点的宽度
    rect.height  // 节点的高度
  })
}).exec()
```

### context

添加节点的 Context 对象查询请求。目前支持 [VideoContext](/docs/apis/media/video/VideoContext)、[CanvasContext](/docs/apis/canvas/CanvasContext)、[LivePlayerContext](/docs/apis/media/live/LivePlayerContext)、[EditorContext](/docs/apis/media/editor/EditorContext)和 [MapContext](/docs/apis/media/map/MapContext) 的获取。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/NodesRef.context.html)

```tsx
(callback?: ContextCallback) => SelectorQuery
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `ContextCallback` | 回调函数，在执行 `SelectorQuery.exec` 方法后，返回节点信息。 |

#### 示例代码

```tsx
Taro.createSelectorQuery().select('.the-video-class').context(function (res) {
  console.log(res.context) // 节点对应的 Context 对象。如：选中的节点是 <video> 组件，那么此处即返回 VideoContext 对象
}).exec()
```

### fields

获取节点的相关信息。需要获取的字段在fields中指定。返回值是 `nodesRef` 对应的 `selectorQuery`

**注意**
computedStyle 的优先级高于 size，当同时在 computedStyle 里指定了 width/height 和传入了 size: true，则优先返回 computedStyle 获取到的 width/height。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/NodesRef.fields.html)

```tsx
(fields: Fields, callback?: FieldsCallback) => SelectorQuery
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| fields | `Fields` |  |
| callback | `FieldsCallback` | 回调函数 |

#### 示例代码

```tsx
Taro.createSelectorQuery().select('#the-id').fields({
  dataset: true,
  size: true,
  scrollOffset: true,
  properties: ['scrollX', 'scrollY'],
  computedStyle: ['margin', 'backgroundColor'],
  context: true,
}, function (res) {
  res.dataset    // 节点的dataset
  res.width      // 节点的宽度
  res.height     // 节点的高度
  res.scrollLeft // 节点的水平滚动位置
  res.scrollTop  // 节点的竖直滚动位置
  res.scrollX    // 节点 scroll-x 属性的当前值
  res.scrollY    // 节点 scroll-y 属性的当前值
  // 此处返回指定要返回的样式名
  res.margin
  res.backgroundColor
  res.context    // 节点对应的 Context 对象
}).exec()
```

### node

获取 Node 节点实例。目前支持 [Canvas](/docs/components/canvas) 的获取。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/NodesRef.node.html)

```tsx
(callback?: NodeCallback) => SelectorQuery
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `NodeCallback` | 回调函数，在执行 `SelectorQuery.exec` 方法后，返回节点信息。 |

#### 示例代码

```tsx
Taro.createSelectorQuery().select('.canvas').node(function(res){
  console.log(res.node) // 节点对应的 Canvas 实例。
}).exec()
```

### scrollOffset

添加节点的滚动位置查询请求。以像素为单位。节点必须是 `scroll-view` 或者 `viewport`，返回 `NodesRef` 对应的 `SelectorQuery`。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/NodesRef.scrollOffset.html)

```tsx
(callback?: ScrollOffsetCallback) => SelectorQuery
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `ScrollOffsetCallback` | 回调函数，在执行 `SelectorQuery.exec` 方法后，节点信息会在 `callback` 中返回。 |

#### 示例代码

```tsx
Taro.createSelectorQuery().selectViewport().scrollOffset(function(res){
  res.id      // 节点的ID
  res.dataset // 节点的dataset
  res.scrollLeft // 节点的水平滚动位置
  res.scrollTop  // 节点的竖直滚动位置
}).exec()
```

## 参数

### BoundingClientRectCallback

回调函数，在执行 `SelectorQuery.exec` 方法后，节点信息会在 `callback` 中返回。

```tsx
(result: BoundingClientRectCallbackResult | BoundingClientRectCallbackResult[]) => void
```

| 参数 | 类型 |
| --- | --- |
| result | BoundingClientRectCallbackResult or BoundingClientRectCallbackResult[] |

### BoundingClientRectCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| bottom | `number` | 节点的下边界坐标 |
| dataset | `TaroGeneral.IAnyObject` | 节点的 dataset |
| height | `number` | 节点的高度 |
| id | `string` | 节点的 ID |
| left | `number` | 节点的左边界坐标 |
| right | `number` | 节点的右边界坐标 |
| top | `number` | 节点的上边界坐标 |
| width | `number` | 节点的宽度 |

### ContextCallback

回调函数，在执行 `SelectorQuery.exec` 方法后，返回节点信息。

```tsx
(result: ContextCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `ContextCallbackResult` |

### ContextCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| context | `TaroGeneral.IAnyObject` | 节点对应的 Context 对象 |

### Fields

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| computedStyle | `string[]` | 否 | 指定样式名列表，返回节点对应样式名的当前值 |
| context | `boolean` | 否 | 是否返回节点对应的 Context 对象 |
| dataset | `boolean` | 否 | 是否返回节点 dataset |
| id | `boolean` | 否 | 是否返回节点 id |
| mark | `boolean` | 否 | 是否返回节点 mark |
| node | `boolean` | 否 | 是否返回节点对应的 Node 实例 |
| properties | `string[]` | 否 | 指定属性名列表，返回节点对应属性名的当前属性值（只能获得组件文档中标注的常规属性值，id class style 和事件绑定的属性值不可获取） |
| rect | `boolean` | 否 | 是否返回节点布局位置（`left` `right` `top` `bottom`） |
| scrollOffset | `boolean` | 否 | 否 是否返回节点的 `scrollLeft` `scrollTop`，节点必须是 `scroll-view` 或者 `viewport` |
| size | `boolean` | 否 | 是否返回节点尺寸（`width` `height`） |

### FieldsCallback

回调函数

```tsx
(res: TaroGeneral.IAnyObject) => void
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| res | `TaroGeneral.IAnyObject` | 节点的相关信息 |

### NodeCallback

回调函数，在执行 `SelectorQuery.exec` 方法后，返回节点信息。

```tsx
(result: NodeCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `NodeCallbackResult` |

### NodeCallbackResult

回调函数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| node | `TaroGeneral.IAnyObject` | 节点对应的 Node 实例 |

### ScrollOffsetCallback

回调函数，在执行 `SelectorQuery.exec` 方法后，节点信息会在 `callback` 中返回。

```tsx
(result: ScrollOffsetCallbackResult) => void
```

| 参数 | 类型 |
| --- | --- |
| result | `ScrollOffsetCallbackResult` |

### ScrollOffsetCallbackResult

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| dataset | `TaroGeneral.IAnyObject` | 节点的 dataset |
| id | `string` | 节点的 ID |
| scrollLeft | `number` | 节点的水平滚动位置 |
| scrollTop | `number` | 节点的竖直滚动位置 |

## API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| NodesRef.boundingClientRect | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| NodesRef.context | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |
| NodesRef.fields | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |
| NodesRef.node | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |
| NodesRef.scrollOffset | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |
</file>

<file path="docs/apis/wxml/SelectorQuery.md">
---
title: SelectorQuery
sidebar_label: SelectorQuery
---

查询节点信息的对象

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/SelectorQuery.html)

## 方法

### exec

执行所有的请求。请求结果按请求次序构成数组，在callback的第一个参数中返回。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/SelectorQuery.exec.html)

```tsx
(callback?: (...args: any[]) => any) => NodesRef
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| callback | `(...args: any[]) => any` | 回调函数 |

### in

将选择器的选取范围更改为自定义组件 `component` 内。（初始时，选择器仅选取页面范围的节点，不会选取任何自定义组件中的节点）。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/SelectorQuery.in.html)

```tsx
(component: TaroGeneral.IAnyObject) => SelectorQuery
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| component | `TaroGeneral.IAnyObject` | 自定义组件实例 |

#### 示例代码

```tsx
Component({
  queryMultipleNodes () {
    const query = Taro.createSelectorQuery().in(this)
    query.select('#the-id').boundingClientRect(function(res){
      res.top // 这个组件内 #the-id 节点的上边界坐标
    }).exec()
  }
})
```

### select

在当前页面下选择第一个匹配选择器 `selector` 的节点。返回一个 `NodesRef` 对象实例，可以用于获取节点信息。

**selector 语法**


selector类似于 CSS 的选择器，但仅支持下列语法。

- ID选择器：#the-id
- class选择器（可以连续指定多个）：.a-class.another-class
- 子元素选择器：.the-parent > .the-child
- 后代选择器：.the-ancestor .the-descendant
- 跨自定义组件的后代选择器：.the-ancestor >>> .the-descendant
- 多选择器的并集：#a-node, .some-other-nodes

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/SelectorQuery.select.html)

```tsx
(selector: string) => NodesRef
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| selector | `string` | 选择器 |

#### 示例代码

```tsx
Taro.createSelectorQuery().select('#the-id').fields({
  dataset: true,
  size: true,
  scrollOffset: true,
  properties: ['scrollX', 'scrollY']
}, function (res){
  res.dataset    // 节点的dataset
  res.width      // 节点的宽度
  res.height     // 节点的高度
  res.scrollLeft // 节点的水平滚动位置
  res.scrollTop  // 节点的竖直滚动位置
  res.scrollX    // 节点 scroll-x 属性的当前值
  res.scrollY    // 节点 scroll-x 属性的当前值
}).exec()
```

### selectAll

在当前页面下选择匹配选择器 selector 的所有节点。

**selector 语法**

selector类似于 CSS 的选择器，但仅支持下列语法。

- ID选择器：#the-id
- class选择器（可以连续指定多个）：.a-class.another-class
- 子元素选择器：.the-parent > .the-child
- 后代选择器：.the-ancestor .the-descendant
- 跨自定义组件的后代选择器：.the-ancestor >>> .the-descendant
- 多选择器的并集：#a-node, .some-other-nodes

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/SelectorQuery.selectAll.html)

```tsx
(selector: string) => NodesRef
```

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| selector | `string` | 选择器 |

### selectViewport

选择显示区域。可用于获取显示区域的尺寸、滚动位置等信息。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/SelectorQuery.selectViewport.html)

```tsx
() => NodesRef
```

#### 示例代码

```tsx
Taro.createSelectorQuery().selectViewport().scrollOffset(function (res) {
  res.id      // 节点的ID
  res.dataset // 节点的dataset
  res.scrollLeft // 节点的水平滚动位置
  res.scrollTop  // 节点的竖直滚动位置
}).exec()
```

## API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| SelectorQuery.exec | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| SelectorQuery.in | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| SelectorQuery.select | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| SelectorQuery.selectAll | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| SelectorQuery.selectViewport | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
</file>

<file path="docs/apis/General.md">
---
title: General
sidebar_label: General
---

## 参数

### CallbackResult

通用错误

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |

### BluetoothError

蓝牙错误

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |
| errCode | `0 | 10000 | 10001 | 10002 | 10003 | 10004 | 10005 | 10006 | 10007 | 10008 | 10009 | 10012 | 10013` | 错误码 |

### WifiError

WIFI 错误

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |
| errCode | `0 | 12000 | 12001 | 12002 | 12003 | 12004 | 12005 | 12006 | 12007 | 12008 | 12009 | 12010 | 12011 | 12013` | 错误码 |

### NFCError

NFC 错误

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |
| errCode | `0 | 13000 | 13001 | 13002 | 13003 | 13004 | 13005 | 13006` | 错误码 |

### IBeaconError

iBeacon 错误

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |
| errCode | `0 | 11000 | 11001 | 11002 | 11003 | 11004 | 11005 | 11006` | 错误码 |

### SafeAreaResult

在竖屏正方向下的安全区域

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| bottom | `number` | 安全区域右下角纵坐标 |
| height | `number` | 安全区域的高度，单位逻辑像素 |
| left | `number` | 安全区域左上角横坐标 |
| right | `number` | 安全区域右下角横坐标 |
| top | `number` | 安全区域左上角纵坐标 |
| width | `number` | 安全区域的宽度，单位逻辑像素 |

### AdErrCode

广告错误码

错误码是通过onError获取到的错误信息。调试期间，可以通过异常返回来捕获信息。
在小程序发布上线之后，如果遇到异常问题，可以在[“运维中心“](https://mp.weixin.qq.com/)里面搜寻错误日志，还可以针对异常返回加上适当的监控信息。

| 参数 | 异常情况 | 理由 | 解决方案 |
| --- | :---: | :---: | :---: |
| 1000 | `后端接口调用失败` | `该项错误不是开发者的异常情况` | `一般情况下忽略一段时间即可恢复。` |
| 1001 | `参数错误` | `使用方法错误` | `可以前往 developers.weixin.qq.com 确认具体教程（小程序和小游戏分别有各自的教程，可以在顶部选项中，“设计”一栏的右侧进行切换。` |
| 1002 | `广告单元无效` | `可能是拼写错误、或者误用了其他APP的广告ID` | `请重新前往 mp.weixin.qq.com 确认广告位ID。` |
| 1003 | `内部错误` | `该项错误不是开发者的异常情况` | `一般情况下忽略一段时间即可恢复。` |
| 1004 | `无合适的广告` | `广告不是每一次都会出现，这次没有出现可能是由于该用户不适合浏览广告` | `属于正常情况，且开发者需要针对这种情况做形态上的兼容。` |
| 1005 | `广告组件审核中` | `你的广告正在被审核，无法展现广告` | `请前往 mp.weixin.qq.com 确认审核状态，且开发者需要针对这种情况做形态上的兼容。` |
| 1006 | `广告组件被驳回` | `你的广告审核失败，无法展现广告` | `请前往 mp.weixin.qq.com 确认审核状态，且开发者需要针对这种情况做形态上的兼容。` |
| 1007 | `广告组件被封禁` | `你的广告能力已经被封禁，封禁期间无法展现广告` | `请前往 mp.weixin.qq.com 确认小程序广告封禁状态。` |
| 1008 | `广告单元已关闭` | `该广告位的广告能力已经被关闭` | `请前往 mp.weixin.qq.com 重新打开对应广告位的展现。` |

### BluetoothErrCode

蓝牙错误码

| 参数 | 异常情况 | 说明 |
| --- | :---: | --- |
| 0 | `ok` | 正常 |
| 10000 | `not init` | 未初始化蓝牙适配器 |
| 10001 | `not available` | 当前蓝牙适配器不可用 |
| 10002 | `no device` | 没有找到指定设备 |
| 10003 | `connection fail` | 连接失败 |
| 10004 | `no service` | 没有找到指定服务 |
| 10005 | `no characteristic` | 没有找到指定特征值 |
| 10006 | `no connection` | 当前连接已断开 |
| 10007 | `property not support` | 当前特征值不支持此操作 |
| 10008 | `system error` | 其余所有系统上报的异常 |
| 10009 | `system not support` | Android 系统特有，系统版本低于 4.3 不支持 BLE |
| 10012 | `operate time out` | 连接超时 |
| 10013 | `invalid_data` | 连接 deviceId 为空或者是格式不正确 |

### IBeaconErrCode

iBeacon 错误码

| 参数 | 异常情况 | 说明 |
| --- | :---: | --- |
| 0 | `ok` | 正常 |
| 11000 | `unsupport` | 系统或设备不支持 |
| 11001 | `bluetooth service unavailable` | 蓝牙服务不可用 |
| 11002 | `location service unavailable` | 位置服务不可用 |
| 11003 | `already start` | 已经开始搜索 |
| 11004 | `not startBeaconDiscovery` | 还未开始搜索 |
| 11005 | `system error` | 系统错误 |
| 11006 | `invalid data` | 参数不正确 |

### WifiErrCode

WIFI 错误码

| 参数 | 异常情况 | 说明 |
| --- | :---: | --- |
| 0 | `ok` | 正常 |
| 12000 | `not init` | 未先调用 `startWifi` 接口 |
| 12001 | `system not support` | 当前系统不支持相关能力 |
| 12002 | `password error Wi-Fi` | 密码错误 |
| 12003 | `connection timeout` | 连接超时 |
| 12004 | `duplicate request` | 重复连接 Wi-Fi |
| 12005 | `wifi not turned on` | Android 特有，未打开 Wi-Fi 开关 |
| 12006 | `wifi not turned on` | Android 特有，未打开 GPS 定位开关 |
| 12007 | `user denied` | 用户拒绝授权链接 Wi-Fi |
| 12008 | `invalid SSID` | 无效 SSID |
| 12009 | `system config err` | 系统运营商配置拒绝连接 Wi-Fi |
| 12010 | `system internal error` | 系统其他错误，需要在 errmsg 打印具体的错误原因 |
| 12011 | `weapp in background` | 应用在后台无法配置 Wi-Fi |
| 12013 | `wifi config may be expired` | 系统保存的 Wi-Fi 配置过期，建议忘记 Wi-Fi 后重试 |

### NFCErrCode

NFC 错误码

| 参数 | 异常情况 | 说明 |
| --- | :---: | --- |
| 0 | `ok` | 正常 |
| 13000 |  | 当前设备不支持NFC |
| 13001 |  | 当前设备支持NFC，但系统NFC开关未开启 |
| 13002 |  | 当前设备支持NFC，但不支持HCE |
| 13003 |  | AID列表参数格式错误 |
| 13004 |  | 未设置微信为默认NFC支付应用 |
| 13005 |  | 返回的指令不合法 |
| 13006 |  | 注册AID失败 |

### LaunchOptionsApp

启动参数

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| path | `string` | 启动小程序的路径 |
| query | `Record<string, any>` | 启动小程序的 query 参数 |
| referrerInfo | `ReferrerInfo` | 来源信息。从另一个小程序、公众号或 App 进入小程序时返回。否则返回 `{}`。(参见后文注意) |
| scene | `number` | 启动小程序的[场景值](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/scene.html) |
| shareTicket | `string` | shareTicket，详见[获取更多转发信息](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share.html) |

#### ReferrerInfo

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| appId | `string` | 来源小程序、公众号或 App 的 appId |
| extraData | `Record<string, any>` | 来源小程序传过来的数据，scene=1037或1038时支持 |
</file>

<file path="docs/apis/index.md">
# 小程序 API 列表

## 基础

Taro.env 环境变量
Taro.canIUse 判断小程序的API，回调，参数，组件等是否在当前版本可用
Taro.base64ToArrayBuffer 将 Base64 字符串转成 ArrayBuffer 对象
Taro.arrayBufferToBase64 将 ArrayBuffer 对象转成 Base64 字符串

### 系统

Taro.openSystemBluetoothSetting 跳转系统蓝牙设置页
Taro.openAppAuthorizeSetting 跳转系统微信授权管理页
Taro.getWindowInfo 获取窗口信息
Taro.getSystemSetting 获取设备设置
Taro.getSystemInfoSync Taro.getSystemInfo 的同步版本
Taro.getSystemInfoAsync 异步获取系统信息
Taro.getSystemInfo 获取系统信息
Taro.getDeviceInfo 获取设备基础信息
Taro.getAppBaseInfo 获取微信APP基础信息
Taro.getAppAuthorizeSetting 获取微信APP授权设置

### 更新

Taro.updateWeChatApp 更新客户端版本
Taro.getUpdateManager 获取全局唯一的版本更新管理器，用于管理小程序更新

#### UpdateManager

UpdateManager.applyUpdate 强制小程序重启并使用新版本
UpdateManager.onCheckForUpdate 监听向微信后台请求检查更新结果事件
UpdateManager.onUpdateFailed 监听小程序更新失败事件
UpdateManager.onUpdateReady 监听小程序有版本更新事件

### 小程序

#### 生命周期

Taro.getLaunchOptionsSync 获取小程序启动时的参数
Taro.getEnterOptionsSync 获取本次小程序启动时的参数

#### 应用级事件

Taro.onUnhandledRejection 监听未处理的 Promise 拒绝事件
Taro.onThemeChange 监听系统主题改变事件
Taro.onPageNotFound 监听小程序要打开的页面不存在事件
Taro.onError 监听小程序错误事件
Taro.onAudioInterruptionEnd 监听音频中断结束事件
Taro.onAudioInterruptionBegin 监听音频因为受到系统占用而被中断开始事件
Taro.onAppShow 小程序切前台事件
Taro.onAppHide 监听小程序切后台事件
Taro.offUnhandledRejection 取消监听未处理的 Promise 拒绝事件
Taro.offThemeChange 取消监听系统主题改变事件
Taro.offPageNotFound 取消监听小程序要打开的页面不存在事件
Taro.offError 取消监听小程序错误事件
Taro.offAudioInterruptionEnd 取消监听音频中断结束事件
Taro.offAudioInterruptionBegin 取消监听音频因为受到系统占用而被中断开始事件
Taro.offAppShow 取消监听小程序切前台事件
Taro.offAppHide 取消监听小程序切后台事件

### 调试

Taro.setEnableDebug 设置是否打开调试开关
Taro.getRealtimeLogManager 获取实时日志管理器对象
Taro.getLogManager 获取日志管理器对象

#### console

console.debug 向调试面板中打印 debug 日志
console.error 向调试面板中打印 error 日志
console.group 在调试面板中创建一个新的分组
console.groupEnd 结束由 console.group 创建的分组
console.info 向调试面板中打印 info 日志
console.log 向调试面板中打印 log 日志
console.warn 向调试面板中打印 warn 日志

#### LogManager

LogManager.debug 写 debug 日志
LogManager.info 写 info 日志
LogManager.log 写 log 日志
LogManager.warn 写 warn 日志

#### RealtimeLogManager

RealtimeLogManager.addFilterMsg 添加过滤关键字，暂不支持在插件使用
RealtimeLogManager.error 写 error 日志，暂不支持在插件使用
RealtimeLogManager.getCurrentState 实时日志会将一定时间间隔内缓存的日志聚合上报，如果该时间内缓存的内容超出限制，则会被丢弃
RealtimeLogManager.in 设置实时日志page参数所在的页面，暂不支持在插件使用
RealtimeLogManager.info 写 info 日志，暂不支持在插件使用
RealtimeLogManager.setFilterMsg 设置过滤关键字，暂不支持在插件使用
RealtimeLogManager.tag 获取给定标签的日志管理器实例，目前只支持在插件使用
RealtimeLogManager.warn 写 warn 日志，暂不支持在插件使用

#### RealtimeTagLogManager

RealtimeTagLogManager.addFilterMsg 添加过滤关键字
RealtimeTagLogManager.error 写 error 日志
RealtimeTagLogManager.info 写 info 日志
RealtimeTagLogManager.setFilterMsg 设置过滤关键字
RealtimeTagLogManager.warn 写 warn 日志

### 性能

Taro.reportPerformance 小程序测速上报
Taro.getPerformance 获取当前小程序性能相关的信息

#### EntryList

EntryList.getEntries 该方法返回当前列表中的所有性能数据
EntryList.getEntriesByName 获取当前列表中所有名称为 [name] 且类型为 [entryType] 的性能数据
EntryList.getEntriesByType 获取当前列表中所有类型为 [entryType] 的性能数据

#### Performance

Performance.createObserver 创建全局性能事件监听器
Performance.getEntries 该方法返回当前缓冲区中的所有性能数据
Performance.getEntriesByName 获取当前缓冲区中所有名称为 [name] 且类型为 [entryType] 的性能数据
Performance.getEntriesByType 获取当前缓冲区中所有类型为 [entryType] 的性能数据
Performance.setBufferSize 设置缓冲区大小，默认缓冲 30 条性能数据

#### PerformanceEntry 单条性能数据

#### PerformanceObserver

PerformanceObserver.disconnect 停止监听
PerformanceObserver.observe 开始监听

### 加密

Taro.getUserCryptoManager 获取用户加密模块

#### UserCryptoManager

UserCryptoManager.getLatestUserKey 获取最新的用户加密密钥
UserCryptoManager.getRandomValues 获取密码学安全随机数

## 路由

Taro.switchTab 跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面
Taro.reLaunch 关闭所有页面，打开到应用内的某个页面
Taro.redirectTo 关闭当前页面，跳转到应用内的某个页面
Taro.navigateTo 保留当前页面，跳转到应用内的某个页面
Taro.navigateBack 关闭当前页面，返回上一页面或多级页面

### EventChannel

EventChannel.emit 触发一个事件
EventChannel.off 取消监听一个事件
EventChannel.on 持续监听一个事件
EventChannel.once 监听一个事件一次，触发后失效

## 跳转

Taro.openEmbeddedMiniProgram 打开半屏小程序
Taro.navigateToMiniProgram 打开另一个小程序
Taro.navigateBackMiniProgram 返回到上一个小程序
Taro.exitMiniProgram 退出当前小程序

## 转发

Taro.updateShareMenu 更新转发属性
Taro.showShareMenu 显示当前页面的转发按钮
Taro.showShareImageMenu 打开分享图片弹窗，可以将图片发送给朋友、收藏或下载
Taro.shareVideoMessage 转发视频到聊天
Taro.shareFileMessage 转发文件到聊天
Taro.onCopyUrl 监听用户点击右上角菜单的「复制链接」按钮时触发的事件
Taro.offCopyUrl 取消监听用户点击右上角菜单的「复制链接」按钮时触发的事件
Taro.hideShareMenu 隐藏当前页面的转发按钮
Taro.getShareInfo 获取转发详细信息
Taro.authPrivateMessage 验证私密消息

## 界面

### 交互

Taro.showToast 显示消息提示框
Taro.showModal 显示模态对话框
Taro.showLoading 显示 loading 提示框
Taro.showActionSheet 显示操作菜单
Taro.hideToast 隐藏消息提示框
Taro.hideLoading 隐藏 loading 提示框
Taro.enableAlertBeforeUnload 开启小程序页面返回询问对话框
Taro.disableAlertBeforeUnload 关闭小程序页面返回询问对话框

### 导航栏

Taro.showNavigationBarLoading 在当前页面显示导航条加载动画
Taro.setNavigationBarTitle 动态设置当前页面的标题
Taro.setNavigationBarColor 设置页面导航条颜色
Taro.hideNavigationBarLoading 在当前页面隐藏导航条加载动画
Taro.hideHomeButton 隐藏返回首页按钮

### 背景

Taro.setBackgroundTextStyle 动态设置下拉背景字体、loading 图的样式
Taro.setBackgroundColor 动态设置窗口的背景色

### Tab Bar

Taro.showTabBarRedDot 显示 tabBar 某一项的右上角的红点
Taro.showTabBar 显示 tabBar
Taro.setTabBarStyle 动态设置 tabBar 的整体样式
Taro.setTabBarItem 动态设置 tabBar 某一项的内容，2.7.0 起图片支持临时文件和网络文件
Taro.setTabBarBadge 为 tabBar 某一项的右上角添加文本
Taro.removeTabBarBadge 移除 tabBar 某一项右上角的文本
Taro.hideTabBarRedDot 隐藏 tabBar 某一项的右上角的红点
Taro.hideTabBar 隐藏 tabBar

### 字体

Taro.loadFontFace 动态加载网络字体，文件地址需为下载类型

### 下拉刷新

Taro.stopPullDownRefresh 停止当前页面下拉刷新
Taro.startPullDownRefresh 开始下拉刷新

### 滚动

Taro.pageScrollTo 将页面滚动到目标位置，支持选择器和滚动距离两种方式定位

#### ScrollViewContext

ScrollViewContext.scrollIntoView 滚动至指定位置
ScrollViewContext.scrollTo 滚动至指定位置

### 动画

Taro.createAnimation 创建一个动画实例 animation

#### Animation

Animation.backgroundColor 设置背景色
Animation.bottom 设置 bottom 值
Animation.export 导出动画队列
Animation.height 设置高度
Animation.left 设置 left 值
Animation.matrix 同 transform-function matrix
Animation.matrix3d 同 transform-function matrix3d
Animation.opacity 设置透明度
Animation.right 设置 right 值
Animation.rotate 从原点顺时针旋转一个角度
Animation.rotate3d 从 固定 轴顺时针旋转一个角度
Animation.rotateX 从 X 轴顺时针旋转一个角度
Animation.rotateY 从 Y 轴顺时针旋转一个角度
Animation.rotateZ 从 Z 轴顺时针旋转一个角度
Animation.scale 缩放
Animation.scale3d 缩放
Animation.scaleX 缩放 X 轴
Animation.scaleY 缩放 Y 轴
Animation.scaleZ 缩放 Z 轴
Animation.skew 对 X、Y 轴坐标进行倾斜
Animation.skewX 对 X 轴坐标进行倾斜
Animation.skewY 对 Y 轴坐标进行倾斜
Animation.step 表示一组动画完成
Animation.top 设置 top 值
Animation.translate 平移变换
Animation.translate3d 对 xyz 坐标进行平移变换
Animation.translateX 对 X 轴平移
Animation.translateY 对 Y 轴平移
Animation.translateZ 对 Z 轴平移
Animation.width 设置宽度

### 置顶

Taro.setTopBarText 动态设置置顶栏文字内容

### 自定义组件

Taro.nextTick 延迟一部分操作到下一个时间片再执行

### 菜单

Taro.getMenuButtonBoundingClientRect 获取菜单按钮（右上角胶囊按钮）的布局位置信息

### 窗口

Taro.setWindowSize 设置窗口大小，该接口仅适用于 PC 平台，使用细则请参见指南
Taro.onWindowResize 监听窗口尺寸变化事件
Taro.offWindowResize 取消监听窗口尺寸变化事件

## 网络

### 发起请求

Taro.request 发起 HTTPS 网络请求

#### RequestTask

RequestTask.abort 中断请求任务
RequestTask.offChunkReceived 取消监听 Transfer-Encoding Chunk Received 事件
RequestTask.offHeadersReceived 取消监听 HTTP Response Header 事件
RequestTask.onChunkReceived 监听 Transfer-Encoding Chunk Received 事件
RequestTask.onHeadersReceived 监听 HTTP Response Header 事件

### 下载

Taro.downloadFile 下载文件资源到本地

#### DownloadTask

DownloadTask.abort 中断下载任务
DownloadTask.offHeadersReceived 取消监听 HTTP Response Header 事件
DownloadTask.offProgressUpdate 取消监听下载进度变化事件
DownloadTask.onHeadersReceived 监听 HTTP Response Header 事件
DownloadTask.onProgressUpdate 监听下载进度变化事件

### 上传

Taro.uploadFile 将本地资源上传到服务器

#### UploadTask

UploadTask.abort 中断上传任务
UploadTask.offHeadersReceived 取消监听 HTTP Response Header 事件
UploadTask.offProgressUpdate 取消监听上传进度变化事件
UploadTask.onHeadersReceived 监听 HTTP Response Header 事件
UploadTask.onProgressUpdate 监听上传进度变化事件

### WebSocket

Taro.sendSocketMessage 通过 WebSocket 连接发送数据
Taro.onSocketOpen 监听 WebSocket 连接打开事件
Taro.onSocketMessage 监听 WebSocket 接受到服务器的消息事件
Taro.onSocketError 监听 WebSocket 错误事件
Taro.onSocketClose 监听 WebSocket 连接关闭事件
Taro.connectSocket 创建一个 WebSocket 连接
Taro.closeSocket 关闭 WebSocket 连接

#### SocketTask

SocketTask.close 关闭 WebSocket 连接
SocketTask.onClose 监听 WebSocket 连接关闭事件
SocketTask.onError 监听 WebSocket 错误事件
SocketTask.onMessage 监听 WebSocket 接受到服务器的消息事件
SocketTask.onOpen 监听 WebSocket 连接打开事件
SocketTask.send 通过 WebSocket 连接发送数据

### mDNS

Taro.stopLocalServiceDiscovery 停止搜索 mDNS 服务
Taro.startLocalServiceDiscovery 开始搜索局域网下的 mDNS 服务
Taro.onLocalServiceResolveFail 监听 mDNS 服务解析失败的事件
Taro.onLocalServiceLost 监听 mDNS 服务离开的事件
Taro.onLocalServiceFound 监听 mDNS 服务发现的事件
Taro.onLocalServiceDiscoveryStop 监听 mDNS 服务停止搜索的事件
Taro.offLocalServiceResolveFail 取消监听 mDNS 服务解析失败的事件
Taro.offLocalServiceLost 取消监听 mDNS 服务离开的事件
Taro.offLocalServiceFound 取消监听 mDNS 服务发现的事件
Taro.offLocalServiceDiscoveryStop 取消监听 mDNS 服务停止搜索的事件

### TCP 通信

Taro.createTCPSocket 创建一个 TCP Socket 实例

#### TCPSocket

TCPSocket.close 关闭连接
TCPSocket.connect 在给定的套接字上启动连接
TCPSocket.offClose 取消监听一旦 socket 完全关闭就发出该事件
TCPSocket.offConnect 取消监听当一个 socket 连接成功建立的时候触发该事件
TCPSocket.offError 取消监听当错误发生时触发
TCPSocket.offMessage 取消监听当接收到数据的时触发该事件
TCPSocket.onClose 监听一旦 socket 完全关闭就发出该事件
TCPSocket.onConnect 监听当一个 socket 连接成功建立的时候触发该事件
TCPSocket.onError 监听当错误发生时触发
TCPSocket.onMessage 监听当接收到数据的时触发该事件
TCPSocket.write 在 socket 上发送数据

### UDP 通信

Taro.createUDPSocket 创建一个 UDP Socket 实例

#### UDPSocket

UDPSocket.bind 绑定一个系统随机分配的可用端口，或绑定一个指定的端口号
UDPSocket.close 关闭 UDP Socket 实例，相当于销毁
UDPSocket.connect 预先连接到指定的 IP 和 port，需要配合 write 方法一起使用
UDPSocket.offClose 取消监听关闭事件
UDPSocket.offError 取消监听错误事件
UDPSocket.offListening 取消监听开始监听数据包消息的事件
UDPSocket.offMessage 取消监听收到消息的事件
UDPSocket.onClose 监听关闭事件
UDPSocket.onError 监听错误事件
UDPSocket.onListening 监听开始监听数据包消息的事件
UDPSocket.onMessage 监听收到消息的事件
UDPSocket.send 向指定的 IP 和 port 发送消息
UDPSocket.setTTL 设置 IP_TTL 套接字选项，用于设置一个 IP 数据包传输时允许的最大跳步数
UDPSocket.write 用法与 send 方法相同，如果没有预先调用 connect 则与 send 无差异（注意即使调用了 connect 也需要在本接口填入地址和端口参数）

## 支付

Taro.requestPayment 发起微信支付
Taro.requestOrderPayment 创建自定义版交易组件订单，并发起支付

## 数据缓存

Taro.setStorageSync 将数据存储在本地缓存中指定的 key 中
Taro.setStorage 将数据存储在本地缓存中指定的 key 中
Taro.revokeBufferURL 根据 URL 销毁存在内存中的数据
Taro.removeStorageSync Taro.removeStorage 的同步版本
Taro.removeStorage 从本地缓存中移除指定 key
Taro.getStorageSync 从本地缓存中同步获取指定 key 的内容
Taro.getStorageInfoSync Taro.getStorageInfo 的同步版本
Taro.getStorageInfo 异步获取当前storage的相关信息
Taro.getStorage 从本地缓存中异步获取指定 key 的内容
Taro.createBufferURL 根据传入的 buffer 创建一个唯一的 URL 存在内存中
Taro.clearStorageSync Taro.clearStorage 的同步版本
Taro.clearStorage 清理本地数据缓存

### 周期性更新

Taro.setBackgroundFetchToken 设置自定义登录态，在周期性拉取数据时带上，便于第三方服务器验证请求合法性
Taro.onBackgroundFetchData 监听收到 backgroundFetch 数据事件
Taro.getBackgroundFetchToken 获取设置过的自定义登录态
Taro.getBackgroundFetchData 拉取 backgroundFetch 客户端缓存数据

## 数据分析

Taro.reportMonitor 自定义业务数据监控上报接口
Taro.reportEvent 事件上报
Taro.reportAnalytics 自定义分析数据上报接口
Taro.getExptInfoSync 给定实验参数数组，获取对应的实验参数值

## 画布

Taro.createOffscreenCanvas 创建离屏 canvas 实例
Taro.createCanvasContext 创建 canvas 的绘图上下文 CanvasContext 对象
Taro.canvasToTempFilePath 把当前画布指定区域的内容导出生成指定大小的图片
Taro.canvasPutImageData 将像素数据绘制到画布
Taro.canvasGetImageData 获取 canvas 区域隐含的像素数据

### Canvas

Canvas.cancelAnimationFrame 取消由 requestAnimationFrame 添加到计划中的动画帧请求
Canvas.createImage 创建一个图片对象
Canvas.createImageData 创建一个 ImageData 对象
Canvas.createPath2D 创建 Path2D 对象
Canvas.getContext 该方法返回 Canvas 的绘图上下文
Canvas.requestAnimationFrame 在下次进行重绘时执行
Canvas.toDataURL 返回一个包含图片展示的 data URI

### CanvasContext

CanvasContext.arc 创建一条弧线
CanvasContext.arcTo 根据控制点和半径绘制圆弧路径
CanvasContext.beginPath 开始创建一个路径
CanvasContext.bezierCurveTo 创建三次方贝塞尔曲线路径
CanvasContext.clearRect 清除画布上在该矩形区域内的内容
CanvasContext.clip 从原始画布中剪切任意形状和尺寸
CanvasContext.closePath 关闭一个路径
CanvasContext.createCircularGradient 创建一个圆形的渐变颜色
CanvasContext.createLinearGradient 创建一个线性的渐变颜色
CanvasContext.createPattern 对指定的图像创建模式的方法，可在指定的方向上重复元图像
CanvasContext.draw 将之前在绘图上下文中的描述（路径、变形、样式）画到 canvas 中
CanvasContext.drawImage 绘制图像到画布
CanvasContext.fill 对当前路径中的内容进行填充
CanvasContext.fillRect 填充一个矩形
CanvasContext.fillText 在画布上绘制被填充的文本
CanvasContext.lineTo 增加一个新点，然后创建一条从上次指定点到目标点的线
CanvasContext.measureText 测量文本尺寸信息
CanvasContext.moveTo 把路径移动到画布中的指定点，不创建线条
CanvasContext.quadraticCurveTo 创建二次贝塞尔曲线路径
CanvasContext.rect 创建一个矩形路径
CanvasContext.restore 恢复之前保存的绘图上下文
CanvasContext.rotate 以原点为中心顺时针旋转当前坐标轴
CanvasContext.save 保存绘图上下文
CanvasContext.scale 在调用后，之后创建的路径其横纵坐标会被缩放
CanvasContext.setFillStyle 设置填充色
CanvasContext.setFontSize 设置字体的字号
CanvasContext.setGlobalAlpha 设置全局画笔透明度
CanvasContext.setLineCap 设置线条的端点样式
CanvasContext.setLineDash 设置虚线样式
CanvasContext.setLineJoin 设置线条的交点样式
CanvasContext.setLineWidth 设置线条的宽度
CanvasContext.setMiterLimit 设置最大斜接长度
CanvasContext.setShadow 设定阴影样式
CanvasContext.setStrokeStyle 设置描边颜色
CanvasContext.setTextAlign 设置文字的对齐
CanvasContext.setTextBaseline 设置文字的竖直对齐
CanvasContext.setTransform 使用矩阵重新设置（覆盖）当前变换的方法
CanvasContext.stroke 画出当前路径的边框
CanvasContext.strokeRect 画一个矩形(非填充)
CanvasContext.strokeText 给定的 (x, y) 位置绘制文本描边的方法
CanvasContext.transform 使用矩阵多次叠加当前变换的方法
CanvasContext.translate 对当前坐标系的原点 (0, 0) 进行变换

### CanvasGradient

CanvasGradient.addColorStop 添加颜色的渐变点
Color 颜色
Image 图片对象
ImageData ImageData 对象

### OffscreenCanvas

OffscreenCanvas.createImage 创建一个图片对象
OffscreenCanvas.getContext 该方法返回 OffscreenCanvas 的绘图上下文

### Path2D Canvas 2D API 的接口 Path2D 用来声明路径，此路径稍后会被CanvasRenderingContext2D 对象使用

### RenderingContext Canvas 绘图上下文

## 媒体

### 地图

Taro.createMapContext 创建 map 上下文 MapContext 对象

#### MapContext

MapContext.addArc 添加弧线，途经点与夹角必须设置一个
MapContext.addCustomLayer 添加个性化图层
MapContext.addGroundOverlay 创建自定义图片图层，图片会随着地图缩放而缩放
MapContext.addMarkers 添加 marker
MapContext.addVisualLayer 添加可视化图层
MapContext.fromScreenLocation 获取屏幕上的点对应的经纬度，坐标原点为地图左上角
MapContext.getCenterLocation 获取当前地图中心的经纬度
MapContext.getRegion 获取当前地图的视野范围
MapContext.getRotate 获取当前地图的旋转角
MapContext.getScale 获取当前地图的缩放级别
MapContext.getSkew 获取当前地图的倾斜角
MapContext.includePoints 缩放视野展示所有经纬度
MapContext.initMarkerCluster 初始化点聚合的配置，未调用时采用默认配置
MapContext.moveAlong 沿指定路径移动 marker，用于轨迹回放等场景
MapContext.moveToLocation 将地图中心移置当前定位点，此时需设置地图组件 show-location 为true
MapContext.on 监听地图事件
MapContext.openMapApp 拉起地图APP选择导航
MapContext.removeArc 删除弧线
MapContext.removeCustomLayer 移除个性化图层
MapContext.removeGroundOverlay 移除自定义图片图层
MapContext.removeMarkers 移除 marker
MapContext.removeVisualLayer 移除可视化图层
MapContext.setBoundary 限制地图的显示范围
MapContext.setCenterOffset 设置地图中心点偏移，向后向下为增长，屏幕比例范围(0.25~0.75)，默认偏移为[0.5, 0.5]
MapContext.setLocMarkerIcon 设置定位点图标，支持网络路径、本地路径、代码包路径
MapContext.toScreenLocation 获取经纬度对应的屏幕坐标，坐标原点为地图左上角
MapContext.translateMarker 平移marker，带动画
MapContext.updateGroundOverlay 更新自定义图片图层

### 图片

Taro.saveImageToPhotosAlbum 保存图片到系统相册
Taro.previewMedia 预览图片和视频
Taro.previewImage 在新页面中全屏预览图片
Taro.getImageInfo 获取图片信息
Taro.editImage 编辑图片接口
Taro.compressImage 压缩图片接口，可选压缩质量
Taro.chooseMessageFile 从客户端会话选择文件
Taro.chooseImage 从本地相册选择图片或使用相机拍照

### 视频

Taro.saveVideoToPhotosAlbum 保存视频到系统相册
Taro.openVideoEditor 打开视频编辑器
Taro.getVideoInfo 获取视频详细信息
Taro.createVideoContext 创建 video 上下文 VideoContext 对象
Taro.compressVideo 压缩视频接口
Taro.chooseVideo 拍摄视频或从手机相册中选视频
Taro.chooseMedia 拍摄或从手机相册中选择图片或视频

#### VideoContext

VideoContext.exitBackgroundPlayback 退出后台音频播放模式
VideoContext.exitFullScreen 退出全屏
VideoContext.exitPictureInPicture 退出小窗，该方法可在任意页面调用
VideoContext.hideStatusBar 隐藏状态栏，仅在iOS全屏下有效
VideoContext.pause 暂停视频
VideoContext.play 播放视频
VideoContext.playbackRate 设置倍速播放
VideoContext.requestBackgroundPlayback 进入后台音频播放模式
VideoContext.requestFullScreen 进入全屏
VideoContext.seek 跳转到指定位置
VideoContext.sendDanmu 发送弹幕
VideoContext.showStatusBar 显示状态栏，仅在iOS全屏下有效
VideoContext.stop 停止视频

### 音频

Taro.stopVoice 结束播放语音
Taro.setInnerAudioOption 设置 InnerAudioContext 的播放选项
Taro.playVoice 开始播放语音
Taro.pauseVoice 暂停正在播放的语音
Taro.getAvailableAudioSources 获取当前支持的音频输入源
Taro.createWebAudioContext 创建 WebAudio 上下文
Taro.createMediaAudioPlayer 创建媒体音频播放器对象 MediaAudioPlayer 对象，可用于播放视频解码器 VideoDecoder 输出的音频
Taro.createInnerAudioContext 创建内部 audio 上下文 InnerAudioContext 对象
Taro.createAudioContext 创建 audio 上下文 AudioContext 对象

#### AudioBuffer

AudioBuffer.copyFromChannel 从AudioBuffer的指定频道复制到数组终端
AudioBuffer.copyToChannel 从指定数组复制样本到audioBuffer的特定通道
AudioBuffer.getChannelData 返回一个 Float32Array，包含了带有频道的PCM数据，由频道参数定义（有0代表第一个频道）

#### AudioContext

AudioContext.pause 暂停音频
AudioContext.play 播放音频
AudioContext.seek 跳转到指定位置
AudioContext.setSrc 设置音频地址

#### InnerAudioContext

InnerAudioContext.destroy 销毁当前实例
InnerAudioContext.offCanplay 取消监听音频进入可以播放状态的事件
InnerAudioContext.offEnded 取消监听音频自然播放至结束的事件
InnerAudioContext.offError 取消监听音频播放错误事件
InnerAudioContext.offPause 取消监听音频暂停事件
InnerAudioContext.offPlay 取消监听音频播放事件
InnerAudioContext.offSeeked 取消监听音频完成跳转操作的事件
InnerAudioContext.offSeeking 取消监听音频进行跳转操作的事件
InnerAudioContext.offStop 取消监听音频停止事件
InnerAudioContext.offTimeUpdate 取消监听音频播放进度更新事件
InnerAudioContext.offWaiting 取消监听音频加载中事件
InnerAudioContext.onCanplay 监听音频进入可以播放状态的事件
InnerAudioContext.onEnded 监听音频自然播放至结束的事件
InnerAudioContext.onError 监听音频播放错误事件
InnerAudioContext.onPause 监听音频暂停事件
InnerAudioContext.onPlay 监听音频播放事件
InnerAudioContext.onSeeked 监听音频完成跳转操作的事件
InnerAudioContext.onSeeking 监听音频进行跳转操作的事件
InnerAudioContext.onStop 监听音频停止事件
InnerAudioContext.onTimeUpdate 监听音频播放进度更新事件
InnerAudioContext.onWaiting 监听音频加载中事件
InnerAudioContext.pause 暂停
InnerAudioContext.play 播放
InnerAudioContext.seek 跳转到指定位置
InnerAudioContext.stop 停止

#### MediaAudioPlayer

MediaAudioPlayer.addAudioSource 添加音频源
MediaAudioPlayer.destroy 销毁播放器
MediaAudioPlayer.removeAudioSource 移除音频源
MediaAudioPlayer.start 启动播放器
MediaAudioPlayer.stop 停止播放器

#### WebAudioContext

WebAudioContext.close 关闭WebAudioContext
WebAudioContext.createBiquadFilter 创建一个BiquadFilterNode
WebAudioContext.createBuffer 创建一个AudioBuffer，代表着一段驻留在内存中的短音频
WebAudioContext.createBufferSource 创建一个BufferSourceNode实例，通过AudioBuffer对象来播放音频数据
WebAudioContext.createChannelMerger 创建一个ChannelMergerNode
WebAudioContext.createChannelSplitter 创建一个ChannelSplitterNode
WebAudioContext.createConstantSource 创建一个ConstantSourceNode
WebAudioContext.createDelay 创建一个DelayNode
WebAudioContext.createDynamicsCompressor 创建一个DynamicsCompressorNode
WebAudioContext.createGain 创建一个GainNode
WebAudioContext.createIIRFilter 创建一个IIRFilterNode
WebAudioContext.createOscillator 创建一个OscillatorNode
WebAudioContext.createPanner 创建一个PannerNode
WebAudioContext.createPeriodicWave 创建一个PeriodicWaveNode
WebAudioContext.createScriptProcessor 创建一个ScriptProcessorNode
WebAudioContext.createWaveShaper 创建一个WaveShaperNode
WebAudioContext.decodeAudioData 异步解码一段资源为AudioBuffer
WebAudioContext.resume 同步恢复已经被暂停的WebAudioContext上下文
WebAudioContext.suspend 同步暂停WebAudioContext上下文

#### WebAudioContextNode 一类音频处理模块，不同的Node具备不同的功能，如GainNode(音量调整)等

### 背景音频

Taro.stopBackgroundAudio 停止播放音乐
Taro.seekBackgroundAudio 控制音乐播放进度
Taro.playBackgroundAudio 使用后台播放器播放音乐
Taro.pauseBackgroundAudio 暂停播放音乐
Taro.onBackgroundAudioStop 监听音乐停止事件
Taro.onBackgroundAudioPlay 监听音乐播放事件
Taro.onBackgroundAudioPause 监听音乐暂停事件
Taro.getBackgroundAudioPlayerState 获取后台音乐播放状态
Taro.getBackgroundAudioManager 获取全局唯一的背景音频管理器

#### BackgroundAudioManager

BackgroundAudioManager.onCanplay 监听背景音频进入可播放状态事件
BackgroundAudioManager.onEnded 监听背景音频自然播放结束事件
BackgroundAudioManager.onError 监听背景音频播放错误事件
BackgroundAudioManager.onNext 监听用户在系统音乐播放面板点击下一曲事件（仅iOS）
BackgroundAudioManager.onPause 监听背景音频暂停事件
BackgroundAudioManager.onPlay 监听背景音频播放事件
BackgroundAudioManager.onPrev 监听用户在系统音乐播放面板点击上一曲事件（仅iOS）
BackgroundAudioManager.onSeeked 监听背景音频完成跳转操作事件
BackgroundAudioManager.onSeeking 监听背景音频开始跳转操作事件
BackgroundAudioManager.onStop 监听背景音频停止事件
BackgroundAudioManager.onTimeUpdate 监听背景音频播放进度更新事件，只有小程序在前台时会回调
BackgroundAudioManager.onWaiting 监听音频加载中事件
BackgroundAudioManager.pause 暂停音乐
BackgroundAudioManager.play 播放音乐
BackgroundAudioManager.seek 跳转到指定位置
BackgroundAudioManager.stop 停止音乐

### 实时音视频

Taro.createLivePusherContext 创建 live-pusher 上下文 LivePusherContext 对象
Taro.createLivePlayerContext 创建 live-player 上下文 LivePlayerContext 对象

#### LivePlayerContext

LivePlayerContext.exitFullScreen 退出全屏
LivePlayerContext.exitPictureInPicture 退出小窗，该方法可在任意页面调用
LivePlayerContext.mute 静音
LivePlayerContext.pause 暂停
LivePlayerContext.play 播放
LivePlayerContext.requestFullScreen 进入全屏
LivePlayerContext.requestPictureInPicture 进入小窗
LivePlayerContext.resume 恢复
LivePlayerContext.snapshot 截图
LivePlayerContext.stop 停止

#### LivePusherContext

LivePusherContext.pause 暂停推流
LivePusherContext.pauseBGM 暂停背景音
LivePusherContext.playBGM 播放背景音
LivePusherContext.resume 恢复推流
LivePusherContext.resumeBGM 恢复背景音
LivePusherContext.sendMessage 发送SEI消息
LivePusherContext.setBGMVolume 设置背景音音量
LivePusherContext.setMICVolume 设置麦克风音量
LivePusherContext.snapshot 快照
LivePusherContext.start 开始推流，同时开启摄像头预览
LivePusherContext.startPreview 开启摄像头预览
LivePusherContext.stop 停止推流，同时停止摄像头预览
LivePusherContext.stopBGM 停止背景音
LivePusherContext.stopPreview 关闭摄像头预览
LivePusherContext.switchCamera 切换前后摄像头
LivePusherContext.toggleTorch 切换手电筒

### 录音

Taro.stopRecord 停止录音
Taro.startRecord 开始录音
Taro.getRecorderManager 获取全局唯一的录音管理器 RecorderManager

#### RecorderManager

RecorderManager.onError 监听录音错误事件
RecorderManager.onFrameRecorded 监听已录制完指定帧大小的文件事件
RecorderManager.onInterruptionBegin 监听录音因为受到系统占用而被中断开始事件
RecorderManager.onInterruptionEnd 监听录音中断结束事件
RecorderManager.onPause 监听录音暂停事件
RecorderManager.onResume 监听录音继续事件
RecorderManager.onStart 监听录音开始事件
RecorderManager.onStop 监听录音结束事件
RecorderManager.pause 暂停录音
RecorderManager.resume 继续录音
RecorderManager.start 开始录音
RecorderManager.stop 停止录音

### 相机

Taro.createCameraContext 创建 camera 上下文 CameraContext 对象

#### CameraContext

CameraContext.onCameraFrame 获取 Camera 实时帧数据
CameraContext.setZoom 设置缩放级别
CameraContext.startRecord 开始录像
CameraContext.stopRecord 结束录像
CameraContext.takePhoto 拍摄照片

#### CameraFrameListener

CameraFrameListener.start 开始监听帧数据
CameraFrameListener.stop 停止监听帧数据

### 富文本

#### EditorContext

EditorContext.blur 编辑器失焦，同时收起键盘
EditorContext.clear 清空编辑器内容
EditorContext.format 修改样式
EditorContext.getContents 获取编辑器内容
EditorContext.getSelectionText 获取编辑器已选区域内的纯文本内容
EditorContext.insertDivider 插入分割线
EditorContext.insertImage 插入图片
EditorContext.insertText 覆盖当前选区，设置一段文本
EditorContext.redo 恢复
EditorContext.removeFormat 清除当前选区的样式
EditorContext.scrollIntoView 使得编辑器光标处滚动到窗口可视区域内
EditorContext.setContents 初始化编辑器内容，html和delta同时存在时仅delta生效
EditorContext.undo 撤销

### 音视频合成

Taro.createMediaContainer 创建音视频处理容器，最终可将容器中的轨道合成一个视频

#### MediaContainer

MediaContainer.addTrack 将音频或视频轨道添加到容器
MediaContainer.destroy 将容器销毁，释放资源
MediaContainer.export 将容器内的轨道合并并导出视频文件
MediaContainer.extractDataSource 将传入的视频源分离轨道
MediaContainer.removeTrack 将音频或视频轨道从容器中移除

#### MediaTrack 可通过 MediaContainer.extractDataSource 返回

### 实时语音

Taro.updateVoIPChatMuteConfig 更新实时语音静音设置
Taro.subscribeVoIPVideoMembers 订阅视频画面成员
Taro.setEnable1v1Chat 开启双人通话
Taro.onVoIPVideoMembersChanged 监听实时语音通话成员视频状态变化事件
Taro.onVoIPChatStateChanged 监听房间状态变化事件
Taro.onVoIPChatSpeakersChanged 监听实时语音通话成员通话状态变化事件
Taro.onVoIPChatMembersChanged 监听实时语音通话成员在线状态变化事件
Taro.onVoIPChatInterrupted 监听被动断开实时语音通话事件
Taro.offVoIPVideoMembersChanged 取消监听实时语音通话成员视频状态变化事件
Taro.offVoIPChatStateChanged 取消监听房间状态变化事件
Taro.offVoIPChatMembersChanged 取消监听实时语音通话成员在线状态变化事件
Taro.offVoIPChatInterrupted 取消监听被动断开实时语音通话事件
Taro.joinVoIPChat 加入 (创建) 实时语音通话，更多信息可见 实时语音指南
Taro.exitVoIPChat 退出（销毁）实时语音通话

### 画面录制器

Taro.createMediaRecorder 创建 WebGL 画面录制器，可逐帧录制在 WebGL 上渲染的画面并导出视频文件

#### MediaRecorder

MediaRecorder.destroy 销毁录制器
MediaRecorder.off 取消监听录制事件
MediaRecorder.on 注册监听录制事件的回调函数
MediaRecorder.pause 暂停录制
MediaRecorder.requestFrame 请求下一帧录制，在 callback 里完成一帧渲染后开始录制当前帧
MediaRecorder.resume 恢复录制
MediaRecorder.start 开始录制
MediaRecorder.stop 结束录制

### 视频解码器

Taro.createVideoDecoder 创建视频解码器，可逐帧获取解码后的数据

#### VideoDecoder

VideoDecoder.getFrameData 获取下一帧的解码数据
VideoDecoder.off 取消监听录制事件
VideoDecoder.on 注册监听录制事件的回调函数
VideoDecoder.remove 移除解码器
VideoDecoder.seek 跳到某个时间点解码
VideoDecoder.start 开始解码
VideoDecoder.stop 停止解码

## 位置

Taro.stopLocationUpdate 关闭监听实时位置变化，前后台都停止消息接收
Taro.startLocationUpdateBackground 开启小程序进入前后台时均接收位置消息，需引导用户开启授权
Taro.startLocationUpdate 开启小程序进入前台时接收位置消息
Taro.openLocation 使用微信内置地图查看位置
Taro.onLocationChangeError 监听持续定位接口返回失败时触发
Taro.onLocationChange 监听实时地理位置变化事件，需结合 Taro.startLocationUpdateBackground、wx.startLocationUpdate使用
Taro.offLocationChangeError 取消监听持续定位接口返回失败时触发
Taro.offLocationChange 取消监听实时地理位置变化事件
Taro.getLocation 获取当前的地理位置、速度
Taro.choosePoi 打开POI列表选择位置，支持模糊定位（精确到市）和精确定位混选
Taro.chooseLocation 打开地图选择位置

## 文件

Taro.saveFileToDisk 保存文件系统的文件到用户磁盘，仅在 PC 端支持
Taro.saveFile 保存文件到本地
Taro.removeSavedFile 删除本地缓存文件
Taro.openDocument 新开页面打开文档
Taro.getSavedFileList 获取该小程序下已保存的本地缓存文件列表
Taro.getSavedFileInfo 获取本地文件的文件信息
Taro.getFileSystemManager 获取全局唯一的文件管理器
Taro.getFileInfo 获取文件信息

### FileSystemManager

FileSystemManager.access 判断文件/目录是否存在
FileSystemManager.accessSync FileSystemManager.access 的同步版本
FileSystemManager.appendFile 在文件结尾追加内容
FileSystemManager.appendFileSync FileSystemManager.appendFile 的同步版本
FileSystemManager.close 关闭文件
FileSystemManager.closeSync 同步关闭文件
FileSystemManager.copyFile 复制文件
FileSystemManager.copyFileSync FileSystemManager.copyFile 的同步版本
FileSystemManager.fstat 获取文件的状态信息
FileSystemManager.fstatSync 同步获取文件的状态信息
FileSystemManager.ftruncate 对文件内容进行截断操作
FileSystemManager.ftruncateSync 对文件内容进行截断操作
FileSystemManager.getFileInfo 获取该小程序下的 本地临时文件 或 本地缓存文件 信息
FileSystemManager.getSavedFileList 获取该小程序下已保存的本地缓存文件列表
FileSystemManager.mkdir 创建目录
FileSystemManager.mkdirSync FileSystemManager.mkdir 的同步版本
FileSystemManager.open 打开文件，返回文件描述符
FileSystemManager.openSync 同步打开文件，返回文件描述符
FileSystemManager.read 读文件
FileSystemManager.readCompressedFile 读取指定压缩类型的本地文件内容
FileSystemManager.readCompressedFileSync 同步读取指定压缩类型的本地文件内容
FileSystemManager.readdir 读取目录内文件列表
FileSystemManager.readdirSync FileSystemManager.readdir 的同步版本
FileSystemManager.readFile 读取本地文件内容
FileSystemManager.readFileSync FileSystemManager.readFile 的同步版本
FileSystemManager.readSync 读文件
FileSystemManager.readZipEntry 读取压缩包内的文件
FileSystemManager.removeSavedFile 删除该小程序下已保存的本地缓存文件
FileSystemManager.rename 重命名文件
FileSystemManager.renameSync FileSystemManager.rename 的同步版本
FileSystemManager.rmdir 删除目录
FileSystemManager.rmdirSync FileSystemManager.rmdir 的同步版本
FileSystemManager.saveFile 保存临时文件到本地
FileSystemManager.saveFileSync FileSystemManager.saveFile 的同步版本
FileSystemManager.stat 获取文件 Stats 对象
FileSystemManager.statSync FileSystemManager.stat 的同步版本
FileSystemManager.truncate 对文件内容进行截断操作
FileSystemManager.truncateSync 对文件内容进行截断操作 (truncate 的同步版本)
FileSystemManager.unlink 删除文件
FileSystemManager.unlinkSync FileSystemManager.unlink 的同步版本
FileSystemManager.unzip 解压文件
FileSystemManager.write 写入文件
FileSystemManager.writeFile 写文件
FileSystemManager.writeFileSync FileSystemManager.writeFile 的同步版本
FileSystemManager.writeSync 同步写入文件

### ReadResult 文件读取结果

### Stats

Stats.isDirectory 判断当前文件是否一个目录
Stats.isFile 判断当前文件是否一个普通文件

### WriteResult 文件写入结果

## 开放接口

### 登录

Taro.pluginLogin 该接口仅在小程序插件中可调用，调用接口获得插件用户标志凭证（code）
Taro.login 调用接口获取登录凭证（code）
Taro.checkSession 检查登录态是否过期

### 帐号信息

Taro.getAccountInfoSync 获取当前帐号信息

### 用户信息

Taro.getUserProfile 获取用户信息
Taro.getUserInfo 获取用户信息
UserInfo 用户信息

### 授权

Taro.authorizeForMiniProgram 仅小程序插件中能调用该接口，用法同 Taro.authorize
Taro.authorize 提前向用户发起授权请求

### 设置

Taro.openSetting 调起客户端小程序设置界面，返回用户设置的操作结果
Taro.getSetting 获取用户的当前设置
AuthSetting 用户授权设置信息，详情参考权限
SubscriptionsSetting 订阅消息设置

### 收货地址

Taro.chooseAddress 获取用户收货地址

### 卡券

Taro.openCard 查看微信卡包中的卡券
Taro.addCard 批量添加卡券

### 发票

Taro.chooseInvoiceTitle 选择用户的发票抬头
Taro.chooseInvoice 选择用户已有的发票

### 生物认证

Taro.startSoterAuthentication 开始 SOTER 生物认证
Taro.checkIsSupportSoterAuthentication 获取本机支持的 SOTER 生物认证方式
Taro.checkIsSoterEnrolledInDevice 获取设备内是否录入如指纹等生物信息的接口

### 微信运动

Taro.shareToWeRun 分享数据到微信运动
Taro.getWeRunData 获取用户过去三十天微信运动步数

### 订阅消息

Taro.requestSubscribeMessage 调起客户端小程序订阅消息界面，返回用户订阅消息的操作结果
Taro.requestSubscribeDeviceMessage 订阅设备消息接口，调用后弹出授权框，用户同意后会允许开发者给用户发送订阅模版消息

### 微信红包

Taro.showRedPackage 拉取h5领取红包封面页

### 收藏

Taro.addVideoToFavorites 收藏视频
Taro.addFileToFavorites 收藏文件

### 车牌

Taro.chooseLicensePlate 选择车牌号

### 视频号

Taro.reserveChannelsLive 预约视频号直播
Taro.openChannelsUserProfile 打开视频号主页
Taro.openChannelsLive 打开视频号直播
Taro.openChannelsEvent 打开视频号活动页
Taro.openChannelsActivity 打开视频号视频
Taro.getChannelsLiveNoticeInfo 获取视频号直播预告信息
Taro.getChannelsLiveInfo 获取视频号直播信息

### 微信群

Taro.getGroupEnterInfo 获取微信群聊场景下的小程序启动信息

### 微信客服

Taro.openCustomerServiceChat 打开微信客服

## 设备

### 蓝牙-通用

Taro.stopBluetoothDevicesDiscovery 停止搜寻附近的蓝牙外围设备
Taro.startBluetoothDevicesDiscovery 开始搜寻附近的蓝牙外围设备
Taro.openBluetoothAdapter 初始化蓝牙模块
Taro.onBluetoothDeviceFound 监听搜索到新设备的事件
Taro.onBluetoothAdapterStateChange 监听蓝牙适配器状态变化事件
Taro.offBluetoothDeviceFound 取消监听寻找到新设备的事件
Taro.offBluetoothAdapterStateChange 取消监听蓝牙适配器状态变化事件
Taro.makeBluetoothPair 蓝牙配对接口，仅安卓支持
Taro.isBluetoothDevicePaired 查询蓝牙设备是否配对，仅安卓支持
Taro.getConnectedBluetoothDevices 根据主服务 UUID 获取已连接的蓝牙设备
Taro.getBluetoothDevices 获取在蓝牙模块生效期间所有搜索到的蓝牙设备
Taro.getBluetoothAdapterState 获取本机蓝牙适配器状态
Taro.closeBluetoothAdapter 关闭蓝牙模块

### 蓝牙-低功耗中心设备

Taro.writeBLECharacteristicValue 向蓝牙低功耗设备特征值中写入二进制数据
Taro.setBLEMTU 协商设置蓝牙低功耗的最大传输单元 (Maximum Transmission Unit, MTU)
Taro.readBLECharacteristicValue 读取蓝牙低功耗设备特征值的二进制数据
Taro.onBLEMTUChange 监听蓝牙低功耗的最大传输单元变化事件（仅安卓触发）
Taro.onBLEConnectionStateChange 监听蓝牙低功耗连接状态的改变事件
Taro.onBLECharacteristicValueChange 监听蓝牙低功耗设备的特征值变化事件
Taro.offBLEMTUChange 取消监听蓝牙低功耗的最大传输单元变化事件
Taro.offBLEConnectionStateChange 取消监听蓝牙低功耗连接状态的改变事件
Taro.offBLECharacteristicValueChange 取消监听蓝牙低功耗设备的特征值变化事件
Taro.notifyBLECharacteristicValueChange 启用蓝牙低功耗设备特征值变化时的 notify 功能，订阅特征
Taro.getBLEMTU 获取蓝牙低功耗的最大传输单元
Taro.getBLEDeviceServices 获取蓝牙低功耗设备所有服务 (service)
Taro.getBLEDeviceRSSI 获取蓝牙低功耗设备的信号强度 (Received Signal Strength Indication, RSSI)
Taro.getBLEDeviceCharacteristics 获取蓝牙低功耗设备某个服务中所有特征 (characteristic)
Taro.createBLEConnection 连接蓝牙低功耗设备
Taro.closeBLEConnection 断开与蓝牙低功耗设备的连接

### 蓝牙-低功耗外围设备

Taro.onBLEPeripheralConnectionStateChanged 监听当前外围设备被连接或断开连接事件
Taro.offBLEPeripheralConnectionStateChanged 取消监听当前外围设备被连接或断开连接事件
Taro.createBLEPeripheralServer 建立本地作为蓝牙低功耗外围设备的服务端，可创建多个

#### BLEPeripheralServer

BLEPeripheralServer.addService 添加服务
BLEPeripheralServer.close 关闭当前服务端
BLEPeripheralServer.offCharacteristicReadRequest 取消监听已连接的设备请求读当前外围设备的特征值事件
BLEPeripheralServer.offCharacteristicSubscribed 取消监听特征订阅事件
BLEPeripheralServer.offCharacteristicUnsubscribed 取消监听取消特征订阅事件
BLEPeripheralServer.offCharacteristicWriteRequest 取消监听已连接的设备请求写当前外围设备的特征值事件
BLEPeripheralServer.onCharacteristicReadRequest 监听已连接的设备请求读当前外围设备的特征值事件
BLEPeripheralServer.onCharacteristicSubscribed 监听特征订阅事件，仅 iOS 支持
BLEPeripheralServer.onCharacteristicUnsubscribed 监听取消特征订阅事件，仅 iOS 支持
BLEPeripheralServer.onCharacteristicWriteRequest 监听已连接的设备请求写当前外围设备的特征值事件
BLEPeripheralServer.removeService 移除服务
BLEPeripheralServer.startAdvertising 开始广播本地创建的外围设备
BLEPeripheralServer.stopAdvertising 停止广播
BLEPeripheralServer.writeCharacteristicValue 往指定特征写入二进制数据值，并通知已连接的主机，从机的特征值已发生变化，该接口会处理是走回包还是走订阅

### 蓝牙-信标(Beacon)

Taro.stopBeaconDiscovery 停止搜索附近的 Beacon 设备
Taro.startBeaconDiscovery 开始搜索附近的 Beacon 设备
Taro.onBeaconUpdate 监听 Beacon 设备更新事件，仅能注册一个监听
Taro.onBeaconServiceChange 监听 Beacon 服务状态变化事件，仅能注册一个监听
Taro.offBeaconUpdate 取消监听 Beacon 设备更新事件
Taro.offBeaconServiceChange 取消监听 Beacon 服务状态变化事件
Taro.getBeacons 获取所有已搜索到的 Beacon 设备
BeaconInfo Beacon 设备

### NFC

Taro.stopHCE 关闭 NFC 模块
Taro.startHCE 初始化 NFC 模块
Taro.sendHCEMessage 发送 NFC 消息
Taro.onHCEMessage 监听接收 NFC 设备消息事件，仅能注册一个监听
Taro.offHCEMessage 接收 NFC 设备消息事件，取消事件监听
Taro.getNFCAdapter 获取 NFC 实例
Taro.getHCEState 判断当前设备是否支持 HCE 能力

#### IsoDep

IsoDep.close 断开连接
IsoDep.connect 连接 NFC 标签
IsoDep.getHistoricalBytes 获取复位信息
IsoDep.getMaxTransceiveLength 获取最大传输长度
IsoDep.isConnected 检查是否已连接
IsoDep.setTimeout 设置超时时间
IsoDep.transceive 发送数据

#### MifareClassic

MifareClassic.close 断开连接
MifareClassic.connect 连接 NFC 标签
MifareClassic.getMaxTransceiveLength 获取最大传输长度
MifareClassic.isConnected 检查是否已连接
MifareClassic.setTimeout 设置超时时间
MifareClassic.transceive 发送数据

#### MifareUltralight

MifareUltralight.close 断开连接
MifareUltralight.connect 连接 NFC 标签
MifareUltralight.getMaxTransceiveLength 获取最大传输长度
MifareUltralight.isConnected 检查是否已连接
MifareUltralight.setTimeout 设置超时时间
MifareUltralight.transceive 发送数据

#### Ndef

Ndef.close 断开连接
Ndef.connect 连接 NFC 标签
Ndef.isConnected 检查是否已连接
Ndef.offNdefMessage 取消监听 Ndef 消息
Ndef.onNdefMessage 监听 Ndef 消息
Ndef.setTimeout 设置超时时间
Ndef.writeNdefMessage 重写 Ndef 标签内容

#### NfcA

NfcA.close 断开连接
NfcA.connect 连接 NFC 标签
NfcA.getAtqa 获取ATQA信息
NfcA.getMaxTransceiveLength 获取最大传输长度
NfcA.getSak 获取SAK信息
NfcA.isConnected 检查是否已连接
NfcA.setTimeout 设置超时时间
NfcA.transceive 发送数据

#### NFCAdapter

NFCAdapter.getIsoDep 获取IsoDep实例，实例支持ISO-DEP (ISO 14443-4)标准的读写
NFCAdapter.getMifareClassic 获取MifareClassic实例，实例支持MIFARE Classic标签的读写
NFCAdapter.getMifareUltralight 获取MifareUltralight实例，实例支持MIFARE Ultralight标签的读写
NFCAdapter.getNdef 获取Ndef实例，实例支持对NDEF格式的NFC标签上的NDEF数据的读写
NFCAdapter.getNfcA 获取NfcA实例，实例支持NFC-A (ISO 14443-3A)标准的读写
NFCAdapter.getNfcB 获取NfcB实例，实例支持NFC-B (ISO 14443-3B)标准的读写
NFCAdapter.getNfcF 获取NfcF实例，实例支持NFC-F (JIS 6319-4)标准的读写
NFCAdapter.getNfcV 获取NfcV实例，实例支持NFC-V (ISO 15693)标准的读写
NFCAdapter.offDiscovered 取消监听 NFC Tag
NFCAdapter.onDiscovered 监听 NFC Tag
NFCAdapter.startDiscovery
NFCAdapter.stopDiscovery

#### NfcB

NfcB.close 断开连接
NfcB.connect 连接 NFC 标签
NfcB.getMaxTransceiveLength 获取最大传输长度
NfcB.isConnected 检查是否已连接
NfcB.setTimeout 设置超时时间
NfcB.transceive 发送数据

#### NfcF

NfcF.close 断开连接
NfcF.connect 连接 NFC 标签
NfcF.getMaxTransceiveLength 获取最大传输长度
NfcF.isConnected 检查是否已连接
NfcF.setTimeout 设置超时时间
NfcF.transceive 发送数据

#### NfcV

NfcV.close 断开连接
NfcV.connect 连接 NFC 标签
NfcV.getMaxTransceiveLength 获取最大传输长度
NfcV.isConnected 检查是否已连接
NfcV.setTimeout 设置超时时间
NfcV.transceive 发送数据

### Wi-Fi

Taro.stopWifi 关闭 Wi-Fi 模块
Taro.startWifi 初始化 Wi-Fi 模块
Taro.setWifiList 设置 wifiList 中 AP 的相关信息
Taro.onWifiConnectedWithPartialInfo 监听连接上 Wi-Fi 的事件
Taro.onWifiConnected 监听连接上 Wi-Fi 的事件
Taro.onGetWifiList 监听获取到 Wi-Fi 列表数据事件
Taro.offWifiConnectedWithPartialInfo 取消监听连接上 Wi-Fi 的事件
Taro.offWifiConnected 取消监听连接上 Wi-Fi 的事件
Taro.offGetWifiList 取消监听获取到 Wi-Fi 列表数据事件
Taro.getWifiList 请求获取 Wi-Fi 列表
Taro.getConnectedWifi 获取已连接中的 Wi-Fi 信息
Taro.connectWifi 连接 Wi-Fi
WifiInfo Wifi 信息

### 日历

Taro.addPhoneRepeatCalendar 向系统日历添加重复事件
Taro.addPhoneCalendar 向系统日历添加事件

### 联系人

Taro.chooseContact 拉起手机通讯录，选择联系人
Taro.addPhoneContact 添加手机通讯录联系人

### 无障碍

Taro.checkIsOpenAccessibility 检测是否开启视觉无障碍功能

### 电量

Taro.getBatteryInfoSync Taro.getBatteryInfo 的同步版本
Taro.getBatteryInfo 获取设备电量

### 剪贴板

Taro.setClipboardData 设置系统剪贴板的内容
Taro.getClipboardData 获取系统剪贴板的内容

### 网络

Taro.onNetworkWeakChange 监听弱网状态变化事件
Taro.onNetworkStatusChange 监听网络状态变化事件
Taro.offNetworkWeakChange 取消监听弱网状态变化事件
Taro.offNetworkStatusChange 取消监听网络状态变化事件，参数为空，则取消所有的事件监听
Taro.getNetworkType 获取网络类型
Taro.getLocalIPAddress 获取局域网IP地址

### 加密

Taro.getRandomValues 获取密码学安全随机数

### 屏幕

Taro.setVisualEffectOnCapture 设置截屏/录屏时屏幕表现，仅支持在 Android 端调用
Taro.setScreenBrightness 设置屏幕亮度
Taro.setKeepScreenOn 设置是否保持常亮状态
Taro.onUserCaptureScreen 监听用户主动截屏事件
Taro.offUserCaptureScreen 用户主动截屏事件
Taro.getScreenBrightness 获取屏幕亮度

### 键盘

Taro.onKeyboardHeightChange 监听键盘高度变化
Taro.offKeyboardHeightChange 取消监听键盘高度变化事件
Taro.hideKeyboard 在input、textarea等focus拉起键盘之后，手动调用此接口收起键盘
Taro.getSelectedTextRange 在input、textarea等focus之后，获取输入框的光标位置

### 电话

Taro.makePhoneCall 拨打电话

### 加速计

Taro.stopAccelerometer 停止监听加速度数据
Taro.startAccelerometer 开始监听加速度数据
Taro.onAccelerometerChange 监听加速度数据事件
Taro.offAccelerometerChange 取消监听加速度数据事件，参数为空，则取消所有的事件监听

### 罗盘

Taro.stopCompass 停止监听罗盘数据
Taro.startCompass 开始监听罗盘数据
Taro.onCompassChange 监听罗盘数据变化事件
Taro.offCompassChange 取消监听罗盘数据变化事件，参数为空，则取消所有的事件监听

### 设备方向

Taro.stopDeviceMotionListening 停止监听设备方向的变化
Taro.startDeviceMotionListening 开始监听设备方向的变化
Taro.onDeviceMotionChange 监听设备方向变化事件
Taro.offDeviceMotionChange 取消监听设备方向变化事件，参数为空，则取消所有的事件监听

### 陀螺仪

Taro.stopGyroscope 停止监听陀螺仪数据
Taro.startGyroscope 开始监听陀螺仪数据
Taro.onGyroscopeChange 监听陀螺仪数据变化事件
Taro.offGyroscopeChange 取消监听陀螺仪数据变化事件

### 内存

Taro.onMemoryWarning 监听内存不足告警事件
Taro.offMemoryWarning 取消监听内存不足告警事件

### 扫码

Taro.scanCode 调起客户端扫码界面进行扫码

### 振动

Taro.vibrateShort 使手机发生较短时间的振动（15 ms）
Taro.vibrateLong 使手机发生较长时间的振动（400 ms)

## AI

### 视觉算法

Taro.isVKSupport 判断支持版本
Taro.createVKSession 创建 vision kit 会话对象

### VKAnchor anchor 对象，只有 v2 版本支持

#### VKCamera

VKCamera.getProjectionMatrix 获取投影矩阵

#### VKFrame

VKFrame.getCameraTexture 获取当前帧纹理，目前只支持 YUV 纹理
VKFrame.getDisplayTransform 获取纹理调整矩阵

#### VKSession

VKSession.cancelAnimationFrame 取消由 requestAnimationFrame 添加到计划中的动画帧请求
VKSession.destroy 销毁会话
VKSession.getVKFrame 获取帧对象，每调用一次都会触发一次帧分析过程
VKSession.hitTest 触摸检测，v1 版本只支持单平面（即 hitTest 生成一次平面后，后续 hitTest 均不会再生成平面，而是以之前生成的平面为基础进行检测）
VKSession.off 取消监听会话事件
VKSession.on 监听会话事件
VKSession.requestAnimationFrame 在下次进行重绘时执行
VKSession.start 开启会话
VKSession.stop 停止会话

### 人脸识别

Taro.stopFaceDetect 停止人脸识别
Taro.initFaceDetect 初始化人脸识别
Taro.faceDetect 人脸识别，使用前需要通过 Taro.initFaceDetect 进行一次初始化，推荐使用相机接口返回的帧数据

## Worker

Taro.createWorker 创建一个 Worker 线程

### Worker

Worker.onMessage 监听主线程/Worker 线程向当前线程发送的消息的事件
Worker.onProcessKilled 监听 worker线程被系统回收事件（当iOS系统资源紧张时，worker线程存在被系统回收的可能，开发者可监听此事件并重新创建一个worker）
Worker.postMessage 向主线程/Worker 线程发送的消息
Worker.terminate 结束当前 Worker 线程

## WXML

Taro.createSelectorQuery 返回一个 SelectorQuery 对象实例
Taro.createIntersectionObserver 创建并返回一个 IntersectionObserver 对象实例

### IntersectionObserver

IntersectionObserver.disconnect 停止监听
IntersectionObserver.observe 指定目标节点并开始监听相交状态变化情况
IntersectionObserver.relativeTo 使用选择器指定一个节点，作为参照区域之一
IntersectionObserver.relativeToViewport 指定页面显示区域作为参照区域之一

### MediaQueryObserver

MediaQueryObserver.disconnect 停止监听
MediaQueryObserver.observe 开始监听页面 media query 变化情况

### NodesRef

NodesRef.boundingClientRect 添加节点的布局位置的查询请求
NodesRef.context 添加节点的 Context 对象查询请求
NodesRef.fields 获取节点的相关信息
NodesRef.node 获取 Node 节点实例
NodesRef.scrollOffset 添加节点的滚动位置查询请求

### SelectorQuery

SelectorQuery.exec 执行所有的请求
SelectorQuery.in 将选择器的选取范围更改为自定义组件 component 内
SelectorQuery.select 在当前页面下选择第一个匹配选择器 selector 的节点
SelectorQuery.selectAll 在当前页面下选择匹配选择器 selector 的所有节点
SelectorQuery.selectViewport 选择显示区域

## 第三方平台

Taro.getExtConfigSync Taro.getExtConfig 的同步版本
Taro.getExtConfig 获取第三方平台自定义的数据字段

## 广告

Taro.createRewardedVideoAd 创建激励视频广告组件
Taro.createInterstitialAd 创建插屏广告组件

### InterstitialAd

InterstitialAd.destroy 销毁插屏广告实例
InterstitialAd.load 加载插屏广告
InterstitialAd.offClose 取消监听插屏广告关闭事件
InterstitialAd.offError 取消监听插屏错误事件
InterstitialAd.offLoad 取消监听插屏广告加载事件
InterstitialAd.onClose 监听插屏广告关闭事件
InterstitialAd.onError 监听插屏错误事件
InterstitialAd.onLoad 监听插屏广告加载事件
InterstitialAd.show 显示插屏广告

### RewardedVideoAd

RewardedVideoAd.destroy 销毁激励视频广告实例
RewardedVideoAd.load 加载激励视频广告
RewardedVideoAd.offClose 取消监听用户点击 关闭广告 按钮的事件
RewardedVideoAd.offError 取消监听激励视频错误事件
RewardedVideoAd.offLoad 取消监听激励视频广告加载事件
RewardedVideoAd.onClose 监听用户点击 关闭广告 按钮的事件
RewardedVideoAd.onError 监听激励视频错误事件
RewardedVideoAd.onLoad 监听激励视频广告加载事件
RewardedVideoAd.show 显示激励视频广告
</file>

<file path="docs/components/base/icon.md">
---
title: Icon
sidebar_label: Icon
---

图标。组件属性的长度单位默认为 px

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/icon.html)

## 类型

```tsx
ComponentType<IconProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PageView extends Component {
  constructor() {
    super(...arguments)
  }

  render() {
    return (
      <View className='components-page'>
        <Icon size='60' type='success' />
        <Icon size='60' type='info' />
        <Icon size='60' type='warn' color='#ccc' />
        <Icon size='60' type='warn' />
        <Icon size='60' type='waiting' />
        <Icon size='20' type='success_no_circle' />
        <Icon size='20' type='warn' />
        <Icon size='20' type='success' />
        <Icon size='20' type='download' />
        <Icon size='20' type='clear' color='red' />
        <Icon size='20' type='search' />
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

<template>
  <view class="components-page">
    <icon size="60" type="success" />
    <icon size="60" type="info" />
    <icon size="60" type="warn" color="#ccc" />
    <icon size="60" type="warn" />
    <icon size="60" type="waiting" />
    <icon size="20" type="success_no_circle" />
    <icon size="20" type="warn" />
    <icon size="20" type="success" />
    <icon size="20" type="download" />
    <icon size="20" type="clear" color="red" />
    <icon size="20" type="search" />
  </view>
</template>
</TabItem>
</Tabs>

## IconProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| type | `keyof TIconType` |  | 是 | icon 的类型 |
| size | `number` | `23` | 否 | icon 的大小，单位px |
| color | `string` |  | 否 | icon 的颜色，同 css 的 color |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| IconProps.type | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| IconProps.size | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| IconProps.color | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| IconProps.ariaLabel |  |  |  |  | ✔️ |  |  |  |  |  |  |

### TIconType

icon 的类型

| 参数 | 说明 |
| --- | --- |
| success | 成功图标 |
| success_no_circle | 成功图标（不带外圈） |
| info | 信息图标 |
| warn | 警告图标 |
| waiting | 等待图标 |
| cancel | 取消图标 |
| download | 下载图标 |
| search | 搜索图标 |
| clear | 清除图标 |
| circle | 圆环图标(多选控件图标未选择)「微信文档未标注属性」 |
| info_circle | 带圆环的信息图标「微信文档未标注属性」 |
</file>

<file path="docs/components/base/progress.md">
---
title: Progress
sidebar_label: Progress
---

进度条。组件属性的长度单位默认为 px

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/progress.html)

## 类型

```tsx
ComponentType<ProgressProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PageView extends Component {
  constructor() {
    super(...arguments)
  }

  render() {
    return (
      <View className='components-page'>
        <Progress percent={20} showInfo strokeWidth={2} />
        <Progress percent={40} strokeWidth={2} active />
        <Progress percent={60}  strokeWidth={2} active />
        <Progress percent={80}  strokeWidth={2} active activeColor='blue' />
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="components-page">
    <progress percent="20" stroke-width="2" :show-info="true" />
    <progress percent="40" stroke-width="2" :active="true" />
    <progress percent="60" stroke-width="2" :active="true" />
    <progress percent="80" stroke-width="2" :active="true" active-color="blue" />
  </view>
</template>
```
</TabItem>
</Tabs>

## ProgressProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| percent | `number` |  | 否 | 百分比 0~100 |
| showInfo | `boolean` | `false` | 否 | 在进度条右侧显示百分比 |
| borderRadius | string or number | `0` | 否 | 圆角大小 |
| fontSize | string or number | `16` | 否 | 右侧百分比字体大小 |
| strokeWidth | string or number | `6` | 否 | 进度条线的宽度 |
| color | `string` | `"#09BB07"` | 否 | 进度条颜色 (请使用 activeColor) |
| activeColor | `string` | `"#09BB07"` | 否 | 已选择的进度条的颜色 |
| backgroundColor | `string` | `"#EBEBEB"` | 否 | 未选择的进度条的颜色 |
| active | `boolean` | `false` | 否 | 进度条从左往右的动画 |
| activeMode | "backwards" or "forwards" | `backwards` | 否 | backwards: 动画从头播<br /><br />forwards: 动画从上次结束点接着播 |
| duration | `number` | `30` | 否 | 进度增加 1% 所需毫秒数 |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |
| onActiveEnd | `CommonEventFunction` |  | 否 | 动画完成事件 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| ProgressProps.percent | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ProgressProps.showInfo | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ProgressProps.borderRadius | ✔️ | ✔️ |  |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| ProgressProps.fontSize | ✔️ | ✔️ |  |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| ProgressProps.strokeWidth | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ProgressProps.color | ✔️ | ✔️ |  |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| ProgressProps.activeColor | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ProgressProps.backgroundColor | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ProgressProps.active | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ProgressProps.activeMode | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ProgressProps.duration | ✔️ | ✔️ |  | ✔️ |  | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| ProgressProps.ariaLabel |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ProgressProps.onActiveEnd | ✔️ |  |  | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
</file>

<file path="docs/components/base/rich-text.md">
---
title: RichText
sidebar_label: RichText
---

富文本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/rich-text.html)

## 类型

```tsx
ComponentType<RichTextProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Components {
  state = {
    nodes: [{
      name: 'div',
      attrs: {
        class: 'div_class',
        style: 'line-height: 60px; color: red;'
      },
      children: [{
        type: 'text',
        text: 'Hello World!'
      }]
    }]
  }
  render () {
    return (
      <RichText nodes={this.state.nodes} />
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="components-page">
    <rich-text :nodes="nodes"></rich-text>
  </view>
</template>

<script>
export default {
  name: 'Index',
  data() {
    return {
      nodes: [{
        name: 'div',
        attrs: {
          class: 'div_class',
          style: 'line-height: 60px; color: red;'
        },
        children: [{
          type: 'text',
          text: 'Hello World!'
        }]
      }]
    }
  },
  onReady () {
    console.log('onReady')
  }
}
</script>
```
</TabItem>
</Tabs>

## RichTextProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| userSelect | `boolean` | `false` | 否 | 文本是否可选，该属性会使节点显示为 block |
| nodes | `Nodes` |  | 否 | 节点列表/ HTML String |
| space | `keyof TSpace` |  | 否 | 显示连续空格 |
| selectable | `string` | `false（基础库 3.150.1 以前版本）true（基础库 3.150.1 及以后版本）` | 否 | 富文本是否可以长按选中，可用于复制，粘贴，长按搜索等场景 |
| imageMenuPrevent | `string` | `false` | 否 | 阻止长按图片时弹起默认菜单（将该属性设置为image-menu-prevent或image-menu-prevent="true"），只在初始化时有效，不能动态变更；若不想阻止弹起默认菜单，则不需要设置此属性 |
| preview | `string` |  | 否 | 富文本中的图片是否可点击预览。在不设置的情况下，若 rich-text 未监听点击事件，则默认开启。未显示设置 preview 时会进行点击默认预览判断，建议显示设置 preview |
| onTap | `CommonEventFunction` |  | 否 | 触摸。 |
| onTouchstart | `CommonEventFunction` |  | 否 | 触摸动作开始。 |
| onTouchmove | `CommonEventFunction` |  | 否 | 触摸移动事件。 |
| onTouchcancel | `CommonEventFunction` |  | 否 | 触摸动作被打断。 |
| onTouchend | `CommonEventFunction` |  | 否 | 触摸动作结束。 |
| onLongtap | `CommonEventFunction` |  | 否 | 触摸后，超过 500ms 再离开。 |
| mode | "default" or "compat" or "aggressive" or "inline-block" or "web" | `default` | 否 | 布局兼容模式 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| RichTextProps.userSelect | ✔️ |  |  |  |  | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| RichTextProps.nodes | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| RichTextProps.space | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| RichTextProps.selectable |  | ✔️ |  |  |  |  | ✔️ |  |  | ✔️ |  |
| RichTextProps.imageMenuPrevent |  | ✔️ |  |  |  |  |  |  |  |  |  |
| RichTextProps.preview |  | ✔️ |  |  |  |  |  |  |  |  |  |
| RichTextProps.onTap |  |  | ✔️ |  |  |  |  |  |  |  |  |
| RichTextProps.onTouchstart |  |  | ✔️ |  |  |  |  |  |  |  |  |
| RichTextProps.onTouchmove |  |  | ✔️ |  |  |  |  |  |  |  |  |
| RichTextProps.onTouchcancel |  |  | ✔️ |  |  |  |  |  |  |  |  |
| RichTextProps.onTouchend |  |  | ✔️ |  |  |  |  |  |  |  |  |
| RichTextProps.onLongtap |  |  | ✔️ |  |  |  |  |  |  |  |  |
| RichTextProps.mode | ✔️ |  |  |  |  |  |  |  |  |  |  |

### TSpace

space 的合法值

| 参数 | 说明 |
| --- | --- |
| ensp | 中文字符空格一半大小 |
| emsp | 中文字符空格大小 |
| nbsp | 根据字体设置的空格大小 |

### Text

文本节点

| 参数 | 类型 | 默认值 | 说明 | 备注 |
| --- | --- | :---: | --- | --- |
| type | `"text"` |  | 文本类型 |  |
| text | `string` | `""` | 文本字符串 | `支持 entities` |

### HTMLElement

元素节点，默认为元素节点
全局支持class和style属性，不支持 id 属性。

| 参数 | 类型 | 必填 | 说明 | 备注 |
| --- | --- | :---: | --- | --- |
| type | `"node"` | 否 | HTML 类型 |  |
| name | `string` | 是 | 标签名 | `支持部分受信任的 HTML 节点` |
| attrs | `Object` | 否 | 属性 | `支持部分受信任的属性，遵循 Pascal 命名法` |
| children | `Nodes` | 否 | 子节点列表 | `结构和 nodes 一致` |

## Nodes

节点类型
> 现支持两种节点，通过type来区分，分别是元素节点和文本节点，默认是元素节点，在富文本区域里显示的HTML节点 元素节点：type = node*

### 类型

```tsx
(Text | HTMLElement)[] | string
```
</file>

<file path="docs/components/base/text.md">
---
title: Text
sidebar_label: Text
---

文本

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/text.html)

## 类型

```tsx
ComponentType<TextProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PageView extends Component {
  state = {
    contents: [],
    contentsLen: 0
  }

  add = () => {
    this.setState(prev => {
      const cot = prev.contents.slice()
      cot.push({ text: 'hello world' })
      return {
        contents: cot,
        contentsLen: cot.length
      }
    })
  }

  remove = () => {
    this.setState(prev => {
      const cot = prev.contents.slice()
      cot.pop()
      return {
        contents: cot,
        contentsLen: cot.length
      }
    })
  }

  render () {
    return (
      <View className='container'>
        {this.state.contents.map((item, index) => (
          <Text key={index}>{item.text}</Text>
        ))}
        <Button className='btn-max-w button_style' plain type='default' onClick={this.add}>add line</Button>
        <Button className='btn-max-w button_style' plain type='default' disabled={this.state.contentsLen ? false : true} onClick={this.remove}>remove line</Button>
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

``` html
<template>
  <view class="container">
    <view v-for="(item, index) in contents">
      <text>{{item.text}} line {{index + 1}}</text>
    </view>
    <button class="btn-max-w button_style" :plain="true" type="default" @tap="add">add line</button>
    <button class="btn-max-w button_style" :plain="true" type="default" :disabled="contentsLen ? false : true" @tap="remove">remove line</button>
</template>

<script>
export default {
  data() {
    return {
      contents: [],
      contentsLen: 0
    }
  },
  methods: {
    add () {
      const cot = this.contents.slice()
      cot.push({ text: 'hello world' })
      this.contents = cot
      this.contentsLen = cot.length
    },

    remove () {
      const cot = this.contents.slice()
      cot.pop()
      this.contents = cot
      this.contentsLen = cot.length
    }
  }
}
</script>
```
</TabItem>
</Tabs>

## TextProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| selectable | `boolean` | `false` | 否 | 文本是否可选 |
| userSelect | `boolean` | `false` | 否 | 文本是否可选，该属性会使文本节点显示为 inline-block |
| space | `keyof TSpace` |  | 否 | 显示连续空格 |
| decode | `boolean` | `false` | 否 | 是否解码 |
| numberOfLines | `number` |  | 否 | 多行省略，值须大于等于 1，表现同 css 的 -webkit-line-clamp 属性一致。 |
| overflow | `keyof Overflow` | `'visible'` | 否 | 文本溢出处理 |
| maxLines | `number` |  | 否 | 限制文本最大行数 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| TextProps.selectable | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  |
| TextProps.userSelect | ✔️ |  |  |  |  |  | ✔️ |  |  | ✔️ | ✔️ |
| TextProps.space | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| TextProps.decode | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ | (默认解码，不支持设置) |  |  |  | ✔️ |
| TextProps.numberOfLines |  |  | ✔️ |  |  |  |  |  |  |  |  |
| TextProps.overflow | ✔️ |  |  |  |  |  |  |  |  |  |  |
| TextProps.maxLines | ✔️ |  |  |  |  |  |  |  | ✔️ |  |  |

### TSpace

space 的合法值

| 参数 | 说明 |
| --- | --- |
| ensp | 中文字符空格一半大小 |
| emsp | 中文字符空格大小 |
| nbsp | 根据字体设置的空格大小 |

### Overflow

| 参数 | 说明 |
| --- | --- |
| clip | 修剪文本 |
| fade | 淡出 |
| ellipsis | 显示省略号 |
| visible | 文本不截断 |
</file>

<file path="docs/components/canvas/canvas.md">
---
title: Canvas
sidebar_label: Canvas
---

画布

`<Canvas />` 组件的 RN 版本尚未实现。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/canvas.html)

## 类型

```tsx
ComponentType<CanvasProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Components {
  render () {
    // 如果是支付宝小程序，则要加上 id 属性，值和canvasId一致
    return (
      <Canvas style='width: 300px; height: 200px;' canvasId='canvas' />
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <!-- 如果是支付宝小程序，则要加上 id 属性，值和canvasId一致 -->
  <canvas style="width: 300px; height: 200px;" canvas-id="canvas" />
</template>
```
</TabItem>
</Tabs>

## CanvasProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| type | `string` |  | 否 | 指定 canvas 类型，支持 2d 和 webgl |
| canvasId | `string` |  | 否 | canvas 组件的唯一标识符，若指定了 type 则无需再指定该属性 |
| disableScroll | `boolean` | `false` | 否 | 当在 canvas 中移动时且有绑定手势事件时，禁止屏幕滚动以及下拉刷新 |
| id | `string` |  | 否 | 组件唯一标识符。<br />注意：同一页面中的 id 不可重复。 |
| width | `string` |  | 否 |  |
| height | `string` |  | 否 |  |
| nativeProps | `Record<string, unknown>` |  | 否 | 用于透传 `WebComponents` 上的属性到内部 H5 标签上 |
| onTouchStart | `CanvasTouchEventFunction` |  | 否 | 手指触摸动作开始 |
| onTouchMove | `CanvasTouchEventFunction` |  | 否 | 手指触摸后移动 |
| onTouchEnd | `CanvasTouchEventFunction` |  | 否 | 手指触摸动作结束 |
| onTouchCancel | `CanvasTouchEventFunction` |  | 否 | 手指触摸动作被打断，如来电提醒，弹窗 |
| onLongTap | `CommonEventFunction` |  | 否 | 手指长按 500ms 之后触发，触发了长按事件后进行移动不会触发屏幕的滚动 |
| onError | `CommonEventFunction<onErrorEventDetail>` |  | 否 | 当发生错误时触发 error 事件，detail = {errMsg: 'something wrong'} |
| onTap | `CommonEventFunction` |  | 否 | 点击。 |
| onReady | `CommonEventFunction` |  | 否 | canvas 组件初始化成功触发。 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| CanvasProps.type | ✔️ |  | ✔️ | ✔️ |  |  |  |  |  |  | ✔️ |
| CanvasProps.canvasId | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasProps.disableScroll | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |  |  |  |  | ✔️ |
| CanvasProps.id |  |  | ✔️ |  |  |  | ✔️ |  |  | ✔️ |  |
| CanvasProps.width |  |  | ✔️ |  |  |  | ✔️ |  |  | ✔️ |  |
| CanvasProps.height |  |  | ✔️ |  |  |  | ✔️ |  |  | ✔️ |  |
| CanvasProps.nativeProps |  |  |  |  |  |  | ✔️ |  |  | ✔️ |  |
| CanvasProps.onTouchStart | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasProps.onTouchMove | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasProps.onTouchEnd | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasProps.onTouchCancel | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasProps.onLongTap | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| CanvasProps.onError | ✔️ | ✔️ |  |  | ✔️ | ✔️ |  |  |  |  | ✔️ |
| CanvasProps.onTap |  |  | ✔️ |  |  |  |  |  |  |  |  |
| CanvasProps.onReady |  |  | ✔️ |  |  |  |  |  |  |  |  |

### onErrorEventDetail

| 参数 | 类型 |
| --- | --- |
| errMsg | `string` |
</file>

<file path="docs/components/forms/button.md">
---
title: Button
sidebar_label: Button
---

按钮

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/button.html)

## 类型

```tsx
ComponentType<ButtonProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PageButton extends Component {
  state = {
    btn: [
      {
        text: '页面主操作 Normal',
        size: 'default',
        type: 'primary'
      },
      {
        text: '页面主操作 Loading',
        size: 'default',
        type: 'primary',
        loading: true,
      },
      {
        text: '页面主操作 Disabled',
        size: 'default',
        type: 'primary',
        disabled: true,
      },
      {
        text: '页面次要操作 Normal',
        size: 'default',
        type: 'default'
      },
      {
        text: '页面次要操作 Disabled',
        size: 'default',
        type: 'default',
        disabled: true,
      },
      {
        text: '警告类操作 Normal',
        size: 'default',
        type: 'warn'
      },
      {
        text: '警告类操作 Disabled',
        size: 'default',
        type: 'warn',
        disabled: true,
      }
    ]
  }
  render () {
    return (
      <View className='container'>
        {this.state.btn.map(item => {
          return (
            <Button
              size={item.size ? item.size : ''}
              type={item.type ? item.type : ''}
              loading={item.loading ? item.loading : false}
              disabled={item.disabled ? item.disabled : false}
            >
              {item.text}
            </Button>
          )
        })}
        <Button className='btn-max-w' plain type='primary'>按钮</Button>
        <Button className='btn-max-w' plain type='primary' disabled>不可点击的按钮</Button>
        <Button className='btn-max-w' plain >按钮</Button>
        <Button className='btn-max-w' plain disabled >按钮</Button>
        <Button size='mini' type='primary'>按钮</Button>
        <Button size='mini' >按钮</Button>
        <Button size='mini' type='warn'>按钮</Button>
        <Button openType='getPhoneNumber' onGetPhoneNumber="callback">按钮</Button>
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="container">
    <button
      v-for="item in btn"
      :size="item.size ? item.size : ''"
      :type="item.type ? item.type : ''"
      :loading="item.loading ? item.loading : false"
      :disabled="item.disabled ? item.disabled : false"
    >
      {{ item.text }}
    </button>
    <button class="btn-max-w" :plain="true" type="primary">按钮</button>
    <button class="btn-max-w" :plain="true" type="primary" :disabled="true">不可点击的按钮</button>
    <button class="btn-max-w" :plain="true">按钮</button>
    <button class="btn-max-w" :plain="true" :disabled="true">按钮</button>
    <button size="mini" type="primary">按钮</button>
    <button size="mini" >按钮</button>
    <button size="mini" type="warn">按钮</button>
    <button open-type="getPhoneNumber" @getphonenumber="callback">按钮</button>
  </view>
</template>

<script>
export default {
  data() {
    return {
      btn: [
        {
          text: '页面主操作 Normal',
          size: 'default',
          type: 'primary'
        },
        {
          text: '页面主操作 Loading',
          size: 'default',
          type: 'primary',
          loading: true,
        },
        {
          text: '页面主操作 Disabled',
          size: 'default',
          type: 'primary',
          disabled: true,
        },
        {
          text: '页面次要操作 Normal',
          size: 'default',
          type: 'default'
        },
        {
          text: '页面次要操作 Disabled',
          size: 'default',
          type: 'default',
          disabled: true,
        },
        {
          text: '警告类操作 Normal',
          size: 'default',
          type: 'warn'
        },
        {
          text: '警告类操作 Disabled',
          size: 'default',
          type: 'warn',
          disabled: true,
        }
      ]
    }
  }
}
</script>
```
</TabItem>
</Tabs>

## ButtonProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| size | `keyof Size` | `default` | 否 | 按钮的大小 |
| type | `keyof Type` | `default` | 否 | 按钮的样式类型 |
| plain | `boolean` | `false` | 否 | 按钮是否镂空，背景色透明 |
| disabled | `boolean` | `false` | 否 | 是否禁用 |
| loading | `boolean` | `false` | 否 | 名称前是否带 loading 图标 |
| formType | `keyof FormType` |  | 否 | 用于 `<form/>` 组件，点击分别会触发 `<form/>` 组件的 submit/reset 事件 |
| openType | `OpenType` |  | 否 | 微信开放能力 |
| hoverClass | `string` | `button-hover` | 否 | 指定按下去的样式类。当 `hover-class="none"` 时，没有点击态效果 |
| hoverStyle | `StyleProp<ViewStyle>` | `none` | 否 | 由于 RN 不支持 hoverClass，故 RN 端的 Button 组件实现了 `hoverStyle`属性，写法和 style 类似，只不过 `hoverStyle` 的样式是指定按下去的样式。 |
| hoverStopPropagation | `boolean` | `false` | 否 | 指定是否阻止本节点的祖先节点出现点击态 |
| hoverStartTime | `number` | `20` | 否 | 按住后多久出现点击态，单位毫秒 |
| hoverStayTime | `number` | `70` | 否 | 手指松开后点击态保留时间，单位毫秒 |
| lang | `keyof Lang` |  | 否 | 指定返回用户信息的语言，zh_CN 简体中文，zh_TW 繁体中文，en 英文。<br /><br />生效时机: `open-type="getUserInfo"` |
| sessionFrom | `string` |  | 否 | 会话来源<br /><br />生效时机：`open-type="contact"` |
| sendMessageTitle | `string` | `当前标题` | 否 | 会话内消息卡片标题<br /><br />生效时机：`open-type="contact"` |
| sendMessagePath | `string` | `当前标题` | 否 | 会话内消息卡片点击跳转小程序路径<br /><br />生效时机：`open-type="contact"` |
| sendMessageImg | `string` | `截图` | 否 | 会话内消息卡片图片<br /><br />生效时机：`open-type="contact"` |
| appParameter | `string` |  | 否 | 打开 APP 时，向 APP 传递的参数<br /><br />生效时机：`open-type="launchApp"` |
| scope | "userInfo" or "phoneNumber" |  | 否 | 支付宝小程序 scope<br /><br />生效时机：`open-type="getAuthorize"` |
| showMessageCard | `boolean` | `false` | 否 | 显示会话内消息卡片<br /><br />生效时机：`open-type="contact"` |
| publicId | `string` |  | 否 | 生活号 id，必须是当前小程序同主体且已关联的生活号，open-type="lifestyle" 时有效。 |
| templateId | string or string[] |  | 否 | 发送订阅类模板消息所用的模板库标题 ID ，可通过 getTemplateLibraryList 获取<br />当参数类型为 Array 时，可传递 1~3 个模板库标题 ID |
| subscribeId | `string` |  | 否 | 发送订阅类模板消息时所使用的唯一标识符，内容由开发者自定义，用来标识订阅场景<br />注意：同一用户在同一 subscribe-id 下的多次授权不累积下发权限，只能下发一条。若要订阅多条，需要不同 subscribe-id |
| groupId | `string` |  | 否 | 群聊 id |
| guildId | `string` |  | 否 | 打开频道页面时，传递的频道号 |
| shareType | `string` | `27` | 否 | 分享类型集合，请参考下面share-type有效值说明。share-type后续将不再维护，请更新为share-mode |
| shareMode | `string` | `['qq', 'qzone']` | 否 | 分享类型集合，请参考下面share-mode有效值说明 |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |
| openId | `string` |  | 否 | 添加好友时，对方的 openid |
| shareMessageFriendInfo | `string` |  | 否 | 发送对象的 FriendInfo |
| shareMessageTitle | `string` |  | 否 | 转发标题，不传则默认使用当前小程序的昵称。 FriendInfo |
| shareMessageImg | `string` |  | 否 | 转发显示图片的链接，可以是网络图片路径（仅 QQ CDN 域名路径）或本地图片文件路径或相对代码包根目录的图片文件路径。显示图片长宽比是 5:4FriendInfo |
| dataAwemeId | `string` |  | 否 | 跳转抖音号个人页，只支持小程序绑定的品牌号、员工号、合作号 |
| dataIsHalfPage | `boolean` |  | 否 | 是否开启半屏模式 |
| onGetUserInfo | `CommonEventFunction<onGetUserInfoEventDetail>` |  | 否 | 用户点击该按钮时，会返回获取到的用户信息，回调的detail数据与 Taro.getUserInfo 返回的一致<br /><br />生效时机: `open-type="getUserInfo"` |
| onGetAuthorize | `CommonEventFunction` |  | 否 | 支付宝获取会员基础信息授权回调<br /><br />生效时机：`open-type="getAuthorize"` |
| onContact | `CommonEventFunction<onContactEventDetail>` |  | 否 | 客服消息回调<br /><br />生效时机：`open-type="contact"` |
| onGetPhoneNumber | `CommonEventFunction<onGetPhoneNumberEventDetail>` |  | 否 | 获取用户手机号回调<br /><br />生效时机：`open-type="getPhoneNumber"` |
| onGetRealTimePhoneNumber | `CommonEventFunction<onGetRealTimePhoneNumberEventDetail>` |  | 否 | 手机号实时验证回调，`open-type="getRealtimePhoneNumber"` 时有效 |
| onError | `CommonEventFunction` |  | 否 | 当使用开放能力时，发生错误的回调<br /><br />生效时机：`open-type="launchApp"` |
| onOpenSetting | `CommonEventFunction<onOpenSettingEventDetail>` |  | 否 | 在打开授权设置页后回调<br /><br />生效时机：`open-type="openSetting"` |
| onLaunchApp | `CommonEventFunction` |  | 否 | 打开 APP 成功的回调<br /><br />生效时机：`open-type="launchApp"` |
| onChooseAvatar | `CommonEventFunction` |  | 否 | 获取用户头像回调<br /><br />生效时机：`open-type="chooseAvatar"` |
| onAgreePrivacyAuthorization | `CommonEventFunction` |  | 否 | 用户同意隐私协议事件回调，`open-type="agreePrivacyAuthorization"`时有效 |
| onTap | `CommonEventFunction` |  | 否 | 点击。<br />说明： 每点击一次会触发一次事件，建议自行使用代码防止重复点击,可以使用 js 防抖和节流实现。 |
| onFollowLifestyle | CommonEventFunction<{ followStatus: true or 1 or 2 or 3; }> |  | 否 | 当 open-type 为 lifestyle 时有效。<br />当点击按钮时触发。<br />event.detail = { followStatus }，followStatus 合法值有 1、2、3，其中 1 表示已关注。2 表示用户不允许关注。3 表示发生未知错误；<br />已知问题：基础库 1.0，当用户在点击按钮前已关注生活号，event.detail.followStatus 的值为 true。 |
| onChooseAddress | `CommonEventFunction` |  | 否 | 用户点击该按钮时，调起用户编辑收货地址原生界面，并在编辑完成后返回用户选择的地址，从返回参数的 detail 中获取，和 swan.chooseAddress 一样的。和 open-type 搭配使用，使用时机：open-type="chooseAddress" |
| onChooseInvoiceTitle | `CommonEventFunction` |  | 否 | 用户点击该按钮时，选择用户的发票抬头，和 swan.chooseInvoiceTitle 一样的。和 open-type 搭配使用，使用时机：open-type="chooseInvoiceTitle" |
| onLogin | `CommonEventFunction` |  | 否 | 登录回调，和 open-type 搭配使用，使用时机：open-type="login"。可以通过返回参数的 detail 判断是否登录成功，当 errMsg 为'login:ok'时即为成功。如想获取登录凭证请使用 swan.getLoginCode |
| onSubscribe | `CommonEventFunction` |  | 否 | 订阅消息授权回调，和 open-type 搭配使用，使用时机：open-type="subscribe" |
| onAddFriend | `CommonEventFunction` |  | 否 | 添加好友的回调 |
| onAddGroupApp | `CommonEventFunction` |  | 否 | 添加群应用的回调。errCode 错误码：41004（当前用户非管理员或群主，无权操作），41005（超过可添加群应用的群数量） |
| onOpenAwemeUserProfile | `CommonEventFunction` |  | 否 | 监听跳转抖音号个人页的回调<br /><br />生效时机：`open-type="openAwemeUserProfile"` |
| onJoinGroup | `CommonEventFunction<{ errMsg: string; errNo: number; }>` |  | 否 | 加群后触发 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| ButtonProps.size | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ButtonProps.type | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| ButtonProps.plain | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| ButtonProps.disabled | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| ButtonProps.loading | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| ButtonProps.formType | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  | ✔️ |
| ButtonProps.openType | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| ButtonProps.hoverClass | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️(支持 hoverStyle 属性，但框架未支持 hoverClass) |  | ✔️ | ✔️ |
| ButtonProps.hoverStyle |  |  |  |  |  |  |  | ✔️ |  |  |  |
| ButtonProps.hoverStopPropagation | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| ButtonProps.hoverStartTime | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ButtonProps.hoverStayTime | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ButtonProps.lang | ✔️ |  |  |  | ✔️ | ✔️ |  |  |  |  |  |
| ButtonProps.sessionFrom | ✔️ | ✔️ |  |  |  |  |  |  |  |  |  |
| ButtonProps.sendMessageTitle | ✔️ | ✔️ |  |  |  |  |  |  |  |  |  |
| ButtonProps.sendMessagePath | ✔️ | ✔️ |  |  |  |  |  |  |  |  |  |
| ButtonProps.sendMessageImg | ✔️ | ✔️ |  |  |  |  |  |  |  |  |  |
| ButtonProps.appParameter | ✔️ |  |  |  | ✔️ | ✔️ |  |  |  |  | ✔️ |
| ButtonProps.scope |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ButtonProps.showMessageCard | ✔️ | ✔️ |  |  |  |  |  |  |  |  |  |
| ButtonProps.publicId |  |  | ✔️ |  | ✔️ |  |  |  |  |  |  |
| ButtonProps.templateId |  | ✔️ |  |  |  |  |  |  |  |  |  |
| ButtonProps.subscribeId |  | ✔️ |  |  |  |  |  |  |  |  |  |
| ButtonProps.groupId |  |  |  | ✔️(通过创建聊天群、查询群信息获取) | ✔️(打开群资料卡时，传递的群号) |  |  |  |  |  |  |
| ButtonProps.guildId |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ButtonProps.shareType |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ButtonProps.shareMode |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ButtonProps.ariaLabel |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ButtonProps.openId |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ButtonProps.shareMessageFriendInfo |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ButtonProps.shareMessageTitle |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ButtonProps.shareMessageImg |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ButtonProps.dataAwemeId |  |  |  | ✔️ |  |  |  |  |  |  |  |
| ButtonProps.dataIsHalfPage |  |  |  | ✔️ |  |  |  |  |  |  |  |
| ButtonProps.onGetUserInfo | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |  |  |  |  |  |
| ButtonProps.onGetAuthorize |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ButtonProps.onContact | ✔️ | ✔️ |  |  | ✔️ |  |  |  |  |  |  |
| ButtonProps.onGetPhoneNumber | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |  |  |  |
| ButtonProps.onGetRealTimePhoneNumber | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ButtonProps.onError | ✔️ |  | ✔️ |  | ✔️ | ✔️ |  |  |  |  | ✔️ |
| ButtonProps.onOpenSetting | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| ButtonProps.onLaunchApp | ✔️ |  |  |  | ✔️ |  |  |  |  |  | ✔️ |
| ButtonProps.onChooseAvatar | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ButtonProps.onAgreePrivacyAuthorization | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ButtonProps.onTap |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ButtonProps.onFollowLifestyle |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ButtonProps.onChooseAddress |  | ✔️ |  |  |  |  |  |  |  |  |  |
| ButtonProps.onChooseInvoiceTitle |  | ✔️ |  |  |  |  |  |  |  |  |  |
| ButtonProps.onLogin |  | ✔️ |  |  |  |  |  |  |  |  |  |
| ButtonProps.onSubscribe |  | ✔️ |  |  |  |  |  |  |  |  |  |
| ButtonProps.onAddFriend |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ButtonProps.onAddGroupApp |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ButtonProps.onOpenAwemeUserProfile |  |  |  | ✔️ |  |  |  |  |  |  |  |
| ButtonProps.onJoinGroup |  |  |  | ✔️ |  |  |  |  |  |  |  |

### Size

size 的合法值

| 参数 | 说明 |
| --- | --- |
| default | 默认大小 |
| mini | 小尺寸 |

### Type

type 的合法值

| 参数 | 说明 |
| --- | --- |
| primary | 绿色 |
| default | 白色 |
| warn | 红色 |

### FormType

form-type 的合法值

| 参数 | 说明 |
| --- | --- |
| submit | 提交表单 |
| reset | 重置表单 |

### OpenType

open-type 的合法值

### openTypeKeys

open-type 的合法值

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| weapp | { contact: any; share: any; getPhoneNumber: any; getRealtimePhoneNumber: any; getUserInfo: any; launchApp: any; openSetting: any; feedback: any; chooseAvatar: any; agreePrivacyAuthorization: any; "getPhoneNumberoragreePrivacyAuthorization": any; "getRealtimePhoneNumberoragreePrivacyAuthorization": any; "getUserInfoorag... |  |
| alipay | `{ share: any; getAuthorize: any; contactShare: any; lifestyle: any; }` | 支付宝小程序专属的 open-type 合法值<br />[参考地址](https://opendocs.alipay.com/mini/component/button) |
| qq | `{ share: any; getUserInfo: any; launchApp: any; openSetting: any; feedback: any; openGroupProfile: any; addFriend: any; addColorSign: any; openPublicProfile: any; addGroupApp: any; shareMessageToFriend: any; }` | QQ 小程序专属的 open-type 合法值<br />[参考地址](https://q.qq.com/wiki/develop/miniprogram/component/form/button.html) |
| tt | `{ share: any; getPhoneNumber: any; im: any; platformIm: any; navigateToVideoView: any; openAwemeUserProfile: any; openWebcastRoom: any; addCalendarEvent: any; addShortcut: any; joinGroup: any; privateMessage: any; authorizePrivateMessage: any; }` | TT 小程序专属的 open-type 合法值<br />[参考地址](https://developer.open-douyin.com/docs/resource/zh-CN/mini-app/develop/component/list/button/#open-type-%E7%9A%84%E5%90%88%E6%B3%95%E5%80%BC) |

### Lang

lang 的合法值

| 参数 | 说明 |
| --- | --- |
| en | 英文 |
| zh_CN | 简体中文 |
| zh_TW | 繁体中文 |

### onGetUserInfoEventDetail

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| userInfo | `{ nickName: string; avatarUrl: string; avatar: string; gender: keyof Gender; province: string; city: string; country: string; }` | 是 |  |
| rawData | `string` | 是 | 不包括敏感信息的原始数据 `JSON` 字符串，用于计算签名 |
| signature | `string` | 是 | 使用 `sha1(rawData + sessionkey)` 得到字符串，用于校验用户信息 |
| encryptedData | `string` | 是 | 包括敏感数据在内的完整用户信息的加密数据 |
| iv | `string` | 是 | 加密算法的初始向量 |
| errMsg | `string` | 是 |  |
| cloudID | `string` | 否 | 敏感数据对应的云 ID，开通[云开发](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)的小程序才会返回，可通过云调用直接获取开放数据，详细见[云调用直接获取开放数据](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html#method-cloud) |

### Gender

性别的合法值

| 参数 | 说明 |
| --- | --- |
| 0 | 未知 |
| 1 | 男 |
| 2 | 女 |

### onContactEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` |  |
| path | `string` | 小程序消息指定的路径 |
| query | `Record<string, any>` | 小程序消息指定的查询参数 |

### onGetPhoneNumberEventDetail

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| errMsg | `string` | 是 |  |
| encryptedData | `string` | 是 | 包括敏感数据在内的完整用户信息的加密数据 |
| iv | `string` | 是 | 加密算法的初始向量 |
| code | `string` | 否 | 动态令牌。可通过动态令牌换取用户手机号。<br />[参考地址](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share.html#%E4%BD%BF%E7%94%A8%E6%8C%87%E5%BC%95) |
| sign | `string` | 是 | 签名信息，如果在开放平台后台配置了加签方式后有此字段 |

#### API 支持度

| API | 微信小程序 | 支付宝小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| onGetPhoneNumberEventDetail.sign |  | ✔️ |  |  |  |

### onGetRealTimePhoneNumberEventDetail

| 参数 | 类型 |
| --- | --- |
| code | `string` |

### onOpenSettingEventDetail

| 参数 | 类型 |
| --- | --- |
| errMsg | `string` |
| authSetting | `Record<string, boolean>` |
</file>

<file path="docs/components/forms/checkbox-group.md">
---
title: CheckboxGroup
sidebar_label: CheckboxGroup
---

多项选择器，内部由多个checkbox组成

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/checkbox-group.html)

## 类型

```tsx
ComponentType<CheckboxGroupProps>
```

## 示例代码

```tsx
export default class PageCheckbox extends Component {
  state = {
    list: [
      {
        value: '美国',
        text: '美国',
        checked: false
      },
      {
        value: '中国',
        text: '中国',
        checked: true
      },
      {
        value: '巴西',
        text: '巴西',
        checked: false
      },
      {
        value: '日本',
        text: '日本',
        checked: false
      },
      {
        value: '英国',
        text: '英国',
        checked: false
      },
      {
        value: '法国',
        text: '法国',
        checked: false
      }
    ]
  }
  render () {
    return (
      <View className='page-body'>
        <View className='page-section'>
          <Text>默认样式</Text>
          <Checkbox value='选中' checked>选中</Checkbox>
          <Checkbox style='margin-left: 20rpx' value='未选中'>未选中</Checkbox>
        </View>
        <View className='page-section'>
          <Text>推荐展示样式</Text>
          {this.state.list.map((item, i) => {
            return (
              <Label className='checkbox-list__label' for={i} key={i}>
                <Checkbox className='checkbox-list__checkbox' value={item.value} checked={item.checked}>{item.text}</Checkbox>
              </Label>
            )
          })}
        </View>
      </View>
    )
  }
}
```

## CheckboxGroupProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| name | `string` | 否 | 表单组件中加上 name 来作为 key |
| onChange | `CommonEventFunction<{ value: string[]; }>` | 否 | `<CheckboxGroup/>` 中选中项发生改变是触发 change 事件 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| CheckboxGroupProps.name |  |  | ✔️ | ✔️ |  |  | ✔️ |  |  | ✔️ |  |
| CheckboxGroupProps.onChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
</file>

<file path="docs/components/forms/checkbox.md">
---
title: Checkbox
sidebar_label: Checkbox
---

多选项目

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/checkbox.html)

## 类型

```tsx
ComponentType<CheckboxProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PageCheckbox extends Component {
  state = {
    list: [
      {
        value: '美国',
        text: '美国',
        checked: false
      },
      {
        value: '中国',
        text: '中国',
        checked: true
      },
      {
        value: '巴西',
        text: '巴西',
        checked: false
      },
      {
        value: '日本',
        text: '日本',
        checked: false
      },
      {
        value: '英国',
        text: '英国',
        checked: false
      },
      {
        value: '法国',
        text: '法国',
        checked: false
      }
    ]
  }
  render () {
    return (
      <View className='page-body'>
        <View className='page-section'>
          <Text>默认样式</Text>
          <Checkbox value='选中' checked>选中</Checkbox>
          <Checkbox style='margin-left: 20rpx' value='未选中'>未选中</Checkbox>
        </View>
        <View className='page-section'>
          <Text>推荐展示样式</Text>
          {this.state.list.map((item, i) => {
            return (
              <Label className='checkbox-list__label' for={i} key={i}>
                <Checkbox className='checkbox-list__checkbox' value={item.value} checked={item.checked}>{item.text}</Checkbox>
              </Label>
            )
          })}
        </View>
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="container">
    <view class="page-section">
      <text>默认样式</text>
      <checkbox value="选中" :checked="true">选中</checkbox>
      <checkbox style="margin-left: 20rpx;" value="未选中">未选中</checkbox>
    </view>
    <view class="page-section">
      <text>推荐展示样式(Taro 团队成员):</text>
      <label v-for="item in list" class="checkbox-list__label">
        <checkbox class="checkbox-list__checkbox" :value="item.value" :checked="item.checked">{{ item.text }}</checkbox>
      </label>
    </view>
  </view>
</template>

<script>
export default {
  data() {
    return {
      list: [
        {
          value: '美国',
          text: '美国',
          checked: false
        },
        {
          value: '中国',
          text: '中国',
          checked: true
        },
        {
          value: '巴西',
          text: '巴西',
          checked: false
        },
        {
          value: '日本',
          text: '日本',
          checked: false
        },
        {
          value: '英国',
          text: '英国',
          checked: false
        },
        {
          value: '法国',
          text: '法国',
          checked: false
        }
      ]
    }
  }
}
</script>
```
</TabItem>
</Tabs>

## CheckboxProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| value | `string` |  | 是 | `<Checkbox/>`标识，选中时触发`<CheckboxGroup/>`的 change 事件，并携带 `<Checkbox/>` 的 value |
| disabled | `boolean` | `false` | 否 | 是否禁用 |
| checked | `boolean` | `false` | 否 | 当前是否选中，可用来设置默认选中 |
| color | `string` |  | 否 | checkbox的颜色，同 css 的 color |
| name | `string` |  | 否 | Checkbox 的名字 |
| nativeProps | `Record<string, unknown>` |  | 否 | 用于透传 `WebComponents` 上的属性到内部 H5 标签上 |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |
| onChange | `CommonEventFunction<{ value: string[]; }>` |  | 否 | 选中项发生变化时触发 change 事件，小程序无此 API |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| CheckboxProps.value | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| CheckboxProps.disabled | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| CheckboxProps.checked | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| CheckboxProps.color | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| CheckboxProps.name |  |  |  |  |  |  | ✔️ |  | ✔️ | ✔️ |  |
| CheckboxProps.nativeProps |  |  |  |  |  |  | ✔️ |  |  | ✔️ |  |
| CheckboxProps.ariaLabel |  |  |  |  | ✔️ |  |  |  |  |  |  |
| CheckboxProps.onChange |  |  | ✔️ |  |  |  | ✔️ | ✔️ | ✔️ | ✔️ |  |
</file>

<file path="docs/components/forms/editor.md">
---
title: Editor
sidebar_label: Editor
---

富文本编辑器，可以对图片、文字进行编辑。

编辑器导出内容支持带标签的 html和纯文本的 text，编辑器内部采用 delta 格式进行存储。

通过 setContents 接口设置内容时，解析插入的 html 可能会由于一些非法标签导致解析错误，建议开发者在小程序内使用时通过 delta 进行插入。

富文本组件内部引入了一些基本的样式使得内容可以正确的展示，开发时可以进行覆盖。需要注意的是，在其它组件或环境中使用富文本组件导出的 html 时，需要额外引入 这段样式，并维护 `<ql-container><ql-editor></ql-editor></ql-container>` 的结构。

图片控件仅初始化时设置有效。

*编辑器内支持部分 HTML 标签和内联样式，不支持 **class** 和 **id***

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/editor.html)

## 类型

```tsx
ComponentType<EditorProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Components {
  state = {
    placeholder: '来，输入隔壁的名字试试...'
  }

  editorReady = e => {
    Taro.createSelectorQuery().select('#editor').context((res) => {
      this.editorCtx = res.context
    }).exec()
  }

  undo = e => {
    this.editorCtx.undo()
  }

  render () {
    return (
      <View>
        <Editor id='editor' className='editor' placeholder={this.state.placeholder} onReady={this.editorReady}></Editor>
        <Button type='warn' onClick={this.undo}>撤销</Button>
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="container">
    <editor id="editor" class="editor" :placeholder="placeholder" @ready="editorReady"></editor>
    <button type="warn" @tap="undo">撤销</button>
  </view>
</template>

<script>
  import Taro from '@tarojs/taro'
  export default {
    data() {
      return {
        placeholder: '来，输入隔壁的名字试试...'
      }
    },
    methods: {
      editorReady() {
        Taro.createSelectorQuery().select('#editor').context((res) => {
          this.editorCtx = res.context
        }).exec()
      },
      undo() {
        this.editorCtx.undo()
      }
    }
  }
</script>
```
</TabItem>
</Tabs>

## EditorProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| readOnly | `boolean` | `false` | 否 | 设置编辑器为只读 |
| placeholder | `string` |  | 否 | 提示信息 |
| showImgSize | `boolean` | `false` | 否 | 点击图片时显示图片大小控件 |
| showImgToolbar | `boolean` | `false` | 否 | 点击图片时显示工具栏控件 |
| showImgResize | `boolean` | `false` | 否 | 点击图片时显示修改尺寸控件 |
| onReady | `CommonEventFunction` |  | 否 | 编辑器初始化完成时触发 |
| onFocus | `CommonEventFunction<editorEventDetail>` |  | 否 | 编辑器聚焦时触发 |
| onBlur | `CommonEventFunction<editorEventDetail>` |  | 否 | 编辑器失去焦点时触发<br />detail = { html, text, delta } |
| onInput | `CommonEventFunction<editorEventDetail>` |  | 否 | 编辑器内容改变时触发<br />detail = { html, text, delta } |
| onStatusChange | `CommonEventFunction` |  | 否 | 通过 Context 方法改变编辑器内样式时触发，返回选区已设置的样式 |

### API 支持度

| API | 微信小程序 | 京东小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| EditorProps.readOnly | ✔️ | ✔️ |  |  |  |  |
| EditorProps.placeholder | ✔️ | ✔️ |  |  |  |  |
| EditorProps.showImgSize | ✔️ | ✔️ |  |  |  |  |
| EditorProps.showImgToolbar | ✔️ | ✔️ |  |  |  |  |
| EditorProps.showImgResize | ✔️ | ✔️ |  |  |  |  |
| EditorProps.onReady | ✔️ | ✔️ |  |  |  |  |
| EditorProps.onFocus | ✔️ | ✔️ |  |  |  |  |
| EditorProps.onBlur | ✔️ | ✔️ |  |  |  |  |
| EditorProps.onInput | ✔️ | ✔️ |  |  |  |  |
| EditorProps.onStatusChange | ✔️ | ✔️ |  |  |  |  |

### editorEventDetail
</file>

<file path="docs/components/forms/form.md">
---
title: Form
sidebar_label: Form
---

表单。将组件内的用户输入的 switch input checkbox slider radio picker 提交。

当点击 form 表单中 form-type 为 submit 的 button 组件时，会将表单组件中的 value 值进行提交，需要在表单组件中加上 name 来作为 key。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/form.html)

## 类型

```tsx
ComponentType<FormProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Component {

  formSubmit = e => {
    console.log(e)
  }

  formReset = e => {
    console.log(e)
  }

  render () {
    return (
      <Form onSubmit={this.formSubmit} onReset={this.formReset} >
        <View className='example-body'>
          <Switch name='switch' className='form-switch'></Switch>
        </View>
      </Form>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <form @submit="formSubmit" @reset="formReset" >
      <view class="taro-example-body">
        <switch name="switch" class="form-switch"></Switch>
      </view>
      <view class="taro-example-btns">
        <button form-type="submit">Submit</button>
        <button type="default" form-type="reset">Reset</button>
    </view>
  </form>
</template>

<script>
export default {
  data() {
    return {}
  },
  methods: {
    formSubmit (e) {
      console.log(e)
    },

    formReset (e) {
      console.log(e)
    }
  }
}
</script>
```
</TabItem>
</Tabs>

## FormProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| reportSubmit | `boolean` | `false` | 否 | 是否返回 `formId` 用于发送模板消息。 |
| reportSubmitTimeout | `number` | `0` | 否 | 等待一段时间（毫秒数）以确认 `formId` 是否生效。<br />如果未指定这个参数，`formId` 有很小的概率是无效的（如遇到网络失败的情况）。<br />指定这个参数将可以检测 `formId` 是否有效，<br />以这个参数的时间作为这项检测的超时时间。<br />如果失败，将返回 `requestFormId:fail` 开头的 `formId`。 |
| reportType | `string` | `'default'` | 否 | 模板消息的类型，report-submit 为 true 时填写有效<br />取值：default / subscribe |
| templateId | string or string[] |  | 否 | 发送订阅类模板消息所用的模板库标题 ID ，可通过 getTemplateLibraryList 获取<br />当参数类型为 Array 时，可传递 1~3 个模板库标题 ID （注：此处填写模板库id。示例：BD0001） |
| subscribeId | `string` |  | 否 | 发送订阅类模板消息时所使用的唯一标识符，内容由开发者自定义，用来标识订阅场景<br />注意：同一用户在同一 subscribe-id 下的多次授权不累积下发权限，只能下发一条。若要订阅多条，需要不同 subscribe-id |
| conversionTarget | `number` | `0` | 否 | 用于分发目的。取值：0 或 1，其中 0 表示默认，1 表示留资目标，需要和留资分发配置一起使用，详情见留资分发配置 |
| clueComponentId | `string` | `""` | 否 | 用于分发目的。开发者在【小程序开发者后台 -> 进入目标小程序 -> 运营 -> 流量配置 -> 抖音 -> 留资分发配置】复制创建的配置 ID，需要和留资分发配置一起使用，详情见留资分发配置 |
| onSubmit | `CommonEventFunction<onSubmitEventDetail>` |  | 否 | 携带 form 中的数据触发 submit 事件 |
| onReset | `CommonEventFunction` |  | 否 | 表单重置时会触发 reset 事件 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| FormProps.reportSubmit | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |
| FormProps.reportSubmitTimeout | ✔️ |  |  |  |  |  |  |  |  |  |  |
| FormProps.reportType |  | ✔️ |  |  |  |  |  |  |  |  |  |
| FormProps.templateId |  | ✔️ |  |  |  |  |  |  |  |  |  |
| FormProps.subscribeId |  | ✔️ |  |  |  |  |  |  |  |  |  |
| FormProps.conversionTarget |  |  |  | ✔️ |  |  |  |  |  |  |  |
| FormProps.clueComponentId |  |  |  | ✔️ |  |  |  |  |  |  |  |
| FormProps.onSubmit | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| FormProps.onReset | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |

### onSubmitEventDetail

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| value | `{ [formItemName: string]: any; }` | 否 | 当点击 `<form>` 表单中 `form-type` 为 `submit` 的 `<button>` 组件时，<br />会将表单组件中的 `value` 值进行提交，<br />需要在表单组件中加上 `name` 来作为 `key`。 |
| formId | `string` | 否 | 当 `reportSubmit` 为 `true` 时，返回 `formId` 用于发送模板消息。 |
</file>

<file path="docs/components/forms/input.md">
---
title: Input
sidebar_label: Input
---

输入框。该组件是原生组件，使用时请注意相关限制

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/input.html)

## 类型

```tsx
ComponentType<InputProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Component {
  render () {
    return (
      <View className='example-body'>
        <Text>可以自动聚焦的 input</Text>
          <Input type='text' placeholder='将会获取焦点' focus/>
          <Text>控制最大输入长度的 input</Text>
          <Input type='text' placeholder='最大输入长度为 10' maxLength='10'/>
          <Text>数字输入的 input</Text>
          <Input type='number' placeholder='这是一个数字输入框'/>
          <Text>密码输入的 input</Text>
          <Input type='password' password placeholder='这是一个密码输入框'/>
          <Text>带小数点的 input</Text>
          <Input type='digit' placeholder='带小数点的数字键盘'/>
          <Text>身份证输入的 input</Text>
          <Input type='idcard' placeholder='身份证输入键盘'/>
          <Text>控制占位符颜色的 input</Text>
          <Input type='text' placeholder='占位符字体是红色的' placeholderStyle='color:red'/>
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="example-body">
    <text>可以自动聚焦的 input</text>
    <input type="text" placeholder="将会获取焦点" :focus="true" />
    <text>控制最大输入长度的 input</text>
    <input type="text" placeholder="最大输入长度为 10" maxLength="10"/>
    <text>数字输入的 input</text>
    <input type="number" placeholder="这是一个数字输入框"/>
    <text>密码输入的 input</text>
    <input type="password" :password="true" placeholder="这是一个密码输入框"/>
    <text>带小数点的 input</text>
    <input type="digit" placeholder="带小数点的数字键盘"/>
    <text>身份证输入的 input</text>
    <input type="idcard" placeholder="身份证输入键盘"/>
    <text>控制占位符颜色的 input</text>
    <input type="text" placeholder="占位符字体是红色的" placeholder-style="color:red;"/>
  </view>
</template>
```
</TabItem>
</Tabs>

## InputProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| value | `string` |  | 否 | 输入框的初始内容 |
| defaultValue | `string` |  | 否 | 设置 React 非受控输入框的初始内容 |
| type | `keyof Type` | `"text"` | 否 | input 的类型 |
| password | `boolean` | `false` | 否 | 是否是密码类型 |
| placeholder | `string` |  | 否 | 输入框为空时占位符 |
| placeholderStyle | `string` |  | 否 | 指定 placeholder 的样式 |
| placeholderClass | `string` | `"input-placeholder"` | 否 | 指定 placeholder 的样式类 |
| placeholderTextColor | `string` |  | 否 | 指定 placeholder 的文本颜色 |
| disabled | `boolean` | `false` | 否 | 是否禁用 |
| maxlength | `number` | `140` | 否 | 最大输入长度，设置为 -1 的时候不限制最大长度 |
| cursorSpacing | `number` | `0` | 否 | 指定光标与键盘的距离，单位 px 。取 input 距离底部的距离和 cursor-spacing 指定的距离的最小值作为光标与键盘的距离 |
| autoFocus | `boolean` | `false` | 否 | (即将废弃，请直接使用 focus )自动聚焦，拉起键盘<br />**不推荐使用** |
| focus | `boolean` | `false` | 否 | 获取焦点 |
| confirmType | `keyof ConfirmType` | `done` | 否 | 设置键盘右下角按钮的文字，仅在type='text'时生效 |
| confirmHold | `boolean` | `false` | 否 | 点击键盘右下角按钮时是否保持键盘不收起 |
| cursor | `number` |  | 否 | 指定focus时的光标位置 |
| cursorColor | `string` |  | 否 | 光标颜色。iOS 下的格式为十六进制颜色值 #000000，安卓下的只支持 default 和 green，Skyline 下无限制 |
| selectionStart | `number` | `-1` | 否 | 光标起始位置，自动聚集时有效，需与selection-end搭配使用 |
| selectionEnd | `number` | `-1` | 否 | 光标结束位置，自动聚集时有效，需与selection-start搭配使用 |
| adjustPosition | `boolean` | `true` | 否 | 键盘弹起时，是否自动上推页面 |
| holdKeyboard | `boolean` | `false` | 否 | focus 时，点击页面的时候不收起键盘 |
| alwaysEmbed | `boolean` | `false` | 否 | 强制 input 处于同层状态，默认 focus 时 input 会切到非同层状态 (仅在 iOS 下生效) |
| safePasswordCertPath | `string` |  | 否 | 安全键盘加密公钥的路径，只支持包内路径 |
| safePasswordLength | `number` |  | 否 | 安全键盘输入密码长度 |
| safePasswordTimeStamp | `number` |  | 否 | 安全键盘加密时间戳 |
| safePasswordNonce | `string` |  | 否 | 安全键盘加密盐值 |
| safePasswordSalt | `string` |  | 否 | 安全键盘计算hash盐值，若指定custom-hash 则无效 |
| safePasswordCustomHash | `string` |  | 否 | 安全键盘计算hash的算法表达式，如 `md5(sha1('foo' + sha256(sm3(password + 'bar'))))` |
| randomNumber | `boolean` | `false` | 否 | 当 type 为 number, digit, idcard 数字键盘是否随机排列 |
| controlled | `boolean` | `false` | 否 | 是否为受控组件。为 true 时，value 内容会完全受 setData 控制。<br /><br />建议当 type 值为 text 时不要将 controlled 设置为 true,详见 [Bugs & Tips](https://opendocs.alipay.com/mini/component/input#Bug%20%26%20Tip) |
| nativeProps | `Record<string, unknown>` |  | 否 | 用于透传 `WebComponents` 上的属性到内部 H5 标签上 |
| name | `string` |  | 否 | 组件名字，用于表单提交获取数据。 |
| alwaysSystem | `boolean` | `false` | 否 | 是否强制使用系统键盘和 Web-view 创建的 input 元素。为 true 时，confirm-type、confirm-hold 可能失效。 |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |
| clueType | `number` | `0` | 否 | 用于分发目的。取值：0 和 1，其中 0 表示默认，1 表示手机号，需要和留资分发配置一起使用，详情见留资分发配置。 |
| onInput | `CommonEventFunction<inputEventDetail>` |  | 否 | 当键盘输入时，触发input事件，event.detail = {value, cursor, keyCode}，处理函数可以直接 return 一个字符串，将替换输入框的内容。 |
| onFocus | `CommonEventFunction<inputForceEventDetail>` |  | 否 | 输入框聚焦时触发，event.detail = { value, height }，height 为键盘高度 |
| onBlur | `CommonEventFunction<inputValueEventDetail>` |  | 否 | 输入框失去焦点时触发 |
| onConfirm | `CommonEventFunction<inputValueEventDetail>` |  | 否 | 点击完成按钮时触发 |
| onKeyboardHeightChange | `CommonEventFunction<onKeyboardHeightChangeEventDetail>` |  | 否 | 键盘高度发生变化的时候触发此事件 |
| onNickNameReview | `CommonEventFunction` |  | 否 | 用户昵称审核完毕后触发，仅在 type 为 "nickname" 时有效，event.detail = { pass, timeout } |
| onSelectionChange | `CommonEventFunction` |  | 否 | 选区改变事件, {selectionStart, selectionEnd} |
| onKeyboardCompositionStart | `CommonEventFunction` |  | 否 | 输入法开始新的输入时触发 （仅当输入法支持时触发） |
| onKeyboardCompositionUpdate | `CommonEventFunction` |  | 否 | 输入法输入字符时触发（仅当输入法支持时触发） |
| onKeyboardCompositionEnd | `CommonEventFunction` |  | 否 | 输入法输入结束时触发（仅当输入法支持时触发） |
| onKeyoardHeightChangeWorklet | `string` |  | 否 | 键盘高度变化时触发。event.detail = {height: height, pageBottomPadding: pageBottomPadding}； height: 键盘高度，pageBottomPadding: 页面上推高度 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| InputProps.value | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| InputProps.defaultValue | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| InputProps.type | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| InputProps.password | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| InputProps.placeholder | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| InputProps.placeholderStyle | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |  | ✔️ |
| InputProps.placeholderClass | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| InputProps.placeholderTextColor |  |  |  |  |  |  |  | ✔️ | ✔️ |  |  |
| InputProps.disabled | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| InputProps.maxlength | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| InputProps.cursorSpacing | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| InputProps.autoFocus | ✔️ |  |  |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |
| InputProps.focus | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| InputProps.confirmType | ✔️ | ✔️ | ✔️(confirm-type 与 enableNative 属性冲突，若希望 confirm-type 生效，enableNative 不能设定为 false，而且不能设定 always-system) | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |  | ✔️ |
| InputProps.confirmHold | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| InputProps.cursor | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |  |  |
| InputProps.cursorColor | ✔️ |  |  |  |  |  |  |  |  |  |  |
| InputProps.selectionStart | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |  |
| InputProps.selectionEnd | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |  |
| InputProps.adjustPosition | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |  |
| InputProps.holdKeyboard | ✔️ |  |  | ✔️ |  |  |  |  |  |  |  |
| InputProps.alwaysEmbed | ✔️ |  |  |  |  |  |  |  |  |  |  |
| InputProps.safePasswordCertPath | ✔️ |  |  |  |  |  |  |  |  |  |  |
| InputProps.safePasswordLength | ✔️ |  |  |  |  |  |  |  |  |  |  |
| InputProps.safePasswordTimeStamp | ✔️ |  |  |  |  |  |  |  |  |  |  |
| InputProps.safePasswordNonce | ✔️ |  |  |  |  |  |  |  |  |  |  |
| InputProps.safePasswordSalt | ✔️ |  |  |  |  |  |  |  |  |  |  |
| InputProps.safePasswordCustomHash | ✔️ |  |  |  |  |  |  |  |  |  |  |
| InputProps.randomNumber |  |  | ✔️ |  |  |  |  |  |  |  |  |
| InputProps.controlled |  |  | ✔️ |  |  |  |  |  |  |  |  |
| InputProps.nativeProps |  |  |  |  |  |  | ✔️ |  |  | ✔️ |  |
| InputProps.name |  |  | ✔️ |  |  |  |  |  |  |  |  |
| InputProps.alwaysSystem |  |  | ✔️ |  |  |  |  |  |  |  |  |
| InputProps.ariaLabel |  |  |  |  | ✔️ |  |  |  |  |  |  |
| InputProps.clueType |  |  |  | ✔️ |  |  |  |  |  |  |  |
| InputProps.onInput | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| InputProps.onFocus | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| InputProps.onBlur | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| InputProps.onConfirm | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| InputProps.onKeyboardHeightChange | ✔️ |  |  | ✔️ | ✔️ |  |  |  | ✔️ |  |  |
| InputProps.onNickNameReview | ✔️ |  |  |  |  |  |  |  |  |  |  |
| InputProps.onSelectionChange | ✔️ |  |  |  |  |  |  |  |  |  |  |
| InputProps.onKeyboardCompositionStart | ✔️ |  |  |  |  |  |  |  |  |  |  |
| InputProps.onKeyboardCompositionUpdate | ✔️ |  |  |  |  |  |  |  |  |  |  |
| InputProps.onKeyboardCompositionEnd | ✔️ |  |  |  |  |  |  |  |  |  |  |
| InputProps.onKeyoardHeightChangeWorklet | ✔️ |  |  |  |  |  |  |  |  |  |  |

### Type

Input 类型

| 参数 | 说明 |
| --- | --- |
| text | 文本输入键盘 |
| number | 数字输入键盘 |
| idcard | 身份证输入键盘 |
| digit | 带小数点的数字键盘 |
| safe-password | 密码安全输入键盘[指引](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/safe-password.html) |
| nickname | 昵称输入键盘 |
| numberpad | 数字输入键盘 |
| digitpad | 带小数点的数字键盘 |
| idcardpad | 身份证输入键盘 |

#### API 支持度

| API | 微信小程序 | 支付宝小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| Type.text | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| Type.number | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| Type.idcard | ✔️ | ✔️ |  | ✔️ |  |  |  |
| Type.digit | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  |
| Type.safe-password | ✔️ | ✔️ |  |  |  |  |  |
| Type.nickname | ✔️ | ✔️ |  |  |  |  |  |
| Type.numberpad |  | ✔️ |  |  |  |  |  |
| Type.digitpad |  | ✔️ |  |  |  |  |  |
| Type.idcardpad |  | ✔️ |  |  |  |  |  |

### ConfirmType

Confirm 类型

| 参数 | 说明 |
| --- | --- |
| send | 右下角按钮为“发送” |
| search | 右下角按钮为“搜索” |
| next | 右下角按钮为“下一个” |
| go | 右下角按钮为“前往” |
| done | 右下角按钮为“完成” |

### inputEventDetail

> 注意：React-Native 端 `inputEventDetail` 仅实现参数 `value`，若需实时获取光标位置则可通过 [`onSelectionChange`](https://reactnative.dev/docs/textinput#onselectionchange) 实现。

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | `string` | 输入值 |
| cursor | `number` | 光标位置 |
| keyCode | `number` | 键值 |

### inputForceEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | `string` | 输入值 |
| height | `number` | 键盘高度 |

### inputValueEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | `string` | 输入值 |

### onKeyboardHeightChangeEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| height | `number` | 键盘高度 |
| duration | `number` | 持续时间 |
</file>

<file path="docs/components/forms/keyboard-accessory.md">
---
title: KeyboardAccessory
sidebar_label: KeyboardAccessory
---

设置 Input / Textarea 聚焦时键盘上方 CoverView / CoverImage 工具栏视图。需要配置 Taro 插件 `@tarojs/plugin-platform-weapp` 的 `enablekeyboardAccessory` 参数为 `true` 后才能使用，请参考：[#9548](https://github.com/NervJS/taro/issues/9548#issuecomment-891682216)。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/keyboard-accessory.html)

## 类型

```tsx
ComponentType<StandardProps>
```

## 示例代码

```js
// config/index.js
{
  // ...
  plugins: [
    ['@tarojs/plugin-platform-weapp', {
      enablekeyboardAccessory: true
    }]
  ]
}
```

```tsx
class App extends Component {
  render () {
    return (
      <Textarea holdKeyboard="{{true}}">
        <KeyboardAccessory className="container" style={{ height: 50 }} >
          <CoverView onClick={() => { TODO }} style={{ flex: 1, background: 'green' }}>1</CoverView>
          <CoverView onClick={() => { TODO }} style={{ flex: 1, background: 'red' }}>2</CoverView>
        </KeyboardAccessory>
      </Textarea>
    )
  }
}
```
</file>

<file path="docs/components/forms/label.md">
---
title: Label
sidebar_label: Label
---

用来改进表单组件的可用性。

使用for属性找到对应的id，或者将控件放在该标签下，当点击时，就会触发对应的控件。 for优先级高于内部控件，内部有多个控件的时候默认触发第一个控件。 目前可以绑定的控件有：button, checkbox, radio, switch。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/label.html)

## 类型

```tsx
ComponentType<LabelProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Components {

  render () {
    return (
      <RadioGroup>
        <Label className='example-body__label' for='1' key='1'>
          <Radio value='USA'>USA</Radio>
        </Label>
        <Label className='example-body__label' for='2' key='2'>
          <Radio value='CHN' checked>
          CHN
          </Radio>
        </Label>
      </RadioGroup>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <radio-group>
    <label class="example-body__label" for="1" key="1">
      <radio id="1" value="USA" />
      USA
    </label>
    <label class="example-body__label" for="2" key="2">
      <radio id="2" value="CHN" :checked="true" />
      CHN
    </label>
  </radio-group>
</template>
```
</TabItem>
</Tabs>

## LabelProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| for | `string` | 否 | 绑定控件的 id |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| LabelProps.for | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |
</file>

<file path="docs/components/forms/picker-view-column.md">
---
title: PickerViewColumn
sidebar_label: PickerViewColumn
---

滚动选择器子项
仅可放置于 `<PickerView />` 中，其孩子节点的高度会自动设置成与 picker-view 的选中框的高度一致

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/picker-view-column.html)

## 类型

```tsx
ComponentType<StandardProps>
```

## PickerViewColumnProps
</file>

<file path="docs/components/forms/picker-view.md">
---
title: PickerView
sidebar_label: PickerView
---

嵌入页面的滚动选择器
其中只可放置 picker-view-column 组件，其它节点不会显示

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/picker-view.html)

## 类型

```tsx
ComponentType<PickerViewProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class Picks extends Component {

  constructor () {
    super(...arguments)
    const date = new Date()
    const years = []
    const months = []
    const days = []
    for (let i = 1990; i <= date.getFullYear(); i++) {
      years.push(i)
    }
    for (let i = 1; i <= 12; i++) {
      months.push(i)
    }
    for (let i = 1; i <= 31; i++) {
      days.push(i)
    }
    this.state = {
      years: years,
      year: date.getFullYear(),
      months: months,
      month: 2,
      days: days,
      day: 2,
      value: [9999, 1, 1]
    }
  }

  onChange = e => {
    const val = e.detail.value
    this.setState({
      year: this.state.years[val[0]],
      month: this.state.months[val[1]],
      day: this.state.days[val[2]],
      value: val
    })
  }

  render() {
    return (
      <View>
        <View>{this.state.year}年{this.state.month}月{this.state.day}日</View>
        <PickerView indicatorStyle='height: 50px;' style='width: 100%; height: 300px;' value={this.state.value} onChange={this.onChange}>
          <PickerViewColumn>
            {this.state.years.map(item => {
              return (
                <View>{item}年</View>
              );
            })}
          </PickerViewColumn>
          <PickerViewColumn>
            {this.state.months.map(item => {
              return (
                <View>{item}月</View>
              )
            })}
          </PickerViewColumn>
          <PickerViewColumn>
            {this.state.days.map(item => {
              return (
                <View>{item}日</View>
              )
            })}
          </PickerViewColumn>
        </PickerView>
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="taro-example">
  <view>{{year}}年{{month}}月{{day}}日</view>
  <picker-view indicator-style="height: 30px;" style="width: 100%; height: 300px;" :value="value" @change="onChange">
    <picker-view-column>
      <view v-for="(item, index) in years" :key="index">{{item}}年</view>
    </picker-view-column>
    <picker-view-column>
      <view v-for="(item, index) in months" :key="index">{{item}}月</view>
    </picker-view-column>
    <picker-view-column>
      <view v-for="(item, index) in days" :key="index">{{item}}日</view>
    </picker-view-column>
  </picker-view>
</view>
</template>

<script>
  export default {
    name: "Index",
    data() {
      const date = new Date()
      const years = []
      const months = []
      const days = []
      for (let i = 1990; i <= date.getFullYear(); i++) {
        years.push(i)
      }
      for (let i = 1; i <= 12; i++) {
        months.push(i)
      }
      for (let i = 1; i <= 31; i++) {
        days.push(i)
      }
      return {
        years: years,
        year: date.getFullYear(),
        months: months,
        month: 2,
        days: days,
        day: 2,
        value: [3, 1, 1]
      }
    },

    methods: {
      onChange: function(e) {
        const val = e.detail.value
        console.log(val)
        this.year = this.years[val[0]]
        this.month = this.months[val[1]]
        this.day = this.days[val[2]]
      }
    }
  }
</script>
```
</TabItem>
</Tabs>

## PickerViewProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| value | `number[]` |  | 否 | 数组中的数字依次表示 picker-view 内的 picker-view-column 选择的第几项（下标从 0 开始），数字大于 picker-view-column 可选项长度时，选择最后一项。 |
| defaultValue | `number[]` |  | 否 | 设置 React 非受控状态下的初始取值 |
| indicatorStyle | `string` |  | 否 | 设置选择器中间选中框的样式 |
| indicatorClass | `string` |  | 否 | 设置选择器中间选中框的类名 |
| maskStyle | `string` |  | 否 | 设置蒙层的样式 |
| maskClass | `string` |  | 否 | 设置蒙层的类名 |
| immediateChange | `boolean` | `false` | 否 | 是否在手指松开时立即触发 change 事件。若不开启则会在滚动动画结束后触发 change 事件。 |
| title | `string` |  | 否 | 选择器标题，建议标题控制在 12 个中文汉字长度内，避免出现截断现象, 截断部分将以 ... 形式展示 |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |
| onChange | `CommonEventFunction<onChangeEventDetail>` |  | 否 | 当滚动选择，value 改变时触发 change 事件，event.detail = {value: value}；value为数组，表示 picker-view 内的 picker-view-column 当前选择的是第几项（下标从 0 开始） |
| onPickStart | `CommonEventFunction` |  | 否 | 当滚动选择开始时候触发事件 |
| onPickEnd | `CommonEventFunction` |  | 否 | 当滚动选择结束时候触发事件 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| PickerViewProps.value | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| PickerViewProps.defaultValue | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| PickerViewProps.indicatorStyle | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| PickerViewProps.indicatorClass | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |
| PickerViewProps.maskStyle | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |
| PickerViewProps.maskClass | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |
| PickerViewProps.immediateChange | ✔️ |  | ✔️ | ✔️ |  |  |  |  |  |  |
| PickerViewProps.title |  | ✔️ |  |  |  |  |  |  |  |  |
| PickerViewProps.ariaLabel |  |  |  |  | ✔️ |  |  |  |  |  |
| PickerViewProps.onChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| PickerViewProps.onPickStart | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| PickerViewProps.onPickEnd | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |

### onChangeEventDetail

| 参数 | 类型 |
| --- | --- |
| value | `number[]` |
</file>

<file path="docs/components/forms/picker.md">
---
title: Picker
sidebar_label: Picker
---

从底部弹起的滚动选择器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/picker.html)

## 类型

```tsx
ComponentType<PickerSelectorProps | PickerMultiSelectorProps | PickerTimeProps | PickerDateProps | PickerRegionProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PagePicker extends Component {
  state = {
    selector: ['美国', '中国', '巴西', '日本'],
    selectorChecked: '美国',
    timeSel: '12:01',
    dateSel: '2018-04-22'
  }

  onChange = e => {
    this.setState({
      selectorChecked: this.state.selector[e.detail.value]
    })
  }

  onTimeChange = e => {
    this.setState({
      timeSel: e.detail.value
    })
  }
  onDateChange = e => {
    this.setState({
      dateSel: e.detail.value
    })
  }

  render () {
    return (
      <View className='container'>
        <View className='page-body'>
          <View className='page-section'>
            <Text>地区选择器</Text>
            <View>
              <Picker mode='selector' range={this.state.selector} onChange={this.onChange}>
                <View className='picker'>
                  当前选择：{this.state.selectorChecked}
                </View>
              </Picker>
            </View>
          </View>
          <View className='page-section'>
            <Text>时间选择器</Text>
            <View>
              <Picker mode='time' onChange={this.onTimeChange}>
                <View className='picker'>
                  当前选择：{this.state.timeSel}
                </View>
              </Picker>
            </View>
          </View>
          <View className='page-section'>
            <Text>日期选择器</Text>
            <View>
              <Picker mode='date' onChange={this.onDateChange}>
                <View className='picker'>
                  当前选择：{this.state.dateSel}
                </View>
              </Picker>
            </View>
          </View>
        </View>
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="page-body">
    <view class="page-section">
      <text>地区选择器</text>
      <view>
        <picker mode="selector" :range="selector" @change="onChange">
          <view class="picker">
            当前选择：{{selectorChecked}}
          </view>
        </picker>
      </view>
    </view>
    <view class="page-section">
      <text>时间选择器</text>
      <view>
        <picker mode="time" @change="onTimeChange">
          <view class="picker">
            当前选择：{{timeSel}}
          </view>
        </picker>
      </view>
    </view>
    <view class="page-section">
      <text>日期选择器</text>
      <view>
        <picker mode="date" @change="onDateChange">
          <view class="picker">
            当前选择：{{dateSel}}
          </view>
        </picker>
      </view>
    </view>
  </view>
</template>

<script>
  export default {
    data() {
      return {
        selector: ['美国', '中国', '巴西', '日本'],
        selectorChecked: '美国',
        timeSel: '12:01',
        dateSel: '2018-04-22'
      }
    },
    methods: {
      onChange: function(e) {
        this.selectorChecked = this.selector[e.detail.value]
      },

      onTimeChange: function(e) {
        this.timeSel = e.detail.value
      },

      onDateChange: function(e) {
        this.dateSel = e.detail.value
      }
    }
  }
</script>
```
</TabItem>
</Tabs>

## PickerStandardProps

选择器通用参数

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| headerText | `string` |  | 否 | 选择器的标题，微信小程序中仅安卓可用 |
| mode | `keyof Mode` | `"selector"` | 否 | 选择器类型，默认是普通选择器 |
| disabled | `boolean` | `false` | 否 | 是否禁用 |
| onCancel | `CommonEventFunction` |  | 否 | 取消选择或点遮罩层收起 picker 时触发 |
| textProps | `PickerText` |  | 否 | 用于替换组件内部文本 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| PickerStandardProps.headerText | ✔️ |  |  |  |  |  |
| PickerStandardProps.mode | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerStandardProps.disabled | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| PickerStandardProps.onCancel | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerStandardProps.textProps |  | ✔️ |  | ✔️ | ✔️ |  |

### Mode

选择器类型

| 参数 | 说明 |
| --- | --- |
| selector | 普通选择器 |
| multiSelector | 多列选择器 |
| time | 时间选择器 |
| date | 日期选择器 |
| region | 省市区选择器 |

### PickerText

| 参数 | 类型 | 必填 |
| --- | --- | :---: |
| okText | `string` | 否 |
| cancelText | `string` | 否 |

## PickerSelectorProps

普通选择器：mode = selector

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| mode | `"selector"` |  | 否 | 选择器类型 |
| range | string[] or number[] or Record<string, any>[] | `[]` | 是 | mode为 selector 或 multiSelector 时，range 有效 |
| rangeKey | `string` |  | 否 | 当 range 是一个 Object Array 时，通过 rangeKey 来指定 Object 中 key 的值作为选择器显示内容 |
| value | `number` | `0` | 否 | 表示选择了 range 中的第几个（下标从 0 开始） |
| defaultValue | `number` |  | 否 | 设置 React 非受控状态下的初始取值 |
| itemStyle | `StyleProp<TextStyle>` | `{}` | 否 | mode为 selector 或 multiSelector 时 itemStyle 有效 |
| indicatorStyle | `StyleProp<ViewStyle>` | `{}` | 否 | mode为 selector 或 multiSelector 时 indicatorStyle 有效 |
| onChange | `CommonEventFunction<ChangeEventDetail>` |  | 否 | value 改变时触发 change 事件 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| PickerSelectorProps.range | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerSelectorProps.rangeKey | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerSelectorProps.value | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerSelectorProps.defaultValue | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| PickerSelectorProps.itemStyle |  |  | ✔️ |  |  |  |
| PickerSelectorProps.indicatorStyle |  |  | ✔️ |  |  |  |
| PickerSelectorProps.onChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |

### ChangeEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | string or number | 表示变更值的下标 |

## PickerMultiSelectorProps

多列选择器：mode = multiSelector

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| mode | `"multiSelector"` |  | 是 | 选择器类型 |
| range | string[][] or number[][] or Record<string, any>[][] | `[]` | 是 | mode为 selector 或 multiSelector 时，range 有效 |
| rangeKey | `string` |  | 否 | 当 range 是一个 Object Array 时，通过 rangeKey 来指定 Object 中 key 的值作为选择器显示内容 |
| value | string[] or number[] or Record<string, any>[] | `[]` | 是 | 表示选择了 range 中的第几个（下标从 0 开始） |
| itemStyle | `StyleProp<TextStyle>` | `{}` | 否 | mode为 selector 或 multiSelector 时 itemStyle 有效 |
| indicatorStyle | `StyleProp<ViewStyle>` | `{}` | 否 | mode为 selector 或 multiSelector 时 indicatorStyle 有效 |
| onChange | `CommonEventFunction<ChangeEventDetail>` |  | 是 | 当 value 改变时触发 change 事件 |
| onColumnChange | `CommonEventFunction<ColumnChangeEventDetail>` |  | 否 | 列改变时触发 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| PickerMultiSelectorProps.range | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerMultiSelectorProps.rangeKey | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerMultiSelectorProps.value | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerMultiSelectorProps.itemStyle |  |  | ✔️ |  |  |  |
| PickerMultiSelectorProps.indicatorStyle |  |  | ✔️ |  |  |  |
| PickerMultiSelectorProps.onChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerMultiSelectorProps.onColumnChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |

### ChangeEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | `number[]` | 表示变更值的下标 |

### ColumnChangeEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| column | `number` | 表示改变了第几列（下标从0开始） |
| value | `number` | 表示变更值的下标 |

## PickerTimeProps

时间选择器：mode = time

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| mode | `"time"` | 是 | 选择器类型 |
| value | `string` | 否 | value 的值表示选择了 range 中的第几个（下标从 0 开始） |
| defaultValue | `string` | 否 | 设置 React 非受控状态下的初始取值 |
| start | `string` | 否 | 仅当 mode 为 "time" 或 "date" 时有效，表示有效时间范围的开始，字符串格式为"hh:mm" |
| end | `string` | 否 | 仅当 mode 为 "time" 或 "date" 时有效，表示有效时间范围的结束，字符串格式为"hh:mm" |
| onChange | `CommonEventFunction<ChangeEventDetail>` | 是 | value 改变时触发 change 事件 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| PickerTimeProps.value | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerTimeProps.defaultValue | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| PickerTimeProps.start | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerTimeProps.end | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerTimeProps.onChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |

### ChangeEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | `string` | 表示选中的时间 |

## PickerDateProps

日期选择器：mode = date

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| mode | `"date"` |  | 是 | 选择器类型 |
| value | `string` | `0` | 是 | 表示选中的日期，格式为"YYYY-MM-DD" |
| defaultValue | `string` |  | 否 | 设置 React 非受控状态下的初始取值 |
| start | `string` |  | 否 | 仅当 mode 为 "time" 或 "date" 时有效，表示有效时间范围的开始，字符串格式为"YYYY-MM-DD" |
| end | `string` |  | 否 | 仅当 mode 为 "time" 或 "date" 时有效，表示有效时间范围的结束，字符串格式为"YYYY-MM-DD" |
| fields | `keyof Fields` | `"day"` | 否 | 有效值 year, month, day，表示选择器的粒度 |
| onChange | `CommonEventFunction<ChangeEventDetail>` |  | 是 | value 改变时触发 change 事件 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| PickerDateProps.value | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerDateProps.defaultValue | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| PickerDateProps.start | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerDateProps.end | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| PickerDateProps.fields | ✔️ | ✔️ | ✔️ |  | ✔️ |  |
| PickerDateProps.onChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |

### Fields

| 参数 | 说明 |
| --- | --- |
| year | 选择器粒度为年 |
| month | 选择器粒度为月份 |
| day | 选择器粒度为天 |

### ChangeEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | `string` | 表示选中的日期 |

## PickerRegionProps

省市区选择器：mode = region

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| mode | `"region"` |  | 是 | 选择器类型 |
| value | `string[]` | `[]` | 否 | 表示选中的省市区，默认选中每一列的第一个值 |
| defaultValue | `string[]` |  | 否 | 设置 React 非受控状态下的初始取值 |
| customItem | `string` |  | 否 | 可为每一列的顶部添加一个自定义的项 |
| level | `keyof Level` | `"region"` | 否 | 选择器层级 |
| regionData | `RegionData[]` |  | 否 | 自定义省市区数据 |
| onChange | `CommonEventFunction<ChangeEventDetail>` |  | 是 | value 改变时触发 change 事件 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| PickerRegionProps.value | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| PickerRegionProps.defaultValue | ✔️ | ✔️ | ✔️ |  |  | ✔️ |
| PickerRegionProps.customItem | ✔️ | ✔️ | ✔️ |  | ✔️ |  |
| PickerRegionProps.level | ✔️ |  |  |  |  |  |
| PickerRegionProps.regionData |  |  | ✔️ |  |  |  |
| PickerRegionProps.onChange | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |

### ChangeEventDetail

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| value | `string[]` | 是 | 表示选中的省市区 |
| code | `string[]` | 是 | 统计用区划代码 |
| postcode | `string` | 否 | 邮政编码 |

### RegionData

| 参数 | 类型 | 必填 |
| --- | --- | :---: |
| value | `string` | 是 |
| code | `string` | 是 |
| postcode | `string` | 否 |
| children | `RegionData[]` | 否 |

### Level

| 参数 | 说明 |
| --- | --- |
| province | 省级选择器 |
| city | 市级选择器 |
| region | 区级选择器 |
| sub-district | 街道选择器 |
</file>

<file path="docs/components/forms/radio-group.md">
---
title: RadioGroup
sidebar_label: RadioGroup
---

单项选择器，内部由多个 Radio 组成。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/radio-group.html)

## 类型

```tsx
ComponentType<RadioGroupProps>
```

## RadioGroupProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| name | `string` | 否 | 组件名字，用于表单提交获取数据。 |
| onChange | `CommonEventFunction` | 否 | RadioGroup 中选中项发生改变时触发 change 事件，detail = {value:[选中的radio的value的数组]} |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| RadioGroupProps.name |  |  | ✔️ | ✔️ |  |  |  |  | ✔️ |  |  |
| RadioGroupProps.onChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |

### onChangeEventDetail

| 参数 | 类型 |
| --- | --- |
| value | `string[]` |
</file>

<file path="docs/components/forms/radio.md">
---
title: Radio
sidebar_label: Radio
---

单选项目

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/radio.html)

## 类型

```tsx
ComponentType<RadioProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PageRadio extends Component {
  state = {
    list: [
      {
        value: '美国',
        text: '美国',
        checked: false
      },
      {
        value: '中国',
        text: '中国',
        checked: true
      },
      {
        value: '巴西',
        text: '巴西',
        checked: false
      },
      {
        value: '日本',
        text: '日本',
        checked: false
      },
      {
        value: '英国',
        text: '英国',
        checked: false
      },
      {
        value: '法国',
        text: '法国',
        checked: false
      }
    ]
  }
  render () {
    return (
      <View className='container'>
        <Head title='Radio' />
        <View className='page-body'>
          <View className='page-section'>
            <Text>默认样式</Text>
            <Radio value='选中' checked>选中</Radio>
            <Radio style='margin-left: 20rpx' value='未选中'>未选中</Radio>
          </View>
          <View className='page-section'>
            <Text>推荐展示样式</Text>
            <View className='radio-list'>
              <RadioGroup>
                {this.state.list.map((item, i) => {
                  return (
                    <Label className='radio-list__label' for={i} key={i}>
                      <Radio className='radio-list__radio' value={item.value} checked={item.checked}>{item.text}</Radio>
                    </Label>
                  )
                })}
              </RadioGroup>
            </View>
          </View>
        </View>
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="container">
    <view class="page-section">
      <text>默认样式</text>
      <radio value="选中" :checked="true">选中</radio>
      <radio style="margin-left: 20rpx;" value="未选中">未选中</radio>
    </view>
    <view class="page-section">
      <text>推荐展示样式(Taro 团队成员):</text>
        <radio-group @change="onChange">
          <label v-for="item in list" class="checkbox-list__label">
            <radio class="checkbox-list__checkbox" :value="item.value" :checked="item.checked">{{ item.text }}</radio>
          </label>
        </radio-group>
    </view>
  </view>
</template>

<script>
export default {
  data() {
    return {
      list: [
        {
          value: 'yuche',
          text: 'yuche',
          checked: false
        },
        {
          value: 'cjj',
          text: 'cjj',
          checked: false
        },
        {
          value: 'xiexiaoli',
          text: 'xiexiaoli',
          checked: false
        },
        {
          value: 'honly',
          text: 'honly',
          checked: false
        },
        {
          value: 'cs',
          text: 'cs',
          checked: false
        },
        {
          value: 'zhutianjian',
          text: 'zhutianjian',
          checked: false
        },
        {
          value: '隔壁老李',
          text: '隔壁老李',
          checked: true
        }
      ]
    }
  },
  methods: {
    onChange: function(e) {
      console.log(e.detail.value)
    }
  }
}
</script>
```
</TabItem>
</Tabs>

## RadioProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| value | `string` |  | 否 | `<Radio/>` 标识。当该`<Radio/>` 选中时，`<RadioGroup/>`的 change 事件会携带`<Radio/>`的 value |
| checked | `boolean` | `false` | 否 | 当前是否选中 |
| disabled | `boolean` | `false` | 否 | 是否禁用 |
| color | `string` | `"#09BB07"` | 否 | Radio 的颜色，同 css 的 color |
| name | `string` |  | 否 | Radio 的名字 |
| nativeProps | `Record<string, unknown>` |  | 否 | 用于透传 `WebComponents` 上的属性到内部 H5 标签上 |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |
| onChange | `CommonEventFunction<{ value?: string; }>` |  | 否 | <radio-group/> 中的选中项发生变化时触发 change 事件 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| RadioProps.value | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| RadioProps.checked | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| RadioProps.disabled | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| RadioProps.color | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |  | ✔️ |
| RadioProps.name |  |  |  |  |  |  | ✔️ |  | ✔️ | ✔️ |  |
| RadioProps.nativeProps |  |  |  |  |  |  | ✔️ |  |  | ✔️ |  |
| RadioProps.ariaLabel |  |  |  |  | ✔️ |  |  |  |  |  |  |
| RadioProps.onChange |  |  |  |  |  |  | ✔️ | ✔️ | ✔️ | ✔️ |  |
</file>

<file path="docs/components/forms/slider.md">
---
title: Slider
sidebar_label: Slider
---

滑动选择器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/slider.html)

## 类型

```tsx
ComponentType<SliderProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PageView extends Component {
  constructor() {
    super(...arguments)
  }

  render() {
    return (
      <View className='components-page'>
        <Text>设置 step</Text>
        <Slider step={1} value={50}/>
        <Text>显示当前 value</Text>
        <Slider step={1} value={50} showValue/>
        <Text>设置最小/最大值</Text>
        <Slider step={1} value={100} showValue min={50} max={200}/>
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="components-page">
    <text>设置 step</text>
    <slider step="1" value="50"/>
    <text>显示当前 value</text>
    <slider step="1" value="50" :show-value="true" />
    <text>设置最小/最大值</text>
    <slider step="1" value="100" :show-value="true" min="50" max="200"/>
  </view>
</template>
```
</TabItem>
</Tabs>

## SliderProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| min | `number` | `0` | 否 | 最小值 |
| max | `number` | `100` | 否 | 最大值 |
| step | `number` | `1` | 否 | 步长，取值必须大于 0，并且可被(max - min)整除 |
| disabled | `boolean` | `false` | 否 | 是否禁用 |
| value | `number` | `0` | 否 | 当前取值 |
| defaultValue | `string` |  | 否 | 设置 React 非受控状态下的初始取值 |
| color | `string` | `"#e9e9e9"` | 否 | 背景条的颜色（请使用 backgroundColor） |
| selectedColor | `string` | `"#1aad19"` | 否 | 已选择的颜色（请使用 activeColor） |
| activeColor | `string` | `"#1aad19"` | 否 | 已选择的颜色 |
| backgroundColor | `string` | `"#e9e9e9"` | 否 | 背景条的颜色 |
| blockSize | `number` | `28` | 否 | 滑块的大小，取值范围为 12 - 28 |
| blockColor | `string` | `"#ffffff"` | 否 | 滑块的颜色 |
| showValue | `boolean` | `false` | 否 | 是否显示当前 value |
| name | `string` |  | 否 | 组件名字，用于表单提交获取数据。 |
| trackSize | `string` | `4` | 否 | 轨道线条高度。 |
| handleSize | `string` | `22` | 否 | 滑块大小。 |
| handleColor | `string` |  | 否 | 滑块填充色，同 CSS 色值。 |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |
| onChange | `CommonEventFunction<onChangeEventDetail>` |  | 否 | 完成一次拖动后触发的事件 |
| onChanging | `CommonEventFunction<onChangeEventDetail>` |  | 否 | 拖动过程中触发的事件 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| SliderProps.min | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SliderProps.max | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SliderProps.step | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SliderProps.disabled | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SliderProps.value | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SliderProps.defaultValue | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| SliderProps.color | ✔️ |  |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |  |
| SliderProps.selectedColor | ✔️ |  |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |  |
| SliderProps.activeColor | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SliderProps.backgroundColor | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SliderProps.blockSize | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |
| SliderProps.blockColor | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SliderProps.showValue | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SliderProps.name |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SliderProps.trackSize |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SliderProps.handleSize |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SliderProps.handleColor |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SliderProps.ariaLabel |  |  |  |  | ✔️ |  |  |  |  |  |  |
| SliderProps.onChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SliderProps.onChanging | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |

### onChangeEventDetail
</file>

<file path="docs/components/forms/switch.md">
---
title: Switch
sidebar_label: Switch
---

开关选择器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/switch.html)

## 类型

```tsx
ComponentType<SwitchProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PageView extends Component {
  constructor() {
    super(...arguments)
  }

  render() {
    return (
      <View className='components-page'>
        <Text>默认样式</Text>
        <Switch checked/>
        <Switch/>
        <Text>推荐展示样式</Text>
        <Switch checked/>
        <Switch/>
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class='components-page'>
    <text>默认样式</text>
    <switch :checked="true" />
    <switch />
    <text>推荐展示样式</text>
    <switch :checked="true" />
    <switch />
  </view>
</template>
```
</TabItem>
</Tabs>

## SwitchProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| checked | `boolean` | `false` | 否 | 是否选中 |
| defaultChecked | `boolean` |  | 否 | 设置在 React 非受控状态下，当前是否选中 |
| disabled | `boolean` | `false` | 否 | 是否禁用 |
| type | "switch" or "checkbox" | `"switch"` | 否 | 样式，有效值：switch, checkbox |
| color | `string` | `"#04BE02"` | 否 | switch 的颜色，同 css 的 color |
| nativeProps | `Record<string, unknown>` |  | 否 | 用于透传 `WebComponents` 上的属性到内部 H5 标签上 |
| name | `string` |  | 否 | 组件名字，用于表单提交获取数据。 |
| controlled | `string` | `false` | 否 | 是否为受控组件，为 true 时，checked 会完全受 setData 控制。 |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |
| onChange | `CommonEventFunction<onChangeEventDetail>` |  | 否 | checked 改变时触发 change 事件 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| SwitchProps.checked | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SwitchProps.defaultChecked | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| SwitchProps.disabled | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SwitchProps.type | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SwitchProps.color | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SwitchProps.nativeProps |  |  |  |  |  |  | ✔️ |  |  | ✔️ |  |
| SwitchProps.name |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SwitchProps.controlled |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SwitchProps.ariaLabel |  |  |  |  | ✔️ |  |  |  |  |  |  |
| SwitchProps.onChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |

### onChangeEventDetail

| 参数 | 类型 |
| --- | --- |
| value | `boolean` |
</file>

<file path="docs/components/forms/textarea.md">
---
title: Textarea
sidebar_label: Textarea
---

多行输入框。该组件是原生组件，使用时请注意相关限制

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/textarea.html)

## 类型

```tsx
ComponentType<TextareaProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PageView extends Component {
  constructor() {
    super(...arguments)
  }

  render() {
    return (
      <View className='components-page'>
        <Text>输入区域高度自适应，不会出现滚动条</Text>
        <Textarea style='background:#fff;width:100%;min-height:80px;padding:0 30rpx;' autoHeight/>
        <Text>这是一个可以自动聚焦的 textarea</Text>
        <Textarea style='background:#fff;width:100%;height:80px;padding:0 30rpx;' autoFocus/>
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="components-page">
    <text>输入区域高度自适应，不会出现滚动条</text>
    <textarea style="background:#efefef;width:100%;min-height:80px;padding:0 30rpx;" :auto-height="true" />
    <text>这是一个可以自动聚焦的 textarea</text>
    <textarea style="background:#efefef;width:100%;height:80px;padding:0 30rpx;" :auto-focusd="true" />
  </view>
</template>
```
</TabItem>
</Tabs>

## TextareaProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| value | `string` |  | 否 | 输入框的内容 |
| defaultValue | `string` |  | 否 | 设置 React 非受控输入框的初始内容 |
| placeholder | `string` |  | 否 | 输入框为空时占位符 |
| placeholderStyle | `string` |  | 否 | 指定 placeholder 的样式<br />需传入对象，格式为 { fontSize: number, fontWeight: string, color: string } |
| placeholderClass | `string` | `"textarea-placeholder"` | 否 | 指定 placeholder 的样式类 |
| disabled | `boolean` | `false` | 否 | 是否禁用 |
| maxlength | `number` | `140` | 否 | 最大输入长度，设置为 -1 的时候不限制最大长度 |
| autoFocus | `boolean` | `false` | 否 | 自动聚焦，拉起键盘 |
| focus | `boolean` | `false` | 否 | 获取焦点 |
| autoHeight | `boolean` | `false` | 否 | 是否自动增高，设置 autoHeight 时，style.height不生效 |
| fixed | `boolean` | `false` | 否 | 如果 Textarea 是在一个 `position:fixed` 的区域，需要显示指定属性 fixed 为 true |
| cursorSpacing | `number` | `0` | 否 | 指定光标与键盘的距离，单位 px 。取 Textarea 距离底部的距离和 cursorSpacing 指定的距离的最小值作为光标与键盘的距离 |
| cursor | `number` | `-1` | 否 | 指定 focus 时的光标位置 |
| showConfirmBar | `boolean` | `true` | 否 | 是否显示键盘上方带有”完成“按钮那一栏 |
| selectionStart | `number` | `-1` | 否 | 光标起始位置，自动聚集时有效，需与 selectionEnd 搭配使用 |
| selectionEnd | `number` | `-1` | 否 | 光标结束位置，自动聚集时有效，需与 selectionStart 搭配使用 |
| adjustPosition | `boolean` | `true` | 否 | 键盘弹起时，是否自动上推页面 |
| holdKeyboard | `boolean` | `false` | 否 | focus 时，点击页面的时候不收起键盘 |
| disableDefaultPadding | `boolean` | `false` | 否 | 是否去掉 iOS 下的默认内边距 |
| nativeProps | `Record<string, unknown>` |  | 否 | 用于透传 `WebComponents` 上的属性到内部 H5 标签上 |
| confirmType | "send" or "search" or "next" or "go" or "done" or "return" |  | 否 | 设置键盘右下角按钮的文字 |
| confirmHold | `boolean` |  | 否 | 点击键盘右下角按钮时是否保持键盘不收起 |
| name | `string` |  | 否 | 组件名字，用于表单提交获取数据。 |
| showCount | `boolean` | `true` | 否 | 是否渲染字数统计功能（是否删除默认计数器/是否显示字数统计）。 |
| controlled | `boolean` | `false` | 否 | 是否为受控组件。为 true 时，value 内容会完全受 setData 控制。 |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |
| adjustKeyboardTo | `boolean` | `false` | 否 | 键盘对齐位置 |
| onFocus | `CommonEventFunction<onFocusEventDetail>` |  | 否 | 输入框聚焦时触发 |
| onBlur | `CommonEventFunction<onBlurEventDetail>` |  | 否 | 输入框失去焦点时触发 |
| onLineChange | `CommonEventFunction<onLineChangeEventDetail>` |  | 否 | 输入框行数变化时调用 |
| onInput | `CommonEventFunction<onInputEventDetail>` |  | 否 | 当键盘输入时，触发 input 事件<br /><br />**onInput 处理函数的返回值并不会反映到 textarea 上** |
| onConfirm | `CommonEventFunction<onConfirmEventDetail>` |  | 否 | 点击完成时， 触发 confirm 事件 |
| onKeyboardHeightChange | `CommonEventFunction<onKeyboardHeightChangeEventDetail>` |  | 否 | 键盘高度发生变化的时候触发此事件 |
| onSelectionChange | `CommonEventFunction` |  | 否 | 选区改变事件, {selectionStart, selectionEnd} |
| onKeyboardCompositionStart | `CommonEventFunction` |  | 否 | 输入法开始新的输入时触发 （仅当输入法支持时触发） |
| onKeyboardCompositionUpdate | `CommonEventFunction` |  | 否 | 输入法输入字符时触发（仅当输入法支持时触发） |
| onKeyboardCompositionEnd | `CommonEventFunction` |  | 否 | 输入法输入结束时触发（仅当输入法支持时触发） |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| TextareaProps.value | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| TextareaProps.defaultValue | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| TextareaProps.placeholder | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| TextareaProps.placeholderStyle | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  | ✔️ |
| TextareaProps.placeholderClass | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| TextareaProps.disabled | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| TextareaProps.maxlength | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| TextareaProps.autoFocus | ✔️ | ✔️ |  |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |
| TextareaProps.focus | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| TextareaProps.autoHeight | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| TextareaProps.fixed | ✔️ | ✔️ |  |  | ✔️ | ✔️ |  |  |  |  |  |
| TextareaProps.cursorSpacing | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| TextareaProps.cursor | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| TextareaProps.showConfirmBar | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| TextareaProps.selectionStart | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |  |
| TextareaProps.selectionEnd | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |  |
| TextareaProps.adjustPosition | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| TextareaProps.holdKeyboard | ✔️ |  |  | ✔️ |  |  |  |  |  |  |  |
| TextareaProps.disableDefaultPadding | ✔️ |  |  | ✔️ |  |  |  |  |  |  |  |
| TextareaProps.nativeProps |  |  |  |  |  |  | ✔️ |  |  | ✔️ |  |
| TextareaProps.confirmType | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |  |  | ✔️ |
| TextareaProps.confirmHold | ✔️ | ✔️ |  | ✔️ |  |  |  |  |  |  |  |
| TextareaProps.name |  |  | ✔️ |  |  |  |  |  |  |  |  |
| TextareaProps.showCount |  |  | ✔️ |  |  |  |  |  |  |  |  |
| TextareaProps.controlled |  |  | ✔️ |  |  |  |  |  |  |  |  |
| TextareaProps.ariaLabel |  |  |  |  | ✔️ |  |  |  |  |  |  |
| TextareaProps.adjustKeyboardTo | ✔️ |  |  |  |  |  |  |  |  |  |  |
| TextareaProps.onFocus | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| TextareaProps.onBlur | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| TextareaProps.onLineChange | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |  |
| TextareaProps.onInput | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| TextareaProps.onConfirm | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| TextareaProps.onKeyboardHeightChange | ✔️ |  |  | ✔️ |  |  |  |  | ✔️ |  |  |
| TextareaProps.onSelectionChange | ✔️ |  |  |  |  |  |  |  |  |  |  |
| TextareaProps.onKeyboardCompositionStart | ✔️ |  |  |  |  |  |  |  |  |  |  |
| TextareaProps.onKeyboardCompositionUpdate | ✔️ |  |  |  |  |  |  |  |  |  |  |
| TextareaProps.onKeyboardCompositionEnd | ✔️ |  |  |  |  |  |  |  |  |  |  |

### onFocusEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | `string` | 输入值 |
| height | `number` | 键盘高度 |

### onBlurEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | `string` | 输入值 |
| cursor | `number` | 光标位置 |

### onLineChangeEventDetail

| 参数 | 类型 |
| --- | --- |
| height | `number` |
| heightRpx | `number` |
| lineCount | `number` |

### onInputEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | `string` | 输入值 |
| cursor | `number` | 光标位置 |
| keyCode | `number` | 键值 |

### onConfirmEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| value | `string` | 输入值 |

### onKeyboardHeightChangeEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| height | `number` | 键盘高度 |
| duration | `number` | 持续时间 |
</file>

<file path="docs/components/gesture/double-tap-gesture-handler.md">
---
title: DoubleTapGestureHandler
sidebar_label: DoubleTapGestureHandler
---

双击时触发手势
微信小程序下 skyline 的手势标签，只能在 CompileMode 中使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
ComponentType<DoubleTapGestureHandlerProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }]}>
<TabItem value="React">

```tsx
import { Component } from 'react'
import { View, DoubleTapGestureHandler } from '@tarojs/components'

export function Index () {
  return (
    <View compileMode>
      <DoubleTapGestureHandler onGestureWorklet="onGesture">
         <View className='circle'></View>
      </DoubleTapGestureHandler>
    </View>
  )
}
```
</TabItem>
</Tabs>

## DoubleTapGestureHandlerProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tag | `string` | 否 | 声明手势协商时的组件标识 |
| onGestureWorklet | `string` | 否 | 手势识别成功的回调 |
| shouldResponseOnMoveWorklet | `string` | 否 | 手指移动过程中手势是否响应 |
| shouldAcceptGestureWorklet | `string` | 否 | 手势是否应该被识别 |
| simultaneousHandlers | `string[]` | 否 | 声明可同时触发的手势节点 |
| nativeView | `string` | 否 | 代理的原生节点类型 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| DoubleTapGestureHandlerProps.tag | ✔️ |  |  |  |
| DoubleTapGestureHandlerProps.onGestureWorklet | ✔️ |  |  |  |
| DoubleTapGestureHandlerProps.shouldResponseOnMoveWorklet | ✔️ |  |  |  |
| DoubleTapGestureHandlerProps.shouldAcceptGestureWorklet | ✔️ |  |  |  |
| DoubleTapGestureHandlerProps.simultaneousHandlers | ✔️ |  |  |  |
| DoubleTapGestureHandlerProps.nativeView | ✔️ |  |  |  |
</file>

<file path="docs/components/gesture/force-press-gesture-handler.md">
---
title: ForcePressGestureHandler
sidebar_label: ForcePressGestureHandler
---

iPhone 设备重按时触发手势
微信小程序下 skyline 的手势标签，只能在 CompileMode 中使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
ComponentType<ForcePressGestureHandlerProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }]}>
<TabItem value="React">

```tsx
import { Component } from 'react'
import { View, ForcePressGestureHandler } from '@tarojs/components'

export function Index () {
  return (
    <View compileMode>
      <ForcePressGestureHandler onGestureWorklet="onGesture">
         <View className='circle'></View>
      </ForcePressGestureHandler>
    </View>
  )
}
```
</TabItem>
</Tabs>

## ForcePressGestureHandlerProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tag | `string` | 否 | 声明手势协商时的组件标识 |
| onGestureWorklet | `string` | 否 | 手势识别成功的回调 |
| shouldAcceptGestureWorklet | `string` | 否 | 手势是否应该被识别 |
| simultaneousHandlers | `string[]` | 否 | 声明可同时触发的手势节点 |
| nativeView | `string` | 否 | 代理的原生节点类型 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| ForcePressGestureHandlerProps.tag | ✔️ |  |  |  |
| ForcePressGestureHandlerProps.onGestureWorklet | ✔️ |  |  |  |
| ForcePressGestureHandlerProps.shouldAcceptGestureWorklet | ✔️ |  |  |  |
| ForcePressGestureHandlerProps.simultaneousHandlers | ✔️ |  |  |  |
| ForcePressGestureHandlerProps.nativeView | ✔️ |  |  |  |
</file>

<file path="docs/components/gesture/horizontal-drag-gesture-handler.md">
---
title: HorizontalDragGestureHandler
sidebar_label: HorizontalDragGestureHandler
---

横向滑动时触发手势
微信小程序下 skyline 的手势标签，只能在 CompileMode 中使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
ComponentType<HorizontalDragGestureHandlerProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }]}>
<TabItem value="React">

```tsx
import { Component } from 'react'
import { View, HorizontalDragGestureHandler } from '@tarojs/components'

export function Index () {
  return (
    <View compileMode>
      <HorizontalDragGestureHandler onGestureWorklet="onGesture">
         <View className='circle'></View>
      </HorizontalDragGestureHandler>
    </View>
  )
}
```
</TabItem>
</Tabs>

## HorizontalDragGestureHandlerProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tag | `string` | 否 | 声明手势协商时的组件标识 |
| onGestureWorklet | `string` | 否 | 手势识别成功的回调 |
| shouldResponseOnMoveWorklet | `string` | 否 | 手指移动过程中手势是否响应 |
| shouldAcceptGestureWorklet | `string` | 否 | 手势是否应该被识别 |
| simultaneousHandlers | `string[]` | 否 | 声明可同时触发的手势节点 |
| nativeView | `string` | 否 | 代理的原生节点类型 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| HorizontalDragGestureHandlerProps.tag | ✔️ |  |  |  |
| HorizontalDragGestureHandlerProps.onGestureWorklet | ✔️ |  |  |  |
| HorizontalDragGestureHandlerProps.shouldResponseOnMoveWorklet | ✔️ |  |  |  |
| HorizontalDragGestureHandlerProps.shouldAcceptGestureWorklet | ✔️ |  |  |  |
| HorizontalDragGestureHandlerProps.simultaneousHandlers | ✔️ |  |  |  |
| HorizontalDragGestureHandlerProps.nativeView | ✔️ |  |  |  |
</file>

<file path="docs/components/gesture/long-press-gesture-handler.md">
---
title: LongPressGestureHandler
sidebar_label: LongPressGestureHandler
---

长按时触发手势
微信小程序下 skyline 的手势标签，只能在 CompileMode 中使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
ComponentType<LongPressGestureHandlerProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }]}>
<TabItem value="React">

```tsx
import { Component } from 'react'
import { View, LongPressGestureHandler } from '@tarojs/components'

export function Index () {
  return (
    <View compileMode>
      <LongPressGestureHandler onGestureWorklet="onGesture">
         <View className='circle'></View>
      </LongPressGestureHandler>
    </View>
  )
}
```
</TabItem>
</Tabs>

## LongPressGestureHandlerProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tag | `string` | 否 | 声明手势协商时的组件标识 |
| onGestureWorklet | `string` | 否 | 手势识别成功的回调 |
| shouldResponseOnMoveWorklet | `string` | 否 | 手指移动过程中手势是否响应 |
| shouldAcceptGestureWorklet | `string` | 否 | 手势是否应该被识别 |
| simultaneousHandlers | `string[]` | 否 | 声明可同时触发的手势节点 |
| nativeView | `string` | 否 | 代理的原生节点类型 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| LongPressGestureHandlerProps.tag | ✔️ |  |  |  |
| LongPressGestureHandlerProps.onGestureWorklet | ✔️ |  |  |  |
| LongPressGestureHandlerProps.shouldResponseOnMoveWorklet | ✔️ |  |  |  |
| LongPressGestureHandlerProps.shouldAcceptGestureWorklet | ✔️ |  |  |  |
| LongPressGestureHandlerProps.simultaneousHandlers | ✔️ |  |  |  |
| LongPressGestureHandlerProps.nativeView | ✔️ |  |  |  |
</file>

<file path="docs/components/gesture/pan-gesture-handler.md">
---
title: PanGestureHandler
sidebar_label: PanGestureHandler
---

拖动（横向/纵向）时触发手势
微信小程序下 skyline 的手势标签，只能在 CompileMode 中使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
ComponentType<PanGestureHandlerProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }]}>
<TabItem value="React">

```tsx
import { Component } from 'react'
import { View, PanGestureHandler } from '@tarojs/components'

export function Index () {
  return (
    <View compileMode>
      <PanGestureHandler onGestureWorklet="onGesture">
         <View className='circle'></View>
      </PanGestureHandler>
    </View>
  )
}
```
</TabItem>
</Tabs>

## PanGestureHandlerProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tag | `string` | 否 | 声明手势协商时的组件标识 |
| onGestureWorklet | `string` | 否 | 手势识别成功的回调 |
| shouldResponseOnMoveWorklet | `string` | 否 | 手指移动过程中手势是否响应 |
| shouldAcceptGestureWorklet | `string` | 否 | 手势是否应该被识别 |
| simultaneousHandlers | `string[]` | 否 | 声明可同时触发的手势节点 |
| nativeView | `string` | 否 | 代理的原生节点类型 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| PanGestureHandlerProps.tag | ✔️ |  |  |  |
| PanGestureHandlerProps.onGestureWorklet | ✔️ |  |  |  |
| PanGestureHandlerProps.shouldResponseOnMoveWorklet | ✔️ |  |  |  |
| PanGestureHandlerProps.shouldAcceptGestureWorklet | ✔️ |  |  |  |
| PanGestureHandlerProps.simultaneousHandlers | ✔️ |  |  |  |
| PanGestureHandlerProps.nativeView | ✔️ |  |  |  |
</file>

<file path="docs/components/gesture/scale-gesture-handler.md">
---
title: ScaleGestureHandler
sidebar_label: ScaleGestureHandler
---

多指缩放时触发手势
微信小程序下 skyline 的手势标签，只能在 CompileMode 中使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
ComponentType<ScaleGestureHandlerProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }]}>
<TabItem value="React">

```tsx
import { Component } from 'react'
import { View, ScaleGestureHandler } from '@tarojs/components'

export function Index () {
  return (
    <View compileMode>
      <ScaleGestureHandler onGestureWorklet="onGesture">
         <View className='circle'></View>
      </ScaleGestureHandler>
    </View>
  )
}
```
</TabItem>
</Tabs>

## ScaleGestureHandlerProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tag | `string` | 否 | 声明手势协商时的组件标识 |
| onGestureWorklet | `string` | 否 | 手势识别成功的回调 |
| shouldResponseOnMoveWorklet | `string` | 否 | 手指移动过程中手势是否响应 |
| shouldAcceptGestureWorklet | `string` | 否 | 手势是否应该被识别 |
| simultaneousHandlers | `string[]` | 否 | 声明可同时触发的手势节点 |
| nativeView | `string` | 否 | 代理的原生节点类型 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| ScaleGestureHandlerProps.tag | ✔️ |  |  |  |
| ScaleGestureHandlerProps.onGestureWorklet | ✔️ |  |  |  |
| ScaleGestureHandlerProps.shouldResponseOnMoveWorklet | ✔️ |  |  |  |
| ScaleGestureHandlerProps.shouldAcceptGestureWorklet | ✔️ |  |  |  |
| ScaleGestureHandlerProps.simultaneousHandlers | ✔️ |  |  |  |
| ScaleGestureHandlerProps.nativeView | ✔️ |  |  |  |
</file>

<file path="docs/components/gesture/tap-gesture-handler.md">
---
title: TapGestureHandler
sidebar_label: TapGestureHandler
---

点击时触发手势
微信小程序下 skyline 的手势标签，只能在 CompileMode 中使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
ComponentType<TapGestureHandlerProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }]}>
<TabItem value="React">

```tsx
import { Component } from 'react'
import { View, TapGestureHandler } from '@tarojs/components'

export function Index () {
  return (
    <View compileMode>
      <TapGestureHandler onGestureWorklet="onGesture">
         <View className='circle'></View>
      </TapGestureHandler>
    </View>
  )
}
```
</TabItem>
</Tabs>

## TapGestureHandlerProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tag | `string` | 否 | 声明手势协商时的组件标识 |
| onGestureWorklet | `string` | 否 | 手势识别成功的回调 |
| shouldResponseOnMoveWorklet | `string` | 否 | 手指移动过程中手势是否响应 |
| shouldAcceptGestureWorklet | `string` | 否 | 手势是否应该被识别 |
| simultaneousHandlers | `string[]` | 否 | 声明可同时触发的手势节点 |
| nativeView | `string` | 否 | 代理的原生节点类型 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| TapGestureHandlerProps.tag | ✔️ |  |  |  |
| TapGestureHandlerProps.onGestureWorklet | ✔️ |  |  |  |
| TapGestureHandlerProps.shouldResponseOnMoveWorklet | ✔️ |  |  |  |
| TapGestureHandlerProps.shouldAcceptGestureWorklet | ✔️ |  |  |  |
| TapGestureHandlerProps.simultaneousHandlers | ✔️ |  |  |  |
| TapGestureHandlerProps.nativeView | ✔️ |  |  |  |
</file>

<file path="docs/components/gesture/vertical-drag-gesture-handler.md">
---
title: VerticalDragGestureHandler
sidebar_label: VerticalDragGestureHandler
---

纵向滑动时触发手势
微信小程序下 skyline 的手势标签，只能在 CompileMode 中使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
ComponentType<VerticalDragGestureHandlerProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }]}>
<TabItem value="React">

```tsx
import { Component } from 'react'
import { View, VerticalDragGestureHandler } from '@tarojs/components'

export function Index () {
  return (
    <View compileMode>
      <VerticalDragGestureHandler onGestureWorklet="onGesture">
         <View className='circle'></View>
      </VerticalDragGestureHandler>
    </View>
  )
}
```
</TabItem>
</Tabs>

## VerticalDragGestureHandlerProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| tag | `string` | 否 | 声明手势协商时的组件标识 |
| onGestureWorklet | `string` | 否 | 手势识别成功的回调 |
| shouldResponseOnMoveWorklet | `string` | 否 | 手指移动过程中手势是否响应 |
| shouldAcceptGestureWorklet | `string` | 否 | 手势是否应该被识别 |
| simultaneousHandlers | `string[]` | 否 | 声明可同时触发的手势节点 |
| nativeView | `string` | 否 | 代理的原生节点类型 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| VerticalDragGestureHandlerProps.tag | ✔️ |  |  |  |
| VerticalDragGestureHandlerProps.onGestureWorklet | ✔️ |  |  |  |
| VerticalDragGestureHandlerProps.shouldResponseOnMoveWorklet | ✔️ |  |  |  |
| VerticalDragGestureHandlerProps.shouldAcceptGestureWorklet | ✔️ |  |  |  |
| VerticalDragGestureHandlerProps.simultaneousHandlers | ✔️ |  |  |  |
| VerticalDragGestureHandlerProps.nativeView | ✔️ |  |  |  |
</file>

<file path="docs/components/maps/map.md">
---
title: Map
sidebar_label: Map
---

地图。相关api Taro.createMapContext。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/map.html#map)

## 类型

```tsx
ComponentType<MapProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Component {
  onTap () {}
  render () {
    return (
      <Map onClick={this.onTap} />
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <map
    id="map"
    style="width: 100%; height: 300px;"
    longitude="113.324520"
    latitude="23.099994"
    scale="14"
    :markers="markers"
    :polyline="polyline"
    :show-location="true"
    @regionchange="regionchange"
    @markertap="markertap"
  />
</template>

<script>
export default {
  data() {
    return {
      markers: [{
        iconPath: "https://avatars2.githubusercontent.com/u/1782542?s=460&u=d20514a52100ed1f82282bcfca6f49052793c889&v=4",
        id: 0,
        latitude: 23.099994,
        longitude: 113.324520,
        width: 50,
        height: 50
      }],
      polyline: [{
        points: [{
          longitude: 113.3245211,
          latitude: 23.10229
        }, {
          longitude: 113.324520,
          latitude: 23.21229
        }],
        color:"#FF0000DD",
        width: 2,
        dottedLine: true
      }]
    }
  },
  methods: {
    regionchange(e) {
      console.log(e.type)
    },
    markertap(e) {
      console.log("markertap:", e.detail.markerId)
    }
  }
}
</script>
```
</TabItem>
</Tabs>

## MapProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| longitude | `number` |  | 是 | 中心经度 |
| latitude | `number` |  | 是 | 中心纬度 |
| scale | `number` | `16` | 否 | 缩放级别，取值范围为 3-20 |
| minScale | `number` | `3` | 否 | 最小缩放级别 3-20 |
| maxScale | `number` | `20` | 否 | 最大缩放级别 3-20 |
| markers | `marker[]` |  | 否 | 标记点 |
| covers | `any[]` |  | 否 | **即将移除，请使用 markers**<br />**不推荐使用** |
| polyline | `polyline[]` |  | 否 | 路线 |
| circles | `circle[]` |  | 否 | 圆 |
| controls | `control[]` |  | 否 | 控件（即将废弃，建议使用 cover-view 代替）<br />**不推荐使用** |
| includePoints | `point[]` |  | 否 | 缩放视野以包含所有给定的坐标点 |
| showLocation | `boolean` | `false` | 否 | 显示带有方向的当前定位点 |
| polygons | `polygon[]` |  | 否 | 多边形 |
| subkey | `string` |  | 否 | 个性化地图使用的 key |
| layerStyle | `number` | `1` | 否 | 个性化地图配置的 style，不支持动态修改 |
| rotate | `number` | `0` | 否 | 旋转角度，范围 0 ~ 360, 地图正北和设备 y 轴角度的夹角 |
| skew | `number` | `0` | 否 | 倾斜角度，范围 0 ~ 40 , 关于 z 轴的倾角 |
| showCompass | `boolean` | `false` | 否 | 显示指南针 |
| showScale | `boolean` | `false` | 否 | 显示比例尺 |
| enableOverlooking | `boolean` | `false` | 否 | 开启俯视 |
| enableZoom | `boolean` | `true` | 否 | 是否支持缩放 |
| enableScroll | `boolean` | `true` | 否 | 是否支持拖动 |
| enableRotate | `boolean` | `false` | 否 | 是否支持旋转 |
| enableSatellite | `boolean` | `false` | 否 | 是否开启卫星图 |
| enableTraffic | `boolean` | `false` | 否 | 是否开启实时路况 |
| setting | MapProps or { [key: string]: any; } |  | 否 | 配置项<br /><br />提供 setting 对象统一设置地图配置。同时对于一些动画属性如 rotate 和 skew，通过 setData 分开设置时无法同时生效，需通过 settting 统一修改。 |
| includePadding | { left: string or number; right: string or number; top: string or number; bottom: string or number; } |  | 否 | 视野在地图 padding 范围内展示 |
| groundOverlays | `groundOverlays[]` |  | 否 | 覆盖物，自定义贴图 |
| tileOverlay | `tileOverlay` |  | 否 | 覆盖物，网格贴图 |
| enablePoi | `boolean` | `true` | 否 | 是否展示 POI 点 |
| enableBuilding | `boolean` | `true` | 否 | 是否展示建筑物 |
| polygon | `polygon[]` |  | 否 | 覆盖物，多边形。 |
| customMapStyle | `string` |  | 否 | 设置地图样式。<br /><br />default：默认样式<br />light：精简样式 |
| panels | `panels[]` |  | 否 | 基于 map 高级定制渲染，设置覆盖在地图上的 view。 |
| theme | `string` |  | 否 | 否 |
| optimize | `boolean` | `false` | 否 | 保持缩放比例不变 |
| enableAutoMaxOverlooking | `boolean` | `false` | 否 | 开启最大俯视角，俯视角度从 45 度拓展到 75 度 |
| enable3D | `boolean` | `false` | 否 | 展示3D楼块 |
| onTap | `CommonEventFunction` |  | 否 | 点击地图时触发 |
| onMarkerTap | `CommonEventFunction<onMarkerTapEventDetail>` |  | 否 | 点击标记点时触发，e.detail = {markerId} |
| onLabelTap | `CommonEventFunction<onLabelTapEventDetail>` |  | 否 | 点击label时触发，e.detail = {markerId} |
| onControlTap | `CommonEventFunction<onControlTapEventDetail>` |  | 否 | 点击控件时触发，e.detail = {controlId} |
| onCalloutTap | `CommonEventFunction<onCalloutTapEventDetail>` |  | 否 | 点击标记点对应的气泡时触发，e.detail = {markerId} |
| onUpdated | `CommonEventFunction` |  | 否 | 在地图渲染更新完成时触发 |
| onRegionChange | CommonEventFunction<onRegionEventDetail<"begin"> or onRegionEventDetail<"end">> |  | 否 | 视野发生变化时触发 |
| onPoiTap | `CommonEventFunction<onPoiTapEventDetail>` |  | 否 | 点击地图poi点时触发，e.detail = {name, longitude, latitude} |
| onPolylineTap | `CommonEventFunction<onPolylineTapEventDetail>` |  | 否 | 点击地图路线时触发，e.detail = {longitude, latitude} |
| onAbilitySuccess | `CommonEventFunction<onAbilityEventDetail>` |  | 否 | 地图能力生效时触发，e.detail = {ability, errCode, errMsg} |
| onAbilityFailed | `CommonEventFunction<onAbilityEventDetail>` |  | 否 | 地图能力失败时触发，e.detail = {ability, errCode, errMsg} |
| onAuthSuccess | `CommonEventFunction<{ errCode: number; errMsg: string; }>` |  | 否 | 地图鉴权结果成功时触发，e.detail = {errCode, errMsg} |
| onInterpolatePoint | `CommonEventFunction<onInterpolatePointEventDetail>` |  | 否 | MapContext.moveAlong 插值动画时触发。e.detail = {markerId, longitude, latitude, animationStatus: "interpolating" or "complete"} |
| onError | `CommonEventFunction<point>` |  | 是 | 组件错误时触发，例如创建或鉴权失败，e.detail = {longitude, latitude} |
| onCallOutTap | `CommonEventFunction<onCalloutTapEventDetail>` |  | 否 | 点击标记点对应的气泡时触发e.detail = {markerId} |
| onAnchorPointTap | `CommonEventFunction<point>` |  | 否 | 点击定位标时触发，e.detail = {longitude, latitude} |
| onPanelTap | `CommonEventFunction<{ panelId: any; layoutId: any; }>` |  | 否 | 点击 panel 时触发。 |
| onInitComplete | `CommonEventFunction` |  | 否 | 地图初始化完成即将开始渲染第一帧时触发。 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| MapProps.longitude | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
| MapProps.latitude | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
| MapProps.scale | ✔️ | ✔️(取值范围为4-21) | ✔️(取值范围为5-18) | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
| MapProps.minScale | ✔️ |  |  | ✔️ |  |  |  |  |  |  |
| MapProps.maxScale | ✔️ |  |  | ✔️ |  |  |  |  |  |  |
| MapProps.markers | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
| MapProps.covers | ✔️ |  |  |  |  |  |  |  |  |  |
| MapProps.polyline | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
| MapProps.circles | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
| MapProps.controls | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |  |  |  |
| MapProps.includePoints | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |
| MapProps.showLocation | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
| MapProps.polygons | ✔️ | ✔️ |  | ✔️ | ✔️ |  |  |  |  |  |
| MapProps.subkey | ✔️ |  |  |  | ✔️ |  |  |  |  |  |
| MapProps.layerStyle | ✔️ |  |  |  | ✔️ |  |  |  |  |  |
| MapProps.rotate | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| MapProps.skew | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| MapProps.showCompass | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| MapProps.showScale | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| MapProps.enableOverlooking | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| MapProps.enableZoom | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| MapProps.enableScroll | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| MapProps.enableRotate | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| MapProps.enableSatellite | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| MapProps.enableTraffic | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
| MapProps.setting | ✔️ |  | ✔️ |  | ✔️ |  |  |  |  |  |
| MapProps.includePadding |  |  | ✔️ |  |  |  |  |  |  |  |
| MapProps.groundOverlays |  |  | ✔️ |  |  |  |  |  |  |  |
| MapProps.tileOverlay |  |  | ✔️ |  |  |  |  |  |  |  |
| MapProps.enablePoi | ✔️ |  | ✔️ | ✔️ |  |  |  |  |  |  |
| MapProps.enableBuilding | ✔️ |  | ✔️ | ✔️ |  |  |  |  |  |  |
| MapProps.polygon |  |  | ✔️ |  |  |  |  |  |  |  |
| MapProps.customMapStyle |  |  | ✔️ |  |  |  |  |  |  |  |
| MapProps.panels |  |  | ✔️ |  |  |  |  |  |  |  |
| MapProps.theme |  |  |  |  |  | ✔️ |  |  |  |  |
| MapProps.optimize |  |  | ✔️ |  |  |  |  |  |  |  |
| MapProps.enableAutoMaxOverlooking | ✔️ |  |  |  |  |  |  |  |  |  |
| MapProps.enable3D | ✔️ | ✔️ |  | ✔️ | ✔️ |  |  |  |  |  |
| MapProps.onTap | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
| MapProps.onMarkerTap | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
| MapProps.onLabelTap | ✔️ |  |  | ✔️ |  |  |  |  |  |  |
| MapProps.onControlTap | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |  |  |  |
| MapProps.onCalloutTap |  |  | ✔️ |  |  |  |  |  |  | ✔️ |
| MapProps.onUpdated | ✔️ | ✔️ |  | ✔️ | ✔️ |  |  |  |  | ✔️ |
| MapProps.onRegionChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
| MapProps.onPoiTap | ✔️ | ✔️ |  |  | ✔️ |  |  |  |  |  |
| MapProps.onPolylineTap | ✔️ | ✔️ |  |  | ✔️ |  |  |  |  |  |
| MapProps.onAbilitySuccess | ✔️ |  |  |  |  |  |  |  |  |  |
| MapProps.onAbilityFailed | ✔️ |  |  |  |  |  |  |  |  |  |
| MapProps.onAuthSuccess | ✔️ |  |  |  |  |  |  |  |  |  |
| MapProps.onInterpolatePoint | ✔️ |  |  |  |  |  |  |  |  |  |
| MapProps.onError | ✔️ |  |  |  |  |  |  |  |  |  |
| MapProps.onCallOutTap | ✔️ | ✔️ |  | ✔️ |  | ✔️ |  |  |  | ✔️ |
| MapProps.onAnchorPointTap | ✔️ |  |  | ✔️ |  |  |  |  |  |  |
| MapProps.onPanelTap |  |  | ✔️ |  |  |  |  |  |  |  |
| MapProps.onInitComplete |  |  | ✔️ |  |  |  |  |  |  |  |

### marker

标记点用于在地图上显示标记的位置

| 参数 | 类型 | 必填 | 说明 | 备注 |
| --- | --- | :---: | --- | --- |
| id | `number` | 否 | 标记点id | `marker 点击事件回调会返回此id。建议为每个 marker 设置上 Number 类型 id，保证更新 marker 时有更好的性能。` |
| latitude | `number` | 是 | 纬度 | `浮点数，范围 -90 ~ 90` |
| longitude | `number` | 是 | 经度 | `浮点数，范围 -180 ~ 180` |
| title | `string` | 否 | 标注点名 | `点击时显示，callout 存在时将被忽略` |
| zIndex | `number` | 否 | 显示层级 |  |
| iconPath | `string` | 是 | 显示的图标 | `项目目录下的图片路径，支持相对路径写法，以'/'开头则表示相对小程序根目录；也支持临时路径和网络图片` |
| rotate | `number` | 否 | 旋转角度 | `顺时针旋转的角度，范围 0 ~ 360，默认为 0` |
| alpha | `number` | 否 | 标注的透明度 | `默认1，无透明，范围 0 ~ 1` |
| width | string or number | 否 | 标注图标宽度 | `默认为图片实际宽度` |
| height | string or number | 否 | 标注图标高度 | `默认为图片实际高度` |
| callout | `callout` | 否 | 标记点上方的气泡窗口 | `支持的属性见下表，可识别换行符。` |
| customCallout | `customCallout` | 否 | 自定义气泡窗口 | `支持的属性见下表，可识别换行符。` |
| label | `label` | 否 | 为标记点旁边增加标签 | `支持的属性见下表` |
| anchor | `{ x: number; y: number; }` | 否 | 经纬度在标注图标的锚点，默认底边中点 | `{x, y}，x表示横向(0-1)，y表示竖向(0-1)。{x: .5, y: 1} 表示底边中点` |
| ariaLabel | `string` | 否 | 无障碍访问，（属性）元素的额外描述 |  |

### callout

marker 上的气泡 callout

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| content | `string` | 文本 |
| color | `string` | 文本颜色 |
| fontSize | `number` | 文字大小 |
| anchorX | `number` | 横向偏移量，向右为正数 |
| anchorY | `number` | 纵向偏移量，向下为正数 |
| borderRadius | `number` | 边框圆角 |
| borderWidth | `number` | 边框宽度 |
| borderColor | `string` | 边框颜色 |
| bgColor | `string` | 背景色 |
| padding | `number` | 文本边缘留白 |
| display | "BYCLICK" or "ALWAYS" | 'BYCLICK':点击显示; 'ALWAYS':常显 |
| textAlign | "left" or "right" or "center" | 文本对齐方式。有效值: left, right, center |

### customCallout

marker 上的自定义气泡 customCallout

`customCallout` 存在时将忽略 `callout` 与 `title` 属性。自定义气泡采用采用 `cover-view` 定制，灵活度更高。

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| display | `string` | 'BYCLICK':点击显示; 'ALWAYS':常显 |
| anchorX | `number` | 横向偏移量，向右为正数 |
| anchorY | `number` | 纵向偏移量，向下为正数 |

### label

marker 上的气泡 label

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| content | `string` | 文本 |
| color | `string` | 文本颜色 |
| fontSize | `number` | 文字大小 |
| anchorX | `number` | label的坐标，原点是 marker 对应的经纬度 |
| anchorY | `number` | label的坐标，原点是 marker 对应的经纬度 |
| borderWidth | `number` | 边框宽度 |
| borderColor | `string` | 边框颜色 |
| borderRadius | `number` | 边框圆角 |
| bgColor | `string` | 背景色 |
| padding | `number` | 文本边缘留白 |
| textAlign | "left" or "right" or "center" | 文本对齐方式。有效值: left, right, center |

### polyline

指定一系列坐标点，从数组第一项连线至最后一项

| 参数 | 类型 | 必填 | 说明 | 备注 |
| --- | --- | :---: | --- | --- |
| points | `point[]` | 是 | 经纬度数组 | `[{latitude: 0, longitude: 0}]` |
| color | `string` | 否 | 线的颜色 | `十六进制` |
| width | `number` | 否 | 线的宽度 |  |
| dottedLine | `boolean` | 否 | 是否虚线 | `默认 false` |
| arrowLine | `boolean` | 否 | 带箭头的线 | `默认 false，开发者工具暂不支持该属性` |
| arrowIconPath | `string` | 否 | 更换箭头图标 | `在 arrowLine 为 true 时生效` |
| borderColor | `string` | 否 | 线的边框颜色 |  |
| borderWidth | `number` | 否 | 线的厚度 |  |

### polygon

指定一系列坐标点，根据 points 坐标数据生成闭合多边形

| 参数 | 类型 | 默认值 | 必填 | 说明 | 备注 |
| --- | --- | :---: | :---: | --- | --- |
| dashArray | `number[]` | `[0,0]` | 否 | 边线虚线 | `默认值 [0, 0] 为实线，[10, 10]表示十个像素的实线和十个像素的空白（如此反复）组成的虚线` |
| points | `point[]` |  | 是 | 经纬度数组 | `[{latitude: 0, longitude: 0}]` |
| color | `string` |  | 否 | 线的颜色，用 8 位十六进制表示，后两位表示 alpha 值，如：#eeeeeeAA。 | `当前 Android 与 iOS 上此属性默认值存在差异（分别为 transparent 与 #ff0000ff ），建议在代码中统一显式设置。` |
| strokeWidth | `number` |  | 否 | 描边的宽度 |  |
| strokeColor | `string` |  | 否 | 描边的颜色 | `十六进制` |
| fillColor | `string` |  | 否 | 填充颜色 | `十六进制` |
| width | `number` |  | 否 | 线的宽度 | `当前 Android 与 iOS 上此属性默认值存在差异（分别为 0 与 5），建议在代码中统一显式设置。` |
| zIndex | `number` |  | 否 | 设置多边形Z轴数值 |  |
| level | `string` |  | 否 | 压盖关系 | `默认为 abovelabels` |
| displayRanges | `[{ from: number; to: number; }]` |  | 否 | 标明在特定地图缩放级别下展示。 | `[{ from: 12, to: 17}]` |

#### API 支持度

| API | 微信小程序 | 支付宝小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| polygon.dashArray | ✔️ |  |  |  |  |
| polygon.color |  | ✔️ |  |  |  |
| polygon.width |  | ✔️ |  |  |  |
| polygon.level | ✔️ |  |  |  |  |
| polygon.displayRanges |  | ✔️ |  |  |  |

### circle

在地图上显示圆

| 参数 | 类型 | 必填 | 说明 | 备注 |
| --- | --- | :---: | --- | --- |
| latitude | `number` | 是 | 纬度 | `浮点数，范围 -90 ~ 90` |
| longitude | `number` | 否 | 经度 | `浮点数，范围 -180 ~ 180` |
| color | `string` | 否 | 描边的颜色 | `十六进制` |
| fillColor | `string` | 否 | 填充颜色 | `十六进制` |
| radius | `number` | 是 | 半径 |  |
| strokeWidth | `number` | 否 | 描边的宽度 |  |

### control

在地图上显示控件，控件不随着地图移动。即将废弃，请使用 cover-view

| 参数 | 类型 | 必填 | 说明 | 备注 |
| --- | --- | :---: | --- | --- |
| id | `number` | 否 | 控件id | `在控件点击事件回调会返回此id` |
| position | `position` | 是 | 控件在地图的位置 | `控件相对地图位置` |
| iconPath | `string` | 是 | 显示的图标 | `项目目录下的图片路径，支持本地路径、代码包路径` |
| clickable | `boolean` | 否 | 是否可点击 | `默认不可点击` |

### point

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| longitude | `number` | 经度 |
| latitude | `number` | 纬度 |

### position

| 参数 | 类型 | 默认值 | 说明 |
| --- | --- | :---: | --- |
| left | `number` | `0` | 距离地图的左边界多远 |
| top | `number` | `0` | 距离地图的上边界多远 |
| width | `number` | `图片宽度` | 控件宽度 |
| height | `number` | `图片宽度` | 控件高度 |

### groundOverlays

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `string` | 刷新的时候需要变更id值 |
| include-points | `[{ latitude: number; longitude: number; }, { latitude: number; longitude: number; }]` | 右上 左下 |
| image | `string` |  |
| alpha | `number` |  |
| zIndex | `number` |  |

### tileOverlay

| 参数 | 类型 |
| --- | --- |
| url | `string` |
| type | `number` |
| tileWidth | `number` |
| tileHeight | `number` |
| zIndex | `number` |

### panels

| 参数 | 类型 |
| --- | --- |
| id | `number` |
| layout | `{ src: string; }` |
| position | `position` |

### onMarkerTapEventDetail

| 参数 | 类型 |
| --- | --- |
| markerId | string or number |

### onLabelTapEventDetail

| 参数 | 类型 |
| --- | --- |
| markerId | string or number |

### onControlTapEventDetail

| 参数 | 类型 |
| --- | --- |
| controlId | string or number |

### onCalloutTapEventDetail

| 参数 | 类型 |
| --- | --- |
| markerId | string or number |

### RegionChangeDetail

#### type

#### CausedByBegin

| 参数 | 说明 |
| --- | --- |
| gesture | 手势触发 |
| update | 接口触发 |

#### CausedByEnd

| 参数 | 说明 |
| --- | --- |
| drag | 拖动导致 |
| scale | 缩放导致 |
| update | 调用更新接口导致 |

### onRegionEventDetail

| 参数 | 类型 | 说明 | 备注 |
| --- | --- | --- | --- |
| type | `T` | 视野变化开始、结束时触发 | `视野变化开始为begin，结束为end` |
| causedBy | `keyof (T extends "begin" ? CausedByBegin : CausedByEnd)` | 导致视野变化的原因 | `有效值为 gesture（手势触发）、update（接口触发或调用更新接口导致）、drag（拖动导致）、scale（缩放导致）` |
| detail | `regionChangeDetail<type>` | 视野改变详情 |  |

### regionChangeDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| rotate | `number` | 旋转角度 |
| skew | `number` | 倾斜角度 |
| causedBy | `keyof (T extends "begin" ? CausedByBegin : CausedByEnd)` |  |
| type | string or T |  |
| scale | `number` |  |
| centerLocation | `point` |  |
| region | `{ northeast: point; southeast: point; }` |  |

### onPoiTapEventDetail

| 参数 | 类型 |
| --- | --- |
| name | `string` |
| longitude | `number` |
| latitude | `number` |

### onPolylineTapEventDetail

| 参数 | 类型 |
| --- | --- |
| polylineId | `number` |
| longitude | `number` |
| latitude | `number` |

### onAbilityEventDetail

| 参数 | 类型 |
| --- | --- |
| ability | `string` |
| errCode | `number` |
| errMsg | `string` |

### onInterpolatePointEventDetail

| 参数 | 类型 |
| --- | --- |
| markerId | `number` |
| longitude | `number` |
| latitude | `number` |
| animationStatus | "interpolating" or "complete" |
</file>

<file path="docs/components/media/animation-video.md">
---
title: AnimationVideo
sidebar_label: AnimationVideo
---

透明视频动画

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/component/animation-video/)

## 类型

```tsx
ComponentType<AnimationVideoProps>
```

## AnimationVideoProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| resourceWidth | `number` | `800` | 否 | 组件使用的 video 视频资源的宽度（单位：px） |
| resourceHeight | `number` | `400` | 否 | 组件使用的 video 视频资源的高度（单位：px） |
| canvasStyle | `string` | `"width: 400px;height: 400px"` | 否 | 用于设置动画画布的 CSS 样式 |
| path | `string` |  | 否 | 动画资源地址，支持相对路径以及远程地址。如果是远程路径，注意 response header 里需要设置 Access-Control-Allow-Origin 来防止跨域问题 |
| loop | `boolean` | `false` | 否 | 动画是否循环播放 |
| autoplay | `boolean` | `false` | 否 | 动画是否自动播放 |
| alphaDirection | `string` | `"left"` | 否 | 视频资源中 alpha 通道的方向，left 表示 alpha 通道在资源的左边，right 表示 alpha 通道在资源的右边。详情请参考透明视频设计资源示例 |
| onStarted | `CommonEventFunction` |  | 否 | 动画开始播放的回调 |
| onEnded | `CommonEventFunction` |  | 否 | 当播放到末尾时触发 ended 事件（自然播放结束会触发回调，循环播放结束及暂停动画不会触发） |

### API 支持度

| API | 微信小程序 | 百度小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| AnimationVideoProps.resourceWidth |  | ✔️ |  |  |  |
| AnimationVideoProps.resourceHeight |  | ✔️ |  |  |  |
| AnimationVideoProps.canvasStyle |  | ✔️ |  |  |  |
| AnimationVideoProps.path |  | ✔️ |  |  |  |
| AnimationVideoProps.loop |  | ✔️ |  |  |  |
| AnimationVideoProps.autoplay |  | ✔️ |  |  |  |
| AnimationVideoProps.alphaDirection |  | ✔️ |  |  |  |
| AnimationVideoProps.onStarted |  | ✔️ |  |  |  |
| AnimationVideoProps.onEnded |  | ✔️ |  |  |  |
</file>

<file path="docs/components/media/animation-view.md">
---
title: AnimationView
sidebar_label: AnimationView
---

Lottie 动画

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/component/animation-view-Lottie/)

## 类型

```tsx
ComponentType<AnimationViewProps>
```

## AnimationViewProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| path | `string` |  | 否 | 动画资源地址，目前只支持绝对路径 |
| loop | `boolean` | `false` | 否 | 动画是否循环播放 |
| autoplay | `boolean` | `true` | 否 | 动画是否自动播放 |
| action | "play" or "pause" or "stop" | `"play"` | 否 | 动画操作，可取值 play、pause、stop |
| hidden | `boolean` | `true` | 否 | 是否隐藏动画 |
| onEnded | `CommonEventFunction` |  | 否 | 当播放到末尾时触发 ended 事件（自然播放结束会触发回调，循环播放结束及手动停止动画不会触发） |

### API 支持度

| API | 微信小程序 | 百度小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| AnimationViewProps.path |  | ✔️ |  |  |  |
| AnimationViewProps.loop |  | ✔️ |  |  |  |
| AnimationViewProps.autoplay |  | ✔️ |  |  |  |
| AnimationViewProps.action |  | ✔️ |  |  |  |
| AnimationViewProps.hidden |  | ✔️ |  |  |  |
| AnimationViewProps.onEnded |  | ✔️ |  |  |  |
</file>

<file path="docs/components/media/ar-camera.md">
---
title: ArCamera
sidebar_label: ArCamera
---

AR 相机

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/component/media_ar-camera/)

## 类型

```tsx
ComponentType<ArCameraProps>
```

## ArCameraProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| key | `string` |  | 否 | AR 项目唯一标识，在 DuMixAR 内容开放平台上传生成 AR 项目后获取 AR Key |
| type | "0" or "5" or "8" |  | 否 | AR 相机类型，在 DuMixAR 内容开放平台上传生成 AR 项目后获取 AR Type：<br />2D 跟踪类型：0<br />SLAM 类型：5<br />IMU 类型：8 |
| flash | "auto" or "on" or "off" | `"off"` | 否 | 闪光灯，值为 auto、on、off |
| onError | `CommonEventFunction` |  | 否 | 用户不允许使用摄像头或扫码失败时触发 |
| onLoad | `CommonEventFunction` |  | 否 | AR 加载成功时触发 |
| onMessage | `CommonEventFunction` |  | 否 | 开发者制作 AR 项目时可自定义按键，用户点击时会收到事件和数据，用户自定义事件格式参见代码示例 2：用户自定义事件 |
| onScanCode | `CommonEventFunction` |  | 否 | 扫描识图结束后触发 |

### API 支持度

| API | 微信小程序 | 百度小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| ArCameraProps.key |  | ✔️ |  |  |  |
| ArCameraProps.type |  | ✔️ |  |  |  |
| ArCameraProps.flash |  | ✔️ |  |  |  |
| ArCameraProps.onError |  | ✔️ |  |  |  |
| ArCameraProps.onLoad |  | ✔️ |  |  |  |
| ArCameraProps.onMessage |  | ✔️ |  |  |  |
| ArCameraProps.onScanCode |  | ✔️ |  |  |  |
</file>

<file path="docs/components/media/audio.md">
---
title: Audio
sidebar_label: Audio
---

音频。1.6.0版本开始，该组件不再维护。建议使用能力更强的 Taro.createInnerAudioContext 接口

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/audio.html)

## 类型

```tsx
ComponentType<AudioProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PageView extends Component {
  constructor() {
    super(...arguments)
  }

  render() {
    return (
      <View className='components-page'>
        <Audio
          src='https://ws.stream.qqmusic.qq.com/M500001VfvsJ21xFqb.mp3?guid=ffffffff82def4af4b12b3cd9337d5e7&uin=346897220&vkey=6292F51E1E384E06DCBDC9AB7C49FD713D632D313AC4858BACB8DDD29067D3C601481D36E62053BF8DFEAF74C0A5CCFADD6471160CAF3E6A&fromtag=46'
          controls={true}
          autoplay={false}
          loop={false}
          muted={true}
          initialTime='30'
          id='video'
        />
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="components-page">
    <audio
      id="video"
      src="https://ws.stream.qqmusic.qq.com/M500001VfvsJ21xFqb.mp3?guid=ffffffff82def4af4b12b3cd9337d5e7&uin=346897220&vkey=6292F51E1E384E06DCBDC9AB7C49FD713D632D313AC4858BACB8DDD29067D3C601481D36E62053BF8DFEAF74C0A5CCFADD6471160CAF3E6A&fromtag=46"
      :controls="true"
      :autoplay="false"
      :loop="false"
      :muted="true"
    />
  </view>
</template>
```
</TabItem>
</Tabs>

## AudioProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| id | `string` |  | 否 | audio 组件的唯一标识符 |
| src | `string` |  | 否 | 要播放音频的资源地址 |
| loop | `boolean` | `false` | 否 | 是否循环播放 |
| muted | `boolean` | `false` | 否 | 是否静音播放 |
| controls | `boolean` | `false` | 否 | 是否显示默认控件 |
| poster | `string` |  | 否 | 默认控件上的音频封面的图片资源地址，如果 controls 属性值为 false 则设置 poster 无效 |
| name | `string` | `"未知音频"` | 否 | 默认控件上的音频名字，如果 controls 属性值为 false 则设置 name 无效 |
| author | `string` | `"未知作者"` | 否 | 默认控件上的作者名字，如果 controls 属性值为 false 则设置 author 无效 |
| nativeProps | `Record<string, unknown>` |  | 否 | 用于透传 `WebComponents` 上的属性到内部 H5 标签上 |
| onError | `CommonEventFunction<onErrorEventDetail>` |  | 否 | 当发生错误时触发 error 事件，detail = {errMsg: MediaError.code} |
| onPlay | `CommonEventFunction` |  | 否 | 当开始/继续播放时触发play事件 |
| onPause | `CommonEventFunction` |  | 否 | 当暂停播放时触发 pause 事件 |
| onTimeUpdate | `CommonEventFunction<onTimeUpdateEventDetail>` |  | 否 | 当播放进度改变时触发 timeupdate 事件，detail = {currentTime, duration} |
| onEnded | `CommonEventFunction` |  | 否 | 当播放到末尾时触发 ended 事件 |

### API 支持度

| API | 微信小程序 | 百度小程序 | QQ 小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| AudioProps.id | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| AudioProps.src | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| AudioProps.loop | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| AudioProps.muted |  |  |  | ✔️ |  |  | ✔️ |  |
| AudioProps.controls | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| AudioProps.poster | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| AudioProps.name | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| AudioProps.author | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| AudioProps.nativeProps |  |  |  | ✔️ |  |  | ✔️ |  |
| AudioProps.onError | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| AudioProps.onPlay | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| AudioProps.onPause | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| AudioProps.onTimeUpdate | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| AudioProps.onEnded | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |

### onErrorEventDetail

| 参数 | 类型 |
| --- | --- |
| errMsg | `keyof Code` |

### onTimeUpdateEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| currentTime | `number` | 当前时间 |
| duration | `number` | 持续时间 |

### MediaError

#### Code

| 参数 | 说明 |
| --- | --- |
| 1 | 获取资源被用户禁止 |
| 2 | 网络错误 |
| 3 | 解码错误 |
| 4 | 不合适资源 |
</file>

<file path="docs/components/media/camera.md">
---
title: Camera
sidebar_label: Camera
---

系统相机

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/camera.html)

## 类型

```tsx
ComponentType<CameraProps>
```

## CameraProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| mode | `keyof Mode` | `"normal"` | 否 | 模式，有效值为normal, scanCode |
| resolution | `keyof Resolution` | `"medium"` | 否 | 分辨率，不支持动态修改 |
| devicePosition | `keyof DevicePosition` | `"back"` | 否 | 摄像头朝向 |
| flash | `keyof Flash` | `"auto"` | 否 | 闪光灯 |
| frameSize | `keyof FrameSize` | `"medium"` | 否 | 指定期望的相机帧数据尺寸 |
| outputDimension | "360P" or "540P" or "720P" or "1080P" or "max" | `"720P"` | 否 | 相机拍照，录制的分辨率。 |
| onStop | `CommonEventFunction` |  | 否 | 摄像头在非正常终止时触发，<br />如退出后台等情况 |
| onError | `CommonEventFunction` |  | 否 | 用户不允许使用摄像头时触发 |
| onInitDone | `CommonEventFunction<onInitDoneEventDetail>` |  | 否 | 相机初始化完成时触发 |
| onReady | `CommonEventFunction<onInitDoneEventDetail>` |  | 否 | 相机初始化成功时触发。 |
| onScanCode | `CommonEventFunction<onScanCodeEventDetail>` |  | 否 | 在成功识别到一维码时触发，<br />仅在 mode="scanCode" 时生效 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| CameraProps.mode | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |
| CameraProps.resolution | ✔️ |  |  | ✔️ |  |  |  |  |  |  |
| CameraProps.devicePosition | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| CameraProps.flash | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| CameraProps.frameSize | ✔️ |  | ✔️ | ✔️ |  |  |  |  |  |  |
| CameraProps.outputDimension |  |  | ✔️ |  |  |  |  |  |  |  |
| CameraProps.onStop | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| CameraProps.onError | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  | ✔️ |
| CameraProps.onInitDone | ✔️ |  |  | ✔️ |  |  |  | ✔️ |  | ✔️ |
| CameraProps.onReady |  |  | ✔️ |  |  |  |  |  |  |  |
| CameraProps.onScanCode | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |  |

### Mode

mode 的合法值

| 参数 | 说明 |
| --- | --- |
| normal | 相机模式 |
| scanCode | 扫码模式 |

### Resolution

resolution 的合法值

| 参数 | 说明 |
| --- | --- |
| low | 低 |
| medium | 中 |
| high | 高 |

### DevicePosition

device-position 的合法值

| 参数 | 说明 |
| --- | --- |
| front | 前置 |
| back | 后置 |

### Flash

flash 的合法值

| 参数 | 说明 |
| --- | --- |
| auto | 自动 |
| on | 打开 |
| off | 关闭 |
| torch | 常亮 |

### FrameSize

frame-size 的合法值

| 参数 | 说明 |
| --- | --- |
| small | 小尺寸帧数据 |
| medium | 中尺寸帧数据 |
| large | 大尺寸帧数据 |

### onInitDoneEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| maxZoom | `number` | 最大变焦 |

### onScanCodeEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| charSet | `string` | 字符集 |
| rawData | `string` | 原始数据 |
| type | `string` | 码类型 |
| result | `string` | 识别结果 |
| fullResult | `string` | 识别结果(完整) |

#### API 支持度

| API | 微信小程序 | 支付宝小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| onScanCodeEventDetail.rawData | ✔️ |  |  |  |  |  |
| onScanCodeEventDetail.fullResult |  | ✔️ |  |  |  |  |
</file>

<file path="docs/components/media/channel-live.md">
---
title: ChannelLive
sidebar_label: ChannelLive
---

小程序内嵌视频号直播组件，展示视频号直播状态和封面，并无弹窗跳转至视频号。注意：使用该组件打开的视频号视频需要与小程序的主体一致。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/channel-live.html)

## 类型

```tsx
ComponentType<ChannelLiveProps>
```

## ChannelLiveProps

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| feedId | `string` | 视频 feedId |
| finderUserName | `string` | 视频号 id，以“sph”开头的id，可在视频号助手获取。视频号必须与当前小程序相同主体。 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| ChannelLiveProps.feedId | ✔️ |  |  |  |
| ChannelLiveProps.finderUserName | ✔️ |  |  |  |
</file>

<file path="docs/components/media/channel-video.md">
---
title: ChannelVideo
sidebar_label: ChannelVideo
---

小程序内嵌视频号视频组件，支持在小程序中播放视频号视频，并无弹窗跳转至视频号。注意：使用该组件打开的视频号视频需要与小程序相同主体或关联主体。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/channel-video.html)

## 类型

```tsx
ComponentType<ChannelVideoProps>
```

## ChannelVideoProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| feedId | `string` |  | 是 | 仅视频号视频与小程序同主体时生效。若内嵌非同主体视频，请使用 feed-token。 |
| finderUserName | `string` |  | 是 | 视频号 id，以“sph”开头的id，可在视频号助手获取。视频号必须与当前小程序相同主体。 |
| loop | `boolean` | `false` | 否 | 是否循环播放 |
| muted | `boolean` | `false` | 否 | 是否静音播放 |
| objectFit | "fill" or "contain" or "cover" | `"contain"` | 否 | 当视频大小与 video 容器大小不一致时，视频的表现形式 |
| autoplay | `boolean` | `false` | 否 | 是否自动播放 |
| feedToken | `string` |  | 否 | 仅内嵌小程序非同主体视频号视频时使用，获取方式参考[本指引](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/channels-activity.html#feed-token)。 |
| onError | `CommonEventFunction` |  | 否 | 视频播放出错时触发 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| ChannelVideoProps.feedId | ✔️ |  |  |  |
| ChannelVideoProps.finderUserName | ✔️ |  |  |  |
| ChannelVideoProps.loop | ✔️ |  |  |  |
| ChannelVideoProps.muted | ✔️ |  |  |  |
| ChannelVideoProps.objectFit | ✔️ |  |  |  |
| ChannelVideoProps.autoplay | ✔️ |  |  |  |
| ChannelVideoProps.feedToken | ✔️ |  |  |  |
| ChannelVideoProps.onError | ✔️ |  |  |  |
</file>

<file path="docs/components/media/image.md">
---
title: Image
sidebar_label: Image
---

图片。支持 JPG、PNG、SVG、WEBP、GIF 等格式以及云文件ID。

**Note:** 为实现小程序的 `mode` 特性，在 H5 组件中使用一个 `div` 容器来对内部的 `img` 进行展示区域的裁剪，因此请勿使用元素选择器来重置 `img` 的样式！

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/image.html)

## 类型

```tsx
ComponentType<ImageProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PageView extends Component {
  constructor() {
    super(...arguments)
  }

  render() {
    return (
      <View className='components-page'>
        <Image
          style='width: 300px;height: 100px;background: #fff;'
          src='nerv_logo.png'
        />
        <Image
          style='width: 300px;height: 100px;background: #fff;'
          src='https://camo.githubusercontent.com/3e1b76e514b895760055987f164ce6c95935a3aa/687474703a2f2f73746f726167652e333630627579696d672e636f6d2f6d74642f686f6d652f6c6f676f2d3278313531333833373932363730372e706e67'
        />
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="components-page">
    <image
      style="width: 300px;height: 100px;background: #fff;"
      src="nerv_logo.png"
    />
    <image
      style="width: 300px;height: 100px;background: #fff;"
      src="https://camo.githubusercontent.com/3e1b76e514b895760055987f164ce6c95935a3aa/687474703a2f2f73746f726167652e333630627579696d672e636f6d2f6d74642f686f6d652f6c6f676f2d3278313531333833373932363730372e706e67"
    />
  </view>
</template>
```
</TabItem>
</Tabs>

## ImageProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| src | `string` |  | 是 | 图片资源地址 |
| mode | `keyof Mode` | `"scaleToFill"` | 否 | 图片裁剪、缩放的模式 |
| webp | `boolean` | `false` | 否 | 默认不解析 webP 格式，只支持网络资源 |
| svg | `boolean` | `false` | 否 | 默认不解析 svg 格式，svg 图片只支持 aspectFit |
| lazyLoad | `boolean` | `false` | 否 | 图片懒加载。只针对 page 与 scroll-view 下的 image 有效 |
| showMenuByLongpress | `boolean` | `false` | 否 | 开启长按图片显示识别小程序码菜单 |
| imgProps | `ImgHTMLAttributes<HTMLImageElement>` |  | 否 | 为 img 标签额外增加的属性 |
| nativeProps | `Record<string, unknown>` |  | 否 | 用于透传 `WebComponents` 上的属性到内部 H5 标签上 |
| defaultSource | `string` |  | 否 | 默认图片地址，若设置默认图片地址，会先显示默认图片，等 src 对应的图片加载成功后，再渲染对应的图片。 |
| imageMenuPrevent | `string` |  | 否 | 阻止长按图片时弹起默认菜单（即将该属性设置为image-menu-prevent="true"或image-menu-prevent），只在初始化时有效，不能动态变更；若不想阻止弹起默认菜单，则不需要设置此属性。注：长按菜单后的操作暂不支持 svg 格式 |
| preview | `string` |  | 否 | 点击后是否预览图片。在不设置的情况下，若 image 未监听点击事件且宽度大于 1/4 屏宽，则默认开启 |
| originalSrc | `string` |  | 否 | 预览时显示的图片地址 |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |
| fadeIn | `boolean` | `false` | 否 | 是否渐显 |
| onError | `CommonEventFunction<onErrorEventDetail>` |  | 否 | 当错误发生时，发布到 AppService 的事件名，事件对象 |
| onLoad | `CommonEventFunction<onLoadEventDetail>` |  | 否 | 当图片载入完毕时，发布到 AppService 的事件名，事件对象 |
| onTap | `CommonEventFunction` |  | 否 | 点击图片时触发。 |
| catchTap | `CommonEventFunction` |  | 否 | 点击图片时触发，阻止事件冒泡。 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| ImageProps.src | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| ImageProps.mode | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️(部分支持 scaleToFill, aspectFit, aspectFill, widthFix) | ✔️(部分支持 scaleToFill, aspectFit, aspectFill, widthFix, heightFix) | ✔️ | ✔️ |
| ImageProps.webp | ✔️ | ✔️ |  |  |  |  |  |  |  |  |  |
| ImageProps.svg |  |  |  |  |  |  |  | ✔️ |  |  |  |
| ImageProps.lazyLoad | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  | ✔️ | ✔️ |
| ImageProps.showMenuByLongpress | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ImageProps.imgProps |  |  |  |  |  |  | ✔️ |  |  | ✔️ |  |
| ImageProps.nativeProps |  |  |  |  |  |  | ✔️ |  |  | ✔️ |  |
| ImageProps.defaultSource |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ImageProps.imageMenuPrevent |  | ✔️ |  |  |  |  |  |  |  |  |  |
| ImageProps.preview |  | ✔️ |  |  |  |  |  |  |  |  |  |
| ImageProps.originalSrc |  | ✔️ |  |  |  |  |  |  |  |  |  |
| ImageProps.ariaLabel |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ImageProps.fadeIn | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ImageProps.onError | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ImageProps.onLoad | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ImageProps.onTap |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ImageProps.catchTap |  |  | ✔️ |  |  |  |  |  |  |  |  |

### Mode

mode 的合法值

| 参数 | 说明 |
| --- | --- |
| scaleToFill | 缩放模式，不保持纵横比缩放图片，使图片的宽高完全拉伸至填满 image 元素 |
| aspectFit | 缩放模式，保持纵横比缩放图片，使图片的长边能完全显示出来。也就是说，可以完整地将图片显示出来。 |
| aspectFill | 缩放模式，保持纵横比缩放图片，只保证图片的短边能完全显示出来。也就是说，图片通常只在水平或垂直方向是完整的，另一个方向将会发生截取。 |
| widthFix | 缩放模式，宽度不变，高度自动变化，保持原图宽高比不变 |
| heightFix | 缩放模式，高度不变，宽度自动变化，保持原图宽高比不变 |
| top | 裁剪模式，不缩放图片，只显示图片的顶部区域 |
| bottom | 裁剪模式，不缩放图片，只显示图片的底部区域 |
| center | 裁剪模式，不缩放图片，只显示图片的中间区域 |
| left | 裁剪模式，不缩放图片，只显示图片的左边区域 |
| right | 裁剪模式，不缩放图片，只显示图片的右边区域 |
| top left | 裁剪模式，不缩放图片，只显示图片的左上边区域 |
| top right | 裁剪模式，不缩放图片，只显示图片的右上边区域 |
| bottom left | 裁剪模式，不缩放图片，只显示图片的左下边区域 |
| bottom right | 裁剪模式，不缩放图片，只显示图片的右下边区域 |

### onErrorEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |

### onLoadEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| height | string or number | 图片高度 |
| width | string or number | 图片宽度 |
</file>

<file path="docs/components/media/live-player.md">
---
title: LivePlayer
sidebar_label: LivePlayer
---

实时音视频播放。相关api：Taro.createLivePlayerContext

需要先通过类目审核，再在小程序管理后台，“设置”-“接口设置”中自助开通该组件权限。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/live-player.html)

## 类型

```tsx
ComponentType<LivePlayerProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Components {
  render () {
    return (
      <LivePlayer src='url' mode='live' autoplay  />
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <live-player src="url" mode="live" :autoplay="true"  />
</template>
```
</TabItem>
</Tabs>

## LivePlayerProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| src | `string` |  | 否 | 音视频地址。目前仅支持 flv, rtmp 格式 |
| mode | `keyof Mode` | `"live"` | 否 | 模式 |
| autoplay | `boolean` | `false` | 否 | 自动播放 |
| muted | `boolean` | `false` | 否 | 是否静音 |
| orientation | `keyof Orientation` | `"vertical"` | 否 | 画面方向 |
| objectFit | `keyof objectFit` | `"contain"` | 否 | 填充模式 |
| backgroundMute | `boolean` | `false` | 否 | 进入后台时是否静音（已废弃，默认退台静音）<br />**不推荐使用** |
| minCache | `number` | `1` | 否 | 最小缓冲区，单位s |
| maxCache | `number` | `3` | 否 | 最大缓冲区，单位s |
| soundMode | `keyof soundMode` | `"speaker"` | 否 | 声音输出方式 |
| autoPauseIfNavigate | `boolean` | `true` | 否 | 当跳转到本小程序的其他页面时，是否自动暂停本页面的实时音视频播放 |
| pictureInPictureMode | "" or "push" or "pop" or ("push" or "pop")[] |  | 否 | 设置小窗模式： push, pop，空字符串或通过数组形式设置多种模式（如： ["push", "pop"]） |
| autoPauseIfOpenNative | `boolean` | `true` | 否 | 当跳转到其它微信原生页面时，是否自动暂停本页面的实时音视频播放 |
| referrerPolicy | "origin" or "no-referrer" | `'no-referrer'` | 否 | 格式固定为 https://servicewechat.com/{appid}/{version}/page-frame.html ，其中 {appid} 为小程序的 appid，{version} 为小程序的版本号，版本号为 0 表示为开发版、体验版以及审核版本，版本号为 devtools 表示为开发者工具，其余为正式版本； |
| signature | `string` |  | 否 | 设置署名水印 |
| enableMetadata | `string` |  | 否 | 是否回调metadata |
| id | `string` |  | 否 | live-player 属性的唯一标志符 |
| enableAutoRotation | `boolean` | `false` | 否 | 是否开启手机横屏时自动全屏，当系统设置开启自动旋转时生效 |
| enableCasting | `boolean` | `false` | 否 | 是否支持投屏。开启后，可以通过 LivePlayerContext 上相关方法进行操作。 |
| onStateChange | `CommonEventFunction<onStateChangeEventDetail>` |  | 否 | 播放状态变化事件，detail = {code} |
| onFullScreenChange | `CommonEventFunction<onFullScreenChangeEventDetail>` |  | 否 | 全屏变化事件，detail = {direction, fullScreen} |
| onNetStatus | `CommonEventFunction<onNetStatusEventDetail>` |  | 否 | 网络状态通知，detail = {info} |
| onAudioVolumeNotify | `CommonEventFunction<{}>` |  | 否 | 播放音量大小通知，detail = {} |
| onEnterPictureInPicture | `CommonEventFunction` |  | 否 | 播放器进入小窗 |
| onLeavePictureInPicture | `CommonEventFunction` |  | 否 | 播放器退出小窗 |
| onError | `CommonEventFunction` |  | 否 | 播放错误事件 |
| onMetaDataChange | `CommonEventFunction` |  | 否 | metadata通知，detail = {info} |
| onCastingUserSelect | CommonEventFunction<{ state: "success" or "fail"; }> |  | 否 | 用户选择投屏设备时触发 detail = { state: "success"/"fail" } |
| onCastingStateChange | CommonEventFunction<{ type: any; state: "success" or "fail"; }> |  | 否 | 投屏成功/失败时触发 detail = { type, state: "success"/"fail" } |
| onCastingInterrupt | `CommonEventFunction` |  | 否 | 投屏被中断时触发 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| LivePlayerProps.src | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |
| LivePlayerProps.mode | ✔️ |  |  | ✔️ | ✔️ |  |  |  |
| LivePlayerProps.autoplay | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |
| LivePlayerProps.muted | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |
| LivePlayerProps.orientation | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |
| LivePlayerProps.objectFit | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |
| LivePlayerProps.backgroundMute | ✔️ | ✔️ |  |  |  |  |  |  |
| LivePlayerProps.minCache | ✔️ | ✔️ |  | ✔️ |  |  |  |  |
| LivePlayerProps.maxCache | ✔️ | ✔️ |  | ✔️ |  |  |  |  |
| LivePlayerProps.soundMode | ✔️ |  |  | ✔️ | ✔️ |  |  |  |
| LivePlayerProps.autoPauseIfNavigate | ✔️ |  |  | ✔️ |  |  |  |  |
| LivePlayerProps.pictureInPictureMode | ✔️ |  |  |  |  |  |  |  |
| LivePlayerProps.autoPauseIfOpenNative | ✔️ |  |  | ✔️ |  |  |  |  |
| LivePlayerProps.referrerPolicy | ✔️ |  |  |  |  |  |  |  |
| LivePlayerProps.signature |  |  | ✔️ |  |  |  |  |  |
| LivePlayerProps.enableMetadata |  |  |  | ✔️ |  |  |  |  |
| LivePlayerProps.id |  | ✔️ |  |  |  |  |  |  |
| LivePlayerProps.enableAutoRotation | ✔️ |  |  |  |  |  |  |  |
| LivePlayerProps.enableCasting | ✔️ |  |  |  |  |  |  |  |
| LivePlayerProps.onStateChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |
| LivePlayerProps.onFullScreenChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |
| LivePlayerProps.onNetStatus | ✔️ | ✔️ |  | ✔️ |  |  |  |  |
| LivePlayerProps.onAudioVolumeNotify | ✔️ |  |  |  |  |  |  |  |
| LivePlayerProps.onEnterPictureInPicture | ✔️ |  |  |  |  |  |  |  |
| LivePlayerProps.onLeavePictureInPicture | ✔️ |  |  |  |  |  |  |  |
| LivePlayerProps.onError |  |  | ✔️ |  |  |  |  |  |
| LivePlayerProps.onMetaDataChange |  |  |  | ✔️ |  |  |  |  |
| LivePlayerProps.onCastingUserSelect | ✔️ |  |  |  |  |  |  |  |
| LivePlayerProps.onCastingStateChange | ✔️ |  |  |  |  |  |  |  |
| LivePlayerProps.onCastingInterrupt | ✔️ |  |  |  |  |  |  |  |

### Mode

mode 的合法值

| 参数 | 说明 |
| --- | --- |
| live | 直播 |
| RTC | 实时通话，该模式时延更低 |

### Orientation

orientation 的合法值

| 参数 | 说明 |
| --- | --- |
| vertical | 竖直 |
| horizontal | 水平 |

### objectFit

objectFit 的合法值

| 参数 | 说明 |
| --- | --- |
| contain | 图像长边填满屏幕，短边区域会被填充⿊⾊ |
| fillCrop | 图像铺满屏幕，超出显示区域的部分将被截掉 |

### soundMode

soundMode 的合法值

| 参数 | 说明 |
| --- | --- |
| speaker | 扬声器 |
| ear | 听筒 |

### onStateChangeEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| code | `number` | 状态码 |

### onFullScreenChangeEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| direction | `number` | 方向 |
| fullScreen | number or boolean | 全屏 |

### onNetStatusEventDetail

| 参数 | 类型 |
| --- | --- |
| info | `NetStatus` |

### Status

状态码

| 参数 | 说明 |
| --- | --- |
| 2001 | 已经连接服务器 |
| 2002 | 已经连接 RTMP 服务器,开始拉流 |
| 2003 | 网络接收到首个视频数据包(IDR) |
| 2004 | 视频播放开始 |
| 2005 | 视频播放进度 |
| 2006 | 视频播放结束 |
| 2007 | 视频播放Loading |
| 2008 | 解码器启动 |
| 2009 | 视频分辨率改变 |
| -2301 | 网络断连，且经多次重连抢救无效，更多重试请自行重启播放 |
| -2302 | 获取加速拉流地址失败 |
| 2101 | 当前视频帧解码失败 |
| 2102 | 当前音频帧解码失败 |
| 2103 | 网络断连, 已启动自动重连 |
| 2104 | 网络来包不稳：可能是下行带宽不足，或由于主播端出流不均匀 |
| 2105 | 当前视频播放出现卡顿 |
| 2106 | 硬解启动失败，采用软解 |
| 2107 | 当前视频帧不连续，可能丢帧 |
| 2108 | 当前流硬解第一个I帧失败，SDK自动切软解 |
| 3001 | RTMP -DNS解析失败 |
| 3002 | RTMP服务器连接失败 |
| 3003 | RTMP服务器握手失败 |
| 3005 | RTMP 读/写失败 |
</file>

<file path="docs/components/media/live-pusher.md">
---
title: LivePusher
sidebar_label: LivePusher
---

实时音视频录制。需要用户授权 scope.camera、scope.record
需要先通过类目审核，再在小程序管理后台，「开发」-「接口设置」中自助开通该组件权限。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/live-pusher.html)

## 类型

```tsx
ComponentType<LivePusherProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Components {
  render () {
    return (
      <LivePusher url='url' mode='RTC' autopush  />
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <live-pusher url="url" mode="RTC" :autopush="true"  />
</template>
```
</TabItem>
</Tabs>

## LivePusherProps

实时音视频录制。
需要用户授权 scope.camera、scope.record
暂只针对国内主体如下类目的小程序开放，需要先通过类目审核，再在小程序管理后台，“设置”-“接口设置”中自助开通该组件权限。

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| url | `string` |  | 否 | 推流地址。目前仅支持 rtmp 格式 |
| mode | "SD" or "HD" or "FHD" or "RTC" | `"RTC"` | 否 | SD（标清）, HD（高清）, FHD（超清）, RTC（实时通话） |
| autopush | `boolean` | `false` | 否 | 自动推流 |
| enableVideoCustomRender | `boolean` | `false` | 否 | 自定义渲染，允许开发者自行处理所采集的视频帧 |
| muted | `boolean` | `false` | 否 | 是否静音。即将废弃，可用 enable-mic 替代<br />**不推荐使用** |
| enableCamera | `boolean` | `true` | 否 | 开启摄像头 |
| autoFocus | `boolean` | `true` | 否 | 自动聚集 |
| orientation | `keyof Orientation` | `"vertical"` | 否 | 画面方向 |
| beauty | `number` | `0` | 否 | 美颜，取值范围 0-9 ，0 表示关闭 |
| whiteness | `number` | `0` | 否 | 美白，取值范围 0-9 ，0 表示关闭 |
| aspect | "9:16" or "3:4" | `"9:16"` | 否 | 宽高比，可选值有 3:4, 9:16 |
| minBitrate | `number` | `200` | 否 | 最小码率 |
| maxBitrate | `number` | `1000` | 否 | 最大码率 |
| audioQuality | `string` | `"high"` | 否 | 高音质(48KHz)或低音质(16KHz)，值为high, low |
| waitingImage | `string` |  | 否 | 进入后台时推流的等待画面 |
| waitingImageHash | `string` |  | 否 | 等待画面资源的MD5值 |
| zoom | `boolean` | `false` | 否 | 调整焦距 |
| devicePosition | `string` | `"front"` | 否 | 前置或后置，值为front, back |
| backgroundMute | `boolean` | `false` | 否 | 进入后台时是否静音 |
| mirror | `boolean` | `false` | 否 | 设置推流画面是否镜像，产生的效果在 LivePlayer 反应到 |
| remoteMirror | `boolean` | `false` | 否 | 设置推流画面是否镜像，产生的效果在 LivePlayer 反应到<br /><br />**Note:** 同 mirror 属性，后续 mirror 将废弃 |
| localMirror | `keyof LocalMirror` | `"auto"` | 否 | 控制本地预览画面是否镜像 |
| audioReverbType | `keyof AudioReverbType` | `0` | 否 | 音频混响类型 |
| enableMic | `boolean` | `true` | 否 | 开启或关闭麦克风 |
| enableAgc | `boolean` | `false` | 否 | 是否开启音频自动增益 |
| enableAns | `boolean` | `false` | 否 | 是否开启音频噪声抑制 |
| audioVolumeType | `keyof AudioVolumeType` | `"voicecall"` | 否 | 音量类型 |
| videoWidth | `number` | `360` | 否 | 上推的视频流的分辨率宽度 |
| videoHeight | `number` | `640` | 否 | 上推的视频流的分辨率高度 |
| beautyStyle | `keyof BeautyStyleType` | `smooth` | 否 | 设置美颜类型 |
| filter | `keyof FilterType` | `standard` | 否 | 设置色彩滤镜 |
| pictureInPictureMode | string or any[] |  | 否 | 设置小窗模式： push, pop，空字符串或通过数组形式设置多种模式（如： ["push", "pop"]） |
| customEffect | `boolean` | `false` | 否 | 是否启动自定义特效，设定后不能更改 |
| skinWhiteness | `number` | `0` | 否 | 自定义特效美白效果，取值 0~1。需要开启 custom-effect |
| skinSmoothness | `number` | `0` | 否 | 自定义特效磨皮效果，取值 0~1。需要开启 custom-effect |
| faceThinness | `number` | `0` | 否 | 自定义特效瘦脸效果，取值 0~1。需要开启 custom-effect |
| eyeBigness | `number` | `0` | 否 | 自定义特效大眼效果，取值 0~1。需要开启 custom-effect |
| voiceChangerType | `number` | `0` | 否 | 0：关闭变声；1：熊孩子；2：萝莉；3：大叔；4：重金属；6：外国人；7：困兽；8：死肥仔；9：强电流；10：重机械；11：空灵 |
| fps | `number` | `15` | 否 | 帧率，有效值为 1~30 |
| onStateChange | `CommonEventFunction<onStateChangeEventDetail>` |  | 否 | 状态变化事件，detail = {code} |
| onError | `CommonEventFunction<onErrorEventDetail>` |  | 否 | 渲染错误事件，detail = {errMsg, errCode} |
| onBgmProgress | `CommonEventFunction<onBgmProgressEventDetail>` |  | 否 | 背景音进度变化时触发，detail = {progress, duration} |
| onBgmComplete | `CommonEventFunction` |  | 否 | 背景音播放完成时触发 |
| onAudioVolumeNotify | `CommonEventFunction` |  | 否 | 返回麦克风采集的音量大小 |
| onNetStatus | `CommonEventFunction` |  | 否 | 网络状态通知，detail = {info} |
| onEnterPictureInPicture | `string` |  | 否 | 进入小窗 |
| onLeavePictureInPicture | `string` |  | 否 | 退出小窗 |
| onBgmStart | `CommonEventFunction` |  | 否 | 背景音开始播放时触发 |

### API 支持度

| API | 微信小程序 | QQ 小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| LivePusherProps.url | ✔️ | ✔️ |  |  |  |
| LivePusherProps.mode | ✔️ | ✔️ |  |  |  |
| LivePusherProps.autopush | ✔️ | ✔️ |  |  |  |
| LivePusherProps.enableVideoCustomRender | ✔️ |  |  |  |  |
| LivePusherProps.muted | ✔️ | ✔️ |  |  |  |
| LivePusherProps.enableCamera | ✔️ | ✔️ |  |  |  |
| LivePusherProps.autoFocus | ✔️ | ✔️ |  |  |  |
| LivePusherProps.orientation | ✔️ | ✔️ |  |  |  |
| LivePusherProps.beauty | ✔️ | ✔️ |  |  |  |
| LivePusherProps.whiteness | ✔️ | ✔️ |  |  |  |
| LivePusherProps.aspect | ✔️ | ✔️ |  |  |  |
| LivePusherProps.minBitrate | ✔️ | ✔️ |  |  |  |
| LivePusherProps.maxBitrate | ✔️ | ✔️ |  |  |  |
| LivePusherProps.audioQuality | ✔️ | ✔️ |  |  |  |
| LivePusherProps.waitingImage | ✔️ | ✔️ |  |  |  |
| LivePusherProps.waitingImageHash | ✔️ | ✔️ |  |  |  |
| LivePusherProps.zoom | ✔️ | ✔️ |  |  |  |
| LivePusherProps.devicePosition | ✔️ | ✔️ |  |  |  |
| LivePusherProps.backgroundMute | ✔️ | ✔️ |  |  |  |
| LivePusherProps.mirror | ✔️ | ✔️ |  |  |  |
| LivePusherProps.remoteMirror | ✔️ |  |  |  |  |
| LivePusherProps.localMirror | ✔️ |  |  |  |  |
| LivePusherProps.audioReverbType | ✔️ | ✔️ |  |  |  |
| LivePusherProps.enableMic | ✔️ |  |  |  |  |
| LivePusherProps.enableAgc | ✔️ |  |  |  |  |
| LivePusherProps.enableAns | ✔️ |  |  |  |  |
| LivePusherProps.audioVolumeType | ✔️ |  |  |  |  |
| LivePusherProps.videoWidth | ✔️ |  |  |  |  |
| LivePusherProps.videoHeight | ✔️ |  |  |  |  |
| LivePusherProps.beautyStyle | ✔️ |  |  |  |  |
| LivePusherProps.filter | ✔️ |  |  |  |  |
| LivePusherProps.pictureInPictureMode | ✔️ |  |  |  |  |
| LivePusherProps.customEffect | ✔️ |  |  |  |  |
| LivePusherProps.skinWhiteness | ✔️ |  |  |  |  |
| LivePusherProps.skinSmoothness | ✔️ |  |  |  |  |
| LivePusherProps.faceThinness | ✔️ |  |  |  |  |
| LivePusherProps.eyeBigness | ✔️ |  |  |  |  |
| LivePusherProps.voiceChangerType | ✔️ |  |  |  |  |
| LivePusherProps.fps | ✔️ |  |  |  |  |
| LivePusherProps.onStateChange | ✔️ | ✔️ |  |  |  |
| LivePusherProps.onError | ✔️ | ✔️ |  |  |  |
| LivePusherProps.onBgmProgress | ✔️ | ✔️ |  |  |  |
| LivePusherProps.onBgmComplete | ✔️ | ✔️ |  |  |  |
| LivePusherProps.onAudioVolumeNotify | ✔️ |  |  |  |  |
| LivePusherProps.onNetStatus | ✔️ | ✔️ |  |  |  |
| LivePusherProps.onEnterPictureInPicture | ✔️ |  |  |  |  |
| LivePusherProps.onLeavePictureInPicture | ✔️ |  |  |  |  |
| LivePusherProps.onBgmStart | ✔️ | ✔️ |  |  |  |

### Orientation

orientation 的合法值

| 参数 | 说明 |
| --- | --- |
| vertical | 竖直 |
| horizontal | 水平 |

### LocalMirror

localMirror 的合法值

| 参数 | 说明 |
| --- | --- |
| auto | 前置摄像头镜像，后置摄像头不镜像 |
| enable | 前后置摄像头均镜像 |
| disable | 前后置摄像头均不镜像 |

### AudioReverbType

audioReverbType 的合法值

| 参数 | 说明 |
| --- | --- |
| 0 | 关闭 |
| 1 | KTV |
| 2 | 小房间 |
| 3 | 大会堂 |
| 4 | 低沉 |
| 5 | 洪亮 |
| 6 | 金属声 |
| 7 | 磁性 |

### AudioVolumeType

audioVolumeType 的合法值

| 参数 | 说明 |
| --- | --- |
| auto | 自动 |
| media | 媒体音量 |
| voicecall | 通话音量 |

### BeautyStyleType

beautyStyleType 的合法值

| 参数 | 说明 |
| --- | --- |
| smooth | 光滑美颜 |
| nature | 自然美颜 |

### FilterType

filterType 的合法值

| 参数 | 说明 |
| --- | --- |
| standard | 标准 |
| pink | 粉嫩 |
| nostalgia | 怀旧 |
| blues | 蓝调 |
| romantic | 浪漫 |
| cool | 清凉 |
| fresher | 清新 |
| solor | 日系 |
| aestheticism | 唯美 |
| whitening | 美白 |
| cerisered | 樱红 |

### onStateChangeEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| code | `number` | 状态码 |

### onNetstatusEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| info | `NetStatus` | 网络状态 |

### onErrorEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| errMsg | `string` | 错误信息 |
| errCode | string or number | 错误码 |

### onBgmProgressEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| progress | `any` | 进展 |
| duration | `number` | 持续时间 |
</file>

<file path="docs/components/media/lottie.md">
---
title: Lottie
sidebar_label: Lottie
---

Lottie

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://opendocs.alipay.com/mini/component/lottie)

## 类型

```tsx
ComponentType<LottieProps>
```

## LottieProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| autoplay | `boolean` | `false` | 否 | 是否自动播放。 |
| path | `string` |  | 否 | Lottie 资源地址。包含近端（包内地址）和远端（网络）的 JSON 文件地址。<br />与 djangoId 二选一。 |
| speed | `number` | `1.0` | 否 | 播放速度。正数为正向播放，负数负向播放。 |
| repeatCount | `number` | `0` | 否 | 循环次数。<br /><br />如果是负数表示无限次。<br />如果是 0 表示不循环，播放一次。<br />如果是 1 表示循环一次，播放两次。 |
| autoReverse | `boolean` | `false` | 否 | 是否自动回播。 |
| assetsPath | `string` |  | 否 | 资源地址。"/" 表明是小程序根目录。 |
| placeholder | `string` |  | 否 | 兜底图或者降级图地址。<br /><br />1. 支持本地资源，案例：'/image/lottie/lottie2_default.png'。<br />支持 http 的 cdn 地址、近端地址。<br />小程序场景不支持 djangoId。 |
| md5 | `string` |  | 否 | 在线资源的 md5 校验。<br />djangoId=https://b.zip。<br />可以使用 b.zip 加密 获取 md5 值<br />md5="77c6c86fc89ba94cc0a9271b77ae77d2" |
| optimize | `boolean` | `false` | 否 | 降级。降级是指如遇低端设备，Lottie 会降级展示为 placeholder。<br />当 optimize 为 true ，并且传入了 placeholder 时，在低端设备上只会展示 placeholder，不展示 Lottie。<br />低端设备如下所示：<br /><br />iOS ：小于等于 iPhone6P<br />Android：内存容量小于 3G |
| onDataReady | `CommonEventFunction` |  | 否 | 当数据下载+视图创建完成时触发。 |
| onDataFailed | `CommonEventFunction` |  | 否 | 数据加载失败时触发。 |
| onAnimationStart | `CommonEventFunction` |  | 否 | 动画开始时触发。 |
| onAnimationEnd | `CommonEventFunction` |  | 否 | 动画结束时触发。 |
| onAnimationRepeat | `CommonEventFunction` |  | 否 | 动画一次重播结束。 |
| onAnimationCancel | `CommonEventFunction` |  | 否 | 动画取消。业务调用 Cancel 时回调。 |
| onDataLoadReady | `CommonEventFunction` |  | 否 | 参数化时，数据准备完成，等待业务传入参数化值。 |

### API 支持度

| API | 微信小程序 | 支付宝小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| LottieProps.autoplay |  | ✔️ |  |  |  |
| LottieProps.path |  | ✔️ |  |  |  |
| LottieProps.speed |  | ✔️ |  |  |  |
| LottieProps.repeatCount |  | ✔️ |  |  |  |
| LottieProps.autoReverse |  | ✔️ |  |  |  |
| LottieProps.assetsPath |  | ✔️ |  |  |  |
| LottieProps.placeholder |  | ✔️ |  |  |  |
| LottieProps.md5 |  | ✔️ |  |  |  |
| LottieProps.optimize |  | ✔️ |  |  |  |
| LottieProps.onDataReady |  | ✔️ |  |  |  |
| LottieProps.onDataFailed |  | ✔️ |  |  |  |
| LottieProps.onAnimationStart |  | ✔️ |  |  |  |
| LottieProps.onAnimationEnd |  | ✔️ |  |  |  |
| LottieProps.onAnimationRepeat |  | ✔️ |  |  |  |
| LottieProps.onAnimationCancel |  | ✔️ |  |  |  |
| LottieProps.onDataLoadReady |  | ✔️ |  |  |  |
</file>

<file path="docs/components/media/rtc-room-item.md">
---
title: RtcRoomItem
sidebar_label: RtcRoomItem
---

实时音视频通话画面

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/component/media_rtc-room-item/)

## 类型

```tsx
ComponentType<RtcRoomItemProps>
```

## RtcRoomItemProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| id | `string` | 否 | rtc-room-item 组件的唯一标识符 |
| type | `string` | 否 | 指定 item 展示本地 / 远端画面，有效值：local、remote ，不可动态变更 |
| userId | `number` | 否 | item 展示画面的用户 id |

### API 支持度

| API | 微信小程序 | 百度小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| RtcRoomItemProps.id |  | ✔️ |  |  |  |
| RtcRoomItemProps.type |  | ✔️ |  |  |  |
| RtcRoomItemProps.userId |  | ✔️ |  |  |  |
</file>

<file path="docs/components/media/rtc-room.md">
---
title: RtcRoom
sidebar_label: RtcRoom
---

实时音视频通话房间

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/component/media_rtc-room/)

## 类型

```tsx
ComponentType<RtcRoomProps>
```

## RtcRoomProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| id | `string` |  | 否 | rtc-room 组件的唯一标识符 |
| enableCamera | `boolean` | `true` | 否 | 是否开启摄像头 |
| enableAutoFocus | `boolean` | `true` | 否 | 是否开启摄像头自动对焦 |
| enableZoom | `boolean` | `false` | 否 | 是否支持双手滑动调整摄像头聚焦 |
| devicePosition | "front" or "back" | `"front"` | 否 | 设置前置还是后置摄像头，有效值：front、back |
| enableMic | `boolean` | `true` | 否 | 是否开启麦克风 |
| enableAgc | `boolean` | `false` | 否 | 是否开启音频自动增益 |
| enableAns | `boolean` | `false` | 否 | 是否开启音频噪声抑制 |
| bitrate | `number` | `900` | 否 | 最大码率 |
| videoWidth | `number` | `360` | 否 | 视频分辨率宽 |
| videoHeight | `number` | `640` | 否 | 视频分辨率高 |
| enableRemoteMirror | `boolean` | `false` | 否 | 设置远端看到的画面的镜像效果，该属性的变化不会影响到本地画面，仅影响远端看到的画面效果 |
| localMirror | "auto" or "enable" or "disable" | `"auto"` | 否 | 设置本地摄像头预览画面的镜像效果，有效值：auto、enable、disable |
| soundMode | "speaker" or "ear" | `"speaker"` | 否 | 设置声音输出方式，有效值：speaker、ear |
| onStateChange | `CommonEventFunction` |  | 否 | 房间状态变化事件，参考下方状态码，detail = { code, msg, userInfo } |
| onError | `CommonEventFunction` |  | 否 | 错误事件。参考下方错误码，detail = { errMsg, errCode } |

### API 支持度

| API | 微信小程序 | 百度小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| RtcRoomProps.id |  | ✔️ |  |  |  |
| RtcRoomProps.enableCamera |  | ✔️ |  |  |  |
| RtcRoomProps.enableAutoFocus |  | ✔️ |  |  |  |
| RtcRoomProps.enableZoom |  | ✔️ |  |  |  |
| RtcRoomProps.devicePosition |  | ✔️ |  |  |  |
| RtcRoomProps.enableMic |  | ✔️ |  |  |  |
| RtcRoomProps.enableAgc |  | ✔️ |  |  |  |
| RtcRoomProps.enableAns |  | ✔️ |  |  |  |
| RtcRoomProps.bitrate |  | ✔️ |  |  |  |
| RtcRoomProps.videoWidth |  | ✔️ |  |  |  |
| RtcRoomProps.videoHeight |  | ✔️ |  |  |  |
| RtcRoomProps.enableRemoteMirror |  | ✔️ |  |  |  |
| RtcRoomProps.localMirror |  | ✔️ |  |  |  |
| RtcRoomProps.soundMode |  | ✔️ |  |  |  |
| RtcRoomProps.onStateChange |  | ✔️ |  |  |  |
| RtcRoomProps.onError |  | ✔️ |  |  |  |
</file>

<file path="docs/components/media/video.md">
---
title: Video
sidebar_label: Video
---

视频。相关api：Taro.createVideoContext

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/video.html)

## 类型

```tsx
ComponentType<VideoProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PageView extends Component {
  constructor() {
    super(...arguments)
  }

  render() {
    return (
      <View className='components-page'>
        <Video
          id='video'
          src='https://wxsnsdy.tc.qq.com/105/20210/snsdyvideodownload?filekey=30280201010421301f0201690402534804102ca905ce620b1241b726bc41dcff44e00204012882540400&bizid=1023&hy=SH&fileparam=302c020101042530230204136ffd93020457e3c4ff02024ef202031e8d7f02030f42400204045a320a0201000400'
          poster='https://misc.aotu.io/booxood/mobile-video/cover_900x500.jpg'
          initialTime={0}
          controls={true}
          autoplay={false}
          loop={false}
          muted={false}
        />
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <video
    id="video"
    src="https://wxsnsdy.tc.qq.com/105/20210/snsdyvideodownload?filekey=30280201010421301f0201690402534804102ca905ce620b1241b726bc41dcff44e00204012882540400&bizid=1023&hy=SH&fileparam=302c020101042530230204136ffd93020457e3c4ff02024ef202031e8d7f02030f42400204045a320a0201000400"
    poster="https://misc.aotu.io/booxood/mobile-video/cover_900x500.jpg"
    initial-time="0"
    :controls="true"
    :autoplay="false"
    :loop="false"
    :muted="false"
  />
</template>
```
</TabItem>
</Tabs>

## VideoProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| src | `string` |  | 是 | 要播放视频的资源地址 |
| duration | `number` |  | 否 | 指定视频时长 |
| controls | `boolean` | `true` | 否 | 是否显示默认播放控件（播放/暂停按钮、播放进度、时间） |
| danmuList | `any[]` |  | 否 | 弹幕列表 |
| danmuBtn | `boolean` | `false` | 否 | 是否显示弹幕按钮，只在初始化时有效，不能动态变更 |
| enableDanmu | `boolean` | `false` | 否 | 是否展示弹幕，只在初始化时有效，不能动态变更 |
| autoplay | `boolean` | `false` | 否 | 是否自动播放 |
| loop | `boolean` | `false` | 否 | 是否循环播放 |
| muted | `boolean` | `false` | 否 | 是否静音播放 |
| initialTime | `number` |  | 否 | 指定视频初始播放位置 |
| pageGesture | `boolean` | `false` | 否 | 在非全屏模式下，是否开启亮度与音量调节手势 |
| direction | `number` |  | 否 | 设置全屏时视频的方向，不指定则根据宽高比自动判断。有效值为 0（正常竖向）, 90（屏幕逆时针90度）, -90（屏幕顺时针90度） |
| showProgress | `boolean` | `true` | 否 | 若不设置，宽度大于240时才会显示 |
| showFullscreenBtn | `boolean` | `true` | 否 | 是否显示全屏按钮 |
| showPlayBtn | `boolean` | `true` | 否 | 是否显示视频底部控制栏的播放按钮 |
| showCenterPlayBtn | `boolean` | `true` | 否 | 是否显示视频中间的播放按钮 |
| enableProgressGesture | `boolean` | `true` | 否 | 是否开启控制进度的手势 |
| objectFit | `keyof ObjectFit` | `"contain"` | 否 | 当视频大小与 video 容器大小不一致时，视频的表现形式 |
| poster | `string` |  | 否 | 视频封面的图片网络资源地址，如果 controls 属性值为 false 则设置 poster 无效 |
| showMuteBtn | `boolean` | `false` | 否 | 是否显示静音按钮 |
| title | `string` |  | 否 | 视频的标题，全屏时在顶部展示 |
| playBtnPosition | `keyof PlayBtnPosition` | `'bottom'` | 否 | 播放按钮的位置<br />- `bottom`: controls bar 上<br />- `center`: 视频中间 |
| enablePlayGesture | `boolean` | `false` | 否 | 是否开启播放手势，即双击切换播放/暂停 |
| autoPauseIfNavigate | `boolean` | `true` | 否 | 当跳转到其它小程序页面时，是否自动暂停本页面的视频 |
| autoPauseIfOpenNative | `boolean` | `true` | 否 | 当跳转到其它微信原生页面时，是否自动暂停本页面的视频 |
| vslideGesture | `boolean` | `false` | 否 | 在非全屏模式下，是否开启亮度与音量调节手势（同 `page-gesture`） |
| vslideGestureInFullscreen | `boolean` | `true` | 否 | 在全屏模式下，是否开启亮度与音量调节手势 |
| adUnitId | `string` |  | 否 | 视频前贴广告单元ID，更多详情可参考开放能力[视频前贴广告](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/ad/video-patch-ad.html) |
| posterForCrawler | `string` |  | 否 | 用于给搜索等场景作为视频封面展示，建议使用无播放 icon 的视频封面图，只支持网络地址 |
| showCastingButton | `boolean` |  | 否 | 显示投屏按钮。只安卓且同层渲染下生效，支持 DLNA 协议 |
| pictureInPictureMode | "" or "push" or "pop" or ("push" or "pop")[] |  | 否 | 设置小窗模式： push, pop，空字符串或通过数组形式设置多种模式（如： ["push", "pop"]） |
| enableAutoRotation | `boolean` |  | 否 | 是否开启手机横屏时自动全屏，当系统设置开启自动旋转时生效 |
| showScreenLockButton | `boolean` |  | 否 | 是否显示锁屏按钮，仅在全屏时显示，锁屏后控制栏的操作 |
| showSnapshotButton | `boolean` |  | 否 | 是否显示截屏按钮，仅在全屏时显示 |
| showBackgroundPlaybackButton | `boolean` |  | 否 | 是否展示后台音频播放按钮 |
| backgroundPoster | `string` |  | 否 | 进入后台音频播放后的通知栏图标（Android 独有） |
| nativeProps | `Record<string, unknown>` |  | 否 | 用于透传 `WebComponents` 上的属性到内部 H5 标签上 |
| showBottomProgress | `boolean` | `true` | 否 | 是否展示底部进度条 |
| pictureInPictureShowProgress | `string` |  | 否 | 是否在小窗模式下显示播放进度 |
| referrerPolicy | "origin" or "no-referrer" |  | 否 | 格式固定为 https://servicewechat.com/{appid}/{version}/page-frame.html，其中 {appid} 为小程序的 appid，{version} 为小程序的版本号，版本号为 0 表示为开发版、体验版以及审核版本，版本号为 devtools 表示为开发者工具，其余为正式版本； |
| isDrm | `boolean` |  | 否 | 是否是 DRM 视频源 |
| provisionUrl | `string` |  | 否 | DRM 设备身份认证 url，仅 is-drm 为 true 时生效 (Android) |
| certificateUrl | `string` |  | 否 | DRM 设备身份认证 url，仅 is-drm 为 true 时生效 (iOS) |
| licenseUrl | `string` |  | 否 | DRM 获取加密信息 url，仅 is-drm 为 true 时生效 |
| posterSize | `string` |  | 否 | 当 poster 高宽比跟视频高宽不匹配时，如何显示 poster，设置规则同 background-size 一致。 |
| showThinProgressBar | `string` |  | 否 | 当底部工具条隐藏时，是否显示细进度条（controls=false 时设置无效）。 |
| mobilenetHintType | `number` |  | 否 | 移动网络提醒样式。<br /><br />0 - 不提醒<br />1 - tip 提醒<br />2 - 阻塞提醒(无消耗流量大小)<br />3 - 阻塞提醒(有消耗流量大小提醒) |
| floatingMode | `string` |  | 否 | 浮窗设置。暂时不支持全局浮窗。<br />可选值：<br /><br />none：无浮窗。<br />page：页面内浮窗。 |
| showNoWifiTip | `string` |  | 否 | 非 wifi 环境下是否显示继续播放浮层 |
| showLockBtn | `string` |  | 否 | 全屏模式下，是否显示锁屏按钮 |
| showRateBtn | `string` |  | 否 | 是否显示倍速播放按钮 |
| showVslideBtnInFullscreen | `string` |  | 否 | 全屏模式下，是否显示侧边栏控制按钮 |
| silentPlay | `string` |  | 否 | 是否进入无声视频模式，进入无声视频模式后，视频将静音播放且不响应系统物理音量变化，点击播放器提示无声视频，手势调节失效 |
| preRollUnitId | `string` |  | 否 | 前贴广告的 unit id |
| postRollUnitId | `string` |  | 否 | 后贴广告的 unit id |
| showPlaybackRateBtn | `string` |  | 否 | 是否显示倍速控件，点击倍速控件后可选择倍速，可选值： 0.75/1.0/1.25/1.5/2 |
| enablePlayInBackground | `string` |  | 否 | video 播放时宿主退出后台后开启小窗播放，iOS 14 及以上版本支持。开启时首次退出后台后给予弹窗提示用户授权，授权完成后可以到小程序「设置」中重设。支持场景见后台小窗播放 |
| signature | `string` |  | 否 | 设置署名水印 |
| preferredPeakBitRate | `number` |  | 否 | 指定码率上界，单位为比特每秒 |
| isLive | `boolean` |  | 否 | 是否为直播源 |
| definition | `string` |  | 否 | 清晰度，设置清晰度列表和默认播放的清晰度。切换清晰度按钮仅在全屏时展示，属性说明详见 Definition 类型说明。需要保证 src 和 definition 中有一个为必填，若同时设置了 src 和 definition，definition 优先级高于 src |
| onPlay | `CommonEventFunction` |  | 否 | 当开始/继续播放时触发 play 事件 |
| onPause | `CommonEventFunction` |  | 否 | 当暂停播放时触发 pause 事件 |
| onEnded | `CommonEventFunction` |  | 否 | 当播放到末尾时触发 ended 事件 |
| onTimeUpdate | `CommonEventFunction<onTimeUpdateEventDetail>` |  | 否 | 播放进度变化时触发, 触发频率 250ms 一次 |
| onFullscreenChange | `CommonEventFunction<onFullscreenChangeEventDetail>` |  | 否 | 当视频进入和退出全屏时触发 |
| onWaiting | `CommonEventFunction<onWaitingEventDetail>` |  | 否 | 视频出现缓冲时触发 |
| onError | `CommonEventFunction` |  | 否 | 视频播放出错时触发 |
| onProgress | `CommonEventFunction<onProgressEventDetail>` |  | 否 | 加载进度变化时触发，只支持一段加载 |
| onLoadedMetaData | `CommonEventFunction<onLoadedMetaDataEventDetail>` |  | 否 | 视频元数据加载完成时触发 |
| onEnterPictureInPicture | `CommonEventFunction` |  | 否 | 播放器进入小窗 |
| onLeavePictureInPicture | `CommonEventFunction` |  | 否 | 播放器退出小窗 |
| onSeekComplete | `CommonEventFunction` |  | 否 | seek 完成时触发 |
| onFullScreenChange | `CommonEventFunction<onFullscreenChangeEventDetail>` |  | 否 | 视频进入和退出全屏时触发 |
| onControlsToggle | `CommonEventFunction<onControlsToggleEventDetail>` |  | 否 | 切换 controls 显示隐藏时触发。 |
| onLoading | `CommonEventFunction` |  | 否 | 视频出现缓冲时触发。 |
| onTap | `CommonEventFunction<onTapEventDetail>` |  | 否 | 点击视频 view 时触发 |
| onUserAction | `CommonEventFunction<onUserActionEventDetail>` |  | 否 | 用户操作事件 |
| onStop | `CommonEventFunction` |  | 否 | 视频播放终止。 |
| onRenderStart | `CommonEventFunction` |  | 否 | 当视频加载完真正开始播放时触发。 |
| onAdStart | `CommonEventFunction<onAdTypeCommonEventDetail>` |  | 否 | 贴片广告开始播放时触发 |
| onAdEnded | `CommonEventFunction<onAdTypeCommonEventDetail>` |  | 否 | 贴片广告播放结束时触发 |
| onAdClose | `CommonEventFunction<onAdTypeCommonEventDetail>` |  | 否 | 贴片广告非自然结束时触发，如：用户关闭广告或广告播放过程中 video 组件被销毁 |
| onAdError | `CommonEventFunction<onAdTypeCommonEventDetail>` |  | 否 | 贴片广告加载失败时触发 |
| onPlayBackRateChange | `CommonEventFunction<{ playbackRate: string; }>` |  | 否 | 视频倍速改变完成时触发。返回改变后的倍速值 |
| onMuteChange | `CommonEventFunction<{ isMuted: boolean; }>` |  | 否 | 静音状态改变完成时触发。返回当前是否静音 |
| onControlTap | `CommonEventFunction<{ controlType: any; }>` |  | 否 | 点击控件时触发。返回当前点击的控件类型 |
| onEnterBackground | `CommonEventFunction` |  | 否 | 进入小窗播放时触发 |
| onCloseBackground | `CommonEventFunction` |  | 否 | 关闭小窗播放时触发 |
| onLeaveBackground | `CommonEventFunction` |  | 否 | 离开小窗进入 app 事件时触发 |
| onLoadedData | `CommonEventFunction` |  | 否 | 否 |
| onLoadStart | `CommonEventFunction` |  | 否 | 否 |
| onSeeked | `CommonEventFunction` |  | 否 | 否 |
| onSeeking | `CommonEventFunction` |  | 否 | 否 |
| onAdLoad | `CommonEventFunction` |  | 否 | 贴片广告加载成功时触发，event.detail = { adType: 'preRollAd' or 'postRollAd' } |
| onCastingUserSelect | `CommonEventFunction` |  | 否 | 用户选择投屏设备时触发 detail = { state: "success"/"fail" } |
| onCastingStateChange | `CommonEventFunction` |  | 否 | 投屏成功/失败时触发 detail = { type, state: "success"/"fail" } |
| onCastingInterrupt | `CommonEventFunction` |  | 否 | 投屏被中断时触发 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| VideoProps.src | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| VideoProps.duration | ✔️ |  | ✔️ |  | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| VideoProps.controls | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| VideoProps.danmuList | ✔️ | ✔️ |  |  | ✔️ |  | ✔️ |  |  | ✔️ |  |
| VideoProps.danmuBtn | ✔️ | ✔️ |  |  | ✔️ |  | ✔️ |  |  | ✔️ |  |
| VideoProps.enableDanmu | ✔️ | ✔️ |  |  | ✔️ |  | ✔️ |  |  | ✔️ |  |
| VideoProps.autoplay | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| VideoProps.loop | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| VideoProps.muted | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| VideoProps.initialTime | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| VideoProps.pageGesture | ✔️ | ✔️ |  |  | ✔️ |  |  |  |  |  |  |
| VideoProps.direction | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |  | ✔️ |
| VideoProps.showProgress | ✔️ | ✔️ |  |  | ✔️ |  | ✔️ |  |  | ✔️ |  |
| VideoProps.showFullscreenBtn | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  | ✔️ | ✔️ |
| VideoProps.showPlayBtn | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  | ✔️ | ✔️ |
| VideoProps.showCenterPlayBtn | ✔️ | ✔️ | ✔️ |  | ✔️ |  | ✔️ | ✔️ |  | ✔️ |  |
| VideoProps.enableProgressGesture | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  | ✔️ | ✔️ |
| VideoProps.objectFit | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |
| VideoProps.poster | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| VideoProps.showMuteBtn | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  | ✔️ | ✔️ |
| VideoProps.title | ✔️ | ✔️ |  |  | ✔️ |  |  |  |  |  | ✔️ |
| VideoProps.playBtnPosition | ✔️ |  |  | ✔️ | ✔️ |  |  |  |  |  | ✔️ |
| VideoProps.enablePlayGesture | ✔️ | ✔️ |  | ✔️ | ✔️ |  | ✔️ |  |  | ✔️ | ✔️ |
| VideoProps.autoPauseIfNavigate | ✔️ |  |  |  | ✔️ |  |  |  |  |  |  |
| VideoProps.autoPauseIfOpenNative | ✔️ |  |  |  | ✔️ |  |  |  |  |  |  |
| VideoProps.vslideGesture | ✔️ | ✔️ |  | ✔️ |  |  | ✔️ |  |  | ✔️ | ✔️ |
| VideoProps.vslideGestureInFullscreen | ✔️ | ✔️ |  | ✔️ |  |  | ✔️ |  |  | ✔️ | ✔️ |
| VideoProps.adUnitId | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.posterForCrawler | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.showCastingButton | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| VideoProps.pictureInPictureMode | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.enableAutoRotation | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| VideoProps.showScreenLockButton | ✔️ |  |  | ✔️ |  |  |  |  |  |  | ✔️ |
| VideoProps.showSnapshotButton | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.showBackgroundPlaybackButton | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.backgroundPoster | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.nativeProps |  |  |  |  |  |  | ✔️ |  |  | ✔️ |  |
| VideoProps.showBottomProgress | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.pictureInPictureShowProgress | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.referrerPolicy | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.isDrm | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.provisionUrl | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.certificateUrl | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.licenseUrl | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.posterSize |  |  | ✔️ |  |  |  |  |  |  |  |  |
| VideoProps.showThinProgressBar |  |  | ✔️ |  |  |  |  |  |  |  |  |
| VideoProps.mobilenetHintType |  |  | ✔️ |  |  | ✔️ |  |  |  |  |  |
| VideoProps.floatingMode |  |  | ✔️ |  |  |  |  |  |  |  |  |
| VideoProps.showNoWifiTip |  | ✔️ |  |  |  |  |  |  |  |  |  |
| VideoProps.showLockBtn |  | ✔️ |  |  |  |  |  |  |  |  |  |
| VideoProps.showRateBtn |  | ✔️ |  |  |  |  |  |  |  |  |  |
| VideoProps.showVslideBtnInFullscreen |  | ✔️ |  |  |  |  |  |  |  |  |  |
| VideoProps.silentPlay |  | ✔️ |  |  |  |  |  |  |  |  |  |
| VideoProps.preRollUnitId |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.postRollUnitId |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.showPlaybackRateBtn |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.enablePlayInBackground |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.signature |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.preferredPeakBitRate | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.isLive | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.definition |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.onPlay | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| VideoProps.onPause | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| VideoProps.onEnded | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| VideoProps.onTimeUpdate | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| VideoProps.onFullscreenChange |  |  | ✔️ |  |  |  | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| VideoProps.onWaiting | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| VideoProps.onError | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| VideoProps.onProgress | ✔️ |  |  | ✔️ | ✔️ |  | ✔️ |  | ✔️ | ✔️ | ✔️ |
| VideoProps.onLoadedMetaData | ✔️ | ✔️ |  | ✔️ |  | ✔️ |  | ✔️ | ✔️ |  | ✔️ |
| VideoProps.onEnterPictureInPicture | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.onLeavePictureInPicture | ✔️ |  |  |  |  |  |  |  |  |  |  |
| VideoProps.onSeekComplete | ✔️ |  |  | ✔️ |  |  |  |  |  |  | ✔️ |
| VideoProps.onFullScreenChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| VideoProps.onControlsToggle | ✔️ | ✔️ |  |  |  |  |  |  |  |  | ✔️ |
| VideoProps.onLoading |  |  | ✔️ |  |  |  |  |  |  |  |  |
| VideoProps.onTap |  |  | ✔️ |  |  |  |  |  |  |  |  |
| VideoProps.onUserAction |  |  | ✔️ |  |  |  |  |  |  |  |  |
| VideoProps.onStop |  |  | ✔️ |  |  |  |  |  |  |  |  |
| VideoProps.onRenderStart |  |  | ✔️ |  |  |  |  |  |  |  |  |
| VideoProps.onAdStart |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.onAdEnded |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.onAdClose |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.onAdError |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.onPlayBackRateChange |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.onMuteChange |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.onControlTap |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.onEnterBackground |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.onCloseBackground |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.onLeaveBackground |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.onLoadedData |  |  |  |  |  | ✔️ |  |  |  |  |  |
| VideoProps.onLoadStart |  |  |  |  |  | ✔️ |  |  |  |  |  |
| VideoProps.onSeeked |  |  |  |  |  | ✔️ |  |  | ✔️ |  |  |
| VideoProps.onSeeking |  |  |  |  |  | ✔️ |  |  | ✔️ |  |  |
| VideoProps.onAdLoad |  |  |  | ✔️ |  |  |  |  |  |  |  |
| VideoProps.onCastingUserSelect | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| VideoProps.onCastingStateChange | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| VideoProps.onCastingInterrupt | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |

### direction

direction 的合法值

| 参数 | 说明 |
| --- | --- |
| 0 | 正常竖向 |
| 90 | 屏幕逆时针90度 |
| -90 | 屏幕顺时针90度 |

### ObjectFit

objectFit 的合法值

| 参数 | 说明 |
| --- | --- |
| contain | 包含 |
| fill | 填充 |
| cover | 覆盖 |

### PlayBtnPosition

playBtnPosition 的合法值

| 参数 | 说明 |
| --- | --- |
| bottom | controls bar上 |
| center | 视频中间 |

### onTimeUpdateEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| currentTime | `number` | 当前时间 |
| duration | `number` | 持续时间 |
| userPlayDuration | `number` | 用户实际观看时长 |
| videoDuration | `number` | 视频总时长 |

#### API 支持度

| API | 微信小程序 | 支付宝小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| onTimeUpdateEventDetail.userPlayDuration |  | ✔️ |  |  |  |  |
| onTimeUpdateEventDetail.videoDuration |  | ✔️ |  |  |  |  |

### onFullscreenChangeEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| direction | "vertical" or "horizontal" | 方向 |
| fullScreen | number or boolean | 全屏 |

### onWaitingEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| direction | "vertical" or "horizontal" | 方向 |
| fullScreen | number or boolean | 全屏 |

### onProgressEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| buffered | `number` | 百分比 |

### onLoadedMetaDataEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| width | `number` | 视频宽度 |
| height | `number` | 视频高度 |
| duration | `number` | 持续时间 |

### onControlsToggleEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| show | `boolean` | 是否显示 |

### onTapEventDetail

| 参数 | 类型 |
| --- | --- |
| ptInView | `{ x: number; y: number; }` |

### onUserActionEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| tag | `string` | 用户操作的元素 |
| value | `number` |  |

### UserActionTag

| 参数 | 说明 |
| --- | --- |
| play | 底部播放按钮 |
| centerplay | 中心播放按钮 |
| mute | 静音按钮 |
| fullscreen | 全屏按钮 |
| retry | 重试按钮 |
| mobilenetplay | 网络提醒的播放按钮 |

### onAdTypeCommonEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| adType | "preRollAd" or "postRollAd" | 广告类型 |
</file>

<file path="docs/components/media/voip-room.md">
---
title: VoipRoom
sidebar_label: VoipRoom
---

多人音视频对话

需用户授权 `scope.camera`、`scope.record`。相关接口： [Taro.joinVoIPChat](/docs/apis/media/voip/joinVoIPChat)
开通该组件权限后，开发者可在 joinVoIPChat 成功后，获取房间成员的 openid，传递给 voip-room 组件，以显示成员画面。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/voip-room.html)

## 类型

```tsx
ComponentType<VoipRoomProps>
```

## 示例代码

```tsx
export default class PageView extends Component {
  constructor() {
    super(...arguments)
  }

  render() {
    return (
      <VoipRoom
        openId="{{item}}"
        mode="{{selfOpenId === item ? 'camera' : 'video'}}">
      </VoipRoom>
    )
  }
}
```

## VoipRoomProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| mode | `keyof Mode` | `camera` | 否 | 对话窗口类型，自身传入 camera，其它用户传入 video |
| devicePosition | `keyof DevicePosition` | `front` | 否 | 仅在 mode 为 camera 时有效，前置或后置，值为front, back |
| openId | `string` | `"none"` | 否 | 进入房间用户的 openid |
| objectFit | "fill" or "contain" or "cover" | `"fill"` | 否 | 画面与容器比例不一致时，画面的表现形式 |
| onError | `CommonEventFunction` |  | 否 | 创建对话窗口失败时触发 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| VoipRoomProps.mode | ✔️ |  |  |  |
| VoipRoomProps.devicePosition | ✔️ |  |  |  |
| VoipRoomProps.openId | ✔️ |  |  |  |
| VoipRoomProps.objectFit | ✔️ |  |  |  |
| VoipRoomProps.onError | ✔️ |  |  |  |

### Mode

对话窗口类型

### DevicePosition

摄像头类型
</file>

<file path="docs/components/navig/functional-page-navigator.md">
---
title: FunctionalPageNavigator
sidebar_label: FunctionalPageNavigator
---

仅在插件中有效，用于跳转到插件功能页

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/functional-page-navigator.html)

## 类型

```tsx
ComponentType<FunctionalPageNavigatorProps>
```

## FunctionalPageNavigatorProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| version | `keyof Version` | `"release"` | 否 | 跳转到的小程序版本，有效值 develop（开发版），trial（体验版），release（正式版）；线上版本必须设置为 release |
| name | `keyof Name` |  | 否 | 要跳转到的功能页 |
| args | `object` |  | 否 | 功能页参数，参数格式与具体功能页相关 |
| onSuccess | `CommonEventFunction` |  | 否 | 功能页返回，且操作成功时触发， detail 格式与具体功能页相关 |
| onFail | `CommonEventFunction` |  | 否 | 功能页返回，且操作失败时触发， detail 格式与具体功能页相关 |
| onCancel | `CommonEventFunction` |  | 否 | 因用户操作从功能页返回时触发 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| FunctionalPageNavigatorProps.version | ✔️ |  |  |  |
| FunctionalPageNavigatorProps.name | ✔️ |  |  |  |
| FunctionalPageNavigatorProps.args | ✔️ |  |  |  |
| FunctionalPageNavigatorProps.onSuccess | ✔️ |  |  |  |
| FunctionalPageNavigatorProps.onFail | ✔️ |  |  |  |
| FunctionalPageNavigatorProps.onCancel | ✔️ |  |  |  |

### Version

version 的合法值

| 参数 | 说明 |
| --- | --- |
| develop | 开发版 |
| trial | 体验版 |
| release | 正式版 |

### Name

name 的合法值

| 参数 | 说明 |
| --- | --- |
| loginAndGetUserInfo | [用户信息功能页](https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/functional-pages/user-info.html) |
| requestPayment | [支付功能页](https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/functional-pages/request-payment.html) |
| chooseAddress | [收货地址功能页](https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/functional-pages/choose-address.html) |
</file>

<file path="docs/components/navig/navigation-bar.md">
---
title: NavigationBar
sidebar_label: NavigationBar
---

页面导航条配置节点，用于指定导航栏的一些属性。只能是 PageMeta 组件内的第一个节点，需要配合它一同使用。
通过这个节点可以获得类似于调用 Taro.setNavigationBarTitle Taro.setNavigationBarColor 等接口调用的效果。

:::info
Taro v3.6.19 开始支持
需要配合 PageMeta 组件使用
:::

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/navigation-bar.html)

## 类型

```tsx
ComponentType<NavigationBarProps>
```

## NavigationBarProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| title | `string` |  | 否 | 导航条标题 |
| loading | `boolean` |  | 否 | 是否在导航条显示 loading 加载提示 |
| frontColor | `string` |  | 否 | 导航条前景颜色值，包括按钮、标题、状态栏的颜色，仅支持 #ffffff 和 #000000 |
| backgroundColor | `string` |  | 否 | 导航条背景颜色值，有效值为十六进制颜色 |
| colorAnimationDuration | `string` | `0` | 否 | 改变导航栏颜色时的动画时长，默认为 0 （即没有动画效果） |
| colorAnimationTimingFunc | "linear" or "easeIn" or "easeOut" or "easeInOut" | `"linear"` | 否 | 改变导航栏颜色时的动画方式，支持 linear 、 easeIn 、 easeOut 和 easeInOut |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| NavigationBarProps.title | ✔️ |  |  | ✔️ |
| NavigationBarProps.loading | ✔️ |  |  | ✔️ |
| NavigationBarProps.frontColor | ✔️ |  |  | ✔️ |
| NavigationBarProps.backgroundColor | ✔️ |  |  | ✔️ |
| NavigationBarProps.colorAnimationDuration | ✔️ |  |  |  |
| NavigationBarProps.colorAnimationTimingFunc | ✔️ |  |  |  |
</file>

<file path="docs/components/navig/navigator.md">
---
title: Navigator
sidebar_label: Navigator
---

页面链接

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/navigator.html)

## 类型

```tsx
ComponentType<NavigatorProps>
```

## NavigatorProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| target | `keyof Target` | `"self"` | 否 | 在哪个目标上发生跳转，默认当前小程序 |
| url | `string` |  | 否 | 当前小程序内的跳转链接 |
| openType | `keyof OpenType` | `"navigate"` | 否 | 跳转方式 |
| delta | `number` |  | 否 | 当 open-type 为 'navigateBack' 时有效，表示回退的层数 |
| appId | `string` |  | 否 | 当 `target="miniProgram"` 时有效，要打开的小程序 appId |
| path | `string` |  | 否 | 当 `target="miniProgram"` 时有效，打开的页面路径，如果为空则打开首页 |
| extraData | `object` |  | 否 | 当 `target="miniProgram"` 时有效，需要传递给目标小程序的数据，目标小程序可在 `App.onLaunch()`，`App.onShow()` 中获取到这份数据. |
| version | `keyof Version` |  | 否 | 当 `target="miniProgram"` 时有效，要打开的小程序版本 |
| hoverClass | `string` | `"navigator-hover"` | 否 | 指定按下去的样式类。当 `hover-class="none"` 时，没有点击态效果 |
| hoverStopPropagation | `boolean` | `false` | 否 | 指定是否阻止本节点的祖先节点出现点击态 |
| hoverStartTime | `number` | `50` | 否 | 按住后多久出现点击态，单位毫秒 |
| hoverStayTime | `number` | `600` | 否 | 手指松开后点击态保留时间，单位毫秒 |
| shortLink | `string` |  | 否 | 当target="miniProgram"时有效，当传递该参数后，可以不传 app-id 和 path。链接可以通过【小程序菜单】->【复制链接】获取。 |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |
| onSuccess | `CommonEventFunction` |  | 否 | 当 `target="miniProgram"` 时有效，跳转小程序成功 |
| onFail | `CommonEventFunction` |  | 否 | 当 `target="miniProgram"` 时有效，跳转小程序失败 |
| onComplete | `CommonEventFunction` |  | 否 | 当 `target="miniProgram"` 时有效，跳转小程序完成 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| NavigatorProps.target | ✔️ | ✔️ |  |  | ✔️ |  |  |  |  |  | ✔️ |
| NavigatorProps.url | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| NavigatorProps.openType | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| NavigatorProps.delta | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| NavigatorProps.appId | ✔️ | ✔️ |  |  | ✔️ |  |  |  |  |  |  |
| NavigatorProps.path | ✔️ | ✔️ |  |  | ✔️ |  |  |  |  |  |  |
| NavigatorProps.extraData | ✔️ | ✔️ |  |  | ✔️ |  |  |  |  |  |  |
| NavigatorProps.version | ✔️ | ✔️ |  |  | ✔️ |  |  |  |  |  |  |
| NavigatorProps.hoverClass | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| NavigatorProps.hoverStopPropagation | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| NavigatorProps.hoverStartTime | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| NavigatorProps.hoverStayTime | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| NavigatorProps.shortLink | ✔️ |  |  |  |  |  |  |  |  |  |  |
| NavigatorProps.ariaLabel |  |  |  |  | ✔️ |  |  |  |  |  |  |
| NavigatorProps.onSuccess | ✔️ | ✔️ |  |  | ✔️ |  | ✔️ |  |  | ✔️ |  |
| NavigatorProps.onFail | ✔️ | ✔️ |  |  | ✔️ |  | ✔️ |  |  | ✔️ |  |
| NavigatorProps.onComplete | ✔️ | ✔️ |  |  | ✔️ |  | ✔️ |  |  | ✔️ |  |

### Target

target 的合法值

| 参数 | 说明 |
| --- | --- |
| self | 当前小程序 |
| miniProgram | 其它小程序 |

### OpenType

open-type 的合法值

| 参数 | 说明 |
| --- | --- |
| navigate | 对应 Taro.navigateTo 或 Taro.navigateToMiniProgram 的功能 |
| redirect | 对应 Taro.redirectTo 的功能 |
| switchTab | 对应 Taro.switchTab 的功能 |
| reLaunch | 对应 Taro.reLaunch 的功能 |
| navigateBack | 对应 Taro.navigateBack 的功能 |
| exit | 退出小程序，`target="miniProgram"` 时生效 |

### Version

version 的合法值

| 参数 | 说明 |
| --- | --- |
| develop | 开发版 |
| trial | 体验版 |
| release | 正式版，仅在当前小程序为开发版或体验版时此参数有效；如果当前小程序是正式版，则打开的小程序必定是正式版。 |
</file>

<file path="docs/components/navig/tab-item.md">
---
title: TabItem
sidebar_label: TabItem
---

标签栏子项

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/component/tab-item/)

## 类型

```tsx
ComponentType<TabItemProps>
```

## TabItemProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| label | `string` | `无` | 否 | tab-item 内显示的文字 |
| name | `string` | `无` | 否 | tab-item 对应的 name 值 |
| badgeType | `string` | `无` | 否 | 徽标类型 badge-type 分为圆点“dot”和文本“text”，不设置 badge-type 则不显示徽标 |
| badgeText | `string` | `无` | 否 | badge-type 为 text 的时候，徽标内的数字，为空时badge-type="text"不生效 |

### API 支持度

| API | 微信小程序 | 百度小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| TabItemProps.label |  | ✔️ |  |  |  |
| TabItemProps.name |  | ✔️ |  |  |  |
| TabItemProps.badgeType |  | ✔️ |  |  |  |
| TabItemProps.badgeText |  | ✔️ |  |  |  |
</file>

<file path="docs/components/navig/tabs.md">
---
title: Tabs
sidebar_label: Tabs
---

标签栏

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/component/tabs/)

## 类型

```tsx
ComponentType<TabsProps>
```

## TabsProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| tabsBackgroundColor | `string` | `"#fff"` | 否 | tabs 背景色,必须填写十六进制颜色 |
| tabsActiveTextColor | `string` | `"#000"` | 否 | tabs 激活 tab-item 文字颜色 |
| tabsInactiveTextColor | `string` | `"#666"` | 否 | tabs 非激活 tab-item 文字颜色 |
| tabsUnderlineColor | `string` | `"#333"` | 否 | tabs 激活 tab-item 下划线颜色 |
| activeName | `string` | `无` | 否 | 仅用于普通标签栏组件，当前激活 tab-item 的对应的 name 值，须搭配 bindtabchange 一起使用。 |
| urlQueryName | `string` | `无` | 否 | 仅用于可寻址标签栏组件，当前 tab 所改变的 url query 中参数 key，需要通过 tabs 修改页面 url 的时候设置。 |
| maxTabItemAmount | `number` | `5` | 否 | 当前 tabs 视图中最多容纳的 tab-item 数量，低于此数量均分排列，超出此数量划屏。默认五个，开发者可根据业务需求调整 |
| onTabChange | `CommonEventFunction` |  | 否 | tab 被点击的回调，可以在 e.detail.name 中取到当前点击的 tab-item 对应的 name 值 |

### API 支持度

| API | 微信小程序 | 百度小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| TabsProps.tabsBackgroundColor |  | ✔️ |  |  |  |
| TabsProps.tabsActiveTextColor |  | ✔️ |  |  |  |
| TabsProps.tabsInactiveTextColor |  | ✔️ |  |  |  |
| TabsProps.tabsUnderlineColor |  | ✔️ |  |  |  |
| TabsProps.activeName |  | ✔️ |  |  |  |
| TabsProps.urlQueryName |  | ✔️ |  |  |  |
| TabsProps.maxTabItemAmount |  | ✔️ |  |  |  |
| TabsProps.onTabChange |  | ✔️ |  |  |  |
</file>

<file path="docs/components/open/ad-custom.md">
---
title: AdCustom
sidebar_label: AdCustom
---

Banner 广告

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/ad.html)

## 类型

```tsx
ComponentType<AdCustomProps>
```

## 示例代码

```tsx
class App extends Component {
  render () {
    return (
      <AdCustom
        unitId=''
        adIntervals={60}
        onLoad={() => console.log('ad onLoad')}
        onError={() => console.log('ad onError')}
        onClose={() => console.log('ad onClose')}
      />
    )
  }
}
```

## AdCustomProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| unitId | `string` | 是 | 广告单元id，可在[小程序管理后台](https://mp.weixin.qq.com/)的流量主模块新建 |
| adIntervals | `number` | 否 | 广告自动刷新的间隔时间，单位为秒，参数值必须大于等于30（该参数不传入时 Banner 广告不会自动刷新） |
| onLoad | `CommonEventFunction` | 否 | 广告加载成功的回调 |
| onError | `CommonEventFunction<AdProps.onErrorEventDetail>` | 否 | 当广告发生错误时，触发的事件，可以通过该事件获取错误码及原因 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| AdCustomProps.unitId | ✔️ |  |  |  |
| AdCustomProps.adIntervals | ✔️ |  |  |  |
| AdCustomProps.onLoad | ✔️ |  |  |  |
| AdCustomProps.onError | ✔️ |  |  |  |
</file>

<file path="docs/components/open/ad.md">
---
title: Ad
sidebar_label: Ad
---

Banner 广告

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/ad.html)

## 类型

```tsx
ComponentType<AdProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Component {
  render () {
    return (
      <Ad
        unitId=''
        adIntervals={60}
        onLoad={() => console.log('ad onLoad')}
        onError={() => console.log('ad onError')}
        onClose={() => console.log('ad onClose')}
      />
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <ad
    unit-id=""
    ad-intervals="60"
    @load="onLoad"
    @error="onError"
    @close="onClose"
  />
</template>
```
</TabItem>
</Tabs>

## AdProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| unitId | `string` |  | 是 | 广告单元id，可在[小程序管理后台](https://mp.weixin.qq.com/)的流量主模块新建 |
| adIntervals | `number` |  | 否 | 广告自动刷新的间隔时间，单位为秒，参数值必须大于等于30（该参数不传入时 Banner 广告不会自动刷新） |
| adType | "banner" or "video" or "grid" |  | 否 | 广告类型，默认为展示`banner`，可通过设置该属性为`video`展示视频广告, `grid`为格子广告 |
| adTheme | "white" or "black" |  | 否 | 广告主题样式设置 |
| appid | `string` |  | 否 | 小程序应用 ID |
| apid | `string` |  | 否 | 小程序广告位 ID |
| type | `string` | `feed` | 否 | 广告类型：banner、feed ，需和百青藤平台上的代码位类型相匹配 |
| updatetime | `string` |  | 否 | 更改该属性，可以触发广告刷新 |
| fixed | `string` |  | 否 | 广告是否在屏幕中固定展示 |
| scale | `string` | `100` | 否 | 广告的缩放比例，100 为标准尺寸 |
| adLeft | `string` |  | 否 | type 为 feeds 时广告左边距（px），必须大于 0 |
| adTop | `string` |  | 否 | type 为 feeds 时广告上边距（px），必须大于 0 |
| adWidth | `string` |  | 否 | type 为 feeds 时广告宽度（px），默认 100%，最大值为屏幕宽度，最小值为 265 |
| adHeight | `string` |  | 否 | type 为 feeds 时广告高度（px），最小 85，最大 160 |
| blockSize | `string` | `1` | 否 | type 为 block 时请求积木广告数量（展示以实际拉取广告数量为准） |
| blockOrientation | "vertical" or "landscape" | `landscape` | 否 | type 为 block 时请求积木广告排列方向 |
| testBannerType | "one" or "three" | `three` | 否 | 开发者工具下，type 为 banner 时，指定 banner 广告展示三图文还是单图 |
| onLoad | `CommonEventFunction` |  | 否 | 广告加载成功的回调 |
| onError | `CommonEventFunction<onErrorEventDetail>` |  | 否 | 当广告发生错误时，触发的事件，可以通过该事件获取错误码及原因，事件对象 event.detail = {errCode: 1002} |
| onClose | `CommonEventFunction` |  | 否 | 广告关闭的回调 |
| onStatus | `CommonEventFunction` |  | 否 | 贴片类型广告播放期间触发 |
| onSize | `CommonEventFunction<onSizeEventDetail>` |  | 否 | type 为 feeds 时广告实际宽高回调 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 抖音小程序 | QQ 小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| AdProps.unitId | ✔️ |  | ✔️ | ✔️ |  |  |  |
| AdProps.adIntervals | ✔️ |  | ✔️ |  |  |  |  |
| AdProps.adType | ✔️ |  |  |  |  |  |  |
| AdProps.adTheme | ✔️ |  |  |  |  |  |  |
| AdProps.appid |  | ✔️ |  |  |  |  |  |
| AdProps.apid |  | ✔️ |  |  |  |  |  |
| AdProps.type |  | ✔️(支持 banner、feed) | ✔️ | ✔️(支持 banner、card、feeds、block) |  |  |  |
| AdProps.updatetime |  | ✔️ |  |  |  |  |  |
| AdProps.fixed |  |  | ✔️ |  |  |  |  |
| AdProps.scale |  |  | ✔️ |  |  |  |  |
| AdProps.adLeft |  |  |  | ✔️ |  |  |  |
| AdProps.adTop |  |  |  | ✔️ |  |  |  |
| AdProps.adWidth |  |  |  | ✔️ |  |  |  |
| AdProps.adHeight |  |  |  | ✔️ |  |  |  |
| AdProps.blockSize |  |  |  | ✔️ |  |  |  |
| AdProps.blockOrientation |  |  |  | ✔️ |  |  |  |
| AdProps.testBannerType |  |  |  | ✔️ |  |  |  |
| AdProps.onLoad | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |
| AdProps.onError | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |
| AdProps.onClose | ✔️ | ✔️ | ✔️ |  |  |  |  |
| AdProps.onStatus |  | ✔️ |  |  |  |  |  |
| AdProps.onSize |  |  |  | ✔️ |  |  |  |

### onErrorEventDetail

| 参数 | 类型 |
| --- | --- |
| errCode | `keyof AdErrCode` |

### AdErrCode

广告错误码

错误码是通过onError获取到的错误信息。调试期间，可以通过异常返回来捕获信息。
在小程序发布上线之后，如果遇到异常问题，可以在[“运维中心“](https://mp.weixin.qq.com/)里面搜寻错误日志，还可以针对异常返回加上适当的监控信息。

| 参数 | 异常情况 | 理由 | 解决方案 |
| --- | :---: | :---: | :---: |
| 1000 | `后端错误调用失败` | `该项错误不是开发者的异常情况` | `一般情况下忽略一段时间即可恢复。` |
| 1001 | `参数错误` | `使用方法错误` | `可以前往 developers.weixin.qq.com 确认具体教程（小程序和小游戏分别有各自的教程，可以在顶部选项中，“设计”一栏的右侧进行切换。` |
| 1002 | `广告单元无效` | `可能是拼写错误、或者误用了其他APP的广告ID` | `请重新前往 mp.weixin.qq.com 确认广告位ID。` |
| 1003 | `内部错误` | `该项错误不是开发者的异常情况` | `一般情况下忽略一段时间即可恢复。` |
| 1004 | `无合适的广告` | `广告不是每一次都会出现，这次没有出现可能是由于该用户不适合浏览广告` | `属于正常情况，且开发者需要针对这种情况做形态上的兼容。` |
| 1005 | `广告组件审核中` | `你的广告正在被审核，无法展现广告` | `请前往 mp.weixin.qq.com 确认审核状态，且开发者需要针对这种情况做形态上的兼容。` |
| 1006 | `广告组件被驳回` | `你的广告审核失败，无法展现广告` | `请前往 mp.weixin.qq.com 确认审核状态，且开发者需要针对这种情况做形态上的兼容。` |
| 1007 | `广告组件被封禁` | `你的广告能力已经被封禁，封禁期间无法展现广告` | `请前往 mp.weixin.qq.com 确认小程序广告封禁状态。` |
| 1008 | `广告单元已关闭` | `该广告位的广告能力已经被关闭` | `请前往 mp.weixin.qq.com 重新打开对应广告位的展现。` |

### onSizeEventDetail

| 参数 | 类型 |
| --- | --- |
| width | `number` |
| height | `number` |
</file>

<file path="docs/components/open/aweme-data.md">
---
title: AwemeData
sidebar_label: AwemeData
---

直播间状态组件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developer.open-douyin.com/docs/resource/zh-CN/mini-app/develop/component/open-capacity/aweme-data/)

## 类型

```tsx
ComponentType<AwemeDataProps>
```

## AwemeDataProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| awemeId | `string` |  | 否 | 用户的抖音号，可以进入抖音 App 用户个人主页查看 |
| type | `string` | `"avatar"` | 否 | 类型，可以选择头像或昵称 |
| disableDefault | `boolean` | `false` | 否 | 禁用默认行为。点击头像时，如果用户处于直播状态下默认会跳转到直播间，非直播状态下跳转到个人主页。如果为 true，点击头像时不会有默认行为。 |
| defaultAvatar | `string` |  | 否 | 获取信息失败时显示的默认头像 url |
| defaultText | `string` |  | 否 | 获取信息失败时显示的默认昵称文本 |
| onError | `CommonEventFunction` |  | 否 | 当错误发生时触发 |

### API 支持度

| API | 微信小程序 | 抖音小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| AwemeDataProps.awemeId |  | ✔️ |  |  |  |
| AwemeDataProps.type |  | ✔️ |  |  |  |
| AwemeDataProps.disableDefault |  | ✔️ |  |  |  |
| AwemeDataProps.defaultAvatar |  | ✔️ |  |  |  |
| AwemeDataProps.defaultText |  | ✔️ |  |  |  |
| AwemeDataProps.onError |  | ✔️ |  |  |  |
</file>

<file path="docs/components/open/comment-detail.md">
---
title: CommentDetail
sidebar_label: CommentDetail
---

评论详情

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/extended/component-content/comment-detail/)

## 类型

```tsx
ComponentType<CommentDetailProps>
```

## CommentDetailProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| commentParam | `ICommentParam` |  | 是 | 评论核心参数 |
| srid | `string` |  | 是 | 评论 ID |
| isPageScroll | `boolean` | `true` | 否 | 滚动方式为页面滚动，若组件作为浮层使用，该参数需设为 false |
| needToolbar | `boolean` | `true` | 否 | 是否需要底部 toolbar，若使用开发者自定义的底部 toolbar，该参数需设为 false |
| needLikeBtn | `boolean` | `true` | 否 | 是否需要详情顶部父级评论的点赞按钮，默认显示 |
| backListAfterDelete | `boolean` | `true` | 否 | 删除详情后是否返回列表项，默认一站式逻辑。若使用浮层，请设置改属性为 false |
| addComment | `boolean` | `false` | 否 | 用于调起评论发布器发布评论 |
| onDelete | `CommonEventFunction` |  | 否 | 删除整体详情内容时触发，返回数据为{status, data:{srid}} |
| onReply | `CommonEventFunction` |  | 否 | 评论发布成功时触发，返回数据为 {status, data:{srid}} |

### API 支持度

| API | 微信小程序 | 百度小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| CommentDetailProps.commentParam |  | ✔️ |  |  |  |
| CommentDetailProps.srid |  | ✔️ |  |  |  |
| CommentDetailProps.isPageScroll |  | ✔️ |  |  |  |
| CommentDetailProps.needToolbar |  | ✔️ |  |  |  |
| CommentDetailProps.needLikeBtn |  | ✔️ |  |  |  |
| CommentDetailProps.backListAfterDelete |  | ✔️ |  |  |  |
| CommentDetailProps.addComment |  | ✔️ |  |  |  |
| CommentDetailProps.onDelete |  | ✔️ |  |  |  |
| CommentDetailProps.onReply |  | ✔️ |  |  |  |

### ICommentParam

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| snid | `string` | 被点赞的文章的 id，与 path 参数一一对应<br />example: "20200101" |
| title | `string` | 文章标题 |
| path | `string` | 智能小程序内页链接，最长不能超过 194 字符<br />example: "/pages/index/index" |
</file>

<file path="docs/components/open/comment-list.md">
---
title: CommentList
sidebar_label: CommentList
---

评论列表

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/extended/component-content/comment-list/)

## 类型

```tsx
ComponentType<CommentListProps>
```

## CommentListProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| commentParam | `ICommentParam` |  | 是 | 评论核心参数 |
| toolbarConfig | `IToolbarConfig` |  | 否 | 底部 toolbar 的相关配置 |
| isPageScroll | `boolean` | `true` | 否 | 滚动方式为页面滚动，若组件作为浮层使用，该参数需设为 false |
| needToolbar | `boolean` | `true` | 否 | 是否需要底部 toolbar ，若使用开发者自定义的底部 toolbar ，该参数需设为 false |
| addComment | `boolean` | `false` | 否 | 用于调起评论发布器发布评论，发布成功插入列表第一条，且滚动到列表顶部 |
| detailPath | `string` |  | 否 | 点击单条评论跳转的详情页页面 path ，若没有配置则不会发生跳转；配置的前提是列表与详情均是页面级 |
| isFolded | `boolean` | `false` | 否 | 是否折叠列表，默认全展示 |
| foldNum | `number` | `3` | 否 | 折叠后列表展示最大条数，默认 3 条，最多 10 条 |
| viewMorePath | `string` |  | 否 | 传入放置评论组件的页面路径，如'/pages/list/index'，组件内部会触发跳转逻辑 |
| viewMoreStyle | `IViewMoreStyle` |  | 否 | 『全部 xx 条』的样式，目前只支持开发者自定义字体颜色 |
| onClickComment | `CommonEventFunction` |  | 否 | 绑定点击单条评论的事件，点击单条评论时触发，返回数据为{status, data:{srid}} |
| onViewMore | `CommonEventFunction` |  | 否 | 绑定点击更多事件，若除了页面跳转还需要其他操作，可通过该回调执行；若为浮层，也可使用该回调自定义交互逻辑 |
| onReply | `CommonEventFunction` |  | 否 | 评论发布成功时触发，返回数据为 {status, data:{srid}} |

### API 支持度

| API | 微信小程序 | 百度小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| CommentListProps.commentParam |  | ✔️ |  |  |  |
| CommentListProps.toolbarConfig |  | ✔️ |  |  |  |
| CommentListProps.isPageScroll |  | ✔️ |  |  |  |
| CommentListProps.needToolbar |  | ✔️ |  |  |  |
| CommentListProps.addComment |  | ✔️ |  |  |  |
| CommentListProps.detailPath |  | ✔️ |  |  |  |
| CommentListProps.isFolded |  | ✔️ |  |  |  |
| CommentListProps.foldNum |  | ✔️ |  |  |  |
| CommentListProps.viewMorePath |  | ✔️ |  |  |  |
| CommentListProps.viewMoreStyle |  | ✔️ |  |  |  |
| CommentListProps.onClickComment |  | ✔️ |  |  |  |
| CommentListProps.onViewMore |  | ✔️ |  |  |  |
| CommentListProps.onReply |  | ✔️ |  |  |  |

### ICommentParam

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| snid | `string` |  | 是 | 被点赞的文章的 id，与 path 参数一一对应<br />example: "20200101" |
| title | `string` |  | 是 | 文章标题 |
| path | `string` |  | 是 | 智能小程序内页链接，最长不能超过 194 字符<br />example: "/pages/index/index" |
| images | `string[]` | `['https://b.bdstatic.com/miniapp/images/demo-dog.png']` | 否 | 数组第一项用于收藏功能的展示图片 |

### IToolbarConfig

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| placeholder | `string` |  | 否 | 输入框提示文字 |
| moduleList | `string` | `['comment', 'like', 'favor', 'share']` | 否 | 显示的互动模块，对应默认值分别是：评论数、点赞、收藏、分享 |
| share | `IShare` |  | 否 | 若 moduleList 里配置了 share 模块，该参数为必填 |

### IShare

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| title | `string` | 是 | 分享标题 |
| content | `string` | 否 | 分享内容 |
| imageUrl | `string` | 否 | 分享图标 |
| path | `string` | 否 | 页面 path ，必须是以 / 开头的完整路径，如果 path 中参数包含中文字符，需对中文字符进行编码 |

### IViewMoreStyle

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| color | `string` | `"#3388ff"` | 否 | 『全部 xx 条』的字体颜色，默认为视觉提供色号，开发者可传入自定义色号 |
</file>

<file path="docs/components/open/contact-button.md">
---
title: ContactButton
sidebar_label: ContactButton
---

智能客服

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://opendocs.alipay.com/mini/component/contact-button)

## 类型

```tsx
ComponentType<ContactButtonProps>
```

## ContactButtonProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| tntInstId | `string` |  | 是 | 必填。企业唯一编码，一个企业支付宝账号对应一个编码。 |
| scene | `string` |  | 是 | 必填。聊天窗编码，每个聊天窗的唯一编码。 |
| size | string or number | `25` | 否 | 选填。咨询按钮大小，正方形设置边长（如25*25 px）。 |
| color | `string` | `"#00A3FF"` | 否 | 选填。咨询按钮颜色，默认白底蓝色。 |
| icon | `string` |  | 否 | 选填。咨询按钮头像。 |
| alipayCardNo | `string` |  | 否 | 选填。支付宝访客用户ID（2088开头）。<br />说明： 客服回答问题时，如客户已离开咨询窗口，则通过推送消息到支付宝 card 中提醒客户。 |
| extInfo | `string` |  | 否 | 选填。该属性主要用于传递一些扩展信息给组件，以实现一些高级功能。该属性值的生成方式为：encodeURIComponent({"字段名":"字段值"})， 其中，字段名和字段值要根据实际使用的功能进行替换。<br />目前通过传入扩展信息可支持的 3 个功能：<br />1.访客名片。需传 cinfo 和 key 两个扩展字段，代码形如在云客服中进入 设置 > 服务窗配置 > 聊天窗 URL。点击操作栏中的 聊天窗 URL ，获取 tntInstId（企业编码）和 scene（聊天窗编码）。encodeURIComponent({"cinfo":"生成的 cinfo","key":"生成的key"})，cinfo 和 key 的值说明 支付宝小程序接入访客名片；<br />2.聊天窗默认带出用户的小程序订单数据。需传 appId 字段，代码形如encodeURIComponent({"appId":"商户小程序appid"})<br />3.未读客服消息同步至"我的小程序-我的"。同样需传 appId 字段，代码形如 encodeURIComponent({"appId":"商户小程序appid"})。 |

### API 支持度

| API | 微信小程序 | 支付宝小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| ContactButtonProps.tntInstId |  | ✔️ |  |  |  |
| ContactButtonProps.scene |  | ✔️ |  |  |  |
| ContactButtonProps.size |  | ✔️ |  |  |  |
| ContactButtonProps.color |  | ✔️ |  |  |  |
| ContactButtonProps.icon |  | ✔️ |  |  |  |
| ContactButtonProps.alipayCardNo |  | ✔️ |  |  |  |
| ContactButtonProps.extInfo |  | ✔️ |  |  |  |
</file>

<file path="docs/components/open/follow-swan.md">
---
title: FollowSwan
sidebar_label: FollowSwan
---

关注小程序

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/extended/component-content/follow-swan/)

## 类型

```tsx
ComponentType<FollowSwanProps>
```

## FollowSwanProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| size | `string` | `"default"` | 否 | 组件大小 |
| type | `string` | `"primary"` | 否 | 组件样式 |
| onFavorStatusChange | `CommonEventFunction` |  | 否 | 关注和取消关注成功的回调，返回关注状态 {isFavor: trueorfalse} |

### API 支持度

| API | 微信小程序 | 百度小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| FollowSwanProps.size |  | ✔️ |  |  |  |
| FollowSwanProps.type |  | ✔️ |  |  |  |
| FollowSwanProps.onFavorStatusChange |  | ✔️ |  |  |  |
</file>

<file path="docs/components/open/inline-payment-panel.md">
---
title: InlinePaymentPanel
sidebar_label: InlinePaymentPanel
---

内嵌支付组件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/component/inline_payment_panel/)

## 类型

```tsx
ComponentType<InlinePaymentPanelProps>
```

## InlinePaymentPanelProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| totalAmount | `string` |  | 否 | 总金额，金额单位分，tip：仅支持整数型字符串 |
| dealId | `string` |  | 否 | 百度收银台的财务结算凭证，详见平台术语 |
| appKey | `string` |  | 否 | 支付能力开通后分配的支付 appKey，详见平台术语 |
| promotionTag | string or string[] |  | 否 | 平台营销信息，此处传当前订单中可使用平台券的 spuid，同时需在 支付能力中搭配使用传入该参数；注：仅与百度合作平台类目券的开发者需要填写该参数 |
| enablePageBackModal | `boolean` | `false` | 否 | 是否设置挽留弹窗 |
| customStyle | `string` |  | 否 | 自定义样式设置 |
| styleType | "tiny" or "small" or "default" or "medium" or "large" | `"default"` | 否 | 自定义样式档位配置，各档位配置项包括支付渠道/优惠券条高度、渠道图标大小、支付渠道文案字体大小、营销文案字体大小、选择器图标大小 |
| onGetPaymentInfo | `CommonEventFunction` |  | 否 | 获取支付相关信息，具体信息在返回值的 detail 字段中 |
| onError | `CommonEventFunction` |  | 否 | 当发生错误时触发 error 事件，具体信息在返回值的 detail 字段中，例如 {detail: {errMsg: "something is wrong"}} |

### API 支持度

| API | 微信小程序 | 百度小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| InlinePaymentPanelProps.totalAmount |  | ✔️ |  |  |  |
| InlinePaymentPanelProps.dealId |  | ✔️ |  |  |  |
| InlinePaymentPanelProps.appKey |  | ✔️ |  |  |  |
| InlinePaymentPanelProps.promotionTag |  | ✔️ |  |  |  |
| InlinePaymentPanelProps.enablePageBackModal |  | ✔️ |  |  |  |
| InlinePaymentPanelProps.customStyle |  | ✔️ |  |  |  |
| InlinePaymentPanelProps.styleType |  | ✔️ |  |  |  |
| InlinePaymentPanelProps.onGetPaymentInfo |  | ✔️ |  |  |  |
| InlinePaymentPanelProps.onError |  | ✔️ |  |  |  |
</file>

<file path="docs/components/open/lifestyle.md">
---
title: Lifestyle
sidebar_label: Lifestyle
---

关注生活号

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://opendocs.alipay.com/mini/component/lifestyle)

## 类型

```tsx
ComponentType<LifestyleProps>
```

## LifestyleProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| publicId | `string` | 否 | 必填，生活号 ID（即生活号 APPID），必须是当前小程序同账号主体且已关联的生活号。 |
| memo | `string` | 否 | 文案。支持商家自定义，最多展示一行。 |
| onFollow | `CommonEventFunction` | 否 | 当用户关注生活号成功后执行。 |

### API 支持度

| API | 微信小程序 | 支付宝小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| LifestyleProps.publicId |  | ✔️ |  |  |  |
| LifestyleProps.memo |  | ✔️ |  |  |  |
| LifestyleProps.onFollow |  | ✔️ |  |  |  |
</file>

<file path="docs/components/open/like.md">
---
title: Like
sidebar_label: Like
---

点赞

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/extended/component-content/like/)

## 类型

```tsx
ComponentType<LikeProps>
```

## LikeProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| isLiked | `boolean` | `false` | 否 | 是否已被点赞 |
| mode | `string` | `"icon"` | 否 | 按钮模式。icon：表示仅有图标；mixture：表示图标文字结合 |
| iconType | `string` | `"hand"` | 否 | 图标类型。hand：表示手形；heart：表示心形 |
| likeText | `string` | `"赞"` | 否 | 点赞按钮上的文案。默认为赞，仅在 mode 属性值为'mixture'时有效 |
| likeNum | `number` | `0` | 否 | 点赞数量 |
| likeType | `number` | `0` | 否 | 被点赞的对象类型。0：表示对文章内容进行点赞；1：表示对评论内容进行点赞 |
| animationType | `number` | `1` | 否 | 点赞动效形式。0：无动效；1：轻动效；2：强动效 |
| isShowToast | `boolean` | `false` | 否 | 点赞后是否弹出 toast 提示 |
| toastText | `string[]` | `['已点赞', '已取消']` | 否 | toast 文案，默认为已点赞、已取消 |
| likeParam | `ILikeParam` |  | 是 | 点赞服务需要的必要参数 |
| onError | `CommonEventFunction` |  | 否 | 使用 npm 方式引入点赞组件时，点击按钮时在用户未登录状态下会触发此事件；使用动态库方式引入点赞组件时，点击按钮时在用户未登录状态下不会触发此事件 |
| onSuccess | `CommonEventFunction` |  | 否 | 点击点赞按钮，在点赞服务成功后将状态返回给使用组件者 |
| onFail | `CommonEventFunction` |  | 否 | 点击点赞按钮，在点赞服务失败后将状态返回给使用组件者 |

### API 支持度

| API | 微信小程序 | 百度小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| LikeProps.isLiked |  | ✔️ |  |  |  |
| LikeProps.mode |  | ✔️ |  |  |  |
| LikeProps.iconType |  | ✔️ |  |  |  |
| LikeProps.likeText |  | ✔️ |  |  |  |
| LikeProps.likeNum |  | ✔️ |  |  |  |
| LikeProps.likeType |  | ✔️ |  |  |  |
| LikeProps.animationType |  | ✔️ |  |  |  |
| LikeProps.isShowToast |  | ✔️ |  |  |  |
| LikeProps.toastText |  | ✔️ |  |  |  |
| LikeProps.likeParam |  | ✔️ |  |  |  |
| LikeProps.onError |  | ✔️ |  |  |  |
| LikeProps.onSuccess |  | ✔️ |  |  |  |
| LikeProps.onFail |  | ✔️ |  |  |  |

### ILikeParam

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| openid | `string` | 是 | 用户身份唯一标识 |
| snid | `string` | 是 | 被点赞的文章的 id，与 path 参数一一对应<br />example: "20200101" |
| spid | `string` | 否 | 被点赞的评论 id |
| title | `string` | 是 | 文章标题 |
| path | `string` | 是 | 智能小程序内页链接，最长不能超过 194 字符<br />example: "/pages/index/index" |
</file>

<file path="docs/components/open/login.md">
---
title: Login
sidebar_label: Login
---

联合登录 / 手机号授权内嵌组件

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://smartprogram.baidu.com/docs/develop/component/login/)

## 类型

```tsx
ComponentType<LoginProps>
```

## LoginProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| buttonClass | `string` |  | 否 | 组件中用户授权按钮的类名，可用于自定义样式 |
| checkedColor | `string` | `"#3388FF"` | 否 | 组件中用户授权勾选框选中时的颜色，同 CSS 的 color |
| themeColor | `string` | `"#3388FF"` | 否 | 主题颜色，设置后将应用于 “用户授权按钮背景色” 和 “用户授权勾选框选中时的颜色”<br />注：theme-color 的优先级低于 button-class 和 checked-color，且当 button-class 存在时，theme-color 不生效 |
| onGetPhoneNumber | `CommonEventFunction` |  | 否 | 用户完成授权后，获取用户手机号：<br />detail.errMsg 值为"getPhoneNumber:ok" 时代表用户信息获取成功；<br />detail.errMsg 值为"getPhoneNumber:fail auth deny"时代表用户信息获取失败。<br />参考 用户数据的签名验证和加解密 对用户数据进行处理获得用户手机号。<br />用户手机号信息解密后数据示例：{"mobile":"15000000000"}<br />1. 非个人开发者可申请；<br />2. 审核通过后，进入小程序首页,在左侧导航栏单击“设置 -> 开发设置”。下拉页面，在“获取用户手机号权限申请”中单击“申请开通” |
| onLoadError | `CommonEventFunction` |  | 否 | 组件加载失败回调 |

### API 支持度

| API | 微信小程序 | 百度小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| LoginProps.buttonClass |  | ✔️ |  |  |  |
| LoginProps.checkedColor |  | ✔️ |  |  |  |
| LoginProps.themeColor |  | ✔️ |  |  |  |
| LoginProps.onGetPhoneNumber |  | ✔️ |  |  |  |
| LoginProps.onLoadError |  | ✔️ |  |  |  |
</file>

<file path="docs/components/open/official-account.md">
---
title: OfficialAccount
sidebar_label: OfficialAccount
---

公众号关注组件。当用户扫小程序码打开小程序时，开发者可在小程序内配置公众号关注组件，方便用户快捷关注公众号，可嵌套在原生组件内。

Tips
使用组件前，需前往小程序后台，在“设置”->“关注公众号”中设置要展示的公众号。注：设置的公众号需与小程序主体一致。

在一个小程序的生命周期内，只有从以下场景进入小程序，才具有展示引导关注公众号组件的能力:

当小程序从扫小程序码场景（场景值1047，场景值1124）打开时
当小程序从聊天顶部场景（场景值1089）中的「最近使用」内打开时，若小程序之前未被销毁，则该组件保持上一次打开小程序时的状态
当从其他小程序返回小程序（场景值1038）时，若小程序之前未被销毁，则该组件保持上一次打开小程序时的状态

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/official-account.html)

## 类型

```tsx
ComponentType<OfficialAccountProps>
```

## OfficialAccountProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| onLoad | `CommonEventFunction<Detail>` | 否 | 组件加载成功时触发 |
| onError | `CommonEventFunction<Detail>` | 否 | 组件加载失败时触发 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| OfficialAccountProps.onLoad | ✔️ |  |  |  |
| OfficialAccountProps.onError | ✔️ |  |  |  |

### Detail

detail 对象

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| status | `number` | 状态码 |
| errMsg | `string` | 错误信息 |

### Status

status 有效值

| 参数 | 说明 |
| --- | --- |
| -2 | 网络错误 |
| -1 | 数据解析错误 |
| 0 | 加载成功 |
| 1 | 小程序关注公众号功能被封禁 |
| 2 | 关联公众号被封禁 |
| 3 | 关联关系解除或未选中关联公众号 |
| 4 | 未开启关注公众号功能 |
| 5 | 场景值错误 |
| 6 | 重复创建 |
</file>

<file path="docs/components/open/open-data.md">
---
title: OpenData
sidebar_label: OpenData
---

用于展示平台开放的数据

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/open-data.html)

## 类型

```tsx
ComponentType<OpenDataProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Component {
  render () {
    return (
      <OpenData type='userAvatarUrl'/>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <open-data type="userAvatarUrl" />
</template>
```
</TabItem>
</Tabs>

## OpenDataProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| type | `keyof Type` |  | 是 | 开放数据类型 |
| openGid | `string` |  | 否 | 当 type="groupName" 时生效, 群id |
| lang | `keyof Lang` | `"en"` | 否 | 当 type="user*" 时生效，以哪种语言展示 userInfo |
| defaultText | `string` |  | 否 | 数据为空时的默认文案 |
| defaultAvatar | `string` |  | 否 | 用户头像为空时的默认图片，支持相对路径和网络图片路径 |
| useEmptyValue | `string` |  | 否 | 当数据为空且未设置默认值时，是否显示官方默认值 |
| shareTicket | `string` |  | 否 | 当 type=groupCloudStorage 时有效，群分享对应的 shareTicket |
| keyList | `string` |  | 否 | 当 type=*CloudStorage 时有效，指定要拉取的 key 列表 |
| componentData | `string` |  | 否 | 当 type=*CloudStorage 时有效，从主域透传给开放数据域的数据，会自动注入到自定义开放数据域组件的 properties 中 |
| onError | `CommonEventFunction` |  | 否 | 群名称或用户信息为空时触发 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 抖音小程序 | QQ 小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| OpenDataProps.type | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |
| OpenDataProps.openGid | ✔️ |  |  |  |  |  |  |
| OpenDataProps.lang | ✔️ |  |  | ✔️ |  |  |  |
| OpenDataProps.defaultText | ✔️ |  | ✔️ |  |  |  |  |
| OpenDataProps.defaultAvatar | ✔️ |  | ✔️ |  |  |  |  |
| OpenDataProps.useEmptyValue |  |  | ✔️ |  |  |  |  |
| OpenDataProps.shareTicket |  |  |  | ✔️ |  |  |  |
| OpenDataProps.keyList |  |  |  | ✔️ |  |  |  |
| OpenDataProps.componentData |  |  |  | ✔️ |  |  |  |
| OpenDataProps.onError | ✔️ |  | ✔️ | ✔️ |  |  |  |

### Type

type 的合法值

| 参数 | 说明 |
| --- | --- |
| groupName | 拉取群名称 |
| userNickName | 用户昵称 |
| userAvatarUrl | 用户头像 |
| userGender | 用户性别 |
| userCity | 用户所在城市 |
| userProvince | 用户所在省份 |
| userCountry | 用户所在国家 |
| userLanguage | 用户的语言 |

### Lang

lang 的合法值

| 参数 | 说明 |
| --- | --- |
| en | 英文 |
| zh_CN | 简体中文 |
| zh_TW | 繁体中文 |
</file>

<file path="docs/components/open/others.md">
---
title: 其他
sidebar_label: 其他
---

##### 其他组件

除导航列表的一些组件外，还有一些差异化组件，每个端不同，后续计划将这些统一封装。目前差异化组件请详看各小程序官网。

>其他组件请看各小程序官方文档

[微信小程序](https://developers.weixin.qq.com/miniprogram/dev/component/)。

[百度小程序](https://smartprogram.baidu.com/docs/develop/component/view/)。

[支付宝小程序](https://docs.alipay.com/mini/component/overview)。

[抖音小程序](https://developer.open-douyin.com/docs/resource/zh-CN/mini-app/develop/component/overview)。
</file>

<file path="docs/components/open/web-view.md">
---
title: WebView
sidebar_label: WebView
---

web-view 组件是一个可以用来承载网页的容器，会自动铺满整个小程序页面。个人类型与海外类型的小程序暂不支持使用。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/web-view.html)

## 类型

```tsx
ComponentType<WebViewProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Component {
  handleMessage () {}

  render () {
    return (
      <WebView src='https://mp.weixin.qq.com/' onMessage={this.handleMessage} />
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <web-view src='https://mp.weixin.qq.com/' @message="handleMessage" />
</template>
```
</TabItem>
</Tabs>

## WebViewProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| src | `string` |  | 是 | webview 指向网页的链接。可打开关联的公众号的文章，其它网页需登录小程序管理后台配置业务域名。 |
| progressbarColor | `string` |  | 否 | webview 的进度条颜色 |
| type | `string` | `default` | 否 | 若使用web-view组件引入第三方客服，必须填写type="im" |
| onMessage | `CommonEventFunction<onMessageEventDetail>` |  | 否 | 网页向小程序 postMessage 时，会在特定时机（小程序后退、组件销毁、分享）触发并收到消息。e.detail = { data } |
| onLoad | `CommonEventFunction<onLoadEventDetail>` |  | 否 | 网页加载成功时候触发此事件。e.detail = { src } |
| onError | `CommonEventFunction<onErrorEventDetail>` |  | 否 | 网页加载失败的时候触发此事件。e.detail = { src } |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| WebViewProps.src | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| WebViewProps.progressbarColor |  |  |  | ✔️ |  |  |  |  |  |  |  |
| WebViewProps.type |  |  |  | ✔️ |  |  |  |  |  |  |  |
| WebViewProps.onMessage | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| WebViewProps.onLoad | ✔️ |  | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |  | ✔️ | ✔️ |
| WebViewProps.onError | ✔️ |  | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |  | ✔️ | ✔️ |

### onMessageEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| data | `any[]` | 消息数据，是多次 postMessage 的参数组成的数组 |

### onLoadEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| src | `string` | 网页链接 |

### onErrorEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| src | `string` | 网页链接 |
</file>

<file path="docs/components/skyline/draggable-sheet.md">
---
title: DraggableSheet
sidebar_label: DraggableSheet
---

半屏可拖拽组件
该组件需配合 DraggableSheetContext 接口使用。 目前仅在 Skyline 渲染引擎下支持。
页面内拖拽是一种常见的交互效果，开发者可通过手势系统灵活实现。draggable-sheet 组件封装了常见的交互逻辑，实现起来更加简单。
该组件需结合 scroll-view 使用。scroll-view 组件声明 associative-container 属性后，可与 draggable-sheet 关联起来。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/draggable-sheet.html)

## 类型

```tsx
ComponentType<DraggableSheetProps>
```

## DraggableSheetProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| initialChildSize | `number` | `0.5` | 否 | 初始时占父容器的比例 |
| minChildSize | `number` | `0.25` | 否 | 最小时占父容器的比例 |
| maxChildSize | `number` | `1.0` | 否 | 最大时占父容器的比例 |
| snap | `boolean` | `false` | 否 | 拖拽后是否自动对齐关键点 |
| snapSizes | `any[]` | `[]` | 否 | 拖拽后对齐的关键点，无需包含最小和最大值 |
| onSizeUpdateWorklet | `string` |  | 否 | 尺寸发生变化时触发，仅支持 worklet 作为回调。event = {pixels, size} |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| DraggableSheetProps.initialChildSize | ✔️ |  |  |  |
| DraggableSheetProps.minChildSize | ✔️ |  |  |  |
| DraggableSheetProps.maxChildSize | ✔️ |  |  |  |
| DraggableSheetProps.snap | ✔️ |  |  |  |
| DraggableSheetProps.snapSizes | ✔️ |  |  |  |
| DraggableSheetProps.onSizeUpdateWorklet | ✔️ |  |  |  |
</file>

<file path="docs/components/skyline/grid-builder.md">
---
title: GridBuilder
sidebar_label: GridBuilder
---

网格构造器，仅支持作为 `<scroll-view type="custom">` 模式的直接子节点，仅 Skyline 支持。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/grid-builder.html)

## 类型

```tsx
ComponentType<GridBuilderProps>
```

## GridBuilderProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| type | "aligned" or "masonry" | `"aligned"<br /><br />可选值:<br />- aligned: 每行高度由同一行中最大高度子节点决定<br />- masonry: 瀑布流，根据子元素高度自动布局` | 是 | 布局方式 |
| list | `any[]` | `[]` | 是 | 需要用于渲染的列表 |
| childCount | `number` |  | 否 | 完整列表的长度，如果不传则取 list 的长度作为其值 |
| crossAxisCount | `number` | `2` | 否 | 交叉轴元素数量 |
| maxCrossAxisExtent | `number` | `0` | 否 | 交叉轴元素最大范围 |
| mainAxisGap | `number` | `0` | 否 | 主轴方向间隔 |
| crossAxisGap | `number` | `0` | 否 | 交叉轴方向间隔 |
| padding | `[number, number, number, number]` | `[0, 0, 0, 0]` | 否 | 长度为 4 的数组，按 top、right、bottom、left 顺序指定内边距 |
| onItemBuild | `CommonEventFunction` |  | 否 | 列表项创建时触发，event.detail = {index}，index 即被创建的列表项序号 |
| onItemDispose | `CommonEventFunction` |  | 否 | 列表项回收时触发，event.detail = {index}，index 即被回收的列表项序号 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| GridBuilderProps.type | ✔️ |  |  |  |
| GridBuilderProps.list | ✔️ |  |  |  |
| GridBuilderProps.childCount | ✔️ |  |  |  |
| GridBuilderProps.crossAxisCount | ✔️ |  |  |  |
| GridBuilderProps.maxCrossAxisExtent | ✔️ |  |  |  |
| GridBuilderProps.mainAxisGap | ✔️ |  |  |  |
| GridBuilderProps.crossAxisGap | ✔️ |  |  |  |
| GridBuilderProps.padding | ✔️ |  |  |  |
| GridBuilderProps.onItemBuild | ✔️ |  |  |  |
| GridBuilderProps.onItemDispose | ✔️ |  |  |  |
</file>

<file path="docs/components/skyline/grid-view.md">
---
title: GridView
sidebar_label: GridView
---

网格布局容器，仅支持作为 scroll-view 自定义模式下的直接子节点或 sticky-section 组件直接子节点。仅 Skyline 支持。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/grid-view.html)

## 类型

```tsx
ComponentType<GridViewProps>
```

## GridViewProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| type | "aligned" or "masonry" | `"aligned"<br /><br />可选值:<br />- aligned: 每行高度由同一行中最大高度子节点决定<br />- masonry: 瀑布流，根据子元素高度自动布局` | 是 | 布局方式 |
| crossAxisCount | `number` | `2` | 否 | 交叉轴元素数量 |
| mainAxisGap | `number` | `0` | 否 | 主轴方向间隔 |
| crossAxisGap | `number` | `0` | 否 | 交叉轴方向间隔 |
| maxCrossAxisExtent | `number` | `0` | 否 | 交叉轴元素最大范围 |
| padding | `[number, number, number, number]` | `[0, 0, 0, 0]` | 否 | 长度为 4 的数组，按 top、right、bottom、left 顺序指定内边距 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| GridViewProps.type | ✔️ |  |  |  |
| GridViewProps.crossAxisCount | ✔️ |  |  |  |
| GridViewProps.mainAxisGap | ✔️ |  |  |  |
| GridViewProps.crossAxisGap | ✔️ |  |  |  |
| GridViewProps.maxCrossAxisExtent | ✔️ |  |  |  |
| GridViewProps.padding | ✔️ |  |  |  |
</file>

<file path="docs/components/skyline/list-builder.md">
---
title: ListBuilder
sidebar_label: ListBuilder
---

列表构造器，仅支持作为 `<scroll-view type="custom">` 模式的直接子节点，仅 Skyline 支持。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/list-builder.html)

## 类型

```tsx
ComponentType<ListBuilderProps>
```

## ListBuilderProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| type | "static" or "dynamic" | `"aligned"<br /><br />可选值:<br />- static: 定高模式，所有列表项等高，需要传入 child-height<br />- dynamic: 不定高模式` | 是 | 布局方式 |
| list | `any[]` | `[]` | 是 | 需要用于渲染的列表 |
| childCount | `number` |  | 否 | 完整列表的长度，如果不传则取 list 的长度作为其值 |
| childHeight | `number` |  | 否 | 列表项的高度，当 type 为 static 时必须传入 |
| padding | `[number, number, number, number]` | `[0, 0, 0, 0]` | 否 | 长度为 4 的数组，按 top、right、bottom、left 顺序指定内边距 |
| onItemBuild | `CommonEventFunction` |  | 否 | 列表项创建时触发，event.detail = {index}，index 即被创建的列表项序号 |
| onItemDispose | `CommonEventFunction` |  | 否 | 列表项回收时触发，event.detail = {index}，index 即被回收的列表项序号 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| ListBuilderProps.type | ✔️ |  |  |  |
| ListBuilderProps.list | ✔️ |  |  |  |
| ListBuilderProps.childCount | ✔️ |  |  |  |
| ListBuilderProps.childHeight | ✔️ |  |  |  |
| ListBuilderProps.padding | ✔️ |  |  |  |
| ListBuilderProps.onItemBuild | ✔️ |  |  |  |
| ListBuilderProps.onItemDispose | ✔️ |  |  |  |
</file>

<file path="docs/components/skyline/list-view.md">
---
title: ListView
sidebar_label: ListView
---

列表布局容器，仅支持作为 scroll-view 自定义模式下的直接子节点或 sticky-section 组件直接子节点。仅 Skyline 支持。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/list-view.html)

## 类型

```tsx
ComponentType<ListViewProps>
```

## ListViewProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| padding | `[number, number, number, number]` | `[0, 0, 0, 0]` | 否 | 长度为 4 的数组，按 top、right、bottom、left 顺序指定内边距 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| ListViewProps.padding | ✔️ |  |  |  |
</file>

<file path="docs/components/skyline/nested-scroll-body.md">
---
title: NestedScrollBody
sidebar_label: NestedScrollBody
---

嵌套 scroll-view 场景中属于里层 scroll-view 的节点，
仅支持作为 `<scroll-view type="nested">` 模式的直接子节点。
不支持复数子节点，渲染时会取其第一个子节点来渲染。具体用法可参考 scroll-view

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/nested-scroll-body.html)

## 类型

```tsx
ComponentType<NestedScrollBodyProps>
```

## NestedScrollBodyProps
</file>

<file path="docs/components/skyline/nested-scroll-header.md">
---
title: NestedScrollHeader
sidebar_label: NestedScrollHeader
---

嵌套 scroll-view 场景中属于外层 scroll-view 的节点，
仅支持作为 `<scroll-view type="nested">` 模式的直接子节点。
不支持复数子节点，渲染时会取其第一个子节点来渲染。具体用法可参考 scroll-view

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/nested-scroll-header.html)

## 类型

```tsx
ComponentType<NestedScrollHeaderProps>
```

## NestedScrollHeaderProps
</file>

<file path="docs/components/skyline/open-container.md">
---
title: OpenContainer
sidebar_label: OpenContainer
---

容器转场动画组件
点击 OpenContainer 组件，当使用 wx.navigateTo 跳转下一页面时，对其子节点和下一个页面进行过渡。
下个页面从 OpenContainer 所在位置大小渐显放大，同时 OpenContainer 内容渐隐，过渡效果包含背景色、圆角和阴影。
源页面 OpenContainer 为 closed 状态，转场动画后为 open 状态。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/open-container.html)

## 类型

```tsx
ComponentType<OpenContainerProps>
```

## OpenContainerProps

| 参数 | 类型 | 默认值 | 说明 |
| --- | --- | :---: | --- |
| transitionType | "fade" or "fadeThrough" | `"fade"<br /><br />可选值:<br />- fade: 将传入元素淡入传出元素之上<br />- fadeThrough: 首先淡出传出元素，并在传出元素完全淡出后开始淡入传入元素` | 动画类型 |
| transitionDuration | `number` | `300` | 动画时长 |
| closedColor | `string` | `"white"` | 初始容器背景色 |
| closedElevation | `number` | `0` | 初始容器影深大小 |
| closeBorderRadius | `number` | `0` | 初始容器圆角大小 |
| middleColor | `string` | `""` | fadeThrough 模式下的过渡背景色 |
| openColor | `string` | `"white"` | 打开状态下容器背景色 |
| openElevation | `number` | `0` | 打开状态下容器影深大小 |
| openBorderRadius | `number` | `0` | 打开状态下容器圆角大小 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| OpenContainerProps.transitionType | ✔️ |  |  |  |
| OpenContainerProps.transitionDuration | ✔️ |  |  |  |
| OpenContainerProps.closedColor | ✔️ |  |  |  |
| OpenContainerProps.closedElevation | ✔️ |  |  |  |
| OpenContainerProps.closeBorderRadius | ✔️ |  |  |  |
| OpenContainerProps.middleColor | ✔️ |  |  |  |
| OpenContainerProps.openColor | ✔️ |  |  |  |
| OpenContainerProps.openElevation | ✔️ |  |  |  |
| OpenContainerProps.openBorderRadius | ✔️ |  |  |  |
</file>

<file path="docs/components/skyline/share-element.md">
---
title: ShareElement
sidebar_label: ShareElement
---

共享元素

共享元素是一种动画形式，类似于 [`flutter Hero`](https://flutterchina.club/animations/hero-animations/) 动画，表现为元素像是在页面间穿越一样。该组件需与 [`PageContainer`](/docs/components/viewContainer/page-container) 组件结合使用。
使用时需在当前页放置 `ShareElement` 组件，同时在 `PageContainer` 容器中放置对应的 `ShareElement` 组件，对应关系通过属性值 key 映射。当设置 `PageContainer` `显示时，transform` 属性为 `true` 的共享元素会产生动画。当前页面容器退出时，会产生返回动画。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/share-element.html)

## 类型

```tsx
ComponentType<ShareElementProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }]}>
<TabItem value="React">

```tsx
// index.js
import { useState, useCallback } from 'react'
import { View, Button, PageContainer, ShareElement } from '@tarojs/components'

import './index.scss'

const contacts = [
  { id: 1, name: 'Frank', img: 'frank.png', phone: '0101 123456', mobile: '0770 123456', email: 'frank@emailionicsorter.com' },
  { id: 2, name: 'Susan', img: 'susan.png', phone: '0101 123456', mobile: '0770 123456', email: 'frank@emailionicsorter.com' },
  { id: 3, name: 'Emma', img: 'emma.png', phone: '0101 123456', mobile: '0770 123456', email: 'frank@emailionicsorter.com' },
  { id: 4, name: 'Scott', img: 'scott.png', phone: '0101 123456', mobile: '0770 123456', email: 'frank@emailionicsorter.com' },
  { id: 5, name: 'Bob', img: 'bob.png', phone: '0101 123456', mobile: '0770 123456', email: 'frank@emailionicsorter.com' },
  { id: 6, name: 'Olivia', img: 'olivia.png', phone: '0101 123456', mobile: '0770 123456', email: 'frank@emailionicsorter.com' },
  { id: 7, name: 'Anne', img: 'anne.png', phone: '0101 123456', mobile: '0770 123456', email: 'frank@emailionicsorter.com' },
  { id: 8, name: 'sunny', img: 'olivia.png', phone: '0101 123456', mobile: '0770 123456', email: 'frank@emailionicsorter.com' }
]

export default function () {
  const [show, setShow] = useState(false)
  const [contact, setContact] = useState(contacts[0])
  const [transformIdx, setTransformIdx] = useState(0)

  const onBeforeEnter = useCallback((res) => {
    console.log('onBeforeEnter: ', res)
  }, [])
  const onEnter = useCallback((res) => {
    console.log('onEnter: ', res)
  }, [])
  const onAfterEnter = useCallback((res) => {
    console.log('onAfterEnter: ', res)
  }, [])
  const onBeforeLeave = useCallback((res) => {
    console.log('onBeforeLeave: ', res)
  }, [])
  const onLeave = useCallback((res) => {
    console.log('onLeave: ', res)
  }, [])
  const onAfterLeave = useCallback((res) => {
    console.log('onAfterLeave: ', res)
  }, [])

  const showNext = (e, index) => {
    setShow(true)
    setContact(contacts[index])
    setTransformIdx(index)
  }

  const showPrev = useCallback(() => {
    setShow(false)
  }, [])

  return (
    <View>
      <View className="screen screen1">
        {
          contacts.map((item, index) => (
            <View key={item.id} className="contact" onClick={e => showNext(e, index)}>
              <ShareElement duration={300} className="name" key="name" transform={transformIdx === index}>
                {item.name}
              </ShareElement>
              <View className="list">
                <View>Phone: {item.phone}</View>
                <View>Mobile: {item.mobile}</View>
                <View>Email: {item.email}</View>
              </View>
            </View>
          ))
        }
      </View>
      <PageContainer
        show={show}
        overlay={false}
        closeOnSlideDown
        duration={300}
        position='center'
        onBeforeEnter={onBeforeEnter}
        onEnter={onEnter}
        onAfterEnter={onAfterEnter}
        onBeforeLeave={onBeforeLeave}
        onLeave={onLeave}
        onAfterLeave={onAfterLeave}
      >
        <View className="screen screen2">
          <View className="contact">
            <ShareElement className="name" key="name" duration={300} transform>
              {contact.name}
            </ShareElement>
            <View className={`paragraph ${show ? 'enter' : ''}`}>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus nisl enim, sodales non augue efficitur, sagittis
              varius neque. Fusce dolor turpis, maximus eu volutpat quis, pellentesque et ligula. Ut vehicula metus in nibh
              mollis ornare. Etiam aliquam lacinia malesuada. Vestibulum dignissim mollis quam a tristique. Maecenas neque
              mauris, malesuada vitae magna eu, congue consectetur risus. Etiam vitae pulvinar ex. Maecenas suscipit mi ac
              imperdiet pretium. Aliquam velit mauris, euismod quis elementum sed, malesuada non dui. Nunc rutrum sagittis
              ligula in dapibus. Cras suscipit ut augue eget mollis. Donec auctor feugiat ipsum id viverra. Vestibulum eu nisi
              risus. Vestibulum eleifend dignissim.

            </View>
            <Button className="screen2-button" onClick={showPrev} hidden={!show} hoverClass="none">Click Me</Button>
          </View>
        </View>
      </PageContainer>
    </View>
  )
}
```
```scss
\/** index.scss *\/
page {
  color: #333;
  background-color: #ddd;
  overflow: hidden;
}

button {
  border: 0 solid #0010ae;
  background-color: #1f2afe;
  color: #fff;
  font-size: 120%;
  padding: 8px 16px;
  outline-width: 0;
  -webkit-appearance: none;
  box-shadow: 0 8px 17px rgba(0, 0, 0, 0.2);
}

.screen {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 16px;
  -webkit-overflow-scrolling: touch;
}

.contact {
  position: relative;
  padding: 16px;
  background-color: #fff;
  width: 100%;
  height: 100%;
  box-sizing: border-box;
}

.avatar {
  position: absolute;
  top: 16px;
  left: 16px;
  font-size: 0;
}

.name {
  height: 65px;
  font-size: 2em;
  font-weight: bold;
  text-align: center;
  margin: 10px 0;
}

.list {
  padding-top: 8px;
  padding-left: 32px;
}

.screen1 {
  overflow-y: scroll;
  padding: 0;
}

.screen1 .contact {
  margin: 16px;
  height: auto;
  width: auto;
  box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.2);
}

.screen2-button {
  display: block;
  margin: 24px auto;
}

.paragraph {
  -webkit-transition: transform ease-in-out 300ms;
  transition: transform ease-in-out 300ms;
  -webkit-transform: scale(0.6);
  transform: scale(0.6);
}

.enter.paragraph {
  transform: none;
}
```
</TabItem>
</Tabs>

## ShareElementProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| key | `string` |  | 否 | 映射标记<br />不推荐: 使用mapkey替换key |
| mapkey | `string` |  | 否 | 映射标记 |
| name | `string` |  | 否 | 映射标记 |
| transform | `boolean` | `false` | 否 | 是否进行动画 |
| duration | `number` | `300` | 否 | 动画时长，单位毫秒 |
| easingFunction | `string` | `ease-out` | 否 | css缓动函数 |
| transitionOnGesture | `boolean` | `false` | 否 | 手势返回时是否进行动画 |
| shuttleOnPush | "from" or "to" | `"to"` | 否 | 指定 push 阶段的飞跃物 |
| shuttleOnPop | `string` | `"to"` | 否 | 指定 pop 阶段的飞跃物 |
| rectTweenType | "materialRectArc" or "materialRectCenterArc" or "linear" or "elasticIn" or "elasticOut" or "elasticInOut" or "bounceIn" or "bounceOut" or "bounceInOut" or "cubic-bezier(x1, y1, x2, y2)" | `"materialRectArc"` | 否 | 动画插值曲线 |
| onFrameWorklet | `string` |  | 否 | 动画帧回调 |

### API 支持度

| API | 微信小程序 | 支付宝小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: |
| ShareElementProps.key | ✔️ |  |  |  |  |
| ShareElementProps.mapkey | ✔️ |  |  |  |  |
| ShareElementProps.name |  | ✔️ |  |  |  |
| ShareElementProps.transform | ✔️ | ✔️ |  |  |  |
| ShareElementProps.duration | ✔️ | ✔️ |  |  |  |
| ShareElementProps.easingFunction | ✔️ | ✔️ |  |  |  |
| ShareElementProps.transitionOnGesture | ✔️ |  |  |  |  |
| ShareElementProps.shuttleOnPush | ✔️ |  |  |  |  |
| ShareElementProps.shuttleOnPop | ✔️ |  |  |  |  |
| ShareElementProps.rectTweenType | ✔️ |  |  |  |  |
| ShareElementProps.onFrameWorklet | ✔️ |  |  |  |  |
</file>

<file path="docs/components/skyline/snapshot.md">
---
title: Snapshot
sidebar_label: Snapshot
---

截图组件
支持将其子节点的渲染结果导出成图片，该组件需配合 snapshot 接口使用。 目前仅在 Skyline 渲染引擎 下支持。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/snapshot.html)

## 类型

```tsx
ComponentType<SnapshotProps>
```

## SnapshotProps

| 参数 | 类型 | 默认值 | 说明 |
| --- | --- | :---: | --- |
| mode | "view" or "picture" | `'view'<br /><br />可选值:<br />- view: 以真实节点渲染<br />- picture: 对子节点生成的内容截图渲染` | 渲染模式 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| SnapshotProps.mode | ✔️ |  |  |  |
</file>

<file path="docs/components/skyline/span.md">
---
title: Span
sidebar_label: Span
---

用于支持内联文本和 image / navigator 的混排

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/span.html)

## 类型

```tsx
ComponentType<SpanProps>
```

## SpanProps
</file>

<file path="docs/components/skyline/sticky-header.md">
---
title: StickyHeader
sidebar_label: StickyHeader
---

吸顶布局容器，仅支持作为 scroll-view 自定义模式下的直接子节点或 sticky-section 组件直接子节点。仅 Skyline 支持。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/sticky-header.html)

## 类型

```tsx
ComponentType<StickyHeaderProps>
```

## StickyHeaderProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| offsetTop | `number` | `0` | 否 | 吸顶时与顶部的距(px) |
| padding | `[number, number, number, number]` | `[0, 0, 0, 0]` | 否 | 长度为 4 的数组，按 top、right、bottom、left 顺序指定内边距 |
| onStickOnTopChange | `CommonEventFunction` |  | 否 | 吸顶状态变化事件，仅支持非 worklet 的组件方法作为回调。event.detail = { isStickOnTop }，当 sticky-header 吸顶时为 true，否则为 false。<br />version: >=3.6.2 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| StickyHeaderProps.offsetTop | ✔️ |  |  |  |
| StickyHeaderProps.padding | ✔️ |  |  |  |
| StickyHeaderProps.onStickOnTopChange | ✔️ |  |  |  |
</file>

<file path="docs/components/skyline/sticky-section.md">
---
title: StickySection
sidebar_label: StickySection
---

吸顶布局容器，仅支持作为 scroll-view 自定义模式下的直接子节点。仅 Skyline 支持。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/sticky-section.html)

## 类型

```tsx
ComponentType<StickySectionProps>
```

## StickySectionProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| pushPinnedHeader | `boolean` | `true` | 否 | 吸顶元素重叠时是否继续上推 |
| padding | `[number, number, number, number]` | `[0, 0, 0, 0]` | 否 | 长度为 4 的数组，按 top、right、bottom、left 顺序指定内边距 |

### API 支持度

| API | 微信小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: |
| StickySectionProps.pushPinnedHeader | ✔️ |  |  |  |
| StickySectionProps.padding | ✔️ |  |  |  |
</file>

<file path="docs/components/viewContainer/cover-image.md">
---
title: CoverImage
sidebar_label: CoverImage
---

覆盖在原生组件之上的图片视图。可覆盖的原生组件同cover-view，支持嵌套在cover-view里。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/cover-image.html)

## 类型

```tsx
ComponentType<CoverImageProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
// js
class App extends Components {
  render () {
    return (
      <View className='container'>
      <Video id='myVideo' src='src'>
        <CoverView className='controls'>
          <CoverView className='play' onClick='play'>
            <CoverImage className='img' src='src' />
          </CoverView>
        </CoverView>
      </Video>
    )
  }
}
// css
.container {
  position: relative;
}
.controls {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 300px;
  height: 225px;
  transform: translate(-50%, -50%);
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="container">
    <video id='myvideo' src='https://ugccsy.qq.com/uwMROfz2r5zBIaQXGdGnC2dfDma3J1MItM3912IN4IRQvkRM/o31507f7lcd.mp4?sdtfrom=v1010&guid=aa18cf106b7fdb7e40f2d20b206f2b4f&vkey=63B0FCCC7FC3ADC342C166D86571AE02772258CD9B515B065DC68DF3919D8C288AE831D570ED5E8FE0FF3E81E170D04FF11F874BFDDACF7AAA2C0CFF2ACB39FB1A94DAD1AB859BDA53E4DD6DBCDC1217CEF789A9AC079924E2BBC599EED7A1FFDD60A727F2EB7E7B6472CE63DD4B683C9199DFC78A6A6C4D9891E05467C4B64E'>
    </video>
    <cover-view class='controls'>
      <cover-view class='play' @tap='play'>
        <cover-image class='img' src='https://img10.360buyimg.com/ling/s345x208_jfs/t1/133501/7/9865/382161/5f5ee31fEbdd6a418/0cdc0156ffff3c23.png' />
      </cover-view>
    </cover-view>
  </view>
</template>

<style>
.container {
  position: relative;
}
.controls {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 300px;
  height: 225px;
  transform: translate(-50%, -50%);
}
</style>
```
</TabItem>
</Tabs>

## CoverImageProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| src | `string` | 是 | 图标路径，支持临时路径、网络地址、云文件ID。暂不支持base64格式。 |
| referrerPolicy | "origin" or "no-referrer" | 否 | 格式固定为 https://servicewechat.com/{appid}/{version}/page-frame.html，其中 {appid} 为小程序的 appid，{version} 为小程序的版本号，版本号为 0 表示为开发版、体验版以及审核版本，版本号为 devtools 表示为开发者工具，其余为正式版本； |
| fixedTop | `string` | 否 | 设置与容器顶部的固定距离，效果相当于在 CSS 中设置 position: fixed 和 top 值，该属性优先级高于 fixed-bottom，CSS 设置的 position、top、bottom 值 |
| fixedRight | `string` | 否 | 设置与容器右侧的固定距离，效果相当于在 CSS 中设置 position: fixed 和 right 值，该属性优先级高于 CSS 设置的 position、left、right 值 |
| fixedBottom | `string` | 否 | 设置与容器底部的固定距离，效果相当于在 CSS 中设置 position: fixed 和 bottom 值，该属性优先级高于 CSS 设置的 position、top、bottom 值 |
| fixedLeft | `string` | 否 | 设置与容器左侧的固定距离，效果相当于在 CSS 中设置 position: fixed 和 left 值，该属性优先级高于 fixed-right，CSS 设置的 position、left、right 值 |
| ariaRole | `string` | 否 | 无障碍访问，（角色）标识元素的作用 |
| ariaLabel | `string` | 否 | 无障碍访问，（属性）元素的额外描述 |
| onLoad | `CommonEventFunction` | 否 | 图片加载成功时触发 |
| onError | `CommonEventFunction` | 否 | 图片加载失败时触发 |
| onTap | `CommonEventFunction` | 否 | 点击事件回调。 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| CoverImageProps.src | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |
| CoverImageProps.referrerPolicy | ✔️ |  |  |  |  |  |  |  |  |  |
| CoverImageProps.fixedTop |  | ✔️ |  |  |  |  |  |  |  |  |
| CoverImageProps.fixedRight |  | ✔️ |  |  |  |  |  |  |  |  |
| CoverImageProps.fixedBottom |  | ✔️ |  |  |  |  |  |  |  |  |
| CoverImageProps.fixedLeft |  | ✔️ |  |  |  |  |  |  |  |  |
| CoverImageProps.ariaRole |  |  |  | ✔️ |  |  |  |  |  |  |
| CoverImageProps.ariaLabel |  |  |  | ✔️ |  |  |  |  |  |  |
| CoverImageProps.onLoad | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |
| CoverImageProps.onError | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |
| CoverImageProps.onTap |  |  | ✔️ |  |  |  |  |  |  |  |
</file>

<file path="docs/components/viewContainer/cover-view.md">
---
title: CoverView
sidebar_label: CoverView
---

覆盖在原生组件之上的文本视图。可覆盖的原生组件包括 map、video、canvas、camera、live-player、live-pusher 只支持嵌套 cover-view、cover-image，可在 cover-view 中使用 button。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/cover-view.html)

## 类型

```tsx
ComponentType<CoverViewProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
// js
class App extends Components {
  render () {
    return (
      <View className='container'>
        <Video id='myVideo' src='src'>
          <CoverView className='controls'>
            <CoverView className='play' onClick='play'>
              <CoverImage className='img' src='src' />
            </CoverView>
          </CoverView>
        </Video>
      </View>
    )
  }
}
// css
.container {
  position: relative;
}
.controls {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 300px;
  height: 225px;
  transform: translate(-50%, -50%);
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="container">
    <video id='myvideo' src='https://ugccsy.qq.com/uwMROfz2r5zBIaQXGdGnC2dfDma3J1MItM3912IN4IRQvkRM/o31507f7lcd.mp4?sdtfrom=v1010&guid=aa18cf106b7fdb7e40f2d20b206f2b4f&vkey=63B0FCCC7FC3ADC342C166D86571AE02772258CD9B515B065DC68DF3919D8C288AE831D570ED5E8FE0FF3E81E170D04FF11F874BFDDACF7AAA2C0CFF2ACB39FB1A94DAD1AB859BDA53E4DD6DBCDC1217CEF789A9AC079924E2BBC599EED7A1FFDD60A727F2EB7E7B6472CE63DD4B683C9199DFC78A6A6C4D9891E05467C4B64E'>
    </video>
    <cover-view class='controls'>
      <cover-view class='play' @tap='play'>
        <cover-image class='img' src='https://img10.360buyimg.com/ling/s345x208_jfs/t1/133501/7/9865/382161/5f5ee31fEbdd6a418/0cdc0156ffff3c23.png' />
      </cover-view>
    </cover-view>
  </view>
</template>

<style>
.container {
  position: relative;
}
.controls {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 300px;
  height: 225px;
  transform: translate(-50%, -50%);
}
</style>
```
</TabItem>
</Tabs>

## CoverViewProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| scrollTop | `number` |  | 否 | 设置顶部滚动偏移量，仅在设置了 overflow-y: scroll 成为滚动元素后生效 |
| fixedTop | `string` |  | 否 | 设置与容器顶部的固定距离，效果相当于在 CSS 中设置 position: fixed 和 top 值，该属性优先级高于 fixed-bottom，CSS 设置的 position、top、bottom 值 |
| fixedRight | `string` |  | 否 | 设置与容器右侧的固定距离，效果相当于在 CSS 中设置 position: fixed 和 right 值，该属性优先级高于 CSS 设置的 position、left、right 值 |
| fixedBottom | `string` |  | 否 | 设置与容器底部的固定距离，效果相当于在 CSS 中设置 position: fixed 和 bottom 值，该属性优先级高于 CSS 设置的 position、top、bottom 值 |
| fixedLeft | `string` |  | 否 | 设置与容器左侧的固定距离，效果相当于在 CSS 中设置 position: fixed 和 left 值，该属性优先级高于 fixed-right，CSS 设置的 position、left、right 值 |
| ariaRole | `string` |  | 否 | 无障碍访问，（角色）标识元素的作用 |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |
| scrollX | `boolean` | `false` | 否 | 允许横向滚动。 |
| scrollY | `boolean` | `false` | 否 | 允许纵向滚动。 |
| upperThreshold | `number` | `50` | 否 | 距顶部/左边多远时（单位px），触发 scrolltoupper 事件。 |
| lowerThreshold | `number` | `50` | 否 | 距底部/右边多远时（单位px），触发 scrolltolower 事件。 |
| scrollLeft | `number` |  | 否 | 设置横向滚动条位置。 |
| scrollIntoView | `string` |  | 否 | 滚动到子元素，值应为某子元素的 id。当滚动到该元素时，元素顶部对齐滚动区域顶部。<br />说明：scroll-into-view 的优先级高于 scroll-top。 |
| scrollWithAnimation | `boolean` | `false` | 否 | 在设置滚动条位置时使用动画过渡。 |
| scrollAnimationDuration | `number` |  | 否 | 当 scroll-with-animation设置为 true 时，可以设置 scroll-animation-duration 来控制动画的执行时间，单位 ms。 |
| enableBackToTop | `boolean` | `false` | 否 | 当点击 iOS 顶部状态栏或者双击 Android 标题栏时，滚动条返回顶部，只支持竖向。 |
| trapScroll | `boolean` | `false` | 否 | 纵向滚动时，当滚动到顶部或底部时，强制禁止触发页面滚动，仍然只触发 scroll-view 自身的滚动。 |
| disableLowerScroll | `string` |  | 否 | 发生滚动前，对滚动方向进行判断，当方向是顶部/左边时，如果值为 always 将始终禁止滚动，如果值为 out-of-bounds 且当前已经滚动到顶部/左边，禁止滚动。 |
| disableUpperScroll | `string` |  | 否 | 发生滚动前，对滚动方向进行判断，当方向是底部/右边时，如果值为 always 将始终禁止滚动，如果值为 out-of-bounds 且当前已经滚动到底部/右边，禁止滚动。 |
| onScrollToUpper | `CommonEventFunction` |  | 否 | 滚动到顶部/左边，会触发 scrolltoupper 事件。 |
| onScrollToLower | `CommonEventFunction` |  | 否 | 滚动到底部/右边，会触发 scrolltolower事件。 |
| onScroll | `CommonEventFunction` |  | 否 | 滚动时触发，event.detail = {scrollLeft, scrollTop, scrollHeight, scrollWidth}。 |
| onTouchStart | `CommonEventFunction` |  | 否 | 触摸动作开始。 |
| onTouchMove | `CommonEventFunction` |  | 否 | 触摸后移动。 |
| onTouchEnd | `CommonEventFunction` |  | 否 | 触摸动作结束。 |
| onTouchCancel | `CommonEventFunction` |  | 否 | 触摸动作被打断，如来电提醒、弹窗。 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| CoverViewProps.scrollTop | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |
| CoverViewProps.fixedTop |  | ✔️ |  |  |  |  |  |  |  |
| CoverViewProps.fixedRight |  | ✔️ |  |  |  |  |  |  |  |
| CoverViewProps.fixedBottom |  | ✔️ |  |  |  |  |  |  |  |
| CoverViewProps.fixedLeft |  | ✔️ |  |  |  |  |  |  |  |
| CoverViewProps.ariaRole |  |  |  | ✔️ |  |  |  |  |  |
| CoverViewProps.ariaLabel |  |  |  | ✔️ |  |  |  |  |  |
| CoverViewProps.scrollX |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.scrollY |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.upperThreshold |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.lowerThreshold |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.scrollLeft |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.scrollIntoView |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.scrollWithAnimation |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.scrollAnimationDuration |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.enableBackToTop |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.trapScroll |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.disableLowerScroll |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.disableUpperScroll |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.onScrollToUpper |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.onScrollToLower |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.onScroll |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.onTouchStart |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.onTouchMove |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.onTouchEnd |  |  | ✔️ |  |  |  |  |  |  |
| CoverViewProps.onTouchCancel |  |  | ✔️ |  |  |  |  |  |  |
</file>

<file path="docs/components/viewContainer/custom-wrapper.md">
---
title: CustomWrapper
sidebar_label: CustomWrapper
---

custom-wrapper 自定义组件包裹器
当数据更新层级较深时，可用此组件将需要更新的区域包裹起来，这样更新层级将大大减少

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
ComponentType<CustomWrapperProps>
```

## 示例代码

```tsx
import { Component } from 'react'
import { CustomWrapper, View, Text } from '@tarojs/components'

export default class C extends Component {
  render () {
    return (
      <View>
        <CustomWrapper>
           <Text>Hello, world!</Text>
        </CustomWrapper>
      </View>
    )
  }
}
```

## CustomWrapperProps
</file>

<file path="docs/components/viewContainer/match-media.md">
---
title: MatchMedia
sidebar_label: MatchMedia
---

media query 匹配检测节点。可以指定一组 media query 规则，满足时，这个节点才会被展示。
通过这个节点可以实现“页面宽高在某个范围时才展示某个区域”这样的效果。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/match-media.html)

## 类型

```tsx
ComponentType<MatchMediaProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Components {
  render () {
    return (
      <View>
        <MatchMedia minWidth="300" maxWidth="600">
          <view>当页面宽度在 300 ~ 500 px 之间时展示这里</view>
        </MatchMedia>
        <MatchMedia minHeight="400" orientation="landscape">
          <view>当页面高度不小于 400 px 且屏幕方向为纵向时展示这里</view>
        </MatchMedia>
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="components-page">
    <match-media min-width="300" max-width="500">
      <view>当页面宽度在 300 ~ 500 px 之间时展示这里</view>
    </match-media>
    <match-media min-height="400" orientation="landscape">
      <view>当页面高度不小于 400 px 且屏幕方向为纵向时展示这里</view>
    </match-media>
  </view>
</template>
```
</TabItem>
</Tabs>

## MatchMediaProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| minWidth | `number` | 否 | 页面最小宽度（ px 为单位） |
| maxWidth | `number` | 否 | 页面最大宽度（ px 为单位） |
| width | `number` | 否 | 页面宽度（ px 为单位） |
| minHeight | `number` | 否 | 页面最小高度（ px 为单位） |
| maxHeight | `number` | 否 | 页面最大高度（ px 为单位） |
| height | `number` | 否 | 页面高度（ px 为单位） |
| orientation | `string` | 否 | 屏幕方向（ landscape 或 portrait ） |

### API 支持度

| API | 微信小程序 | 支付宝小程序 | 京东小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| MatchMediaProps.minWidth | ✔️ | ✔️ | ✔️ |  |  |  |  |
| MatchMediaProps.maxWidth | ✔️ | ✔️ | ✔️ |  |  |  |  |
| MatchMediaProps.width | ✔️ | ✔️ | ✔️ |  |  |  |  |
| MatchMediaProps.minHeight | ✔️ | ✔️ | ✔️ |  |  |  |  |
| MatchMediaProps.maxHeight | ✔️ | ✔️ | ✔️ |  |  |  |  |
| MatchMediaProps.height | ✔️ | ✔️ | ✔️ |  |  |  |  |
| MatchMediaProps.orientation | ✔️ | ✔️ | ✔️ |  |  |  |  |
</file>

<file path="docs/components/viewContainer/movable-area.md">
---
title: MovableArea
sidebar_label: MovableArea
---

movable-view 的可移动区域

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/movable-area.html)

## 类型

```tsx
ComponentType<MovableAreaProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Components {
  render () {
    return (
      <MovableArea style='height: 200px; width: 200px; background: red;'>
        <MovableView style='height: 50px; width: 50px; background: blue;' direction='all'>旅行的意义</MovableView>
      </MovableArea>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
  <movable-area style='height: 200px; width: 200px; background: red;'>
    <movable-view style='height: 50px; width: 50px; background: blue;' direction='all'>在路上</movable-view>
  </movable-area>
```
</TabItem>
</Tabs>

## MovableAreaProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| scaleArea | `boolean` | `false` | 否 | 当里面的 movable-view 设置为支持双指缩放时，设置此值可将缩放手势生效区域修改为整个 movable-area |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| MovableAreaProps.scaleArea | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
</file>

<file path="docs/components/viewContainer/movable-view.md">
---
title: MovableView
sidebar_label: MovableView
---

可移动的视图容器，在页面中可以拖拽滑动。movable-view 必须在 movable-area 组件中，并且必须是直接子节点，否则不能移动。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/movable-view.html)

## 类型

```tsx
ComponentType<MovableViewProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Components {
  render () {
    return (
      <MovableArea style='height: 200px; width: 200px; background: red;'>
        <MovableView style='height: 50px; width: 50px; background: blue;' direction='all'></MovableView>
      </MovableArea>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
  <movable-area style='height: 200px; width: 200px; background: red;'>
    <movable-view style='height: 50px; width: 50px; background: blue;' direction='all'>带我走</movable-view>
  </movable-area>
```
</TabItem>
</Tabs>

## MovableViewProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| direction | "all" or "vertical" or "horizontal" or "none" | `none` | 否 | movable-view 的移动方向，属性值有`all`、`vertical`、`horizontal`、`none` |
| inertia | `boolean` | `false` | 否 | movable-view 是否带有惯性 |
| outOfBounds | `boolean` | `false` | 否 | 超过可移动区域后，movable-view 是否还可以移动 |
| x | string or number |  | 否 | 定义 x 轴方向的偏移，如果 x 的值不在可移动范围内，会自动移动到可移动范围；改变 x 的值会触发动画 |
| y | string or number |  | 否 | 定义 y 轴方向的偏移，如果 y 的值不在可移动范围内，会自动移动到可移动范围；改变 y 的值会触发动画 |
| damping | `number` | `20` | 否 | 阻尼系数，用于控制x或y改变时的动画和过界回弹的动画，值越大移动越快 |
| friction | `number` | `2` | 否 | 摩擦系数，用于控制惯性滑动的动画，值越大摩擦力越大，滑动越快停止；必须大于 0，否则会被设置成默认值 |
| disabled | `boolean` | `false` | 否 | 是否禁用 |
| scale | `boolean` | `false` | 否 | 是否支持双指缩放，默认缩放手势生效区域是在 movable-view 内 |
| scaleMin | `number` | `0.5` | 否 | 定义缩放倍数最小值 |
| scaleMax | `number` | `10` | 否 | 定义缩放倍数最大值 |
| scaleValue | `number` | `1` | 否 | 定义缩放倍数，取值范围为 0.5 - 10 |
| animation | `boolean` | `true` | 否 | 是否使用动画 |
| onChange | `CommonEventFunction<onChangeEventDetail>` |  | 否 | 拖动过程中触发的事件 |
| onChangeEnd | `CommonEventFunction<onChangeEventDetail>` |  | 否 | 拖动结束触发的事件 |
| onDragStart | `CommonEventFunction` |  | 否 | 开始拖动时触发 |
| onDragEnd | `CommonEventFunction` |  | 否 | 拖动结束时触发 |
| onScale | `CommonEventFunction<onScaleEventDetail>` |  | 否 | 缩放过程中触发的事件 |
| onTouchStart | `CommonEventFunction` |  | 否 | 触摸动作开始，事件会向父节点传递。 |
| onTouchMove | `CommonEventFunction` |  | 否 | 触摸动作开始，事件仅作用于组件，不向父节点传递。 |
| onTouchEnd | `TouchEventFunction` |  | 否 | 手指触摸动作结束 |
| onTouchCancel | `CommonEventFunction` |  | 否 | 触摸动作被打断，如来电提醒、弹窗。 |
| onHTouchMove | `TouchEventFunction` |  | 否 | 初次手指触摸后移动为横向的移动，如果 catch 此事件，则意味着 touchmove 事件也被 catch |
| onVTouchMove | `TouchEventFunction` |  | 否 | 初次手指触摸后移动为纵向的移动，如果 catch 此事件，则意味着 touchmove 事件也被 catch |
| catchTouchStart | `CommonEventFunction` |  | 否 | 触摸移动事件，事件仅作用于组件，不向父节点传递。 |
| catchTouchMove | `CommonEventFunction` |  | 否 | 触摸移动事件，事件仅作用于组件，不向父节点传递。 |
| catchTouchEnd | `CommonEventFunction` |  | 否 | 触摸动作结束，事件仅作用于组件，不向父节点传递。 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| MovableViewProps.direction | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| MovableViewProps.inertia | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| MovableViewProps.outOfBounds | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| MovableViewProps.x | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| MovableViewProps.y | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| MovableViewProps.damping | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| MovableViewProps.friction | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| MovableViewProps.disabled | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| MovableViewProps.scale | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| MovableViewProps.scaleMin | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| MovableViewProps.scaleMax | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| MovableViewProps.scaleValue | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| MovableViewProps.animation | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| MovableViewProps.onChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| MovableViewProps.onChangeEnd |  |  | ✔️ |  |  |  |  |  |  |  |
| MovableViewProps.onDragStart |  |  |  |  |  |  | ✔️ |  |  |  |
| MovableViewProps.onDragEnd |  |  |  |  |  |  | ✔️ |  |  |  |
| MovableViewProps.onScale | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| MovableViewProps.onTouchStart |  |  | ✔️ |  |  |  |  |  |  |  |
| MovableViewProps.onTouchMove |  |  | ✔️ |  |  |  |  |  |  |  |
| MovableViewProps.onTouchEnd |  |  | ✔️ |  |  | ✔️(此事件的触发顺序会因为当前事件机制引起组件内外注册的事件执行顺序不正常，外部注册的事件可能会优先于内部执行，如需保证执行顺序一致，需要在回调函数中包裹 setTimeout 临时处理) |  |  | ✔️ |  |
| MovableViewProps.onTouchCancel |  |  | ✔️ |  |  |  |  |  |  |  |
| MovableViewProps.onHTouchMove | ✔️ | ✔️ |  | ✔️ |  | ✔️ |  |  | ✔️ | ✔️ |
| MovableViewProps.onVTouchMove | ✔️ | ✔️ |  | ✔️ |  | ✔️ |  |  | ✔️ | ✔️ |
| MovableViewProps.catchTouchStart |  |  | ✔️ |  |  |  |  |  |  |  |
| MovableViewProps.catchTouchMove |  |  | ✔️ |  |  |  |  |  |  |  |
| MovableViewProps.catchTouchEnd |  |  | ✔️ |  |  |  |  |  |  |  |

### TChangeSource

拖动过程中触发的事件

| 参数 | 说明 |
| --- | --- |
| touch | 拖动 |
| touch-out-of-bounds | 超出移动范围 |
| out-of-bounds | 超出移动范围后的回弹 |
| friction | 惯性 |
|  | setData |

### onChangeEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | X 坐标 |
| y | `number` | Y 坐标 |
| source | `keyof TChangeSource` | 触发事件 |

### onScaleEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| x | `number` | X 坐标 |
| y | `number` | Y 坐标 |
| scale | `number` | 缩放比例 |
</file>

<file path="docs/components/viewContainer/native-slot.md">
---
title: NativeSlot
sidebar_label: NativeSlot
---

编译的原生组件支持使用 slot 插槽

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://github.com/NervJS/taro/pull/12627)

## 类型

```tsx
ComponentType<NativeSlotProps>
```

## 示例代码

```tsx
import { NativeSlot, View } from '@tarojs/components'

export default function () {
  render () {
    return (
      <View>
        <NativeSlot />
      </View>
    )
  }
}
```

## NativeSlotProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| name | `string` | `none` | 否 | 指定插入的 slot 位置 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| NativeSlotProps.name | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |
</file>

<file path="docs/components/viewContainer/page-container.md">
---
title: PageContainer
sidebar_label: PageContainer
---

页面容器

小程序如果在页面内进行复杂的界面设计（如在页面内弹出半屏的弹窗、在页面内加载一个全屏的子页面等），用户进行返回操作会直接离开当前页面，不符合用户预期，预期应为关闭当前弹出的组件。
为此提供“假页”容器组件，效果类似于 `popup` 弹出层，页面内存在该容器时，当用户进行返回操作，关闭该容器不关闭页面。返回操作包括三种情形，右滑手势、安卓物理返回键和调用 `navigateBack` 接口。

Bug & Tip
 1. tip: 当前页面最多只有 1 个容器，若已存在容器的情况下，无法增加新的容器
 2. tip: wx.navigateBack 无法在页面栈顶调用，此时没有上一级页面

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/page-container.html)

## 类型

```tsx
ComponentType<PageContainerProps>
```

## PageContainerProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| show | `boolean` | `false` | 否 | 是否显示容器组件 |
| duration | `number` | `300` | 否 | 动画时长，单位毫秒 |
| zIndex | `number` | `100` | 否 | z-index 层级 |
| overlay | `boolean` | `true` | 否 | 是否显示遮罩层 |
| position | `keyof Position` | `bottom` | 否 | 弹出位置，可选值为 top bottom right center |
| round | `boolean` | `false` | 否 | 是否显示圆角 |
| overlayStyle | `string` |  | 否 | 自定义遮罩层样式 |
| customStyle | `string` |  | 否 | 自定义弹出层样式 |
| closeOnSlideDown | `boolean` | `false` | 否 | 是否在下滑一段距离后关闭 |
| onBeforeEnter | `CommonEventFunction` |  | 否 | 进入前触发 |
| onEnter | `CommonEventFunction` |  | 否 | 进入中触发 |
| onAfterEnter | `CommonEventFunction` |  | 否 | 进入后触发 |
| onBeforeLeave | `CommonEventFunction` |  | 否 | 离开前触发 |
| onLeave | `CommonEventFunction` |  | 否 | 离开中触发 |
| onAfterLeave | `CommonEventFunction` |  | 否 | 离开后触发 |
| onClickOverlay | `CommonEventFunction` |  | 否 | 点击遮罩层时触发 |
| onEnterCancelled | `CommonEventFunction` |  | 否 | 进入被打断时触发（通过 a: if 打断时不会触发）。 |
| onLeaveCancelled | `CommonEventFunction` |  | 否 | 离开被打断时触发（通过 a: if 打断时不会触发）。 |

### API 支持度

| API | 微信小程序 | 支付宝小程序 | 京东小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| PageContainerProps.show | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |
| PageContainerProps.duration | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |
| PageContainerProps.zIndex | ✔️ | ✔️ |  |  |  |  |  |
| PageContainerProps.overlay | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |
| PageContainerProps.position | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |
| PageContainerProps.round | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |
| PageContainerProps.overlayStyle | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |
| PageContainerProps.customStyle | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |
| PageContainerProps.closeOnSlideDown | ✔️ | ✔️ | ✔️ |  |  |  |  |
| PageContainerProps.onBeforeEnter | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |
| PageContainerProps.onEnter | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |
| PageContainerProps.onAfterEnter | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |
| PageContainerProps.onBeforeLeave | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |
| PageContainerProps.onLeave | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |
| PageContainerProps.onAfterLeave | ✔️ | ✔️ | ✔️ |  | ✔️ |  |  |
| PageContainerProps.onClickOverlay | ✔️ | ✔️ | ✔️ |  |  |  |  |
| PageContainerProps.onEnterCancelled |  | ✔️ |  |  |  |  |  |
| PageContainerProps.onLeaveCancelled |  | ✔️ |  |  |  |  |  |

### Position

弹出位置

| 参数 | 说明 |
| --- | --- |
| top | 上方弹出 |
| bottom | 下方弹出 |
| right | 右边弹出 |
| center | 中央弹出 |
</file>

<file path="docs/components/viewContainer/root-portal.md">
---
title: RootPortal
sidebar_label: RootPortal
---

root-portal
使整个子树从页面中脱离出来，类似于在 CSS 中使用 fixed position 的效果。主要用于制作弹窗、弹出层等。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/root-portal.html)

## 类型

```tsx
ComponentType<RootPortalProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }]}>
<TabItem value="React">

```tsx
import { useState } from 'react'
import { RootPortal, View, Button } from '@tarojs/components'

export default function RootPortalExample {
  const [show, setShow] = useState(false)
  const toggle = () => {
    setShow(!show)
  }
  render () {
    return (
      <View>
        <Button onClick={toggle}>显示root-portal</Button>
        {
          show && (<RootPortal><View>content</View></RootPortal>)
        }
      </View>
    )
  }
}
```
</TabItem>
</Tabs>

## RootPortalProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| enable | `boolean` | `true` | 否 | 是否从页面中脱离出来 |

### API 支持度

| API | 微信小程序 | 支付宝小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| RootPortalProps.enable | ✔️ | ✔️ |  |  |  |  |
</file>

<file path="docs/components/viewContainer/script.md">
---
title: Script
sidebar_label: Script
---

script 类似微信小程序的 wxs 标签，支持引用各种小程序的 xs 文件
只能在 CompileMode 中使用

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/>

## 类型

```tsx
ComponentType<ScriptProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }]}>
<TabItem value="React">

```tsx
import { Component } from 'react'
import { View, Script } from '@tarojs/components'

export function Index () {
  return (
    <View compileMode>
      <Script src="./logic.wxs" module="logic"></Script>
      <Text>Hello, {logic.name}!</Text>
    </View>
  )
}
```
</TabItem>
</Tabs>

## ScriptProps

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| src | `string` | xs 文件的相对路径 |
| module | `string` | xs 模块名 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| ScriptProps.src | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
| ScriptProps.module | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
</file>

<file path="docs/components/viewContainer/scroll-view.md">
---
title: ScrollView
sidebar_label: ScrollView
---

可滚动视图区域。使用竖向滚动时，需要给scroll-view一个固定高度，通过 WXSS 设置 height。组件属性的长度单位默认为 px

Tips:
H5 中 ScrollView 组件是通过一个高度（或宽度）固定的容器内部滚动来实现的，因此务必正确的设置容器的高度。例如: 如果 ScrollView 的高度将 body 撑开，就会同时存在两个滚动条（body 下的滚动条，以及 ScrollView 的滚动条）。
微信小程序 中 ScrollView 组件如果设置 scrollX 横向滚动时，并且子元素为多个时（单个子元素时设置固定宽度则可以正常横向滚动），需要通过 WXSS 设置 `white-space: nowrap` 来保证元素不换行，并对 ScrollView 内部元素设置 `display: inline-block` 来使其能够横向滚动。

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/scroll-view.html)

## 类型

```tsx
ComponentType<ScrollViewProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PageView extends Component {
  constructor() {
    super(...arguments)
  }

  onScrollToUpper() {}

  // or 使用箭头函数
  // onScrollToUpper = () => {}

  onScroll(e){
    console.log(e.detail)
  }

  render() {
    const scrollStyle = {
      height: '150px'
    }
    const scrollTop = 0
    const Threshold = 20
    const vStyleA = {
      height: '150px',
      'backgroundColor': 'rgb(26, 173, 25)'
    }
    const vStyleB = {
       height: '150px',
      'backgroundColor': 'rgb(39,130,215)'
    }
    const vStyleC = {
      height: '150px',
      'backgroundColor': 'rgb(241,241,241)',
      color: '#333'
    }
    return (
      <ScrollView
        className='scrollview'
        scrollY
        scrollWithAnimation
        scrollTop={scrollTop}
        style={scrollStyle}
        lowerThreshold={Threshold}
        upperThreshold={Threshold}
        onScrollToUpper={this.onScrollToUpper.bind(this)} // 使用箭头函数的时候 可以这样写 `onScrollToUpper={this.onScrollToUpper}`
        onScroll={this.onScroll}
      >
        <View style={vStyleA}>A</View>
        <View style={vStyleB}>B</View>
        <View style={vStyleC}>C</View>
      </ScrollView>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="container">
    <view class="page-body">
      <view class="page-section">
        <view class="page-section-title">
          <text>Vertical Scroll - 纵向滚动</text>
        </view>
        <view class="page-section-spacing">
          <scroll-view :scroll-y="true" style="height: 300rpx;" @scrolltoupper="upper" @scrolltolower="lower" @scroll="scroll" :scroll-into-view="toView" :scroll-top="scrollTop">
            <view id="demo1" class="scroll-view-item demo-text-1">1</view>
            <view id="demo2"  class="scroll-view-item demo-text-2">2</view>
            <view id="demo3" class="scroll-view-item demo-text-3">3</view>
          </scroll-view>
        </view>
      </view>
      <view class="page-section">
        <view class="page-section-title">
          <text>Horizontal Scroll - 横向滚动</text>
        </view>
        <view class="page-section-spacing">
          <scroll-view class="scroll-view_H" :scroll-x="true" @scroll="scroll" style="width: 100%">
            <view id="demo21" class="scroll-view-item_H demo-text-1">a</view>
            <view id="demo22"  class="scroll-view-item_H demo-text-2">b</view>
            <view id="demo23" class="scroll-view-item_H demo-text-3">c</view>
          </scroll-view>
        </view>
      </view>
    </view>
  </view>
</template>

<script>
const order = ['demo1', 'demo2', 'demo3']
export default {
  name: 'Index',
  data() {
    return {
      scrollTop: 0,
      toView: 'demo2'
    }
  },

  methods: {
    upper(e) {
      console.log('upper:', e)
    },

    lower(e) {
      console.log('lower:', e)
    },

    scroll(e) {
      console.log('scroll:', e)
    }
  }
}
</script>

<style>
.page-section-spacing{
  margin-top: 60rpx;
}
.scroll-view_H{
  white-space: nowrap;
}
.scroll-view-item{
  height: 300rpx;
}
.scroll-view-item_H{
  display: inline-block;
  width: 100%;
  height: 300rpx;
}

.demo-text-1 { background: #ccc; }
.demo-text-2 { background: #999; }
.demo-text-3 { background: #666; }
</style>
```
</TabItem>
</Tabs>

## ScrollViewProps

### 类型

```tsx
typeof ScrollViewProps
```

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| scrollX | `boolean` | `false` | 否 | 允许横向滚动 |
| scrollY | `boolean` | `false` | 否 | 允许纵向滚动 |
| upperThreshold | `number` | `50` | 否 | 距顶部/左边多远时（单位px），触发 scrolltoupper 事件 |
| lowerThreshold | `number` | `50` | 否 | 距底部/右边多远时（单位px），触发 scrolltolower 事件 |
| scrollTop | `number` |  | 否 | 设置竖向滚动条位置 |
| scrollLeft | `number` |  | 否 | 设置横向滚动条位置 |
| scrollIntoView | `string` |  | 否 | 值应为某子元素id（id不能以数字开头）。设置哪个方向可滚动，则在哪个方向滚动到该元素 |
| scrollWithAnimation | `boolean` | `false` | 否 | 在设置滚动条位置时使用动画过渡 |
| enableBackToTop | `boolean` | `false` | 否 | iOS 点击顶部状态栏、安卓双击标题栏时，滚动条返回顶部，只支持竖向 |
| enableFlex | `boolean` | `false` | 否 | 启用 flexbox 布局。开启后，当前节点声明了 `display: flex` 就会成为 flex container，并作用于其孩子节点。 |
| scrollAnchoring | `boolean` | `false` | 否 | 开启 scroll anchoring 特性，即控制滚动位置不随内容变化而抖动，仅在 iOS 下生效，安卓下可参考 CSS `overflow-anchor` 属性。 |
| refresherEnabled | `boolean` | `false` | 否 | 开启自定义下拉刷新 |
| refresherThreshold | `number` | `45` | 否 | 设置自定义下拉刷新阈值 |
| refresherDefaultStyle | `string` | `'black'` | 否 | 设置自定义下拉刷新默认样式，支持设置 `black or white or none`， none 表示不使用默认样式 |
| refresherBackground | `string` | `'#FFF'` | 否 | 设置自定义下拉刷新区域背景颜色 |
| refresherTriggered | `boolean` | `false` | 否 | 设置当前下拉刷新状态，true 表示下拉刷新已经被触发，false 表示下拉刷新未被触发 |
| enhanced | `boolean` | `false` | 否 | 启用 scroll-view 增强特性 |
| usingSticky | `boolean` | `false` | 否 | 使 scroll-view 下的 position sticky 特性生效，否则滚动一屏后 sticky 元素会被隐藏 |
| bounces | `boolean` | `true` | 否 | iOS 下 scroll-view 边界弹性控制 (同时开启 enhanced 属性后生效) |
| showScrollbar | `boolean` | `true` | 否 | 滚动条显隐控制 (同时开启 enhanced 属性后生效) |
| pagingEnabled | `boolean` | `false` | 否 | 分页滑动效果 (同时开启 enhanced 属性后生效) |
| fastDeceleration | `boolean` | `false` | 否 | boolean	false	滑动减速速率控制 (同时开启 enhanced 属性后生效) |
| scrollAnimationDuration | `string` |  | 否 | 当 scroll-with-animation设置为 true 时，可以设置 scroll-animation-duration 来控制动画的执行时间，单位 ms。 |
| trapScroll | `string` | `false` | 否 | 纵向滚动时，当滚动到顶部或底部时，强制禁止触发页面滚动，仍然只触发 scroll-view 自身的滚动。 |
| disableLowerScroll | `string` |  | 否 | 发生滚动前，对滚动方向进行判断，当方向是顶部/左边时，如果值为 always 将始终禁止滚动，如果值为 out-of-bounds 且当前已经滚动到顶部/左边，禁止滚动。 |
| disableUpperScroll | `string` |  | 否 | 发生滚动前，对滚动方向进行判断，当方向是底部/右边时，如果值为 always 将始终禁止滚动，如果值为 out-of-bounds 且当前已经滚动到底部/右边，禁止滚动。 |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |
| enablePassive | `boolean` | `false` | 否 | 开启 passive 特性，能优化一定的滚动性能 |
| type | "list" or "custom" or "nested" | `'list'` | 否 | 渲染模式<br />list - 列表模式。只会渲染在屏节点，会根据直接子节点是否在屏来按需渲染，若只有一个直接子节点则性能会退化<br />custom - 自定义模式。只会渲染在屏节点，子节点可以是 sticky-section list-view grid-view 等组件<br />nested - 嵌套模式。用于处理父子 scroll-view 间的嵌套滚动，子节点可以是 nested-scroll-header nested-scroll-body 组件或自定义 refresher |
| associativeContainer | "draggable-sheet" or "nested-scroll-view" or "pop-gesture" | `''` | 否 | 关联的滚动容器<br />draggable-sheet	  - 关联 draggable-sheet 组件	3.2.0<br />nested-scroll-view	- 关联 type=nested 嵌套模式	3.2.0<br />pop-gesture	      - 关联 页面手势返回 3.4.0 |
| reverse | `boolean` | `false` | 否 | 是否反向滚动。一般初始滚动位置是在顶部，反向滚动则是在底部。 |
| clip | `boolean` | `true` | 否 | 是否对溢出进行裁剪，默认开启 |
| cacheExtent | `number` |  | 否 | 指定视口外渲染区域的距离，默认情况下视口外节点不渲染。指定 cache-extent 可优化滚动体验和加载速度，但会提高内存占用且影响首屏速度，可按需启用。 |
| minDragDistance | `number` | `18` | 否 | 指定 scroll-view 触发滚动的最小拖动距离。仅在 scroll-view 和其他组件存在手势冲突时使用，可通过调整该属性使得滚动更加灵敏。 |
| padding | `[number, number, number, number]` | `[0,0,0,0]` | 否 | 长度为 4 的数组，按 top、right、bottom、left 顺序指定内边距 |
| scrollIntoViewWithinExtent | `boolean` | `false` | 否 | 只 scroll-into-view 到 cacheExtent 以内的目标节点，性能更佳 |
| scrollIntoViewAlignment | "start" or "center" or "end" or "nearest" | `'start'` | 否 | 指定 scroll-into-view 目标节点在视口内的位置。<br />start - 目标节点显示在视口开始处<br />center - 目标节点显示在视口中间<br />end - 目标节点显示在视口结束处<br />nearest - 目标节点在就近的视口边缘显示，若节点已在视口内则不触发滚动 |
| refresherTwoLevelEnabled | `boolean` | `false` | 否 | 开启下拉二级能力 |
| refresherTwoLevelTriggered | `boolean` | `false` | 否 | 设置打开/关闭二级 |
| refresherTwoLevelThreshold | `number` | `150` | 否 | 下拉二级阈值 |
| refresherTwoLevelCloseThreshold | `number` | `80` | 否 | 滑动返回时关闭二级的阈值 |
| refresherTwoLevelScrollEnabled | `boolean` | `false` | 否 | 处于二级状态时是否可滑动 |
| refresherBallisticRefreshEnabled | `boolean` | `false` | 否 | 惯性滚动是否触发下拉刷新 |
| refresherTwoLevelPinned | `boolean` | `false` | 否 | 即将打开二级时否定住 |
| onScrollToUpper | `CommonEventFunction` |  | 否 | 滚动到顶部/左边，会触发 scrolltoupper 事件 |
| onScrollToLower | `CommonEventFunction` |  | 否 | 滚动到底部/右边，会触发 scrolltolower 事件 |
| onScroll | `BaseEventOrigFunction<onScrollDetail>` |  | 否 | 滚动时触发 |
| onScrollStart | `BaseEventOrigFunction<onScrollDetail>` |  | 否 | 滚动开始事件 |
| onScrollEnd | `BaseEventOrigFunction<onScrollDetail>` |  | 否 | 滚动结束事件 |
| onRefresherPulling | `CommonEventFunction` |  | 否 | 自定义下拉刷新控件被下拉 |
| onRefresherRefresh | `CommonEventFunction` |  | 否 | 自定义下拉刷新被触发 |
| onRefresherRestore | `CommonEventFunction` |  | 否 | 自定义下拉刷新被复位 |
| onRefresherAbort | `CommonEventFunction` |  | 否 | 自定义下拉刷新被中止 |
| onRefresherWillRefresh | `CommonEventFunction` |  | 否 | 自定义下拉刷新即将触发刷新（拖动超过 refresher-threshold 时）的事件 |
| onRefresherStatusChange | `CommonEventFunction<RefresherStatusChange>` |  | 否 | 下拉刷新状态回调 |
| onDragStart | `CommonEventFunction<onDragDetail>` |  | 否 | 滑动开始事件 (同时开启 enhanced 属性后生效) |
| onDragging | `CommonEventFunction<onDragDetail>` |  | 否 | 滑动事件 (同时开启 enhanced 属性后生效) |
| onDragEnd | `CommonEventFunction<onDragDetail>` |  | 否 | 滑动结束事件 (同时开启 enhanced 属性后生效) |
| onTouchStart | `CommonEventFunction` |  | 否 | 触摸动作开始。 |
| onTouchMove | `CommonEventFunction` |  | 否 | 触摸后移动。 |
| onTouchEnd | `CommonEventFunction` |  | 否 | 触摸动作结束。 |
| onTouchCancel | `CommonEventFunction` |  | 否 | 触摸动作被打断，如来电提醒、弹窗。 |
| onScrollStartWorklet | `string` |  | 否 | 同 bindscrollstart，但仅支持 worklet 作为回调 |
| onScrollUpdateWorklet | `string` |  | 否 | 同 bindscroll ，但仅支持 worklet 作为回调 |
| onScrollEndWorklet | `string` |  | 否 | 同 bindscrollend，但仅支持 worklet 作为回调 |
| adjustDecelerationVelocityWorklet | `string` |  | 否 | 指定手指抬起时做惯性滚动的初速度。(velocity: number) => number |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| ScrollViewProps.scrollX | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️(二选一) | ✔️ | ✔️ | ✔️ |
| ScrollViewProps.scrollY | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️(二选一) | ✔️ | ✔️ | ✔️ |
| ScrollViewProps.upperThreshold | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ScrollViewProps.lowerThreshold | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ScrollViewProps.scrollTop | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ScrollViewProps.scrollLeft | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ScrollViewProps.scrollIntoView | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| ScrollViewProps.scrollWithAnimation | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ScrollViewProps.enableBackToTop | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |  | ✔️ |  |  |  |
| ScrollViewProps.enableFlex | ✔️ |  |  |  |  | ✔️ |  |  |  |  |  |
| ScrollViewProps.scrollAnchoring | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.refresherEnabled | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| ScrollViewProps.refresherThreshold | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| ScrollViewProps.refresherDefaultStyle | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| ScrollViewProps.refresherBackground | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| ScrollViewProps.refresherTriggered | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| ScrollViewProps.enhanced | ✔️ | ✔️ |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.usingSticky | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.bounces | ✔️ | ✔️ |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.showScrollbar | ✔️ |  |  |  |  |  |  |  | ✔️ |  | ✔️ |
| ScrollViewProps.pagingEnabled | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.fastDeceleration | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.scrollAnimationDuration |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ScrollViewProps.trapScroll |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ScrollViewProps.disableLowerScroll |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ScrollViewProps.disableUpperScroll |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ScrollViewProps.ariaLabel |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ScrollViewProps.enablePassive | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.type | ✔️ |  |  |  |  |  |  |  | ✔️ |  |  |
| ScrollViewProps.associativeContainer | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.reverse | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.clip | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.cacheExtent | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.minDragDistance | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.padding | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.scrollIntoViewWithinExtent | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.scrollIntoViewAlignment | ✔️ |  |  |  |  |  | ✔️ |  |  | ✔️ |  |
| ScrollViewProps.refresherTwoLevelEnabled | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.refresherTwoLevelTriggered | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.refresherTwoLevelThreshold | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.refresherTwoLevelCloseThreshold | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.refresherTwoLevelScrollEnabled | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.refresherBallisticRefreshEnabled | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.refresherTwoLevelPinned | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.onScrollToUpper | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ScrollViewProps.onScrollToLower | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ScrollViewProps.onScroll | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| ScrollViewProps.onScrollStart | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.onScrollEnd | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.onRefresherPulling | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| ScrollViewProps.onRefresherRefresh | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| ScrollViewProps.onRefresherRestore | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| ScrollViewProps.onRefresherAbort | ✔️ |  |  |  |  |  |  |  |  |  | ✔️ |
| ScrollViewProps.onRefresherWillRefresh | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.onRefresherStatusChange | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.onDragStart | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.onDragging | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.onDragEnd | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.onTouchStart |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ScrollViewProps.onTouchMove |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ScrollViewProps.onTouchEnd |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ScrollViewProps.onTouchCancel |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ScrollViewProps.onScrollStartWorklet | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.onScrollUpdateWorklet | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.onScrollEndWorklet | ✔️ |  |  |  |  |  |  |  |  |  |  |
| ScrollViewProps.adjustDecelerationVelocityWorklet | ✔️ |  |  |  |  |  |  |  |  |  |  |

| 参数 | 类型 |
| --- | --- |
| RefreshStatus | `typeof RefreshStatus` |

### onScrollDetail

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| scrollLeft | `number` | 是 | 横向滚动条位置 |
| scrollTop | `number` | 是 | 竖向滚动条位置 |
| scrollHeight | `number` | 是 | 滚动条高度 |
| scrollWidth | `number` | 是 | 滚动条宽度 |
| deltaX | `number` | 是 |  |
| deltaY | `number` | 是 |  |
| isDrag | `boolean` | 否 |  |

### onDragDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| scrollLeft | `number` | 横向滚动条位置 |
| scrollTop | `number` | 竖向滚动条位置 |
| velocity | `number` | 滚动速度 |

### RefresherStatusChange

| 参数 | 类型 |
| --- | --- |
| status | `RefreshStatus` |
| dy | `number` |
</file>

<file path="docs/components/viewContainer/slot.md">
---
title: Slot
sidebar_label: Slot
---

slot 插槽

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

## 类型

```tsx
ComponentType<SlotProps>
```

## 示例代码

```tsx
import { Slot, View, Text } from '@tarojs/components'

export default class SlotView extends Component {
  render () {
    return (
      <View>
        <custom-component>
          <Slot name='title'>
           <Text>Hello, world!</Text>
          </Slot>
        </custom-component>
      </View>
    )
  }
}
```

## SlotProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| name | `string` | `none` | 否 | 指定插入的 slot 位置 |
| varName | `string` | `none` | 否 | scoped slot 传入数据源 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| SlotProps.name | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  | ✔️ |
| SlotProps.varName |  | ✔️ |  |  |  |  |  |  |  |  |
</file>

<file path="docs/components/viewContainer/swiper-item.md">
---
title: SwiperItem
sidebar_label: SwiperItem
---

仅可放置在 swiper 组件中，宽高自动设置为100%
> 不要为 `SwiperItem` 设置 **style** 属性，可以通过 class 设置样式。[7147](https://github.com/NervJS/taro/issues/7147)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/swiper-item.html)

## 类型

```tsx
ComponentType<SwiperItemProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Component {
  render () {
    return (
      <Swiper
        className='test-h'
        indicatorColor='#999'
        indicatorActiveColor='#333'
        vertical
        circular
        indicatorDots
        autoplay>
        <SwiperItem>
          <View className='demo-text-1'>1</View>
        </SwiperItem>
        <SwiperItem>
          <View className='demo-text-2'>2</View>
        </SwiperItem>
        <SwiperItem>
          <View className='demo-text-3'>3</View>
        </SwiperItem>
      </Swiper>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <swiper
    class='test-h'
    indicator-color='#999'
    indicator-active-color='#333'
    :vertical="true"
    :circular="true"
    :indicator-dots="true"
    :autoplay="true"
  >
    <swiper-item>
      <view class='demo-text-1'>1</view>
    </swiper-item>
    <swiper-item>
      <view class='demo-text-2'>2</view>
    </swiper-item>
    <swiper-item>
      <view class='demo-text-3'>3</view>
    </swiper-item>
  </swiper>
</template>
```
</TabItem>
</Tabs>

## SwiperItemProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| itemId | `string` |  | 否 | 该 swiper-item 的标识符 |
| skipHiddenItemLayout | `boolean` | `false` | 否 | 是否跳过未显示的滑块布局，设为 true 可优化复杂情况下的滑动性能，但会丢失隐藏状态滑块的布局信息 |
| deep | `boolean` | `false` | 否 | Swiper 循环状态下，前后垫片节点拷贝模式，用于修复 Vue 在 CustomElements 下的节点拷贝问题 |

### API 支持度

| API | 微信小程序 | 百度小程序 | 抖音小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| SwiperItemProps.itemId | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SwiperItemProps.skipHiddenItemLayout | ✔️ |  |  |  |  |  |  |  |  |
| SwiperItemProps.deep |  |  |  |  | ✔️ |  |  |  |  |
</file>

<file path="docs/components/viewContainer/swiper.md">
---
title: Swiper
sidebar_label: Swiper
---

滑块视图容器。其中只可放置 swiper-item 组件，否则会导致未定义的行为。
> 不要为 `SwiperItem` 设置 **style** 属性，可以通过 class 设置样式。[7147](https://github.com/NervJS/taro/issues/7147)

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/swiper.html)

## 类型

```tsx
ComponentType<SwiperProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
class App extends Component {
  render () {
    return (
      <Swiper
        className='test-h'
        indicatorColor='#999'
        indicatorActiveColor='#333'
        vertical
        circular
        indicatorDots
        autoplay>
        <SwiperItem>
          <View className='demo-text-1'>1</View>
        </SwiperItem>
        <SwiperItem>
          <View className='demo-text-2'>2</View>
        </SwiperItem>
        <SwiperItem>
          <View className='demo-text-3'>3</View>
        </SwiperItem>
      </Swiper>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <swiper
    class='test-h'
    indicator-color='#999'
    indicator-active-color='#333'
    :vertical="true"
    :circular="true"
    :indicator-dots="true"
    :autoplay="true"
  >
    <swiper-item>
      <view class='demo-text-1'>1</view>
    </swiper-item>
    <swiper-item>
      <view class='demo-text-2'>2</view>
    </swiper-item>
    <swiper-item>
      <view class='demo-text-3'>3</view>
    </swiper-item>
  </swiper>
</template>
```
</TabItem>
</Tabs>

## SwiperProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| indicatorDots | `boolean` | `false` | 否 | 是否显示面板指示点 |
| indicatorColor | `string` | `"rgba(0, 0, 0, .3)"` | 否 | 指示点颜色 |
| indicatorActiveColor | `string` | `"#000000"` | 否 | 当前选中的指示点颜色 |
| autoplay | `boolean` | `false` | 否 | 是否自动切换 |
| current | `number` | `0` | 否 | 当前所在滑块的 index |
| currentItemId | `string` | `""` | 否 | 当前所在滑块的 item-id ，不能与 current 被同时指定 |
| interval | `number` | `5000` | 否 | 自动切换时间间隔 |
| duration | `number` | `500` | 否 | 滑动动画时长 |
| circular | `boolean` | `false` | 否 | 是否采用衔接滑动 |
| vertical | `boolean` | `false` | 否 | 滑动方向是否为纵向 |
| previousMargin | `string` | `"0px"` | 否 | 前边距，可用于露出前一项的一小部分，接受 px 和 rpx 值 |
| nextMargin | `string` | `"0px"` | 否 | 后边距，可用于露出后一项的一小部分，接受 px 和 rpx 值 |
| snapToEdge | `boolean` | `false` | 否 | 当 swiper-item 的个数大于等于 2，关闭 circular 并且开启 previous-margin 或 next-margin 的时候，可以指定这个边距是否应用到第一个、最后一个元素 |
| displayMultipleItems | `number` | `1` | 否 | 同时显示的滑块数量 |
| skipHiddenItemLayout | `boolean` | `false` | 否 | 是否跳过未显示的滑块布局，设为 true 可优化复杂情况下的滑动性能，但会丢失隐藏状态滑块的布局信息 |
| easingFunction | `keyof TEasingFunction` | `"default"` | 否 | 指定 swiper 切换缓动动画类型 |
| disableTouch | `boolean` | `false` | 否 | 是否禁止用户 touch 操作 |
| zoom | `boolean` | `false` | 否 | 是否启用缩放 |
| full | `boolean` | `false` | 否 | 是否开启全屏 |
| activeClass | `string` |  | 否 | swiper-item 可见时的 class。 |
| changingClass | `string` |  | 否 | acceleration 设置为 {{true}} 时且处于滑动过程中，中间若干屏处于可见时的 class。 |
| acceleration | `string` | `false` | 否 | 当开启时，会根据滑动速度，连续滑动多屏。 |
| disableProgrammaticAnimation | `string` | `false` | 否 | 是否禁用代码变动触发 swiper 切换时使用动画。 |
| swipeRatio | `string` |  | 否 | 滑动距离阈值，当滑动距离超过阈值时进行 swiper-item 切换。 |
| swipeSpeed | `string` |  | 否 | 滑动综合速度阈值，当超过阈值时进行 swiper-item 切换，数值越小越敏感。 |
| touchAngle | `string` |  | 否 | 计算用户手势时所依赖的滑动角度。角度根据 touchstart 事件和首次 touchmove 事件的坐标计算得出。数值越小越对用户的滑动方向准确度要求越高。 |
| adjustHeight | "first" or "current" or "highest" or "none" |  | 否 | 自动以指定滑块的高度为整个容器的高度。当 vertical 为 true 时，默认不调整。可选值为： |
| adjustVerticalHeight | `string` |  | 否 | vertical 为 true 时强制使 adjust-height 生效。 |
| disableTouchmove | `string` | `false` | 否 | 是否停止响应用户 touchmove 操作 |
| effectsProps | `Record<string, any>` |  | 否 | swiper11 相关的动效参数，具体见文档 https://swiperjs.com/swiper-api#parameters |
| onChange | `CommonEventFunction<onChangeEventDetail>` |  | 否 | current 改变时会触发 change 事件 |
| onTransition | `CommonEventFunction<onTransitionEventDetail>` |  | 否 | swiper-item 的位置发生改变时会触发 transition 事件 |
| onAnimationFinish | `CommonEventFunction<onChangeEventDetail>` |  | 否 | 动画结束时会触发 animationfinish 事件 |
| onAnimationEnd | `CommonEventFunction<onCommonEventDetail>` |  | 否 | 动画结束时会触发 animationEnd 事件 |
| layoutType | "normal" or "stackLeft" or "stackRight" or "tinder" or "transformer" | `normal` | 否 | 渲染模式 |
| transformerType | "scaleAndFade" or "accordion" or "threeD" or "zoomIn" or "zoomOut" or "deepthPage" | `scaleAndFade` | 否 | layout-type 为 transformer 时指定动画类型 |
| indicatorType | "normal" or "worm" or "wormThin" or "wormUnderground" or "wormThinUnderground" or "expand" or "jump" or "jumpWithOffset" or "scroll" or "scrollFixedCenter" or "slide" or "slideUnderground" or "scale" or "swap" or "swapYRotation" or "color" | `normal` | 否 | 指示点动画类型 |
| indicatorMargin | `number` | `10` | 否 | 指示点四周边距 |
| indicatorSpacing | `number` | `4` | 否 | 指示点间距 |
| indicatorRadius | `number` | `4` | 否 | 指示点圆角大小 |
| indicatorWidth | `number` | `8` | 否 | 指示点宽度 |
| indicatorHeight | `number` | `8` | 否 | 指示点高度 |
| indicatorAlignment | string or [number, number] | `auto` | 否 | 指示点的相对位置 |
| indicatorOffset | `[number, number]` | `[0, 0]` | 否 | 指示点位置的偏移量 |
| scrollWithAnimation | `boolean` | `true` | 否 | 改变 current 时使用动画过渡 |
| cacheExtent | `number` | `0` | 否 | 缓存区域大小，值为 1 表示提前渲染上下各一屏区域（swiper 容器大小） |
| onScrollStartWorklet | `string` |  | 否 | 滑动开始时触发，仅支持 worklet 作为回调。event.detail = {dx: dx, dy: dy} |
| onScrollUpdateWorklet | `string` |  | 否 | 滑动位置更新时触发，仅支持 worklet 作为回调。event.detail = {dx: dx, dy: dy} |
| onScrollEndWorklet | `string` |  | 否 | 滑动结束时触发，仅支持 worklet 作为回调。event.detail = {dx: dx, dy: dy} |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| SwiperProps.indicatorDots | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SwiperProps.indicatorColor | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SwiperProps.indicatorActiveColor | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SwiperProps.autoplay | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SwiperProps.current | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SwiperProps.currentItemId | (deprecated) | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ |  |
| SwiperProps.interval | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SwiperProps.duration | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ |
| SwiperProps.circular | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| SwiperProps.vertical | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SwiperProps.previousMargin | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| SwiperProps.nextMargin | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| SwiperProps.snapToEdge | ✔️ |  | ✔️ |  |  |  |  |  |  |  |  |
| SwiperProps.displayMultipleItems | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  | ✔️ | ✔️ |
| SwiperProps.skipHiddenItemLayout |  |  |  |  | ✔️ | ✔️ |  |  |  |  |  |
| SwiperProps.easingFunction | ✔️ |  | ✔️ | ✔️ |  | ✔️ |  |  |  |  |  |
| SwiperProps.disableTouch |  |  | ✔️ |  |  |  |  |  |  |  | ✔️ |
| SwiperProps.zoom |  |  |  |  |  |  | ✔️ |  |  | ✔️ |  |
| SwiperProps.full |  |  |  |  |  |  | ✔️ |  |  | ✔️ |  |
| SwiperProps.activeClass |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SwiperProps.changingClass |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SwiperProps.acceleration |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SwiperProps.disableProgrammaticAnimation |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SwiperProps.swipeRatio |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SwiperProps.swipeSpeed |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SwiperProps.touchAngle |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SwiperProps.adjustHeight |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SwiperProps.adjustVerticalHeight |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SwiperProps.disableTouchmove |  | ✔️ |  |  |  |  |  |  |  |  |  |
| SwiperProps.effectsProps |  |  |  |  |  |  | ✔️ |  |  |  |  |
| SwiperProps.onChange | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |
| SwiperProps.onTransition | ✔️ |  | ✔️ | ✔️ | ✔️ |  |  |  |  |  | ✔️ |
| SwiperProps.onAnimationFinish | ✔️ | ✔️ |  | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| SwiperProps.onAnimationEnd |  |  | ✔️ |  |  |  |  |  |  |  |  |
| SwiperProps.layoutType | ✔️ |  |  |  |  |  |  |  |  |  |  |
| SwiperProps.transformerType | ✔️ |  |  |  |  |  |  |  |  |  |  |
| SwiperProps.indicatorType | ✔️ |  |  |  |  |  |  |  |  |  |  |
| SwiperProps.indicatorMargin | ✔️ |  |  |  |  |  |  |  |  |  |  |
| SwiperProps.indicatorSpacing | ✔️ |  |  |  |  |  |  |  |  |  |  |
| SwiperProps.indicatorRadius | ✔️ |  |  |  |  |  |  |  |  |  |  |
| SwiperProps.indicatorWidth | ✔️ |  |  |  |  |  |  |  |  |  |  |
| SwiperProps.indicatorHeight | ✔️ |  |  |  |  |  |  |  |  |  |  |
| SwiperProps.indicatorAlignment | ✔️ |  |  |  |  |  |  |  |  |  |  |
| SwiperProps.indicatorOffset | ✔️ |  |  |  |  |  |  |  |  |  |  |
| SwiperProps.scrollWithAnimation | ✔️ |  |  |  |  |  |  |  |  |  |  |
| SwiperProps.cacheExtent | ✔️ |  |  |  |  |  |  |  |  |  |  |
| SwiperProps.onScrollStartWorklet | ✔️ |  |  |  |  |  |  |  |  |  |  |
| SwiperProps.onScrollUpdateWorklet | ✔️ |  |  |  |  |  |  |  |  |  |  |
| SwiperProps.onScrollEndWorklet | ✔️ |  |  |  |  |  |  |  |  |  |  |

### TChangeSource

导致变更的原因

| 参数 | 说明 |
| --- | --- |
| autoplay | 自动播放 |
| touch | 用户划动 |
|  | 其它原因 |

### TEasingFunction

指定 swiper 切换缓动动画类型

| 参数 | 说明 |
| --- | --- |
| default | 默认缓动函数 |
| linear | 线性动画 |
| easeInCubic | 缓入动画 |
| easeOutCubic | 缓出动画 |
| easeInOutCubic | 缓入缓出动画 |

### onCommonEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| current | `number` | 当前所在滑块的索引 |
| source | `keyof TChangeSource` | 导致变更的原因 |

### onChangeEventDetail

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| current | `number` | 是 | 当前所在滑块的索引 |
| source | `keyof TChangeSource` | 是 | 导致变更的原因 |
| currentItemId | `string` | 否 | SwiperItem的itemId参数值 |

### onTransitionEventDetail

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| dx | `number` | X 坐标 |
| dy | `number` | Y 坐标 |
</file>

<file path="docs/components/viewContainer/view.md">
---
title: View
sidebar_label: View
---

视图容器

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px"/> <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/> <img title="Harmony hybrid" src={require('@site/static/img/platform/harmonyHybrid.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/view.html)

## 类型

```tsx
ComponentType<ViewProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
export default class PageView extends Component {
  constructor() {
    super(...arguments)
  }

  render() {
    return (
      <View className='components-page'>
        <Text>flex-direction: row 横向布局</Text>
        <View className='flex-wrp' style='flex-direction:row;'>
          <View className='flex-item demo-text-1'/>
          <View className='flex-item demo-text-2'/>
          <View className='flex-item demo-text-3'/>
        </View>
        <Text>flex-direction: column 纵向布局</Text>
        <View className='flex-wrp' style='flex-direction:column;'>
          <View className='flex-item flex-item-V demo-text-1'/>
          <View className='flex-item flex-item-V demo-text-2'/>
          <View className='flex-item flex-item-V demo-text-3'/>
        </View>
      </View>
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <view class="components-page">
    <text>flex-direction: row 横向布局</text>
    <view class="flex-wrp flex-wrp-row" hover-class="hover" >
      <view class="flex-item demo-text-1" :hover-stop-propagation="true" />
      <view class="flex-item demo-text-2" hover-start-time="1000" hover-class="hover" />
      <view class="flex-item demo-text-3" hover-stayTime="1000" hover-class="hover" />
    </view>
    <text>flex-direction: column 纵向布局</text>
    <view class="flex-wrp flex-wrp-column">
      <view class="flex-item flex-item-V demo-text-1" />
      <view class="flex-item flex-item-V demo-text-2" />
      <view class="flex-item flex-item-V demo-text-3" />
    </view>
  </view>
</template>

<style>
.flex-wrp { display: flex; }
.flex-wrp-column{ flex-direction: column; }
.flex-wrp-row { flex-direction:row; padding: 20px; background: #f1f1f1; }
.flex-item { width: 180px; height: 90px; }
.demo-text-1 { background: #ccc; }
.demo-text-2 { background: #999; }
.demo-text-3 { background: #666; }
.hover {
  background: #000;
}
</style>
```
</TabItem>
</Tabs>

## ViewProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| hoverClass | `string` | `none` | 否 | 指定按下去的样式类。当 `hover-class="none"` 时，没有点击态效果 |
| hoverStyle | `StyleProp<ViewStyle>` | `none` | 否 | 由于 RN 不支持 hoverClass，故 RN 端的 View 组件实现了 `hoverStyle`属性，写法和 style 类似，只不过 `hoverStyle` 的样式是指定按下去的样式。 |
| hoverStopPropagation | `boolean` | `false` | 否 | 指定是否阻止本节点的祖先节点出现点击态 |
| hoverStartTime | `number` | `50` | 否 | 按住后多久出现点击态，单位毫秒 |
| hoverStayTime | `number` | `400` | 否 | 手指松开后点击态保留时间，单位毫秒 |
| disableScroll | `boolean` | `false` | 否 | 是否阻止区域内滚动页面。<br />说明： 如果 view 中嵌套 view，外层 view 设置 disable-scroll 为 true 时禁止内部的滚动。 |
| hidden | `boolean` | `false` | 否 | 是否隐藏。 |
| animation | `TaroGeneral.IAnyObject` | `{}` | 否 | 用于动画，详见 my.createAnimation 。使用 my.createAnimation 生成的动画是通过过渡（Transition）实现的，只会触发 onTransitionEnd，不会触发 onAnimationStart, onAnimationIteration, onAnimationEnd。 |
| role | `string` |  | 否 | 表示组件的语义角色。设置为 img 时，组件聚焦后读屏软件会朗读出 图像 ；设置为 button 时，聚焦后读屏软件会朗读出 按钮 。详情请参见 aria-component。 |
| ariaRole | `string` |  | 否 | 无障碍访问，（角色）标识元素的作用 |
| ariaLabel | `string` |  | 否 | 无障碍访问，（属性）元素的额外描述 |
| onTap | `CommonEventFunction` |  | 否 | 点击。 |
| onTouchStart | `CommonEventFunction` |  | 否 | 触摸动作开始。 |
| onTouchMove | `CommonEventFunction` |  | 否 | 触摸后移动。 |
| onTouchEnd | `CommonEventFunction` |  | 否 | 触摸动作结束。 |
| onTouchCancel | `CommonEventFunction` |  | 否 | 触摸动作被打断，如来电提醒，弹窗。 |
| onLongTap | `CommonEventFunction` |  | 否 | 长按 500ms 之后触发，触发了长按事件后进行移动将不会触发屏幕的滚动。 |
| onTransitionEnd | `CommonEventFunction` |  | 否 | 过渡（Transition）结束时触发。 |
| onAnimationIteration | `CommonEventFunction` |  | 否 | 每开启一次新的动画过程时触发。（第一次不触发） |
| onAnimationStart | `CommonEventFunction` |  | 否 | 动画开始时触发。 |
| onAnimationEnd | `CommonEventFunction` |  | 否 | 动画结束时触发。 |
| onAppear | `CommonEventFunction` |  | 否 | 当前元素可见面积超过50%时触发。 |
| onDisappear | `CommonEventFunction` |  | 否 | 当前元素不可见面积超过50%时触发。 |
| onFirstAppear | `CommonEventFunction` |  | 否 | 当前元素首次可见面积达到50%时触发。 |
| catchMove | `boolean` |  | 否 | 是否以 catch 的形式绑定 touchmove 事件<br />version: 3.1.0+ |

### API 支持度

| API | 微信小程序 | 百度小程序 | 支付宝小程序 | 抖音小程序 | QQ 小程序 | 京东小程序 | H5 | React Native | Harmony | Harmony hybrid | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| ViewProps.hoverClass | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️(由于 RN 不支持 hoverClass，故 RN 端的 View 组件实现了 `hoverStyle`属性，写法和 style 类似，只不过 `hoverStyle` 的样式是指定按下去的样式。) |  | ✔️ | ✔️ |
| ViewProps.hoverStyle |  |  |  |  |  |  |  | ✔️ |  |  |  |
| ViewProps.hoverStopPropagation | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  | ✔️ |
| ViewProps.hoverStartTime | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ViewProps.hoverStayTime | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  | ✔️ | ✔️ |
| ViewProps.disableScroll |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.hidden |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.animation |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.role |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.ariaRole |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ViewProps.ariaLabel |  |  |  |  | ✔️ |  |  |  |  |  |  |
| ViewProps.onTap |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.onTouchStart |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.onTouchMove |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.onTouchEnd |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.onTouchCancel |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.onLongTap |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.onTransitionEnd |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.onAnimationIteration |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.onAnimationStart |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.onAnimationEnd |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.onAppear |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.onDisappear |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.onFirstAppear |  |  | ✔️ |  |  |  |  |  |  |  |  |
| ViewProps.catchMove | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ | ✔️ |  |  |  |  |  |
</file>

<file path="docs/components/common.md">
---
title: common
sidebar_label: common
---

## StandardProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| id | `string` | 否 | 组件的唯一标示, 保持整个页面唯一 |
| className | `string` | 否 | 同 `class`，在 React/Nerv 里一般使用 `className` 作为 `class` 的代称 |
| style | `any` | 否 | 组件的内联样式, 可以动态设置的内联样式 |
| key | string or number | 否 | 如果列表中项目的位置会动态改变或者有新的项目添加到列表中，<br />需要使用 `wx:key` 来指定列表中项目的唯一的标识符。 |
| hidden | `boolean` | 否 | 组件是否显示, 所有组件默认显示 |
| animation | `{ actions: TaroGeneral.IAnyObject[]; }` | 否 | 动画属性 |
| ref | `LegacyRef<T>` | 否 | 引用 |
| dangerouslySetInnerHTML | `{ __html: string; }` | 否 | 渲染 HTML<br />[参考地址](/docs/html) |

## FormItemProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| name | `string` | 否 | 表单数据标识 |

## EventProps

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| onTouchStart | `(event: TouchEvent) => void` | 否 | 手指触摸动作开始 |
| onTouchMove | `(event: TouchEvent) => void` | 否 | 手指触摸后移动 |
| onTouchCancel | `(event: TouchEvent) => void` | 否 | 手指触摸动作被打断，如来电提醒，弹窗 |
| onTouchEnd | `(event: TouchEvent) => void` | 否 | 手指触摸动作结束 |
| onClick | `(event: ITouchEvent) => void` | 否 | 手指触摸后马上离开 |
| onLongPress | `(event: CommonEvent<any>) => void` | 否 | 手指触摸后，超过350ms再离开，如果指定了事件回调函数并触发了这个事件，tap事件将不被触发 |
| onLongClick | `(event: CommonEvent<any>) => void` | 否 | 手指触摸后，超过350ms再离开（推荐使用 longpress 事件代替） |
| onTransitionEnd | `(event: CommonEvent<any>) => void` | 否 | 会在 WXSS transition 或 Taro.createAnimation 动画结束后触发 |
| onAnimationStart | `(event: CommonEvent<any>) => void` | 否 | 会在一个 WXSS animation 动画开始时触发 |
| onAnimationIteration | `(event: CommonEvent<any>) => void` | 否 | 会在一个 WXSS animation 一次迭代结束时触发 |
| onAnimationEnd | `(event: CommonEvent<any>) => void` | 否 | 会在一个 WXSS animation 动画完成时触发 |
| onTouchForceChange | `(event: CommonEvent<any>) => void` | 否 | 在支持 3D Touch 的 iPhone 设备，重按时会触发 |

## CommonEvent

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `string` | 事件类型 |
| timeStamp | `number` | 事件生成时的时间戳 |
| target | `Target` | 触发事件的组件的一些属性值集合 |
| currentTarget | `Target` | 当前组件的一些属性值集合 |
| detail | `T` | 额外的信息 |
| preventDefault | `() => void` | 阻止元素发生默认的行为 |
| stopPropagation | `() => void` | 阻止事件冒泡到父元素,阻止任何父事件处理程序被执行 |

## BaseEventOrig

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| type | `string` | 事件类型 |
| timeStamp | `number` | 事件生成时的时间戳 |
| target | `Target` | 触发事件的组件的一些属性值集合 |
| currentTarget | `Target` | 当前组件的一些属性值集合 |
| detail | `T` | 额外的信息 |
| preventDefault | `() => void` | 阻止元素发生默认的行为 |
| stopPropagation | `() => void` | 阻止事件冒泡到父元素,阻止任何父事件处理程序被执行 |

## BaseTouchEvent

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| touches | `TouchDetail[]` | 触摸事件，当前停留在屏幕中的触摸点信息的数组 |
| changedTouches | `TouchDetail[]` | 触摸事件，当前变化的触摸点信息的数组 |

## CanvasTouchEvent

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| touches | `TouchDetail[]` | 触摸事件，当前停留在屏幕中的触摸点信息的数组 |
| changedTouches | `TouchDetail[]` | 触摸事件，当前变化的触摸点信息的数组 |

## ITouchEvent

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| touches | `TouchDetail[]` | 触摸事件，当前停留在屏幕中的触摸点信息的数组 |
| changedTouches | `TouchDetail[]` | 触摸事件，当前变化的触摸点信息的数组 |

## CanvasTouch

| 参数 | 类型 |
| --- | --- |
| identifier | `number` |
| x | `number` |
| y | `number` |

## ITouch

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| identifier | `number` | 触摸点的标识符 |
| pageX | `number` | 距离文档左上角的距离，文档的左上角为原点 ，横向为X轴，纵向为Y轴 |
| pageY | `number` | 距离文档左上角的距离，文档的左上角为原点 ，横向为X轴，纵向为Y轴 |
| clientX | `number` | 距离页面可显示区域（屏幕除去导航条）左上角距离，横向为X轴，纵向为Y轴 |
| clientY | `number` | 距离页面可显示区域（屏幕除去导航条）左上角距离，横向为X轴，纵向为Y轴 |

## Target

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `string` | 事件源组件的id |
| tagName | `string` | 当前组件的类型 |
| dataset | `{ [key: string]: any; }` | 事件源组件上由data-开头的自定义属性组成的集合 |

## currentTarget

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| id | `string` | 事件源组件的id |
| tagName | `string` | 当前组件的类型 |
| dataset | `{ [key: string]: any; }` | 事件源组件上由data-开头的自定义属性组成的集合 |

## NetStatus

网络状态数据

| 参数 | 类型 | 必填 |
| --- | --- | :---: |
| videoBitrate | `number` | 否 |
| audioBitrate | `number` | 否 |
| videoFPS | string or number | 否 |
| videoGOP | `number` | 否 |
| netSpeed | `number` | 否 |
| netJitter | `number` | 否 |
| videoWidth | string or number | 否 |
| videoHeight | string or number | 否 |
</file>

<file path="docs/components/event.md">
---
title: event
sidebar_label: event
---

## TaroEvent

| 参数 | 类型 | 说明 |
| --- | --- | --- |
| srcElement | `T` |  |
| target | `T` | Returns the object to which event is dispatched (its target). |
| detail | `D` |  |
</file>

<file path="docs/components/page-meta.md">
---
title: PageMeta
sidebar_label: PageMeta
---

页面属性配置节点，用于指定页面的一些属性、监听页面事件。只能是页面内的第一个节点。可以配合 navigation-bar 组件一同使用。
通过这个节点可以获得类似于调用 Taro.setBackgroundTextStyle Taro.setBackgroundColor 等接口调用的效果。

:::info
Taro v3.6.19 开始支持
开发者需要在页面配置里添加：`enablePageMeta: true`
:::

支持情况：<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px"/> <img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform icon_platform--not-support" width="25px"/> <img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform icon_platform--not-support" width="25px"/>  <img title="Harmony" src={require('@site/static/img/platform/harmony.png').default} className="icon_platform" width="25px"/>

> [参考文档](https://developers.weixin.qq.com/miniprogram/dev/component/page-meta.html)

## 类型

```tsx
ComponentType<PageMetaProps>
```

## 示例代码

import { ReactIcon, VueIcon } from '@site/static/icons'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs
  defaultValue="React"
  values={[{ label: <ReactIcon />, value: "React" }, { label: <VueIcon />, value: "Vue" }]}>
<TabItem value="React">

```tsx
// page.config.ts
export default definePageConfig({ enablePageMeta: true, ... })

// page.tsx
function Index () {
  return (
    <View>
     <PageMeta
       pageStyle={myPageStyle}
       onScroll={handleScroll}
     >
       <NavigationBar title={title} />
     </PageMeta>
   </View>
  )
}
```
</TabItem>
<TabItem value="Vue">

```html
<!-- page.config.ts -->
<!-- export default definePageConfig({ enablePageMeta: true, ... }) -->

<!-- page.vue -->
<template>
  <page-meta
    :page-style="myPageStyle"
    @scroll="handleScroll"
  >
    <navigation-bar :title="title" />
  </page-meta>
</template>
```
</TabItem>
</Tabs>

## PageMetaProps

| 参数 | 类型 | 默认值 | 必填 | 说明 |
| --- | --- | :---: | :---: | --- |
| backgroundTextStyle | `string` |  | 否 | 下拉背景字体、loading 图的样式，仅支持 dark 和 light |
| backgroundColor | `string` |  | 否 | 窗口的背景色，必须为十六进制颜色值 |
| backgroundColorTop | `string` |  | 否 | 顶部窗口的背景色，必须为十六进制颜色值，仅 iOS 支持 |
| backgroundColorBottom | `string` |  | 否 | 底部窗口的背景色，必须为十六进制颜色值，仅 iOS 支持 |
| scrollTop | `string` | `""` | 否 | 滚动位置，可以使用 px 或者 rpx 为单位，在被设置时，页面会滚动到对应位置 |
| scrollDuration | `number` | `300` | 否 | 滚动动画时长 |
| pageStyle | `string` | `""` | 否 | 页面根节点样式，页面根节点是所有页面节点的祖先节点，相当于 HTML 中的 body 节点 |
| rootFontSize | `string` | `""` | 否 | 页面的根字体大小，页面中的所有 rem 单位，将使用这个字体大小作为参考值，即 1rem 等于这个字体大小 |
| rootBackgroundColor | `string` |  | 否 | 页面内容的背景色，用于页面中的空白部分和页面大小变化 resize 动画期间的临时空闲区域 |
| pageFontSize | `string` |  | 否 | 页面 page 的字体大小，可以设置为 system ，表示使用当前用户设置的微信字体大小 |
| pageOrientation | `string` |  | 否 | 页面的方向，可为 auto portrait 或 landscape |
| onResize | `CommonEventFunction<onResizeEventDetail>` |  | 否 | 页面尺寸变化时会触发 resize 事件 |
| onScroll | `CommonEventFunction<onScrollEventDetail>` |  | 否 | 页面滚动时会触发 scroll 事件 |
| onScrollDone | `CommonEventFunction` |  | 否 | 如果通过改变 scroll-top 属性来使页面滚动，页面滚动结束后会触发 scrolldone 事件 |

### API 支持度

| API | 微信小程序 | 支付宝小程序 | H5 | React Native | Harmony | ASCF元服务 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| PageMetaProps.backgroundTextStyle | ✔️ |  |  |  |  |  |
| PageMetaProps.backgroundColor | ✔️ | ✔️ |  |  | ✔️ |  |
| PageMetaProps.backgroundColorTop | ✔️ | ✔️ |  |  | ✔️ |  |
| PageMetaProps.backgroundColorBottom | ✔️ | ✔️ |  |  | ✔️ |  |
| PageMetaProps.scrollTop | ✔️ | ✔️ |  |  | ✔️ |  |
| PageMetaProps.scrollDuration | ✔️ | ✔️ |  |  | ✔️ |  |
| PageMetaProps.pageStyle | ✔️ | ✔️ |  |  |  |  |
| PageMetaProps.rootFontSize | ✔️ | ✔️ |  |  |  |  |
| PageMetaProps.rootBackgroundColor | ✔️ | ✔️ |  |  | ✔️ |  |
| PageMetaProps.pageFontSize | ✔️ | ✔️ |  |  |  |  |
| PageMetaProps.pageOrientation | ✔️ |  |  |  |  |  |
| PageMetaProps.onResize | ✔️ |  |  |  |  |  |
| PageMetaProps.onScroll | ✔️ | ✔️ |  |  |  |  |
| PageMetaProps.onScrollDone | ✔️ |  |  |  |  |  |

### onResizeEventDetail

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| deviceOrientation | "portrait" or "landscape" | 否 | 设备方向 |
| size | `resizeType` | 是 | 窗口尺寸 |

### resizeType

窗口尺寸类型

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | :---: | --- |
| windowWidth | `number` | 是 | 窗口宽度 |
| windowHeight | `number` | 是 | 窗口高度 |
| screenWidth | `number` | 否 | 屏幕宽度 |
| screenHeight | `number` | 否 | 屏幕高度 |

### onScrollEventDetail

| 参数 | 类型 |
| --- | --- |
| scrollTop | `number` |
</file>

<file path="docs/harmony/lazy/index.md">
---
title: Harmony 长列表使用教程
---

:::info
Taro v4.1.0+ 开始支持
:::

长列表场景是大部分业务中都会出现的高频场景，因此在 Taro For Harmony 中，我们针对长列表场景提供了针对性的组件，来解决长列表节点的渲染和性能问题。

## 瀑布流组件

针对瀑布流类型的组件，我们提供了 `WaterFlow`、 `FlowItem` 以及 `FlowSection` 三个组件供开发者组合使用。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20250414165912.63171312108464795647082673503454:50001231000000:2800:841C788EAF028DF00289E424717ADD26AE6C1E63ABB113D71D98ADAD1B05169B.png)

### WaterFlow 组件

#### 功能描述

瀑布流布局容器，由"行"和"列"分割的单元格所组成，通过容器自身的排列规则，将不同大小的"项目"自上而下，如瀑布般紧密布局，仅支持 FlowSection 子组件，使用时需要给 WaterFlow 一个固定高度。

#### 参数说明

WaterFlow 的参数是 scroll-view 参数的子集，支持 scroll-view 除横向布局相关的参数和事件，WaterFlow 专有参数如下:

| 参数                | 类型   | 默认值 | 必填 | 说明                                                   |
| ------------------- | ------ | ------ | ---- | ------------------------------------------------------ |
| upperThresholdCount | number | 0      | 否   | 距顶部/左边多少个 FlowItem 时，触发 scrolltoupper 事件 |
| lowerThresholdCount | number | 0      | 否   | 距底部/右边多少个 FlowItem 时，触发 scrolltolower 事件 |
| cacheCount          | number | 1      | 否   | 设置预加载的 Item 条数                                 |

### FlowItem 组件

#### 功能描述

FlowSection 的子组件，用来展示瀑布流具体 item，支持单个子组件。

### FlowSection 组件

#### 功能描述

设置 FlowItem 分组配置信息，实现同一个瀑布流组件内部各分组使用不同列数混合布局，仅支持 FlowItem 子组件，且该组件的父组件只能是 WaterFlow。

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20250414170230.61245438925165538889632558324147:50001231000000:2800:4FDAFD38F8F20503C14BACB79EBC17D69DD408FD1441B66B0238E87862F12EAB.png)

#### 参数说明

| 参数      | 类型          | 默认值 | 必填 | 说明                                                                                                          |
| --------- | ------------- | ------ | ---- | ------------------------------------------------------------------------------------------------------------- |
| column    | number        | 1      | 否   | 纵向布局为列数，横向布局为行数。设置当前分组布局列/行数，该属性会将父组件 WaterFlow 的宽/高度均分成 column 份 |
| rawGap    | number/String | -      | 否   | 该分组的行间距，单位:vp                                                                                       |
| columnGap | number/String | -      | 否   | 该分组的列间距，单位:vp                                                                                       |

#### 使用示例

```jsx
import { View, WaterFlow, FlowItem, FlowSection } from '@tarojs/components'

export default function Index() {
  reutrn(
    <WaterFlow
      className="waterflow"
      lowerThresholdCount={20}
      scrollTop={scrollTop}
      showScrollbar={false}
      onScroll={scrollHandle}
      onScrollToLower={updateFeeds}
    >
      <FlowSection column={2} columnGap={Taro.pxTransform(20)} className="rcd-feeds">
        {FeedsRender}
      </FlowSection>
      <FlowSection column={1}>
        {isError && (
          <FlowItem>
            <View className="fcd-page-error">
              <View className="fcd-page-error__tip">网络不给力哦~请检查您的网络</View>
              <View className="fcd-page-error__refresh-btn" onClick={loadData}>
                刷新重试
              </View>
            </View>
          </FlowItem>
        )}
        {isLoading && !feedsData.isCache && (
          <FlowItem>
            <View className="feed-loading">
              <Image
                src="https://img13.360buyimg.com/img/jfs/t1/157587/2/39477/464436/65fcfe10F62450166/08cbf710d5be450d.gif"
                className="feed-loading-icon"
              ></Image>
            </View>
          </FlowItem>
        )}
        {isFeedsEnd && (
          <FlowItem>
            <View className="feeds-end">到底了</View>
          </FlowItem>
        )}
      </FlowSection>
    </WaterFlow>
  )
}
```

## 吸顶长列表组件

### List 组件

#### 功能描述

列表布局容器，仅支持 StickySection，ListItem 子组件，使用时需要给 List 一个固定高度。

#### 参数说明

List 的参数是 scroll-view 参数的子集，支持 scroll-view 的部分参数和事件，List 专有参数如下:

| 参数                | 类型          | 默认值 | 必填 | 说明                                                                                                                                                    |
| ------------------- | ------------- | ------ | ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| upperThresholdCount | number        | 0      | 否   | 距顶部/左边多少个 item 时，触发 scrolltoupper 事件                                                                                                      |
| lowerThresholdCount | number        | 0      | 否   | 距底部/右边多少个 item 时，触发 scrolltolower 事件                                                                                                      |
| cacheCount          | number        | 1      | 否   | item 预加载数                                                                                                                                           |
| stickyHeader        | boolean       | -      | 否   | List 包含子组件 StickySection，StickySection 有子组件 StickyHeader 时，该属性用于控制 StickyHeader 是否吸顶                                             |
| space               | number/String | 0      | 否   | 子组件主轴方向的间隔，单位:vp。说明：该字段只作用与 List 的直接子组件，对于 List 的子组件为 StickySection 的场景，该字段对 StickySection 子组件并不生效 |

:::tip
如果不需要吸顶能力，推荐直接使用 List 套 ListItem 的结构。
:::

### ListItem 组件

#### 功能描述

List，StickySection 的子组件，用来展示列表布局容器具体 item，支持单个子组件。

### StickyHeader 组件

#### 功能描述

StickySection 的子组件，设置 StickySection 的头部组件。当 List 组件 stickyHeader 属性为 true，且 StickySection 设置了 StickyHeader 时，该组件具有吸顶的能力。

### StickySection 组件

#### 功能描述

以分组的形式展示列表 item 分组，仅支持 ListItem，StickyHeader 子组件，且必须配合 List 组件使用。

#### 参数说明

| 参数  | 类型          | 默认值 | 必填 | 说明                                                                                                           |
| ----- | ------------- | ------ | ---- | -------------------------------------------------------------------------------------------------------------- |
| space | number/String | 0      | 否   | 列表项间距。只作用于 ListItem 与 ListItem 之间，不作用于 header 与 ListItem、footer 与 ListItem 之间。单位：vp |

#### 使用示例

```jsx
import { View, List, StickySection, StickyHeader, ListItem } from '@tarojs/components'

export default function Index() {
  reutrn(
    <List
      stickyHeader
      showScrollbar={false}
      className={styles.scrollV}
      scrollY={canScroll}
      onScroll={onScroll}
      scrollTop={scrollTopValue}
      onScrollToLower={srollToLowerHandler}
      lowerThreshold={100}
    >
      <StickySection className={styles.section}>
        <ListItem className={styles.listItem}>{floorItemsSections.floorItemsBeforeSticky}</ListItem>
      </StickySection>
      <StickySection className={`${styles.section} ${styles.sectionMain}`}>
        <StickyHeader>{floorItemsSections.stickyFloorItems}</StickyHeader>
        {feedItems.map((item, index) => {
          return (
            <ListItem key={`feed${index}`} className={styles.listItem}>
              {item}
            </ListItem>
          )
        })}
        <ListItem className={styles.listItem}>
          {searchStateInfo.showLoading ? <Loading /> : null}
          {searchStateInfo.showNoMore ? <PageFooter /> : null}
          {searchStateInfo.showNetError ? <NetErrorTip onRetry={retry} /> : null}
          {searchStateInfo.showPagIndicator ? (
            <Pagination pageInfo={pagIndicatorInfo} onPageChange={onPageChange} />
          ) : null}
        </ListItem>
      </StickySection>
    </List>
  )
}
```
</file>

<file path="docs/harmony/lazy/reuse.md">
---
title: Harmony 长列表节点复用
---

:::info
Taro v4.1.0+ 开始支持
:::

## 节点复用原理

节点复用是一种优化长列表性能的技术，通过复用已经创建的组件节点来减少不必要的创建和销毁操作，从而提升列表的渲染性能。

![复用使用方法和支持节点范围](https://img13.360buyimg.com/img/jfs/t1/277802/9/22633/55038/6800770dF346fb5f4/648bbe871c65ecfd.png)

## 使用方法

为支持节点复用，Taro 框架引入了一个新的属性 `reuseId`，表示以当前节点为根节点的子组件树可以被复用。开发者可以根据业务场景和 Item 结构特点，灵活地标记出具有相似性的子组件树。

### 支持复用的组件范围

当前支持复用的子组件如下表，上层业务在使用该特性的时候要保证可复用子组件树的所有子组件都在下表范围内，如果有要支持复用其他组件的需求，待 Taro 评估后决定是否提供。

| 组件名称    | 说明                                      |
| ----------- | ----------------------------------------- |
| View        | 基础视图组件                              |
| Text        | 文本组件                                  |
| Image       | 图片组件                                  |
| FlowItem    | 瀑布流 Item 组件                          |
| listItem    | 吸顶列表 Item 组件                        |
| MovableArea | 可移动区域组件，用于包裹 MovableView 组件 |
| MovableView | 可移动视图组件，可以在 MovableArea 中移动 |
| Input       | 输入框组件                                |

### reuseId 参数说明

| 参数    | 类型   | 默认值 | 必填 | 说明                                       |
| ------- | ------ | ------ | ---- | ------------------------------------------ |
| reuseId | string | 无     | 否   | 标识以当前节点为根节点的子组件树可以被复用 |

需要注意：

1. 如果该子组件树内部也包含 reuseId，则内部的 reuseId 会被忽略
2. 为最大程度发挥复用性能，上层业务要保证同一 reuseId 的子组件树尽量保持结构一致
3. 没有设置 reuseId 默认不复用

### 使用示例

```jsx
import React, { Fragment } from 'react'
import { FlowItem } from '@tarojs/components'

function Index(props) {
  const { allFeedsData } = props

  return (
    <>
      {allFeedsData
        .map((itemI, itemX) => {
          if (['Goods', 'Shop', 'Market', 'Video'].indexOf(itemI.tpl) === -1) return null

          const IS_VIDEO = itemI.tpl === 'Video'

          return (
            <FlowItem key={itemI.ikey} reuseId={IS_VIDEO ? '' : itemI.tpl}>
              <Fragment>
                {itemI.tpl === 'Goods' && <Goods item={itemI} index={itemI._index} />}
                {itemI.tpl === 'Shop' && <Shop item={itemI} index={itemI._index} />}
                {itemI.tpl === 'Market' && <Market item={itemI} index={itemI._index} />}
                {itemI.tpl === 'Video' && (
                  <TaroVideo
                    item={itemI}
                    index={itemI._index}
                    loca="right"
                    playVideoId={playVideoId}
                    playOrStopNextVideo={playOrStopNextVideo}
                  />
                )}
              </Fragment>
            </FlowItem>
          )
        })
        .filter((item) => !!item)}
    </>
  )
}
```
</file>

<file path="docs/harmony/c-api-css.md">
---
title: Harmony-CPP CSS 属性支持
---

:::info
本文档列出了 Harmony 平台支持的 CSS 属性及其可选值
:::

## 选择器

### 基本选择器

| 选择器         | 示例               | 说明                          |
| -------------- | ------------------ | ----------------------------- |
| 类选择器       | `.class`           | 选择所有具有指定 class 的元素 |
| 后代选择器     | `.parent .child`   | 选择指定元素内的所有后代元素  |
| 直接后代选择器 | `.parent > .child` | 选择指定元素的直接子元素      |
| 多类选择器     | `.class1.class2`   | 选择同时具有多个 class 的元素 |

### 伪元素

| 选择器  | 示例              | 说明                 |
| ------- | ----------------- | -------------------- |
| :before | `.element:before` | 在元素内容前插入内容 |
| :after  | `.element:after`  | 在元素内容后插入内容 |

### 伪类

| 选择器       | 示例                    | 说明                       |
| ------------ | ----------------------- | -------------------------- |
| :nth-child   | `.parent :nth-child(2)` | 选择父元素的第 n 个子元素  |
| :first-child | `.parent :first-child`  | 选择父元素的第一个子元素   |
| :last-child  | `.parent :last-child`   | 选择父元素的最后一个子元素 |
| :empty       | `.element:empty`        | 选择没有子元素的元素       |

### 使用示例

```css
/* 类选择器 */
.class {
  color: red;
}

/* 后代选择器 */
.parent .child {
  margin: 10px;
}

/* 直接后代选择器 */
.parent > .child {
  padding: 5px;
}

/* 多类选择器 */
.class1.class2 {
  background-color: blue;
}

/* 伪元素 */
.element:before {
  content: '前缀';
}

.element:after {
  content: '后缀';
}

/* 伪类 */
.parent :nth-child(2) {
  font-weight: bold;
}

.parent :first-child {
  color: green;
}

.parent :last-child {
  color: blue;
}

.element:empty {
  display: none;
}
```

:::warning
暂不支持 CSS 属性继承，所有属性都需要显式设置
:::

## 布局属性

### Flex 布局

| 属性            | 默认值       | 可选值                                                                              | 说明                                    |
| --------------- | ------------ | ----------------------------------------------------------------------------------- | --------------------------------------- |
| display         | 'flex'       | 'flex', 'none', 'block', 'box'                                                      | 设置元素的显示类型，不支持 inline-block |
| flex-wrap       | 'nowrap'     | 'nowrap', 'wrap', 'wrap-reverse'                                                    | 设置 flex 元素是否换行                  |
| flex-direction  | 'row'        | 'row', 'row-reverse', 'column', 'column-reverse'                                    | 设置 flex 元素的主轴方向                |
| align-items     | 'flex-start' | 'flex-start', 'flex-end', 'center', 'baseline', 'stretch'                           | 设置 flex 元素在交叉轴上的对齐方式      |
| align-content   | 'flex-start' | 'flex-start', 'flex-end', 'center', 'space-between', 'space-around', 'space-evenly' | 设置多行 flex 元素在交叉轴上的对齐方式  |
| justify-content | 'flex-start' | 'flex-start', 'flex-end', 'center', 'space-between', 'space-around', 'space-evenly' | 设置 flex 元素在主轴上的对齐方式        |
| flex            | '0 1 auto'   | flexGrow, flexShrink, flexBasis                                                     | 设置 flex 元素的伸缩性                  |
| flex-grow       | 0            | Number                                                                              | 设置 flex 元素的放大比例                |
| flex-shrink     | 1            | Number                                                                              | 设置 flex 元素的缩小比例                |
| flex-basis      | 'auto'       | Length                                                                              | 设置 flex 元素在主轴上的初始大小        |
| align-self      | 'auto'       | 'flex-start', 'flex-end', 'center', 'baseline', 'stretch', 'auto'                   | 设置单个 flex 元素在交叉轴上的对齐方式  |

### 定位

| 属性     | 默认值     | 可选值                          | 说明                                                                                         |
| -------- | ---------- | ------------------------------- | -------------------------------------------------------------------------------------------- |
| position | 'relative' | 'relative', 'absolute', 'fixed' | 设置元素的定位方式                                                                           |
| top      | 'auto'     | Length                          | 设置元素的上边距                                                                             |
| bottom   | 'auto'     | Length                          | 设置元素的下边距                                                                             |
| left     | 'auto'     | Length                          | 设置元素的左边距                                                                             |
| right    | 'auto'     | Length                          | 设置元素的右边距                                                                             |
| z-index  | 'auto'     | Number                          | 设置元素的堆叠顺序，注意：z-index 仅在相同层级元素之间生效，跨层级元素之间的堆叠顺序不受影响 |

### 盒模型

:::info
盒模型默认使用 `box-sizing: border-box`，即元素的宽度和高度包含内边距和边框
:::

| 属性           | 默认值 | 可选值                    | 说明               |
| -------------- | ------ | ------------------------- | ------------------ |
| margin         | 0      | Length（可设置 1~4 个值） | 设置元素的外边距   |
| margin-left    | 0      | Length                    | 设置元素的左外边距 |
| margin-right   | 0      | Length                    | 设置元素的右外边距 |
| margin-top     | 0      | Length                    | 设置元素的上外边距 |
| margin-bottom  | 0      | Length                    | 设置元素的下外边距 |
| padding        | 0      | Length（可设置 1~4 个值） | 设置元素的内边距   |
| padding-left   | 0      | Length                    | 设置元素的左内边距 |
| padding-right  | 0      | Length                    | 设置元素的右内边距 |
| padding-top    | 0      | Length                    | 设置元素的上内边距 |
| padding-bottom | 0      | Length                    | 设置元素的下内边距 |
| width          | 'auto' | Length                    | 设置元素的宽度     |
| min-width      | 'auto' | Length                    | 设置元素的最小宽度 |
| max-width      | 'none' | Length                    | 设置元素的最大宽度 |
| height         | 'auto' | Length                    | 设置元素的高度     |
| min-height     | 'auto' | Length                    | 设置元素的最小高度 |
| max-height     | 'none' | Length                    | 设置元素的最大高度 |

### 边框

| 属性                       | 默认值  | 可选值                                         | 说明                 |
| -------------------------- | ------- | ---------------------------------------------- | -------------------- |
| border                     | '0'     | Length（可设置 1~4 个值）                      | 设置元素的边框       |
| border-width               | '0'     | Length                                         | 设置元素的边框宽度   |
| border-left-width          | '0'     | Length                                         | 设置元素的左边框宽度 |
| border-right-width         | '0'     | Length                                         | 设置元素的右边框宽度 |
| border-top-width           | '0'     | Length                                         | 设置元素的上边框宽度 |
| border-bottom-width        | '0'     | Length                                         | 设置元素的下边框宽度 |
| border-color               | 'black' | Color（可设置 1~4 个值）                       | 设置元素的边框颜色   |
| border-left-color          | 'black' | Color                                          | 设置元素的左边框颜色 |
| border-right-color         | 'black' | Color                                          | 设置元素的右边框颜色 |
| border-top-color           | 'black' | Color                                          | 设置元素的上边框颜色 |
| border-bottom-color        | 'black' | Color                                          | 设置元素的下边框颜色 |
| border-style               | 'solid' | 'dotted', 'dashed', 'solid'（可设置 1~4 个值） | 设置元素的边框样式   |
| border-left-style          | 'solid' | 'dotted', 'dashed', 'solid'                    | 设置元素的左边框样式 |
| border-right-style         | 'solid' | 'dotted', 'dashed', 'solid'                    | 设置元素的右边框样式 |
| border-top-style           | 'solid' | 'dotted', 'dashed', 'solid'                    | 设置元素的上边框样式 |
| border-bottom-style        | 'solid' | 'dotted', 'dashed', 'solid'                    | 设置元素的下边框样式 |
| border-radius              | '0'     | Length（可设置 1~4 个值）                      | 设置元素的边框圆角   |
| border-top-left-radius     | '0'     | Length                                         | 设置元素的左上角圆角 |
| border-top-right-radius    | '0'     | Length                                         | 设置元素的右上角圆角 |
| border-bottom-left-radius  | '0'     | Length                                         | 设置元素的左下角圆角 |
| border-bottom-right-radius | '0'     | Length                                         | 设置元素的右下角圆角 |

## 文本属性

| 属性                  | 默认值         | 可选值                                          | 说明                               |
| --------------------- | -------------- | ----------------------------------------------- | ---------------------------------- |
| color                 | 'black'        | Color                                           | 设置文本颜色，不会继承             |
| font-size             | '14vp'         | Length                                          | 设置字体大小，不会继承             |
| text-align            | 'left'         | 'center', 'left', 'right'                       | 设置文本对齐方式，不会继承         |
| font-weight           | 'normal'       | 100~900, 'bold', 'bolder', 'lighter', 'normal'  | 设置字体粗细，不会继承             |
| vertical-align        | 'baseline'     | 'middle', 'top', 'bottom'                       | 设置垂直对齐方式，不会继承         |
| letter-spacing        | 'normal'       | Length                                          | 设置字符间距，不会继承             |
| text-overflow         | 'clip'         | 'ellipsis', 'clip'                              | 设置文本溢出时的处理方式，不会继承 |
| -webkit-line-clamp    | 'none'         | Number                                          | 设置文本显示的行数，不会继承       |
| word-break            | 'normal'       | 'break-all', 'keep-all', 'normal'               | 设置文本换行方式，不会继承         |
| text-decoration       | 'none'         | -                                               | 设置文本装饰，不会继承             |
| text-decoration-color | 'currentColor' | Color                                           | 设置文本装饰颜色，不会继承         |
| text-decoration-style | 'solid'        | 'dotted', 'dashed', 'solid'                     | 设置文本装饰样式，不会继承         |
| text-decoration-line  | 'none'         | 'line-through', 'underline', 'overline', 'none' | 设置文本装饰线，不会继承           |
| white-space           | 'normal'       | 'nowrap', 'normal'                              | 设置空白处理方式，不会继承         |

## 背景属性

| 属性                  | 默认值        | 可选值                                                                       | 说明                                                  |
| --------------------- | ------------- | ---------------------------------------------------------------------------- | ----------------------------------------------------- |
| background            |               |                                                                              | 设置背景，内联样式暂不支持颜色名称（如 red、blue 等） |
| background-color      | 'transparent' | Color                                                                        | 设置背景颜色                                          |
| background-image      | 'none'        | 'src(xxx)', 'linear-gradient(xxx)', 'radial-gradient(xxx)'                   | 设置背景图片或渐变                                    |
| background-size       | 'auto'        | 'cover', 'contain', Length(x y), Length(x) Length(y)                         | 设置背景图片大小                                      |
| background-repeat     | 'repeat'      | 'repeat', 'no-repeat', 'repeat-x', 'repeat-y'                                | 设置背景图片重复方式                                  |
| background-position   | '0% 0%'       | 'center', 'top', 'bottom', 'left', 'right', Length(x y), Length(x) Length(y) | 设置背景图片位置                                      |
| background-position-x | '0%'          | 'center', 'top', 'bottom', 'left', 'right', Length(x y), Length(x) Length(y) | 设置背景图片水平位置                                  |
| background-position-y | '0%'          | 'center', 'top', 'bottom', 'left', 'right', Length(x y), Length(x) Length(y) | 设置背景图片垂直位置                                  |

## 变换和动画

### 变换

| 属性      | 默认值 | 可选值                                                                                                                                                                  | 说明               |
| --------- | ------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ |
| transform | 'none' | 'translate', 'translateX', 'translateY', 'translateZ', 'translate2d', 'translate3d', 'scale', 'scaleX', 'scaleY', 'scale3d', 'rotate', 'rotateX', 'rotateY', 'rotate3d' | 设置元素的变换效果 |

### 动画

| 属性                      | 默认值   | 可选值                                                                                                        | 说明                               |
| ------------------------- | -------- | ------------------------------------------------------------------------------------------------------------- | ---------------------------------- |
| animation                 |          |                                                                                                               | 设置动画，暂不支持内联样式         |
| animation-name            | 'none'   | String                                                                                                        | 设置动画名称，暂不支持内联样式     |
| animation-duration        | '0s'     | Number                                                                                                        | 设置动画持续时间，暂不支持内联样式 |
| animation-delay           | '0s'     | Number                                                                                                        | 设置动画延迟时间，暂不支持内联样式 |
| animation-fill-mode       | 'none'   | 'none', 'forwards', 'backwards', 'both'                                                                       | 设置动画填充模式，暂不支持内联样式 |
| animation-iteration-count | '1'      | Number                                                                                                        | 设置动画重复次数，暂不支持内联样式 |
| animation-timing-function | 'ease'   | 'ease', 'linear', 'ease-in', 'ease-out', 'ease-in-out', 'step-start', 'step-end', 'cubic-bezier()', 'steps()' | 设置动画时间函数，暂不支持内联样式 |
| animation-direction       | 'normal' | 'normal', 'reverse', 'alternate', 'alternate-reverse'                                                         | 设置动画方向，暂不支持内联样式     |

### 过渡

| 属性                       | 默认值 | 可选值                                                                                                        | 说明                               |
| -------------------------- | ------ | ------------------------------------------------------------------------------------------------------------- | ---------------------------------- |
| transition                 |        |                                                                                                               | 设置过渡，暂不支持内联样式         |
| transition-property        | 'all'  | all，支持属性：height, width, margin, padding, border, color, background-color, transform, opacity            | 设置过渡属性，暂不支持内联样式     |
| transition-duration        | '0s'   | Number                                                                                                        | 设置过渡持续时间，暂不支持内联样式 |
| transition-delay           | '0s'   | Number                                                                                                        | 设置过渡延迟时间，暂不支持内联样式 |
| transition-timing-function | 'ease' | 'ease', 'linear', 'ease-in', 'ease-out', 'ease-in-out', 'step-start', 'step-end', 'cubic-bezier()', 'steps()' | 设置过渡时间函数，暂不支持内联样式 |

## 其他属性

| 属性              | 默认值    | 可选值                                | 说明                     |
| ----------------- | --------- | ------------------------------------- | ------------------------ |
| box-shadow        | 'none'    | -                                     | 设置元素阴影             |
| box-shadow-color  | 'black'   | Color                                 | 设置阴影颜色             |
| box-shadow-offset | '0 0'     | Length(x y), Length(x) Length(y)      | 设置阴影偏移             |
| box-shadow-blur   | '0'       | Length                                | 设置阴影模糊半径         |
| overflow          | 'visible' | 'hidden', 'visible', 'scroll', 'auto' | 设置内容溢出时的处理方式 |
| visibility        | 'visible' | 'hidden', 'visible'                   | 设置元素可见性           |
| opacity           | '1'       | Number                                | 设置元素透明度           |

## 媒体查询

### 支持的媒体特性

| 特性                | 说明       |
| ------------------- | ---------- |
| width               | 视口宽度   |
| height              | 视口高度   |
| aspect-ratio        | 视口宽高比 |
| orientation         | 视口方向   |
| device-width        | 设备宽度   |
| device-height       | 设备高度   |
| device-aspect-ratio | 设备宽高比 |
| resolution          | 设备分辨率 |

### 支持的复合查询

| 操作符 | 说明     |
| ------ | -------- |
| not    | 否定查询 |
| and    | 逻辑与   |
| or     | 逻辑或   |

### 使用示例

```css
/* 设备宽度大于等于 768px */
@media (min-width: 768px) {
  /* 样式 */
}

/* 设备方向为横屏 */
@media (orientation: landscape) {
  /* 样式 */
}

/* 设备宽度在 768px 到 1024px 之间 */
@media (min-width: 768px) and (max-width: 1024px) {
  /* 样式 */
}

/* 设备宽度小于 768px 或大于 1024px */
@media (max-width: 768px), (min-width: 1024px) {
  /* 样式 */
}
```

## 说明

### 长度单位

| 单位   | 说明             | 示例                       |
| ------ | ---------------- | -------------------------- |
| px     | 像素             | `10px`                     |
| vp     | 虚拟像素         | `10vp`                     |
| %      | 百分比           | `50%`                      |
| vw     | 视口宽度的百分比 | `50vw`                     |
| vh     | 视口高度的百分比 | `50vh`                     |
| calc() | 计算表达式       | `calc(100% - 20px)`        |
| env()  | 环境变量         | `env(safe-area-inset-top)` |

### 颜色值

| 格式     | 说明                  | 示例                   |
| -------- | --------------------- | ---------------------- |
| 十六进制 | 6 位或 8 位十六进制数 | `#FF0000`, `#FF0000FF` |
| RGB      | RGB 颜色值            | `rgb(255, 0, 0)`       |
| RGBA     | 带透明度的 RGB 颜色值 | `rgba(255, 0, 0, 0.5)` |
| 颜色名称 | 预定义的颜色名称      | `red`, `blue`, `green` |

### 支持的动画和过渡属性

| 属性             | 说明     |
| ---------------- | -------- |
| height           | 高度     |
| width            | 宽度     |
| margin           | 外边距   |
| padding          | 内边距   |
| border           | 边框     |
| color            | 颜色     |
| background-color | 背景颜色 |
| transform        | 变换     |
| opacity          | 透明度   |
</file>

<file path="docs/harmony/c-api.md">
---
title: Harmony-CPP 插件安装和使用
---

:::info
Taro v4.1.0+ 开始支持
:::

本章节会介绍如何使用 Taro For Harmony 插件，实现 Taro 项目打包纯血鸿蒙应用的能力。

## 快速开始

### 安装和使用

- 安装 harmony 插件

  ```shell
  # 使用 npm 安装
  $ npm i @tarojs/plugin-platform-harmony-cpp
  # 使用 pnpm 安装
  $ pnpm i @tarojs/plugin-platform-harmony-cpp
  ```

- 添加插件配置

  ```ts
  import os from 'os'
  import path from 'path'

  const config = {
    // ...
    plugin: ['@tarojs/plugin-platform-harmony-cpp'],
    harmony: {
      // 当前仅支持使用 Vite 编译鸿蒙应用
      compiler: 'vite',
      // Note: 鸿蒙工程路径，可以参考 [鸿蒙应用创建导读](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/start-with-ets-stage-0000001477980905-V2) 创建
      projectPath: path.join(os.homedir(), 'projects/my-business-project'),
      // Taro 项目编译到对应鸿蒙模块名，默认为 entry
      hapName: 'entry',
    },
    // ...
  }
  ```

### 编译项目

```sh
# 编译鸿蒙应用
$ taro build --type harmony_cpp
# 编译鸿蒙原生组件
$ taro build native-components --type harmony_cpp
```

如果需要编译鸿蒙应用，同时使用编译鸿蒙原生组件，可以在页面配置中添加 `entryOption: false` 表示该页面是组件，同时可以用过 `componentName` 指定组件导出名。

```diff
export default {
  navigationBarTitleText: 'Hello World',
+  componentName: 'MyComponent',
+  entryOption: false,
}
```

## 功能

### 使用公共依赖库

插件默认使用内置版本的公共依赖库，可以通过 useChoreLibrary 配置禁用或者配置指定版本依赖。

```ts
const config = {
  // ...
  plugin: [
    '@tarojs/plugin-platform-harmony-cpp', // useChoreLibrary: 'local'
    // ['@tarojs/plugin-platform-harmony-cpp', { useChoreLibrary: false }],
    // ['@tarojs/plugin-platform-harmony-cpp', { useChoreLibrary: '4.1.0-alpha.0' }],
  ],
  harmony: {
    ohPackage: {
      dependencies: {
        library: 'file:../library',
      },
    },
  },
  // ...
}
```

插件版本可以通过 `ohPackage.dependencies` 配置或者鸿蒙工程内 `oh-package.json5` 配置覆盖。

### 类型定义

需要在 Taro 项目的 types/global.d.ts 文件夹里添加对插件类型的引用

```ts
/// <reference types="@tarojs/taro" />
/// <reference path="../node_modules/@tarojs/plugin-platform-harmony-cpp/types/define.d.ts" />
```

## 项目集成

Taro 默认支持构建鸿蒙应用，同时也允许开发者灵活扩展功能。你可以在 Taro 项目中使用鸿蒙原生模块，也可以在鸿蒙项目中集成 Taro 模块。

### 在 Taro 中使用鸿蒙原生模块

与 Taro 在其他端类似，可以通过配置 `usingComponents` 来引入鸿蒙原生组件。

```ts
/** index.config.ts */
export default {
  usingComponents: {
    title: './path/to/title-component',
  },
}

/** index.ts */
import { View } from '@tarojs/components'

export default function Index() {
  return (
    <View>
      <title title="Hello World!" />
    </View>
  )
}
```

如果希望使用 Taro 构建的鸿蒙原生组件或者为原生组件提供类型提示，也可以通过 `importNativeComponent` 方法来引入。

```ts
/** title.ts */
import { View } from '@tarojs/components'

definePageConfig({
  entryOption: false,
  componentName: 'Title',
})

export default function Title({ title = 'Hello World' }) {
  return <View>{title}</View>
}

// importNativeComponent(path, moduleName, componentName)
export const Title = importNativeComponent<typeof import('./title').default>('./title', 'title', 'Title')

/** index.ts */
import { View } from '@tarojs/components'
import { Title } from './title'

export default function Index() {
  return (
    <View>
      <Title title="Hello World!" />
    </View>
  )
}
```

### 在鸿蒙项目中集成 Taro 模块

在鸿蒙项目中可以通过页面或者组件的形式来接入 Taro 模块，但如果不是 Taro 创建的鸿蒙项目需要在入口处添加 Taro 相关的初始化方法：

```ts
import { context, Current } from "@taro-oh/library/src/main/ets/npm/@tarojs/runtime"
import { TaroWindowUtil } from "@taro-oh/library/src/main/ets/npm/@tarojs/runtime"

export default class EntryAbility extends UIAbility {
  ...
  onWindowStageCreate(stage: ohWindow.WindowStage) {
    context.resolver(this.context)
    TaroWindowUtil.setWindowStage(stage)

    stage.loadContent('home_page', (err, data) => {
      const windowClass = stage.getMainWindowSync()
      Current.uiContext = windowClass.getUIContext()
      windowClass.setWindowLayoutFullScreen(true)
    })
  }
}
```

更多配置可以参考项目生成的 `app.ts` 文件改造。

通过页面接入需要在模块配置文件 `module.json5` 中配置 pages 参数，如果是组件模式，可以参考原生 ets 组件方法引入。

```plain
import { Title } from './components/title'

@Builder
function render () {
  Title({
    props: {
      title: 'Hello World!'
    }
  })
}
```

### 定制 Taro 运行时

与其他端类似，开发者同样可以通过继承 HarmonyCPP 实例来修改 Taro 的默认行为，包括新增运行时代码等。

```ts
import { HarmonyCPP } from '@tarojs/plugin-platform-harmony-cpp'

export default class MyTaro extends HarmonyCPP {
  // ...
  constructor() {
    super()
    // ...
    if (typeof this.runtimePath === 'string') {
      this.runtimePath = [this.runtimePath, path.resolve(__dirname, 'my-runtime')] // Note: 如果有需要可以覆盖 runtime 禁用 taro 默认 API 行为
    }
  }
}
```

> 如果不想构建端应用插件，也可以通过配置 copy 将自定义 ets 代码注入到项目中。

通过注入运行时，开发者可以监听 Taro 抛出的 `__taroPluginEtsMethodsTrigger` 事件，可以通过监听事件实现获取开发用户调用 Taro 方法的参数，或者修改 Taro 的默认行为。

```ts
import { eventCenter } from '@tarojs/runtime'
import { IEtsMethodsOptions } from '@tarojs/plugin-platform-harmony-cpp/dist/runtime/runtime-harmony'

/**
 * interface IEtsMethodsOptions {
 *   methodName?: string
 *   name?: string
 *   scope?: string
 *   type?: string
 *   args?: TaroAny[]
 *   successHandler?: (...args: TaroAny[]) => void
 *   errorHandler?: (...args: TaroAny[]) => void
 *   onInit?: (obj: TaroAny) => void
 * }
 */

eventCenter?.on('__taroPluginEtsMethodsTrigger', (option: IEtsMethodsOptions) => {
  switch (option.scope) {
    case 'route':
      // ...
      break
    default:
      break
  }
})
```

> 未实现的 API 可以通过监听 `__taroNotSupport` 事件自定义实现。
</file>

<file path="docs/harmony/hybrid.md">
---
title: Hybrid 容器方案
---

:::info
Taro v3.6.24+ 开始支持
:::

## 简介

Taro Harmony Hybrid 容器是为让 Taro 小程序代码可以完整的运行在鸿蒙单内核系统里，在 Taro H5 平台的基础上，基于原生壳工程的 JSBridge 能力，扩展 H5 平台不支持的小程序 Api 能力，让 Taro 小程序 0 成本运行在鸿蒙系统。

此方案不同于 Taro 的 Harmony 原生方案，其运行时还是 Webview，重点解决 Api 切换的问题。

![taroharmonyhybrid](@site/static/img/taroharmonyhybrid.jpg)

## 快速编译运行

### H5 侧编译运行

Taro CLI 依赖于 Node.js 环境，所以在你的机器上需要安装 Node.js 环境。请确保已具备较新的 node 环境（>=16.20.0）。当你的机器已经存在了 Node.js 环境，可以通过在终端输入命令  npm i -g `@tarojs/cli`  安装 Taro CLI。安装完毕之后，在终端输入命令  taro，如果出现类似内容就说明安装成功了：

```shell
👽 Taro v3.6.25
Usage: taro <command> [options]
Options:
  -V, --version       output the version number
  -h, --help          output usage information
```

安装好 Taro CLI 之后可以通过 taro init  命令创建一个全新的项目，你可以根据你的项目需求填写各个选项，一个最小版本的 Taro 项目会包括以下文件：

```
├── babel.config.js             # Babel 配置
├── .eslintrc.js                # ESLint 配置
├── config                      # 编译配置目录
│   ├── dev.js                  # 开发模式配置
│   ├── index.js                # 默认配置
│   └── prod.js                 # 生产模式配置
├── package.json                # Node.js manifest
├── dist                        # 打包目录
├── project.config.json         # 小程序项目配置
└── src # 源码目录
    ├── app.config.js           # 全局配置
    ├── app.css                 # 全局 CSS
    ├── app.js                  # 入口组件
    ├── index.html              # H5 入口 HTML
    └── pages                   # 页面组件
        └── index
            ├── index.config.js # 页面配置
            ├── index.css       # 页面 CSS
            └── index.jsx       # 页面组件，如果是 Vue 项目，此文件为 index.vue
```

通过 Taro CLI 工具基于`默认模板`创建 Taro 工程，使用如下编译命令生成 harmony-hybrid 平台的 Web 资源：

```shell
# 项目根目录下安装依赖
# yarn
$ yarn install
# npm script
$ npm install
# pnpm script
$ pnpm install

# 编译项目
# yarn
$ yarn build:harmony-hybrid
# npm script
$ npm run build:harmony-hybrid
# pnpm script
$ pnpm build:harmony-hybrid
```

生成的产物在 `dist` 目录下

开发可参考项目：[mini-program-example](https://github.com/NervJS/taro/tree/main/examples/mini-program-example)

### 壳工程编译运行

Taro `harmony-hybrid` 平台产物需要结合鸿蒙壳工程一起编译运行才能实现完整的功能。`@hybrid/web-container` 三方库模块提供了鸿蒙 `TaroWebContainer` 等组件和 API，支持开发者快速构建运行环境。鸿蒙壳工程使用 `@hybrid/web-container` 模块的方式如下：

- 使用 DevEco Studio 开发工具（ >= 5.0.3.100 ）新建应用工程，选择 Empty Ability 模板，API >= 11, 其他配置使用默认值。
- 在 `entry/oh-package.json5` 文件中添加 `@hybrid/web-container` 模块的依赖并点击 Sync 进行同步：

```json
{
  "license": "ISC",
  "devDependencies": {},
  "name": "entry",
  "description": "演示如何使用TaroWebContainer组件",
  "version": "1.0.0",
  "dependencies": {
    "@hybrid/web-container": "2.0.0-rc.7"
  }
}
```

具体使用方式请参考下个章节：集成到现有鸿蒙工程

- 最后点击菜单 `Build` -- `Rebuild Project` 编译项目。

## 集成到现有鸿蒙工程

### 初始化

在 src/main/ets/entryability/EntryAbility.ets 中的 windowStage.loadContent 里初始化和预加载，扩展原生 Api 可参考进阶教程中部分

```ts
import { TaroHybridManager, InjectObject } from '@hybrid/web-container'
import router from '@ohos.router'

const nativeObj: InjectObject = {}

// 在windowStage.loadContent中初始化项目
windowStage.loadContent('pages/Index', (err) => {
  // 全局初始化
  TaroHybridManager.init({
    uiAbilityContext: this.context,
    domain: 'https://customer.domain.com', // 小程序的域名，注意：此处不添加/结尾
    injectNativeMethod: (indexHtmlPath: string, uiAbilityContext: common.UIAbilityContext) => {
      // 扩展原生API
      return nativeObj
    },
    rootIndexHtmlPath: '/index.html',
    nativeBack: () => {
      router.back()
    },
    forceDarkAccess: true,
    windowClass: windowStage.getMainWindowSync(),
    rawFileName: 'spa',
    diskCacheEnable: true,
  })
  // 预加载，可选，不是必须
  TaroHybridManager.preLoader(
    windowStage.getMainWindowSync().getUIContext(),
    '/xx/index.html', // html的path路由
    '/pages/index/index' // Taro小程序的Page路径
  )
})
```

**TaroHybridManager.init 参数说明：**

init 方法的参数类型为 `TaroHybridManagerOptions`, 各字段说明如下：

| 字段名称           | 类型                                       | 描述                                               | 必填 |
| ------------------ | ------------------------------------------ | -------------------------------------------------- | ---- |
| uiAbilityContext   | UIAbilityContext                           | UIAbility 的上下文对象                             | 是   |
| windowClass        | Window                                     | 主窗口                                             | 是   |
| injectNativeMethod | (string, UIAbilityContext) => InjectObject | 注入对象生成函数                                   | 否   |
| nativeBack         | () => void                                 | 多容器场景回退自定义函数，只作用于 TaroHybrid 组件 | 否   |
| rootIndexHtmlPath  | string                                     | 主资源路径，只作用于 TaroHybrid 组件               | 否   |
| forceDarkAccess    | boolean                                    | 是否强制反色适配深色模式，只作用于 TaroHybrid 组件 | 否   |
| domain             | string                                     | 小程序的域名，此处不添加/结尾                      | 否   |
| rawFileName        | string                                     | 小程序的 bundle 目录                               | 否   |
| diskCacheEnable    | boolean                                    | 小程序磁盘是否缓存，默认 true                      | 否   |

### 简单集成（TaroWebContainer）

`TaroWebContainer` 组件提供加载单页面 Web 应用能力，并提供部分 Taro API 鸿蒙版本。

**使用方法：**

在 src/main/ets/pages/Index.ets 中使用 TaroWebContainer 组件拉起 taro 项目

```typescript
import Want from '@ohos.app.ability.Want';
import Url from '@ohos.url';
import { TaroWebContainer, InjectObject, HostPageState, TaroWebController } from '@hybrid/web-container';

const WEB_CONTAINER_PAGE_TAG = 'WebContainerPage';
let storage = LocalStorage.getShared() // 获取共享的本地存储对象
const TAG = 'WebContainerPage';

@Entry(storage)
@Component
struct WebContainerPage {
  @LocalStorageProp('want') want: Want = {};
  @State pageState: HostPageState = HostPageState.PageInit;
  @State taroWebController: TaroWebController = new TaroWebController();

  // 用户可以自定义对象注入到Web环境中，使用native.sayHello格式进行调用
  nativeObj: InjectObject = {
    sayHello: () => console.log(TAG, 'sayHello %{public}s', 'Hello World'),
  }

  onBackPress() {
    if (this.taroWebController.accessBackward()) {
      this.taroWebController.backward();
      return true;
    }
    return false;
  }

  onPageShow() {
    this.pageState = HostPageState.PageOnShow;
  }

  onPageHide() {
    this.pageState = HostPageState.PageOnHide;
  }

  webUrl(): string {
    // 开发阶段可以把网站静态资源文件放置到src/main/resources/rawfile/目录下
    // 生产环境下把网站静态资源放置到web服务器, 这里填写实际的网站地址url
    return 'resource://rawfile/index.html';
  }

  webUrlPrefix() {
    try {
      const url = Url.URL.parseURL(this.webUrl());
      return `${url.protocol}//${url.host}/`;
    } catch (err) {
      console.error(WEB_CONTAINER_PAGE_TAG, `Invalid webUrl: ${this.webUrl()}`);
      return '';
    }
  }

  getUrl(value: LoadCommittedDetails) {
    console.log('LoadCommittedDetails:', JSON.stringify(value))
  }

  build() {
    Column() {
      TaroWebContainer({
        indexHtmlPath: 'index.html',
        pageState: this.pageState, // 页面状态同步到组件
        webUrl: this.webUrl(), // 初始Url
        webUrlPrefix: this.webUrlPrefix(),
        useCache: false,
        want: this.want, // want信息
        taroWebController: this.taroWebController,
        isFullScreen: false, // 是否全屏显示
        injectObj: this.nativeObj, // 注入对象
        navigationInitVisible: true, // 导航栏是否显示
        showCapsule:true,
        capsulePage:'index.html',
        enableWebDebug:true,
        forceDarkAccess: true,
        userAgent: '',
        getLoadCommittedDetails: (value: LoadCommittedDetails) => {
          this.getUrl(value)
        }
      })
        .width('100%')
        .height('100%')
    }
  }
}
```

**构造参数说明：**

| 参数名称                | 类型              | 描述                                                               | 必填                        |
| ----------------------- | ----------------- | ------------------------------------------------------------------ | --------------------------- |
| taroWebController       | TaroWebController | TaroWebContainer 组件的控制器                                      | 是                          |
| webUrl                  | string            | 资源入口 url                                                       | 是                          |
| webUrlPrefix            | string            | 资源入口 url 的前缀，一般是 `${webUrl.protocol}://${webUrl.host}/` | 是                          |
| pageState               | HostPageState     | 传递页面状态                                                       | 是                          |
| useCache                | boolean           | 是否优先使用应用内置的 Web 资源                                    | 否，默认值： true           |
| want                    | Want              | 传递 EntryAbility 中`onCreate`和`onNewWant`保存的 want 信息        | 否，默认值： { }            |
| isFullScreen            | boolean           | 是否全屏显示应用                                                   | 否，默认值： true           |
| injectObj               | ESObject          | 注入 ets 对象到 Web 环境                                           | 否：默认值：undefined       |
| showCapsule             | boolean           | 是否显示胶囊按钮                                                   | 否：默认值：true            |
| capsulePage             | string            | 点击胶囊按钮跳转的页面                                             | 否：默认值：`pages/Capsule` |
| enableWebDebug          | boolean           | [开启 Web 调试功能][Web调试devtools配置]                           | 否：默认值：true            |
| navigationInitVisible   | boolean           | 控制导航栏初始显示状态                                             | 否：默认值：true            |
| userAgent               | string            | 自定义用户代理                                                     | 否                          |
| getLoadCommittedDetails | Function          | 网页跳转时触发该回调方法                                           | 否                          |
| forceDarkAccess         | boolean           | 网页强制开启深色模式                                               | 否:默认值：false            |

### 多容器和容器共用集成（TaroHybrid）

`TaroHybrid` 同`TaroWebContainer`组件功能相似，提供加载单页面 Web 应用能力，并提供部分 Taro API 鸿蒙版本，主要用于项目中有多个 webview 的场景。

**使用方法：**

1.在 src/main/ets/pages/SafeArea.ets 中定义一个顶部导航栏避让的组件

```ts
@Component
export struct SafeArea {
  @StorageProp('topRectHeight') topRectHeight: string = '0px'
  @BuilderParam child: ()=>void

  build() {
    Column() {
       Row()
         .width('100%')
         .height(this.topRectHeight)
         .backgroundColor(0xFFFFFF)
      Column(){
        this.child()
      }
      .width('100%')
      .layoutWeight(1)
    }
    .width('100%')
    .height('100%')
  }
}
```

2.在 src/main/ets/pages/TaroHybridPage.ets 中使用 TaroHybrid 组件拉起 taro 项目

```typescript
import { HostPageState, TaroHybrid, TaroHybridManager } from '@hybrid/web-container/Index';
import router from '@ohos.router';
import { SafeArea } from './SafeArea';

const TAG = 'TaroHybridPage'

// 创建TaroHybridPage页面（例子是基于Entry实现）
export interface TaroHybridRouterParams {
    indexHtmlPath: string,
    taroPath: string
}
export const RouterToTaroHybrid = (params: TaroHybridRouterParams) => {
   // 跳转之前先加载url，目的是为了提升新页面的打开速度
   const result = TaroHybridManager.loadUrl(params.indexHtmlPath, params.taroPath);
   if (result) {
    // 容器复用成功，等待loadUrl，不然会出现先看到上一个页面
    setTimeout(()=>{
      router.pushUrl({
        url: 'pages/TaroHybridPage',
        params: params
      }, router.RouterMode.Standard)
    }, 300)
  } else {
    router.pushUrl({
      url: 'pages/TaroHybridPage',
      params: params
    }, router.RouterMode.Standard)
  }
}

@Entry
@Component
struct TaroHybridPage {
  @State pageState: HostPageState = HostPageState.PageInit;
  private indexHtmlPath: string = (router.getParams() as TaroHybridRouterParams).indexHtmlPath
  private taroPath: string = (router.getParams() as TaroHybridRouterParams).taroPath

 aboutToAppear(): void {
     // 设置UserAgent
    TaroHybridManager.setCustomUserAgent('')
    // initLoadCommittedDetails(indexHtmlPath,callBack()) web页面跳转时触发callBack()
    TaroHybridManager.initLoadCommittedDetails(this.indexHtmlPath,(value: LoadCommittedDetails): void => {})
  }

  onPageShow(): void {
    this.pageState = HostPageState.PageOnShow
  }
  onPageHide(): void {
    this.pageState = HostPageState.PageOnHide
  }
  onBackPress(): boolean | void {
    const instance = TaroHybridManager.getCoreInstance(this.indexHtmlPath)
    if (!instance) {
      return false;
    }
    return TaroHybridManager.onBack(
      instance.builderData.indexHtmlPath,
      instance.builderData.taroPath)
  }

  build() {
    Stack({alignContent: Alignment.TopStart}){
      SafeArea(){
        TaroHybrid({
          indexHtmlPath: this.indexHtmlPath,
          taroPath: this.taroPath,
          pageState: this.pageState
        })
      }
    }
  }
}

```

3.在 src/main/ets/pages/Index.ets 中增加一个跳转按钮，可跳转到 TaroHybridPage 页面

```ts
import { RouterToTaroHybrid } from './TaroHybridPage';
import { SafeArea } from './SafeArea';

let storage = LocalStorage.getShared() // 获取共享的本地存储对象

@Entry(storage)
@Component
struct Index {
  build() {
    Stack({ alignContent: Alignment.TopStart }) {
      SafeArea() {
        Column({ space: 30 }) {
          Button('TaroHybrid例子', { type: ButtonType.Normal, stateEffect: true })
            .borderRadius(8)
            .backgroundColor(0x317aff)
            .height(40)
            .onClick(() => {
              RouterToTaroHybrid({
                indexHtmlPath: "/spa/main/index.html",
                taroPath: "/pages/index/index"
              })
            })
        }
        .width('100%')
        .height('100%')
        .alignItems(HorizontalAlign.Center)
      }
    }
  }
}

```

**TaroHybrid 的设计思路：**

1. 多容器的判断依据：html 的 Path 路径为判断依赖，相同则共用，不同则新建载体页
2. 容器共用的思路：通过鸿蒙的 NodeContainer + NodeController 实现
3. 注意：容器共用存在一个问题：相邻两个原生 Page 之间如果共用容器，页面切换动画时，会有一个页面白屏，进入和退出时都会出现，尽量避免相邻两个原生 Page 之间共用容器。

## 进阶教程

### 混合路由

#### **实现方式**

在原生与 TaroHybrid 混合鸿蒙应用中，如果使用了容器共用，用户的路由栈会比较复杂，当在 Taro Hybrid 页面时，用户使用原生的物理返回时，需要区分是 Web 容器的返回，还是原生的返回。

TaroHybrid 组件已经解决了此问题，其思路为：

1. 原生跳转打开的 taro 页面，添加 query 参数 tarofrom=native
2. 原生的 onBackPress 逻辑里，获取当前 url，判断有没有参数 tarofrom=native，如果有则走原生路由返回，如果没有则走 Web 组件的 backward 逻辑

```typescript
// @hybrid/web-container 内部已实现
static onBack(taroWebController: TaroWebController): boolean {
    let curUrl = taroWebController.webController.getUrl();

    if (curUrl?.endsWith('?tarofrom=native')) {  //web回退到原生
      // Web先返回
      if (taroWebController.accessBackward()) {
        setTimeout(()=>{
          taroWebController.backward();
        }, 200)
      }
      // 回退到原生
      return false;
    }
    if (taroWebController?.accessBackward()) { // web回退
      taroWebController?.backward();
      // 保留在当前Web页面
      return true;
    }
    // 回退到原生
    return false;
  }
```

#### **使用方式**

1. TaroWebContainer 组件设置混合路由返回方式

   ```tsx
   ...
   struct WebContainerPage {
    // 判断原生返回或taro返回
     onBackPress() {
       if (this.taroWebController.accessBackward()) {
         this.taroWebController.backward();
         return true;
       }
       return false;
     }
   	...

     build() {
       Column() {
         TaroWebContainer({...})
           .width('100%')
           .height('100%')
       }
     }
   }
   ```

2. TaroHybrid 组件设置混合路由返回方式

   ```tsx
   ...

   @Entry
   @Component
   struct TaroHybridPage {
   	......

   // 通过indexHtmlPath区分webview容器，设置返回方式
     onBackPress(): boolean | void {
       const instance = TaroHybridManager.getCoreInstance(this.indexHtmlPath)
       if (!instance) {
         return false;
       }
       return TaroHybridManager.onBack(
         instance.builderData.indexHtmlPath,
         instance.builderData.taroPath)
     }

     build() {
       Stack({alignContent: Alignment.TopStart}){
         SafeArea(){
           TaroHybrid({
            ...
           })
         }
       }
     }
   }
   ```

### 小程序内置及热更新

#### 内置及热更新的使用方式

##### 小程序内置规则

在业务较为复杂的场景时，项目通常分为多个`bundle`,内置到应用时遵循以下目录结构规则：

```
└──rawfile                          # 应用rawfile目录
    └──spa                          # 多bundle内置目录,支持配置
        ├──spa_main@100000          # 小程序1的bundle
        │   └──spa                  # 一级目录
        │        └──main            # 二级目录
        │             ├──js         # js目录
        │             ├──css        # css目录
        │             ├──static     # 静态资源目录
        │             └──index.html # 首页文件
        └──spa_new@100000           # 小程序2的bundle
            └──spa                  # 一级目录
                 └──new             # 二级目录
                     ├──js          # js目录
                     ├──css         # css目录
                     ├──static      # 静态资源目录
                     └──index.html  # 首页文件
```

以上目录结构的解释说明

1. rawfile 目录下的 spa，为多 bundle 的内置目录，容器会在此目录下读取 bundle 加载，支持以下方式配置（该目录要与配置一致）：

```typescript
// src/main/ets/entryability/EntryAbility.ets文件中写入
windowStage.loadContent('pages/Index', (err) => {
    // 全局初始化
    TaroHybridManager.init({
      	......
        rawFileName: 'spa',
        diskCacheEnable: true
    })
```

2. bundle 包名称：`一级目录`+`_`+`二级目录`+`@`+`VersionCode`,例如：spa*main@100000，以`@`符分割为两部分：  
   2.1 `@`符分前置: 为 bundle 的打包目录层级，一般为 index.html(首页文件)的 path 路径，用下划线`*`分割,作用是为内置文件路径拦截匹配查找；  
   2.2 VersionCode: 为当前 bundle 版本号，作用为版本控制及磁盘热更新

#### 热更新

##### 整体方案简介

动态下开发代码，在不发布新版本的情况下修复`bug`和发布新功能，绕开应用商店的审核机制，避免长时间审核以及多次被拒绝造成的成本问题，缩短用户取得新版本的流程，改善用户体验。

##### 使用说明

###### `arkts`端配置

热更新配置分为三步，首先需要配置`rawfile`内资源顶层文件夹名称，以壳工程资源为例`rawfile/spa/`，需要配置`spa`名称；其次，需要配置云端资源信息的`url`生成函数，这样当资源需要更新时可以从该地址获取相应信息；

```tsx
// 在src/main/ets/entryability/EntryAbility.ets中
import { TaroHybridManager,LocalMiniInfo,NetworkMiniInfo } from '@hybrid/web-container';

// 请求更新版本的信息和下载路径
function getNeedUpdateNetworkInfos(localVersions: LocalMiniInfo[]): Promise<NetworkMiniInfo[] | undefined> {
  return new Promise((resolve)=>{
    // 使用接口请求服务端的版本信息 NetworkMiniInfo
    let httpRequest = http.createHttp()
    httpRequest.request("http://www.xxx.com",(error:Error,data:http.HttpResponse)=>{
      if(data.result){
        let NetworkMiniInfos:NetworkMiniInfo[]=data.result as NetworkMiniInfo[]
        resolve(NetworkMiniInfos)
      }else{
        console.error(`getNeedUpdateNetworkInfos fail! errMsg ${error}`)
      }

    })
  })
}

export default class EntryAbility extends UIAbility {
    onCreate(want: Want) {
        // ... other code
         TaroHybridManager.startUpdateDiskCacheFromNetwork(this.context.getApplicationContext(),	(localVersions:LocalMiniInfo[])=>getNeedUpdateNetworkInfos(localVersions))
      }
    ......other code
}
```

###### 1、配置位置

热更新的启动位置，一般放在某个页面的`aboutToAppear`或者应用被打开时的`onCreate`中，热更新涉及有`http`请求，尽量减少热更新模块的执行。

###### 2、导入包

需要导入`TaroHybridManager`实例，以及配置热更新模块的参数类型`LocalMiniInfo, NetworkMiniInfo`

```tsx
import { TaroHybridManager, LocalMiniInfo, NetworkMiniInfo } from '@hybrid/web-container'
```

###### 3、热更新初始配置

在执行入口函数前，需要对热更新模块进行配置初始化。`TaroHybridManager.startUpdateDiskCacheFromNetwork`方法接受 2 个参数\*。其中第一个参数为应用的 context，可以直接调用 this.context.getApplicationContext()获取；第二个参数为一个方法，该方法接收 一个参数，为本地热更新资源的信息，返回通过网络请求获取服务端要更新的资源信息。

```tsx
TaroHybridManager.startUpdateDiskCacheFromNetwork(
  this.context.getApplicationContext(),
  (localVersions: LocalMiniInfo[]) => getNeedUpdateNetworkInfos(localVersions)
)
```

##### `js`端配置

**注意：因为该配置实现的方法需要在原生端被调用，所以需要这些方法要在热更新模块启动前进行配置，如果放在热更新启动后，可能无法生效**

热更新模块提供了一个对象，注入到了`js`端，这样用户可以依据业务来决定是否需要更新。

注入到`js`端的方法如下所示：

```tsx
applyUpdate(){}
onCheckForUpdate(listener: (hasUpdate: boolean)=>void){}
onUpdateReady(listener: (updatedPath: string)=>void){}
onUpdateFailed(listener: ()=>void){}
```

用户可以在`js`端通过预先注入的代理对象`native`调用这些方法，用以实现相应的业务，实现例子如下所示：

```ts
const updateManager = Taro.getUpdateManager()
updateManager.onCheckForUpdate(function listener(hasUpdate: boolean) {
  if (!hasUpdate) {
    return
  }
  updateManager.onUpdateReady(function listener(updatedPath: string) {
    updateManager.applyUpdate()
  })
})
updateManager.onUpdateFailed(function listener() {
  console.log('UpdateFailed')
})
```

该例子实现的功能是：调用原生端注入到`js`的的`getUpdateManager`方法，获取`LocalUpdateManagerInstance`实例，通过该实例调用了`onCheckForUpdate`方法，传递了一个参数`listener`，该参数为一个函数，里面包含了业务逻辑。

### 扩展原生 Api

当 Taro API 不满足业务需求时，可以扩展原生 API，实现小程序端调用原生功能。先由原生部分实现 JSBridge 方法，再由小程序部分注册该方法并调用。

#### 原生部分

##### 定义 InjectObject

示例代码如下：

```typescript
// src/main/ets/pages/TaroMethods.ets中定义对象和方法
import { InjectObject } from '@hybrid/web-container/Index'

interface LoginOptions {
  username: string
  password: string
  success: (t: string | null | undefined) => void
}

export const nativeObj: InjectObject = {
  customLogin: (options: LoginOptions) => {
    // 登录...
    options.success('xxx')
  },
}
```

##### 初始化注入 InjectObject

```typescript
// src/main/ets/entryability/EntryAbility.ets
import nativeObj from '../pages/TaroMethods'
TaroHybridManager.init({
  uiAbilityContex: this.context,
  domain: 'https://xxx.xxx.com', // 注意：此处不添加/结尾
  injectNativeMethod: (indexHtmlPath: string, uiAbilityContext: common.UIAbilityContext) => {
    return nativeObj
  },
})
```

##### 注意事项

1. 扩展的方法中只能定义一个参数，上面的例子中我们定义 LoginOptions 接口来封装全部参数。
2. 扩展的方法参数中只要最上层可以包含方法，嵌套的对象中不能包含方法，上面的例子中 LoginOptions 中包含了 success 和 error 方法，如果把 success 和 error 方法放到一个单独的 Callback interface 中就不可行了。

#### 小程序部分

##### 方法声明

通过@window.MethodChannel.jsBridgeMode 装饰器声明方法，具体代码如下：

```typescript
// @proxyClassSign('')
class NativeApi {
  // @ts-ignore
  @window.MethodChannel.jsBridgeMode({ isAsync: true, autoRelease: true })
  customLogin(option: any) {
    return option //这里固定返回option即可
  }
}

const native = new NativeApi()

export default native
```

参数说明：

isAsync：如果参数 option 中定义了回调方法则为 true，否则为 false

autoRelease：如果 option 中有回调方法且回调方法可能会调用多次则设置为 false，否则就为 true

##### 方法调用

```typescript
import { native } from './NativeApi'

native.customLogin({
  username: 'xxx',
  password: 'xxx',
  success: () => {
    console.log('Login success!')
  },
  error: (e) => {
    console.error('Login error.', e)
  },
})
```

### 鸿蒙一多适配指导

#### 鸿蒙折叠屏适配指导

默认情况下，设计尺寸是 750px，Taro 适配不同手机分辨率的方式是等比缩放，在鸿蒙折叠屏展开的状态下，等比放大的效果不满足华为应用商店上架要求。

**建议的适配方案：**

1. 最大放大比例不超过 1.2 倍
2. 宽度不基于 750px 来布局，基于 flex 自适应

最大放大比例不超过 1.1 倍的配置：

```javascript
// 修改config/index.js
export default defineConfig(async (merge, { command, mode }) => {
  const baseConfig = {
    // ....
    h5: {
      // ....
      postcss: {
        pxtransform: {
          enable: true,
          config: {
            baseFontSize: 20,
            maxRootSize: 24, // 最大不超过1.2倍
            minRootSize: 10, // 最小不超过0.5倍
          },
        },
        // ....
      },
    },
    // ....
  }
  // ....
})
```

### 沉浸式适配指导

[鸿蒙官方适配指南](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-develop-apply-immersive-effects-0000001820435461-V5#section231547103814)提供了两个种方案：窗口全屏布局方案 及 组件安全区方案

建议使用“窗口全屏布局方案”，默认全屏模式，再处理状态栏及导航条的避让。

**全屏模式下的状态栏的避让：** 通过原生创建一个 SafeArea 组件实现，而不通过 JS 实现

1.在在 src/main/ets/entryability/EntryAbility.ets 的 onWindowStageCreate 中设置全局保存状态栏的安全高度

```javascript
onWindowStageCreate(windowStage: window.WindowStage) {
 	//  设置全局保存状态栏的安全高度
     const systemAvoidArea = windowStage.getMainWindowSync().getWindowAvoidArea(window.AvoidAreaType.TYPE_SYSTEM);
	const topRectHeight = systemAvoidArea.topRect.height
	AppStorage.setOrCreate('topRectHeight', `${topRectHeight}px`);

    windowStage.loadContent('pages/Index', storage, (err, data) => {
    	...
    }
}
```

2.自定义 SafeArea 组件

```typescript
// 自定义SafeArea组件
@Component
export struct SafeArea {
  @StorageProp('topRectHeight') topRectHeight: string = '0px'

  @BuilderParam child: ()=>void

  build() {
    Column() {
       Row()
         .width('100%')
         .height(this.topRectHeight)
         .backgroundColor(0xFFFFFF)
      Column(){
        this.child()
      }
      .width('100%')
      .layoutWeight(1)
    }
    .width('100%')
    .height('100%')
  }
}

```

3.在 TaroHybridPage 页面中引用 SafeArea 组件

```tsx
// Taro Hybrid的布局
import {  HostPageState, TaroHybrid } from '@hybrid/web-container';
import { SafeArea } from './SafeArea'

@Entry
@Component
struct TaroHybridPage {
  @State pageState: HostPageState = HostPageState.PageInit;
  onPageShow(): void {
    this.pageState = HostPageState.PageOnShow
  }
  onPageHide(): void {
    this.pageState = HostPageState.PageOnHide
  }
  build() {
    Stack(){
      SafeArea(){
        TaroHybrid({
          indexHtmlPath: 'index.html',
          taroPath: 'pages/index/index',
          pageState: this.pageState
        })
      }
    }
  }
}
```

### Taro.request 请求方式选择（原生/js）

#### 一、Taro.request 原生实现（native 桥接）代码位置：taro/packages/taro-platform-harmony-hybrid/src/api/apis/network/request/index.ts

```typescript
let task!: Taro.RequestTask<any>
const result: ReturnType<typeof Taro.request> = new Promise((resolve, reject) => {
  const upperMethod = method ? method.toUpperCase() : method
  const taskID = native.request({
    url,
    method: upperMethod,
    ...otherOptions,
    success: (res: any) => {
      isFunction(success) && success(res)
      isFunction(complete) && complete(res)
      resolve(res)
    },
    fail: (res: any) => {
      isFunction(fail) && fail(res)
      isFunction(complete) && complete(res)
      reject(res)
    },
  })
  task = judgeUseAxios ? taskID : NativeRequest.getRequestTask(taskID)
}) as any
```

#### 二、Taro.request js 实现（axios）代码位置：taro/packages/taro-platform-harmony-hybrid/src/api/apis/request.ts

```typescript
this.httpRequest = axios.create({
  responseType: responseType || 'text',
  headers: headers,
  timeout: timeout || 2000,
})

// 请求拦截器
this.httpRequest.interceptors.request.use(
  (config) => {
    if (config.enableCache === false) {
      return config
    }
    // 处理缓存
    const cacheData = localStorage.getItem(config.url)
    if (cacheData !== null) {
      let result = cacheData
      if (dataType === 'json') {
        result = JSON.parse(cacheData)
      }
      source.cancel('cache has useful data!!')
      return Promise.resolve({ result })
    }
    return config
  },
  (error) => {
    console.error('error: ', error)
  }
)

// 响应拦截器
this.httpRequest.interceptors.response.use(
  (response) => {
    // 缓存数据
    if (response.config.enableCache === false) {
      localStorage.setItem(response.config.url, JSON.stringify(response.data))
    }
    callbackManager.headersReceived.trigger({
      header: response.headers,
    })
    return response
  },
  (error) => {
    console.error('error: ', error)
  }
)

if (!object) {
  console.error('request error: params illegal')
  return
}

let isFormUrlEncoded = false
for (const key in headers) {
  if (key.toLowerCase() === 'content-type') {
    if (headers[key].toLowerCase().includes('application/x-www-form-urlencoded')) {
      isFormUrlEncoded = true
    }
    break
  }
}

// data为Object类型时，属性的值类型如果是number, request请求时信息会丢失. 故将data转成string类型进行规避
if (data && (isFormUrlEncoded || ['GET', 'OPTIONS', 'DELETE', 'TRACE', 'CONNECT'].includes(method))) {
  const dataArray = []
  for (const key in data) {
    // @ts-ignore
    dataArray.push(encodeURIComponent(key) + '=' + encodeURIComponent(data[key]))
  }
  data = dataArray.join('&')
}

// header的属性的值类型如果是number, request请求时信息会丢失. 故将各个属性转成string类型
if (headers) {
  for (const key in headers) {
    headers[key] = `${headers[key]}`
  }
}

this.httpRequest({
  method: method,
  url: url,
  CancelToken: source.token,
  enableCache: enableCache || false,
})
  .then((response) => {
    if (success && !this.abortFlag) {
      let result = response.result
      if (response.config.responseType === 'text') {
        if (dataType === 'text') {
          result = response.data
        } else if (dataType === 'json') {
          result = JSON.parse(response.data)
        } else if (dataType === 'base64') {
          const encodeData = encodeURIComponent(response.data)
          result = btoa(encodeData)
        } else if (dataType === 'arraybuffer') {
          result = new TextEncoder().encode(response.data).buffer
        } else {
          console.error('Unsupported dataType!!')
        }
      } else if (response.config.responseType === 'arraybuffer') {
        result = response.data
      } else {
        console.error('Unsupported dataType!!: ', response.config.responseType)
      }
      const res = {
        data: result,
        statusCode: response.status,
        header: response.headers,
        cookies: response.cookies ? [response.cookies] : [],
        errMsg: 'request:ok',
      }
      this.result = res
      success(res)
    }
  })
  .catch((err) => {
    console.error('request error: ' + JSON.stringify(err))
    if (fail && !this.abortFlag) {
      // eslint-disable-next-line no-console
      const res = { errMsg: errMsgMap.has(err.code) ? errMsgMap.get(err.code) : `${JSON.stringify(err)}` }
      this.result = res
      fail(res)
    }
  })
  .finally(() => {
    if (complete && !this.abortFlag) {
      complete(this.result)
    }
    if (this.httpRequest) {
      source.cancel('requestTask cancelled by the user!')
    }
  })
```

#### 三、原生、js 方式转换实现

```typescript
// 调用时通过第二个参数控制是原生还是js实现，默认为原生实现方式
export function request (options: any, useNativeRequest: boolean = true) {
  return useNativeRequest ? nativeReuqest(options) : h5Request(options)
}

// 具体使用方式
 const task = Taro.request({
      ...data,
      success: (res) => {
       ...
      },
      fail: (res) => {
        ...
      },
      complete: (res) => {
        ...
      },
    },true/false)  //第二个参数可忽略

```

####

### 同层渲染

`@hybrid/web-container` 提供 `sameLayerManager.registerNativeComponentBuilders` 方法来注册同层渲染组件。

**参数说明：**

| 参数名称      | 类型                          | 描述                                           | 必填 |
| ------------- | ----------------------------- | ---------------------------------------------- | ---- |
| componentName | string                        | 对应 embed 标签 type 属性，去掉 `native/` 前缀 | 是   |
| builder       | (...args: ESObject[]) => void | 使用 `@Builder` 注解的原生组件 builder 函数    | 是   |

**使用方法：**

- 壳工程中，注册自定义组件：

```typescript
import { sameLayerManager } from '@hybrid/web-container'
import { NativeVideoBuilder } from '../pages/HosVideo' //具体路径根据项目实现路径引入

export default class EntryAbility extends UIAbility {
  onCreate(want: Want, launchParam: AbilityConstant.LaunchParam) {
    sameLayerManager.registerNativeComponentBuilders('hos-video', NativeVideoBuilder)
  }
  // ...
}
```

- Video 自定义组件实现参考

```typescript
import { sameLayerManager } from '@hybrid/web-container';

@Observed
export class VideoParams {
  width: number // 组件宽度
  height: number // 组件高度
  componentId: string // 组件ID
  src: string // 要播放视频的资源地址
  controls?: boolean // 是否显示播放控件
  muted?: boolean // 是否静音
  loop?: boolean
  autoPlay?: boolean
  onPlay?: (res?: string) => void
  onPause?: (res?: string) => void

  constructor() {
    this.width = 0;
    this.height = 0;
    this.componentId = '';
    this.src = '';
  }
}

@Component
export struct NativeVideo {
  @ObjectLink params: VideoParams
  videoController: VideoController = new VideoController();

  build() {
    Column() {
      Video({
        src: this.params.src,
        controller: this.videoController
      })
        .objectFit(ImageFit.Fill)
        .autoPlay(this.params.autoPlay ?? true)
        .muted(this.params.muted ?? false)
        .loop(this.params.loop ?? false)
        .controls(this.params.controls ?? true)
        .onClick((event) => {
          console.log('NativeEmbed video onClick.')
        })
        .onStart(() => {
          console.log('NativeEmbed video onPlay.', this.params.height)
          const callJsOnPlay: Function | undefined = (sameLayerManager.getSameLayerArgs(this.params.componentId) as VideoParams)?.onPlay
          callJsOnPlay && callJsOnPlay('Native Video playing.')
        })
        .onPause(() => {
          console.log('NativeEmbed video onPause.')
          const callJsOnPause: Function | undefined = (sameLayerManager.getSameLayerArgs(this.params.componentId) as VideoParams)?.onPause
          callJsOnPause && callJsOnPause('Native Video paused.')
        })
    }
    .width(this.params.width)
    .height(this.params.height)
  }
}

@Builder
export function NativeVideoBuilder(params: VideoParams) {
  NativeVideo({ params: params })
    .backgroundColor(Color.Green)
}

```

- 前端代码中，使用 `react` 框架实现的代码如下：

  1. sameLayerRender 实现如下

     ```ts
     // @ts-ignore
     const asyncAndNotRelease =
       (window.MethodChannel && window.MethodChannel.jsBridgeMode({ isAsync: true, autoRelease: false })) ||
       ((target) => target)

     class SameLayerRender {
       @asyncAndNotRelease
       transferSameLayerArgs(_options: object): void {}
     }
     const sameLayerRender = new SameLayerRender()
     export default sameLayerRender
     ```

  2. HosVideo.ts 组件实现如下

     ```tsx
     import React from 'react'
     import classNames from 'classnames'
     import sameLayerRender from './SameLayerRender'

     interface IProps extends React.HTMLAttributes<HTMLDivElement> {
       src: string
       controls?: boolean
       autoplay?: boolean
       loop?: boolean
       muted?: boolean
       onPlay?: (res: any) => void
       onPause?: (res: any) => void
     }

     export default class HosVideo extends React.Component<IProps> {
       // eslint-disable-next-line react/sort-comp
       private componentId: string

       constructor(props: IProps | Readonly<IProps>) {
         super(props)
         this.componentId = `video_${Math.floor(Math.random() * 100000)}_${Date.now()}`
       }

       componentDidMount() {
         this.transferVideoProps()
       }

       componentDidUpdate(_prevProps: IProps, _prevState: any) {
         // 组件更新时重新传输数据
         this.transferVideoProps()
       }

       transferVideoProps() {
         // 同层渲染video组件数据
         const { src, controls, autoplay, loop, muted, onPlay, onPause } = this.props

         const properties = {
           componentId: this.componentId,
           src: src,
           controls: controls,
           autoPlay: autoplay,
           loop: loop,
           muted: muted,
           onPlay: onPlay,
           onPause: onPause,
           width: '300px',
           height: '300px',
         }
         sameLayerRender.transferSameLayerArgs(properties)
       }

       render() {
         const { style, className } = this.props

         return (
           <div style={style} className={className ? className : classNames('taro-video-container')}>
             <embed
               className="taro-video-video"
               id={this.componentId}
               type="native/hos-video"
               style={{ width: '100%', height: '100%', objectPosition: 'inherit', display: 'block' }}
             />
           </div>
         )
       }
     }
     ```

  3. 具体使用方式

     ```tsx
     import { View, Button } from '@tarojs/components'
     import './index.scss'
     import HosVideo from '../nativeCompinents/hosvideodemo'

     export default function Index() {
       return (
         <View className="index">
           <HosVideo style={{ height: '300px', marginTop: '100px' }} src="https://xxx/xxx.mp4"></HosVideo>
         </View>
       )
     }
     ```

## FAQ

### 原生导航条影响 Fixed 布局

**原因：** Web 容器与原生导航栏之间是层叠布局，为了不影响 H5 页面的内容展示，Taro Harmony 给每个 Page 设置了一个 padding-top 值，其值来自原生注入的一个变量

```typescript
// Web组件加载时，原生会给js侧注入的代码：
var navigationHeight = ${this.navigationBarHeight};
```

当存在原生导航栏时，fixed 布局需要添加一个 top 值，其值为 window.navigationHeight，由原生测注入，taro 自动设置

[Web调试devtools配置]: https://gitee.com/openharmony/docs/blob/master/zh-cn/application-dev/web/web-debugging-with-devtools.md

### 页面跳转后发现顶部多了一个 css 样式

**F:** 在打开 Taro 项目后，从 pageA 页面跳转到其他页面 ，发现跳转后页面增加了一个 css 样式，影响了页面的顶部布局样式。css 设置示例如下：

```css
.taro_router .taro_page.taro_navigation_page{
    padding-top:100px;
}
```

**Q:** 这个问题是由 taro 的 router 机制造成；在 pageA 的 index.scss 中为`.taro_router .taro_page.taro_navigation_page`选择器设置某些样式后，当 pageA 页面被触发加载一次后，该样式生效并作用于全局，成为一个全局样式，影响所有页面；

如果希望页面不受`.taro_router .taro_page.taro_navigation_page`选择器样式影响，可以在页面的配置文件 index.config.js 文件中将 navigationStyle 属性值设置为 custom，这样配置后，该页面不在受到 navigation 公共样式的影响，示例如下：

```javascript
export default {
  navigationStyle: 'custom',
}
```

不推荐使用`.taro_router .taro_page.taro_navigation_page`选择器设置样式
</file>

<file path="docs/harmony/index.md">
---
title: 初始化流程和结构介绍
---

:::info
Taro v4.1.0+ 开始支持
:::

随着鸿蒙系统的日渐完善，众多应用厂商都期待着把自家应用移植到鸿蒙平台上。借助 Taro，可以实现快速开发鸿蒙应用、把小程序快速转换为鸿蒙应用等功能。

## 背景阅读

鸿蒙 & OpenHarmony 相关背景知识简介。

### 鸿蒙与 OpenHarmony

> 摘录自 [《关于规范 HarmonyOS 沟通口径的通知》](https://www.google.com/search?q=%E5%85%B3%E4%BA%8E%E8%A7%84%E8%8C%83HarmonyOS%E6%B2%9F%E9%80%9A%E5%8F%A3%E5%BE%84%E7%9A%84%E9%80%9A%E7%9F%A5&oq=%E5%85%B3%E4%BA%8E%E8%A7%84%E8%8C%83HarmonyOS%E6%B2%9F%E9%80%9A%E5%8F%A3%E5%BE%84%E7%9A%84%E9%80%9A%E7%9F%A5&aqs=chrome..69i57.670j0j4&sourceid=chrome&ie=UTF-8)
>
> 为方便描述，本文档把这三者统一称作“鸿蒙”

1、**鸿蒙操作系统**是华为研发的智能终端操作系统。

2、华为已把该智能终端操作系统的基础能力全部捐献给开放原子开源基金会，由开放原子开源基金会整合其他参与者的贡献，形成 [OpenHarmony](https://gitee.com/openharmony) 开源项目，最新的版本为 OpenHarmony 4.0+。

3、[HarmonyOS](https://developer.harmonyos.com/) 是华为基于开源项目 OpenHarmony 开发的商用版本。

### 鸿蒙应用开发导读

建议开发前首先阅读 [《鸿蒙应用开发导读》](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/start-with-ets-stage) 部分，有助于对鸿蒙整体结构有一定了解。

鸿蒙应用程序包结构（Stage 模型）：

![](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20230821150835.75065627467290629243023494212142:50001231000000:2800:5EB57405CFA7AEA5D52F21AFDFF9B174880C6BB02D98FC4CB34C490B82D97AC1.png?needInitFileName=true?needInitFileName=true)

### 鸿蒙与小程序

鸿蒙 Stage 模型支持使用 ArkTS 来声明式地开发 UI（ArkUI）。ArkTS 是 HarmonyOS 优选的主力应用开发语言。ArkTS 围绕应用开发 [TypeScript](https://www.typescriptlang.org/)（简称 TS）生态基础上做了进一步扩展，继承了 TS 的所有特性，是 TS 的超集。

#### 鸿蒙 ArkUI 与小程序写法的主要异同

1. 开发语言

鸿蒙的开发语言 ArkTS 在语法方面由于是 TypeScript 的超集，因此能完美兼容小程序上的 JavaScript/TypeScript 语法。

2. 渲染 UI

小程序可以通过 `template` 模板来动态地拼接和生成页面的 UI，而鸿蒙可以通过系统提供的自定义组件来递归地渲染出页面 UI。

## 配置鸿蒙环境

首先要准备鸿蒙运行所需的环境，根据参考文档提示的步骤在 HUAWEI DevEco Studio 的 IDE 中完成 MyApplication 项目的创建，熟悉鸿蒙开发者工具的预览查看等功能。

### 1. 安装、配置 DevEco Studio

（1）登录  [HarmonysOS 应用开发门户](https://developer.harmonyos.com/cn/home)，点击右上角注册按钮，注册开发者帐号。

（2）进入  [HUAWEI DevEco Studio 下载中心](https://developer.huawei.com/consumer/cn/deveco-studio/)，点击立即下载按钮，下载最新版本的 DevEco Studio IDE。

### 2. 创建 Harmony 主项目

（1）创建新项目，选择需要开发的设备，根据应用配置所需的信息，点击 Finish 按钮，一个新的项目就被创建出来了。

（2）关注目录 `entry/src/main/ets/pages/Index.ets` 下面的文件，熟悉文件结构。`pages` 目录下为页面入口，新建项目的页面目录会包含若干个 `.ets` 文件，应用级配置信息位于 `build-profile.json5`，当前的模块信息 、编译信息配置项位于 `entry/build-profile.json5`。[项目结构详情](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-package-structure-stage)。

### 3. 预览 & 调试

（1）DevEco Studio 支持下述方式查看运行效果，链接到鸿蒙官网查看具体步骤

a. [使用预览器 previewer](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-previewer-arkts-js) 该功能与真机效果可能存在差异，主要用于 UI 样式的预览，主要用于预览 ArkTS 侧经过 @Component 修饰的 UI 组件，在 Taro For Harmony 的开发中无法使用，可以暂时忽略。

b. [使用模拟器](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-run-emulator) 使用 DevEco Studio 提供的模拟器功能，即可正常调试 Taro 打包出来的鸿蒙应用程序，除了无法使用 IDE 提供的 Profiler 来测量性能外，其余功能和真机并无太大差异，推荐没有真机的开发者优先考虑这种调试方式。

c. [使用本地真机](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-run-device) 用户真机与电脑相连，打开开发者模式，即可在真机看到效果，这里需要注意的是，真机需要使用纯鸿蒙系统的手机，能够体验到完整的鸿蒙系统功能。

(2) DevEco Studio 真机进行调试

链接上真机后，选择好对应的入口模块，在项目代码中打上断点等信息，在编译器中启动调试即可。

![示例图](https://img20.360buyimg.com/img/jfs/t1/102571/34/33232/150214/6582b637F9d4860f7/4cf399a59a316520.png)

### 相关阅读

- [《DevEco Studio 使用指南》](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-tools-overview)
- [《构建第一个 ArkTS 应用（stage 模型）》](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/start-with-ets-stage)
</file>

<file path="docs/harmony/meta.md">
---
title: 元服务
---

### 元服务

#### 转换为 ASCF 元服务

##### ASCF 介绍
ASCF（Application Service Component Framework）是面向鸿蒙生态的元服务开发框架，提供轻量化服务能力：
- **包体更小**：最大包体限制10MB（小程序为20MB）
- **启动更快**：毫秒级服务卡片加载
- **深度集成**：支持系统级服务卡片、语音唤醒等鸿蒙特性

##### 开发前准备
1. **注册账号**：
   - 访问 [ASCF开发者平台](https://developer.ascf.harmonyos.com) 注册账号
   - 完成企业实名认证（个人开发者仅支持测试环境）

2. **环境配置**：
   ```bash
   # 安装ASCF编译插件
   npm install @tarojs/plugin-platform-ascf --save-dev

##### 开发第一个 ASCF 元服务

1. **创建Taro项目**：
    ```bash
    taro init my-ascf-app

2. **添加元服务页面**：

```diff
export default function Index() {
  return (
    <View className="container">
      <Text>Hello ASCF 元服务!</Text>
      <Button onClick={() => ascf.navigateTo({ url: '/pages/detail' })}>
        查看详情
      </Button>
    </View>
  )
}
```

3. **启动开发模式**：
    ```bash
    taro build --type ascf --watch

##### 修改编译配置

在项目根目录创建 project.ascf.json：
```diff
{
  "appid": "YOUR_ASCF_APPID",
  "projectname": "我的元服务",
  "minPlatformVersion": "3.0.0",
  "serviceCards": [{
    "name": "mainCard",
    "src": "/pages/index"
  }]
}
```

##### 编译运行

1. **完整编译**：
    ```bash
    taro build --type ascf

 
 2. **输出目录**：   
    ```bash
    dist/ascf

##### 预览&调试
1.使用 ASCF DevTools 导入 dist/ascf 目录

2.扫码预览服务卡片效果：

3.真机调试命令：
    ```bash
    ascf debug --device YOUR_DEVICE_ID

#### 注意事项

##### 与小程序的差异

| 特性         | 小程序               |   ASCF元服务    | 说明                |
| -------------- | -----------------| --------------|------------------|
| 包体大小      | <= 20MB           |      <= 10MB    |需精简资源 |
| 启动方式      | 扫码/搜索          |    服务卡片/语音  |需配置serviceCards  |
| 路由层级      | 无限制             |    最多5级       |避免深层嵌套      |
| 全局样式      | 支持               |    部分支持       |需添加-ascf-前缀 |



##### 常见问题

1. **样式兼容问题**：
        ```bash
    .container {
        -ascf-flex-direction: column;
    }

2. **API调用差异**：
    ```diff

    // 小程序方式 (不支持)
    wx.request({...})

    // ASCF方式
    ascf.request({...})

    ```
###### 不支持云开发

当前版本无法使用微信云开发/支付宝云能力，需自建后端服务

###### 不支持插件

无法直接使用小程序插件，需重写为ASCF组件：
    ```diff
    export default function CustomPicker({ options }) {
      return (
        <ascf-picker options={options} />
     )
 }
    ```

###### 不支持独立分包
所有代码必须打包到主包中，需优化首包体积：
    ```bash
    # 分析包体积
    npx taro asc analyze --type ascf


### HarmonyOS 应用

鸿蒙与小程序

鸿蒙 Stage 模型支持使用 ArkTS 来声明式地开发 UI（ArkUI）。ArkTS 是 HarmonyOS 优选的主力应用开发语言。ArkTS 围绕应用开发 TypeScript（简称 TS）生态基础上做了进一步扩展，继承了 TS 的所有特性，是 TS 的超集。

鸿蒙 ArkUI 与小程序写法的主要异同

1.开发语言
鸿蒙的开发语言 ArkTS 在语法方面由于是 TypeScript 的超集，因此能完美兼容小程序上的 JavaScript/TypeScript 语法。

2.渲染 UI
小程序可以通过 template 模板来动态地拼接和生成页面的 UI，而鸿蒙可以通过系统提供的自定义组件来递归地渲染出页面 UI。

配置鸿蒙环境

首先要准备鸿蒙运行所需的环境，根据参考文档提示的步骤在 HUAWEI DevEco Studio 的 IDE 中完成 MyApplication 项目的创建，熟悉鸿蒙开发者工具的预览查看等功能。

1. 安装、配置 DevEco Studio

（1）登录  HarmonysOS 应用开发门户，点击右上角注册按钮，注册开发者帐号。

（2）进入  HUAWEI DevEco Studio 下载中心，点击立即下载按钮，下载最新版本的 DevEco Studio IDE。

2. 创建 Harmony 主项目

（1）创建新项目，选择需要开发的设备，根据应用配置所需的信息，点击 Finish 按钮，一个新的项目就被创建出来了。

（2）关注目录 entry/src/main/ets/pages/Index.ets 下面的文件，熟悉文件结构。pages 目录下为页面入口，新建项目的页面目录会包含若干个 .ets 文件，应用级配置信息位于 build-profile.json5，当前的模块信息 、编译信息配置项位于 entry/build-profile.json5。项目结构详情。

3. 预览 & 调试

（1）DevEco Studio 支持下述方式查看运行效果，链接到鸿蒙官网查看具体步骤

a. 使用预览器 previewer 该功能与真机效果可能存在差异，主要用于 UI 样式的预览，主要用于预览 ArkTS 侧经过 @Component 修饰的 UI 组件，在 Taro For Harmony 的开发中无法使用，可以暂时忽略。

b. 使用模拟器 使用 DevEco Studio 提供的模拟器功能，即可正常调试 Taro 打包出来的鸿蒙应用程序，除了无法使用 IDE 提供的 Profiler 来测量性能外，其余功能和真机并无太大差异，推荐没有真机的开发者优先考虑这种调试方式。

c. 使用本地真机 用户真机与电脑相连，打开开发者模式，即可在真机看到效果，这里需要注意的是，真机需要使用纯鸿蒙系统的手机，能够体验到完整的鸿蒙系统功能。

(2) DevEco Studio 真机进行调试

链接上真机后，选择好对应的入口模块，在项目代码中打上断点等信息，在编译器中启动调试即可。
</file>

<file path="docs/harmony/troubleshooting.md">
---
title: 常见问题
---

### **ERROR: Failed to get ModuleInfo properties 'meta.pkgPath'**

本地可能存在部分混淆导致 IDE 无法正确解析依赖，需要检查 `build-profile.json5`、`obfuscation-rules.txt` 等文件中是否开启混淆配置，需要关闭后清理 IDE 缓存重新编译。

```diff
- -enable-property-obfuscation
- -enable-toplevel-obfuscation
- -enable-filename-obfuscation
- -enable-export-obfuscation
```

### **ERROR: Cannot resolved import statement**

本地执行 library 编译时，启用 `useNormalizedOHMUrl` 配置会导致外部依赖无法解析，建议在 library 模块中使用 `useNormalizedOHMUrl: false` 或者移除该配置。

### **ERROR: Duplicated files found in module default**

不使用核心库切换到使用核心库时可能会出现该问题，需要清理 build-profile.json5 文件中关于 so 包的配置项。

```diff
{
  "apiType": "stageMode",
  "buildOption": {
-    "externalNativeOptions": {
-      "path": "./src/main/cpp/CMakeLists.txt",
-      "arguments": "-DCMAKE_JOB_POOL_COMPILE:STRING=compile -DCMAKE_JOB_POOL_LINK:STRING=link -DCMAKE_JOB_POOLS:STRING=compile=8;link=8",
-      "cppFlags": "",
-      "abiFilters": [
-        "arm64-v8a"
-      ]
-    }
  },
  ...
}
```
</file>

<file path="docs/platform-plugin/how.md">
---
title: 编写端平台插件
---

扩展一个编译平台，需要编写一个 [Taro 插件](../plugin)，对编译时和运行时分别进行兼容。

## 端平台插件架构

### 插件目录组织

以 `@tarojs/plugin-platform-weapp` 为例：

    ├── src                      源码目录
    |   ├── index.ts             插件入口
    |   ├── program.ts           编译时入口
    |   ├── template.ts          模板处理逻辑
    |   ├── runtime.ts           运行时入口
    |   ├── runtime-utils.ts     运行时依赖工具
    |   ├── apis.ts              API 相关处理
    |   ├── apis-list.ts         API 列表
    |   ├── components.ts        组件列表
    |   └── components-react.ts  给 React 使用的组件类型
    ├── types                    类型
    ├── index.js                 编译时入口
    ├── tsconfig.json
    ├── rollup.config.json
    ├── package.json
    └── README.md

### 架构图

![](https://storage.jd.com/cjj-pub-images/platform-plugin-construct.png)

## 编译时

处理编译相关操作，如 Webpack 配置、模板生成规则等。

### 一、编写 Taro 插件

前置阅读：[【如何编写一个 Taro 插件】](../plugin-custom)。

首先我们需要编写一个 Taro 插件来注册我们的编译平台，如：

```js title="index.ts"
export default (ctx) => {
  ctx.registerPlatform({
    name: 'weapp',
    useConfigName: 'mini',
    async fn(arg) {
      // ...
    },
  })
}
```

#### ctx.registerPlatform(options: object)

注册一个编译平台

##### options.name

`string`

平台名称，用于 CLI 编译命令。

如配置了 'xxx'，则编译此平台时使用的 CLI 命令为：

```shell
taro build --type xxx
taro build --type xxx --watch
```

##### options.useConfigName

`string`

把 Taro 编译配置中的指定字段纳入编译。

Taro 小程序相关配置默认放在 `mini` 字段下，因此一般情况配置 `usingConfigName: mini` 即可。

##### options.fn(arg)

`function`

端平台编译的入口函数，接受一个参数 `arg`，在此函数内我们可以开始编写端平台编译的逻辑。

###### arg

`object`

整合上述 [options.useConfigName](./how#optionsuseconfigname) 指定字段后的 Taro 编译配置，编译配置各字段详情请看[编译配置详情](../config-detail)。

### 二、编写平台类

接下来给上一节中提到的插件入口函数添加内容。

我们把编译时常用的逻辑抽象出了一个基类 [TaroPlatformBase](./platform-mini)，开发者可以[继承](./platform-mini#自定义平台类)于此基类，从而实现端平台的编译。

然后在插件入口函数中调用上述自定义平台类的编译接口：

```js title="index.ts"
import Weapp from './program'

export default (ctx) => {
  ctx.registerPlatform({
    name: 'weapp',
    useConfigName: 'mini',
    async fn(arg) {
      // 调用自定义平台类的 start 函数，开始端平台编译
      const program = new Weapp(ctx, config)
      await program.start()
    },
  })
}
```

## 运行时

处理运行时相关操作，如 API、组件、Taro runtime 逻辑等。

### 一、处理运行时入口

#### 1. 编写 runtime.ts

`runtime.ts` 是我们运行时的入口文件，`Webpack` 编译时会把它注入到 `app.js` 中进行引用。

例子：

```js title="runtime.ts"
import { mergeReconciler, mergeInternalComponents } from '@tarojs/shared'
import { hostConfig, components } from './runtime-utils'

mergeReconciler(hostConfig)
mergeInternalComponents(components)
```

```js title="runtime-utils.ts"
export * from './components'
export const hostConfig = {}
```

`runtime.ts` 主要负责：

- 使用 `mergeReconciler` 函数把自定义的 `hostConfig` 合并到全局 [Reconciler](./reconciler) 中。
- 使用 `mergeInternalComponents` 函数把自定义组件信息 [components.ts](./platform-mini#31-编写-componentsts) 合并到全局 `internalComponents` 组件信息对象中。

> 抽取 runtime-utils.ts 是为了方便其它插件引用

#### 2. 连接插件入口

为了让 `Webpack` 知道去哪里引用上述运行时入口文件，需要配置 `runtimePath`：

```js title="program.ts"
class Weapp extends TaroPlatformBase {
  runtimePath = '@tarojs/plugin-platform-weapp/dist/runtime'
}
```

### 二、处理 API

在 Taro 中，用户需要从 `@tarojs/taro` 中引用 Taro 的内置 API 和 **Promise 化** 后的小程序 API。

```js
import Taro from '@tarojs/taro'

// 内置 API
Taro.getCurrentInstance()
// 小程序 API
Taro.request()
```

#### 1. 配置 initNativeApi

原始的 `@tarojs/taro` 包只提供了内置 API。我们需要通过配置 `Reconciler` 的 [initNativeApi](./reconciler#initnativeapi-taro) 选项，为全局 Taro 对象增加小程序的 API 和我们想要挂载在 Taro 对象上的 API。

```js title="apis-list.ts"
// 需要新增额外的原生 API 时，分拆一个单独的 `apis-list.ts` 文件能有利于维护。

// 同步 API
export const noPromiseApis = new Set(['getAccountInfoSync'])

// 异步 API，这些 API 都可以设置 `success`、`fail`、`complete` 回调，需要对它们进行 Promise 化。
export const needPromiseApis = new Set(['addCard'])
```

```js title="apis.ts"
import { processApis } from '@tarojs/shared'
import { noPromiseApis, needPromiseApis } from './apis-list'

declare const wx: any

export function initNativeApi (taro) {
  // 下文将详细介绍 processApis 函数
  processApis(taro, wx, {
    noPromiseApis,
    needPromiseApis
  })
  // 可以为 taro 挂载任意的 API
  taro.cloud = wx.cloud
}
```

```js title="runtime-utils.ts"
import { initNativeApi } from './apis'
export const hostConfig = { initNativeApi }
```

#### 2. processApis(taro, global, options)

##### 入参

| 参数    | 类型   | 说明                        |
| :------ | :----- | :-------------------------- |
| taro    | object | Taro 对象                   |
| global  | object | 小程序全局对象，如微信的 wx |
| options | object | 配置项                      |

###### options

| 属性            | 类型          | 说明           |
| :-------------- | :------------ | :------------- |
| noPromiseApis   | Set`<string>` | 新增的同步 API |
| needPromiseApis | Set`<string>` | 新增的异步 API |

上述 `processApis` 函数帮助我们做了三件事情：

1. 挂载所有平台公共的小程序 API 到 Taro 对象上
2. 挂载常用的小程序全局对象属性 到 Taro 对象上
3. 挂载用户传入的小程序 API 到 Taro 对象上

## 打包

插件使用 `Rollup` 进行打包，需要打包出以下文件：

| 入口文件                | 模式 | 必要 | 说明                                |
| :---------------------- | :--- | :--- | :---------------------------------- |
| src/index.ts            | cjs  | 是   | 插件入口，供 Taro CLI 解析          |
| src/runtime.ts          | es   | 是   | 运行时入口                          |
| src/runtime-utils.ts    | es   | 否   | 运行时工具集合，供继承的子类引用    |
| src/components-react.ts | es   | 否   | 有新增组件时需要实现，供 React 引用 |

注意，Taro 相关的包需要配置 `external`，以免重复打包：

```js title="rollup.config.js"
{
  external: ['@tarojs/shared', '@tarojs/service']
}
```

## 类型

Taro 核心库维护的类型可能没有包括当前插件新增的组件和 API，这时我们需要对 `@tarojs/taro` 和 `@tarojs/components` 进行[模块补充 (module augmentation)](https://www.typescriptlang.org/docs/handbook/declaration-merging.html#module-augmentation)。

创建一个类型定义文件：

```ts title="types/shims-iot.d.ts"
// 为支付宝 IOT 小程序拓展新增的 API 和组件定义
import { ComponentType } from 'react'
import Taro from '@tarojs/taro'

declare module '@tarojs/taro' {
  interface Ix {
    onCashierEventReceive(cb: any): void
  }
  interface TaroStatic {
    ix: Ix
  }
}

interface PosterProps {
  posid: string
  audible?: boolean
  onSuccess?: () => void
  onFail?: () => void
  onChange?: () => void
}

declare module '@tarojs/components' {
  export const Poster: ComponentType<PosterProps>
}
```

开发者在类型定义文件中引入此文件即可：

```ts title="global.d.ts"
/// <reference types="@tarojs/plugin-platform-alipay-iot/types/shims-iot" />
```

## Web 端平台插件

编译时常用的逻辑抽象出了一个基类 [TaroPlatformWeb](./platform-web)，开发者可以[继承](./platform-web#自定义平台类)于此基类，从而实现端平台的编译。

:::info
自 3.6 版本开始支持 Web 端平台插件，并提供 `@tarojs/plugin-platform-h5` 插件
:::
</file>

<file path="docs/platform-plugin/index.md">
---
title: 概述
---

## 端平台插件

自 `v3.1.0` 起，我们把对每个小程序平台的兼容逻辑抽取了出来，以 [Taro 插件](../plugin)的形式注入 Taro 框架，从而支持对应平台的编译。

> Web 端平台插件自 `v3.6.0` 开始支持

### Taro 内置的端平台插件

| 插件                           | 编译平台     |
| :----------------------------- | :----------- |
| @tarojs/plugin-platform-weapp  | 微信小程序   |
| @tarojs/plugin-platform-alipay | 支付宝小程序 |
| @tarojs/plugin-platform-swan   | 百度小程序   |
| @tarojs/plugin-platform-tt     | 抖音小程序   |
| @tarojs/plugin-platform-qq     | QQ 小程序    |
| @tarojs/plugin-platform-jd     | 京东小程序   |
| @tarojs/plugin-platform-h5     | Web 端       |

### 其它端平台插件

| 插件                                                                                            | 编译平台          |
| :---------------------------------------------------------------------------------------------- | :---------------- |
| [@tarojs/plugin-platform-weapp-qy](https://github.com/NervJS/taro-plugin-platform-weapp-qy)     | 企业微信小程序    |
| [@tarojs/plugin-platform-alipay-dd](https://github.com/NervJS/taro-plugin-platform-alipay-dd)   | 钉钉小程序        |
| [@tarojs/plugin-platform-alipay-iot](https://github.com/NervJS/taro-plugin-platform-alipay-iot) | 支付宝 IOT 小程序 |
| [@tarojs/plugin-platform-lark](https://github.com/NervJS/taro-plugin-platform-lark)             | 飞书小程序        |

### 端平台插件使用方法

1. 配置插件

```js
// Taro 项目配置
module.exports = {
  // ...
  plugins: ['@tarojs/plugin-platform-alipay-iot'],
}
```

2. 编译为支付宝 IOT 端小程序

```shell
taro build --type iot
taro build --type iot --watch
```

## 背景

### 开放式框架

近年来业界推出的小程序平台越来越多，但 Taro 核心维护的平台只有 6 个（微信、支付宝、百度、头条、QQ、京东小程序），因此常常有同学提出能不能支持某某平台的 Feature Request。

基于目前的架构，对于单一平台的兼容性代码分布于 Taro 核心库的各个角落，涉及编译时与运行时等部分。支持一个新的平台需要改动所有的这些地方，开发复杂度高，同时社区也难以参与贡献。

为此我们萌生了打造一个**开放式框架**的想法。目标是可以通过插件的形式扩展 Taro 的端平台支持能力：

- 插件开发者无需修改 Taro 核心库代码，按照一定的规则即可编写出一个端平台插件。
- 插件使用者只需安装、配置端平台插件，即可把代码编译到指定平台。

端平台扩展又可以分为横向扩展和纵向扩展两种方式：

- 横向扩展

  扩展一个全新的编译平台，如美团小程序。

- 纵向扩展

  继承现有的端平台插件，扩展出新的编译平台，如 QQ 小程序插件继承于微信小程序插件。

#### 开放式编译平台架构图

![](https://storage.jd.com/cjj-pub-images/platform-plugin-all.png)

### 还可以做什么有意思的事

除了扩展新的编译平台，我们还可以通过继承于现有的端平台插件，来编写自定义的端平台插件，为平台的编译过程注入自定义逻辑：

> 使用插件 [@tarojs/plugin-inject](https://github.com/NervJS/taro-plugin-inject) 能为所有小程序平台快速新增 API、组件，调整组件属性等

#### 快速修复问题

由于小程序平台众多，而且它们也在不断地迭代，往往会出现 Taro 对某个小程序新推出的组件或 API 支持不及时的问题。这时开发者首先需要联系 Taro 团队，再等待我们跟进修复、发布新版本后才能正常使用，平均需要等待一周或两周的时间才能得到解决。

而基于开放式的编译平台架构，开发者能够通过继承目标的端平台插件，迅速开发出自定义端平台插件，完成对这些新组件或 API 的支持，无需等待 Taro 发布版本。

#### 属性精简

因为小程序组件的属性和事件都必须静态写死，不可以动态添加，所以 Taro 会把组件的所有属性和事件全部在模板里提前进行绑定。

但实际项目中很多情况下并不会使用到组件的所有属性和事件，循环这些冗余的属性和事件绑定也会占据很大一部分的体积，另外太多的事件绑定也会在一定程度上降低小程序的性能。

以下是 `View` 组件模板的伪代码：

```html
<template name="tmpl_0_view">
  <view
    hover-class="..."
    hover-stop-propagation="..."
    hover-start-time="..."
    hover-stay-time="..."
    animation="..."
    onTouchStart="..."
    onTouchMove="..."
    onTouchEnd="..."
    onTouchCancel="..."
    onLongTap="..."
    onAnimationStart="..."
    onAnimationIteration="..."
    onAnimationEnd="..."
    onTransitionEnd="..."
    disable-scroll="..."
    hidden="..."
    onAppear="..."
    onDisappear="..."
    onFirstAppear="..."
    style="..."
    class="..."
    onTap="..."
    id="..."
  >
    ...
  </view>
</template>
```

Taro 需要把 `View` 组件的所有属性和事件提前进行绑定，才能满足不同开发者的使用需求。但可能对于某位开发者来说，整个项目的 `View` 组件都没有使用到 `hover-stop-propagation` 这个属性，那么则可以考虑把它精简掉，不编译到 `View` 模板当中。

属性精简的功能同样可以通过实现一个自定义端平台插件来实现。但是需要提醒的是，对属性的精简可能会引起不必要的问题、使项目的维护变得困难，特别当项目变大，开发者众多时，需要谨慎设计和使用。

#### 欢迎共建

我们希望在开放式架构推出后，能激起社区各位开发者的创造力，一起为 Taro 生态创造新的端平台支持插件，或各种优秀的自定义端平台组件，期待您的参与和贡献！
</file>

<file path="docs/platform-plugin/platform-mini.md">
---
title: TaroPlatformBase
---

我们把编译时常用的逻辑抽象出了一个基类 `TaroPlatformBase`，开发者可以继承于此基类，从而实现端平台的编译。

例如我们创建一个微信小程序平台：

```js title="program.ts"
import { TaroPlatformBase } from '@tarojs/service'
export default class Weapp extends TaroPlatformBase {
  // ...
}
```

## 方法与属性

### constructor (ctx, config)

构造函数，接受两个参数。

| 参数   | 类型   | 说明           |
| :----- | :----- | :------------- |
| ctx    | object | 插件上下文对象 |
| config | object | Taro 编译配置  |

### ctx

`object`

插件上下文对象。

#### this.ctx.modifyWebpackChain

获取 WebpackChain，例子：

```js title="program.ts"
class Weapp extends TaroPlatformBase {
  modifyWebpackChain() {
    // 通过 this.ctx.modifyWepackChain 能获取到 WebpackChain 实例
    this.ctx.modifyWebpackChain(({ chain }) => {
      // chain.xxxx
    })
  }
}
```

### helper

`object`

存放着一系列工具函数，对应 `@tarojs/helper` 包的导出内容。

### config

`object`

编译配置对象。

### (abstract) platform

> 抽象属性，子类必须实现。

`string`

平台名称，如：

```js title="program.ts"
class Weapp extends TaroPlatformBase {
  platform = 'weapp'
}
```

### (abstract) globalObject

> 抽象属性，子类必须实现。

`string`

小程序挂载各种 API 的全局对象名称。如微信小程序的 `wx`，支付宝小程序的 `my`，例如：

```js title="program.ts"
class Weapp extends TaroPlatformBase {
  globalObject = 'wx'
}
```

### (abstract) runtimePath

> 抽象属性，子类必须实现。

`stirng` | `string[]`

小程序编译的运行时文件的解析路径，如：

```js title="program.ts"
class Weapp extends TaroPlatformBase {
  runtimePath = '@tarojs/plugin-platform-weapp/dist/runtime'
}
```

### (abstract) fileType

> 抽象属性，子类必须实现。

`object`

平台的各种文件的后缀名，如：

```js title="program.ts"
class Weapp extends TaroPlatformBase {
  fileType = {
    // 模板文件后缀
    templ: '.wxml',
    // 样式文件后缀
    style: '.wxss',
    // 配置文件后缀
    config: '.json',
    // 脚本文件后缀
    script: '.js',
    // 【可选】渲染层脚本文件后缀，如微信小程序的 wxs，支付宝小程序的 sjs
    xs: '.wxs',
  }
}
```

### (abstract) template

> 抽象属性，子类必须实现。

`object`

[模板对象](./template)的实例。

### (optional) projectConfigJson

> 子类可选择是否进行设置。

小程序配置文件的名称。

如果子类有实现 `projectConfigJson`，则会自动拷贝此文件到 `dist` 目录下。

```js title="program.ts"
class Weapp extends TaroPlatformBase {
  projectConfigJson = 'project.config.json'
}
```

### (optional) taroComponentsPath

> 子类可选择是否进行设置。

编译时对 `@tarojs/components` 包的 alias，下文将详细介绍。

```js title="program.ts"
class Weapp extends TaroPlatformBase {
  taroComponentsPath = '@tarojs/plugin-platform-weapp/dist/components-react'
}
```

### setupTransaction

`setup` 阶段的事务钩子。

```js title="program.ts"
class Weapp extends TaroPlatformBase {
  /**
   * 1. setupTransaction - init
   * 2. setup
   * 3. setupTransaction - close
   * 4. buildTransaction - init
   * 5. build
   * 6. buildTransaction - close
   */
  constructor (ctx, config) {
    super(ctx, config)

    this.setupTransaction.addWrapper({
      init () {}
      close () {}
    })
  }
}
```

### buildTransaction

`build` 阶段的事务钩子。

```js title="program.ts"
class Weapp extends TaroPlatformBase {
  /**
   * 1. setupTransaction - init
   * 2. setup
   * 3. setupTransaction - close
   * 4. buildTransaction - init
   * 5. build
   * 6. buildTransaction - close
   */
  constructor (ctx, config) {
    super(ctx, config)

    this.buildTransaction.addWrapper({
      init () {}
      close () {}
    })
  }
}
```

### start ()

插件入口调用 `start` 方法开启编译，如：

```js title="program.ts"
class Weapp extends TaroPlatformBase {
  // ...
}

export default (ctx) => {
  ctx.registerPlatform({
    name: 'weapp',
    useConfigName: 'mini',
    async fn({ config }) {
      const program = new Weapp(ctx, config)
      await program.start()
    },
  })
}
```

### generateProjectConfig (src, dist)

用于生成 project.config.json 此类项目配置文件。

| 参数 | 类型   | 默认值                | 说明                     |
| :--- | :----- | :-------------------- | :----------------------- |
| src  | string |                       | 项目源码中配置文件的名称 |
| dist | string | 'project.config.json' | 编译后配置文件的名称     |

例子：

```js
// 把用户编写的 `project.tt.json` 输出为 `project.config.json`
generateProjectConfig('project.tt.json')
// 把用户编写的 `project.swan.json` 输出为 `project.swan.json`
generateProjectConfig('project.swan.json', 'project.swan.json')
```

### recursiveReplaceObjectKeys (target, keyMap)

递归替换目标对象的 key 值。

| 参数   | 类型   | 说明           |
| :----- | :----- | :------------- |
| target | object | 目标对象       |
| keyMap | object | key 值替换规则 |

例子，支付宝小程序配置项 key 值和大多数小程序的规范不一样，需要进行对齐：

```js
// this.ctx.modifyMiniConfigs 能获取到小程序入口和页面配置文件的列表
this.ctx.modifyMiniConfigs(({ configMap }) => {
  const replaceKeyMap = {
    navigationBarTitleText: 'defaultTitle',
    navigationBarBackgroundColor: 'titleBarColor',
    enablePullDownRefresh: 'pullRefresh',
    list: 'items',
    text: 'name',
    iconPath: 'icon',
    selectedIconPath: 'activeIcon',
    color: 'textColor',
  }
  Object.keys(configMap).forEach((key) => {
    const item = configMap[key]
    if (item.content) {
      // 递归替换配置文件里的 key 值为目标对象的 key 值
      this.recursiveReplaceObjectKeys(item.content, replaceKeyMap)
    }
  })
})
```

## 自定义平台类

接下来将以扩展对微信小程序的编译支持为例，介绍如何创建一个自定义平台类。

### 1. 继承基类

继承 `TaroPlatformBase` 以实现 `Weapp` 类，并实现所有抽象属性、可选属性：

```js title="program.ts"
import { TaroPlatformBase } from '@tarojs/service'

const PACKAGE_NAME = '@tarojs/plugin-platform-weapp'

class Weapp extends TaroPlatformBase {
  // 平台名称
  platform = 'weapp'
  // 小程序全局对象
  globalObject = 'wx'
  // 小程序编译的运行时文件的解析路径
  runtimePath = `${PACKAGE_NAME}/dist/runtime`
  // 文件后缀
  fileType = {
    templ: '.wxml',
    style: '.wxss',
    config: '.json',
    script: '.js',
    xs: '.wxs'
  }
  template = new Template()
  // 小程序配置文件名称
  projectConfigJson = 'project.config.json'
  // 对 `@tarojs/components` 包的 alias 路径
  taroComponentsPath = `${PACKAGE_NAME}/dist/components-react`

  constructor (ctx, config) {
    super(ctx, config)

    /**
    * 1. setupTransaction - init
    * 2. setup
    * 3. setupTransaction - close
    * 4. buildTransaction - init
    * 5. build
    * 6. buildTransaction - close
    */

    // 可以在 setup 的不同阶段注入自定义逻辑
    this.setupTransaction.addWrapper({
      init () {}
      close () {}
    })

    // 可以在 build 的不同阶段注入自定义逻辑
    this.buildTransaction.addWrapper({
      init () {}
      close () {}
    })
  }
}

export default Weapp
```

### 2. 处理模板逻辑

编写一个[模板类](./template)以处理模板逻辑，把它的实例设置为自定义平台类的 `template` 属性：

```js title="program.ts"
import { Template } from './template'

class Weapp extends TaroPlatformBase {
  // ...
  // 模板实例
  template = new Template()
}
```

### 3. 处理组件

我们把目前支持的 6 种小程序进行了组件和组件属性的比对，得出了一份最通用的组件以及其属性。访问 `Template` 类实例的 [internalComponents](./template#thisinternalcomponents) 属性可以获取到这些通用组件以及属性。

> 抽取这份通用组件的目的是为了在生成 B 小程序的模板时，尽量不会含有 A 小程序独有的组件或属性。

但随着各小程序平台发展，各平台都可能独自新增一些组件或属性。这时我们的端平台插件就需要通过修改 `template.internalComponents` 来处理这些特殊的组件或属性。

#### 3.1 编写 components.ts

`components.ts` 可以导出一个对象，以表示对 `internalComponents` 修改属性、新增属性或新增组件。

规范：

```js title="components.ts"
import { singleQuote } from '@tarojs/shared'

export const components = {
  // 组件名 CamelCase
  ScrollView:
    // 属性对象
    {
      // value 为空字符串时，代表不设置默认值
      'scroll-left': '',
      // 属性默认值为布尔值或数字时，value 写为字符串
      'enable-flex': 'false',
      'refresher-threshold': '45',
      // 属性默认值为字符串时，需要使用 singleQuote 函数进行包裹
      'refresher-default-style': singleQuote('black'),
      // 事件
      bindRefresherAbort: '',
    },
}
```

#### 3.2 合并到 template.internalComponents

编写好 `components.ts` 后，可以借助 `Template` 类实例的 `mergeComponents` 方法进行合并。

##### template.mergeComponents (ctx, patch)

合并组件补丁到 `this.internalComponents`。

| 参数  | 类型   | 说明           |
| :---- | :----- | :------------- |
| ctx   | object | 插件上下文对象 |
| patch | object | 组件补丁       |

例子：

```js title="program.ts"
import { components } from './components'

class Weapp extends TaroPlatformBase {
  constructor(ctx, config) {
    super(ctx, config)

    // 在 setup 阶段结束时，修改模板
    this.setupTransaction.addWrapper({
      close: this.modifyTemplate,
    })
  }

  modifyTemplate() {
    this.template.mergeComponents(this.ctx, components)
  }
}
```

```js title="components.ts"
export const components = {
  ScrollView: {
    'enable-flex': 'true',
    'refresher-threshold': '45',
  },
  Xyz: {
    a: '',
  },
}
```

假设 `template.internalComponent` 的默认值为：

```js
internalComponent = {
  ScrollView: {
    'scroll-left': '',
    'enable-flex': 'false',
  },
}
```

合并后的结果为：

```js
internalComponent = {
  ScrollView: {
    'scroll-left': '',
    // enable-flex 的默认值修改了
    'enable-flex': 'true',
    // 新增了 refresher-threshold 属性
    'refresher-threshold': '45',
  },
  // 新增了 Xyz 组件
  Xyz: {
    a: '',
  },
}
```

#### 3.3 直接修改 template.internalComponents

除了借助 `template.mergeComponents` 进行合并，我们也可以直接修改 `template.internalComponents`。

```js title="program.ts"
class Weapp extends TaroPlatformBase {
  modifyTemplate() {
    // 删除 Slider 组件里的一些属性
    this.modifySlider(this.template.internalComponents.Slider)
    // 改写 View 组件的属性对象
    this.template.internalComponents.View = {}
  }

  modifySlider(slider) {
    delete slider['block-size']
    delete slider['block-color']
  }
}
```

> 建议尽量编写一份 `components.ts` 进行 merge，而不是直接操作。因为运行时也需要合并后的组件信息，编写一份 `components.ts` 能进行复用。

#### 3.4 编写 components-react.ts

在 Taro 里使用 React，内置组件需要从 `@tarojs/components` 中引用后再使用。

```js
import { View } from '@tarojs/components'
```

但如果我们**增加了新的内置组件，再从 `@tarojs/components` 中引用就取不到这些新增的组件**。

因此当我们**新增加了组件**时，需要编写一份 `components-react.ts`，并配置 Webpack alias，供 **React** 引用。

例子：

1. 编写 `components-react.ts` 文件

```js title="components-react.ts"
// 原有的组件
export * from '@tarojs/components/mini'
// 新增的组件
export const Editor = 'editor'
export const OfficialAccount = 'official-account'
```

2. 设置 [taroComponentsPath](./platform-mini#optional-tarocomponentspath)

```js title="program.ts"
const PACKAGE_NAME = '@tarojs/plugin-platform-weapp'
class Weapp extends TaroPlatformBase {
  taroComponentsPath = `${PACKAGE_NAME}/dist/components-react`
}
```
</file>

<file path="docs/platform-plugin/platform-web.md">
---
title: TaroPlatformWeb
---

我们把编译时常用的逻辑抽象出了一个基类 `TaroPlatformWeb`，开发者可以继承于此基类，从而实现端平台的编译。

例如我们创建一个 H5 平台：

```js title="program.ts"
import { TaroPlatformWeb } from '@tarojs/service'
export default class H5 extends TaroPlatformWeb {
  // ...
}
```

## 方法与属性

### constructor (ctx, config)

构造函数，接受两个参数。

| 参数   | 类型   | 说明           |
| :----- | :----- | :------------- |
| ctx    | object | 插件上下文对象 |
| config | object | Taro 编译配置  |

### ctx

`object`

插件上下文对象。

#### this.ctx.modifyWebpackChain

获取 WebpackChain，例子：

```js title="program.ts"
class H5 extends TaroPlatformWeb {
  modifyWebpackChain() {
    // 通过 this.ctx.modifyWepackChain 能获取到 WebpackChain 实例
    this.ctx.modifyWebpackChain(({ chain }) => {
      // chain.xxxx
    })
  }
}
```

### helper

`object`

存放着一系列工具函数，对应 `@tarojs/helper` 包的导出内容。

### config

`object`

编译配置对象。

### (abstract) platform

> 抽象属性，子类必须实现。

`string`

平台名称，如：

```js title="program.ts"
class H5 extends TaroPlatformWeb {
  platform = 'h5'
}
```

### (abstract) runtimePath

> 抽象属性，子类必须实现。

`stirng` | `string[]`

Web 端编译的运行时文件的解析路径，如：

```js title="program.ts"
class H5 extends TaroPlatformWeb {
  runtimePath = '@tarojs/plugin-platform-h5/dist/runtime'
}
```

### setupTransaction

`setup` 阶段的事务钩子。

```js title="program.ts"
class H5 extends TaroPlatformWeb {
  /**
   * 1. setupTransaction - init
   * 2. setup
   * 3. setupTransaction - close
   * 4. buildTransaction - init
   * 5. build
   * 6. buildTransaction - close
   */
  constructor (ctx, config) {
    super(ctx, config)

    this.setupTransaction.addWrapper({
      init () {}
      close () {}
    })
  }
}
```

### buildTransaction

`build` 阶段的事务钩子。

```js title="program.ts"
class H5 extends TaroPlatformWeb {
  /**
   * 1. setupTransaction - init
   * 2. setup
   * 3. setupTransaction - close
   * 4. buildTransaction - init
   * 5. build
   * 6. buildTransaction - close
   */
  constructor (ctx, config) {
    super(ctx, config)

    this.buildTransaction.addWrapper({
      init () {}
      close () {}
    })
  }
}
```

### start ()

插件入口调用 `start` 方法开启编译，如：

```js title="program.ts"
class H5 extends TaroPlatformWeb {
  // ...
}

export default (ctx) => {
  ctx.registerPlatform({
    name: 'h5',
    useConfigName: 'h5',
    async fn({ config }) {
      const program = new H5(ctx, config)
      await program.start()
    },
  })
}
```

## 自定义平台类

接下来将以扩展对 Web 端的编译支持为例，介绍如何创建一个自定义平台类。

### 1. 继承基类

继承 `TaroPlatformWeb` 以实现 `H5` 类，并实现所有抽象属性、可选属性：

```js title="program.ts"
import { TaroPlatformWeb } from '@tarojs/service'

const PACKAGE_NAME = '@tarojs/plugin-platform-h5'

class H5 extends TaroPlatformWeb {
  // 平台名称
  platform = 'h5'
  // Web 端运行时文件的解析路径
  runtimePath = `${PACKAGE_NAME}/dist/runtime`

  constructor (ctx, config) {
    super(ctx, config)

    /**
    * 1. setupTransaction - init
    * 2. setup
    * 3. setupTransaction - close
    * 4. buildTransaction - init
    * 5. build
    * 6. buildTransaction - close
    */

    // 可以在 setup 的不同阶段注入自定义逻辑
    this.setupTransaction.addWrapper({
      init () {}
      close () {}
    })

    // 可以在 build 的不同阶段注入自定义逻辑
    this.buildTransaction.addWrapper({
      init () {}
      close () {}
    })
  }
}

export default H5
```

### 2. 处理 API

在 Web 端环境中增减 API 其实并不难，在之前版本中开发者也可以通过配置为 `@tarojs/taro` 配置 alias 参数实现，在 `@tarojs/plugin-platform-h5` 中也是如此，通过将 runner 中相关的代码抽离实现的这一特性。

```ts
  modifyWebpackConfig () {
    this.ctx.modifyWebpackChain(({ chain }) => {
      const alias = chain.resolve.alias
      alias.set('@tarojs/taro', require.resolve('./runtime/apis'))
    })
  }
```

虽然对 API 修改很容易，但是新增的 API 却不能通过 `Taro.newAPI` 的形式来使用，为此我们需要在插件打包时需要借助 exportNameOnly 插件输出当前插件支持的 API 列表。

```js title="rollup.config.js"
import exportNameOnly from '@tarojs/plugin-platform-h5/build/rollup-plugin-export-name-only'
{
  input: path.join(cwd, 'src/runtime/apis/index.ts'),
  output: {
    file: 'dist/taroApis.js',
    format: 'cjs',
    inlineDynamicImports: true
  },
  plugins: [exportNameOnly()]
}
```

并将 API 列表通过 `babel-plugin-transform-taroapi` 注册，帮助开发者将 `Taro.newAPI` 转换成对应语法使用。

```ts
  modifyWebpackConfig () {
    this.ctx.modifyWebpackChain(({ chain }) => {
      const rules = chain.module.rules
      const script = rules.get('script')
      const babelLoader = script.uses.get('babelLoader')
      babelLoader.set('options', {
        ...babelLoader.get('options'),
        plugins: [
          [require('babel-plugin-transform-taroapi'), {
            packageName: '@tarojs/taro',
            apis: require(resolveSync('./taroApis'))
          }]
        ]
      })
    })
  }
```

### 3. 处理组件

使用 Taro 提供的组件仅仅需要在 runtime 中注册，并通过别名为不同前端 UI 框架配置所需的适配器（@tarojs/components/lib/[framework]）。

```ts
import '@tarojs/components/dist/taro-components/taro-components.css'

import { applyPolyfills, defineCustomElements } from '@tarojs/components/loader'

// Note: 3.6.3 开始，不再需要手动调用 applyPolyfills 和 defineCustomElements
applyPolyfills().then(function () {
  defineCustomElements(window)
})
```

如果需要新增组件可以考虑与 Taro 一样使用 stencil 或者其他 web-components 方案，当然也可以仅为单一框架提供组件库（例如 useHtmlComponents 模式，将组件库替换为 @tarojs/components-react）。需要注意的是，如果仅替换部分又不希望注册全部组件，可以手动注册所需组件并导出，比如 taro-pull-to-refresh 提供了下拉刷新的特性，如果未注册会导致相关特性无法使用。

```ts title="src/runtime/index.ts"
import { defineCustomElement } from '@tarojs/components/dist/components/taro-pull-to-refresh'

// Note: 3.6.3 开始，组件会自动注册，不需要手动调用 defineCustomElement
defineCustomElement()
```

对于下拉组件，也可以通过为 appConfig 新增 PullDownRefresh 配置替换使用，对于插件来说可以参考以下写法。

```ts
  modifyWebpackConfig () {
    this.ctx.modifyWebpackChain(({ chain }) => {
      chain.plugin('mainPlugin')
        .tap(args => {
          args[0].loaderMeta ||= {
            extraImportForWeb: '',
            execBeforeCreateWebApp: ''
          }
          args[0].loaderMeta.extraImportForWeb += `import { PullDownRefresh } from '@tarojs/components'\n`
          args[0].loaderMeta.execBeforeCreateWebApp += `config.PullDownRefresh = PullDownRefresh\n`
          return args
        })
    })
  }
```
</file>

<file path="docs/platform-plugin/reconciler.md">
---
title: Reconciler
---

Taro 的运行时包括 DOM、BOM、React 兼容层、Vue 兼容层等内容，而不同的端平台或开发框架都有可能需要对 Taro 运行时进行侵入定制。

为了解耦，我们参考了 **React Reconciler** 的概念，外部可以通过提供一个自定义的 `hostConfig` 配置对象，对运行时进行定制。

> 遇到 hostConfig 的配置项不满足需求，需要进行扩展时，可以给 Taro 提交 PR ～

## hostConfig 配置

### appendChild (parent, child)

`DOMNode` 调用 `appendChild` 方法时触发。

| 参数   | 类型                  | 说明                 |
| :----- | :-------------------- | :------------------- |
| parent | DOMNode               | 父节点               |
| child  | DOMNode / TextElement | 要给父节点追加的节点 |

### removeChild (parent, child, oldChild)

`DOMNode` 调用 `replaceChild` 方法时触发。

| 参数     | 类型                  | 说明                       |
| :------- | :-------------------- | :------------------------- |
| parent   | DOMNode               | 父节点                     |
| child    | DOMNode / TextElement | 用来替换 oldChild 的新节点 |
| oldChild | DOMNode / TextElement | 被替换掉的原始节点         |

### insertBefore (parent, child, refChild)

`DOMNode` 调用 `insertBefore` 方法时触发。

| 参数     | 类型                  | 说明                 |
| :------- | :-------------------- | :------------------- |
| parent   | DOMNode               | 父节点               |
| child    | DOMNode / TextElement | 用于插入的节点       |
| refChild | DOMNode / TextElement | 将要插在这个节点之前 |

### removeAttribute (element, qualifiedName)

`DOMElement` 调用 `removeAttribute` 方法时触发。

| 参数          | 类型       | 说明                           |
| :------------ | :--------- | :----------------------------- |
| element       | DOMElement | 当前操作元素                   |
| qualifiedName | string     | 指定要从元素中移除的属性的名称 |

### setAttribute (element, qualifiedName, value)

`DOMElement` 调用 `setAttribute` 方法时触发。

| 参数          | 类型       | 说明                 |
| :------------ | :--------- | :------------------- |
| element       | DOMElement | 当前操作元素         |
| qualifiedName | string     | 表示属性名称的字符串 |
| value         |            | 属性的值/新值        |

### prepareUpdateData (data, page)

每次 Taro DOM 树更新，调用小程序 `setData` 前触发。

| 参数 | 类型            | 说明                                |
| :--- | :-------------- | :---------------------------------- |
| data | DataTree        | 将要 setData 的 Taro DOM 树数据结构 |
| page | TaroRootElement | 页面根元素                          |

### appendInitialPage (data, page)

Taro DOM 树初始化，第一次调用小程序 `setData` 前触发。在调用 `prepareUpdateData` 后立刻执行。

| 参数 | 类型            | 说明                                |
| :--- | :-------------- | :---------------------------------- |
| data | DataTree        | 将要 setData 的 Taro DOM 树数据结构 |
| page | TaroRootElement | 页面根元素                          |

### getLifecyle (instance, lifecyle)

小程序页面的生命周期被触发时调用。

| 参数     | 类型     | 说明                               |
| :------- | :------- | :--------------------------------- |
| instance | Instance | 用户编写的页面实例                 |
| lifecyle | string   | 小程序页面被触发的生命周期函数名称 |

需要返回 **function** 或 **function[]**，表示将要执行的函数。

例子：

```js
// 默认值：
// 直接取用户编写的页面实例中，对应的生命周期方法
getLifecyle (instance, lifecyle) {
  return instance[lifecyle]
}

// 在 React 中，
// 小程序触发 onShow，调用用户编写的 componentDidShow
// 小程序触发 onHide，调用用户编写的 componentDidHide
getLifecyle (instance, lifecycle) {
  if (lifecycle === 'onShow') {
    lifecycle = 'componentDidShow'
  } else if (lifecycle === 'onHide') {
    lifecycle = 'componentDidHide'
  }
  return instance[lifecycle]
}
```

### onTaroElementCreate (tagName, nodeType)

`DOMElement` 构造时触发。

| 参数     | 类型     | 说明                     |
| :------- | :------- | :----------------------- |
| tagName  | string   | 当前创建的元素的标签名   |
| nodeType | NodeType | 当前创建的元素的节点类型 |

| nodeType | 说明                        |
| :------- | :-------------------------- |
| 1        | ELEMENT_NODE                |
| 2        | ATTRIBUTE_NODE              |
| 3        | TEXT_NODE                   |
| 4        | CDATA_SECTION_NODE          |
| 5        | ENTITY_REFERENCE_NODE       |
| 6        | COMMENT_NODE                |
| 7        | PROCESSING_INSTRUCTION_NODE |
| 9        | DOCUMENT_NODE               |

### getPathIndex (indexOfNode)

`DOMNode` 获取 `path` 属性时触发。

| 参数        | 类型   | 说明                                   |
| :---------- | :----- | :------------------------------------- |
| indexOfNode | number | 当前节点在父节点 children 列表中的下标 |

需要返回一个 **string** 值，代表小程序按路径 `setData` 时的数组下标。

例子：

```js
// 默认值：
getPathIndex (indexOfNode) {
  return `[${indexOfNode}]`
}

// 百度小程序不需要 [] 包裹
getPathIndex (indexOfNode) {
  return indexOfNode
}
```

### getEventCenter(Events)

`Taro.eventCenter` 初始化值时触发。

| 参数   | 类型 | 说明                    |
| :----- | :--- | :---------------------- |
| Events |      | Taro 事件中心的构造函数 |

需要返回 Taro 事件中心的实例，其将会被赋值给 `Taro.eventCenter`。

例子：

```js
// 默认值：
getEventCenter (Events) {
  return new Events()
}

// 支付宝小程序中，
// 优先从小程序全局对象 my 中取出创建过的事件中心实例，避免分包时出现问题。
getEventCenter (Events) {
  if (!my.taroEventCenter) {
    my.taroEventCenter = new Events()
  }
  return my.taroEventCenter
}
```

### initNativeApi (taro)

引用 `@tarojs/taro` 包时触发。

| 参数 | 类型 | 说明      |
| :--- | :--- | :-------- |
| taro |      | Taro 对象 |

例子：

```js
initNativeApi (taro) {
  // 为 Taro 对象增加 getApp 方法
  taro.getApp = getApp
}
```
</file>

<file path="docs/platform-plugin/template.md">
---
title: 模板
---

Taro3 通过把 DOM 树的数据进行 `setData`，从而驱动模板（`<template>`）拼接来渲染出视图。

因此开发者可以看到编译后的代码中，页面模板文件的内容很简单，只是引用了公共模板 `base.xml`，所有组件的模板都在此文件中进行声明。

我们可以创建一个模板类，控制 `base` 模板的编译结果。

## 递归与非递归模板

我们把模板相关的处理逻辑封装成了基类。分别是给**支持模板递归**的小程序继承的 `RecursiveTemplate` 类，和给**不支持模板递归**的小程序继承的 `UnRecursiveTemplate` 类。

### 可递归模板

支持模板递归的小程序中，同一个模板能够不断调用自身，包括支付宝、头条、百度小程序。

`view_0` 引用 `container_0`，`container_0` 能再引用 `view_0`：

![](https://storage.jd.com/cjj-pub-images/recursive_temp.png)

### 非递归模板

不支持模板递归的小程序中，引用过的模板不能再调用自身，包括微信、QQ、京东小程序。

`view_0` 引用 `container_0`，`container_0` 不能再引用 `view_0`，只能引用新的 `view` 模板 `view_1`：

![](https://storage.jd.com/cjj-pub-images/unrecursive_temp.png)

## 模板基类

### this.Adapter

`object`

平台的模板语法关键词。

例子：

```js
// 声明了微信小程序模板语法关键词的 Adapter
class Template extends UnRecursiveTemplate {
  Adapter = {
    if: 'wx:if',
    else: 'wx:else',
    elseif: 'wx:elif',
    for: 'wx:for',
    forItem: 'wx:for-item',
    forIndex: 'wx:for-index',
    key: 'wx:key',
    xs: 'wxs',
    type: 'weapp',
  }
}
```

### this.isSupportRecursive

`boolean`

只读，是否支持模板递归。

### this.supportXS

`boolean`

默认值：false

是否支持渲染层脚本，如微信小程序的 wxs，支付宝小程序的 sjs。

### this.exportExpr

`string`

默认值：'module.exports ='

渲染层脚本的导出命令。

例子：

```js
// 支付宝小程序 sjs 脚本的导出命令为 ES 模式
class Template extends RecursiveTemplate {
  exportExpr = 'export default'
}
```

### this.internalComponents

`object`

Taro 内置组件列表，包括了相对通用的组件及其部分通用属性。

### this.focusComponents

`Set<string>`

可以设置 focus 聚焦的组件。

默认值：

```js
focusComponents = new Set(['input', 'textarea', 'editor'])
```

### this.voidElements

`Set<string>`

不需要渲染子节点的元素。配置后这些组件不会渲染子节点，能够减少模板体积。

默认值：

```js
voidElements = new Set([
  'progress',
  'icon',
  'rich-text',
  'input',
  'textarea',
  'slider',
  'switch',
  'audio',
  'live-pusher',
  'video',
  'ad',
  'official-account',
  'open-data',
  'navigation-bar',
])
```

### this.nestElements

`Map<string, number>`

对于一个小程序来说，只有部分组件有可能递归调用自身。如 `<Map>` 组件不会再调用 `<Map>`，而 `<View>` 则可以不断递归调用 `<View>`。

如果此小程序不支持递归，我们又把 `<Map>` 模板循环渲染了 N 次，那么小程序体积就会变大，而这些循环出来的模板又是不必要的。因此使用了 `nestElements` 去标记那些可能递归调用的组件。

但考虑到例如 `<Form>` 这些组件即使可能递归调用，但也不会递归调用太多次。因此在 `nestElements` 中可以对它的循环渲染次数进行控制，假设 `<Form>` 不会递归调用超过 N 次，进一步减少模板体积。

默认值：

```js
nestElements = new Map([
  ['view', -1],
  ['cover-view', -1],
  ['block', -1],
  ['text', -1],
  ['slot', 8],
  ['slot-view', 8],
  ['label', 6],
  ['form', 4],
  ['scroll-view', 4],
])
```

`key` 值为可以递归调用自身的组件。

`value` 值代表递归生成此组件的次数，**-1** 代表循环 [baseLevel](../config-detail#minibaselevel) 层。

### replacePropName (name, value, componentName)

代替组件的属性名。

| 参数         | 类型   | 说明   |
| :----------- | :----- | :----- |
| name         | string | 属性名 |
| value        | string | 属性值 |
| componetName | string | 组件名 |

例子：

```js
replacePropName (name, value, componentName) {
  // 如果属性值为 'eh'，代表这是一个事件，把属性名改为全小写。
  if (value === 'eh') return name.toLowerCase()
  return name
}
```

### buildXsTemplate ()

支持渲染层脚本的小程序，Taro 会生成一个 utils 脚本在根目录。此时需要声明此函数以设置 base 模板中对 utils 脚本的引用语法。

例子：

```js
// 微信小程序 base 模板引用 utils.wxs 脚本
buildXsTemplate () {
  return '<wxs module="xs" src="./utils.wxs" />'
}
```

### modifyLoopBody (child, nodeName)

修改组件模板的子节点循环体。

| 参数     | 类型   | 说明                   |
| :------- | :----- | :--------------------- |
| child    | string | 组件模板的子节点循环体 |
| nodeName | string | 组件名                 |

没有在 [this.voidElements](./template#thisvoidelements) 中声明过的组件，会遍历子节点进行渲染。

这些组件的模板通用格式为：

```html
<template name="tmpl_0_view">
  <view>
    <!-- 子节点循环 begin -->
    <block wx:for="{{i.cn}}" wx:key="uid">
      <!-- 子节点循环体 begin -->
      <template is="{{...}}" data="{{...}}" />
      <!-- 子节点循环体 end -->
    </block>
    <!-- 子节点循环 end -->
  </view>
</template>
```

例子：

```js
// 支付宝小程序的 <swiper> 组件中，循环体套一层 <swiper-item> 和 <view> 组件
modifyLoopBody (child, nodeName) {
  if (nodeName === 'swiper') {
    return `<swiper-item>
      <view a:for="{{item.cn}}" a:key="id">
        ${child}
      </view>
    </swiper-item>`
  }
  return child
}
```

### modifyLoopContainer (children, nodeName)

修改组件模板的子节点循环。

| 参数     | 类型   | 说明                 |
| :------- | :----- | :------------------- |
| children | string | 组件模板的子节点循环 |
| nodeName | string | 组件名               |

例子：

```js
// 支付宝小程序的 <picker> 组件中，子节点循环套一层 <view> 组件
modifyLoopContainer (children, nodeName) {
  if (nodeName === 'picker') {
    return `
<view>${children}</view>
`
  }
  return children
}
```

### modifyTemplateResult (res, nodeName, level, children)

修改组件模板的最终结果。

| 参数     | 类型   | 说明                 |
| :------- | :----- | :------------------- |
| res      | string | 组件模板的结果       |
| nodeName | string | 组件名               |
| level    | string | 循环层级             |
| children | string | 组件模板的子节点循环 |

例子：

```js
// 支付宝小程序当遇到 <swiper-item> 组件时不渲染其模板
modifyTemplateResult = (res: string, nodeName: string) => {
  if (nodeName === 'swiper-item') return ''
  return res
}
```

### getAttrValue (value, key, nodeName)

设置组件的属性绑定语法。

| 参数     | 类型   | 说明   |
| :------- | :----- | :----- |
| value    | string | 属性值 |
| key      | string | 属性名 |
| nodeName | string | 组件名 |

例子：

```js
getAttrValue (value, key, nodeName) {
  const swanSpecialAttrs = {
    'scroll-view': ['scrollTop', 'scrollLeft', 'scrollIntoView']
  }

  // 百度小程序中 scroll-view 组件部分属性的属性绑定语法是: {= value =}
  if (isArray(swanSpecialAttrs[nodeName]) && swanSpecialAttrs[nodeName].includes(key)) {
    return `= ${value} =`
  }

  // 其余属性还是使用 {{ value }} 绑定语法
  return `{ ${value} }`
}
```

## 例子

### 抖音小程序模板

- 抖音小程序支持模板递归，所以继承 `RecursiveTemplate` 基类。

- 因为不需要调整模板内容，所以只用设置 `supportXS` 和 `Adapter` 属性即可。

```js
import { RecursiveTemplate } from '@tarojs/shared/dist/template'

export class Template extends RecursiveTemplate {
  supportXS = false
  Adapter = {
    if: 'tt:if',
    else: 'tt:else',
    elseif: 'tt:elif',
    for: 'tt:for',
    forItem: 'tt:for-item',
    forIndex: 'tt:for-index',
    key: 'tt:key',
    type: 'tt',
  }
}
```

### 微信小程序模板

- 微信小程序不支持模板递归，所以继承 `UnRecursiveTemplate` 基类。
- 设置 `supportXS` 和 `Adapter` 属性。
- 因为微信小程序支持渲染层脚本 `wxs`，所以  通过 `buildXsTemplate` 设置 base 模板中对 utils 脚本的引用语法。
- 利用 `replacePropName` 修改了组件绑定的属性名。

```js
import { UnRecursiveTemplate } from '@tarojs/shared/dist/template'

export class Template extends UnRecursiveTemplate {
  supportXS = true
  Adapter = {
    if: 'wx:if',
    else: 'wx:else',
    elseif: 'wx:elif',
    for: 'wx:for',
    forItem: 'wx:for-item',
    forIndex: 'wx:for-index',
    key: 'wx:key',
    xs: 'wxs',
    type: 'weapp',
  }

  buildXsTemplate() {
    return '<wxs module="xs" src="./utils.wxs" />'
  }

  replacePropName(name, value, componentName) {
    if (value === 'eh') {
      const nameLowerCase = name.toLowerCase()
      if (nameLowerCase === 'bindlongtap' && componentName !== 'canvas') return 'bindlongpress'
      return nameLowerCase
    }
    return name
  }
}
```
</file>

<file path="docs/team/58anjuke.md">
---
title: 58安居客 团队
---

import Link from '@docusaurus/Link'

## 使用 Taro 高效开发 APP

Taro 3 React Native 部分由 58 的团队开发。RN 相关的 RFC 可以关注 [Pull Request](https://github.com/NervJS/taro-rfcs/pull/8)。测试进展及相关问题可以关注 [Taro 3.2 测试公告](https://github.com/NervJS/taro/issues/8180)。

![](https://wos2.58cdn.com.cn/DeFazYxWvDti/frsupload/d84aad22aa5b1f140b9b186858c3bf81_7la5x-fcodr.gif)

更多细节，请参考 [React Native 端开发教程](../react-native)。

## 团队介绍

58 同城技术委员会前端分会成立于 2016 年，由各个事业群、部门的前端团队联合组成，旨在促进公司内前端领域技术共享交流、协同共建、代码开源，统一技术标准和开发方案，提高公司整体前端基础建设水平，提升各团队之间沟通协作效率。58 也在积极参与开源社区建设，已对外开源 [Fair](https://github.com/wuba/Fair)、[WBBlades](https://github.com/wuba/WBBlades)、[Picasso](https://github.com/wuba/Picasso)、[React Native ECharts](https://github.com/wuba/react-native-echarts) 等多个项目，更多开源请关注：[https://github.com/wuba](https://github.com/wuba)。

## 公司介绍

<Link to="//www.58.com">
  <img src="//storage.jd.com/taro-jd-com/static/58.png" style={{ height: "88px" }} />
</Link>

58 同城作为中国领先的生活服务平台，业务覆盖招聘、房产、汽车、二手、本地生活服务及金融等各个领域。
在用户服务层面，不仅是一个信息交互的平台，更是一站式的生活服务平台，同时也逐步为商家建立全方位的市场营销解决方案。

<Link to="//www.anjuke.com">
  <img src="//pic3.58cdn.com.cn/nowater/fangfe/n_v2bcd2cc376dc54a5e9b0ce864424394f9.png" style={{ height: "88px" }} />
</Link>

安居客是体量领先的优质找房平台，于 2007 年正式创立。以“人人信赖的生活服务平台”为企业愿景，全面覆盖新房、二手房、租房、商业地产、海外地产五大业务。为用户提供房产租售一站式的专业服务，同时为开发商与经纪人提供高效的网络推广平台。

## 58 开源项目

<Link to="//github.com/wuba/fair" style={{display: "inline-block", margin: "0 10px 10px 0"}}>
  <img src="//pic3.58cdn.com.cn/nowater/fangfe/n_v2517a26db956a49d6a915d304c4821958.png" style={{ height: "88px" }} />
</Link>

Fair 是为 Flutter 设计的，UI&模板动态化框架，用于动态更新 Widget Tree。在线文档：[https://fair.58.com/](https://fair.58.com/)。

<Link to="//github.com/wuba/Picasso" style={{display: "inline-block", margin: "0 10px 10px 0"}}>
  <img src="//pic5.58cdn.com.cn/nowater/fangfe/n_v20bf90dff9429494da3544886e0fc3192.png" style={{ height: "88px" }} />
</Link>

Picasso 是 58 同城推出的一款 sketch 设计稿解析插件，可将 sketch 设计稿自动解析成还原精准，可用度高的前端代码。

更多开源请关注：[https://github.com/wuba](https://github.com/wuba)

## 58 技术 官方订阅号

![58技术](https://pic3.58cdn.com.cn/nowater/fangfe/n_v2ebcfb754ae6b48b788a73b8e5743d0bb.jpg)

## 联系方式

chenzhiqing01(at)58.com
</file>

<file path="docs/team/index.mdx">
---
title: 团队介绍
---

import { TeamList } from './components'

## 团队构成

Taro 各个模块的核心开发者。设计并实现 Taro 的核心功能，把控模块的功能规划、特性引入和实现进度，当社区无法达成共识时做出最终决定。

![团队架构图](@site/static/img/team-structure.png)

运行机制包含技术委员会以及下设的 5 个团队（Core 团队、Plugins 团队、Platform 团队、创新团队、社区团队）。技术委员会由技术委员会委员组成，负责技术方向、项目管理、贡献政策、仓库托管、行为准则、维护合作者列表等，技术委员会主席负责定期组织会议。工作组由合作者成员组成，每个方向有一个 Owner，负责相关工作组的开发进展。

### [Core 团队](./team-core)

- **Cli 工作组**
  主要负责 Taro 命令行工具的开发和维护工作。
- **Compile 工作组**
  负责维护、优化小程序和 H5 的编译系统。
- **Runtime 工作组**
  负责维护小程序运行时系统。

### [Plugin 团队](./team-plugin)

负责维护各 Taro 插件，包括端平台插件，React、Vue DevTools 等。

- **端平台插件工作组**
  负责维护各端平台插件，包括对微信、支付宝、百度、字节跳动、QQ、京东、企业微信、飞书、快手、钉钉、小红书等厂商小程序的适配等。
- **混合开发工作组**
  负责维护 Taro 与原生小程序的相互调用功能、Taro 开发原生插件等。

### [Platform 团队](./team-platform)

负责 App、Web、Open Harmony 等跨平台开发。

- **H5 工作组**
  负责维护 H5 的各模块，包括路由、组件库、API 库等。
- **React Native 工作组**
  负责 React Native 适配核心、组件库、API 库等部分的开发。
- **Open Harmony 工作组**
  负责鸿蒙适配核心、组件库、API 库等部分的开发。
- **快应用工作组**

### [创新团队](./team-innovate)

Taro 创新特新、新方向探索，如 wasm、rust、vite、flutter、electron 等。

- **UI 框架兴趣组**
  TaroUI、NutUI 等 UI 库和其他类型生态工具的研发与管理。

### [社区团队](./team-community)

负责 Taro 生态与运营，和 Taro 社区的运营推广工作。

## 战略合作伙伴（联合团队）

共同参与 Taro 的研发和推广，监督 Taro 的发展流程，推动 Taro 在各领域真实业务场景中的落地和实践，促进 Taro 在业界的广泛应用。

<TeamList
  list={[
    {
      href: '//www.58.com/',
      image: '//storage.jd.com/taro-jd-com/static/58.png',
    },
    {
      href: '//www.anjuke.com/',
      image: '//pic3.58cdn.com.cn/nowater/fangfe/n_v2bcd2cc376dc54a5e9b0ce864424394f9.png',
    },
  ]}
/>

Taro 3 React Native 部分由 58 的团队开发。[RN 相关的 RFC 可以关注](https://github.com/NervJS/taro-rfcs/pull/8)

58 同城技术委员会前端分会成立于 2016 年，由各个事业群、部门的前端团队联合组成，旨在促进公司内前端领域技术共享交流、协同共建、代码开源，统一技术标准和开发方案，提高公司整体前端基础建设水平，提升各团队之间沟通协作效率。58 也在积极参与开源社区建设，已对外开源 [Fair](https://github.com/wuba/Fair)、[WBBlades](https://github.com/wuba/WBBlades)、[Picasso](https://github.com/wuba/Picasso)、[React Native ECharts](https://github.com/wuba/react-native-echarts) 等多个项目，更多开源请关注：[https://github.com/wuba](https://github.com/wuba)。

<TeamList
  list={[
    {
      href: '//youshu.tencent.com/',
      image: '//mp.zhls.qq.com/sdk/img/youshu-logo.jpeg',
    },
    {
      href: '//cdc.tencent.com/',
      image: '//storage.jd.com/taro-jd-com/static/cdc.png',
    },
    {
      href: '//cdc.tencent.com/',
      image: '//storage.jd.com/taro-jd-com/static/tencent.png',
    },
    {
      href: '//www.quickapp.cn/',
      image: '//storage.jd.com/taro-jd-com/static/quick.png',
    },
    {
      href: '//smartprogram.baidu.com/developer/index.html',
      image: '//storage.jd.com/taro-jd-com/static/baidu.png',
    },
    {
      href: '//q.qq.com/',
      image: '//storage.jd.com/taro-jd-com/static/qq.png',
    },
    {
      href: '//open.alipay.com/channel/miniIndex.htm',
      image: '//storage.jd.com/taro-jd-com/static/zfb.png',
    },
    {
      href: '//www.midea.cn/',
      image: '//storage.jd.com/taro-jd-com/static/midea.png',
    },
    {
      href: '//www.sxl.cn/',
      image: '//storage.jd.com/taro-jd-com/static/sxl.png',
    },
    {
      image: '//storage.jd.com/taro-jd-com/static/yx.png',
    },
    {
      href: '//www.16888.com/',
      image: '//img12.360buyimg.com/ling/jfs/t1/150151/24/2373/15562/5f05ad52Ec372ce39/80b555a4d0a0a929.png',
    },
    {
      href: '//www.ikandy.cn/',
      image: '//storage.360buyimg.com/taro-resource/team/tx-tech.jpg',
    },
  ]}
/>

## [技术委员会](./role-committee)

负责技术方向、项目管理、项目发布、贡献政策、仓库托管、行为准则、维护合作者列表，定期参加 TSC 活动，主席（主持人）会在线上主持活动，并做好活动记录并公布。

- 技术委员会双周会
  - 时间：每双周周四前，在技术委员会中预告下次会议的内容和日期。
  - 议题：来自 Taro 下各项目中标注了 tsc-agenda 标签的事宜。会议结束后提交[会议纪要](https://tarojs.notion.site/979a8aad451b4316b04878d252073987?v=88c5bbd1d2c0416590a25cefebde1c74)。每次会议可邀请非委会参加，但无投票权。
- 基于共识决策的投票机制 _各个晋升投票环节，基于共识决策原则，原则上达成多数一致。_
  - 待投票的议题需要在会议前周知各成员，给与成员足够调研思考时间
  - 议题在即将达成一致时，在结题前必须询问“有人反对吗？”，以周知最后反对的机会
  - 议题无法达成一致时，可以投票多数支持是否延期到下一个会议，否则必须继续讨论
  - 议题满足“多数胜利”后即可通过，成员可以弃票
- 引导 / 培训机制
  - 助手、合作者和技术委员会成员每个阶段，均提供相应的引导和培训，让新晋升者可以快速开展工作。

## [合作者 & 生态合作者](./role-collaborator)

维护 taro 相关仓库，帮助用户和初级贡献者，参加具体工作组为当前项目贡献代码和文档，评审和评论 issues 和 pull requests。

- 目的
  - 旨在不断丰富 Taro 特性、性能、安全等。
- 权益
  - Github NervJS 组 Member 权限，Github Write 权限，可以提交 commit 到 [NervJS/taro](https://github.com/NervJS/taro) 仓库，可以配置持续集成任务，负责 pull request 评审及合并
  - 1 个 PR 合并需至少 2 名合作者或 1 名技术委员会成员同意即可进入观察期，观察期 3 个月即可正式成为合作者。
- 申请方法
  - 合作者提名有突出贡献的个人贡献者，通过投票机制决定是否可以成为合作者。一名合格的合作者需具备：技术精进，业务精湛；沟通无障碍，至少读写无阻碍；人品优良，能钻研，不轻易半途而废；态度谦逊，能接受他人意见；Owner 心态，积极主动。
  - 申请 pull request 参考模版如下：
    ![PR 模板](https://storage.360buyimg.com/aotu-team/zakary-blog/2022-03-29-Taro-community/PR-Collaborator.png)
- 退出机制
  - 对不活跃的合作者，技术委员会有权进行移除或设置为荣休状态，荣休成员可以重新向技术委员会申请为活跃状态。如果一个合作者超过 6 个月无任何贡献，会自动设置成荣休状态。

## [助手](./role-triage)

负责 taro 相关仓库新 issues 的维护，负责给 issues 或 pull requests 打标签，以及负责评论、关闭和重新开启 issue 或 pull request，负责将 bug 或 feature 分流给具体工作组。

- 目的
  - 旨在减少 issue 列表，保持 issue 及时跟踪，促进新人参与及贡献 pull request。
- 权益
  - Github NervJS 组 Member 权限，相关项目 Triage 权限，可以管理 issues 和 pull requests（没有写权限）。
- 申请方法
  - 对 Taro 项目有全面了解和深度开发经验的任何人，可以在 NervJS/taro README.md 中提交一个 pull request，说明申请成为助手的动机并同意本项目的行为守则，经 2 名合作者同意即可通过。
  - 申请 pull request 参考模版如下：
    ![PR 模板](https://storage.360buyimg.com/aotu-team/zakary-blog/2022-03-29-Taro-community/PR-Triage.png)
- 退出机制
  - 对 6 个月不活跃的小助手进行定期移除。

## [个人贡献者](./role-committer)

感谢为 Taro 贡献过代码的每一位开发者。

[![contributors](https://opencollective.com/taro/contributors.svg?width=890&button=false)](https://github.com/NervJS/taro/graphs/contributors)

## 特别鸣谢

| [![nanjingboy](https://avatars1.githubusercontent.com/u/1390888?s=100&v=4)](https://github.com/nanjingboy/) | [![jsNewbee](https://avatars3.githubusercontent.com/u/20449400?s=100&v=4)](https://github.com/js-newbee/) | [![Qiyu8](https://avatars2.githubusercontent.com/u/15245051?s=100&v=4)](https://github.com/Qiyu8/) | [![Garfield550](https://avatars2.githubusercontent.com/u/3471836?s=100&v=4)](https://github.com/Garfield550/) | [![zhiqingchen](https://avatars3.githubusercontent.com/u/1876158?s=100&v=4)](https://github.com/zhiqingchen) |
| :---------------------------------------------------------------------------------------------------------: | :-------------------------------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------------------: | :-----------------------------------------------------------------------------------------------------------: | :----------------------------------------------------------------------------------------------------------: |
|                                [nanjingboy](https://github.com/nanjingboy/)                                 |                                 [jsNewbee](https://github.com/js-newbee/)                                 |                                 [Qiyu8](https://github.com/Qiyu8/)                                 |                                [Garfield Lee](https://github.com/Garfield550/)                                |                                [zhiqingchen](https://github.com/zhiqingchen)                                 |
</file>

<file path="docs/team/role-collaborator.mdx">
---
title: 合作者
---

import { ListPage } from './components'

负责维护 [NervJS/taro](https://github.com/NervJS/taro)、[NervJS/taro-ui](https://github.com/NervJS/taro-ui) 仓库，帮助用户和初级贡献者，参加具体工作组为当前项目贡献代码和文档，评审和评论 issues 和 pull requests。

## 成员

<ListPage type="role" role="173f3699-4a3f-4af4-bd8d-c8b47a0d2ca9" name="合作者" full />

## 荣誉成员

我们也要感谢所有过去的成员，感谢他们的宝贵贡献！

<ListPage type="role" role="173f3699-4a3f-4af4-bd8d-c8b47a0d2ca9" name="合作者" alumni full />
</file>

<file path="docs/team/role-committee.mdx">
---
title: 技术委员会
---

import { ListPage } from './components'

负责技术方向、项目管理、项目发布、贡献政策、仓库托管、行为准则、维护合作者列表，定期参加 TSC 活动，主席（主持人）会在线上主持活动，并做好活动记录并公布。

## 成员

<ListPage type="role" role="71ff4a6e-5b97-4c7d-937b-806d1dd662ac" name="技术委员会" full />

## 荣誉成员

我们也要感谢所有过去的成员，感谢他们的宝贵贡献！

<ListPage type="role" role="71ff4a6e-5b97-4c7d-937b-806d1dd662ac" name="技术委员会" alumni full />
</file>

<file path="docs/team/role-committer.mdx">
---
title: 贡献者
---

import { ListPage } from './components'

感谢为 Taro 贡献过代码的每一位开发者。

## 成员

<ListPage type="role" role="7c557d2c-e604-45a3-8680-05867408143c" name="贡献者" full />

## 荣誉成员

我们也要感谢所有过去的成员，感谢他们的宝贵贡献！

<ListPage type="role" role="7c557d2c-e604-45a3-8680-05867408143c" name="贡献者" alumni full />
</file>

<file path="docs/team/role-triage.mdx">
---
title: 社区助手
---

import { ListPage } from './components'

负责 taro 相关仓库新 issues 的维护，负责给 issues 或 pull requests 打标签，以及负责评论、关闭和重新开启 issue 或 pull request，负责将 bug 或 feature 分流给具体工作组。

## 成员

<ListPage type="role" role="47959165-618b-4fa7-83a9-6a25a2c82b56" name="助手" full />

## 荣誉成员

我们也要感谢所有过去的成员，感谢他们的宝贵贡献！

<ListPage type="role" role="47959165-618b-4fa7-83a9-6a25a2c82b56" name="助手" alumni full />
</file>

<file path="docs/team/team-community.mdx">
---
title: 社区团队
---

import { ListPage } from './components'

负责 Taro 生态与运营，和 Taro 社区的运营推广工作。

## 成员

<ListPage type="team" team="e3ff4b01-9ab6-482a-abfe-feb19a421e73" full />

## 荣誉成员

我们也要感谢所有过去的成员，感谢他们的宝贵贡献！

<ListPage type="team" team="e3ff4b01-9ab6-482a-abfe-feb19a421e73" alumni full />
</file>

<file path="docs/team/team-core.mdx">
---
title: Core 团队
---

import { ListPage } from './components'

## 成员

<ListPage type="team" team="1db056fc-165e-4209-bf2d-442530065e78" full />

### Cli 工作组

主要负责 Taro 命令行工具的开发和维护工作。

### Compile 工作组

负责维护、优化小程序和 H5 的编译系统。

### Runtime 工作组

负责维护小程序运行时系统。

## 荣誉成员

我们也要感谢所有过去的成员，感谢他们的宝贵贡献！

<ListPage type="team" team="1db056fc-165e-4209-bf2d-442530065e78" alumni full />
</file>

<file path="docs/team/team-innovate.mdx">
---
title: 创新团队
---

import { ListPage } from './components'

Taro 创新特新、新方向探索，如 wasm、rust、vite、flutter、electron 等。

## 成员

<ListPage type="team" team="f154527a-8950-4e92-8f3e-49ef5cd3e866" full />

### UI 框架兴趣组

TaroUI、NutUI 等 UI 库和其他类型生态工具的研发与管理。

## 荣誉成员

我们也要感谢所有过去的成员，感谢他们的宝贵贡献！

<ListPage type="team" team="f154527a-8950-4e92-8f3e-49ef5cd3e866" alumni full />
</file>

<file path="docs/team/team-platform.mdx">
---
title: Platform 团队
---

import { ListPage } from './components'

负责 App、Web、Open Harmony 等跨平台开发。

## 成员

<ListPage type="team" team="938a3f82-1e7e-4993-8d16-3ee2022706d1" full />

### H5 工作组

负责维护 H5 的各模块，包括路由、组件库、API 库等。

### React Native 工作组

负责 React Native 适配核心、组件库、API 库等部分的开发。

### Open Harmony 工作组

负责鸿蒙适配核心、组件库、API 库等部分的开发。

### 快应用工作组

## 荣誉成员

我们也要感谢所有过去的成员，感谢他们的宝贵贡献！

<ListPage type="team" team="938a3f82-1e7e-4993-8d16-3ee2022706d1" alumni full />
</file>

<file path="docs/team/team-plugin.mdx">
---
title: Plugin 团队
---

import { ListPage } from './components'

负责维护各 Taro 插件，包括端平台插件，React、Vue DevTools 等。

## 成员

<ListPage type="team" team="f154527a-8950-4e92-8f3e-49ef5cd3e866" full />

### 端平台插件工作组

负责维护各端平台插件，包括对微信、支付宝、百度、字节跳动、QQ、京东、企业微信、飞书、快手、钉钉、小红书等厂商小程序的适配等。

### 混合开发工作组

负责维护 Taro 与原生小程序的相互调用功能、Taro 开发原生插件等。

## 荣誉成员

我们也要感谢所有过去的成员，感谢他们的宝贵贡献！

<ListPage type="team" team="f154527a-8950-4e92-8f3e-49ef5cd3e866" alumni full />
</file>

<file path="docs/test-utils/fire-event.md">
---
title: 事件相关 API
---

## fireEvent

`@tarojs/test-utils`目的是关注组件的**用户行为和外部表现，而不是内部实现细节**，所以无论是**vue**还是**react**，本质都是在渲染完成后，通过触发元素的事件，从而响应到内部实现的回调函数。
`fireEvent`内置了常用的事件触发器，通过获取元素 => 触发事件 => 事件响应 来对测试结果进行断言。

### 内置事件

```js
// 获取元素
const ele = testUtils.queries.querySelector('input')
// 触发keyPress事件
testUtils.fireEvent.keyPress(ele, {
  key: 'A',
  code: 'A',
})
```

```ts
export interface FireEvent {
  // Clipboard Events
  copy(ele: Element, params?: ClipboardEventInit): void
  cut(ele: Element, params?: ClipboardEventInit): void
  paste(ele: Element, params?: ClipboardEventInit): void
  // Composition Events
  compositionEnd(ele: Element, params?: CompositionEventInit): void
  compositionStart(ele: Element, params?: CompositionEventInit): void
  compositionUpdate(ele: Element, params?: CompositionEventInit): void
  // Keyboard Events
  keyDown(ele: Element, params?: KeyboardEventInit): void
  keyPress(ele: Element, params?: KeyboardEventInit): void
  keyUp(ele: Element, params?: KeyboardEventInit): void
  // Focus Events
  focus(ele: Element, params?: FocusEventInit): void
  blur(ele: Element, params?: FocusEventInit): void
  focusIn(ele: Element, params?: FocusEventInit): void
  focusOut(ele: Element, params?: FocusEventInit): void
  // Form Events
  change(ele: Element, params?: EventInit): void
  input(ele: Element, params?: InputEventInit): void
  invalid(ele: Element, params?: EventInit): void
  submit(ele: Element, params?: EventInit): void
  reset(ele: Element, params?: EventInit): void
  // Mouse Events
  click(ele: Element, params?: MouseEventInit): void
  contextMenu(ele: Element, params?: MouseEventInit): void
  dblClick(ele: Element, params?: MouseEventInit): void
  doubleClick(ele: Element, params?: MouseEventInit): void
  drag(ele: Element, params?: MouseEventInit): void
  dragEnd(ele: Element, params?: MouseEventInit): void
  dragEnter(ele: Element, params?: MouseEventInit): void
  dragExit(ele: Element, params?: MouseEventInit): void
  dragLeave(ele: Element, params?: MouseEventInit): void
  dragOver(ele: Element, params?: MouseEventInit): void
  drop(ele: Element, params?: MouseEventInit): void
  mouseDown(ele: Element, params?: MouseEventInit): void
  mouseEnter(ele: Element, params?: MouseEventInit): void
  mouseLeave(ele: Element, params?: MouseEventInit): void
  mouseMove(ele: Element, params?: MouseEventInit): void
  mouseOut(ele: Element, params?: MouseEventInit): void
  mouseOver(ele: Element, params?: MouseEventInit): void
  mouseUp(ele: Element, params?: MouseEventInit): void
  // Selection Events
  select(ele: Element, params?: EventInit): void
  // Touch Events
  touchCancel(ele: Element, params?: TouchEventInit): void
  touchEnd(ele: Element, params?: TouchEventInit): void
  touchMove(ele: Element, params?: TouchEventInit): void
  touchStart(ele: Element, params?: TouchEventInit): void
  // UI Events
  resize(ele: Element, params?: UIEventInit): void
  scroll(ele: Element, params?: UIEventInit): void
  // Wheel Events
  wheel(ele: Element, params?: WheelEventInit): void
  // Media Events
  abort(ele: Element, params?: EventInit): void
  canPlay(ele: Element, params?: EventInit): void
  canPlayThrough(ele: Element, params?: EventInit): void
  durationChange(ele: Element, params?: EventInit): void
  emptied(ele: Element, params?: EventInit): void
  encrypted(ele: Element, params?: EventInit): void
  ended(ele: Element, params?: EventInit): void
  loadedData(ele: Element, params?: EventInit): void
  loadedMetadata(ele: Element, params?: EventInit): void
  loadStart(ele: Element, params?: ProgressEventInit): void
  pause(ele: Element, params?: EventInit): void
  play(ele: Element, params?: EventInit): void
  playing(ele: Element, params?: EventInit): void
  progress(ele: Element, params?: ProgressEventInit): void
  rateChange(ele: Element, params?: EventInit): void
  seeked(ele: Element, params?: EventInit): void
  seeking(ele: Element, params?: EventInit): void
  stalled(ele: Element, params?: EventInit): void
  suspend(ele: Element, params?: EventInit): void
  timeUpdate(ele: Element, params?: EventInit): void
  volumeChange(ele: Element, params?: EventInit): void
  waiting(ele: Element, params?: EventInit): void
  // Events
  load(ele: Element, params?: EventInit): void
  error(ele: Element, params?: EventInit): void
  // Animation Events
  animationStart(ele: Element, params?: AnimationEventInit): void
  animationEnd(ele: Element, params?: AnimationEventInit): void
  animationIteration(ele: Element, params?: AnimationEventInit): void
  // Transition Events
  transitionCancel(ele: Element, params?: TransitionEventInit): void
  transitionEnd(ele: Element, params?: TransitionEventInit): void
  transitionRun(ele: Element, params?: TransitionEventInit): void
  transitionStart(ele: Element, params?: TransitionEventInit): void
  // pointer events
  pointerOver(ele: Element, params?: PointerEventInit): void
  pointerEnter(ele: Element, params?: PointerEventInit): void
  pointerDown(ele: Element, params?: PointerEventInit): void
  pointerMove(ele: Element, params?: PointerEventInit): void
  pointerUp(ele: Element, params?: PointerEventInit): void
  pointerCancel(ele: Element, params?: PointerEventInit): void
  pointerOut(ele: Element, params?: PointerEventInit): void
  pointerLeave(ele: Element, params?: PointerEventInit): void
  gotPointerCapture(ele: Element, params?: PointerEventInit): void
  lostPointerCapture(ele: Element, params?: PointerEventInit): void
  // history events
  popState(ele: Element, params?: PopStateEventInit): void
  // window events
  offline(ele: Element, params?: EventInit): void
  online(ele: Element, params?: EventInit): void
}
```

### 构造事件

除了上述的内置事件外，我们也可以通过`new Event()`来构造一个新的事件类型

```ts
function fireEvent(ele: Element, event: Event)
```

使用案例：

```js
// 获取元素
const ele = testUtils.queries.querySelector('.text')
// 触发一个心的事件
testUtils.fireEvent(ele, new Event())
testUtils.fireEvent(ele, new PointerEvent())
```
</file>

<file path="docs/test-utils/index.md">
---
title: 概述
---

> 对 Taro 进行组件/应用级别的单元测试

该测试工具**更加关注组件的用户行为和外部表现，而不是内部实现细节**

Github 地址：[传送门](https://github.com/NervJS/taro-test-utils)

## 安装

在 Taro 项目根目录下安装

```bash
# React:
npm i @tarojs/test-utils-react --save
# Vue3:
npm i @tarojs/test-utils-vue3 --save
# Vue2:
npm i @tarojs/test-utils-vue --save
```

:::warning 注意
`@tarojs/plugin-platform-h5`为前置 peerDependencies，请勿删除该依赖申明
:::

## 使用

### 安装 Jest

```bash
npm i jest --save
```

### 配置 Jest

在 Taro 项目根目录添加文件`jest.config.js`。配置文件如下：

```js
// react
const defineJestConfig = require('@tarojs/test-utils-react/dist/jest.js').default
// vue3
// const defineJestConfig = require("@tarojs/test-utils-vue3/dist/jest.js").default;
// vue2
// const defineJestConfig = require("@tarojs/test-utils-vue/dist/jest.js").default;

module.exports = defineJestConfig({
  // testEnvironment: 'jsdom',  // 测试使用的环境
  // testMatch: ['<rootDir>/__test__/**/*.test.{js,ts}'],  // 测试文件匹配
})
```

`defineJestConfig` 已内置了部分初始化配置，需要修改可自行配置覆盖
配置文件参考 Jest 官网：[Configuring Jest](https://jestjs.io/docs/configuration)

### 编写测试用例

#### 组件级别

```javascript
// __test__/main/index.test.js
import TestUtils from '@tarojs/test-utils-react'
import Hello from '../../src/components/Hello.tsx'
const testUtils = new TestUtils()
describe('App', () => {
  it('RenderComponent', async () => {
    // React跟Vue相同用法
    await testUtils.mount(Hello, {
      props: {
        // 配置项
        a: 1,
      },
    })
    // 等待页面出现.btn这个节点
    const btn = await testUtils.queries.waitForQuerySelector('.btn')
    // 等待react的渲染更新完成
    await testUtils.act(() => {
      // 触发点击事件
      testUtils.fireEvent.click(btn)
    })
    // 打印渲染结果
    expect(testUtils.html()).toMatchSnapshot()
    // <div class="hello">...
  })
})
```

#### 运行测试

```bash
# package.json
# scripts: {
#   "test": "jest",
# }
npm run test
```

#### 应用级别

```javascript
// __test__/main/index.test.js
import TestUtils from '@tarojs/test-utils-react'
import Taro from '@tarojs/taro'
import App from '../../src/app.ts'
const testUtils = new TestUtils()
describe('App', () => {
  it('RenderApp', async () => {
    await testUtils.createApp()
    // 监听/pages/index/index这个页面路由的onShow生命周期触发
    await testUtils.PageLifecycle.onShow('/pages/index/index')
    // 跳转到第二个页面
    Taro.navigateTo({ url: '/pages/second/index' })
    // 监听/pages/second/index这个页面路由的onShow生命周期触发
    await testUtils.PageLifecycle.onShow('/pages/second/index')
    // 当/pages/second/index触发onShow后，打印页面内容
    expect(testUtils.html()).toMatchSnapshot()
    // <body><div class="taro_router" id="app">...
  })
})
```

## 多端

对于小程序的测试，我们提供了环境变量对 Jest 环境进行区分：`TARO_ENV_JEST`，我们可以在调用 jest 测试时设置对应的环境变量

```js
// package.json
scripts: {
  "test": "jest",
   "test:weapp": "export TARO_ENV_JEST=weapp && jest"
}
```

这里会有几点差异：

- **环境差异**

这里会将运行代码中的`process.env.TARO_ENV`切换为`TARO_ENV_JEST`的值，主要用于一些"环境判断"比如下面的代码将会在`test:weapp`执行:

```js
if (process.env.TARO_ENV === 'weapp') {
  // ....setState(....)
  console.log('this is weapp')
}
```

- **标签差异**

除此之外`html()`输出的节点内容也会改变，将以小程序标签的形式输出，例如:

```html
<!-- h5 -->
<taro-core-view className="cls">
  <taro-image-view src="xxx">
    <img src="xxx" />
  </taro-image-view>
</taro-core-view>

<!-- weapp -->
<view className="cls">
  <image src="xxx" />
</view>
```

---

因为这是一个在线运行的测试工具，主要目的也是对用户行为和外部表现进行测试断言，**在测试环境使用的还是以 h5 的形式来模拟整个程序的运行**，对于其他小程序特有的生命周期和 API，我们推荐以下做法：

- **生命周期**： 使用`PageLifecycle`的`triggerXxxxx`进行生命周期的触发
- **API**： 使用`jest`提供的`mock`方法来模拟`@tarojs/taro`的 api，模拟小程序的返回值
</file>

<file path="docs/test-utils/life-cycle.md">
---
title: 生命周期 API
---

生命周期监听，这里会在对应**生命周期事件执行完成后，下次渲染前执行**，说白了就是一个"after lifecycle"的钩子

## AppLifecycle

> APP 生命周期

对应生命周期的说明可以参考官网：[传送门](/docs/react-entry)

### onLaunch

监听 onLaunch 生命周期执行回调

```ts
function onLaunch(): Promise<void>
```

用法：

```ts
// 等待onLaunch响应完成
await testUtils.AppLifecycle.onLaunch()
```

### onShow

程序启动，或切前台时触发

监听 onShow / componentDidShow 生命周期执行回调

```ts
function onShow(): Promise<void>
```

用法：

```ts
// 等待onShow响应完成
await testUtils.AppLifecycle.onShow()
```

### onHide

程序切后台时触发

监听 onHide / componentDidHide 生命周期执行回调

```ts
function onHide(): Promise<void>
```

用法：

```ts
// 等待onHide响应完成
await testUtils.AppLifecycle.onHide()
```

### onError

小程序发生脚本错误或 API 调用报错时触发。

```ts
function onError(): Promise<Error>
```

用法：

```ts
// 等待onError响应完成
await testUtils.AppLifecycle.onError()
```

### onPageNotFound

程序要打开的页面不存在时触发。

```ts
function onPageNotFound(): Promise<{ path: string; query: object; isEntryPage: boolean }>
```

回调参数：

| 属性        | 类型    | 说明                                                                           |
| ----------- | ------- | ------------------------------------------------------------------------------ |
| path        | string  | 不存在页面的路径                                                               |
| query       | Object  | 打开不存在页面的 query 参数                                                    |
| isEntryPage | boolean | 是否本次启动的首个页面（例如从分享等入口进来，首个页面是开发者配置的分享页面） |

用法：

```ts
// 等待onPageNotFound响应完成
await testUtils.AppLifecycle.onPageNotFound()
```

### onUnhandledRejection

小程序有未处理的 Promise 拒绝时触发。

```ts
function onUnhandledRejection(): Promise<{ reason: string; promise: Promise<unknown> }>
```

回调参数：
<<<<<<< HEAD

| 属性    | 类型    | 说明                            |
| ------- | ------- | ------------------------------- |
| reason  | string  | 拒绝原因，一般是一个 Error 对象 |
| promise | Promise | 被拒绝的 Promise 对象           |

=======
| 属性 | 类型 | 说明 |
| ------- | ------- | ------------------------------- |
| reason | string | 拒绝原因，一般是一个 Error 对象 |
| promise | Promise | 被拒绝的 Promise 对象 |

> > > > > > > master

用法：

```ts
// 等待onUnhandledRejection响应完成
await testUtils.AppLifecycle.onUnhandledRejection()
```

## PageLifecycle

> Page 生命周期

页面级别的生命周期使用方式与`AppLifecycle`类似，除了用于监听的`onXXX`外，页面级别的生命周期 api 还提供了`triggerXXX`用于模拟触发一些特定的生命周期。
比如`onReachBottom`，需要触发它的条件需要监听用户上拉触底的事件，我们写事件去模拟比较麻烦，所以我们干脆提供了`triggerReachBottom`给用户在测试时可直接触发到`onReachBottom`这个生命周期。

对应生命周期的说明可以参考官网：[传送门](https://docs.taro.zone/docs/react-page)

用法：

```js
// 等待pages/index/index这个路由页面展示
await testUtils.PageLifecycle.onShow('pages/index/index')
// 手动触发onReachBottom事件
testUtils.PageLifecycle.triggerReachBottom()
// 等待onReachBottom响应完成
await testUtils.PageLifecycle.onReachBottom()
```

| 方法                                                             | 说明                                                                                                     |
| ---------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- |
| onLoad(path: string)                                             | 在此生命周期中通过访问 options 参数或调用 getCurrentInstance().router，可以访问到页面路由参数。          |
| onUnload(path: string)                                           | 在小程序环境中对应页面的 onUnload。                                                                      |
| onShow(path: string)                                             | 页面显示/切入前台时触发。                                                                                |
| onHide(path: string)                                             | 页面隐藏/切入后台时触发。                                                                                |
| onReady(path: string)                                            | 从此生命周期开始可以使用 createCanvasContext 或 createSelectorQuery 等 API 访问小程序渲染层的 DOM 节点。 |
| onPullDownRefresh(path: string)                                  | 监听用户下拉动作                                                                                         |
| triggerPullDownRefresh(path: string)                             | 触发`onPullDownRefresh`生命周期                                                                          |
| onReachBottom(path: string)                                      | 监听用户上拉触底事件                                                                                     |
| triggerReachBottom(path: string)                                 | 触发`onReachBottom`生命周期                                                                              |
| onPageScroll(path: string)                                       | 监听用户滑动页面事件                                                                                     |
| triggerPageScroll(path: string, opt: PageScrollObject)           | 触发`onPageScroll`生命周期                                                                               |
| onAddToFavorites(path: string)                                   | 监听用户点击右上角菜单“收藏”按钮的行为，并自定义收藏内容                                                 |
| triggerAddToFavorites(path: string)                              | 触发`onAddToFavorites`生命周期                                                                           |
| onShareAppMessage(path: string)                                  | 监听用户点击页面内转发按钮（Button 组件 openType='share'）或右上角菜单“转发”按钮的行为，并自定义转发内容 |
| triggerShareAppMessage(path: string, opt: ShareAppMessageObject) | 触发`onShareAppMessage`生命周期                                                                          |
| onShareTimeline(path: string)                                    | 监听右上角菜单“分享到朋友圈”按钮的行为，并自定义分享内容                                                 |
| triggerShareTimeline(path: string)                               | 触发`onShareTimeline`生命周期                                                                            |
| onResize(path: string)                                           | 监听屏幕旋转时                                                                                           |
| triggerResize(path: string, opt: PageResizeObject)               | 触发`onResize`生命周期                                                                                   |
| onTabItemTap(path: string)                                       | 点击 tab 时触发                                                                                          |
| triggerTabItemTap(path: string, opt: TabItemTapObject)           | 触发`onTabItemTap`生命周期                                                                               |
| onSaveExitState(path: string)                                    | 每当小程序可能被销毁之前，页面回调函数 onSaveExitState 会被调用，可以进行退出状态的保存                  |
| triggerSaveExitState(path: string)                               | 触发`onSaveExitState`生命周期                                                                            |
| onTitleClick(path: string)                                       | 点击标题触发                                                                                             |
| triggerTitleClick(path: string)                                  | 触发`onTitleClick`生命周期                                                                               |
| onOptionMenuClick(path: string)                                  | 点击导航栏额外图标触发                                                                                   |
| triggerOptionMenuClick(path: string)                             | 触发`onOptionMenuClick`生命周期                                                                          |
| onPopMenuClick(path: string)                                     |                                                                                                          |
| triggerPopMenuClick(path: string)                                | 触发`onPopMenuClick`生命周期                                                                             |
| onPullIntercept(path: string)                                    | 下拉截断时 onPullIntercept 触发                                                                          |
| triggerPullIntercept(path: string)                               | 触发`onPageScroll`生命周期                                                                               |
</file>

<file path="docs/test-utils/other.md">
---
title: 辅助类 API
---

## html

```ts
function html(): string
```

将页面表现的文档内容进行格式化输出，通常用作快照对比、调试

用法：

```js
import testUtils from '@tarojs/test-utils-react' // react
// import testUtils from '@tarojs/test-utils-vue3' // vue3
describe('测试mount', () => {
  test('View', async () => {
    const testUtils = new TestUtils()
    await testUtils.mount(View)
    const htmlString = testUtils.html() // 输出文档字符串内容
    expect(htmlString).toMatchSnapshot() // 可以用于快照对比
  })
})
```

## act

```ts
async function act(): Promise
```

**React**同`react-dom/test-utils`提供的`act`，**Vue**则使用的是`await nextTick`回调进行封装

用法：

```js
import testUtils from '@tarojs/test-utils-react' // react
// import testUtils from '@tarojs/test-utils-vue3' // vue3
describe('Testing', () => {
  test('test', async () => {
    const testUtils = new TestUtils()
    await testUtils.mount(View)
    // 等待回调执行完成，并且更新结束
    await testUtils.act(() => {
      testUtils.fireEvent.click(testUtils.queries.querySelector('.btn'))
    })
  })
})
```
</file>

<file path="docs/test-utils/queries.md">
---
title: 查询相关 API
---

## 类型说明

TWaitforParams：

| 属性                    | 类型                 | 必须 | 默认值                                                                   | 说明            |
| ----------------------- | -------------------- | ---- | ------------------------------------------------------------------------ | --------------- | ---------------- |
| container               | HTMLElement          |      |                                                                          | window.document | 查询的 root 节点 |
| timeout                 | number               |      | 1000                                                                     | 失效时间        |
| interval                | number               |      | 50                                                                       | 查询间隔        |
| mutationObserverOptions | MutationObserverInit |      | {subtree: true, childList: true, attributes: true, characterData: true } | 监听器参数      |

## 按照选择器查询

### querySelector

```typescript
function querySelector(selectors: string): HTMLElement
```

参数：

| 参数      | 类型   | 必须 | 说明                                  |
| --------- | ------ | ---- | ------------------------------------- |
| selectors | string | 是   | 选择器，同 docuemt.querySelector 一致 |

用法：

```js
const btns = testUtils.queries.querySelectorAll('.btns')
```

### querySelectorAll

```typescript
function querySelectorAll(selectors: string): HTMLElement[]
```

参数：

| 参数      | 类型   | 必须 | 说明                                     |
| --------- | ------ | ---- | ---------------------------------------- |
| selectors | string | 是   | 选择器，同 docuemt.querySelectorAll 一致 |

用法：

```js
const btns = testUtils.queries.querySelectorAll('.btns')
```

### waitForQuerySelector

```typescript
async function waitForQuerySelector(selectors: string, params?: TParams): Promise<HTMLElement>
```

参数：

| 参数      | 类型           | 必须 | 说明                                  |
| --------- | -------------- | ---- | ------------------------------------- |
| selectors | string         | 是   | 选择器，同 docuemt.querySelector 一致 |
| params    | TWaitforParams |      | 参数：见 TWaitforParams 说明          |

用法：

```js
const btn = await testUtils.queries.waitForQuerySelector('.async-btn')
```

### waitForQuerySelectorAll

```typescript
async function waitForQuerySelectorAll(selectors: string, params?: TParams): Promise<HTMLElement[]>
```

参数：

| 参数      | 类型           | 必须 | 说明                                     |
| --------- | -------------- | ---- | ---------------------------------------- |
| selectors | string         | 是   | 选择器，同 docuemt.querySelectorAll 一致 |
| params    | TWaitforParams |      | 参数：见 TWaitforParams 说明             |

用法：

```js
const btns = await testUtils.queries.waitForQuerySelectorAll('.async-btns')
```

## 按照文本查询

### queryByText

```typescript
function queryByText(text: string, selector?: string): HTMLElement
```

参数：

| 参数     | 类型   | 必须 | 说明                                  |
| -------- | ------ | ---- | ------------------------------------- |
| text     | string | 是   | 文本内容，部分匹配即可                |
| selector | string |      | 选择器，同 docuemt.querySelector 一致 |

用法：

```js
// <Text>Hello World!!!</Text>
const textView = testUtils.queries.queryByText('Hello World')
```

### queryByTextAll

```typescript
function queryAllByText(text: string, selector?: string): HTMLElement[]
```

参数：

| 参数     | 类型   | 必须 | 说明                                  |
| -------- | ------ | ---- | ------------------------------------- |
| text     | string | 是   | 文本内容，部分匹配即可                |
| selector | string |      | 选择器，同 docuemt.querySelector 一致 |

用法：

```js
// <Text>Hello World!!</Text>
// <View>Hello World!!!</View>
const textViews = testUtils.queries.queryAllByText('Hello World')
```

### waitForQueryByText

```typescript
async function waitForQueryByText(text: string, selector?: string, params?: TWaitforParams): HTMLElement
```

参数：

| 参数     | 类型           | 必须 | 说明                                  |
| -------- | -------------- | ---- | ------------------------------------- |
| text     | string         | 是   | 文本内容，部分匹配即可                |
| selector | string         |      | 选择器，同 docuemt.querySelector 一致 |
| params   | TWaitforParams |      | 参数：见 TWaitforParams 说明          |

用法：

```js
// <Text>Hello World!!!</Text>
const textView = async testUtils.queries.waitForQueryByText("Hello World");
```

### waitForQueryAllByText

```typescript
async function waitForQueryAllByText(text: string, selector?: string, params?: TWaitforParams): HTMLElement[]
```

参数：

| 参数     | 类型           | 必须 | 说明                                  |
| -------- | -------------- | ---- | ------------------------------------- |
| text     | string         | 是   | 文本内容，部分匹配即可                |
| selector | string         |      | 选择器，同 docuemt.querySelector 一致 |
| params   | TWaitforParams |      | 参数：见 TWaitforParams 说明          |

用法：

```js
// <Text>Hello World!!</Text>
// <View>Hello World!!!</View>
const textViews = async testUtils.queries.waitForQueryAllByText("Hello World");
```

## 按照 Placeholder 查询

### queryByPlaceholder

```typescript
function queryByPlaceholder(text: string): HTMLElement
```

参数：

| 参数 | 类型   | 必须 | 说明             |
| ---- | ------ | ---- | ---------------- |
| text | string | 是   | placeholder 内容 |

用法：

```js
// <input placeholder="hello" />
const input = testUtils.queries.queryByPlaceholder('hello')
```

### queryAllByPlaceholder

```typescript
function queryAllByPlaceholder(text: string): HTMLElement[]
```

参数：

| 参数 | 类型   | 必须 | 说明             |
| ---- | ------ | ---- | ---------------- |
| text | string | 是   | placeholder 内容 |

用法：

```js
// <input placeholder="hello" />
// <input placeholder="hello" />
const inputs = testUtils.queries.queryAllByPlaceholder('hello')
```

### waitForQueryByPlaceholder

```typescript
async function waitForQueryByPlaceholder(text: string, params?: TParams): Promise<HTMLElement>
```

参数：

| 参数   | 类型           | 必须 | 说明                         |
| ------ | -------------- | ---- | ---------------------------- |
| text   | string         | 是   | placeholder 内容             |
| params | TWaitforParams |      | 参数：见 TWaitforParams 说明 |

用法：

```js
// <input placeholder="async-placeholde" />
const input = await testUtils.queries.waitForQueryByPlaceholder('async-placeholder')
```

### waitForQueryAllByPlaceholder

```typescript
async function waitForQueryAllByPlaceholder(text: string, params?: TParams): Promise<HTMLElement[]>
```

参数：

| 参数   | 类型           | 必须 | 说明                         |
| ------ | -------------- | ---- | ---------------------------- |
| text   | string         | 是   | placeholder 内容             |
| params | TWaitforParams |      | 参数：见 TWaitforParams 说明 |

用法：

```js
// <input placeholder="async-placeholde" />
// <input placeholder="async-placeholde" />
const inputs = await testUtils.queries.waitForQueryAllByPlaceholder('async-placeholder')
```

## 按照属性查询

### queryByAttribute

```typescript
function queryByAttribute(attr: string, value: any): HTMLElement
```

参数：

| 参数  | 类型   | 必须 | 说明       |
| ----- | ------ | ---- | ---------- |
| attr  | string | 是   | 属性 key   |
| value | any    | 是   | 属性 value |

用法：

```js
// <div key="value" />
const view = testUtils.queries.queryByAttribute('key', 'value')
```

### queryAllByAttribute

```typescript
function queryAllByAttribute(attr: string, value: any): HTMLElement[]
```

参数：

| 参数  | 类型   | 必须 | 说明       |
| ----- | ------ | ---- | ---------- |
| attr  | string | 是   | 属性 key   |
| value | any    | 是   | 属性 value |

用法：

```js
// <div key="value" />
// <div key="value" />
const view = testUtils.queries.queryAllByAttribute('key', 'value')
```

### waitForQueryByAttribute

```typescript
async function waitForQueryByAttribute(attr: string, value: string, params?: TParams): Promise<HTMLElement>
```

参数：

| 参数   | 类型           | 必须 | 说明                         |
| ------ | -------------- | ---- | ---------------------------- |
| attr   | string         | 是   | 属性 key                     |
| value  | any            | 是   | 属性 value                   |
| params | TWaitforParams |      | 参数：见 TWaitforParams 说明 |

用法：

```js
// <div key="value" />
const view = await testUtils.queries.waitForQueryByAttribute('key', 'value')
```

### waitForQueryAllByAttribute

```typescript
async function waitForQueryAllByAttribute(attr: string, value: string, params?: TParams): Promise<HTMLElement[]>
```

参数：

| 参数   | 类型           | 必须 | 说明                         |
| ------ | -------------- | ---- | ---------------------------- |
| attr   | string         | 是   | 属性 key                     |
| value  | any            | 是   | 属性 value                   |
| params | TWaitforParams |      | 参数：见 TWaitforParams 说明 |

用法：

```js
// <div key="value" />
// <div key="value" />
const inputs = await testUtils.queries.waitForQueryAllByAttribute('key', 'value')
```
</file>

<file path="docs/test-utils/render.md">
---
title: 渲染相关 API
---

## mount

> 组件挂载

```js
async mount(component, params);
```

| 参数      | 类型                                | 必须 | 说明           |
| --------- | ----------------------------------- | ---- | -------------- |
| component | FunctionComponent \| ClassComponent | 是   | 需要挂载的组件 |
| params    | TParams                             |      | 参数           |

params 类型 `TParams`

| 参数        | 类型        | 必须 | 默认值        | 说明           | 备注     |
| ----------- | ----------- | ---- | ------------- | -------------- | -------- |
| props       | Object      |      | {}            | props 入参     |
| slots       | Object      |      | {}            | slots 入参     | vue 特有 |
| container   | HTMLElement |      | div           | 挂载容器节点   |
| baseElement | HTMLElement |      | document.body | 打印出来的节点 |
| baseElement | HTMLElement |      | document.body | 打印出来的节点 |

用法：

```js
import testUtils from '@tarojs/test-utils-react' // react
// import testUtils from '@tarojs/test-utils-vue3' // vue3
describe('测试mount', () => {
  test('View', async () => {
    const testUtils = new TestUtils()
    await testUtils.mount(View, {
      props: {
        className: 'className',
        children: 'Child Text!',
      },
      // Vue插入插槽
      // slots: {
      //   default: 'Child Text!'
      // }
    })
  })
})
```

## unmount

> 组件卸载

```js
unmount()
```

将组件进行卸载，会触发组件的卸载生命周期

用法：

```js
await testUtils.mount(View)
// 挂载完成 => 卸载组件
testUtils.unmount()
```

## createApp

> 构建应用

```js
await createApp()
```

该 api 主要用于测试**完整应用的表现功能**，从入口开始进行渲染。
将会根据 Taro 项目入口进行应用渲染，读取`app.config.(ts|js)`配置内容，包括如 router 相关信息。

⚠️ **注意：这与真实表现可能存在差异，因为 createApp 为运行时渲染，而非渲染编译产物，所以一些编译插件对运行时的影响降无效**

```js
test('createApp', async () => {
  await testUtils.createApp()
  // 监听/pages/index/index这个页面路由的onShow生命周期触发
  await testUtils.PageLifecycle.onShow('/pages/index/index')
  // 跳转到第二个页面
  Taro.navigateTo({ url: '/pages/second/index' })
  // 监听/pages/second/index这个页面路由的onShow生命周期触发
  await testUtils.PageLifecycle.onShow('/pages/second/index')
  // 当/pages/second/index触发onShow后，打印页面内容
  expect(testUtils.html()).toMatchSnapshot()
  // <body><div class="taro_router" id="app">...
})
```
</file>

<file path="docs/app-config.md">
---
title: 全局配置
---

根目录下的 `app.config.js` 文件用来对小程序进行全局配置，配置项遵循**微信小程序规范**，并且对所有平台进行统一。

**注意：**

1. **Taro v3.4** 之前，`app.config.js` 里引用的 JS 文件**没有经过 Babel 编译**。(**Taro v3.4** 开始支持）
2. 多端差异化逻辑可以使用 `process.env.TARO_ENV` 变量作条件判断来实现。
3. `app.config.js` 不支持多端文件的形式，如 `app.weapp.js` 这样是不起作用的。

## defineAppConfig 宏函数

:::info
Taro v3.4+ 支持
:::

开发者可以使用**编译时宏函数** `defineAppConfig` 包裹配置对象，以获得**类型提示**和**自动补全**，如：

```ts title="app.config.ts"
export default defineAppConfig({
  pages: ['pages/index/index'],
  window: {
    backgroundTextStyle: 'light',
    navigationBarBackgroundColor: '#fff',
    navigationBarTitleText: 'WeChat',
    navigationBarTextStyle: 'black',
  },
})
```

## 通用配置项

在 H5、React Native、所有小程序均支持的配置。

| 属性                        | 类型         | 必填 | 描述               |
| :-------------------------- | :----------- | :--- | :----------------- |
| [pages](#pages)             | String Array | 是   | 页面路径列表       |
| [window](#window)           | Object       | 否   | 全局的默认窗口表现 |
| [tabBar](#tabbar)           | Object       | 否   | 底部 tab 栏的表现  |
| [subPackages](#subpackages) | Object Array | 否   | 分包结构配置       |

### pages

用于指定小程序由哪些页面组成，每一项都对应一个页面的 `路径 + 文件名` 信息。文件名不需要写文件后缀，框架会自动去寻找对应位置的文件进行处理。

**数组的第一项代表小程序的初始页面（首页）。小程序中新增/减少页面，都需要对 pages 数组进行修改。**

如开发目录为：

    ├── app.js
    ├── app.json
    ├── app.wxss
    ├── pages
    │   │── index
    │   │   ├── index.wxml
    │   │   ├── index.js
    │   │   ├── index.json
    │   │   └── index.wxss
    │   └── logs
    │       ├── logs.wxml
    │       └── logs.js
    └── utils

则需要在入口文件配置中写

```jsx title="app.config.js"
export default {
  pages: ['pages/index/index', 'pages/logs/logs'],
}
```

### window

用于设置小程序的状态栏、导航条、标题、窗口背景色，其配置项如下。

| 属性                         | 类型                       | 默认值   | 描述                                                                                  |
| ---------------------------- | -------------------------- | -------- | ------------------------------------------------------------------------------------- |
| navigationBarBackgroundColor | HexColor（十六进制颜色值） | #000000  | 导航栏背景颜色，如 #000000                                                            |
| navigationBarTextStyle       | String                     | white    | 导航栏标题颜色，仅支持 black / white                                                  |
| navigationBarTitleText       | String                     |          | 导航栏标题文字内容                                                                    |
| navigationStyle              | String                     | default  | 导航栏样式，仅支持以下值：default 默认样式；custom 自定义导航栏，只保留右上角胶囊按钮 |
| backgroundColor              | String                     |          | 窗口的背景色                                                                          |
| backgroundTextStyle          | String                     | dark     | 下拉 loading 的样式，仅支持 dark / light                                              |
| backgroundColorTop           | String                     | #ffffff  | 顶部窗口的背景色，仅 iOS 支持                                                         |
| backgroundColorBottom        | String                     | #ffffff  | 底部窗口的背景色，仅 iOS 支持                                                         |
| enablePullDownRefresh        | boolean                    | false    | 是否开启当前页面的下拉刷新。                                                          |
| onReachBottomDistance        | Number                     | 50       | 页面上拉触底事件触发时距页面底部距离，单位为 px                                       |
| pageOrientation              | String                     | portrait | 屏幕旋转设置，支持 auto / portrait / landscape 详见 响应显示区域变化                  |

#### 各端支持程度如下

| 属性                         | 微信                                | 百度                       | 字节跳动 | 支付宝 | H5  | RN  | ASCF 元服务 |
| ---------------------------- | ----------------------------------- | -------------------------- | -------- | ------ | --- | --- | ----------- |
| navigationBarBackgroundColor | ✔️                                  | ✔️                         | ✔️       | ✔️     | ✔️  | ✔️  | ✔️          |
| navigationBarTextStyle       | ✔️                                  | ✔️                         | ✔️       | ✘      | ✔️  | ✔️  | ✔️          |
| navigationBarTitleText       | ✔️                                  | ✔️                         | ✔️       | ✔️     | ✔️  | ✔️  | ✔️          |
| navigationStyle              | ✔️（微信客户端 6.6.0）              | ✔️（百度 App 版本 11.1.0） | ✔️       | ✘      | ✘   | ✘   | ✔️          |
| backgroundColor              | ✔️                                  | ✔️                         | ✔️       | ✘      | ✘   | ✘   | ✔️          |
| backgroundTextStyle          | ✔️                                  | ✔️                         | ✔️       | ✘      | ✘   | ✘   | ✘           |
| backgroundColorTop           | ✔️（微信客户端 6.5.16）             | ✘                          | ✔️       | ✘      | ✘   | ✘   | ✘           |
| backgroundColorBottom        | ✔️（微信客户端 6.5.16）             | ✘                          | ✔️       | ✘      | ✘   | ✘   | ✘           |
| enablePullDownRefresh        | ✔️                                  | ✔️                         | ✔️       | ✔️     | ✘   | ✘   | ✔️          |
| onReachBottomDistance        | ✔️                                  | ✔️                         | ✔️       | ✘      | ✘   | ✘   | ✘           |
| pageOrientation              | ✔️ 2.4.0 (auto) / 2.5.0 (landscape) | ✘                          | ✘        | ✘      | ✘   | ✘   | ✘           |

#### 代码示例

```jsx title="app.config.js"
export default {
  pages: ['pages/index/index', 'pages/logs/logs'],
  window: {
    navigationBarBackgroundColor: '#ffffff',
    navigationBarTextStyle: 'black',
    navigationBarTitleText: '微信接口功能演示',
    backgroundColor: '#eeeeee',
    backgroundTextStyle: 'light',
  },
}
```

### tabBar

如果小程序是一个多 tab 应用（客户端窗口的底部或顶部有 tab 栏可以切换页面），可以通过 tabBar 配置项指定 tab 栏的表现，以及 tab 切换时显示的对应页面。

其配置项如下

| 属性            | 类型                       | 必填 | 默认值 | 描述                                                     |
| --------------- | -------------------------- | ---- | ------ | -------------------------------------------------------- |
| color           | HexColor（十六进制颜色值） | 是   |        | tab 上的文字默认颜色，仅支持十六进制颜色                 |
| selectedColor   | HexColor（十六进制颜色值） | 是   |        | tab 上的文字选中时的颜色，仅支持十六进制颜色             |
| backgroundColor | HexColor（十六进制颜色值） | 是   |        | tab 的背景色，仅支持十六进制颜色                         |
| borderStyle     | String                     | 是   | black  | tabbar 上边框的颜色， 仅支持 black / white               |
| list            | Array                      | 是   |        | tab 的列表，详见 list 属性说明，最少 2 个、最多 5 个 tab |
| position        | String                     | 否   | bottom | tabBar 的位置，仅支持 bottom / top                       |
| custom          | Boolean                    | 否   | false  | 自定义 tabBar                                            |

其中 list 接受一个数组，只能配置最少 2 个、最多 5 个 tab。tab 按数组的顺序排序，每个项都是一个对象，其属性值如下：

| 属性             | 类型   | 必填 | 描述                                                                                                                       |
| ---------------- | ------ | ---- | -------------------------------------------------------------------------------------------------------------------------- |
| pagePath         | String | 是   | 页面路径，必须在 pages 中先定义                                                                                            |
| text             | String | 是   | tab 上按钮文字                                                                                                             |
| iconPath         | String | 否   | 图片路径，icon 大小限制为 40kb，建议尺寸为 81px \* 81px，不支持网络图片。<br/>当 position 为 top 时，不显示 icon。         |
| selectedIconPath | String | 否   | 选中时的图片路径，icon 大小限制为 40kb，建议尺寸为 81px \* 81px，不支持网络图片。<br/>当 position 为 top 时，不显示 icon。 |

#### 各端支持程度如下

| 属性            | 微信                    | 百度 | 字节跳动 | 支付宝 | H5  | RN  | ASCF 元服务 |
| --------------- | ----------------------- | ---- | -------- | ------ | --- | --- | ----------- |
| color           | ✔️                      | ✔️   | ✔️       | ✔️     | ✔️  | ✔️  | ✔️          |
| selectedColor   | ✔️                      | ✔️   | ✔️       | ✔️     | ✔️  | ✔️  | ✔️          |
| backgroundColor | ✔️                      | ✔️   | ✔️       | ✔️     | ✔️  | ✔️  | ✔️          |
| borderStyle     | ✔️                      | ✔️   | ✔️       | ✘      | ✔️  | ✔️  | ✔️          |
| list            | ✔️                      | ✔️   | ✔️       | ✔️     | ✔️  | ✔️  | ✔️          |
| position        | ✔️                      | ✘    | ✔️       | ✘      | ✘   | ✘   | ✘           |
| custom          | ✔️（基础库 2.5.0 以上） | ✘    | ✘        | ✘      | ✘   | ✘   | ✔️          |

### subPackages

> H5 和 RN 会把 `subPackages` 合入 `pages`

启用[分包加载](https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages.html)时，声明项目分包结构

## 小程序端特有属性

只在部分小程序中支持的属性，H5、RN 均不支持。

| 属性                                                              | 类型         | 描述                                                |
| :---------------------------------------------------------------- | :----------- | :-------------------------------------------------- |
| [networkTimeout](#networktimeout)                                 | Object       | 网络超时时间                                        |
| [debug](#debug)                                                   | Boolean      | 是否开启 debug 模式，默认关闭                       |
| [permission](#permission)                                         | Object       | 小程序接口权限相关设置                              |
| [requiredBackgroundModes](#requiredbackgroundmodes)               | String Array | 需要在后台使用的能力，如「音乐播放」                |
| [preloadRule](#preloadrule)                                       | Object       | 分包预下载规则                                      |
| [entryPagePath](#entrypagepath)                                   | String       | 小程序默认启动首页                                  |
| [workers](#workers)                                               | String       | Worker 代码放置的目录                               |
| [navigateToMiniProgramAppIdList](#navigatetominiprogramappidlist) | String Array | 需要跳转的小程序列表，详见 wx.navigateToMiniProgram |

### networkTimeout

支持情况：<img src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/>

各类网络请求的超时时间，单位均为毫秒。

| 属性          | 类型   | 必填 | 默认值 | 描述                                                                                |
| ------------- | ------ | ---- | ------ | ----------------------------------------------------------------------------------- |
| request       | Number | 否   | 60000  | [Taro.request](./apis/network/request/request) 的超时时间，单位：毫秒               |
| connectSocket | Number | 否   | 60000  | [Taro.connectSocket](./apis/network/websocket/connectSocket) 的超时时间，单位：毫秒 |
| uploadFile    | Number | 否   | 60000  | [Taro.uploadFile](./apis/network/upload/uploadFile) 的超时时间，单位：毫秒          |
| downloadFile  | Number | 否   | 60000  | [Taro.downloadFile](./apis/network/download/downloadFile) 的超时时间，单位：毫秒    |

### debug

支持情况：<img src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/>

可以在开发者工具中开启 `debug` 模式，在开发者工具的控制台面板，调试信息以 `info` 的形式给出，其信息有 `Page` 的注册，页面路由，数据更新，事件触发等。可以帮助开发者快速定位一些常见的问题。

### permission

支持情况： <img src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/>

小程序[接口权限](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html)相关设置。字段类型为 `Object`，结构为：

| 属性               | 类型             | 必填 | 默认值 | 描述             |
| ------------------ | ---------------- | ---- | ------ | ---------------- |
| scope.userLocation | PermissionObject | 否   |        | 位置相关权限声明 |

`PermissionObject` 结构：

| 属性 | 类型   | 必填 | 默认值 | 描述                                               |
| ---- | ------ | ---- | ------ | -------------------------------------------------- |
| desc | string | 是   |        | 小程序获取权限时展示的接口用途说明。最长 30 个字符 |

#### 代码示例

```js title="app.config.js"
export default {
  pages: ['pages/index/index', 'pages/logs/logs'],
  permission: {
    'scope.userLocation': {
      desc: '你的位置信息将用于小程序位置接口的效果展示',
    },
  },
}
```

![image](https://img10.360buyimg.com/ling/jfs/t1/132830/23/12399/20429/5f893793Ebafa6939/b5f6a390ac9bfd79.jpg)

### requiredBackgroundModes

支持情况：<img src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/>

申明需要后台运行的能力，类型为数组。目前支持以下项目：

- `audio`: 后台音乐播放
- `location`: 后台定位

#### 代码示例

```js title="app.config.js"
export default {
  pages: ['pages/index/index'],
  requiredBackgroundModes: ['audio', 'location'],
}
```

注：在此处申明了后台运行的接口，开发版和体验版上可以直接生效，正式版还需通过审核。

### preloadRule

支持情况：<img src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/>

声明分包预下载的规则。

- [微信小程序文档](https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/preload.html)
- [百度小程序文档](https://smartprogram.baidu.com/docs/develop/framework/subpackages/#%E5%88%86%E5%8C%85%E9%A2%84%E4%B8%8B%E8%BD%BD%E8%A7%84%E5%88%99)
- [抖音小程序文档](https://developer.open-douyin.com/docs/resource/zh-CN/mini-app/develop/framework/basic-reference/general-configuration)

### entryPagePath

支持情况：<img src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/>

指定小程序的默认启动路径（首页），常见情景是从微信聊天列表页下拉启动、小程序列表启动等。如果不填，将默认为 `pages` 列表的第一项。不支持带页面路径参数。

#### 代码示例

```js title="app.config.js"
export default {
  entryPagePath: 'pages/index/index',
}
```

### workers

支持情况：<img src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/>

使用 Worker 处理多线程任务时，设置 Worker 代码放置的目录。

- [微信小程序文档 - Worker](https://developers.weixin.qq.com/miniprogram/dev/framework/workers.html)
- [QQ 小程序文档 - Worker](https://q.qq.com/wiki/develop/miniprogram/frame/basic_ability/basic_multiworker.html)

### navigateToMiniProgramAppIdList

支持情况：<img src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px"/> <img src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/>

当小程序需要使用 [Taro.navigateToMiniProgram](https://developers.weixin.qq.com/miniprogram/dev/api/wx.navigateToMiniProgram.html) 接口跳转到其他小程序时，需要先在配置文件中声明需要跳转的小程序 appId 列表，最多允许填写 10 个

## 微信小程序特有属性

只在微信小程序中支持的属性。<img src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px"/>

| 属性                                | 类型    | 描述                                  |
| :---------------------------------- | :------ | :------------------------------------ |
| [functionalPages](#functionalpages) | Boolean | 是否启用插件功能页，默认关闭          |
| [plugins](#plugins)                 | Object  | 使用到的插件                          |
| [resizable](#resizable)             | Boolean | iPad 小程序是否支持屏幕旋转，默认关闭 |
| [usingComponents](#usingcomponents) | Object  | 全局自定义组件配置                    |
| [sitemapLocation](#sitemaplocation) | String  | 指明 sitemap.json 的位置              |
| [style](#style)                     | String  | 指定使用升级后的 weui 样式            |
| [useExtendedLib](#useextendedlib)   | Object  | 指定需要引用的扩展库                  |
| [entranceDeclare](#entrancedeclare) | Object  | 微信消息用小程序打开                  |
| [darkmode](#darkmode)               | boolean | 小程序支持 DarkMode                   |
| [themeLocation](#themelocation)     | String  | 指明 theme.json 的位置                |
| [lazyCodeLoading](#lazycodeloading) | String  | 配置自定义组件代码按需注入            |
| [singlePage](#singlepage)           | Object  | 单页模式相关配置                      |
| [renderer](#renderer)               | String  | 全局默认的渲染后端                    |

### functionalPages

> 基础库 2.1.0 开始支持

插件所有者小程序需要设置这一项来启用[插件功能页](https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/functional-pages.html)。

### plugins

> 基础库 1.9.6 开始支持

声明小程序需要使用的[插件](https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/using.html)。

### resizable

> 基础库 2.3.0 开始支持

在 iPad 上运行的小程序可以设置支持[屏幕旋转](https://developers.weixin.qq.com/miniprogram/dev/framework/view/resizable.html)。
在 PC 上运行的小程序，用户可以按照任意比例拖动窗口大小，也可以在小程序菜单中最大化窗口。

### usingComponents

> 微信开发者工具 1.02.1810190 及以上版本支持

在此处声明的自定义组件视为全局自定义组件，在小程序内的页面或自定义组件中可以直接使用而无需再声明。

### sitemapLocation

指明 [sitemap.json](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/sitemap.html) 的位置；默认为 `sitemap.json` 即在根目录下名字的 `sitemap.json` 文件。

### style

> 基础库 2.8.0 开始支持

微信客户端 7.0 开始，UI 界面进行了大改版。小程序也进行了基础组件的样式升级。`app.json` 中配置 `"style": "v2"` 可表明启用新版的组件样式。

本次改动涉及的组件有 `button` `icon` `radio` `checkbox` `switch` `slider`。可前往小程序示例进行体验。

### useExtendedLib

> 基础库 2.2.1 开始支持

指定需要引用的扩展库。目前支持以下项目：

- weui: WeUI 组件库

指定后，相当于引入了对应扩展库相关的最新版本的 npm 包，同时也不占用小程序的包体积。rc 工具版本支持分包引用。用法如下：

#### 代码示例

```js title="app.config.js"
export default {
  useExtendedLib: {
    weui: true,
  },
}
```

### entranceDeclare

> 微信客户端 7.0.9 及以上版本支持，iOS 暂不支持

聊天位置消息用打车类小程序打开，[详情参考](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/location-message.html)。

#### 代码示例

```js title="app.config.js"
export default {
  entranceDeclare: {
    locationMessage: {
      path: 'pages/index/index',
      query: 'foo=bar',
    },
  },
}
```

### darkmode

> 开发者工具 1.03.2004271 及以上版本支持，基础库 2.11.0 及以上版本支持

微信 iOS 客户端 `7.0.12` 版本、Android 客户端 `7.0.13` 版本正式支持 `DarkMode`，可通过配置 `"darkmode": true` 表示当前小程序可适配 `DarkMode`，所有基础组件均会根据系统主题展示不同的默认样式，`navigation bar` 和 `tab bar` 也会根据开发者的配置自动切换。

配置后，请根据 [DarkMode 适配指南](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/darkmode.html)自行完成基础样式以外的适配工作。

#### 代码示例

```js title="app.config.js"
export default {
  darkmode: true,
}
```

### themeLocation

自定义 [theme.json](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/darkmode.html#%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-theme-json) 的路径，当配置 `"darkmode":true` 时，当前配置文件为必填项。

#### 代码示例

```js title="app.config.js"
export default {
  themeLocation: '/path/to/theme.json',
}
```

### lazyCodeLoading

> 基础库 2.11.1 及以上版本支持，2.11.1 以下兼容但无优化效果

通常情况下，在小程序启动期间，所有页面及自定义组件的代码都会进行注入，当前页面没有使用到的自定义组件和页面在注入后其实并没有被使用。

自基础库版本 `2.11.1` 起，小程序支持有选择地注入必要的代码，以降低小程序的启动时间和运行时内存。

#### 代码示例

```js title="app.config.js"
export default {
  lazyCodeLoading: 'requiredComponents',
}
```

### singlePage

> 基础库 2.11.3 及以上版本支持，目前分享到朋友圈 (Beta) 后打开会进入单页模式

单页模式相关配置：

| 属性             | 类型   | 必填 | 默认值                                                                | 描述                                                                                                                          |
| :--------------- | :----- | :--- | :-------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------- |
| navigationBarFit | String | 否   | 默认自动调整，若原页面是自定义导航栏，则为 `float`，否则为 `squeezed` | 导航栏与页面的相交状态，值为 `float` 时表示导航栏浮在页面上，与页面相交；值为 `squeezed` 时表示页面被导航栏挤压，与页面不相交 |

### renderer

指定小程序全局的默认渲染后端。

可选值：`webview`, `skyline`

默认值：`webview`

> Taro 提供了 `Taro.getRenderer()` 方法，支持在页面 `onLoad` 生命周期中获取到当前页面的渲染引擎类型。

## 百度小程序特有属性

只在百度小程序中支持的属性。<img src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px"/>

| 属性                      | 类型         | 描述                     |
| :------------------------ | :----------- | :----------------------- |
| [routes](#routes)         | Array Object | 小程序自定义路由相关设置 |
| [dynamicLib](#dynamiclib) | Object       | 引入动态库               |

### routes

> 基础库 3.160.3 及以上版本支持

更多详见[自定义路由](https://smartprogram.baidu.com/docs/develop/framework/app_service_customroute/)

routes 为一个数组，数组中每一项代表一组路由规则，具体包含字段为：

| 属性 | 类型   | 必填 | 描述                                             | 示例               |
| :--- | :----- | :--- | :----------------------------------------------- | :----------------- |
| path | String | 是   | 访问路径                                         | "home"             |
| page | String | 是   | 页面源码文件路径，从小程序包根目录开始的文件路径 | "pages/home/index" |

#### 代码示例

```js title="app.config.js"
export default {
  pages: ['pages/home/home', 'pages/list/list', 'pages/detail/detail'],
  subPackage: [
    {
      root: 'packageA',
      pages: ['pages/home/home', 'pages/list/list', 'pages/detail/detail'],
    },
  ],
  routes: [
    {
      // 投放入口，scheme中的path
      path: 'home',
      // 真实的物理存储路径
      page: 'pages/home/home',
    },
    {
      path: 'list',
      page: 'pages/list/list',
    },
    {
      path: 'foo/bar',
      page: 'pages/list/list',
    },
  ],
}
```

### dynamicLib

详情请参考[使用动态库](https://smartprogram.baidu.com/docs/develop/framework/dynamiclib_use/)

## QQ 小程序特有属性

只在 QQ 小程序中支持的属性。<img src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px"/>

| 属性                        | 类型          | 描述                       |
| :-------------------------- | :------------ | :------------------------- |
| [groupIdList](#groupidlist) | String Object | 需要打开群资料卡的群号列表 |

### groupIdList

详情请参考 [Button](https://q.qq.com/wiki/develop/miniprogram/component/form/button.html)

需使用可手动新增以下配置，补充 QQ 小程序类型

```ts title="global.d.ts"
/// <reference types="@tarojs/plugin-platform-qq/types/shims-qq" />
```

## 京东小程序特有属性

只在京东小程序中支持的属性。<img src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px"/>

| 属性                    | 类型   | 描述               |
| :---------------------- | :----- | :----------------- |
| [pageAlias](#pagealias) | Object | 页面 page 别名     |
| [quickMenu](#quickmenu) | Object | 胶囊按钮内菜单配置 |

### pageAlias

页面别名，可以为 `pages` 里面的页面，配置一个别名，用于打开小程序时，`path` 路径未知或者 `path` 路径过长的情况下，需要配合小程序唤起协议 `openapp` 协议使用。

#### 代码示例

```js title="app.config.js"
export default {
  pages: ['pages/index/index', 'pages/my/my'],
  window: {
    navigationBarTitleText: '京东小程序 Demo',
  },
  tabBar: {
    list: [
      {
        pagePath: 'pages/index/index',
        text: '首页',
      },
      {
        pagePath: 'pages/my/my',
        text: '个人中心',
      },
    ],
  },
  debug: true,
  pageAlias: {
    index: 'pages/index/index',
    my: 'pages/my/my',
  },
}
```

`openapp` 示例如下:

```
openapp.jdmobile://virtual?params={"category":"jump","des":"jdmp","appId":"ao123","vapptype":"1","path":"","pageAlias":"my","param":{}}
```

上面示例将打开 `appId` 为 ao123 的 `pages/my/my` 页面。

注意: `pageAlias` 里面的页面路径，必须在 `pages` 里存在；多个别名可以对应同一个页面地址，别名不可重复。 更多 `openapp` 协议详情，可参考**打开小程序**该功能需要京东 `app` 版本 `9.3.4` 和小程序引擎 `1.10.13` 及以上支持。

### quickMenu

胶囊按钮里面的部分菜单可通过配置开关来显示隐藏，默认是 `true` 显示状态。 可配置的菜单有：

| 属性          | 类型    | 必填 | 默认值 | 说明                               |
| :------------ | :------ | :--- | :----- | :--------------------------------- |
| share         | Boolean | 否   | true   | 是否显示推送给朋友（分享）菜单     |
| favorite      | Boolean | 否   | true   | 是否显示关注菜单                   |
| sendToDesktop | Boolean | 否   | true   | 是否显示发送到桌面菜单，仅安卓有效 |

下面示例中，发送给朋友、关注、发送到桌面三个菜单将都隐藏，不会展示，示例如下：

#### 代码示例

```js title="app.config.js"
export default {
  pages: ['pages/index/index', 'pages/my/my'],
  window: {
    navigationBarTitleText: '京东小程序 Demo',
  },
  quickMenu: {
    share: false,
    favorite: false,
    sendToDesktop: false,
  },
}
```

`quickMenu` 里面的菜单，只有配置布尔值 `false` 的情况下，才能隐藏，并且如果有 API 可控制某些菜单隐藏，则 API 的优先级大于这里的配置，该配置是全局配置，仅支持在 `app.json` 中配置。

## H5 端支持的属性

| 属性                            | 类型                                         | 必填 | 默认值                             | 描述                                 | 最低版本 |
| :------------------------------ | :------------------------------------------- | :--- | :--------------------------------- | :----------------------------------- | :------- |
| [entryPagePath](#entrypagepath) | String                                       | 否   |                                    | 默认启动首页                         | 3.3.17   |
| [appId](#appId)                 | String                                       | 否   | "app"                              | 渲染页面的容器 id                    | 3.3.18   |
| [animation](#animation)         | [`RouterAnimate`](#RouterAnimate)、`boolean` | 否   | `{ "duration": 300, "delay": 50 }` | 是否开启 h5 端路由动画功能，默认开启 | 3.3.18   |

### appId

H5 渲染页面的容器 id，如果修改 Html 文件中的容器 Id，需要同步添加该配置避免编译错误。

#### 代码示例

```html title="index.html"
<!-- ··· -->
<body>
  <div id="app"></div>
</body>
<!-- ··· -->
```

```js title="app.config.js"
export default {
  appId: 'app',
}
```

### animation

指定 H5 端动画配置，可以通过覆盖 CSS 样式调整动画。

#### RouterAnimate

```ts
interface RouterAnimate {
  /**
   * 动画切换时间，单位毫秒
   * @default 300
   */
  duration?: number
  /**
   * 动画切换时间，单位毫秒
   * @default 50
   */
  delay?: number
}
```

#### 代码示例

```js title="app.config.js"
export default {
  animation: false,
}
```

## ASCF 元服务支持的属性

只在 ASCF 元服务中支持的属性。<img src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px"/>

| 属性                                  | 类型   | 描述                       |
| :------------------------------------ | :----- | :------------------------- |
| [usingComponents](#usingcomponents-1) | Object | 全局自定义组件配置         |
| [resolveAlias](#resolveAlias)         | Object | 微信消息用小程序打开       |
| [lazyCodeLoading](#lazycodeloading-1) | String | 配置自定义组件代码按需注入 |

### usingComponents

在此处声明的自定义组件视为全局自定义组件，在 ASCF 元服务内的页面或自定义组件中可以直接使用而无需再声明。

### lazyCodeLoading

> 配置自定义组件代码按需注入，目前仅支持"requiredComponents"。起始版本：1.0.13。依赖关系：ASCF Toolkit 版本 ≥1.0.6

在元服务启动的过程中，代码注入是一个主要的耗时环节。注入代码量的大小与内存占用与注入耗时正相关。

利用“按需注入”和“用时注入”的特性，可以优化代码注入环节的耗时和内存占用。

更多详见[按需注入和用时注入](https://developer.huawei.com/consumer/cn/doc/atomic-ascf/on-demand-render-time-injection)。

#### 代码示例

```js title="app.config.js"
export default {
  lazyCodeLoading: 'requiredComponents',
}
```

### resolveAlias

resolveAlias 配置项可用于自定义模块路径的映射规则。

配置完成后，它会对 require 中的模块路径按照所设定的映射规则进行匹配，进而转换为对应的配置路径。

更多详见[resolveAlias](https://developer.huawei.com/consumer/cn/doc/atomic-ascf/appjson-global-config#section13041254111110)。
</file>

<file path="docs/babel-config.md">
---
title: Babel 配置
---

Taro 项目的 Babel 配置位于根目录的 `babel.config.js` 文件中，里面默认添加了一个 preset：`babel-preset-taro`，它会根据项目的技术栈添加一些常用的 `presets` 和 `plugins`。

```js title="babel.config.js"
module.exports = {
  presets: [
    [
      'taro',
      {
        /** 配置项 */
      },
    ],
  ],
}
```

开发者可以修改 `babel.config.js`，修改 `babel-preset-taro` 的配置项，或添加自己想要的 `presets` 和 `plugins`。

## babel-preset-taro

`babel-preset-taro` 会根据当前项目的技术栈，选择性地使用以下的 `presets` 和 `plugins`。

#### 1. 通用

##### presets

- `@babel/preset-env`
- `@babel/preset-typescript`（TypeScript 环境）

##### plugins

- `@babel/plugin-transform-runtime`
- `@babel/plugin-proposal-decorators`
- `@babel/plugin-proposal-class-properties`
- `babel-plugin-dynamic-import-node`（小程序环境）

#### 2. React

##### presets

- `@babel/preset-react`

##### plugins

- `react-refresh/babel`

#### 3. Vue

##### presetes

- `@vue/babel-preset-jsx`

#### 4. Vue3

##### plugins

- `@vue/babel-plugin-jsx`

以下将详细介绍 `babel-preset-taro` 的配置项。

### reactJsxRuntime

:::note
只在使用 **React** 时生效。
:::

**默认值**：`'automatic'`

`@babel/preset-react` 的 [runtime](https://babeljs.io/docs/en/babel-preset-react#runtime) 配置项。

### ts

:::note
使用 Typescript
:::

### hot

:::note
只在使用 **React** 时生效。
:::

**默认值**：`true`

是否引入 `react-refresh/babel` 来支持使用 [fast-refresh](h5#fast-refresh)。

### vueJsx

:::note
只在使用 **Vue/Vue3** 时生效。
:::

**默认值**：`true`

**类型**：`true` | `false` | `object`

是否使用 `@vue/babel-preset-jsx`（Vue）或 `@vue/babel-plugin-jsx`（Vue3）来支持使用 `jsx`。

当传入一个 `object` 时，等同于设置为 `true`，且该 `object` 将会作为 `@vue/babel-preset-jsx`（Vue）或 `@vue/babel-plugin-jsx`（Vue3）的参数。

### targets

**默认值**：

```js
{
  ios: '9',
  android: '5'
}
```

`@babel/preset-env` 的 [targets](https://babeljs.io/docs/en/babel-preset-env#targets) 配置项。

### useBuiltIns

**默认值**：`false`

**有效值**：`'entry'` | `'usage'` | `false`

#### useBuiltIns: 'entry'

:::info
**优点**：全局彻底 polyfill，就算 `node_modules` 中的依赖存在不兼容的代码，也能成功运行。

**缺点**：可能会引入冗余代码、影响全局变量。
:::

当传入 `'entry'` 时，会把 `@babel/preset-env` 的 [useBuiltIns](https://babeljs.io/docs/en/babel-preset-env#usebuiltins) 选项设为 `'entry'`、[corejs](https://babeljs.io/docs/en/babel-preset-env#corejs) 选项设为 `'3'`。

开发者需要在入口文件 `app.js` 中引入 `core-js`：

```js title="src/app.js"
import 'core-js'
```

Babel 会根据 [targets](babel-config#targets)，引入对应的 `core-js` 依赖。例如上述代码会被编译为：

```js title="dist/app.js"
import 'core-js/modules/es.string.pad-start'
import 'core-js/modules/es.string.pad-end'
// ...
```

> 当然，因为这时 Taro 把 `corejs` 设置为 `'3'`，所以可以使用 `core-js@3` **手动按需引入的能力**，详情请见[文档](https://babeljs.io/docs/en/babel-preset-env#usebuiltins)。

#### useBuiltIns: 'usage'

:::info
**优点**：按需引入、不会影响全局变量。

**缺点**：默认不会处理 `node_modules` 中的依赖，需要手动配置 `babel-loader`。
:::

当传入 `'usage'` 时，会把 `@babel/plugin-transform-runtime` 的 [corejs](https://babeljs.io/docs/en/babel-plugin-transform-runtime#corejs) 选项设为 `3`。

> 注意：传入 `'usage'` 时， Taro 没有使用 `@babel/preset-env` 的 `useBuiltIns: 'usage'` 而是使用了 `@babel/plugin-transform-runtime` 的 `corejs: 3`。原因在于：一、两者同时设置时会产生冲突。二、后者相对于前者，不会影响全局变量。

#### useBuiltIns: false

当传入 `false` 时，会把 `@babel/preset-env` 的 [useBuiltIns](https://babeljs.io/docs/en/babel-preset-env#usebuiltins) 选项设为 `false`，此时不会引入 `core-js`。

### loose

**默认值**：`false`

同时是 `@babel/preset-env`、`@babel/plugin-proposal-class-properties` 的 `loose` 配置项。

### debug

**默认值**：`false`

`@babel/preset-env` 的 [debug](https://babeljs.io/docs/en/babel-preset-env#debug) 配置项。

### modules

**默认值**：`false`

`@babel/preset-env` 的 [modules](https://babeljs.io/docs/en/babel-preset-env#modules) 配置项。

### spec

`@babel/preset-env` 的 [spec](https://babeljs.io/docs/en/babel-preset-env#spec) 配置项。

### configPath

`@babel/preset-env` 的 [configPath](https://babeljs.io/docs/en/babel-preset-env#configpath) 配置项。

### include

`@babel/preset-env` 的 [include](https://babeljs.io/docs/en/babel-preset-env#include) 配置项。

### exclude

`@babel/preset-env` 的 [exclude](https://babeljs.io/docs/en/babel-preset-env#exclude) 配置项。

### shippedProposals

`@babel/preset-env` 的 [shippedProposals](https://babeljs.io/docs/en/babel-preset-env#shippedproposals) 配置项。

### forceAllTransforms

`@babel/preset-env` 的 [forceAllTransforms](https://babeljs.io/docs/en/babel-preset-env#forcealltransforms) 配置项。

### decoratorsBeforeExport

`@babel/plugin-proposal-decorators` 的 [decoratorsBeforeExport](https://babeljs.io/docs/en/babel-plugin-proposal-decorators#decoratorsbeforeexport) 配置项。

### decoratorsLegacy

**默认值**：`true`

`@babel/plugin-proposal-decorators` 的 [lagacy](https://babeljs.io/docs/en/babel-plugin-proposal-decorators#legacy) 配置项。

### absoluteRuntime

**默认值**：开发者根目录 `node_modules` 中的 `@babel/plugin-transform-runtime` 的路径。

**类型**：`string`

`@babel/plugin-transform-runtime` 的 [absoluteRuntime](https://babeljs.io/docs/en/babel-plugin-transform-runtime#absoluteruntime) 配置项。

### version

**默认值**：开发者根目录 `node_modules` 中的 `@babel/plugin-transform-runtime` 的版本号。

**类型**：`string`

`@babel/plugin-transform-runtime` 的 [version](https://babeljs.io/docs/en/babel-plugin-transform-runtime#version) 配置项。

### dynamic-import-node

:::note
可以去掉冗余代码，对于一些严格限制包体大小的场景（比如 PWA 等）有帮助，但这也会去掉页面和组件的懒加载，导致 app.js 过大。

> 注意：**h5** 平台默认关闭，其他平台默认开启，小程序默认是不支持动态加载的，可以通过[dynamic-import 插件](https://github.com/JiyuShao/taro-dynamic-import-weapp/tree/master/packages/taro-plugin-dynamic-import-weapp)提供该能力。
> :::

**类型**：`boolean`
</file>

<file path="docs/best-practice.md">
---
title: 最佳实践
---

## 关于 JSX 支持程度补充说明

由于 JSX 中的写法千变万化，我们不能支持到所有的 JSX 写法，同时由于微信小程序端的限制，也有部分 JSX 的优秀用法暂时不能得到很好地支持，特在此补充说明一下对于 JSX 的支持程度:

- [不能使用 Array#map 之外的方法操作 JSX 数组](https://github.com/NervJS/taro/blob/master/packages/eslint-plugin-taro/docs/manipulate-jsx-as-array.md)
- [暂不支持在 render() 之外的方法定义 JSX](https://github.com/NervJS/taro/blob/master/packages/eslint-plugin-taro/docs/no-jsx-in-class-method.md) (自 v1.3.0-beta.0 起支持)
- [不能在 JSX 参数中使用对象展开符](https://github.com/NervJS/taro/blob/master/packages/eslint-plugin-taro/docs/no-spread-in-props.md) (自 v1.3.0-beta.0 起，自定义组件可以使用对象展开符，内置组件仍然需要分别单独传入参数)
- [不支持无状态组件](https://github.com/NervJS/taro/blob/master/packages/eslint-plugin-taro/docs/no-stateless-function.md) (自 v1.3.0-beta.0 起支持)

以上的规则在 Taro 默认生成的模板都有 ESLint 检测，无需做任何配置。如果你的编辑器没有安装 ESLint 插件可以参考以下教程在你的编辑器安装：

- [VSCode](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint)
- [IntelliJ IDEA(WebStorm 等 JetBrains 系)](https://www.jetbrains.com/help/idea/eslint.html)
- [Sublime Text](https://packagecontrol.io/packages/ESLint)

默认情况下 Taro 的编译器也会对无法运行的代码进行警告，当没有调用栈信息时代码是可以生成的。如果你需要在编译时禁用掉 ESLint 检查，可以在命令前加入 `ESLINT=false` 参数，例如：

```bash
$ ESLINT=false taro build --type weapp --watch
```

## 最佳编码方式

经过较长时间的探索与验证，目前 Taro 在微信小程序端是采用依托于小程序原生自定义组件系统来设计实现 Taro 组件化的，所以目前小程序端的组件化会受到小程序原生组件系统的限制，而同时为了实现以 React 方式编写代码的目标，Taro 本身做了一些编译时以及运行时的处理，这样也带来了一些值得注意的约束，所以有必要阐述一下 Taro 编码上的最佳实践。

### 组件样式说明

微信小程序的[自定义组件样式](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html)默认是不能受外部样式影响的，例如在页面中引用了一个自定义组件，在页面样式中直接写自定义组件元素的样式是无法生效的。这一点，在 Taro 中也是一样，而这也是与大家认知的传统 Web 开发不太一样。

### 给组件设置 `defaultProps`

在微信小程序端的自定义组件中，只有在 `properties` 中指定的属性，才能从父组件传入并接收

```jsx
Component({
  properties: {
    myProperty: { // 属性名
      type: String, // 类型（必填），目前接受的类型包括：String, Number, Boolean, Object, Array, null（表示任意类型）
      value: '', // 属性初始值（可选），如果未指定则会根据类型选择一个
      observer: function (newVal, oldVal, changedPath) {
         // 属性被改变时执行的函数（可选），也可以写成在 methods 段中定义的方法名字符串, 如：'_propertyChange'
         // 通常 newVal 就是新设置的数据， oldVal 是旧数据
      }
    },
    myProperty2: String // 简化的定义方式
  }
  ...
})
```

而在 Taro 中，对于在组件代码中使用到的来自 `props` 的属性，会在编译时被识别并加入到编译后的 `properties` 中，暂时支持到了以下写法

```jsx
this.props.property

const { property } = this.props

const property = this.props.property
```

但是一千个人心中有一千个哈姆雷特，不同人的代码写法肯定也不尽相同，所以 Taro 的编译肯定不能覆盖到所有的写法，而同时可能会有某一属性没有使用而是直接传递给子组件的情况，这种情况是编译时无论如何也处理不到的，这时候就需要大家在编码时给组件设置 [`defaultProps`](./apis/about/tarocomponent.md#defaultprops) 来解决了。

组件设置的 `defaultProps` 会在运行时用来弥补编译时处理不到的情况，里面所有的属性都会被设置到 `properties` 中初始化组件，正确设置 `defaultProps` 可以避免很多异常的情况的出现。

### 组件传递函数属性名以 `on` 开头

> 在 v1.3.0-beta.0 之后，自定义组件间的事件传递可以不用 `on` 开头，但内置组件的事件依然是以 `on` 开头的，为了一致性我们仍然推荐你以 `on` 开头命名你的事件。

在 Taro 中，父组件要往子组件传递函数，属性名必须以 `on` 开头

```jsx
// 调用 Custom 组件，传入 handleEvent 函数，属性名为 onTrigger
class Parent extends Component {
  handleEvent() {}

  render() {
    return <Custom onTrigger={this.handleEvent}></Custom>
  }
}
```

这是因为，微信小程序端组件化是不能直接传递函数类型给子组件的，在 Taro 中是借助组件的[事件机制](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/events.html)来实现这一特性，而小程序中传入事件的时候属性名写法为 `bindmyevent` 或者 `bind:myevent`

```xml
<!-- 当自定义组件触发 myevent 事件时，调用 onMyEvent 方法 -->
<component-tag-name bindmyevent="onMyEvent" />
<!-- 或者可以写成 -->
<component-tag-name bind:myevent="onMyEvent" />
```

所以 Taro 中约定组件传递函数属性名以 `on` 开头，同时这也和内置组件的事件绑定写法保持一致了。

### 小程序端不要在组件中打印传入的函数

> 自 v1.3.0-beta.0 没有这条限制

前面已经提到小程序端的组件传入函数的原理，所以在小程序端不要在组件中打印传入的函数，因为拿不到结果，但是 `this.props.onXxx && this.props.onXxx()` 这种判断函数是否传入来进行调用的写法是完全支持的。

### 小程序端不要将在模板中用到的数据设置为 `undefined`

由于小程序不支持将 data 中任何一项的 value 设为 `undefined` ，在 setState 的时候也请避免这么用。你可以使用 null 来替代。

### 小程序端不要在组件中打印 `this.props.children`

在微信小程序端是通过 `<slot />` 来实现往自定义组件中传入元素的，而 Taro 利用 `this.props.children` 在编译时实现了这一功能， `this.props.children` 会直接被编译成 `<slot />` 标签，所以它在小程序端属于语法糖的存在，请不要在组件中打印它。

### 支持 props 传入 JSX

> 自 `1.1.9` 开始支持

支持 props 传入 JSX，但是元素传入 JSX 的属性名必须以 `render` 开头

例如，子组件写法

```javascript
class Dialog extends Component {
  render() {
    return (
      <View className="dialog">
        <View className="header">{this.props.renderHeader}</View>
        <View className="body">{this.props.children}</View>
        <View className="footer">{this.props.renderFooter}</View>
      </View>
    )
  }
}
```

父组件调用子组件是传入 JSX

```javascript
class App extends Component {
  render() {
    return (
      <View className="container">
        <Dialog
          renderHeader={<View className="welcome-message">Welcome!</View>}
          renderFooter={<Button className="close">Close</Button>}
        >
          <View className="dialog-message">Thank you for using Taro.</View>
        </Dialog>
      </View>
    )
  }
}
```

### 组件属性传递注意

不要以 `id`、`class`、`style` 作为自定义组件的属性与内部 state 的名称，因为这些属性名在微信小程序小程序中会丢失。

### 组件 `state` 与 `props` 里字段重名的问题

不要在 `state` 与 `props` 上用同名的字段，因为这些字段在微信小程序中都会挂在 `data` 上。

### 小程序中页面生命周期 `componentWillMount` 不一致问题

由于微信小程序里页面在 `onLoad` 时才能拿到页面的路由参数，而页面 onLoad 前组件都已经 `attached` 了。因此页面的 `componentWillMount` 可能会与预期不太一致。例如：

```jsx
// 错误写法
render () {
  // 在 willMount 之前无法拿到路由参数
  const abc = this.$router.params.abc
  return <Custom adc={abc} />
}

// 正确写法
componentWillMount () {
  const abc = this.$router.params.abc
  this.setState({
    abc
  })
}
render () {
  // 增加一个兼容判断
  return this.state.abc && <Custom adc={abc} />
}
```

对于不需要等到页面 willMount 之后取路由参数的页面则没有任何影响。

### 组件的 `constructor` 与 `render` 提前调用

很多细心的开发者应该已经注意到了，在 Taro 编译到小程序端后，组件的 `constructor` 与 `render` 默认会多调用一次，表现得与 React 不太一致。

这是因为，Taro 的组件编译后就是小程序的自定义组件，而小程序的自定义组件的初始化时是可以指定 `data` 来让组件拥有初始化数据的。开发者一般会在组件的 `constructor` 中设置一些初始化的 `state`，同时也可能会在 `render` 中处理 `state` 与 `props` 产生新的数据，在 Taro 中多出的这一次提前调用，就是为了收集组件的初始化数据，给自定义组件提前生成 `data` ，以保证组件初始化时能带有数据，让组件初次渲染正常。

所以，在编码时，需要在处理数据的时候做一些容错处理，这样可以避免在 `constructor` 与 `render` 提前调用时出现由于没有数据导致出错的情况。

### JS 编码必须用单引号

在 Taro 中，JS 代码里必须书写单引号，特别是 JSX 中，如果出现双引号，可能会导致编译错误。

### 环境变量 `process.env` 的使用

不要以解构的方式来获取通过 `env` 配置的 `process.env` 环境变量，请直接以完整书写的方式 `process.env.NODE_ENV` 来进行使用

```jsx
// 错误写法，不支持
const { NODE_ENV = 'development' } = process.env
if (NODE_ENV === 'development') {
  ...
}

// 正确写法
if (process.env.NODE_ENV === 'development') {

}
```

### 使用 `this.$componentType` 来判断当前 Taro.Component 是页面还是组件

`this.$componentType` 可能取值分别为 `PAGE` 和 `COMPONENT`，开发者可以根据此变量的取值分别采取不同逻辑。

### 原生小程序组件传递 props 给 Taro 组件

**Taro v1.3+** 对 props 系统进行了改造，使得不能兼容原生组件通过 properties 传入的属性。

目前可以通过把所有需要传入 Taro 组件的 props，通过借助 `extraProps` 属性来解决。

```js
// 小程序组件常规 props 传递
<plugin title="{{name}}" desc="{{desc}}" bindonclick="onClick"></plugin>

// 原生小程序组件调用 Taro 组件时需要改造成以下形式：
this.setData({
  extraProps: {
    name,
    desc,
    onClick: this.onClick
  }
})
<plugin extraProps="{{extraProps}}" ></plugin>
```

## 全局变量

在 Taro 中推荐使用 `Redux` 来进行全局变量的管理，但是对于一些小型的应用， `Redux` 就可能显得比较重了，这时候如果想使用全局变量，推荐如下使用。

新增一个自行命名的 `JS` 文件，例如 `global_data.js`，示例代码如下

```jsx
const globalData = {}

export function set(key, val) {
  globalData[key] = val
}

export function get(key) {
  return globalData[key]
}
```

随后就可以在任意位置进行使用啦

```jsx
import { set as setGlobalData, get as getGlobalData } from './path/name/global_data'

setGlobalData('test', 1)

getGlobalData('test')
```
</file>

<file path="docs/children.md">
---
title: Children 与组合
---

> 经测试，由于微信小程序的 `<slot />` 无法在循环中使用，因此 Children 和组合在微信小程序中也无法在循环中使用。百度小程序、支付宝小程序、H5、React Native 都可以在循环中使用此功能。

## Children

在我们设计组件时，有些组件通常不知道自己的子组件会有什么内容，例如 `Sidebar` 和 `Dialog` 这样的容器组件。

我们建议在这样的情况使用 `this.props.children` 来传递子元素：

```jsx
class Dialog extends Component {
  render() {
    return (
      <View className="dialog">
        <View className="header">Welcome!</View>
        <View className="body">{this.props.children}</View>
        <View className="footer">-- divider --</View>
      </View>
    )
  }
}
```

这样就能允许其它组件在 JSX 中嵌套任意子组件传递给 `Dialog`:

```jsx
class App extends Component {
  render() {
    return (
      <View className="container">
        <Dialog>
          <View className="dialog-message">Thank you for using Taro.</View>
        </Dialog>
      </View>
    )
  }
}
```

在 `<Dialog />` JSX 标签内的任何内容都会作为它的子元素(Children)都会传递到它的组件。

### 注意事项

**请不要对 `this.props.children` 进行任何操作**。Taro 在小程序中实现这个功能使用的是小程序的 [`slot`](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html) 功能，也就是说你可以把 `this.props.children` 理解为 `slot` 的语法糖，`this.props.children` 在 Taro 中并不是 React 的 `ReactElement` 对象，因此形如 `this.props.children && this.props.children`、`this.props.children[0]` 在 Taro 中都是非法的。

**`this.props.children` 无法用 `defaultProps` 设置默认内容**。由于小程序的限制，Taro 也无法知道组件的消费者是否传入内容，所以无法应用默认内容。

**不能把 `this.props.children` 分解为变量再使用**。由于普通的 `props` 有一个确切的值，所以当你把它们分解为变量运行时可以处理，`this.props.children` 则不能这样操作，你必须显性地把 `this.props.children` 全部都写完整才能实现它的功能。

## 组合

> 自 `1.1.9` 开始支持

有些情况你不仅仅需要只传递一个子组件，可能会需要很多个「占位符」。例如在这个 `Dialog` 组件中，你不仅需要自定义它的 `body`，你希望它的 `header` 和 `footer` 都是给 `Dialog` 组件的使用者自由定制。这种情况可以这样做：

```jsx
class Dialog extends Component {
  render() {
    return (
      <View className="dialog">
        <View className="header">{this.props.renderHeader}</View>
        <View className="body">{this.props.children}</View>
        <View className="footer">{this.props.renderFooter}</View>
      </View>
    )
  }
}

class App extends Component {
  render() {
    return (
      <View className="container">
        <Dialog
          renderHeader={<View className="welcome-message">Welcome!</View>}
          renderFooter={<Button className="close">Close</Button>}
        >
          <View className="dialog-message">Thank you for using Taro.</View>
        </Dialog>
      </View>
    )
  }
}
```

在我们声明 `Dialog` 组件时，`header` 和 `footer` 部分我们分别增加了 `this.props.renderHeader` 和 `this.props.renderFooter` 作为占位符。相应地，我们在使用 `Dialog` 组件时，就可以给 `renderHeader` 和 `renderFooter` 传入 JSX 元素，这两个分别传入的 JSX 元素将会填充它们在 `Dialog` 组件中的位置——就像在 `Dialog` JSX 标签里写入的内容，会填充到 `this.props.children` 的位置一样。

### 注意事项

**组件的组合需要遵守 `this.props.children` 的所有规则**。组合这个功能和 `this.props.children` 一样是通过 `slot` 实现的，也就是说 `this.props.children` 的限制对于组件组合也都同样适用。

**所有组合都必须用 `render` 开头，且遵守驼峰式命名法**。和我们的事件规范以 `on` 开头一样，组件组合使用 `render` 开头。

**组合只能传入单个 JSX 元素，不能传入其它任何类型**。当你需要进行一些条件判断或复杂逻辑操作的时候，可以使用一个 `Block` 元素包裹住，然后在 `Block` 元素的里面填充其它复杂的逻辑。
</file>

<file path="docs/cli.md">
---
title: CLI 命令
---

常用的 Taro CLI 命令。

### 查看 Taro 所有命令及帮助

```bash
$ taro --help
```

### 环境及依赖检测

Taro 提供了命令来一键检测 Taro 环境及依赖的版本等信息，方便大家查看项目的环境及依赖，排查环境问题。在提 issue 的时候，请附上 `taro info` 打印的信息，帮助开发人员快速定位问题。

```bash
$ taro info
👽 Taro v3.0.7



  Taro CLI 3.0.7 environment info:
    System:
      OS: macOS High Sierra 10.13.6
      Shell: 5.3 - /bin/zsh
    Binaries:
      Node: 13.14.0 - ~/.nvm/versions/node/v13.14.0/bin/node
      Yarn: 1.22.4 - ~/.nvm/versions/node/v13.14.0/bin/yarn
      npm: 6.14.4 - ~/.nvm/versions/node/v13.14.0/bin/npm
    npmPackages:
      @tarojs/components: 1.3.27 => 1.3.27
      @tarojs/router: 1.3.27 => 1.3.27
      @tarojs/taro: 1.3.27 => 1.3.27
      @tarojs/taro-h5: 1.3.27 => 1.3.27
      @tarojs/webpack-runner: 1.3.27 => 1.3.27
      eslint-config-taro: 1.3.27 => 1.3.27
      eslint-plugin-taro: 1.3.27 => 1.3.27
      nerv-devtools: 1.5.5 => 1.5.5
      nervjs: 1.5.5 => 1.5.5

```

### Taro Doctor

Taro Doctor 就像一个医生一样，可以诊断项目的依赖、设置、结构，以及代码的规范是否存在问题，并尝试给出解决方案。

但和真正的医生不一样，Taro Doctor 不需要排队挂号，也不用花钱。你只需要在终端运行命令：`taro doctor`，就像图里一样：

![Taro Doctor 诊断结果图](https://img10.360buyimg.com/ling/jfs/t1/46613/36/5573/202581/5d357d14E6f0df7e1/fc026be7dc69dcf2.png)

### 快速创建新页面

Taro create --name [页面名称] --dir [路径] --subpkg [分包路径]  能够在当前项目的指定目录下快速生成新的页面文件，并填充基础代码，是一个提高开发效率的利器。

> taro 会尝试同步修改 `app.config.js` 配置文件中的 `pages` 或者 `subPackages` 字段。

#### 例子
假设当前当前跟路径为 `/project/root`。

执行下面命令创建主包页面：
```bash
taro create newPage --dir pages/mydir
```
那么会在 `/project/root/src/pages/mydir` 目录下生成新的页面，并且在 `app.config.js` 中自动补齐 `pages` 字段。

执行下面命令创建分包页面：
```bash
taro create newPage --subpkg mysubpages
```
那么会在 `/project/root/src/mysubpages` 目录下生成新的页面，并且在 `app.config.js` 中自动补齐 `subPackages` 字段。

### 快速创建插件模版

参考 [插件编写](./plugin-custom.md)

### CLI 配置

Taro 会在用户根目录下创建 .taro 文件夹，其中 .taro/index.json 用于存放 CLI 相关配置。

开发者可以使用 `taro config` 命令对配置项进行一系列操作：

```bash
# 查看用法
$ taro config --help
# 设置配置项<key>的值为<value>
$ taro config set <key> <value>
# 读取配置项<key>
$ taro config get <key>
# 删除配置项<key>
$ taro config delete <key>
# 打印所有配置项
$ taro config list [--json]
```

### 全局插件或插件集配置

Taro 会在用户根目录下创建 .taro-global-config 文件夹，用于在执行 CLI 阶段时，如果没有获取到项目的配置文件，可以从该文件夹下读取全局的配置。

目前开发了 插件（plugins）和 插件集（presets）这两个可配置项。
有了这一配置，Taro 将支持在没有项目配置文件时，去执行一些插件。这些插件大部分是一些自定义命令类型的插件。

开发者可以使用 `taro global-config` 命令对配置项进行一系列操作：

```bash
# 查看用法
$ taro global-config --help
# 添加全局插件
$ taro global-config add-plugin [pluginName]
# 删除全局插件
$ taro global-config remove-plugin [pluginName]
# 添加全局插件集
$ taro global-config add-preset [presetName]
# 删除全局插件集
$ taro global-config remove-preset [presetName]
# 重置 .taro-global-config 文件夹
$ taro global-config reset
```

举个例子，比如有一些自定义的模版源，如果直接执行 `taro init` 命令，在每次初始化时都得传入大量的参数才得以完成项目的初始化构建。这时候开发者可以自行开发一个自定义的初始化插件，如下：

```typescript
const TEMPLATE_SOURCE = 'your template source'
export default (ctx: IPluginContext) => {
  ctx.registerCommand({
    // 命令名
    name: 'custom-init',
    optionsMap: {
      '--name': '项目名称',
      '--description': '项目描述',
    },
    // 执行 taro custom-init --help 时输出的使用例子的信息
    synopsisList: ['taro custom-init <projectName> --description <description>'],
    // 命令钩子
    async fn() {
      const name = ctx?.runOpts?._[1] || ctx?._.name
      const description = ctx?.runOpts?.options?.description
      //使用 taro cli 内部命令插件已通过此方法暴露出来
      ctx.applyCliCommandPlugin(['init'])
      ctx.applyPlugins({
        name: 'init',
        opts: {
          options: {
            typescript: true,
            templateSource: TEMPLATE_SOURCE,
            css: 'none',
            framework: 'react',
            compiler: 'webpack5',
            description: description,
            projectName: name,
          },
        },
      })
    },
  })
}
```

之后，可以把该插件作为全局插件安装，假设该插件名为 taro-custom-init，运行：

```bash
$ taro global-config add-plugin taro-custom-init
```

之后只需要运行以下命令，即可完成你的自定义 Taro 项目了：

```bash
$ taro custom-init <projectName> --description <description>
```
</file>

<file path="docs/codebase-overview.md">
---
title: Taro 仓库概览
---

## 仓库组成

以下列表介绍了 Taro 由哪些 NPM 包所组成，以及每个包的功能。

### 基础

| 路径                     | 描述                                              |
| ------------------------ | :------------------------------------------------ |
| `@tarojs/cli`            | CLI 工具                                          |
| `@tarojs/service`        | 插件化内核                                        |
| `@tarojs/taro-loader`    | Webpack loaders                                   |
| `@tarojs/helper`         | 工具库，主要供 CLI、编译时使用                    |
| `@tarojs/runner-utils`   | 工具库，主要供小程序、H5 的编译工具使用           |
| `@tarojs/shared`         | 工具库，主要供运行时使用                          |
| `@tarojs/taro`           | 暴露各端所需要的 Taro 对象                        |
| `@tarojs/api`            | 和各端相关的 Taro API                             |
| `babel-preset-taro`      | Babel preset                                      |
| `eslint-config-taro`     | ESLint 规则                                       |
| `postcss-pxtransform`    | PostCSS 插件，转换 `px` 为各端的自适应尺寸单位    |
| `postcss-html-transform` | PostCSS 插件，用于 HTML、小程序标签的类名相互转换 |

### 小程序

| 路径                             | 描述                                              |
| -------------------------------- | :------------------------------------------------ |
| `@tarojs/mini-runner`            | 小程序编译工具，主要用于设置、调用 Webpack        |
| `@tarojs/react`                  | 基于 `react-reconciler` 的小程序专用 React 渲染器 |
| `@tarojs/runtime`                | 小程序运行时适配器核心                            |
| `@tarojs/plugin-platform-weapp`  | 微信小程序插件                                    |
| `@tarojs/plugin-platform-alipay` | 支付宝小程序插件                                  |
| `@tarojs/plugin-platform-swan`   | 百度小程序插件                                    |
| `@tarojs/plugin-platform-tt`     | 抖音小程序插件                                    |
| `@tarojs/plugin-platform-qq`     | qq 小程序插件                                     |
| `@tarojs/plugin-platform-jd`     | 京东小程序插件                                    |
| `@tarojs/plugin-html`            | 支持使用 HTML 标签的插件                          |
| `@tarojs/plugin-react-devtools`  | 支持使用 React DevTools 的插件                    |
| `@tarojs/extend`                 | 类似 jQuery 的库                                  |

### H5

| 路径                             | 描述                                     |
| -------------------------------- | :--------------------------------------- |
| `@tarojs/webpack-runner`         | H5 编译工具，主要用于设置、调用 Webpack  |
| `@tarojs/router`                 | H5 路由                                  |
| `@tarojs/taro-h5`                | H5 端根据微信小程序规范实现的 API        |
| `@tarojs/components`             | H5 组件库（Web Components 版本）         |
| `@tarojs/components-react`       | H5 组件库（React 版本）                  |
| `babel-plugin-transform-taroapi` | Babel 插件，让 API 可以被 `tree-shaking` |
| `postcss-plugin-constparse`      | PostCSS 插件，用于处理 `tabbar` 的高度   |

### RN

| 路径                                                | 描述                                                                 |
| --------------------------------------------------- | :------------------------------------------------------------------- |
| `@tarojs/components-rn`                             | RN 组件库                                                            |
| `@tarojs/rn-runner`                                 | RN 编译工具，主要用于设置、调用 metro                                |
| `@tarojs/rn-style-transformer`                      | RN 样式转换工具，让 RN 支持 sass、less、stylus、postcss              |
| `@tarojs/rn-supporter`                              | RN 基础 metro 配置                                                   |
| `@tarojs/rn-transformer`                            | RN 应用入口及页面转换工具，让 RN 支持 Taro 定义的 app 及 page config |
| `@tarojs/router-rn`                                 | RN 路由                                                              |
| `@tarojs/runtime-rn`                                | RN 运行时封装                                                        |
| `@tarojs/taro-rn`                                   | RN 端根据微信小程序规范实现的 API                                    |
| `babel-plugin-transform-react-jsx-to-rn-stylesheet` | Babel 插件，让 jsx 支持 className 属性                               |
| `taro-css-to-react-native`                          | 将 css 转为 RN 的 stylesheet                                         |

### 其它

| 路径                 | 描述                         |
| -------------------- | :--------------------------- |
| `@tarojs/taroize`    | 小程序转 Taro 的编译器       |
| `@tarojs/with-weapp` | 小程序转 Taro 的运行时适配器 |
</file>

<file path="docs/come-from-miniapp.mdx">
---
title: 从原生小程序迁移过来？
---

import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

本篇将讲述 Taro 开发和原生小程序开发的主要差异。希望能帮助掌握原生小程序开发，但不太了解 Taro 的同学快速进行迁移。

## 全局变量

在使用 React/Vue 时，全局变量推荐使用 **React Redux**、**Vuex** 等状态管理工具进行管理。

而有时候一些从原生小程序转换过来的项目，会把全局变量挂载到 `app` 上，然后使用 `getApp()` 获取它们。改造为 **React Redux**、**Vuex** 等状态管理方式成本比较大。

对于这种模式，Taro 提供了一些兼容的手段：

### React

可以使用入口组件的 `taroGlobalData` 属性兼容这种写法：

```jsx title="app.js"
class App extends Component {
  // 设置全局变量 "x"
  taroGlobalData = {
    x: 1,
  }

  // ...
}
```

```jsx title="index.js"
function Index() {
  // 获取并使用全局变量 "x"
  const app = Taro.getApp()
  console.log(app.x)

  // ...
}
```

### Vue3

可以使用 Taro 提供的 Vue 插件 `setGlobalDataPlugin` 兼容这种写法：

```jsx title="app.js"
// 使用插件，设置全局变量 "x"
import { createApp } from 'vue'
import { setGlobalDataPlugin } from '@tarojs/taro'

const App = createApp(...)
App.use(setGlobalDataPlugin, {
  x: 1
})
```

```html title="index.vue"
<script>
  // 获取并使用全局变量 "x"
  const app = Taro.getApp()
  console.log(app.x)
</script>
```

## API 的 scope

在原生小程序开发中，在自定义组件中调用一些 API，如 `createCanvasContext`、`createSelectorQuery` 等时，需要传入指向自定义组件自身的 `this`，这里暂且称为 `scope`。

但是 Taro 3 使用 `<template>` 标签进行渲染，一般不会使用上自定义组件，因此一般不需要传入。

只有两种情况会使用上自定义组件，这时需要正确传入 `scope`，否则此类 API 的调用会失败。

### 1. 层级过深

对于[模板不支持递归](./platform-plugin/template#递归与非递归模板)的小程序（微信、QQ、京东小程序等），当页面元素嵌套层级超过一定层数（默认为 16 层，可以通过配置 [baseLevel](config-detail#minibaselevel) 修改），会创建一个自定义组件协助递归。

此自定义组件的 `scope` 没有暴露给开发者，因此层级过深且需要调用此类 API 时，需要使用 `<CustomWrapper>` 组件包裹。

相关讨论：[#9357](https://github.com/NervJS/taro/issues/9357)。

### 2. 使用了 `<CustomWrapper>`

[`<CustomWrapper>`](optimized#2-customwrapper-组件) 组件常用于优化更新性能。它本质上是一个小程序自定义组件。

Taro v3.6.3+ 推荐使用以下方式获取：

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx title="示例代码"
class Index extends React.Component {
  onReady () {
    // 获取到 CustomWrapper 这个自定义组件对象，也就是所说的 scope
    const ctx = document.getElementById('demo').ctx
  }

  render () {
    return (
      <View className='index'>
        <CustomWrapper id='demo'>
          <Text>Hello world!</Text>
        </CustomWrapper>
      </View>
    )
  }
}
```

</TabItem>

<TabItem value="Vue">

```html title="示例代码"
<template>
  <custom-wrapper id="demo" />
</template>

<script>
  import Taro from '@tarojs/taro'

  export default {
    onReady() {
      // 获取到 CustomWrapper 这个自定义组件对象，也就是所说的 scope
      const ctx = document.getElementById('demo').ctx
    },
  }
</script>
```

</TabItem>
</Tabs>

Taro v3.6.2 及以下版本可以通过以下方式获取（需要对应小程序平台支持 `selectComponent` API）：

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx title="示例代码"
<CustomWrapper id="demo" />

const page = Taro.getCurrentInstance().page
// 获取到 CustomWrapper 这个自定义组件对象，也就是所说的 scope
const scope = page.selectComponent('#demo')
```

</TabItem>

<TabItem value="Vue">

```html title="示例代码"
<template>
  <custom-wrapper id="demo" />
</template>

<script>
  import Taro from '@tarojs/taro'

  export default {
    onReady() {
      const page = Taro.getCurrentInstance().page
      // 获取到 CustomWrapper 这个自定义组件对象，也就是所说的 scope
      const scope = page.selectComponent('#demo')
    },
  }
</script>
```

</TabItem>
</Tabs>

## dataset

小程序的 `dataset` 概念在 Taro 中得到部分实现，详细请看：

- [React dataset](./react-overall#dataset)
- [Vue dataset](./vue-overall#dataset)

## wxs

:::info
Taro v3.6.25 开始支持。目前只支持在 Taro React 小程序中使用，暂不支持 Taro Vue，暂不支持在其他端使用。
:::

Taro 支持使用各类小程序的视图层脚步语言，如微信小程序的 `wxs`、支付宝小程序的 `sjs`、京东小程序的 `jds`、头条小程序的 `sjs` 等，详情请看：

- [使用 WXS](./optimized#使用-wxs)
</file>

<file path="docs/communicate.mdx">
---
title: 沟通与反馈
---

import ImageList from './mdx/image-list'

## 开发交流

选择下列对应的群，使用微信扫码添加，会收到入群二维码，再扫群码添加即可。

<ImageList
  height={148}
  list={[
    {
      image: 'http://storage.360buyimg.com/taro-jd-com/static/contact_taro_qr.png',
      label: 'Taro',
    },
    {
      image: 'http://storage.360buyimg.com/taro-jd-com/static/contact_taro_vue_qr.png',
      label: 'Taro Vue',
    },
    {
      image: 'http://storage.360buyimg.com/taro-jd-com/static/contact_taro_rn_qr.png',
      label: 'Taro RN',
    },
    {
      image: 'http://storage.360buyimg.com/taro-jd-com/static/contact_taro_harmony_qr.png',
      label: 'Taro x Harmony',
    },
    {
      image: 'http://storage.360buyimg.com/taro-jd-com/static/contact_taro_lark_qr.png',
      label: 'Taro Lark',
    },
    {
      image: 'http://storage.360buyimg.com/taro-jd-com/static/contact_taro_nutui_qr.png',
      label: 'Taro x NutUI',
    },
  ]}
/>

## 问题反馈与建议

遇到 Bug 请[给 Taro 提 ISSUE](https://nervjs.github.io/taro-issue-helper/)。

有疑问或想法请到 [Github Discussion](https://github.com/NervJS/taro/discussions) 讨论。

## 社区共享

### 论坛

[Taro 交流社区——让每一次交流都被沉淀](https://taro-club.jd.com/)

你可以在交流社区里提问、讨论、吐槽。

### 物料市场

[Taro 物料市场——让每一个轮子产生价值](https://taro-ext.jd.com/)

你可以在物料市场里找到一些开源的模板、组件和项目，也欢迎你分享你的成果。

## 加入共建

### 加入 Taro 社区共建

[Taro 邀你加入社区共建](https://github.com/NervJS/taro/issues/4714)

### 为 Taro 贡献代码

Taro 非常欢迎社区开发者为 Taro 贡献代码，在贡献之前请先阅读[贡献指南](/docs/CONTRIBUTING)。

如果你想为 Taro 实现一个重要功能，需要先撰写 RFC 文档，按照 Taro 的 [RFC 机制](https://github.com/NervJS/taro-rfcs)进行操作，在经过社区讨论完善后才可以进行代码的提交。
</file>

<file path="docs/compile-optimized.mdx">
---
title: 小程序编译优化指南
---

Taro 使用 Webpack 进行打包，当工程越来越庞大时，会出现打包时间过长等问题。另外，小程序严格的体积要求、不支持热更新等问题也对大型应用的工程化流程提出了非常大的优化挑战。

## 优化编译速度

**缓存**与**并行**是进行性能优化的两个重要切入角度。智行小程序团队借助 `cache-loader`、`thread-loader` 开发了 [taro-plugin-compiler-optimization](treasures#插件) 插件让 Taro 项目的编译时长减少为原来的三分之一。

> 详情请阅读文章[《编写插件，将 Taro 编译打包耗时缩短至三分之一》](https://mp.weixin.qq.com/s/Z79QhAlP8tBQn3mXQ11byQ)。

#### 用法

```shell title="安装依赖"
npm install --save-dev thread-loader cache-loader taro-plugin-compiler-optimization
```

```js title="使用插件"
// config/index.js
config = {
  // ...
  plugins: ['taro-plugin-compiler-optimization'],
}
```

#### 效果展示

优化前 **3m9s**，优化后 **56.8s**，将耗时缩短至三分之一。

优化前耗时：

![优化前](https://gitee.com/canntyield/cand_md_image/raw/master/2021_10/before.PNG)

优化后耗时：

![优化后](https://gitee.com/canntyield/cand_md_image/raw/master/2021_10/after.PNG)

## 解决包体积过大无法进行预览的问题

智行小程序团队通过在开发环境下配置压缩指定文件，解决了小程序端包体积过大无法进行预览的问题。详情请阅读文章[《编写插件，将 Taro 编译打包耗时缩短至三分之一》](https://mp.weixin.qq.com/s/Z79QhAlP8tBQn3mXQ11byQ)。

## 通过 webpackChain 配置解决开发环境下小程序包体积过大无法进行预览上传的问题(不影响 devtools 的使用)

```js
// config/dev.js
module.exports = {
  mini: {
    webpackChain: (chain, webpack) => {
      chain.merge({
        plugin: {
          install: {
            plugin: require('terser-webpack-plugin'),
            args: [
              {
                terserOptions: {
                  compress: true, // 默认使用terser压缩
                  // mangle: false,
                  keep_classnames: true, // 不改变class名称
                  keep_fnames: true, // 不改变函数名称
                },
              },
            ],
          },
        },
      })
    },
  },
}
```
</file>

<file path="docs/complier-mode.mdx">
---
title: 半编译模式
---

:::info
Taro v3.6.23 开始支持，目前只支持 **React**，暂不支持 Vue。底层实现原理请参考 [RFC 文档](https://github.com/NervJS/taro/discussions/14708)。
:::

在节点数量增多到一定量级时，Taro3 的渲染性能会大幅下降，出现白屏时间长、交互延时等问题。经排查发现是目前 Taro 的 `<template>` 模板语法所造成的，为此我们参考 Taro 1/2 的思路，提供了 **CompileMode** 渲染模式。`CompileMode` 适合长列表 Item 这类会被重复渲染多次的组件使用，在长列表场景能提升 **30%** 以上的首开速度，同时能有效减少节点过多时产生的交互延时问题。CompileMode 可以说是应对复杂页面性能优化的“银弹”。

## 使用方法

首先在 Taro 编译配置中开启使用半编译模式：

```js title="config/index.js"
const config = {
  mini: {
    experimental: {
      compileMode: true
    }
  }
  // ...
}
```

然后只需要给 Taro 基础组件添加 `compileMode` 属性，该组件及其 children 将会被编译为单独的小程序模板：

```jsx
function GoodsItem () {
  return (
    <View compileMode>
      ...
    </View>
  )
}
```

更为详细的用法请看 [详细用法](#详细用法)

## 常见问题

### 1. 编译出的模板文件会增加包体积

半编译模式使用了空间来换时间，编译出模板会令包体积增大。增加的文件大小视 JSX 写法而定，可以在编译后的页面目录下找到对应的模板文件，如 `pages/index/index.jsx` 编译出的模板位置在 `dist/pages/index/index-templates.wxml`。因此开发者应权衡后使用。

### 2. 只能优化部分语法

编译阶段只能识别、优化部分语法，不支持的语法会自动回退到 Taro3 默认的渲染模式，具体支持的语法可以查阅 [RFC 文档](https://github.com/NervJS/taro/discussions/14708)。

有一种常见语法需要注意：编译阶段只能识别 Taro 基础组件，而 React、Vue 组件的渲染会自动回退到旧的渲染模式。如果这些 React、Vue 组件也需要使用半编译模式，需要在组件内部再次添加 `compileMode` 属性：

```jsx
function Index () {
  return (
    <View compileMode>
      <Text>Hello</Text> {/* 能被编译阶段识别 */}
      <Foo /> {/*会自动回退到 Taro3 默认的渲染模式*/}
    </View>
  )
}

function Foo () {
  return (
    // 如果希望 Foo 组件也使用半编译模式，需要在 Foo 组件内部再次添加 compileMode 属性
    <View compileMode>
      ...
    </View>
  )
}

```

## 详细用法
### 条件表达式 + 自定义组件
通过状态来控制展示哪一个自定义组件的场景在业务中是很常见的，比如以下场景
```jsx
export default function Index () {
  const [show, setShow] = useState(true)

  return (
    <View compileMode>
      <Button onClick={()=>setShow(!show)}>toggle show</Button>
      <View>
        {
          show ? <Item/> : null
        }
      </View>
    </View>
  )
}

function Item () {
  return (
    <View compileMode>
      item
    </View>
  )
}
```
正常来说，上面这段代码是没问题的，但是由于 compileMode 得在编译的时候，给元素加上 compileIf 的属性，所以必须是一个确切的标签，所以以上写法暂不支持。后续计划设法把这个属性直接写入在 template 节点上，以支持以上写法。现阶段，先用以下的降级方法：
```jsx
export default function Index () {
  const [show, setShow] = useState(true)

  return (
    <View compileMode>
      <Button onClick={()=>setShow(!show)}>toggle show</Button>
      <View>
        <Item show={show}/>
      </View>
    </View>
  )
}

function Item (props) {
  const { show } = props
  return (
    show 
    ?
    <View compileMode>
      item
    </View>
    : null
  )
}
```
即把组件的展示，放到子组件中去进行判断。

### 使用 jsx 变量
直接使用 jsx 变量，在半编译的情况下是会报错，如以下代码：
```jsx
export default function Index () {

  const item = (<View>item</View>)
  return (
    <View compileMode>
      <View>
        {item}
      </View>
    </View>
  )
}
```
要改为 render 开头的渲染函数，如下：
```jsx
export default function Index () {

  const renderItem = () => <View>item</View>
  return (
    <View compileMode>
      <View>
        {renderItem()}
      </View>
    </View>
  )
}
```
不过这种写法，并不会把 `renderItem` 的返回值直接打入模版里面，所以这种写法对性能会有一定的消耗。

### 表单驱动 jsx 元素
这个场景下，其实就是 「使用 jsx 变量」 的一个延伸，如以下代码：
```jsx
export default function Index () {

  const itemMap = {
    a: <View compileMode>itemA</View>,
    b: <View compileMode>itemB</View>,
    c: <View compileMode>itemC</View>
  }
  return (
    <View compileMode>
      {itemMap.a}
      {itemMap.b}
      {itemMap.c}
    </View>
  )
}
```
需要改为以下写法：
```jsx
export default function Index () {
  const itemMap = {
    renderA: ()=> <View compileMode>itemA</View>,
    renderB: ()=> <View compileMode>itemB</View>,
    renderC: ()=> <View compileMode>itemC</View>
  }
  return (
    <View compileMode>
      <View>
      {itemMap.renderA()}
      {itemMap.renderB()}
      {itemMap.renderC()}
      </View>
    </View>
  )
}
```

## 半编译预处理
:::info
`4.0.7` 开始支持
:::info

允许在组件中自定义的以 `render` 开头的函数，来实现组件内部的模块化能力。
### 使用方法
1. 函数必须是 `render` 开头
2. 函数 `return` 的第一个标签必须带上 `compileMode="subRenderFn"` 属性

### 限制
1. `render` 开头的函数暂不支持拥有自己的作用域代码
2. 传递给 `render` 开头的函数的参数，现阶段必须是一个变量

### 例子
```jsx
const ComponentA = (props) => {
    const { data1, data2 } = props
    const renderXxxx = (props1, props2, ...) => { 
        //1. 这里暂不支持编码，涉及到作用域的问题
        return (
            //return 的第一个标签必须带上 compileMode="subRenderFn" 属性
            <View compileMode="subRenderFn">
                {props1}
                {props2}
                 ...
            </View>
        )
    }
    
    return (
        <View compileMode>
            // 2. props 暂时只支持传递变量，涉及到变量替换的问题
            {renderXxxx(data1, data2)}
        </View>
    )
}
```


## 最佳实践
总的来说，要最大限度的发挥半编译模式的优势，就是要把尽量把静态节点，尽可能的写到同一个 jsx 里面去。自我检查的最简单的方式就是看看编译后的模版数量是否足够少，每个模版是否包含了足够多节点。
如果一个 template 只是包含了少数节点，那其实无法带来很大的提升。可以结合半编译预处理，使用组件内的 `render` 开头的函数，进行模块化拆分 如以下代码：
```jsx
import { View, Image, Text } from "@tarojs/components";

import './index.scss'

const dataList = [
    {
        src: "https://media.tiffany.cn/is/image/Tiffany/EcomBrowseM/35189432_1009333_ED.jpg?defaultImage=NoImageAvailableInternal",
        title: "这是标题1",
        subTitle: "这是子标题1",
        tag:[
            {
                name: "标签1",
                type: 1
            },
            {
                name: "标签2",
                type: 2
            },
            {
                name: "标签3",
                type: 3
            }
        ],
        des: "这是描述1",
        subDes:'这是子描述1',
        prices: {
            normal: {
                int: '86',
                float: '88'
            },
            line: 100
        }
    },
    {
        src: "https://media.tiffany.cn/is/image/Tiffany/EcomBrowseM/62866950_989218_ED.jpg?defaultImage=NoImageAvailableInternal",
        title: "这是标题2",
        subTitle: "这是子标题2",
         tag:[
            {
                name: "标签1",
                type: 1
            },
            {
                name: "标签2",
                type: 2
            },
            {
                name: "标签3",
                type: 3
            }
        ],
        tagType: 2,
        des: "这是描述2",
        subDes:'这是子描述2',
        prices: {
            normal: {
                int: '60',
                float: '70'
            },
            line: 100
        }
    },
    {
        src: "https://media.tiffany.cn/is/image/Tiffany/EcomBrowseM/62507586_989743_ED_M.jpg?defaultImage=NoImageAvailableInternal",
        title: "这是标题3",
        subTitle: "这是子标题3",
         tag:[
            {
                name: "标签1",
                type: 1
            },
            {
                name: "标签2",
                type: 2
            },
            {
                name: "标签3",
                type: 3
            }
        ],
        des: "这是描述3",
        subDes:'这是子描述3',
        prices: {
            normal: {
                int: '85',
                float: '10'
            },
            line: 100
        }
    },
    {
        src: "https://media.tiffany.cn/is/image/Tiffany/EcomBrowseM/33263465_997778_ED.jpg?defaultImage=NoImageAvailableInternal",
        title: "这是标题4",
        subTitle: "这是子标题4",
         tag:[
            {
                name: "标签1",
                type: 1
            },
            {
                name: "标签2",
                type: 2
            },
            {
                name: "标签3",
                type: 3
            }
        ],
        des: "这是描述4",
        subDes:'这是子描述4',
        prices: {
            normal: {
                int: '8',
                float: '88'
            },
            line: 100
        }
    },
    {
        src: "https://media.tiffany.cn/is/image/Tiffany/EcomBrowseM/60957401_1023440_ED.jpg?defaultImage=NoImageAvailableInternal",
        title: "这是标题5",
        subTitle: "这是子标题5",
        tag:[
            {
                name: "标签1",
                type: 1
            },
            {
                name: "标签2",
                type: 2
            },
            {
                name: "标签3",
                type: 3
            }
        ],
        des: "这是描述5",
        subDes:'这是子描述5',
        prices: {
            normal: {
                int: '77',
                float: '88'
            },
            line: 100
        }
    }
]


const Item = (props) =>{
    const { itemIndex } = props
    const sectionIndex = itemIndex % 5
    const data = dataList[sectionIndex]
    const { tag, src, title, subTitle, des, subDes, prices } = data

    const renderCard = ()=> {
        return (
            <View className='item-body-wrap' compileMode="subRenderFn">
            {renderImage()}
            {renderContent()}
        </View>
        )
    }
    const renderImage = ()=> {
        return (
            <View className='image-wrap' compileMode="subRenderFn">
                <Image src={src} mode='aspectFill' className='image-wrap' />
            </View>
        )
    }

    const renderContent = () =>{
        return (
            <View className='body-left'compileMode="subRenderFn">
                {renderTitle()}
                {renderDes()}
                {renderTags(tag)}
                {renderPrices()}
                {renderBtn()}
            </View>
        )

    }

    const renderTitle = () =>{
        return (
            <View className='title-wrap' compileMode="subRenderFn">
                <View className='title'>
                    {title}
                </View>
                <View className='sub-title'>
                    {subTitle}
                </View>
            </View>
        )
    }


    const renderDes = () => {
        return (
            <View className='des-wrap' compileMode="subRenderFn">
                <View className='des'>
                    {des}
                </View>
                <View className='sub-des'>
                    {subDes}
                </View>
            </View>
        )
    }

    const renderPrices = () =>{
        return (
            <View className='price-wrap' compileMode="subRenderFn">
                <View className='price-normal'>
                    <Text className='price-normal-int'>{prices.normal.int}</Text>
                    <Text className='price-normal-float'>.{prices.normal.float}</Text>
                </View>
                <View className='price-line'>
                    {prices.line}
                </View>
            </View>
        )
    }

    const renderTag1 = (tag, key)=>{
        return <View compileMode="subRenderFn" className="tag1" key={key}>{tag}</View>
    }
    const renderTag2 = (tag, key)=>{
        return <View compileMode="subRenderFn" className="tag2" key={key}>{tag}</View>
    }
    const renderTag3 = (tag, key)=>{
        return <View compileMode="subRenderFn" className="tag3" key={key}>{tag}</View>
    }

    const renderTags = (tags)=>{
        return (<View className="tag-wrap" compileMode="subRenderFn">
            {
                tags.map((e, index)=>{
                    const { name, type } = e
                    return (
                        <>
                            {
                                type === 1 ? renderTag1(name, index) :
                                type === 2 ? renderTag2(name, index) :
                                type === 3 ? renderTag3(name, index) : null
                            }
                        </>
                    )
                })
            }
        </View>)
    }

    const renderBtn = ()=>{
        return (
            <View className='add' compileMode="subRenderFn">
                <Image src='https://img12.360buyimg.com/imagetools/jfs/t1/169993/8/27041/5311/61b1b219E03cffee0/778c223bd7677925.png' mode='aspectFill' className='add-image' />
            </View>
        )
    }

    return (
        <View key={`s${sectionIndex}i${itemIndex}`} compileMode>
           {renderCard()}
        </View>
    )
    
}

export default Item 
```

```css
.item {
    &-header{
        background-color: black;
        color: white;
        display: flex;
        align-items: center;
        height: 100%;
        border: 1px red solid;
        z-index: 10;
        box-sizing: border-box;
    }
    &-body{
        display: flex;
        align-items: center;
        border: 1px red solid;
        box-sizing: border-box;
        &-wrap {
            width: 100%;
            display: flex;
            align-items: center;
            .image-wrap {
                width: 70px;
                height: 70px;
            }

            .body-left {
                flex: 1;
                position: relative;
                margin-left: 20px;
                .title-wrap {
                    display: flex;
                    align-items: center;
                    .sub-title {
                        font-size: 14px;
                        color: gray;
                        margin-left: 5px;
                    }
                    .title {
                        font-size: 20px;
                    }
                }
                
                .des-wrap {
                    display: flex;
                    .sub-des {
                        margin-left: 4px;
                        font-size: 12px;
                        color: gray;
                    }
                    .des {
                        font-size: 16px;
                    }
                }


                .tag-wrap {
                    .tag1 {
                        border: 1px gray solid;
                        border-radius: 1px;
                        margin-right: 2px;
                        font-size: 12px;
                    }
                    .tag2 {
                        border: 1px red dashed;
                        border-radius: 1px;
                        margin-right: 2px;
                        font-size: 12px;
                    }
                    .tag3 {
                        border: 1px green solid;
                        border-radius: 1px;
                        margin-right: 2px;
                        font-size: 12px;
                    }
                    display: flex;
                }
                .price {
                    &-wrap{
                        display: flex;
                        align-items: flex-end;
                    }

                    &-normal {
                        color: red;
                        display: flex;
                        align-items: flex-end;
                        &-int{
                            line-height: 12px;
                            font-size: 12px;
                        }
                        &-float{
                            line-height: 10px;
                            font-size: 10px;
                        }   
                    }
                    &-line {
                        line-height: 10px;
                        font-size: 10px;
                        color: gray;
                        text-decoration: line-through;
                    }
                }
                .add {
                    position: absolute;
                    right: 5px;
                    bottom: 5px;
                    .add-image{
                        width: 20px;
                        height: 20px;
                    }
                }

            }
        }
    }
}
```
</file>

<file path="docs/component-style.md">
---
title: 组件的外部样式和全局样式
---

自定义组件对应的样式文件，只对该组件内的节点生效。编写组件样式时，需要注意以下几点：

- 组件和引用组件的页面不能使用 id 选择器（`#a`）、属性选择器（`[a]`）和标签名选择器，请改用 class 选择器。
- 组件和引用组件的页面中使用后代选择器（`.a .b`）在一些极端情况下会有非预期的表现，如遇，请避免使用。
- 子元素选择器（`.a > .b`）只能用于 `View` 组件与其子节点之间，用于其他组件可能导致非预期的情况。
- **继承样式，如 `font` 、 `color` ，会从组件外（父组件）继承到组件内。但是引用组件时在组件节点上书写的 `className` 无效。** _（具体解决方案请参见下面的外部和全局样式介绍。）_
- 除继承样式外， `app.scss` 中的样式、组件所在页面的样式，均对自定义组件无效。

```css
/* 在组件中不能使用 */
#a {
}
/* 在组件中不能使用 */
[a] {
}
/* 在组件中不能使用 */
button {
}
/* 除非 .a 是 view 组件节点，否则不一定会生效 */
.a > .b {
}
```

除此以外，组件可以指定它所在节点的默认样式，使用 `:host` 选择器（需要包含基础库 [1.7.2](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) 或更高版本的开发者工具支持）。

```css
/* 该自定义组件的默认样式 */
:host {
  color: yellow;
}
```

## 外部样式类

如果想传递样式给引用的自定义组件，以下写法（直接传递 `className`）**不可行**：

```jsx
/* CustomComp.js */
export default class CustomComp extends Component {
  static defaultProps = {
    className: '',
  }

  render() {
    return <View className={this.props.className}>这段文本的颜色不会由组件外的 class 决定</View>
  }
}
```

```jsx
/* MyPage.js */
export default class MyPage extends Component {
  render() {
    return <CustomComp className="red-text" />
  }
}
```

```scss
/* MyPage.scss */
.red-text {
  color: red;
}
```

取而代之的，需要利用 `externalClasses` 定义段定义若干个外部样式类。这个特性从小程序基础库版本 [1.9.90](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html)  开始支持。

```jsx
/* CustomComp.js */
export default class CustomComp extends Component {
  static externalClasses = ['my-class']

  render() {
    return <View className="my-class">这段文本的颜色由组件外的 class 决定</View>
  }
}
```

```jsx
/* MyPage.js */
export default class MyPage extends Component {
  render() {
    return <CustomComp my-class="red-text" />
  }
}
```

```scss
/* MyPage.scss */
.red-text {
  color: red;
}
```

> 注意：`externalClasses` 需要使用 **短横线命名法 (kebab-case)**，而不是 React 惯用的 驼峰命名法 (camelCase)。否则无效。

## 全局样式类

使用外部样式类可以让组件使用指定的组件外样式类，如果希望组件外样式类能够完全影响组件内部，可以将组件构造器中的 `options.addGlobalClass` 字段置为 `true`。这个特性从小程序基础库版本 [2.2.3](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html)  开始支持。

```jsx
/* CustomComp.js */
export default class CustomComp extends Component {
  static options = {
    addGlobalClass: true,
  }

  render() {
    return <View className="red-text">这段文本的颜色由组件外的 class 决定</View>
  }
}
```

```scss
/* 组件外的样式定义 */
.red-text {
  color: red;
}
```
</file>

<file path="docs/components-desc.mdx">
---
title: 组件库说明
---

import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

Taro 以 [微信小程序组件库](https://developers.weixin.qq.com/miniprogram/dev/component/) 为标准，结合 `jsx` 语法规范，定制了一套自己的组件库规范。

基于以上原则，在小程序端，我们可以使用所有的小程序原生组件，而在其他端，我们提供了对应的组件库实现

- H5 端，`@tarojs/components`，同时也是需要引入的默认标准组件库

在使用时，React 中我们需要先从 Taro 标准组件库 `@tarojs/components` 引用组件，再进行使用，例如使用 `<View />`、 `<Text />` 组件，而 Vue 我们则无需引入

<Tabs
  defaultValue="React"
  values={[
    {label: 'React', value: 'React'},
    {label: 'Vue', value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx
import React, { Component } from 'react'
import { View, Text } from '@tarojs/components'

export default class C extends Component {
  render() {
    return (
      <View className="c">
        <Text>c component</Text>
      </View>
    )
  }
}
```

</TabItem>

<TabItem value="Vue">

```html
<template>
  <view class="c">
    <text>c component</text>
  </view>
</template>
```

</TabItem>

</Tabs>

## 注意

在组件的详细文档中列出了组件在不同端的支持程度，以及基本的使用示例。 部分未列出示例的，标明仅在小程序端支持的组件的用法可以直接参考[小程序组件文档](https://developers.weixin.qq.com/miniprogram/dev/component/)。

需要注意的是仍需遵循 Taro 的开发规范：

### 首字母大写与驼峰式命名

例如，使用 H5 端尚未支持的 map 组件

```jsx
import React, { Component } from 'react'
import Taro from '@tarojs/taro'
// 引入 map 组件
import { Map } from '@tarojs/components'

class App extends Components {
  onTap() {}
  render() {
    return <Map onClick={this.onTap} />
  }
}
```

### 组件的事件传递都要以 on 开头

在微信小程序中 bind 开头这样的用法，都需要转成以 on 开头的形式。
</file>

<file path="docs/composition-api.md">
---
title: Vue3 Composition APIs
---

:::info
Taro v3.4.0+ 开始支持
:::

Vue3 提供了 [Composition API（组合式 API）](https://v3.vuejs.org/guide/composition-api-introduction.html#why-composition-api) 特性，和传统的 Options API 不同，Composition API 提供了全新的编码方式 ，可以让我们更好地去组织和复用代码逻辑。

本文将会介绍 Taro 提供的一些**自定义 Composition APIs**。而关于 Composition API 的相关用法和内置 API 等信息，请参阅 Vue 文档：

- [介绍](https://v3.vuejs.org/guide/composition-api-introduction.html)
- [Setup 函数](https://v3.vuejs.org/guide/composition-api-setup.html)
- [生命周期](https://v3.vuejs.org/guide/composition-api-lifecycle-hooks.html)
- [Provider / Inject](https://v3.vuejs.org/guide/composition-api-provide-inject.html)
- [Template Refs](https://v3.vuejs.org/guide/composition-api-template-refs.html)
- [`<script setup>`](https://v3.vuejs.org/api/sfc-script-setup.html#basic-syntax)

## Taro Composition APIs

Taro 内置的一些 Composition API，可以从 `@tarojs/taro` 包中引入使用。

例子：

```html title="在 setup 函数中使用"
<script>
  import { useDidShow } from '@tarojs/taro'

  export default {
    setup() {
      useDidShow(() => console.log('onShow'))
    },
  }
</script>
```

```html title="在 <script setup> 中使用"
<script setup>
  import { useDidShow } from '@tarojs/taro'

  useDidShow(() => console.log('onShow'))
</script>
```

### useRouter

等同于 `Taro.getCurrentInstance().router`。

```jsx title="示例代码"
// { path: '', params: { ... } }
const router = useRouter()
```

### useLoad

:::info
Taro v3.5.0+ 开始支持
:::

等同于页面的 `onLoad` 生命周期钩子。

```jsx title="示例代码"
useLoad(() => {
  console.log('onLoad')
})
```

### useReady

等同于页面的 `onReady` 生命周期钩子。

从此生命周期开始可以使用 `createCanvasContext` 或 `createSelectorQuery` 等 API 访问小程序渲染层的 DOM 节点。

```js title="示例代码"
useReady(() => {
  const query = wx.createSelectorQuery()
})
```

### useDidShow

页面显示/切入前台时触发。等同于 `onShow` 页面生命周期钩子。

```jsx title="示例代码"
useDidShow(() => {
  console.log('onShow')
})
```

### useDidHide

页面隐藏/切入后台时触发。等同于 `onHide` 页面生命周期钩子。

```jsx title="示例代码"
useDidHide(() => {
  console.log('onHide')
})
```

### useUnload

:::info
Taro v3.5.0+ 开始支持
:::

等同于页面的 `onUnload` 生命周期钩子。

```jsx title="示例代码"
useUnload(() => {
  console.log('onUnload')
})
```

### usePullDownRefresh

监听用户下拉动作。等同于 `onPullDownRefresh` 页面生命周期钩子。

```jsx title="示例代码"
usePullDownRefresh(() => {
  console.log('onPullDownRefresh')
})
```

### useReachBottom

监听用户上拉触底事件。等同于 `onReachBottom` 页面生命周期钩子。

```jsx title="示例代码"
useReachBottom(() => {
  console.log('onReachBottom')
})
```

### usePageScroll

监听用户滑动页面事件。等同于 `onPageScroll` 页面生命周期钩子。

```jsx title="示例代码"
usePageScroll((res) => {
  console.log(res.scrollTop)
})
```

### useResize

小程序屏幕旋转时触发。等同于 `onResize` 页面生命周期钩子。

```jsx title="示例代码"
useResize((res) => {
  console.log(res.size.windowWidth)
  console.log(res.size.windowHeight)
})
```

### useShareAppMessage

监听用户点击页面内转发按钮（Button 组件 openType='share'）或右上角菜单“转发”按钮的行为，并自定义转发内容。等同于 `onShareAppMessage` 页面生命周期钩子。

**使用时，必须为页面配置 `enableShareAppMessage: true`。（修改配置文件后请重新编译项目）**

```html title="page.vue"
<script setup>
  import { useShareAppMessage } from '@tarojs/taro'

  useShareAppMessage((res) => {
    if (res.from === 'button') {
      // 来自页面内转发按钮
      console.log(res.target)
    }
    return {
      title: '自定义转发标题',
      path: '/page/user?id=123',
    }
  })
</script>
```

```js title="page.config.js" {2}
export default {
  enableShareAppMessage: true,
}
```

### useTabItemTap

点击 tab 时触发。等同于 `onTabItemTap` 页面生命周期钩子。

```jsx title="示例代码"
useTabItemTap((item) => {
  console.log(item.index)
  console.log(item.pagePath)
  console.log(item.text)
})
```

### useShareTimeline

监听右上角菜单“分享到朋友圈”按钮的行为，并自定义分享内容。等同于 `onShareTimeline` 页面生命周期钩子。

> 只有微信小程序支持，基础库 2.11.3 开始支持，本接口为 Beta 版本，暂只在 Android 平台支持

**使用时，必须为页面配置 `enableShareTimeline: true`。（修改配置文件后请重新编译项目）**

```html title="page.vue"
<script setup>
  import { useShareTimeline } from '@tarojs/taro'

  useShareTimeline(() => {
    console.log('onShareTimeline')
  })
</script>
```

```js title="page.config.js" {2}
export default {
  enableShareTimeline: true,
}
```

### useAddToFavorites

监听用户点击右上角菜单“收藏”按钮的行为，并自定义收藏内容。等同于 `onAddToFavorites` 页面生命周期钩子。

> 只有微信小程序支持，本接口为 Beta 版本，安卓 7.0.15 版本起支持，暂只在安卓平台支持

```jsx title="示例代码"
useAddToFavorites((res) => {
  // webview 页面返回 webviewUrl
  console.log('WebviewUrl: ', res.webviewUrl)
  return {
    title: '自定义标题',
    imageUrl: 'https://demo.png',
    query: 'name=xxx&age=xxx',
  }
})
```

### useSaveExitState

:::info
Taro v3.5.0+ 开始支持
:::

每当小程序可能被销毁之前，页面回调函数 `onSaveExitState` 会被调用，可以进行[退出状态](https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/operating-mechanism.html#_4-%E9%80%80%E5%87%BA%E7%8A%B6%E6%80%81)的保存。

> 只有微信小程序支持，基础库 2.7.4 开始支持。

```jsx title="示例代码"
useSaveExitState(() => {
  const exitState = { myDataField: 'myData' } // 需要保存的数据
  return {
    data: exitState,
    expireTimeStamp: Date.now() + 24 * 60 * 60 * 1000, // 超时时刻
  }
})
```

### useTitleClick

> 只有支付宝小程序支持。等同于 `onTitleClick` 页面生命周期钩子。

点击标题触发。

```jsx title="示例代码"
useTitleClick(() => console.log('onTitleClick'))
```

### useOptionMenuClick

> 只有支付宝小程序支持。等同于 `onOptionMenuClick` 页面生命周期钩子。

点击导航栏额外图标触发。

```jsx title="示例代码"
useOptionMenuClick(() => console.log('onOptionMenuClick'))
```

### usePullIntercept

> 只有支付宝小程序支持。等同于 `onPullIntercept` 页面生命周期钩子。

下拉截断时触发。

```jsx title="示例代码"
usePullIntercept(() => console.log('onPullIntercept'))
```
</file>

<file path="docs/composition.md">
---
title: 更多资源
---

最新的更多资源，请参考：[NervJS/awesome-taro](https://github.com/NervJS/awesome-taro)

## 开源项目

### Taro3

- [Taro UI Vue3](https://b2nil.github.io/taro-ui-vue3/)
- [Taro UI Vue](https://github.com/psaren/taro-ui-vue)
- [基于 Taro + Taro-ui + Typescript + redux 开发的网易云音乐小程序](https://github.com/lsqy/taro-music)
- [Taro Design 开源页面设计器](https://github.com/ShaoGongBra/taro-design)

### Taro2

- 💯 [Hi 头像](https://github.com/hi-our/hi-face) 自带[教程小册](https://www.xiaoxili.com/hi-face)
- 💯 [基于 Taro2.0 + dva + Taro-ui + immer 开发的电商小程序](https://github.com/jiechud/taro-mall)
- 💯 [基于 Taro2.0 + TypeScript + 云开发的地图同学录小程序](https://github.com/Mayandev/classmate-map)
- [基于 Taro + Taro-ui + Typescript + redux 开发的网易云音乐小程序](https://github.com/lsqy/taro-music/tree/feature_taro2.x)
- [基于 Taro2.0 + dva + Taro-ui + wemark 开发的 markdown 文章博客小程序](https://github.com/hirCodd/JavaNorthMiniApp.git)

### Taro1

- 💯 [首个 Taro 多端统一实例 - 网易严选（小程序 + H5 + React Native）](https://github.com/js-newbee/taro-yanxuan)
- 💯 [基于 Taro + Dva 构建的时装衣橱(电商实战项目)](https://github.com/EasyTuan/taro-msparis)
- 💯 [基于 Taro + Taro-ui + dva 开发的公益 App](https://github.com/hugetiny/quit-smoking)
- 💯 [github 上能找到的 taro 适配 Android、iOS、微信小程序、H5 最佳实践项目脚手架](https://github.com/bozaigao/Taro-demo)
- [Taro 掘金小册源码](https://github.com/o2team/taro-ebook-source)
- [基于 taro + dva 开发的音乐播放器小程序](https://github.com/huangzhuangjia/taro-music)
- [Taro + Taro-UI GitHub 小程序客户端 Gitter 源码](https://github.com/huangjianke/Gitter)
- [基于 Taro + dva + Taro-ui + Typescript 开发的网易云音乐小程序](https://github.com/abc-club/taro-music-ts)

## 官方资源

- [Taro 项目仓库](https://github.com/NervJS/taro)
- [Taro 官方文档](/docs)
- [Taro UI 项目仓库](https://github.com/NervJS/taro-ui)
- [Taro UI 官方文档](https://taro-ui.jd.com)

## 生态资源

- [Taro UI](https://taro-ui.jd.com)
- [Taro UI Vue3](https://b2nil.github.io/taro-ui-vue3/)
- [Taro UI Vue](https://github.com/psaren/taro-ui-vue)
- [更多](/docs/redux)

## 文章教程

- [官方博客](/blog)
- [不敢阅读 npm 包源码？带你揭秘 taro init 背后的哲学](https://juejin.im/post/5c21f4e5f265da61117a54a0)
- [从 0 到 1 构建适配不同端（微信小程序、H5、React-Native 等）的 taro + dva 应用](https://juejin.im/post/5bb1766d5188255c3272cdd0)
- [【小程序 taro 最佳实践】http 请求封装（方便使用，增加 token，统一错误日志记录和上报）](https://segmentfault.com/a/1190000016533592)
- [【小程序 taro 最佳实践】异步 action 优雅实践(简化流程)](https://segmentfault.com/a/1190000016534001)
- [使用 Taro 框架开发小程序](https://juejin.im/post/5ba0a53af265da0ab5037234)
- [Taro 下利用 Decorator 快速实现小程序分享](https://juejin.im/post/5b99da5d5188255c6f1e084e)
- [微信小程序授权登陆方案以及在 Taro 下利用 Decorator 修饰器实现](https://juejin.im/post/5b97a762e51d450e9649a8fd)
- [试用 React 语法的多端框架 Taro 问题汇总](https://segmentfault.com/a/1190000016247153)
- [Taro 在京东购物小程序上的实践](https://juejin.im/entry/5b987859e51d450ea2465ddd)
- [Taro 实践 - TOPLIFE 小程序 开发体验](https://juejin.im/post/5b3b786a6fb9a04f89780a9f)
- [Taro 技术揭秘：taro-cli](https://juejin.im/post/5b3ce041e51d45194832aaf6)
- [为何我们要用 React 来写小程序 - Taro 诞生记](https://juejin.im/post/5b30b476518825749e4a1d91)
- [GitLab-CI 微信小程序进行持续集成和持续部署](https://zacksleo.github.io/2018/04/08/GitLab-CI%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%BF%9B%E8%A1%8C%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E5%92%8C%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2/)
- [使用 Taro 和 Typescript 进行小程序开发](https://zacksleo.github.io/2018/06/16/%E4%BD%BF%E7%94%A8Taro%E5%92%8CTypescript%E8%BF%9B%E8%A1%8C%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/)
- [微信小程序及 h5,基于 taro，zoro 最佳实践探索](https://www.jianshu.com/p/7c27dbbc080f)
- [手把手教你用 Taro 框架写一个图像处理类微信小程序](https://juejin.im/post/5c3c8c58f265da611a4813a9)
- [Taro 多端开发的正确姿势：打造三端统一的网易严选（小程序、H5、React Native）](https://juejin.im/post/5c6a151f518825625e4ac830)
- [Taro 与 Redux 结合使用教程](https://github.com/imageslr/taro-library#%E5%BC%95%E5%85%A5-redux)
- [微信小程序开发之影分身术](https://juejin.im/post/5c788d28e51d4560a82be8d2)

## 视频教程

- [凹凸极客沙龙《用 Webpack 打包小程序》2020-04-17](https://www.bilibili.com/video/BV15A411b7cy) by [luckyadam](https://github.com/luckyadam)

## 开发技巧

- [微信小程序 wx.request 对于 JSON 含 \u2028 处理异常](https://segmentfault.com/a/1190000015443614)
- [Taro 最佳实践](https://github.com/js-newbee/taro-best-practices)
- [封装 Taro.request（拦截器，url 配置等）](https://github.com/TigerHee/taro-request)

## 示例项目

### Taro 3

- [TodoMVC React 版](https://github.com/NervJS/TodoMVC/tree/react) (小程序 / H5)
- [TodoMVC Vue 版](https://github.com/NervJS/TodoMVC/tree/vue) (小程序 / H5)
- Taro 组件库示例 [taro-components-sample](https://github.com/NervJS/taro-components-sample) （默认是 React，Vue 请切到 Vue 分支）
- [仿知乎小程序 React 版](https://github.com/NervJS/taro-zhihu-sample/tree/next)
- [仿知乎小程序 Vue 版](https://github.com/NervJS/taro-zhihu-sample/tree/vue)
- [V2ex 小程序（TypeScript） React 版](https://github.com/NervJS/taro-v2ex/tree/next)
- [V2ex 小程序（TypeScript）Vue 版](https://github.com/NervJS/taro-v2ex/tree/vue)
- [与微信小程序原生融合的示例（React 版）](https://github.com/NervJS/taro-sample-weapp/tree/next)
- [与微信小程序原生融合的示例（Vue 版）](https://github.com/NervJS/taro-sample-weapp/tree/vue)
- [Taro 示例项目(内置 计数器 与 异步请求): Taro + Dva + Typescript + Immutable](https://github.com/didilinkin/tarojs-ts-cli)
- 💯 [nice-router-taro 脚手架项目，DVA+数据驱动页面+数据驱动表单+数据驱动 list](https://github.com/kala888/nice-router-taro)

### Taro 2

- Taro Redux 示例 [taro-redux-sample](https://github.com/NervJS/taro-redux-sample)
- [TodoMVC](https://github.com/NervJS/TodoMVC) (小程序/H5/React Native)
- Taro 组件库示例 [taro-components-sample](https://github.com/NervJS/taro-components-sample/tree/master)
- [Taro 脚手架（特性： 封装 api、redux 优雅集成、异常日志上报）](https://github.com/wsdo/taro-kit.git)
- [仿知乎小程序](https://github.com/NervJS/taro-zhihu-sample)
- [仿知乎小程序: Taro + Taro-UI + yapi API](https://github.com/MoonCheung/zhihu-applet)
- [V2ex 小程序（TypeScript）](https://github.com/NervJS/taro-v2ex)
- [与微信小程序原生融合的示例](https://github.com/NervJS/taro-sample-weapp)
- [记日常小程序 Taro-UI + Rematch + 云开发 + tcb-router](https://github.com/zhixiaoqiang/taroCloud)
- 💯 [nice-router-taro 脚手架项目，DVA+数据驱动页面+数据驱动表单+数据驱动 list](https://github.com/kala888/nice-router-taro/tree/taro2)

### Taro 1

- Taro 端能力示例 [taro-apis-sample](https://github.com/NervJS/taro-apis-sample)
- Taro 实验性特性项目 [taro-todo](https://github.com/NervJS/taro-todo)
- [Taro 整合 Dva 示例](https://github.com/zuoge85/taro-dva)
- [taro 结合 zoro 完整方案示例](https://github.com/FaureWu/ztaro)
- [Taro-UI + Rematch 示例](https://github.com/qwIvan/taro-demo-todolist)
- [Taro+dva+wxParse 多端富文本解析示例](https://github.com/zcSkr/taro-dva-wxParse)
- [Taro+Taro-UI+es6 入门 demo](https://github.com/hyyqcweb/taro-gank)
- [知识付费小程序（TypeScript）](https://github.com/SmallRuralDog/yundocs)
- [书店小程序： Taro + Redux + 本地 Mock Server 示例项目](https://github.com/imageslr/taro-library)
- [Taro 示例项目(内置 计数器 与 异步请求): Taro + Dva + Typescript + Immutable](https://github.com/didilinkin/elf-taro-cli/tree/taro-1.2.8)

## 第三方库和组件

- [f2 图表封装 兼容 H5 和微信小程序](https://github.com/xioxin/taro-f2)
- [echarts 图表封装](https://github.com/WsmDyj/echarts-for-taro)
- [taro-plugin-canvas - 基于 Taro 的小程序海报组件](https://github.com/chuyun/taro-plugin-canvas)
- [taro-bdmark - 基于 Taro 的百度小程序 md 解析器](https://github.com/guozimo/taro-bdMark)
- [Mounted - 一款基于 Taro 的小程序组件库](https://github.com/fjc0k/mounted)
- [taro-axios - 在 Taro 中使用 axios](https://github.com/fjc0k/taro-axios)
- 🔨[TaroCreator - 基于 Taro UI 的小程序可视化设计工具](https://github.com/mpfast/TaroCreator)
</file>

<file path="docs/condition.md">
---
title: 条件渲染
---

在 Taro 中，你可以创建不同的组件来封装各种你需要的行为。然后还可以根据应用的状态变化只渲染其中的一部分。

Taro 中的条件渲染和 JavaScript 中的一致，使用 Taro 操作符 if 或条件运算符来创建表示当前状态的元素，然后让 Taro 根据它们来更新 UI。

## 元素变量

你可以使用变量来储存元素。它可以帮助你有条件的渲染组件的一部分，而输出的其他部分不会更改。

考虑如下代码：

```jsx
// LoginStatus.js
class LoginStatus extends Component {
  render() {
    const isLoggedIn = this.props.isLoggedIn
    // 这里最好初始化声明为 `null`，初始化又不赋值的话
    // 小程序可能会报警为变量为 undefined
    let status = null
    if (isLoggedIn) {
      status = <Text>已登录</Text>
    } else {
      status = <Text>未登录</Text>
    }

    return <View>{status}</View>
  }
}
// app.js
import LoginStatus from './LoginStatus'

// 这样会渲染 `已登录`
class App extends Component {
  render() {
    return (
      <View>
        <LoginStatus isLoggedIn={true} />
      </View>
    )
  }
}
```

在以上代码中，我们通过 `isLoggedIn ` 作为参数来判定 `status` 显示什么内容，当 `isLoggedIn ` 为 `true` 时 显示 「已登录」，反之显示「未登录」。

声明变量并使用 if 语句是条件渲染组件的不错的方式，但有时你也想使用更简洁的语法，在 JSX 中有如下几种方法。

### 逻辑运算符 `&&`

你可以通过用花括号包裹代码在 JSX 中嵌入几乎任何表达式 ，也包括 JavaScript 的逻辑与 &&，它可以方便地条件渲染一个元素。

```jsx
class LoginStatus extends Component {
  render() {
    const isLoggedIn = this.props.isLoggedIn

    return (
      <View>
        {isLoggedIn && <Text>已登录</Text>}
        {!isLoggedIn && <Text>未登录</Text>}
      </View>
    )
  }
}
```

以上代码和 `元素变量` 部分代码达成的效果是一样的。之所以能这样做，是因为在 JavaScript 中，true && expression 总是返回 expression，而 false && expression 总是返回 false。

因此，如果条件是 true，&& 右侧的元素就会被渲染，如果是 false，Taro 会忽略并跳过它。

### 三元运算符（条件表达式）

条件渲染的另一种方法是使用 JavaScript 的条件运算符 `condition ? true : false`。

```jsx
class LoginStatus extends Component {
  render() {
    const isLoggedIn = this.props.isLoggedIn

    return <View>{isLoggedIn ? <Text>已登录</Text> : <Text>未登录</Text>}</View>
  }
}
```

以上代码和之前的两种方法达成的效果也是一致的。

在 JSX 条件渲染的模式和 JavaScript 差不多，你可以根据团队的习惯选择更易读的方式。但当条件变得过于复杂，可能就是提取元素抽象成组件的好时机了。

### 枚举条件渲染

有时渲染的条件非常多，不管是 `if-else` 还是 `switch-case` 来做条件渲染都会显得太麻烦。这时我们可以使用「表驱动法」：枚举渲染。

```jsx
function Loading(props) {
  const { loadingText, LOADING_STATUS, loadingStatus, onRetry } = props
  return (
    <View className="loading-status">
      {
        {
          loading: loadingText,
          fail: <View onClick={onRetry}> 加载失败, 点击重试 </View>,
          'no-more': '没有更多了',
        }[loadingStatus] /** loadingStatus 是 `loading`、`fail`、`no-more`  其中一种状态 **/
      }
    </View>
  )
}
```
</file>

<file path="docs/config-detail.md">
---
title: 编译配置详情
---

## sourceRoot

`string`

默认值：`'src'`

源码存放目录。

## outputRoot

`string`

默认值：`'dist'`

代码编译后的生产目录。

## designWidth

:::info
Taro v3.4.13 开始支持传入**函数**，[#11073](https://github.com/NervJS/taro/pull/11073)
:::

`number | function`

默认值：`750`

设计稿尺寸，详情请见[设计稿及尺寸单位](./size.md)。

当传入函数时，参数是当前样式文件的绝对路径，开发者可以根据不同的文件路径返回对应的 `designWidth`，例子：

```js title="config/index.js"
config = {
  designWidth(input) {
    if (input?.file.replace(/\\+/g, '/').indexOf('@nutui/nutui-taro') > -1) {
      return 375
    }
    return 750
  },
}
```

## defineConstants

`object`

用于配置一些全局变量供业务代码中进行使用。

配置方式可参考 [Webpack DefinePlugin](https://webpack.js.org/plugins/define-plugin/)，例如：

```js title="/config/index.js"
module.exports = {
  // ...
  defineConstants: {
    A: '"a"', // JSON.stringify('a')
  },
}
```

## alias

`object`

用于配置目录别名，从而方便书写代码引用路径。

例如，使用相对路径书写文件引用如下：

```js
import A from '../../components/A'
import Utils from '../../utils'
import packageJson from '../../package.json'
import projectConfig from '../../project.config.json'
```

为了避免书写多级相对路径，我们可以如下配置 `alias`：

```js
module.exports = {
  // ...
  alias: {
    '@/components': path.resolve(__dirname, '..', 'src/components'),
    '@/utils': path.resolve(__dirname, '..', 'src/utils'),
    '@/package': path.resolve(__dirname, '..', 'package.json'),
    '@/project': path.resolve(__dirname, '..', 'project.config.json'),
  },
}
```

通过上述配置，可以将 `src/components` 和 `src/utils` 目录配置成别名，将根目录下的 `package.json` 和 `project.config.json` 文件配置成别名，则代码中的引用改写如下：

```js
import A from '@/components/A'
import Utils from '@/utils'
import packageJson from '@/package'
import projectConfig from '@/project'
```

为了让编辑器（VS Code）不报错，并继续使用自动路径补全的功能，需要在项目根目录下的 `jsconfig.json` 或者 `tsconfig.json` 中配置 `paths` 让编辑器认得我们的别名，形式如下：

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/components/*": ["./src/components/*"],
      "@/utils/*": ["./src/utils/*"],
      "@/package": ["./package.json"],
      "@/project": ["./project.config.json"]
    }
  }
}
```

> 建议别名使用 `@/` 开头而非仅用 `@` 开头，因为有小概率会与某些 `scoped` 形式的 `npm` 包（形如：[@tarojs/taro](https://npm.im/@tarojs/taro), [@babel/core](https://npm.im/@babel/core)）产生命名冲突。

## env

`object`

用于设置环境变量，如 `process.env.NODE_ENV`。

假设我们需要区分开发环境和生产环境，可以如下配置：

**config/dev.js**：

```jsx title="/config/dev.js"
module.exports = {
  // ...
  env: {
    NODE_ENV: '"development"', // JSON.stringify('development')
  },
}
```

**config/prod.js**：

```jsx title="config/prod.js"
module.exports = {
  // ...
  env: {
    NODE_ENV: '"production"', // JSON.stringify('production')
  },
}
```

这样就能在业务代码中通过 `process.env.NODE_ENV === 'development'` 来判断环境。

:::warning 注意
这里的配置的环境变量只能在 `业务代码` 中使用，无法在 `node环境` 代码中获取到其配置的值， 也不会改变 `node环境` 中 `process.env.NODE_ENV` 的值。
配置环境变量更推荐使用 [模式和环境变量](./env-mode-config.md)
:::

## copy

`object`

用于把文件从源码目录直接拷贝到编译后的生产目录。

### copy.patterns

`array`

用于指定需要拷贝的文件或者目录，每一项都必须包含 `from` 、`to` 配置，分别代表来源和需要拷贝到的目录。同时可以设置 `ignore` 配置来指定需要忽略的文件， `ignore` 是指定的 [glob](https://github.com/isaacs/node-glob) 类型字符串，或者 glob 字符串数组。

> 注意，`from` 必须指定存在的文件或者目录，暂不支持 glob 格式。`from` 和 `to` 直接置顶项目根目录下的文件目录，建议 `from` 以 `src` 目录开头，`to` 以 `dist` 目录开头。

一般有如下的使用形式：

```js
module.exports = {
  // ...
  copy: {
    patterns: [
      { from: 'src/asset/tt/', to: 'dist/asset/tt/', ignore: ['*.js'] }, // 指定需要 copy 的目录
      { from: 'src/asset/tt/sd.jpg', to: 'dist/asset/tt/sd.jpg' }, // 指定需要 copy 的文件
    ],
  },
}
```

### copy.options

`object`

拷贝配置，可以指定全局的 ignore：

```js
module.exports = {
  // ...
  copy: {
    options: {
      ignore: ['*.js', '*.css'], // 全局的 ignore
    },
  },
}
```

## plugins

`array`

配置 Taro 插件。

当不需要传入参数给插件时，以下写法等价：

```js
module.exports = {
  // ...
  plugins: [
    // 从本地绝对路径引入插件
    '/absulute/path/plugin/filename',
    // 引入 npm 安装的插件
    '@tarojs/plugin-mock',
    ['@tarojs/plugin-mock'],
    ['@tarojs/plugin-mock', {}],
  ],
}
```

给插件传参：

```js
module.exports = {
  // ...
  plugins: [
    // 引入 npm 安装的插件，并传入插件参数
    [
      '@tarojs/plugin-mock',
      {
        mocks: {
          '/api/user/1': {
            name: 'judy',
            desc: 'Mental guy',
          },
        },
      },
    ],
  ],
}
```

## presets

`array`

一个 preset 是一系列 Taro 插件的集合，配置语法同 [plugins](./config-detail#plugins)。

```js
module.exports = {
  // ...
  presets: [
    // 引入 npm 安装的插件集
    '@tarojs/preset-sth',
    // 引入 npm 安装的插件集，并传入插件参数
    [
      '@tarojs/plugin-sth',
      {
        arg0: 'xxx',
      },
    ],
    // 从本地绝对路径引入插件集，同样如果需要传入参数也是如上
    '/absulute/path/preset/filename',
  ],
}
```

## jsMinimizer

:::info
Taro v3.5 开始支持。
:::

`terser | esbuild`

默认值 `terser`

配置 JS 压缩工具。

## terser

`object`

配置 [terser](https://github.com/terser/terser) 工具以压缩 JS 代码。

### terser.enable

`boolean`

默认值 `true`

是否开启 JS 代码压缩。

### terser.config

`object`

terser 的具体配置。

```js
module.exports = {
  // ...
  terser: {
    enable: true,
    config: {
      // 配置项同 https://github.com/terser/terser#minify-options
    },
  },
}
```

> terser 配置只在**生产模式**下生效。如果你正在使用 **watch** 模式，又希望启用 terser，那么则需要设置 `process.env.NODE_ENV` 为 `'production'`。

## esbuild

:::info
Taro v3.5 开始支持。
:::

`object`

### esbuild.minify

`object`

当 `jsMinimizer` 为 `esbuild` 时适用。配置 [esbuild MinifyPlugin](https://github.com/privatenumber/esbuild-loader#js-minification-eg-terser) 工具以压缩 JS 代码。

### esbuild.minify.enable

`boolean`

默认值 `true`

是否开启 JS 代码压缩。

### esbuild.minify.config

`object`

esbuild MnifyPlugin 的具体配置。

```js
module.exports = {
  // ...
  esbuild: {
    minify: {
      enable: true,
      config: {
        // 配置项同 https://github.com/privatenumber/esbuild-loader#minifyplugin
        target: 'es5', // target 默认值为 es5
      },
    },
  },
}
```

> esbuild 配置只在**生产模式**下生效。如果你正在使用 **watch** 模式，又希望启用 esbuild，那么则需要设置 `process.env.NODE_ENV` 为 `'production'`。

## cssMinimizer

:::info
Taro v3.5 开始支持。
:::

`csso | esbuild | parcelCss`

默认值 `csso`

配置 CSS 压缩工具。

使用 [css-minimizer-webpack-plugin](https://github.com/webpack-contrib/css-minimizer-webpack-plugin) 实现，Taro 内部会根据不同配置值选用不同的压缩工具。建议开发者根据项目实际环境进行选择，可参考 [CSS Minification Benchmark](https://goalsmashers.github.io/css-minification-benchmark)。

## csso

`object`

配置 [csso](https://github.com/css/csso) 工具以压缩 CSS 代码。

### csso.enable

`boolean`

默认值 `true`

是否开启 CSS 代码压缩。

### csso.config

`object`

csso 的具体配置。

```js
module.exports = {
  // ...
  csso: {
    enable: true,
    config: {
      // 配置项同 https://cssnano.co/docs/what-are-optimisations/
    },
  },
}
```

> csso 配置只在**生产模式**下生效。如果你正在使用 **watch** 模式，又希望启用 csso，那么则需要设置 `process.env.NODE_ENV` 为 `'production'`。

## sass

`object`

用于控制对 scss 代码的编译行为，默认使用 `dart-sass`，具体配置可以参考 [sass](https://www.npmjs.com/package/sass)。

当需要往所有 scss 文件头部插入 scss 代码时，可以通过以下三个额外参数设置：

### sass.resource

`string | array`

需要全局注入的 scss 文件的绝对路径。如果要引入多个文件，支持以数组形式传入。

当存在 [projectDirectory](./config-detail#sassprojectdirectory) 配置时，才支持传入相对路径。

### sass.projectDirectory

`string`

项目根目录的绝对地址(若为小程序云开发模板，则应该是 client 目录)。

### sass.data

`string`

全局 scss 变量，若 data 与 resource 中设置了同样的变量，则 data 的优先级高于 resource。

### 全局注入 scss 的例子

#### 单文件路径形式

当只有 `resource` 字段时，可以传入 scss 文件的绝对路径。

```js
module.exports = {
  // ...
  sass: {
    resource: path.resolve(__dirname, '..', 'src/styles/variable.scss'),
  },
}
```

#### 多文件路径形式

此外，当只有 `resource` 字段时，也可以传入一个路径数组。

```js
module.exports = {
  // ...
  sass: {
    resource: [
      path.resolve(__dirname, '..', 'src/styles/variable.scss'),
      path.resolve(__dirname, '..', 'src/styles/mixins.scss'),
    ],
  },
}
```

#### 指定项目根目录路径形式

你可以额外配置 `projectDirectory` 字段，这样你就可以在 `resource` 里写相对路径了。

```js
module.exports = {
  // ...
  sass: {
    resource: ['src/styles/variable.scss', 'src/styles/mixins.scss'],
    projectDirectory: path.resolve(__dirname, '..'),
  },
}
```

#### 传入 scss 变量字符串

data 中声明的 $nav-height 变量优先级最高。

```js
module.exports = {
  // ...
  sass: {
    resource: ['src/styles/variable.scss', 'src/styles/mixins.scss'],
    projectDirectory: path.resolve(__dirname, '..'),
    data: '$nav-height: 48px;',
  },
}
```

## framework

`string`

使用的开发框架。可选值：`react`、`preact`、`nerv`、`vue`、`vue3`。

## compiler

:::info
Taro v3.5 开始支持。

Taro v4.0.0 开始支持 `vite` 值。
:::

`string | object`

默认值：`'webpack4'`

使用的编译工具。可选值：`webpack4`、`webpack5`、`vite`。

取值也可以是对象，此时可以对针对特定的编译器作额外的配置：

### compiler.type

`string`

使用的编译工具。可选值：`webpack4`、`webpack5`、`vite`。

### compiler.errorLevel

`number`

编译过程中的错误处理级别定义。默认为 0，表示发生严重编译错误时进程会退出。

webpack 编译过程中的错误类型主要如下两类：1、致命的 wepback 错误（配置出错等）2、编译错误（缺失的 module，语法错误等）

0：表示发生“1、致命的 webpack 错误（配置出错等）”情况时，返回非 0 的退出码结束进程。
1：表示发生“1、致命的 wepback 错误（配置出错等）2、编译错误（缺失的 module，语法错误等）”情况时，返回非 0 的退出码结束进程。

### compiler.prebundle

`object`

> 只有 Webpack5 支持

是否开启依赖预编译功能。开启后首次编译 Taro 会把项目的 `node_modules` 依赖打包为模块联邦的 Remote 应用，二次编译时 Webpack 只需要编译项目源码，从而提升编译速度。

#### compiler.prebundle.enable

`boolean`

默认值：生产环境为 `false`，开发环境为 `true`

是否开启依赖预编译。因为使用了 esbuild 单独打包依赖，会使项目体积略微变大，所以生产模式下不建议开启。

#### compiler.prebundle.cacheDir

`string`

默认值：`[项目路径]/node_modules/.taro`

缓存目录的绝对路径。开发者可以自定义缓存目录的路径，并把该目录提交到 git，这样能提高多人协作时的编译速度。

#### compiler.prebundle.force

`boolean`

默认值：`false`

是否强行弃用缓存。

#### compiler.prebundle.timings

`boolean`

默认值：`false`

是否显示依赖预编译的测速信息。

#### compiler.prebundle.esbuild

`object`

自定义 [esbuild](https://esbuild.github.io/api/#build-api) 配置。

#### compiler.prebundle.swc

`object`

自定义 [swc](https://swc.rs/docs/usage/core#options) 配置。

#### compiler.prebundle.webpack

`object`

自定义 [webpack](https://webpack.js.org/configuration/#options) 配置。

##### compiler.prebundle.webpack.provide

提供 `@tarojs/runtime` 替换小程序运行时关联 API（BOM、DOM），使用可参考[代码](https://github.com/NervJS/taro/blob/next/packages/taro-plugin-vue-devtools/src/index.ts#L75)。

#### compiler.prebundle.include

`string array`

默认值：[]

需要额外执行预编译的依赖。

#### compiler.prebundle.exclude

`string array`

默认值：[]

不需要执行预编译的依赖。

### compiler.vitePlugins

> 只有 vite 支持

`array`

vite 插件

## cache

:::info
Taro v3.5 开始支持。
:::

Webpack5 持久化缓存配置。具体配置请参考 [WebpackConfig.cache](https://webpack.js.org/configuration/cache/#cache)。

Taro 遵循 Webpack **“构建安全比构建速度重要”**的理念，默认不开启持久化缓存功能。但当开发者能处理好缓存策略时，强烈建议开启缓存，这能大大提高二次编译速度。

除了 [cache.buildDependencies](./config-detail#cachebuilddependencies)、[cache.name](./config-detail#cachename) 具有默认值外，开发者的其它 cache 配置将会合并进 `WebpackConfig.cache`。

### cache.enable

`boolean`

默认值 `false`

是否开启持久化缓存。

值为 `false` 时：开发模式下 `WebpackConfig.cache.type = 'memory'`，而生产模式下 `WebpackConfig.cache = false`。

值为 `true` 时：开发模式和生产模式下均为 `WebpackConfig.cache.type = 'filesystem'`。

### cache.buildDependencies

默认值

```js
webpackConfig = {
  cache: {
    buildDependencies: {
      config: [path.join(appPath, 'config/index.js')],
    },
  },
}
```

当依赖的文件或该文件的依赖改变时，使缓存失效。详情请参考 [WebpackConfig.cache.buildDependencies](https://webpack.js.org/configuration/cache/#cachebuilddependencies)。

### cache.name

`string`

默认值 `process.env.NODE_ENV-process.env.TARO_ENV`。

缓存子目录的名称。详情请参考 [WebpackConfig.cache.name](https://webpack.js.org/configuration/cache/#cachename)。

## logger

:::info
Taro v3.5 开始支持。目前只在 Webpack5 compiler 中支持。
:::

控制 Taro 编译日志的输出方式。

### quiet

`boolean`

默认值 `true`。

是否简化输出日志。

### stats

`boolean`

默认值 `false`。

是否输出 Webpack Stats 信息。

## mini

`object`

专属于小程序的配置。

### mini.baseLevel

`number`

默认值：`16`

对于 `template` 模板不支持递归的小程序（如：微信、QQ、京东），Taro 会对所有模板**循环 baseLevel 次**，以支持同类模板的循环调用。

但是循环太多次也会导致生成的 `base` 模板体积相当大，因此当你的嵌套层级并不太深时可以使用 `baseLevel` 配置项配置较少的循环层数。

当然在嵌套层级较深时，也可以增大 baseLevel。以避免到达循环上限后，Taro 会调用一个自定义组件重新开始循环所带来一些问题。

### mini.compile

`object`

小程序编译过程的相关配置。

#### mini.compile.exclude

`array`

配置小程序编译过程中**排除不需要经过 Taro 编译的文件**，数组里面可以包含具体文件路径，也可以是判断函数，同 [Rule.exclude](https://webpack.js.org/configuration/module/#ruleexclude)。

假设要排除某个文件，可以配置要排除的文件的具体路径：

```js
module.exports = {
  // ...
  mini: {
    // ...
    compile: {
      exclude: [path.resolve(__dirname, '..', 'src/pages/index/vod-wx-sdk-v2.js')],
    },
  },
}
```

也可以配置判断函数：

```js
module.exports = {
  // ...
  mini: {
    // ...
    compile: {
      exclude: [(modulePath) => modulePath.indexOf('vod-wx-sdk-v2') >= 0],
    },
  },
}
```

#### mini.compile.include

`array`

配置额外**需要经过 Taro 编译的文件**，使用方式与 [mini.compile.exclude](./config-detail#minicompileexclude) 一致，同 [Rule.include](https://webpack.js.org/configuration/module/#ruleinclude)。例如 Taro 默认不编译 `node_modules` 中的文件，可以通过这个配置让 Taro 编译 `node_modules` 中的文件。

默认值包括 Taro 项目源码目录 src 以及 Taro 相关的 node_modules。如需将 Taro 项目作为 monorepo 项目的子包，则要自行配置 include 以编译其他子包的文件，示例：

```js title='config/index.js'
export default {
  // ...
  mini: {
    // ...
    compile: {
      include: [path.resolve(__dirname, '../../package')],
    },
  },
  h5: {
    // ...
    compile: {
      include: [path.resolve(__dirname, '../../package')],
    },
  },
}
```

### mini.webpackChain

`function`

自定义 Webpack 配置。

这个函数会收到**三个参数**。第一个参数是 webpackChain 对象，可参考 [webpack-chain](https://github.com/neutrinojs/webpack-chain) 的 API 进行修改，第二个参数是 `webpack` 实例，第三个参数 `PARSE_AST_TYPE` 是小程序编译时的文件类型集合。

第三个参数的取值如下：

```typescript
export enum PARSE_AST_TYPE {
  ENTRY = 'ENTRY',
  PAGE = 'PAGE',
  COMPONENT = 'COMPONENT',
  NORMAL = 'NORMAL',
  STATIC = 'STATIC',
}
```

**例子：**

```js
// 这是一个添加 raw-loader 的例子，用于在项目中直接引用 md 文件
module.exports = {
  // ...
  mini: {
    // ...
    webpackChain(chain, webpack) {
      chain.merge({
        module: {
          rule: {
            myloader: {
              test: /\.md$/,
              use: [
                {
                  loader: 'raw-loader',
                  options: {},
                },
              ],
            },
          },
        },
      })
    },
  },
}
```

```js
// 这是一个添加插件的例子
module.exports = {
  // ...
  mini: {
    // ...
    webpackChain(chain, webpack) {
      chain.merge({
        plugin: {
          install: {
            plugin: require('npm-install-webpack-plugin'),
            args: [
              {
                // Use --save or --save-dev
                dev: false,
                // Install missing peerDependencies
                peerDependencies: true,
                // Reduce amount of console logging
                quiet: false,
                // npm command used inside company
                npm: 'cnpm',
              },
            ],
          },
        },
      })
    },
  },
}
```

### mini.output

`object`

可用于修改、拓展 Webpack 的 **output** 选项，配置项参考[官方文档](https://webpack.js.org/configuration/output/)。

### mini.enableSourceMap

`boolean`

默认值：watch 模式下为 `true`，否则为 `false`。

用于控制是否生成 js、css 对应的 sourceMap。

### mini.sourceMapType

`string`

默认值：`'cheap-module-source-map'`

具体配置请参考 [Webpack devtool 配置](https://webpack.js.org/configuration/devtool/#devtool)。

### mini.debugReact

:::info
Taro v3.0.8 开始支持。
:::

`boolean`

默认值：`false`。

指定 React 框架相关的代码是否使用开发环境（未压缩）代码，默认使用生产环境（压缩后）代码。

### mini.hot

:::info
Taro v3.4.0 开始支持。
:::

`boolean`

默认值：`false`。

是否注入兼容微信小程序热重载的代码。详情：[#10722](https://github.com/NervJS/taro/issues/10722#issuecomment-992247021)

### mini.minifyXML

:::info
Taro v3.0.8 开始支持。
:::

`object`

关于压缩小程序 xml 文件的相关配置。

#### mini.minifyXML.collapseWhitespace

`boolean`

默认值：`false`。

是否合并 xml 文件中的空格。

### mini.postcss

`object`

配置 `postcss` 相关插件。

```js
module.exports = {
  // ...
  mini: {
    // ...
    postcss: {
      // 可以进行 autoprefixer 的配置。配置项参考官方文档 https://github.com/postcss/autoprefixer
      autoprefixer: {
        enable: true,
        config: {
          // autoprefixer 配置项
        },
      },
      pxtransform: {
        enable: true,
        config: {
          // pxtransform 配置项，参考尺寸章节
          selectorBlackList: ['body'],
        },
      },
      // 小程序端样式引用本地资源内联 该属性在 v4.0.0 版本已废弃，小程序端默认全部转换
      // url: {
      //   enable: true,
      //   config: {
      //     maxSize: 10, // 设定转换尺寸上限（单位：kbytes）
      //   },
      // },
      // css modules 功能开关与相关配置
      cssModules: {
        enable: false, // 默认为 false，如需使用 css modules 功能，则设为 true
        config: {
          generateScopedName: '[name]__[local]___[hash:base64:5]',
        },
      },
    },
  },
}
```

#### mini.postcss.htmltransform

`object`

可以进行 `htmltransform` 的配置。例如：

```js
module.exports = {
  // ...
  mini: {
    // ...
    postcss: {
      htmltransform: {
        enable: false, // 小程序默认关闭该配置
        config: {
          removeCursorStyle: true, // 默认为 true
        },
      },
    },
  },
}
```

#### mini.postcss.url

`object`

可以进行 `url` 的配置，默认是 `inline` 配置（config 配置可参考 [postcss-url](https://www.npmjs.com/package/postcss-url)）。例如：

```js
module.exports = {
  // ...
  mini: {
    // ...
    postcss: {
      url: {
        enable: true,
        config: {
          maxSize: 10, // 设定转换尺寸上限（单位 kbytes）
        },
      },
    },
  },
}
```

### mini.commonChunks

`array | function`

用于告诉 Taro 编译器需要抽取的公共文件，支持两种配置方式。

`commonChunks` 的配置值必须依据于 webpack 配置 [optimization.runtimeChunk](https://webpack.js.org/configuration/optimization/#optimizationruntimechunk) 和 [optimization.splitChunks](https://webpack.js.org/plugins/split-chunks-plugin/) 中的公共 chunks 的名称。Taro 中 webpack.optimization 配置的默认值：[源码位置](https://github.com/NervJS/taro/blob/bc6af68bda2cbc9163fbda36c15878fc96aec8f1/packages/taro-mini-runner/src/webpack/build.conf.ts#L220-L254)。

> 如果有自行拆分公共文件的需求，请先通过 [webpackChain 配置](./config-detail#miniwebpackchain) 覆盖`optimization.runtimeChunk` 与 `optimization.splitChunks` 配置。再通过此 `commonChunks` 配置指定公共入口文件。

#### 字符串数组方式

普通编译时的默认值：`['runtime', 'vendors', 'taro', 'common']`

编译为微信小程序插件时的默认值： `['plugin/runtime', 'plugin/vendors', 'plugin/taro', 'plugin/common']`

可以传入需要抽取的公共文件的名称数组。

例子：

```js
module.exports = {
  // ...
  mini: {
    // ...
    commonChunks: ['runtime', 'vendors', 'taro', 'common'],
  },
}
```

这几个公共文件分别表示：

- `runtime`: webpack 运行时入口
- `taro`: node_modules 中 Taro 相关依赖
- `vendors`: node_modules 除 Taro 外的公共依赖
- `common`: 项目中业务代码公共逻辑

#### 函数方式

通过对入参的默认公共文件数组进行操作，返回新的数组来进行配置，如下

```js
module.exports = {
  // ...
  mini: {
    // ...
    commonChunks(commonChunks) {
      // commonChunks 的取值即为默认的公共文件名数组
      commonChunks.push('yourCustomCommonChunkName')
      return commonChunks
    },
  },
}
```

### mini.addChunkPages

`function`

为某些页面单独指定需要引用的公共文件。

例如在使用小程序分包的时候，为了减少主包大小，分包的页面希望引入自己的公共文件，而不希望直接放在主包内。那么我们首先可以通过 [webpackChain 配置](./config-detail#miniwebpackchain) 来单独抽离分包的公共文件，然后通过 `mini.addChunkPages` 为分包页面配置引入分包的公共文件，其使用方式如下：

`mini.addChunkPages` 配置为一个函数，接受两个参数

- `pages` 参数为 Map 类型，用于为页面添加公共文件
- `pagesNames` 参数为当前应用的所有页面标识列表，可以通过打印的方式进行查看页面的标识

例如，为 `pages/index/index` 页面添加 `eating` 和 `morning` 两个抽离的公共文件：

```ts
module.exports = {
  // ...
  mini: {
    // ...
    addChunkPages(pages: Map<string, string[]>, pagesNames: string[]) {
      pages.set('pages/index/index', ['eating', 'morning'])
    },
  },
}
```

### mini.optimizeMainPackage

`object`

优化主包的体积大小

像下面这样简单配置之后，可以避免主包没有引入的 module 不被提取到`commonChunks`中，该功能会在打包时分析 module 和 chunk 的依赖关系，筛选出主包没有引用到的 module 把它提取到分包内，下面是提取的两种类型的`分包公共模块`：

- `分包根目录/sub-vendors.(js|wxss)`

  - 如果该 module 只被`单个分包`内的多个 page 引用，则提取到该分包根目录的 sub-vendors 文件中。

- `分包根目录/sub-common/*.(js|wxss)`
  - 如果该 module 被`多个分包`内的 page 引用，正常情况下会被提取到主包的公共模块中，这里为了保证主包的体积最优，则会先提取成一个公共模块，然后分别复制到对应分包的 sub-common 文件夹下（因为小程序无法跨分包引入文件，所以这里需要每个分包都复制一份），需要注意的是，这样会导致总包的体积变大一些。

```js
module.exports = {
  // ...
  mini: {
    // ...
    optimizeMainPackage: {
      enable: true,
    },
  },
}
```

如果有不想走分包提取规则的 module，可以在 exclude 中配置，这样该 module 就会走原来提取的方案，提取到主包中，比如像下面这样（支持绝对路径和函数）：

```js
module.exports = {
  // ...
  mini: {
    // ...
    optimizeMainPackage: {
      enable: true,
      exclude: [path.resolve(__dirname, 'moduleName.js'), (module) => module.resource.indexOf('moduleName') >= 0],
    },
  },
}
```

### mini.styleLoaderOption

`object`

`style-loader` 的附加配置。配置项参考[官方文档](https://github.com/webpack-contrib/style-loader)，例如：

```js
module.exports = {
  // ...
  mini: {
    // ...
    styleLoaderOption: {
      insertAt: 'top',
    },
  },
}
```

### mini.cssLoaderOption

`object`

`css-loader` 的附加配置。配置项参考[官方文档](https://github.com/webpack-contrib/css-loader)，例如：

```js
module.exports = {
  // ...
  mini: {
    // ...
    cssLoaderOption: {
      localIdentName: '[hash:base64]',
    },
  },
}
```

### mini.sassLoaderOption

`object`

`sass-loader` 的附加配置。配置项参考[官方文档](https://github.com/webpack-contrib/sass-loader)，例如：

```js
module.exports = {
  // ...
  mini: {
    // ...
    sassLoaderOption: {
      implementation: require('node-sass'),
    },
  },
}
```

### mini.lessLoaderOption

:::info
Taro v3.0.26 开始支持。
:::

`object`

`less-loader` 的附加配置。配置项参考[官方文档](https://github.com/webpack-contrib/less-loader)，例如：

```js
module.exports = {
  // ...
  mini: {
    // ...
    lessLoaderOption: {
      lessOptions: {
        strictMath: true,
        noIeCompat: true,
      },
    },
  },
}
```

### mini.stylusLoaderOption

`object`

`stylus-loader` 的附加配置。配置项参考[官方文档](https://github.com/shama/stylus-loader)。

### mini.miniCssExtractPluginOption

`object`

`mini-css-extract-plugin` 的附加配置，配置项参考[官方文档](https://github.com/webpack-contrib/mini-css-extract-plugin)。

```js
module.exports = {
  // ...
  mini: {
    // ...
    miniCssExtractPluginOption: {
      filename: '[name].css',
      chunkFilename: '[name].css',
    },
  },
}
```

### mini.imageUrlLoaderOption

`object`

针对 `png | jpg | jpeg | gif | bpm | svg` 文件的 `url-loader` 配置。配置项参考[官方文档](https://github.com/webpack-contrib/url-loader)。

### mini.mediaUrlLoaderOption

`object`

针对 `mp4 | webm | ogg | mp3 | wav | flac | aac` 文件的 `url-loader` 配置。配置项参考[官方文档](https://github.com/webpack-contrib/url-loader)，例如：

```js
module.exports = {
  // ...
  mini: {
    // ...
    mediaUrlLoaderOption: {
      limit: 8192,
    },
  },
}
```

### mini.fontUrlLoaderOption

`object`

针对 `woff | woff2 | eot | ttf | otf` 文件的 `url-loader` 配置。配置项参考[官方文档](https://github.com/webpack-contrib/url-loader)。

## h5

专属于 H5 的配置。

### h5.entry

`object`

可用于修改、拓展 Webpack 的 **input** 选项，配置项参考 [官方文档](https://webpack.js.org/configuration/entry-context/#entry)。

```js
module.exports = {
  // ...
  h5: {
    // ...
    entry: {
      home: ['./home.js'],
      about: ['./about.js'],
      contact: ['./contact.js'],
    },
  },
}
```

### h5.output

`object`

可用于修改、拓展 Webpack 的 **output** 选项，配置项参考[webpack 官方文档](https://webpack.js.org/configuration/output/)。

vite 编译环境下用于修改、扩展 rollup 的 output，目前仅适配 chunkFileNames 和 assetFileNames 两个配置，修改其他配置请使用 vite 插件进行修改。配置想参考[官方文档](https://rollupjs.org/configuration-options/)

```js
module.exports = {
  // ...
  h5: {
    // ...
    output: {
      filename: 'js/[name].[hash:8].js',
      chunkFilename: 'js/[name].[chunkhash:8].js',
    },
  },
}
```

### h5.publicPath

`string`

默认值：`'/'`

设置输出解析文件的目录。

### h5.staticDirectory

`string`

默认值：`'static'`

h5 编译后的静态文件目录。

### h5.chunkDirectory

`string`

默认值：`'chunk'`

编译后非 entry 的 js 文件的存放目录，主要影响动态引入的 `pages` 的存放路径。

### h5.devServer

`object`

预览服务的配置，可以更改端口等参数。具体配置参考 [webpack-dev-server](https://webpack.js.org/configuration/dev-server)。

例子：

**修改端口：**

```js
module.exports = {
  // ...
  h5: {
    // ...
    devServer: {
      port: 10086,
    },
  },
}
```

**开启 https 服务：**

```js
module.exports = {
  // ...
  h5: {
    // ...
    devServer: {
      https: true,
    },
  },
}
```

### h5.webpackChain

`function`

自定义 Webpack 配置。

这个函数会收到**两个参数**，第一个参数是 webpackChain 对象，可参考 [webpack-chain](https://github.com/neutrinojs/webpack-chain) 的 API 进行修改，第二个参数是 `webpack` 实例。

**例子：**

```js
// 这是一个添加 raw-loader 的例子，用于在项目中直接引用 md 文件
module.exports = {
  // ...
  h5: {
    // ...
    webpackChain(chain, webpack) {
      chain.merge({
        module: {
          rule: {
            myloader: {
              test: /\.md$/,
              use: [
                {
                  loader: 'raw-loader',
                  options: {},
                },
              ],
            },
          },
        },
      })
    },
  },
}
```

```js
// 这是一个添加插件的例子
module.exports = {
  // ...
  h5: {
    // ...
    webpackChain(chain, webpack) {
      chain.merge({
        plugin: {
          install: {
            plugin: require('npm-install-webpack-plugin'),
            args: [
              {
                // Use --save or --save-dev
                dev: false,
                // Install missing peerDependencies
                peerDependencies: true,
                // Reduce amount of console logging
                quiet: false,
                // npm command used inside company
                npm: 'cnpm',
              },
            ],
          },
        },
      })
    },
  },
}
```

### h5.router

`object`

路由相关的配置。

#### h5.router.mode

`'hash' | 'browser' | 'multi'`

默认值：`'hash'`

配置路由模式。'hash' 与 'browser' 分别对应 hash 路由模式和浏览器 history 路由模式。

**例子：**

```js
module.exports = {
  // ...
  h5: {
    // ...
    router: {
      mode: 'hash', // 或者是 'browser'
    },
  },
}
```

针对上面的配置，调用 `Taro.navigateTo({ url: '/pages/index/index' })` 后，浏览器地址栏将被变为：

- `https://{{domain}}/#/pages/index/index`（**hash** 模式）
- `https://{{domain}}/pages/index/index`（**browser** 模式）

'multi' 对应多页面应用路由模式，需要注意的是很多小程序的组件或 API 都是基于 SPA 设计使用的，在 MPA 模式下并不适用，所以使用该模式可能会导致以下隐患：

- TabBar 会多次加载，且不支持路由动画
- App 生命周期会多次触发（暂未修复），onPageNotFound 事件不支持
- 生产环境需要额外配置路由映射（根目录跳转、404 页面……）
- getCurrentPages 等相关方法不支持

#### h5.router.basename

`string`

配置路由基准路径。

**例子：**

```js
module.exports = {
  // ...
  h5: {
    // ...
    router: {
      basename: '/myapp',
    },
  },
}
```

针对上面的配置，调用 `Taro.navigateTo({ url: '/pages/index/index' })` 后，浏览器地址栏将被变为：

- `https://{{domain}}/#/myapp/pages/index/index`（**hash** 模式）
- `https://{{domain}}/myapp/pages/index/index`（**browser** 模式）

#### h5.router.customRoutes

`Record<string, string | string[]>`

配置自定义路由。

**例子：**

```js
module.exports = {
  // ...
  h5: {
    // ...
    router: {
      customRoutes: {
        // "页面路径": "自定义路由"
        '/pages/index/index': '/index',
        '/pages/detail/index': ['/detail'], // 可以通过数组为页面配置多个自定义路由
      },
    },
  },
}
```

针对上面的配置，调用 `Taro.navigateTo({ url: '/pages/index/index' })` 后，浏览器地址栏将被变为：

- `https://{{domain}}/#/index`（**hash** 模式）
- `https://{{domain}}/myapp/index`（**browser** 模式）

:::info
Taro v3.3.18+ 开始支持传入数组配置自定义路由。

配置自定义路由会导致原路由失效（无法访问，但不影响 API 使用），如果需要启用原路由可以参考如下配置:

```js
customRoutes: {
  '/pages/detail/index': ['/detail', '/pages/detail/index']
}
```

原路由失效会导致开发环境中，首次打开页面错误；如果自定义路由配置为 `'/'` 则会导致跳转错误，可以通过配置 [`entryPagePath`](/docs/app-config#entrypagepath) 修复该问题，3.5.2+ 版本可忽略该问题。
:::

### h5.enableSourceMap

`boolean`

默认值：watch 模式下为 `true`，否则为 `false`。

用于控制是否生成 js、css 对应的 sourceMap。

### h5.sourceMapType

`string`

默认值：`'cheap-module-eval-source-map'`

具体配置请参考 [Webpack devtool 配置](https://webpack.js.org/configuration/devtool/#devtool)。

### h5.useHtmlComponents

:::info
Taro v3.2.4 开始支持。
:::

`boolean`

默认值：`false`

用于控制在 H5 端是否使用兼容性组件库，详情请看 [React 兼容性组件库](h5#react-兼容性组件库)。

### h5.useDeprecatedAdapterComponent

:::info
Taro v3.6.3 开始支持。
:::

`boolean`

默认值：`false`

用于控制在 H5 端是否使用旧版本适配器，旧版本采用全局注册组件，懒加载组件相关依赖；新版本适配器会自动注册相关组件，不再需要引入 `@tarojs/components/loader` 中的全局 `defineCustomElements` 方法。

### h5.enableExtract

`boolean`

默认值：watch 模式下为 `false`，否则为 `true`。

extract 功能开关，开启后将使用 `mini-css-extract-plugin` 分离 css 文件，可通过 [h5.miniCssExtractPluginOption](./config-detail#h5minicssextractpluginoption) 对插件进行配置。

### h5.esnextModules

`array`

配置需要额外的经由 Taro 预设的 postcss 编译的模块。

假设需要对 [taro-ui](https://github.com/NervJS/taro-ui) 里的样式单位进行转换适配：

```js
module.exports = {
  // ...
  h5: {
    // ...
    // 经过这一配置之后，代码中引入的处于 `node_modules/taro-ui/` 路径下的样式文件均会经过 postcss 的编译处理。
    esnextModules: ['taro-ui'],
  },
}
```

### h5.postcss

`object`

配置 `postcss` 相关插件。

#### h5.postcss.autoprefixer

`object`

可以进行 `autoprefixer` 的配置。配置项参考[官方文档](https://github.com/postcss/autoprefixer)，例如：

```js
module.exports = {
  // ...
  h5: {
    // ...
    postcss: {
      autoprefixer: {
        enable: true,
        config: {
          /* autoprefixer 配置项 */
        },
      },
    },
  },
}
```

#### h5.postcss.pxtransform

`object`

可以进行 `pxtransform` 的配置。配置项参考[官方文档](https://github.com/Pines-Cheng/postcss-pxtransform/)，例如：

```js
module.exports = {
  // ...
  h5: {
    // ...
    postcss: {
      pxtransform: {
        enable: true,
        config: {
          /* pxtransform 配置项 */
        },
      },
    },
  },
}
```

#### h5.postcss.htmltransform

`object`

可以进行 `htmltransform` 的配置。例如：

```js
module.exports = {
  // ...
  h5: {
    // ...
    postcss: {
      htmltransform: {
        enable: true, // H5 默认开启该配置
        config: {
          removeCursorStyle: false, // 默认为 false
        },
      },
    },
  },
}
```

> 需要 v3.5 以上版本

#### h5.postcss.url

`object`

可以进行 `url` 的配置，默认 `inline` 配置（config 配置可参考 [postcss-url](https://www.npmjs.com/package/postcss-url)）。例如：

```js
module.exports = {
  // ...
  h5: {
    // ...
    postcss: {
      url: {
        enable: true,
        config: {
          maxSize: 10, // 设定转换尺寸上限（单位 kbytes）
        },
      },
    },
  },
}
```

#### h5.postcss.cssModules

`object`

可以进行 CSS Modules 配置，配置如下：

```js
module.exports = {
  // ...
  h5: {
    // ...
    postcss: {
      // css modules 功能开关与相关配置
      cssModules: {
        enable: false, // 默认为 false，如需使用 css modules 功能，则设为 true
        config: {
          namingPattern: 'module',
          generateScopedName: '[name]__[local]___[hash:base64:5]',
        },
      },
    },
  },
}
```

### h5.compile

`object`

Web 编译过程的相关配置。

> 需要 v3.6 以上版本

#### h5.compile.exclude

`array`

配置 Web 应用编译过程中**排除不需要经过 Taro 编译的文件**，使用方式与 [mini.compile.exclude](./config-detail#minicompileexclude) 一致，同 [Rule.exclude](https://webpack.js.org/configuration/module/#ruleexclude)。

#### h5.compile.include

`array`

配置额外**需要经过 Taro 编译的文件**，使用方式与 [mini.compile.exclude](./config-detail#minicompileexclude) 一致，同 [Rule.include](https://webpack.js.org/configuration/module/#ruleinclude)。例如 Taro 默认不编译 `node_modules` 中的文件，可以通过这个配置让 Taro 编译 `node_modules` 中的文件。

默认值包括 Taro 项目源码目录 src 以及 Taro 相关的 node_modules。如需将 Taro 项目作为 monorepo 项目的子包，则要自行配置 include 以编译其他子包的文件，示例：

```js title='config/index.js'
export default {
  // ...
  mini: {
    // ...
    compile: {
      include: [path.resolve(__dirname, '../../package')],
    },
  },
  h5: {
    // ...
    compile: {
      include: [path.resolve(__dirname, '../../package')],
    },
  },
}
```

### h5.htmlPluginOption

:::info
Taro v3.5 开始支持。
:::

`object`

html-webpack-plugin 的具体配置。

```js
module.exports = {
  // ...
  htmlPluginOption: {
    // 配置项同 https://github.com/jantimon/html-webpack-plugin#options
  },
}
```

### h5.styleLoaderOption

`object`

`style-loader` 的附加配置。配置项参考[官方文档](https://github.com/webpack-contrib/style-loader)，例如：

```js
module.exports = {
  // ...
  h5: {
    // ...
    styleLoaderOption: {
      insertAt: 'top',
    },
  },
}
```

### h5.cssLoaderOption

`object`

`css-loader` 的附加配置。配置项参考[官方文档](https://github.com/webpack-contrib/css-loader)，例如：

```js
module.exports = {
  // ...
  h5: {
    // ...
    cssLoaderOption: {
      localIdentName: '[hash:base64]',
    },
  },
}
```

### h5.sassLoaderOption

`object`

`sass-loader` 的附加配置。配置项参考[官方文档](https://github.com/webpack-contrib/sass-loader)，例如：

```js
module.exports = {
  // ...
  h5: {
    // ...
    sassLoaderOption: {
      implementation: require('node-sass'),
    },
  },
}
```

### h5.lessLoaderOption

:::info
Taro v3.0.26 开始支持。
:::

`object`

`less-loader` 的附加配置。配置项参考[官方文档](https://github.com/webpack-contrib/less-loader)，例如：

```js
module.exports = {
  // ...
  h5: {
    // ...
    lessLoaderOption: {
      lessOptions: {
        strictMath: true,
        noIeCompat: true,
      },
    },
  },
}
```

### h5.stylusLoaderOption

`object`

`stylus-loader` 的附加配置。配置项参考[官方文档](https://github.com/shama/stylus-loader)。

### h5.miniCssExtractPluginOption

`object`

`mini-css-extract-plugin` 的附加配置，在 [h5.enableExtract 配置](./config-detail#h5enableextract) 为 `true` 的情况下生效。

配置项参考[官方文档](https://github.com/webpack-contrib/mini-css-extract-plugin)，例如：

```js
module.exports = {
  // ...
  h5: {
    // ...
    miniCssExtractPluginOption: {
      filename: 'css/[name].css',
      chunkFilename: 'css/[id].css',
    },
  },
}
```

### h5.imageUrlLoaderOption

`object`

针对 `png | jpg | jpeg | gif | bpm | svg` 文件的 `url-loader` 配置。配置项参考[官方文档](https://github.com/webpack-contrib/url-loader)。

### h5.mediaUrlLoaderOption

`object`

针对 `mp4 | webm | ogg | mp3 | wav | flac | aac` 文件的 `url-loader` 配置。配置项参考[官方文档](https://github.com/webpack-contrib/url-loader)，例如：

```js
module.exports = {
  // ...
  h5: {
    // ...
    mediaUrlLoaderOption: {
      limit: 8192,
    },
  },
}
```

### h5.fontUrlLoaderOption

`object`

针对 `woff | woff2 | eot | ttf | otf` 文件的 `url-loader` 配置。配置项参考[官方文档](https://github.com/webpack-contrib/url-loader)。

### h5.legacy

:::info
Taro v4.0.0 开始支持。
:::

`boolean`

默认值 `false`

选择 `vite` 编译器的情况下才会使用到该字段。生成的代码是否要兼容旧版浏览器，值为 true 时，会去读取 package.json 的 browserslist 字段。

## rn

专属于 RN 的配置。

### rn.appName

`string`

设置 RN bundle 中注册应用的名称

```js
module.exports = {
  // ...
  rn: {
    // ...
    appName: 'TaroDemo',
  },
}
```

### rn.entry

`string`

entry 利用模块查找规则{name}.{platform}.{ext}自动区分平台

```js
module.exports = {
  // ...
  rn: {
    // ...
    entry: 'index.android.tsx',
  },
}
```

### rn.output

`object`

设置 Metro 打包生成 bundle 的输出路径，默认 dist 目录下

```js
module.exports = {
  // ...
  rn: {
    // ...
    output: {
      iosSourceMapUrl: '', // sourcemap 文件url
      iosSourcemapOutput: '../taro-native-shell/ios/main.map', // sourcemap 文件输出路径
      iosSourcemapSourcesRoot: '', // 将 sourcemap 资源路径转为相对路径时的根目录
      androidSourceMapUrl: '',
      androidSourcemapOutput: '../taro-native-shell/android/app/src/main/assets/index.android.map',
      androidSourcemapSourcesRoot: '',
      ios: '../taro-native-shell/ios/main.jsbundle',
      iosAssetsDest: '../taro-native-shell/ios',
      android: '../taro-native-shell/android/app/src/main/assets/index.android.bundle',
      androidAssetsDest: '../taro-native-shell/android/app/src/main/res',
    },
  },
}
```

### rn.postcss

`object`

`postcss` 相关配置，其他样式语言预处理后经过此配置。

```js
module.exports = {
  // ...
  rn: {
    // ...
    postcss: {
      // postcss 配置，参考 https://github.com/postcss/postcss#options
      options: {
        /* ... */
      },
      // 默认true，控制是否对 css value 进行 scalePx2dp 转换，pxtransform配置 enable 才生效
      scalable: boolean,
      pxtransform: {
        enable: boolean, // 默认true
        config: {
          /* ... */
        }, // 插件 pxtransform 配置项，参考尺寸章节
      },
    },
  },
}
```

### rn.sass

`object`

`sass` 相关配置。`options` 配置项参考[官方文档](https://github.com/sass/node-sass#options)。

```js
module.exports = {
  // ...
  rn: {
    // ...
    sass: {
      options: {
        /* ... */
      },
      // 加入到脚本注入的每个 sass 文件头部，在 config.sass 之前
      additionalData: '', // {String|Function}
    },
  },
}
```

### rn.less

`object`

`less` 相关配置。`options` 配置项参考[官方文档](https://lesscss.org/usage/#less-options)。

```js
module.exports = {
  // ...
  rn: {
    // ...
    less: {
      options: {
        /* ... */
      },
      additionalData: '', // {String|Function}
    },
  },
}
```

### rn.stylus

`object`

`stylus` 相关配置。`stylus.options` 配置项参考[文档](https://github.com/NervJS/taro/tree/next/packages/taro-rn-style-transformer/README.md#rnstylus)。

```js
module.exports = {
  // ...
  rn: {
    // ...
    stylus: {
      options: {
        /* ... */
      },
      additionalData: '', // {String|Function}
    },
  },
}
```

### rn.resolve

`object`

`resolve` 处理依赖文件配置。
`resolve.include` 可配置多个 `npm` 包名的数组，将 `npm` 包当作项目文件处理，支持 `node_modules` 平台优先级文件访问和全局样式。

```js
module.exports = {
  rn: {
    resolve: {
      include: ['taro-ui'], // 处理引用 node_modules/taro-ui 的依赖。
    },
  },
}
```

### rn.enableMultipleClassName

`boolean`

支持多 `className` 转换，以 `classname` 或 `style` 结尾的， 提取前缀， 然后根据前缀，再生成对应的 xxxStyle。如：`barClassName -> barStyle`。默认值 `false`，不开启。

```js
module.exports = {
  rn: {
    enableMultipleClassName: false,
  },
}
```

### rn.enableMergeStyle

`boolean`

当标签 `style` 属性值是数组时转换成对象。默认值 `false`，不开启。

```js
module.exports = {
  rn: {
    enableMergeStyle: false, // https://github.com/shinken008/babel-plugin-jsx-attributes-array-to-object#example
  },
}
```

### rn.enableSvgTransform

`boolean`

将 `svg` 文件转换为组件引入。默认值 `false`，不开启。详情：[#10793](https://github.com/NervJS/taro/pull/10793)

```js
module.exports = {
  rn: {
    enableSvgTransform: false,
  },
}
```
</file>

<file path="docs/config.md">
---
title: 编译配置
---

编译配置存放于项目根目录下的 `config` 目录中，只要确保 `config/index.js` 或者 `config/index.ts` 文件存在，可以作为用户自定义编译配置导出即可。你也可以选择拆分成三个文件（具体见默认配置）：

- `index.js` 是通用配置
- `dev.js` 是项目预览时的配置
- `prod.js` 是项目打包时的配置

详细的编译配置文档请查阅：[编译配置详情](./config-detail)

> 从 Taro v3.6.5 开始， `config/index.ts` 支持使用 `ts` 文件(`react native` 暂不支持)

## 默认配置

```js title="config/index.js"
const config = {
  // 项目名称
  projectName: 'Awesome Next',
  // 项目创建日期
  date: '2020-6-2',
  // 设计稿尺寸
  designWidth: 750,
  // 设计稿尺寸换算规则
  deviceRatio: {
    640: 2.34 / 2,
    750: 1,
    828: 1.81 / 2,
  },
  // 项目源码目录
  sourceRoot: 'src',
  // 项目产出目录
  outputRoot: 'dist',
  // Taro 插件配置
  plugins: [],
  // 全局变量设置
  defineConstants: {},
  // 文件 copy 配置
  copy: {
    patterns: [],
    options: {},
  },
  // 框架，react，nerv，vue, vue3 等
  framework: 'react',
  // 小程序端专用配置
  mini: {
    postcss: {
      autoprefixer: {
        enable: true,
      },
      cssModules: {
        enable: false, // 默认为 false，如需使用 css modules 功能，则设为 true
        config: {
          namingPattern: 'module', // 转换模式，取值为 global/module
          generateScopedName: '[name]__[local]___[hash:base64:5]',
        },
      },
    },
    // 自定义 Webpack 配置
    webpackChain(chain, webpack) {},
  },
  // H5 端专用配置
  h5: {
    publicPath: '/',
    staticDirectory: 'static',
    postcss: {
      autoprefixer: {
        enable: true,
      },
      cssModules: {
        enable: false, // 默认为 false，如需使用 css modules 功能，则设为 true
        config: {
          namingPattern: 'module', // 转换模式，取值为 global/module
          generateScopedName: '[name]__[local]___[hash:base64:5]',
        },
      },
    },
    // 自定义 Webpack 配置
    webpackChain(chain, webpack) {},
    devServer: {},
  },
}

module.exports = function (merge) {
  if (process.env.NODE_ENV === 'development') {
    return merge({}, config, require('./dev'))
  }
  return merge({}, config, require('./prod'))
}
```

## defineConfig 辅助函数

:::info
Taro v3.6.9 开始支持

Taro v4.0.0 之后支持范型，可以传入编译器类型 'webpack4 | 'webpack5 | 'vite'

react native 暂不支持
:::

开发者可以导入 `defineConfig` 函数包裹配置对象， 以获得 类型提示 和 自动补全.

### 基础配置

```ts
// config/index.ts
import { defineConfig } from '@tarojs/cli'

export default defineConfig<T>({
  // ...Taro 配置
})
```

同时 `config/index.ts` 支持直接导出对象：

```ts
// 直接导出对象
import type { UserConfigExport } from '@tarojs/cli'

export default {
  // ...Taro 配置
} satisfies UserConfigExport<T>
```

### 异步配置

如果配置需要调用一个异步函数，也可以转而导出一个异步函数：

```ts
import { defineConfig } from '@tarojs/cli'

export default defineConfig(async (merge, { command, mode }) => {
  const data = await asyncFunction()
  return {
    // Taro 配置
  }
})
```

### 情景配置

如果配置文件需要基于 命令 或者不同的 [模式](./env-mode-config.md) 来决定选项，则可以选择导出这样一个函数：

```ts
import { defineConfig } from '@tarojs/cli'

export default defineConfig((merge, { command, mode }) => {
  // merge 为 webpack-merge, 兼容以前的配置
  // 假如执行的命令为: "taro build --type weapp --mode test"
  // 则 command 的值为 build, mode 的值为 test
  if (mode === 'development') {
    return {
      // dev 独有配置
    }
  } else if (mode === 'test') {
    return {
      // test 独有配置
    }
  } else {
    return {
      // build 独有配置
    }
  }
})
```
</file>

<file path="docs/context.md">
---
title: Context
---

> 自 `v1.3.0-beta.5` 起支持
> 在 Taro 中没有对 React 15 的 [legacy context](https://zh-hans.reactjs.org/docs/legacy-context.html) 进行支持，无法使用 `getChildContext()` API。

在一个典型的 Taro 应用中，数据是通过 props 属性自上而下（由父及子）进行传递的，但这种做法对于某些类型的属性而言是极其繁琐的（例如：地区偏好，UI 主题），这些属性是应用程序中许多组件都需要的。Context 提供了一种在组件之间共享此类值的方式，而不必显式地通过组件树的逐层传递 props。

## API

### Taro.createContext

```jsx
const MyContext = Taro.createContext(defaultValue)
```

创建一个 Context 对象。当 Taro 渲染一个订阅了这个 Context 对象的组件，这个组件会从最先渲染的 `Provider` 中读取到 `Provider` 的 `value`。

> 在 Taro 中，即便在框架层面也无法知道组件的树结构，因此 Taro 无法像 React 一样往父组件找离自己最近的 Provider。因此创建的 Context 最好只在一个地方使用。

### Context.Provider

```jsx
<MyContext.Provider value={/* 某个值 */}>
```

每个 Context 对象都会返回一个 Provider Taro 组件，它允许消费组件订阅 context 的变化。

Provider 接收一个 `value` 属性，传递给消费组件。一个 Provider 可以和多个消费组件有对应关系。多个 Provider 也可以嵌套使用，里层的会覆盖外层的数据。

当 Provider 的 `value` 值发生变化时，它内部的所有消费组件都会重新渲染。Provider 及其内部包含 `contextType` 或使用 `useContext` 组件都不受制于 shouldComponentUpdate 函数，因此当 consumer 组件在其祖先组件退出更新的情况下也能更新。

通过新旧值检测来确定变化，使用了与 `Object.is` 相同的算法。

> 由于现在 Taro 还没有 render props 的完整支持，所以无法使用 Context.Comsumer API，如果要消费 Context，可以使用 `ContextType` 或 `useContext` API。

### Class.contextType

```jsx
class MyClass extends Taro.Component {
  componentDidMount() {
    let value = this.context
    /* 在组件挂载完成后，使用 MyContext 组件的值来执行一些有副作用的操作 */
  }
  componentDidUpdate() {
    let value = this.context
    /* ... */
  }
  componentWillUnmount() {
    let value = this.context
    /* ... */
  }
  render() {
    let value = this.context
    /* 基于 MyContext 组件的值进行渲染 */
  }
}
MyClass.contextType = MyContext
```

挂载在 class 上的 `contextType` 属性会被重赋值为一个由 `Taro.createContext()` 创建的 Context 对象。这能让你使用 this.context 来消费 Context 上的那个值。你可以在任何生命周期中访问到它，包括 render 函数中。

> 注意：
> 你只通过该 API 订阅单一 context。如果你想订阅多个，阅读使用多个 Context 章节
> 如果你正在使用实验性的 public class fields 语法，你可以使用 static 这个类属性来初始化你的 contextType。

```jsx
class MyClass extends React.Component {
  static contextType = MyContext
  render() {
    let value = this.context
    /* 基于这个值进行渲染工作 */
  }
}
```

## 示例

### 动态 Context

```jsx
// counter-context.js
export const CounterContext = Taro.createContext(0)

// index.js
class Index extends Component {
  render() {
    const [count, setCount] = useState(0)
    return (
      <CounterContext.Provider value={count}>
        <View className="container">
          <Test />
          <Button onClick={() => setCount(0)}>Reset</Button>
          <Button onClick={() => setCount((prevCount) => prevCount + 1)}>+</Button>
          <Button onClick={() => setCount((prevCount) => prevCount - 1)}>-</Button>
        </View>
      </CounterContext.Provider>
    )
  }
}

// child.js
class Child extends Taro.Component {
  shouldComponentUpdate() {
    // 即便返回 false 也不会阻止 CounterContext 更新消费它的组件
    return false
  }

  render() {
    return <Counter />
  }
}

// counter.js
import { CounterContext } from './counter-context.js'
class Counter extends Taro.Component {
  static contextType = CounterContext

  render() {
    const value = this.context
    return <View>Count: {value}</View>
  }
}
```

我们在这个例子中把计数器 `count` 的值通过 `CounterContext.Provider` 往下传递，`Child` 组件中虽然禁止了更新，但 `Counter` 组件在 `CounterContext.Provider` 的 `value` 每次变化之后，还是能够订阅更新，收到每次 `count` 的值。

### 消费多个 Context

```jsx
const ThemeContext = Taro.createContext('light')

// 用户登录 context
const UserContext = Taro.createContext({
  name: 'Guest',
})

class App extends Taro.Component {
  render() {
    const { signedInUser, theme } = this.props

    // 提供初始 context 值的 App 组件
    return (
      <ThemeContext.Provider value={theme}>
        <UserContext.Provider value={signedInUser}>
          <Layout />
        </UserContext.Provider>
      </ThemeContext.Provider>
    )
  }
}

function Layout() {
  return (
    <div>
      <Sidebar />
      <Content />
    </div>
  )
}

// 一个组件可能会消费多个 context
function Content() {
  const theme = useContext(ThemeContext)
  const user = useContext(UserContext)
  return <ProfilePage user={user} theme={theme} />
}
```
</file>

<file path="docs/CONTRIBUTING-GUIDE.md">
---
title: 贡献指南
---

## 贡献代码

### 1. 环境准备

:::note
需要安装 [Node.js](https://nodejs.org/en/)（`18` 及以上版本）及 [pnpm 9](https://pnpm.io/zh/installation)

各版本 pnpm 与各版本 Node.js 之间的支持情况见 [pnpm 兼容性](https://pnpm.io/zh/installation#%E5%85%BC%E5%AE%B9%E6%80%A7)
:::

首先把 Taro 仓库 fork 一份到自己的 Github，然后从个人仓库把项目 clone 到本地，项目默认是 `main` 分支。

然后依次在项目根目录运行以下命令：

```bash
# 安装依赖
$ pnpm i
# 编译构建
$ pnpm build
```

运行完上述命令后，环境已经准备好，此时可以新拉一条分支进行开发。

### 2. 开发与调试

Taro 由一系列子 npm 包组成，整体项目组织基于 **pnpm workspace**。

开发者可以单独修改、编译某个子包：

```bash
# 编译某个子包，[package-name] 为该子包的 package.json 里的 name 字段
$ pnpm --filter [package-name] run dev
```

开发过程中，一般会使用 **link** 的方式把需要调试的包软链到一个测试项目中，然后便可进行断点调试。开发者可以根据测试项目的包管理器以及自己的喜好选择使用 `内置命令` 或 [npm link](https://docs.npmjs.com/cli/v7/commands/npm-link) 或 [yarn link](https://yarnpkg.com/cli/link)（推荐）或 [pnpm link](https://pnpm.io/zh/cli/link) 。

**使用 `内置命令` 的具体示例如下：**

```bash
$ pnpm run debug --projectPath /Users/taro/testapp --packages @tarojs/shared,@tarojs/runtime
```

1. 此命令会自动 `link` 并启动编译 `packages` 参数中的 npm 包
2. 增加`--unlink`参数可批量 unlink

**使用 `yarn link` 的具体示例如下：**

1. 进入需要调试的子包的根目录，然后执行 `yarn link`。
2. 进入测试项目的根目录，然后执行 `yarn link`。（注意被调试的子包的版本要和测试项目中该依赖的版本保持一致）

**使用 `pnpm link` 的具体示例如下：**

情况一、测试项目 `package.json` 中有声明对该包的依赖

1. 进入需要调试的子包的根目录，然后执行 `pnpm link --global`。
2. 进入测试项目的根目录，然后执行 `pnpm link --global [package-name]`。

情况二、测试项目 `package.json` 中没有声明对该包的依赖，该依赖包是被某个 Taro 包间接依赖的，如 `@tarojs/runner-utils`。

1. 测试项目的 `package.json` 中新增 pnpm 配置并配置该依赖包的具体链接路径

```json
"pnpm": {
  "overrides": {
    "@tarojs/runner-utils": "/Users/.../taro/packages/taro-runner-utils"
  }
},
```

2. 执行 `pnpm i` 重新安装测试项目的依赖

在测试项目中创建好链接后，接下来就可以启动项目编译。注意如果是编译 H5 或小程序时，请提前关闭依赖预编译配置：

```json
// /demo/config/dev.js
compiler: {
  type: "webpack5",
  prebundle: {
    enable: false,
  }
}
```

接下来在需要被调试的包中加入断点，**运行时代码**可以在各端的开发工具（小程序开发者工具、Chrome...）中断点调试，而**编译时**的代码需要使用 VSCode debugger 进行断点调试，请参考 [《单步调测》](./debug-config)。

### 3. 新增/删除依赖

推荐遵循的依赖治理规范：

- 尽量把子包用到的 `dependencies` 和 `devDependencies` 安装在子包。
- TypeScript、各种 Lint 工具、Rollup 等用于治理 Taro 项目的依赖推荐安装在主包。
- 如果子包是插件类项目，使用 `peerDependencies` 声明实际项目中肯定会安装的依赖。

```bash
# 在根目录新增依赖
$ pnpm add -wD <dependency>
# 在根目录删除依赖
$ pnpm remove -wD <dependency>
# 为某个子包（如 @tarojs/cli）新增一个依赖
$ pnpm --filter @tarojs/cli add <dependency>
# 为某个子包（如 @tarojs/cli）删除一个依赖
$ pnpm --filter @tarojs/cli remove <dependency>
# 为所有子包新增一个依赖
$ pnpm -r --filter=./packages/* add <dependency>
# 为所有子包删除一个依赖
$ pnpm -r --filter=./packages/* remove <dependency>
# 删除根目录的 node_modules 和所有 workspace 里的 node_modules
$ npm run clear-all
```

### 4. 单元测试

`package.json` 中设置了 `test:ci` 命令的子包都配备了单元测试。

开发者在修改这些包后，请运行 `pnpm --filter [package-name] run test:ci`，检查测试用例是否都能通过。

同时，在开发一些重要功能后，也请抽时间补上对应的测试用例。

**注意：**

`@tarojs/mini-runner`、`@tarojs/webpack-runner`、`@tarojs/webpack5-runner` 使用了 `snapshot`（测试结果快照）。在修改这两个包或其它一些包时，有可能导致这些快照失效，从而通过不了测试。当你修改了这两个包、或 Github CI 提示这些包的测试用例出错时，请运行 `pnpm --filter [package-name] runupdateSnapshot` 更新 snapshot 后重新提交。

### 5. 代码风格

- `JavaScript`：JavaScript 风格遵从 [JavaScript Standard Style](https://github.com/standard/standard)。
- `TypeScript`：TypeScript 风格也是 [JavaScript Standard Style](https://github.com/standard/standard) 的变种，详情请看相关包目录下的 `eslint.json` 和 `tsconfig.json`。
- 样式：遵循相关包目录下的 `.stylelintrc` 风格。

### 6. 提交 commit

整个 Taro 仓库遵从 [Angular Style Commit Message Conventions](https://gist.github.com/stephenparish/9941e89d80e2bc58a153)，在输入 commit message 的时候请务必遵从此规范。

### 7.提交 Pull Request

> 如果对 PR（Pull Request）不了解，请阅读 [《About Pull Requests》](https://docs.github.com/en/github/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests)

完成开发后，推送到自己的 Taro 仓库，就可以准备提交 Pull Request 了。

提交 PR 前请阅读以下注意事项：

1. 保证 `npm run build` 能够编译成功。
2. 保证代码能通过 ESLint 测试。
3. 当相关包含有 `npm test:ci` 命令时，必须保证所有测试用例都能够通过；
4. 当相关包有测试用例时，请给你提交的代码也添加相应的测试用例；
5. 保证 commit 信息需要遵循 [Angular Style Commit Message Conventions](https://gist.github.com/stephenparish/9941e89d80e2bc58a153)。
6. 如果提交到代码非常多或功能复杂，可以把 PR 分成几个 commit 一起提交。我们在合并时会会根据情况 squash。
7. PR 作者可以选择加入到 Taro 开发者微信群，方便合并 PR 和技术交流。

### 8. 发布测试版本

提交 PR 后，开发者可以在开发分支上发布测试版本到 npm。部分难以在本地验证的功能可以使用这种方式进行验证。

1. 确保分支名以 `feat/` 或 `chore/` 开头。
2. 在 Taro 项目根目录执行命令：

```bash
# 更新 workspace 内所有子包的版本号，如 pnpm version 3.6.22-alpha.0
$ pnpm version <version>
```

3. 执行 `git commit --amend` 命令，手动修改最新一个 commit 的 commit message，加上 `--tag=<tag>`（此 tag 代表发布的 npm tag）。如发布 alpha 版本：`chore(release): publish 3.6.22-alpha.0 --tag=alpha`。
4. 提交修改到远程仓库，将会触发 Github CI 的发布流程。

### 9. 文档

当提交涉及新增特性、Breaking Changes 或重要修改时，请及时新增、修改对应的文档。

关于文档的开发请阅读下一章节：《贡献文档》。

### 10. Rust 部分

Taro 仓库里有部分使用 Rust 开发的子包，在开发、调试、测试这些包时有不一样的流程。

Rust 代码存放在 `crates` 文件夹下，使用 Cargo workspace 管理，目前包括 NAPI bindings 和若干 SWC 插件。

开发前请使用 `rustup` 安装 Rust 工具链。

#### NAPI bindings

在根目录执行 `pnpm build:binding:debug` 或 `pnpm build:binding:release` 命令，会在 `crates/native-binding` 文件夹中编译出 binding 文件 `taro.[os-platform].node`。

然后可以执行单元测试：

```bash
$ pnpm --filter @tarojs/binding run test
```

或结合调用方执行集成测试。

#### SWC 插件

首先在项目根目录执行 `rustup target add wasm32-wasi` 命令安装 `wasm32-wasi` 的 `target`。

开发过程中可以使用 SWC 测试套件进行单元测试：

```bash
# 执行所有 SWC 插件的单元测试
$ cargo test-swc-plugins
# 执行某个 SWC 插件的单元测试
$ cargo test -p [package-name]
```

功能完成后可以编译出 `.wasm` 文件，联合调用方进行集成测试：

```bash
# 编译所有 SWC 插件
$ cargo build-swc-plugins
# 编译某个 SWC 插件
$ cargo build -p [package-name]
```

Cargo workspace 会把编译产物输出到根目录的 `target` 文件夹中。进行集成测试时，需要手动把 `.wasm` 产物软链到目标文件夹，而 Github CI 在正式发布时会自动拷贝产物到正确的文件夹中。

如对 `@taorjs/helper` 进行集成测试时，会把 `target/wasm32-wasi/release/swc_plugin_xxx.wasm` 文件的软链到 `packages/taro-helper/swc/swc_plugin_xxx.wasm`。

## 贡献文档

当阅读时遇到明显的错误，开发者可以点击每篇文档最下方的 `Edit this page` 按钮，即会打开 Github 的编辑界面。开发者对文档进行编辑后，就可以提交一个 Pull Request。

如果是较复杂的修改，可以按以下步骤进行操作：

#### 1. fork & clone

1. fork [taro-docs](https://github.com/NervJS/taro-docs) 仓库
2. clone 个人仓库的 taro-docs 至本地：

```bash
git clone https://github.com/{your github name}/taro-docs.git
```

#### 2. 编译预览

```bash
$ pnpm install
$ pnpm run start
```

#### 3. 修改、新增对应文档

> 文档支持 `md` 和 `mdx` 后缀，语法详见 [Docusaurus 官网](https://docusaurus.io/docs/next/markdown-features)

1. 修改文档

进入 `docs` 目录，找到对应的文件进行编辑。（必须，对应**下个版本**的相关文档）

进入 `versioned_docs/version-3.x` 目录，找到对应的文件进行编辑。（可选，对应**3.x 版本**的相关文档。不修改则需要等待 Taro 团队更新文档版本后，才会同步到文档的 `3.x` 版本）

2. 新增文档

新增文档和修改文档类似，首先分别到 `docs` 和 `versioned_docs/version-3.x` 目录新增一个文件。然后在 `sidebars.js` 和 `versioned_sidebars/version-3.x-sidebars.json` 文件中添加上述新增文件的路径。

#### 4. 提交 Pull Request
</file>

<file path="docs/CONTRIBUTING.md">
---
title: 贡献形式
---

正如我们在[《给开发者的信》](./join-in) 中所写的，我们非常欢迎各位开发者为 Taro 社区做出贡献。

贡献之前，请你花一些时间阅读以下内容，保证贡献是符合规范并且能帮助到社区。

> “Taro 社区如何运作？我可以怎样参与？”

Taro 接受各种形式的贡献，无论是提交一个重大改动，还是反馈一个问题或参加一次讨论，都能强化 Taro 的网络效应，让 Taro 变得越来越好用。

接下来，我们整理了 Taro 社区日常运营中常遇的各种细分情景。开发者可以从“参与讨论”、“提出问题”开始，一步一步融入社区，和 Taro 互相成就、共同成长。

### 参与讨论

可以到 [Taro 论坛](https://github.com/NervJS/taro/discussions) 的对应板块参与讨论。

Taro Github 上不断地产生着 [Issues](https://github.com/NervJS/taro/issues) 和 [Pull Request](https://github.com/NervJS/taro/pulls)，也非常欢迎各位开发者 Review 并参与讨论。

### Bug 反馈

请使用 [Issue 生成工具](https://issue.taro.zone/) 提交 Bug 反馈，并在上尽可能详细地提供一切必要信息，最好能附上一个可复现的 Demo。

一般情况下，**信息提供得越完整，响应时间越短**。

### Feature Request

如果你有一个 Feature Request，请到[论坛](https://github.com/NervJS/taro/discussions/categories/feature-request)新建一条帖子进行描述。

Taro 会收集重要的 Feature Requests，在 [《来为 Taro 的 Feature Request 投票吧！》](https://github.com/NervJS/taro/issues/6997) 中进行公示，开发者可以根据需要进行投票，需求强烈的特性会被**优先支持**。

### 修改文档

文档是开发者与框架沟通的桥梁，但文档一直以来是 Taro 的弱项。一方面我们会不断完善文档，另一方面也希望社区能协助我们把文档做好。

在修改之前请先阅读[《贡献指南》](./CONTRIBUTING-GUIDE#贡献文档)，它介绍了 Taro 文档的仓库地址、如何修改等信息。

### 新想法

无论是 Taro 团队内部还是社区第三方开发者，在为 Taro 提交一个重大特性时，都必须按照 Taro 的 [RFC（Request For Comment）机制](https://github.com/NervJS/taro-rfcs) 进行操作，经过社区讨论完善后再进行代码的提交。

因此如果你对 Taro 的发展有新的想法，如实现一个重要功能、拓展新的使用场景等，需要先撰写对应功能的 **RFC** 文档，Taro 团队会进行一系列推送，在社区征集意见。

> 可以访问 [taro-rfcs 仓库](https://github.com/NervJS/taro-rfcs)提交 RFC 或者查看相关的 RFC。

### 提交代码

> “我可以从哪些方向入手？又应该怎么做？”

开发者可以从处理 Issues 入手，[这里](https://github.com/NervJS/taro/issues?q=label%3A%22good+first+issue%22+is%3Aissue+is%3Aopen)会列出所有被标记为 **good first issue** 的 Issues，这是社区专门留给新贡献者的相对简单的入门级 Issues。也可以通过通过 Label 筛选出 **Helper Wanted** 的 Issues，并且会被分为 `Easy`、 `Medium`、 `Hard` 三种难易程度。

除了帮忙处理 Issues，Taro 还有很多方向需要人力进行建设。

随着对 Taro 内部运行机制的熟悉，开发者可能会产生一些新的想法，例如希望开发一些新的功能等。这时需要先编写 RFC 文档，在社区谈论完善后再开始编码。

在开发之前请先阅读[《Taro 的仓库概览》](./codebase-overview)以及[《贡献指南》](./CONTRIBUTING-GUIDE#贡献代码)，它们介绍了 Taro 仓库构成、如何开发和提交规范等信息。

如果是首次提交代码，可参考文章：[如何参与大型开源项目-Taro 共建](/blog/2022-01-19-how-to-join-Taro)。

### 工具分享

在社区分享你的 “轮子”（例如**SDK**、**组件**、**插件**、**UI 库**、**开源项目**等）。

可以提交到 [Taro 物料市场](https://taro-ext.jd.com)、文档[《社区优质物料》](./treasures) 、仓库 [awesome-taro](https://github.com/NervJS/awesome-taro) 里，并提供完善的说明。然后在 [Taro 论坛](https://github.com/NervJS/taro/discussions/categories/%E7%94%9F%E6%80%81) 中添加一条讨论，与开发者进行沟通。

Taro 团队会定期甄选优秀的物料汇集成文，在 Taro 社区和各大有影响力的前端渠道进行推广。

### 案例分享

分享你的成功案例，可以提交到 [taro-user-cases](https://github.com/NervJS/taro-user-cases)（只需提交小程序码、二维码）。

### 文章投稿

分享你的经验（教程、文章等），可以给「Taro 社区」公众号投稿。

## Credits

感谢以下所有给 Taro 贡献过代码的开发者：

<a href="https://github.com/NervJS/taro/graphs/contributors"><img src="https://opencollective.com/taro/contributors.svg?width=890&avatarHeight=36&button=false" /></a>
</file>

<file path="docs/convert-to-react.md">
---
title: 转换成 React
---

## 二次开发

原生小程序代码：

```jsx
Page({
  data: {
    text: 'Hello World'
  }
})

<view class="container">
  {{ text }}
</view>
```

转换后：

```javascript
import { Block, View } from '@tarojs/components'
import React from 'react'
import Taro from '@tarojs/taro'
import withWeapp from '@tarojs/with-weapp'
import Title from '../../components/title/index'
import './index.scss'

@withWeapp({
  data: {
    text: 'Hello World',
  },
})
class _C extends React.Component {
  render() {
    const { text } = this.data
    return <View className="container">{text}</View>
  }
}

export default _C
```

它看起来就像普通的 Taro 组件，最重要的区别就在于 `@withWeapp()` 这个装饰器，你可以将它理解为转换代码的运行时，`@withWeapp()` 会增加一些原来 Taro 没有方法和属性，例如：

### `this.setData`

转换后的 `this.setData` 的 API 相当于小程序的 `this.setData` 的 polyfill，他和 `this.setState` 最大的区别就在于，`this.setData` 之后 `data` 的数据是同步更新，而渲染是异步更新，而 `setState` 两者都是异步的。

### `this.data` 和 `this.properties`

`this.data` 和 `this.properties` 相当于 Taro 的 `this.state` 和 `this.props` 的 alias，当它们的数据更新时，对应的 `state` 和 `props` 也会同步更新。

### 生命周期

Taro 会将原生小程序的生命周期转换为 Taro 的生命周期，完整对应关系如下：

| 小程序生命周期     | Taro 生命周期        |
| :----------------- | :------------------- |
| onShow             | componentDidShow     |
| onHide             | componentDidHide     |
| App.onLaunch       | onLaunch             |
| Page.onLoad        | onLoad               |
| Page.onReady       | onReady              |
| Page.onUnload      | componentWillUnmount |
| Component.created  | componentWillMount   |
| Component.attached | componentDidMount    |
| Component.ready    | Page.onReady         |
| Component.detached | componentWillUnmount |
</file>

<file path="docs/css-in-js.mdx">
---
title: 使用 CSS-in-JS
---

import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

## linaria

在 React 社区有一个著名的 CSS-in-JS 解决方案: [styled-components](https://github.com/styled-components/styled-components)。但遗憾的是，`styled-components` 使用 `<style>` 标签来动态地控制样式，在小程序没有类似的方案。但我们可以通过 [linaria](https://github.com/callstack/linaria) 实现同样的功能，`linaria` 主要提供以下特性：

- 近似于 `styled-components` 的 API
- 完整的 TypeScript 支持
- 零运行时

使用 `linaria` 也非常简单，首先通过 NPM 安装依赖：

```bash
$ pnpm i @linaria/core @linaria/react @linaria/babel-preset @linaria/webpack-loader
```

其次配置项目根目录的 `babel.config.js`:

```js title="babel.config.js"
module.exports = {
  presets: [
    [
      'taro',
      {
        framework: 'react',
        ts: true,
      },
    ],
    '@linaria', // 添加到 babel-preset
  ],
}
```

之后配置 `config/index.js`

```js title="config/index.js"
const config = {
  mini: {
    webpackChain(chain, webpack) {
      // linaria/loader 选项详见 https://github.com/callstack/linaria/blob/master/docs/BUNDLERS_INTEGRATION.md#webpack
      chain.module
        .rule('script')
        .use('linariaLoader')
        .loader('@linaria/webpack-loader')
        .options({
          sourceMap: process.env.NODE_ENV !== 'production',
        })
    },
  },
  h5: {
    webpackChain(chain, webpack) {
      chain.module
        .rule('script')
        .use('linariaLoader')
        .loader('@linaria/webpack-loader')
        .options({
          sourceMap: process.env.NODE_ENV !== 'production',
        })
    },
  },
}
```

最后在项目根目录新建 `linaria.config.js`

```js title="linaria.config.js"
// linaria 配置详见 https://github.com/callstack/linaria/blob/master/docs/CONFIGURATION.md#options
module.exports = {
  rules: [
    {
      action: require('@linaria/shaker').default,
    },
    {
      test: /node_modules[\/\\](?!@tarojs)/,
      action: 'ignore',
    },
  ],
}
```

在业务代码中我们可以这样使用：

<Tabs
  defaultValue="JS"
  values={[
    {label: 'JavaScript', value: 'JS'},
    {label: 'TypeScript', value: 'TS'}
  ]}>
<TabItem value="JS">

```jsx
import { styled } from '@linaria/react'
import { View } from '@tarojs/components'
import React from 'react'

const Title = styled(View)`
  color: ${(props) => props.color};
`

const Index = () => {
  return <Title color="red">Hello World!</Title>
}

export default Index
```

</TabItem>

<TabItem value="TS">

```tsx
import { styled } from '@linaria/react'
import { View, ViewProps } from '@tarojs/components'

import React from 'react'
import './index.scss'

declare type Component<TProps> =
  | ((props: TProps) => any)
  | {
      new (props: TProps): any
    }

type VPS = ViewProps & { style?: React.CSSProperties }
type TP = VPS & { color: string }
const Title = styled<TP, VPS, Component<TP>>(View)`
  color: ${(props) => props.color};
`
const Index: React.FC = () => {
  return <Title color="red">Hello World!</Title>
}

export default Index
```

</TabItem>
</Tabs>

### 常见问题

- 使用 Linaria 设置组件样式后，该组件上的属性不生效，[#11664](https://github.com/NervJS/taro/issues/11664)
- `styled(View)` 写法会产生类型错误，[#8883](https://github.com/NervJS/taro/issues/8883)
- 与微信小程序直播插件 `live-player-plugin` 共用时报错，[#7389](https://github.com/NervJS/taro/issues/7389)

## Panda

[`pandacss`](https://panda-css.com/) 是个新兴的优秀 `CSS-in-JS` 编译时框架，相比 `linaria`，它的配置更加简单，智能提示好，开发者体验也更好。

而且它也吸收了许多 `tailwindcss` 的优点，我们可以自由的配置我们的主题与样式，且原子化的类名也更容易进行自由组合。

[`weapp-pandacss`](https://github.com/sonofmagic/weapp-pandacss) 就是让你在小程序开发中使用它。

### 快速开始

#### pandacss 安装和配置

##### 0. 安装和初始化 pandacss

首先我们需要把 `@pandacss/dev` 这些都安装和配置好，这里我们以 `tarojs` 项目为例：

```bash
npm install -D @pandacss/dev weapp-pandacss postcss # 或者 yarn / pnpm
npx panda init
```

此时会在当前目录生成一个 `panda.config.ts` 和一个包含大量文件的 `styled-system`。

> `panda.config.ts` 是 `pandacss` 的配置文件，`styled-system` 文件夹里的是 `pandacss` 的运行时 `js`。

把 `styled-system` 加入我们的 `.gitignore` 中去。

```diff
# .gitignore
+ styled-system
```

##### 1. 配置 postcss

接着在根目录里，添加一个 `postcss.config.cjs` 文件，写入以下代码注册 `pandacss`:

```js
module.exports = {
  plugins: {
    '@pandacss/dev/postcss': {}
  }
}
```

##### 2. 检查你的 panda.config.ts

生成的配置文件大概长下面这样，尤其注意 `include` 是用来告诉 `pandacss` 从哪些文件中提取原子类的，所以这个配置一定要准确

```ts
import { defineConfig } from "@pandacss/dev"

export default defineConfig({
  // 小程序不需要
  preflight: process.env.TARO_ENV === 'h5',
  // ⚠️这里，假如你使用 vue，记得把 vue 文件格式包括进来！！！
  include: ["./src/**/*.{js,jsx,ts,tsx}"],
  exclude: [],
  theme: {
    extend: {}
  },
  outdir: "styled-system",
})
```

##### 3. 修改 package.json 脚本

然后，我们添加下方 `prepare` 脚本在我们的 `package.json` 的 `scripts` 块中:

```diff
{
  "scripts": {
+    "prepare": "panda codegen",
  }
}
```

这样我们每次重新 `npm i/yarn/pnpm i` 的时候，都会执行这个方法，重新生成 `styled-system`，当然你也可以直接通过 `npm run prepare` 直接执行这个脚本。

##### 4. 全局 css 注册 pandacss

然后在我们的全局样式文件 `src/app.scss` 中注册 `pandacss`:

```css
@layer reset, base, tokens, recipes, utilities;
```

配置好了之后，此时 `pandacss` 在 `h5` 平台已经生效了，你可以 `npm run dev:h5` 在 `h5` 平台初步使用了，但是为了开发体验，我们还有一些优化项要做。

##### 5. 配置的优化与别名

来到根目录的 `tsconfig.json` 添加:

```diff
{
  "compilerOptions": {
    "paths": {
      "@/*": [
        "src/*"
      ],
+      "styled-system/*": [
+        "styled-system/*"
+      ]
    }
  },
  "include": [
    "./src",
    "./types",
    "./config",
+    "styled-system"
  ],
}
```

接着来到 `config/index.ts` 添加 `alias`([参考链接](./config-detail#alias)):

```ts
import path from 'path'

{
  alias: {
    'styled-system': path.resolve(__dirname, '..', 'styled-system')
  },
}
```

这样我们就不需要使用相对路径来使用 `pandacss` 了，同时 `ts` 智能提示也有了，你可以这样使用它:

```ts
import { View, Text } from "@tarojs/components";
import { css } from "styled-system/css";

const styles = css({
  bg: "yellow.200",
  rounded: "9999px",
  fontSize: "90px",
  p: "10px 15px",
  color: "pink.500",
});

export default function Index() {
  return (
    <View className={styles}>
      <Text>Hello world!</Text>
    </View>
  );
}
```

> 此部分参考的官方链接 <https://panda-css.com/docs/installation/postcss>

接下来进入 `weapp-pandacss` 的插件配置，不用担心，相比前面那些繁琐的步骤，这个可简单多了。

#### weapp-pandacss 配置

> 记得安装好 `weapp-pandacss` !

##### 0. 回到 postcss 进行注册

回到项目根目录的 `postcss.config.cjs` 注册 `weapp-pandacss`，添加以下配置:

```diff
module.exports = {
  plugins: {
    '@pandacss/dev/postcss': {},
+   'weapp-pandacss/postcss': {}
  }
}
```

##### 1. 回到 package.json 添加生成脚本

然后去 `package.json` 你添加 `prepare` 脚本的地方，加点代码

```diff
{
  "scripts": {
-    "prepare": "panda codegen",
+    "prepare": "panda codegen && weapp-panda codegen",
  }
}
```

> 注意这里必须用 `&&` 而不能用 `&`，`&` 任务执行会并行不会等待，而 `&&` 会等待前一个执行完成再执行后一条命令

然后，你再手动执行一下

```bash
npm run prepare
```

来重新生成 `styled-system`, 此时你会发现 `pandacss` 的命令行输出中多了 `2` 行:

```diff
✔️ `src/styled-system/css`: the css function to author styles
✔️ `src/styled-system/tokens`: the css variables and js function to query your tokens
✔️ `src/styled-system/patterns`: functions to implement apply common layout patterns
✔️ `src/styled-system/jsx`: styled jsx elements for react
+ ✔️ `src/styled-system/weapp-panda`: the core escape function for weapp
+ ✔️ `src/styled-system/helpers.mjs`: inject escape function into helpers
```

这代表着小程序相关的转义逻辑已经被注入进去，此时 `panda css` 生成的类就兼容小程序平台啦，是不是很简单?

当然为了防止你配置失败，我也给出了参考项目: [taro-react-pandacss-template](https://github.com/sonofmagic/taro-react-pandacss-template) 方便进行排查纠错。

### 常见问题

#### 跨平台注意事项

你可能同时开发 `小程序` 和 `h5` 平台，但是你发现使用 `weapp-pandacss` 之后，`h5` 平台似乎就不行了？

这时候你可以这样配置：

`process.env.TARO_ENV === 'h5'` 的时候，不去加载 `weapp-pandacss/postcss` (根据环境变量动态加载 `postcss` 插件)

同时你也可以执行 `weapp-panda rollback` 把 `css` 方法进行回滚到最原始适配 `h5` 平台的状态。

当然你恢复到小程序版本也只需要执行 `weapp-panda codegen` 就会重新注入了。

#### 小程序预览事项

当小程序预览时会出现 `Error: 非法的文件，错误信息：invalid file: pages/index/index.js, 565:24, SyntaxError: Unexpected token . if (variants[key]?.[value])` 错误。

这是因为 `panda` 生成的文件 `cva.mjs` 使用了 [`Optional chaining (?.)`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining)语法，这个语法小程序原生不支持，这时候可以开启勾选 `将JS编译成ES5` 功能再进行预览，或者使用 `babel` 预先进行处理再上传预览。

### 高级配置文件

你可以通过 `npx weapp-panda init` 命令在当前目录下创建一个 `weapp-pandacss.config.ts` 配置文件。

这个配置文件可以用来控制转义代码的生成和一部分 `postcss` 插件的行为。

```ts
import { defineConfig } from 'weapp-pandacss'

export default defineConfig({
  postcss: {
    // 转义插件是否生效，这只能控制核心插件的生效情况,而核心插件只是一部分
    // 假如你想让整个插件真正不生效，请在 `postcss.config.cjs` 里进行动态加载判断
    disabled: false,
    // 数组merge默认行为是直接concat 合并，所以传一个空数组是使用的默认数组
    // 转义替换对象
    selectorReplacement: {
      root: [],
      universal: [],
      cascadeLayers: 'a'
    },
    removeNegationPseudoClass: true
  },
  // 生成上下文
  context: {
    // 转义注入判断条件，更改后需要重新生成代码
    escapePredicate: `process.env.TARO_ENV !== 'h5' && process.env.TARO_ENV !== 'rn'`,
    // 插件的 pandaConfig 寻找配置
    pandaConfig: {
      cwd: process.cwd(),
      file: 'path/to/your-panda-config-file'
    }
  }
})
```

当然，你更改相关的配置项之后，要重新执行一下 `npm run prepare` 来生成新的注入转义代码。

### 参考示例

[taro-react-pandacss-template](https://github.com/sonofmagic/taro-react-pandacss-template)

## Fower

社区还有另一个方案 **Fower**，[文档](https://fower.vercel.app/docs/use-with-taro)
</file>

<file path="docs/css-modules.md">
---
title: 使用 CSS Modules
---

## 用法

Taro 中内置了 [CSS Modules](https://github.com/css-modules/css-modules) 的支持，但默认是关闭的，如果需要开启使用，请先在[编译配置](./config-detail)中添加如下配置。

### 在小程序端开启

```js title="config/index.js"
weapp: {
  module: {
    postcss: {
      // css modules 功能开关与相关配置
      cssModules: {
        enable: true, // 默认为 false，如需使用 css modules 功能，则设为 true
        config: {
          namingPattern: 'module', // 转换模式，取值为 global/module，下文详细说明
          generateScopedName: '[name]__[local]___[hash:base64:5]'
        }
      }
    }
  }
}
```

### 在 H5 端开启

```js title="config/index.js"
h5: {
  module: {
    postcss: {
      // css modules 功能开关与相关配置
      cssModules: {
        enable: true, // 默认为 false，如需使用 css modules 功能，则设为 true
        config: {
          namingPattern: 'module', // 转换模式，取值为 global/module，下文详细说明
          generateScopedName: '[name]__[local]___[hash:base64:5]'
        }
      }
    }
  }
}
```

### 设置转换模式

> 推荐使用自定义转换模式，这样的话就不会影响到一些第三方库的样式了

在开启之后，你就可以在 Taro 中使用 CSS Modules 功能了，值得注意的是，Taro 中使用 CSS Modules 有两种模式，分别为**全局转换**及**部分自定义转换**模式，通过 `namingPattern` 配置进行控制

`namingPattern` 配置取值分别如下：

- `global`，表示全局转换，所有样式文件都会经过 CSS Modules 转换处理，除了文件名中包含 `.global.` 的样式文件
- `module`，表示自定义转换，只有文件名中包含 `.module.` 的样式文件会经过 CSS Modules 转换处理

`generateScopedName` 支持传入字符串和函数：

- `字符串`，其格式见：[https://github.com/webpack/loader-utils#interpolatename](https://github.com/webpack/loader-utils#interpolatename)，值得指出的是，可使用 `[local]` 取其原类名
- `函数`，其类型定义为 `(localName: string, absoluteFilePath: string) => string`，其中 `localName` 为原类名，`absoluteFilePath` 为文件的绝对路径，返回值将作为新的类名

### 用法示例

CSS Modules 使用方式如下：

```scss title="组件样式"
.test {
  color: red;
  .txt {
    font-size: 36px;
  }
}
```

```jsx title="组件 JS 中使用样式"
import React, { Component } from 'react'
import { View, Text } from '@tarojs/components'

import styles from './Test.module.scss'

export default class Test extends Component {
  render() {
    return (
      <View className={styles.test}>
        <Text className={styles.txt}>Hello world!</Text>
      </View>
    )
  }
}
```

## 相关阅读

[开源插件 weapp-css-modules - 极致追求，让小程序代码包立减 10% 的插件](https://taro-club.jd.com/topic/2264/%E6%9E%81%E8%87%B4%E8%BF%BD%E6%B1%82-%E8%AE%A9%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BB%A3%E7%A0%81%E5%8C%85%E7%AB%8B%E5%87%8F-10-%E7%9A%84%E6%8F%92%E4%BB%B6-weapp-css-modules)
</file>

<file path="docs/custom-tabbar.mdx">
---
title: 微信小程序自定义 Tabbar
---

import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

Taro 支持使用 React、Vue、或者小程序原生语法来编写小程序自定义 TabBar 组件。

## 示例项目

- [微信小程序自定义 TabBar（React）](https://github.com/NervJS/taro/tree/next/examples/custom-tabbar-react)
- [微信小程序自定义 TabBar（Vue3）](https://github.com/NervJS/taro/tree/next/examples/custom-tabbar-vue3)

## 如何使用

配置方法和微信小程序相同，开发前请仔细阅读 [《微信小程序自定义 TabBar 文档》](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/custom-tabbar.html)。

### 配置信息

- 在 `app.config` 中按正常填写 **tabBar 项**的相关配置（为了向下兼容），并把 **tabBar 项**的 `custom` 字段设置为 `true`。
- 所有作为 TabBar 页面的 `config` 里需要声明 `usingComponents` 项，也可以在 `app.config` 设置全局开启。

**示例：**

```js title="app.config.js" {3}
export default {
  tabBar: {
    custom: true,
    color: '#000000',
    selectedColor: '#000000',
    backgroundColor: '#000000',
    list: [
      {
        pagePath: 'page/component/index',
        text: '组件',
      },
      {
        pagePath: 'page/API/index',
        text: '接口',
      },
    ],
  },
}
```

```js title="page/component/index.config.js" {3}
export default {
  navigationBarTitleText: '组件页',
  usingComponents: {},
}
```

```js title="page/API/index.config.js" {3}
export default {
  navigationBarTitleText: '接口页',
  usingComponents: {},
}
```

### 添加 custom-tab-bar

在 **src 目录**下添加 `custom-tab-bar` 目录，在里面书写组件，支持 React、Vue 和原生写法。

**React：**

    ├── config
    ├── src
    |   └── custom-tab-bar
    |       ├── index.json.js
    |       └── index.jsx
    └── package.json

**Vue：**

    ├── config
    ├── src
    |   └── custom-tab-bar
    |       ├── index.json.js
    |       └── index.vue
    └── package.json

**原生写法：**

    ├── config
    ├── src
    |   └── custom-tab-bar
    |       ├── index.js
    |       ├── index.json
    |       ├── index.wxss
    |       └── index.wxml
    └── package.json

### 图片资源引用

使用 React/Vue 开发自定义 TabBar 时，可以不使用 `import` 或 `require` 引用图片资源（Taro 会自动根据 TabBar 配置处理）。

如果使用了 `import`、`require` 或使用 `background-image` 时需要关注图片是否被 `url-loader` 处理为 base64，base64 的图片在 TabBar 中不能展示。

### 状态管理

默认 TabBar 与自定义 TabBar 的最大不同点在于，**默认 TabBar 在所有 TabBar 页共享一个组件实例，而自定义 TabBar 在各个 TabBar 页面初始化时都会创建一个新的组件实例**。

也就是说各个 TabBar 页内的自定义 TabBar 组件实例的状态是不共享的。因此对 TabBar 的状态管理（例如 `selected` 选中态）则尤为重要。

对于不同写法的自定义 TabBar，Taro 提供了不同的状态管理方案：

#### 1. 原生写法

微信小程序原生写法推荐使用 `getTabBar` 方法进行管理，如果你的自定义组件是使用原生写法编写的，那么可以参考[小程序官方提供的示例](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/custom-tabbar.html#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81)。

**唯一需要注意的是**，在小程序原生页面是调用 `this.getTabBar`，但 Taro 的页面是 React/Vue 组件，`this` 指向的并不是原生页面对象。因此需要先获取原生页面对象再进行调用：

```js
// 页面 onShow 时
Taro.getCurrentInstance().page.getTabBar()
```

#### 2. React / Vue

React 和 Vue 推荐使用**状态管理工具**（Redux、Vuex 等）对 TabBar 页的状态进行管理。优点在于无须侵入各个 TabBar 页面的代码，逻辑可以归集在 TabBar 组件中。

如果开发者不希望使用状态管理工具，Taro 提供了 `Taro.getTabBar` API 以获取自定义 TabBar 组件（React/Vue 组件），然后开发者可以调用它上面的方法去更新 TabBar 组件的状态。

```js
// 页面 onShow 时
const pageObj = Taro.getCurrentInstance().page
const tabbar = Taro.getTabBar(pageObj)
```

> [示例项目](./custom-tabbar#示例项目) 中提供了两个例子，React 版本的例子展示了如何使用 `Taro.getTabBar` 管理状态，Vue3 版本的例子则展示了如何使用状态管理工具来管理状态。

### 组件配置项

自定义 TabBar 组件使用小程序的 `Component` 构造器构造，开发者在处理样式隔离等问题时可以需要对 `Component` 进行配置。这时开发者可以给 React/Vue 编写的自定义组件这些配置项属性，Taro 会把它们放置到 `Component` 构造对象上，目前支持：`options`、`externalClasses`、`behaviors`。

**例子：**

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx title="示例代码"
// Class Component
class CustomTabBar extends Component {
  static options = {
    addGlobalClass: true,
  }
}

// Functional Component
function CustomTabBar() {}
CustomTabBar.options = {
  addGlobalClass: true,
}
```

</TabItem>

<TabItem value="Vue">

```html title="示例代码"
<script>
  // 只支持 Options API 写法，不支持 <script setup>
  export default {
    options: {
      addGlobalClass: true,
    },
  }
</script>
```

</TabItem>
</Tabs>

## 常见问题

### 闪烁问题

#### 第一次加载 TabBar 页时 TabBar 会闪烁

自定义 TabBar 在各个 TabBar 页面初始化时都会创建一个新的组件实例导致。可以到微信小程序开发者社区寻找相关解决方案。

#### 切换 Tab 时图片闪烁

尽量使用本地图片或 iconfont。

### 相关讨论

- https://github.com/NervJS/taro/issues/7302
</file>

<file path="docs/debug-config.md">
---
title: 单步调测配置
---

> 通过本身 `VSCode` 提供的跨平台代码单步调测能力，能够极大提升基于 `Taro` 开发框架的应用开发速度，因其他平台已有比较成熟的工具可以使用，着重降低 Windows 平台配置复杂度。

## 一、开发环境搭建

首先准备 `Taro` 在 Windows 下的基础开发环境，详情如下(已有开发环境可略过）：

### 1. 安装 Node.js

建议安装 `16.20.0` 及以上版本，官方下载地址：[Node.js](https://nodejs.org/dist/v16.20.0/node-v16.20.0-x64.msi 'node.js')

### 2. 安装 VSCode

安装完最新 `VSCode` 后，建议安装如下插件:

- `ESlint` — 代码规范
- `TSlint` — 语法检查

### 3. Taro 源码下载

下载地址：[Taro](https://github.com/NervJS/taro.git 'Taro')，默认为 `next` 分支。

### 4. 源码依赖安装

1.使用 `VSCode` 打开 `Taro` 源码目录，在根目录下执行 `pnpm i` ，安装项目所需依赖库（首次安装所花时间较长，请耐心等待）

2.执行 `pnpm build` 编译所有模块

## 二、单步调试

### 1. 配置 VSCode 调试参数

:::note
launch.json 的详细配置请见 [VSCode 文档](https://code.visualstudio.com/docs/editor/debugging#_launch-configurations)
:::

在 VSCode 中打开 Taro 源码根目录的 **.vscode** 文件夹，编辑 **launch.json**。

修改步骤：

- 修改 `cwd` 选项为需要调试的目标工作目录
- 修改 `args` 为需要调试的命令参数

```json title="launch.json" {10-16}
{
  // ...
  "configurations": [
    //...
    {
      "type": "node",
      "request": "launch",
      "name": "CLI debug",
      "program": "${workspaceFolder}/packages/taro-cli/bin/taro",
      // "cwd": "${project absolute path}",
      // "args": [
      //   "build",
      //   "--type",
      //   "weapp",
      //   "--watch"
      // ],
      "skipFiles": ["<node_internals>/**"]
    }
  ]
}
```

#### 例子

##### 1) 调试 taro-build

假设需要调试 test 项目的 `taro build --weapp --watch` 命令。

可以这样配置 launch.json：

```json title="launch.json"
{
  // ...
  "configurations": [
    //...
    {
      // ...
      "cwd": "/Users/User/Desktop/test",
      "args": ["build", "--type", "weapp", "--watch"]
    }
  ]
}
```

##### 2) 调试 taro-init

假设需要调试 `taro init projectName` 命令。

可以这样配置 launch.json：

```json title="launch.json"
{
  // ...
  "configurations": [
    //...
    {
      // ...
      "cwd": "/Users/User/Desktop",
      "args": ["init", "projectName"]
    }
  ]
}
```

### 2. 编译子包

调试某一个子包时，如果希望能调试修改后的代码，请先进入对应子包的根目录开启 watch 模式编译。

例如调试 `@tarojs/mini-runner`，先进入 `packages/mini-runner/`，然后在此目录下对运行 `npm run dev`（各子包编译命令可能有所不同，详情请见各子包的 **package.json**）。这样我们就能对每次修改后的代码进行调试。

### 3.链接未发布的库

如果当前开发的子包依赖于其它子包，可以把其它子包 link 过来使用。

如果需要为当前子包增加其它子包作为依赖，可以在 Taro 源码根目录执行 `pnpm --filter=[target] add [package] [--save-dev]`，之后 pnpm 会自动创建好软链。

例如为 `@tarojs/cli` 增加 `@tarojs/webpack-runner` 作为 devDependencies：

`pnpm --filter=@tarojs/cli add "@tarojs/webpack-runner@workspace:*" --save-dev`

### 4.启动调试

按下图操作即可开始单步调试，详细调试操作可参考 VSCode 文档。

![debug](https://storage.jd.com/cjj-pub-images/WX20200602-221337.png)

:::note
目前 Taro 项目的子包一般编译都会产生 `source-map`，所以一般都能够直接在源码位置使用断点。如果某些包编译时没有开启 `source-map`，可手动开启然后提交 `Pull Requests`。
:::
</file>

<file path="docs/debug.md">
---
title: Debug 指南
---

和所有框架一样，Taro 也可能存在 bug。当你认为你的代码没有问题，问题出在 Taro 时，可以按照本章内容进行调试。

当你在 Taro 进行 debug 时，请先确认一下流程均已完成：

1. ESLint 已经开启并且没有报错；
2. 大致过了一遍包括[最佳实践](./best-practice.md)在内的文档，文档里没有对应问题的描述；
3. 搜索过相关的 issue，issue 没有提到相关解决方案；
4. 按项目使用的 Taro 版本往上查看 [changelog](https://github.com/NervJS/taro/blob/master/CHANGELOG.md)，changelog 中没有意见修复相关问题的提交；

很多时候只要你把以上四个流程都走一遍，遇到的问题就会迎刃而解。而作为一个多端框架，Taro 有非常多的模块，当出现问题时 Taro 也需要分模块进行调试，接下来我们会举一些已经解决了的 bug 样例，阐述我们调试 bug 的思路：

## 安装

### 使用 yarn 安装完 CLI 报错

由于 [commander.js](https://github.com/tj/commander.js) 的[缘故](https://github.com/tj/commander.js/issues/786)，在 Mac 下使用 yarn 安装 CLI，偶尔会出现执行命令报错的情况

```bash
taro-init(1) does not exist, try --help
```

这时候，你可以选择使用 npm 或者 cnpm 重新安装 CLI，或者将 CLI [添加到环境变量中来解决](https://github.com/NervJS/taro/issues/2034)。

### 项目依赖一直安装不下来

由于 Taro 的 `@tarojs/webpack-runner` 包默认依赖了 `node-sass`，倒是有些时候依赖一直安装不了，在此，建议直接使用淘宝的 [cnpm](https://npm.taobao.org/) 进行安装依赖，或者尝试一下[这个包](https://github.com/gucong3000/mirror-config-china)

## 小程序

### 没有任何报错，但显示的结果不如预期

#### 被 diff 逻辑过滤

此问题发生在页面或组件**更新**时。

在调用小程序的 setData 方法前，Taro 会把 state 与 data 做一次 [diff](/docs/2.x/optimized-practice#小程序数据-diff)。

如果 state 与 data 的某个属性值没有变化，很有可能就不会重新 setData 该属性，导致页面或组件没有正确更新。

这种问题多出现在小程序的表单组件中，例如以下两个 issue：[#1981](https://github.com/NervJS/taro/issues/1981)、[#2257](https://github.com/NervJS/taro/issues/2257)。因为小程序一些表单组件为非受控组件，表单更新时，对应 value 值的 data 并不会更新，导致 data 值还是初始值。如果再 setState 此属性为初始值，由于 diff 逻辑判断属性值没有变化，不会 setData 此属性，导致视图没有更新。正确做法是在表单组件的 update 事件中 setData value 为当前值，保证 data 与表单显示值保持一致。

##### debug diff

开发者可以在开发者工具中找到 taro 运行时库，在 diff 方法前后打断点或 log，观察 **state**、**小程序 data** 和 **diff 后将要被 setData 的数据**，这种排查有助定位很多**视图更新**问题。

![qq20190305-151951](https://user-images.githubusercontent.com/11807297/53787956-514bb280-3f5b-11e9-9faf-f73ccd005222.png)

##### 微信小程序，增加数组元素无法正确更新数组 length

增加数组元素时，经 diff 后会按路径更新。但由于微信小程序自身 bug，按路径更新数组时，数组 length 不会正确更新。详见 [#882](https://github.com/NervJS/taro/issues/882)

此问题只出现于微信小程序，[微信官方说法是暂不修复](https://developers.weixin.qq.com/community/develop/doc/000c8a7eeb45e8b018b72f01356800)。

推荐做法是新开一个 state 值来同步 length 变化。

#### 编译模板出错

这时候很可能是编译模板出现了错误。例如中 [#2285](https://github.com/NervJS/taro/issues/2258) 中，题主写了两个嵌套循环，在第二个循环中无法正确地访问到第一个循环声明的 `index` 变量：

```jsx
// 假设源码在 src/pages/index/index.js 中
rooms.map((room, index) => (
  <View key={room.id}>
    <View>房间</View>
    <View className="men">
      {room.checkInMen.map(man => (
        <View onClick={this.handleRemoveMan.bind(this, man.id, index)}>
          {man.name}
        </View>
      ))}
    </View>
  </View>
);
```

而编译出来的 `wxml` 将会是：

```html
<!-- 编译后代码代码至少会生成三个文件，分别是: -->
<!-- dist/pages/index/index.js，dist/pages/index/index.wxml，dist/pages/index/index.json -->
<view wx:for="{{loopArray0}}" wx:for-item="room" wx:for-index="index">
  <view>房间</view>
    <view class="men">
      <view  data-e-tap-a-b="{{index}}" bindtap="handleRemoveMan" wx:for="{{room.$anonymousCallee__0}}" wx:for-item="man" data-e-tap-so="this" data-e-tap-a-a="{{man.$original.id}}">{{man.$original.name}}
      </view>
    </view>
  </view>
</view>
```

观察编译前后文件，我们可以发现：由于第二个循环没有指定 `index` 变量名，Taro 编译的循环也没有指定 `index` 变量名。但问题在于微信小程序当不指定 `index` 时，会隐式地注入一个名为 `index` 的变量名作为 `index`。因此这段代码在第二个循环中访问 `index`，实际上是当前循环的 `index`，而不是上级循环的 `index`。

当我们了解到问题所在之后，解决问题也很容易，只要在第二个循环显式地暴露循环的第二个变量即可，源代码可以修改为：

```jsx
rooms.map((room, index) => (
  <View key={room.id}>
    <View>房间</View>
    <View className="men">
      {room.checkInMen.map((man, _) => (
        <View onClick={this.handleRemoveMan.bind(this, man.id, index)}>
          {man.name}
        </View>
      ))}
    </View>
  </View>
);
```

### 运行时在小程序开发者工具报错

有时候我们会在运行时遇到这样错误：

![debug.png](https://i.loli.net/2019/02/27/5c765b5bc1915.png)

调试这样的问题也很简单，只需要点击调用栈从调用栈最上层的链接，点进去我们可以发现是这样的代码：

![debug2.png](https://i.loli.net/2019/02/28/5c77517c622e3.png)

这时我们可以发现这个错误的原因在于变量 `url` 在调用 `Object.assign()` 函数时找不到变量，我们可以再看一下源码：

```jsx
// 如果运行时报错文件路径是：dist/pages/test/test.js
// 那么就可以推算出源码在：src/pages/test/test.js
// 编译后的 js 文件已经经过 Babel 编译过，但函数基本上还是能一一对应的
// 除了 `render()` 函数会对应到 `_createData()` 函数，形如 `renderTest` 函数会对应到 `createTestData` 函数
render () {
  let dom = null
  if (this.props.visable) {
      const url = 'https://...'
      dom = <Image src={url} />
  }

  return <Container>
    {dom}
  </Container>
}
```

通过观察编译前后代码，我们可以发现源码没有任何问题，但 Taro 在此问题出现的版本没有处理好 if 表达式作用域内的变量，调用 `Object.assign()` 函数时 `url` 变量并不存在于 `render` 函数的作用域中。为了解决这个问题，我们可以修改源码，手动把 `url` 变量也放在 `render` 函数作用域中：

```jsx
render () {
  let dom = null
  let url = ''
  if (this.props.visable) {
      url = 'https://...'
      dom = <Image src={url} />
  }

  return <Container>
    {dom}
  </Container>
}
```

大部分运行时错误都可以通过小程序内置的 Chrome DevTools 找到报错的缘由，如果当前调用栈没有找到问题所在，可以往上逐层地去调试各个调用栈。Chrome DevTools 相关文档请查看：[Chrome 开发者工具](https://developers.google.com/web/tools/chrome-devtools/)

### 生命周期/路由/setState 出错

在 [#1814](https://github.com/NervJS/taro/issues/1814) 中提到了 `this.$router.path` (当前页面路由的路径) 有时无法访问。经过调研发现原因在于 Taro 把获取路径的函数放在了小程序的 `onLoad` 函数上，而不是每个组件都能调用到这个函数。而解决这个问题的方法也很简单，如果当前页面是组件可以直接通过 `this.$scope.route` 访问，更普适的方法则是通过 `getCurrentPages` 函数访问到当前页面的示例，然后访问实例的 `route` 或 `__route__` 访问到当前页面路由的路径。

通过这个例子，我们不难发现 Taro 的生命周期/路由 和 `setState` 在小程序端其实是包装成 React API 的一层语法糖，我们把这层包装称之为 Taro 运行时框架。几乎所有 Taro 提供的 API 和语法糖最终都是通过小程序本身提供的 API 实现的，也就是说当 Taro 运行时框架出现问题时，你基本都能使用小程序本身提供的 API 达到同等的需求，其中就包括但不限于：

1. 使用 `this.$scope.triggerEvent` 调用通过 props 传递的函数;
2. 通过 `this.$scope.selectComponent` 和 `wx.createSelectorQuery` 实现 `ref`;
3. 通过 `getCurrentPages` 等相关方法访问路由；
4. 修改编译后文件 `createComponent` 函数创建的对象

虽然使用小程序原生方法也能做很多同样的事，但当 Taro 运行时框架出现问题时，我们还是强烈建议开发者向 Taro 官方 [提交 issue](https://github.com/NervJS/taro/issues/new/choose)，有能力的开发者朋友也可以 [提交 PR](https://github.com/NervJS/taro/pulls)。一方面使用 Taro API 实现可以帮助你抹平多端差异，另一方面寻找甚至是修复 bug 也有助于加强你对 Taro 和小程序底层的理解。

### 微信小程序表单组件问题

微信小程序表单组件不是受控组件，当用户操作表单时视图会**立即改变**，但表单的 value 值还是没有变化。

如果在表单 `onChange`、`onInput` 此类值改变回调中 setState value 为用户操作改变表单之前的值时，Taro 的 diff 逻辑会判断 setState 的 value 值和当前 data.value 一致，则**放弃 setData**，导致视图没有正确更新。

解决办法：

Input 组件可以通过在回调中 return 需要改变的值来更新视图。详见 [#2642](https://github.com/NervJS/taro/issues/2642)

小程序 Input 组件文档截图：

![inputdoc](https://user-images.githubusercontent.com/11807297/55405139-fcb44b00-558b-11e9-845f-afbc73863b48.png)

其它组件需要立即 `setState({ value: e.detail.value })` 以立即更新同步 data.value 值，然后再 setState 真正需要表单改变的值。详见 [#1981](https://github.com/NervJS/taro/issues/1981)、[#2257](https://github.com/NervJS/taro/issues/2257)

### API 问题

#### API 调用结果不符合预期

Taro 小程序端的 API 只是对小程序原生 API 简单地进行了 promise 化，并没有做什么额外操作。因此开发者在遇到这种情况时可以试试直接使用小程序 API，如微信小程序中直接使用 `wx.xxx`。如果有同样的报错，证明是小程序方面的问题。否则则可能是 Taro 的问题，可以给我们提相关 issue。

#### API 调用报错

假设开发者在调用某个 API `Taro.xxx`，出现类似以下报错：

![image](https://user-images.githubusercontent.com/11807297/59170450-45324b00-8b71-11e9-8e25-1169b425040c.png)

证明 Taro 还没兼容此 API，比如一些小程序平台最新更新的 API。这时可以给我们提 issue 要求添加，或者修改此文件 [native-apis.js](https://github.com/NervJS/taro/blob/master/packages/taro/src/native-apis.js) 后，给我们提 PR。

## H5

### 运行时报 DOM 相关错误

在 [#1804](https://github.com/NervJS/taro/issues/1804) 中提到，只要使用了 `Block` 组件并且有一个变量控制它的显式时，就必定会报错：

```jsx
export default class Index extends Component {
  config = {
    navigationBarTitleText: '首页',
  }

  state = {
    num: 1,
  }

  componentDidMount() {
    console.log('did')
    setTimeout(() => {
      this.setState({
        num: 0,
      })
    }, 2000)
  }

  render() {
    const { num } = this.state
    return (
      <View className="container">
        {num === 0 && <View>已卖完</View>}
        {num > 0 && (
          <Block>
            <View>正在销售</View>
            <View>立即购买</View>
          </Block>
        )}
        {/* {num > 0 && <View>正在销售</View>} */}
      </View>
    )
  }
}
```

这个时候我们可以把问题定位到 `Block` 组件中，我们可以查看 `@tarojs/components` 的 `Block` 组件源码：

```jsx
const Block = (props) => props.children
export default Block
```

也就是说当变量 `num > 0` 时，`Block` 组件的 `children` 会显示，而当 `Block` 组件的 `children` 是一个数组时，`View.container` 的 `children` 就变成 `[一个 View 组件, [一个数组]]`，渲染这样的数据结构需要 `React.Fragment` 的包裹才能渲染。而 Taro 目前还没有支持 `React.Fragment` 语法，所以这样的写法就报错了。解决这个问题也很简单，只需要修改 `Block` 组件，用一个元素包裹住 `children` 即可:

```jsx
const Block = (props) => <div>{props.children}</div>
```

当你遇到了相关问题时，我们准备了一个快速起步的沙盒工具，你可以直接在这个工具里编辑、调试、复现问题：

[![Edit Taro sandbox](https://codesandbox.io/static/img/play-codesandbox.svg)](https://codesandbox.io/s/50nzv622z4?fontsize=14)

## 组件

### jsEnginScriptError

`Component is not found in path "xxx/xxx/xxx"` 解决办法：

1、检查有没有编译报错

2、检查编译后的文件是否正确

3、步骤 1 和 步骤 2 如果检查没有问题，重启开发者工具，否则跳到步骤 4

4、提供具体编译报错信息与编译后文件信息的截图

## 其它资源

本文列举了一些 Taro 的已解决 bug 例子，阐述了在 Taro 中 debug 的思路，但在实际操作中如果你能更深入地了解 Taro 的实现原理，那无论是对使用 Taro 或是 debug 都会有很大的帮助。以下资源从各个方面都介绍了 Taro 的实现原理：

- 博文：[Taro 诞生记](https://aotu.io/notes/2018/06/25/the-birth-of-taro/)
- 公开演讲: [使用 Taro 快速开发多端项目](https://share.weiyun.com/5nUKYfy)
- 公开演讲： [基于 Taro 的多端项⽬目实践](https://share.weiyun.com/5lZXV1G)
- 掘金小册：[Taro 多端开发实现原理与实战](https://juejin.im/book/5b73a131f265da28065fb1cd?referrer=5ba228f16fb9a05d3251492d) (已下架，仅购买用户可阅)
</file>

<file path="docs/difference-to-others.md">
---
title: 与其它新型小程序框架的异同
---

> 请注意：各个框架迭代速度都非常快，可能框架的设计和实现会出现改变。

在本节我们将与三个新型小程序框架进行对比，它们分别是：[remax](https://github.com/remaxjs/remax), [alita](https://github.com/areslabs/alita), [kbone](https://github.com/wechat-miniprogram/kbone)。这三个框架和 Taro Next 总体的思路都一样：相对于编译型的小程序框架而言，新型小程序框架有一个(或多个)基础模板，基础模板接受不同的数据渲染与之对应的内容，小程序框架主要的工作是把开发者的业务逻辑转换成基础模板可接受的数据去驱动小程序渲染。

我们尽量尝试避免偏见。但显而易见，作为 Taro 团队，我们会不可避免地倾向于 Taro。在本次对比中，我们仅会从技术选型、总体设计、内部实现对比各个框架，不会涉及例如生态和项目/开源治理等因素。如果你倾向于全面的对比，可以参考 [小程序框架全面测评](https://aotu.io/notes/2019/03/12/mini-program-framework-full-review/)。

## Alita

Alita 严格来讲并不算小程序开发框架，它实际上是一个把 React Native 代码转换成微信小程序代码的转换引擎工具。

在内部的实现上，Alita 采用了静态编译 + 运行时处理 JSX 的实现。静态编译部分捕捉 JSX 和 React 组件声明，并生成对应的 wxml 模板，运行时把捕捉到的 React 组件转换为静态模板可接受的渲染数据实现渲染。由于静态编译部分的存在，Alita 不能完整地支持所有 JSX 特性，生成的模板也会更多，最终打包的 size 会比其它新型小程序框架更大一些。但与之对应的，这样的实现的会获得更好的性能。

另外 Alita 内部实现了一个 mini React，目前还没有例如 Hooks 这样的功能，也无法自由引入其它的 React 生态库。其它的新型小程序框架都可以引入不涉及浏览器 API 的 React 生态库。

## Remax

Remax 是一个可以让完整的 React 跑在小程序上的小程序开发框架。为了让 React 跑在小程序上，Remax 通过 [react-reconciler](https://www.npmjs.com/search?q=react-reconcile) 实现了一个小程序渲染器。这点和 Taro Next 一致。

在渲染方面，Remax 有一个静态模板列出了所有开发者声明过的组件，静态模板通过遍历渲染器返回的数据（类似于一颗 DOM 树）实现渲染。不过在微信小程序的模板不支持递归，当数据的层级超过了 Remax 设定的阈值（阈值可以自行设定）就会发生爆栈导致无法渲染。而 Kbone 和 Taro 都通过组件的方案来避免这个问题。

Remax 同 React 进行了强绑定，不支持除 React 之外的 Web 开发框架。Kbone 和 Taro 都支持 React 和类 React 以及 Vue。

## Kbone

Kbone 内部实现了轻量级的 DOM 和 BOM API，把 DOM 更改绑定到小程序的视图更改。也就是说，Kbone 并不太关心开发者使用什么框架，只要框架使用的 DOM API 被 Kbone 实现的 DOM API 覆盖到，框架就能通过 Kbone 在小程序运行。Taro Next 也有着同样的思路，但不同的是对 React 的处理。Kbone 通过引入 `react-dom` 实现渲染，但 `react-dom` 包含着合成事件实现和大量浏览器兼容代码。Taro 团队认为这部分代码对小程序平台意义不大，因此和 Remax 一样，通过 `react-reconciler` 实现了小程序渲染器。

在更新方面，Kbone 以组件为粒度进行更新，每次视图改变小程序 setData 的数据是组件的 DOM 树。而 Remax 和 Taro 更新 setData 的数据则是 DOM 树中已经改变了的的值和它的路径。对比起 Taro 和 Remax，Kbone 的运行时性能会差一些。

另外 Kbone 更为专注于微信小程序开发和 H5 开发，而本节对比的其它三个小程序框架均支持多种平台的小程序开发。

## 总结

通过我们的对比不难发现，虽然 4 个框架的核心原理大致相同，但技术选型，内部实现，优化思路都有很大的不同。究其原因是因为 4 个框架都是企业团队进行开发的，这就意味着框架必须优先满足企业和部门的需求和利益，框架的设计和实现的区别也不能代表开发团队技术水平的高下，而是框架开发者根据项目/业务类型和技术栈不同的取舍和妥协。开发者可以根据自己的团队技术栈和项目/业务特性决定使用框架。
</file>

<file path="docs/dynamic-import.md">
---
title: 动态 import
---

在 H5 开发时，我们能够使用动态 import 语法实现异步加载等功能。但在小程序环境是不支持动态 import 的，因此 Taro 默认会把动态 import 语法转换为普通 require 语法。

感谢 [@JiyuShao](https://github.com/JiyuShao) 同学贡献的插件 [taro-dynamic-import-weapp](https://github.com/JiyuShao/taro-dynamic-import-weapp)，让我们能够在微信小程序环境中使用上动态 import。

## 小程序

受小程序环境限制，默认不支持真正的动态 import。此时 `babel-preset-taro` 会启用 `babel-plugin-dynamic-import-node` 插件，**把动态 import 语法转换为 require 语法**。

### 微信小程序

`Webpack4`

借助 [@JiyuShao](https://github.com/JiyuShao) 同学贡献的插件 [taro-dynamic-import-weapp](https://github.com/JiyuShao/taro-dynamic-import-weapp) 可以在微信小程序中使用真正的动态 import 功能，实现动态加载 JS 代码。

:::caution 请注意
由于微信小程序官方社区[规范要求](https://developers.weixin.qq.com/community/minihome/doc/0000ae500e4fd0541f2ea33755b801)限制，该插件方案可能会导致代码审核环节驳回应用。
:::

例如动态加载 React 组件：

```jsx title="pages.jsx"
import { Suspense } from 'react'
import { View, Text } from '@tarojs/components'

export default const Index = () => {
  const DynamicComponent = React.lazy(
    () => import('../../dynamic-import/dynamic-component/index')
  )
  return (
    <View>
      <Suspense fallback={<Text>Loading...</Text>}>
        <DynamicComponent />
      </Suspense>
    </View>
  )
}
```

动态加载示例：

![](https://storage.jd.com/cjj-pub-images/taro-demo-dynamic.jpg)

:::info
在 Taro `v3.4.4` 及之前的版本，需要使用 `babel-preset-taro-dynamic-import-weapp` 代替 `babel-preset-taro`，才能取消启用 `babel-plugin-dynamic-import-node` 插件。

Taro `v3.4.5` 开始，`babel-preset-taro` 新增了 `dynamic-import-node` 配置，可以直接配置取消启用 `babel-plugin-dynamic-import-node` 插件。
:::

```js title="babel.config.js" {5,17,20}
// Taro v3.4.4 及以下版本
module.exports = {
  presets: [
    [
      'babel-preset-taro-dynamic-import-weapp',
      {
        // ...
      },
    ],
  ],
}

// Taro v3.4.5+
module.exports = {
  presets: [
    [
      'taro',
      {
        // ...
        'dynamic-import-node': false,
      },
    ],
  ],
}
```

## H5

H5 支持使用动态 import。

如果有需要把动态 import 语法转换为 require 语法时，可以配置 `babel-preset-taro` 启用 `babel-plugin-dynamic-import-node` 插件（Taro v3.4.5+）。

:::caution 请注意
不可与 [prebundle](./prebundle) 搭配使用，这会对依赖的引入造成破坏。
:::

```js title="babel.config.js" {8}
// Taro v3.4.5+
module.exports = {
  presets: [
    [
      'taro',
      {
        // ...
        'dynamic-import-node': true, // 如果使用时遇到问题，可尝试将 devServer 配置项中的 hot 设置为 false
      },
    ],
  ],
}
```
</file>

<file path="docs/env-mode-config.md">
---
title: 模式和环境变量
---

:::info
Taro v3.5.10 开始支持，之前的版本可参考 [taro-plugin-environment](https://github.com/bigmeow/taro-plugin-environment)
:::

`模式` 在 `Taro cli` 中，是用于给环境变量分组并加载其分组下的环境变量，它是一组环境变量的 `name`。
它参考了 [vue-cli 中的模式和环境变量加载方式](https://cli.vuejs.org/zh/guide/mode-and-env.html) , 所以若你之前使用过 `vue-cli`，可以更快掌握用法。

## 默认行为

默认情况下, `模式` `Taro cli` 有 2 个模式：

- `development` 模式用于开发时 `taro build --type weapp --watch`，它等价于 `taro build --type weapp --watch --mode development`
- `production` 模式用于生产时 `taro build --type weapp`， 它等价于 `taro build --type weapp --mode production`

可以发现，默认情况下 `模式` 的值，取决于 `NODE_ENV` 的值（但是反过来说模式的值无法改变 `NODE_ENV` 的值）。

假设你有`开发`和`生产`2 个环境，你可以在项目根目录下新建两个`env`环境文件：

```
.env.development     # 在 development 模式时被载入
.env.production      # 在 production 模式时被载入
```

环境文件只包含环境变量的“键=值”对：

```
TARO_APP_API="https://api.tarojs.com"
```

:::warning 限制
请注意，只有以 `TARO_APP_` 开头的变量将通过 `webpack.DefinePlugin` 静态地嵌入到客户端侧的代码中。这是为了避免和系统内置环境变量冲突。
:::

被载入的环境变量我们可以在所有 `taro` 插件、 `config/index.ts`配置文件 以及 `src` 目录下面的项目文件中使用, 例如：

```ts
// src/service/request.ts
const request = axios.create({
  baseURL: process.env.TARO_APP_API
};
export default request
```

在构建过程中，`process.env.TARO_APP_API` 将会被相应的值所取代。在 `TARO_APP_API="https://api.tarojs.com"` 的情况下，它会被替换为 "https://api.tarojs.com"

## 自定义模式

若默认的模式满足不了需求，你可以在命令上使用参数 `--mode 模式名` 的方式来指定模式名，以加载某一组环境变量，例如：

```bash
taro build --type weapp --mode uat
```

以上命令表示在构建时会加载 `.env.uat` 文件中的环境变量.

mode 具体载入规则：

```sh
.env                # 在所有的环境中被载入
.env.local          # 在所有的环境中被载入，但会被 git 忽略
.env.[mode]         # 只在指定的模式中被载入
.env.[mode].local   # 只在指定的模式中被载入，但会被 git 忽略
```

:::info 环境文件加载优先级

为一个特定模式准备的环境文件 (例如 .env.production) 将会比一般的环境文件 (例如 .env) 拥有更高的优先级。

.env 环境文件是通过运行 `taro` 命令载入的，因此环境文件发生变化，你需要重启服务。
:::

## 只在本地有效的变量

有的时候你可能有一些不应该提交到代码仓库中的变量，尤其是当你的项目托管在公共仓库时。这种情况下你应该使用一个 `.env.local` 文件取而代之。本地环境文件默认会被忽略，且出现在 `.gitignore` 中。

`.local` 也可以加在指定模式的环境文件上，比如 `.env.development.local` 将会在 `development` 模式下被载入，且被 `git` 忽略。

## 自定义环境变量前缀

前面提到，默认只加载 `.env` 文件中以 `TARO_APP_` 前缀开头的环境变量，你可能想改成自己公司的英文名称作为前缀，`@tarojs/cli` 提供了 `--env-prefix` 参数来实现这一需求：

```sh
taro build --type weapp --mode development --env-prefix JD_APP_
```

此时 `.env` 文件中能被加载的环境变量只能是 `JD_APP_` 前缀开头的：

```
TARO_APP_API="https://api.tarojs.com"    # 不满足前缀，不加载

JD_APP_TEST="foo"                        # 满足前缀，加载
```

但是，有个特殊的环境变量不受自定义前缀配置的影响，始终会被加载，那就是 `TARO_APP_ID`。

## 特殊环境变量 `TARO_APP_ID`

:::info
Taro v3.6.9 开始支持
:::

`TARO_APP_ID` 是专门针对小程序的 `appid` 设计的，在构建输出 `dist/project.config.json` 文件前， 会将 `dist/project.config.json` 文件中的 `appid` 字段，修改为 `TARO_APP_ID` 的值。 在不同环境配置不同的小程序 `appid` 时，它特别有用，还能免去开发者在开发者工具上手动修改 `appid` 的麻烦。

![免去开发者工具修改appid](@site/static/img/update-appid.png)
</file>

<file path="docs/envs-debug.md">
---
title: 多端同步调试
---

从 1.3.5 版本开始，可以在 dist 目录下创建一个与编译的目标平台名同名的目录，并将结果放在这个目录下，例如编译到微信小程序，最终结果是在 dist/weapp 目录下，这样做的好处是，各个平台使用独立的目录互不影响，从而达到多端同步调试的目的，在 `config/index.js` 配置如下：

```js title="/config/index.js"
outputRoot: `dist/${process.env.TARO_ENV}`
```

多端同步调试需要在终端工具中打开多个 Tab 来同时执行 taro 命令进行同步调试，如下图，编译成微信小程序和支付宝小程序：

对于微信小程序，还需要将`project.config.json`文件的`miniprogramRoot` 的值改为 `dist/weapp/`，这样就可以正常在开发者工具中看到小程序了。

![打开多个 Tab 来同时执行 taro 命令进行同步调试](https://img30.360buyimg.com/ling/jfs/t1/62633/10/8451/595888/5d663badE57d35fd2/5a34822774836ede.png)

编译出来的目录如下图，`dist` 目录下有 `weapp` 和 `alipay` 两个目录：

![同步调试编译结果](https://img20.360buyimg.com/ling/jfs/t1/74046/26/8491/148076/5d663baaEf2ed8064/33fbb1d365053d1c.png)

## React Native 端调试

参考[React Native 端开发流程](./react-native.md)
</file>

<file path="docs/envs.md">
---
title: 跨平台开发
---

Taro 的设计初衷就是为了统一跨平台的开发方式，并且已经尽力通过运行时框架、组件、API 去抹平多端差异，但是由于不同的平台之间还是存在一些无法消除的差异，所以为了更好的实现跨平台开发，Taro 中提供了如下的解决方案。

## 内置环境变量

Taro 在编译时提供了一些内置的环境变量来帮助用户做一些特殊处理。

### process.env.TARO_ENV

用于判断当前的编译平台类型。

取值：`weapp` / `swan` / `alipay` / `tt` / `qq` / `jd` / `h5` / `rn`/ `ascf`

可以通过这个变量来区分不同环境，从而使用不同的逻辑。在编译阶段，**会移除不属于当前编译类型的代码，只保留当前编译类型下的代码**，例如：

#### 1. 在微信小程序和 H5 端分别引用不同资源：

```jsx
/** 源码 */
if (process.env.TARO_ENV === 'weapp') {
  require('path/to/weapp/name')
} else if (process.env.TARO_ENV === 'h5') {
  require('path/to/h5/name')
}

/** 编译后（微信小程序）*/
if (true) {
  require('path/to/weapp/name')
}
/** 编译后（H5）*/
if (true) {
  require('path/to/h5/name')
}
```

#### 2. 决定不同端要加载的组件

```jsx
/** 源码（React JSX） */
<View>
  {process.env.TARO_ENV === 'weapp' && <ScrollViewWeapp />}
  {process.env.TARO_ENV === 'h5' && <ScrollViewH5 />}
</View>

/** 编译后（微信小程序）*/
<View>
  {true && <ScrollViewWeapp />}
</View>
/** 编译后（H5）*/
<View>
  {true && <ScrollViewH5 />}
</View>
```

:::note
不要解构 `process.env` 来获取环境变量，请直接以完整书写的方式（`process.env.TARO_ENV`）来进行使用。

```js
// 正确写法
if (process.env.TARO_ENV === 'weapp') {
}

// 错误写法
const { TARO_ENV = 'weapp' } = process.env
if (TARO_ENV === 'weapp') {
}
```

:::

### 组件文件中跨平台支持

为了方便大家书写样式跨端的组件代码，目前在.vue文件template模板内容中支持条件编译的特性。

指定平台保留样式：

```vue
/*  #ifdef  %PLATFORM%  */
模板代码
/*  #endif  */
```

指定平台剔除样式：

```vue
/*  #ifndef  %PLATFORM%  */
模板代码
/*  #endif  */
```

其中 `PLATFORM` 的取值与 `process.env.TARO_ENV` 保持一致

例如，希望某段模板内容只在 **微信小程序中** 生效，可以如下写法

```vue
/*  #ifdef weapp  */
模板代码
/*  #endif  */
```

如果是多个平台，之间可以使用空格隔开。

## 统一接口的多端文件

内置环境变量虽然可以解决大部分跨端的问题，但是会让代码中充斥着逻辑判断的代码，影响代码的可维护性，而且也让代码变得愈发丑陋。为了解决这种问题，Taro 提供了另外一种跨端开发的方式作为补充。

开发者可以通过使用**统一接口的多端文件**，来解决跨端差异的功能。针对一项功能，如果多个端之间都有差异，那么开发者可以通过将文件修改成 `原文件名 + 端类型` 的命名形式（端类型对应着 `process.env.TARO_ENV` 的取值），不同端的文件代码对外保持统一接口，而引用的时候仍然是 `import` 原文件名的文件。Taro 在编译时，会跟根据当前的编译平台类型，将加载的文件变更为带有对应端类型文件名的文件，从而达到不同的端加载对应文件的目的。

### 使用要点

统一接口的多端文件这一跨平台兼容写法有如下三个使用要点：

- 不同端的对应文件一定要**统一接口和调用方式**。
- 引用文件的时候，**只需要写默认文件名，不用带文件后缀**。
- 最好有一个平台无关的默认文件，这样在使用 TS 的时候也不会出现报错。

通常有以下三种使用场景：

### 多端组件

假如有一个 `Test` 组件存在微信小程序、百度小程序和 H5 三个不同版本，那么就可以像如下组织代码：

```
├── test.js                Test 组件默认的形式，编译到微信小程序、百度小程序和 H5 之外的端使用的版本
├── test.weapp.js          Test 组件的微信小程序版本
├── test.swan.js           Test 组件的百度小程序版本
└── test.h5.js             Test 组件的 H5 版本
```

四个文件，对外暴露的是统一的接口，它们接受一致的参数，只是内部有针对各自平台的代码实现。

而使用 `Test` 组件的时候，引用的方式依然和之前保持一致。`import` 的是**不带端类型的文件名**，在编译的时候会自动识别并添加端类型后缀：

```jsx
import Test from '../../components/test'
;<Test argA={1} argA={2} />
```

### 多端脚本逻辑

与多端组件类似，假如有需要针对不同的端写不同的脚本逻辑代码，我们也可以类似的进行处理，遵守的唯一原则就是**多端文件对外的接口保持一致**。

例如微信小程序上使用 `Taro.setNavigationBarTitle` 来设置页面标题，H5 则是使用 `document.title`。那么我们可以封装一个 `setTitle` 方法来抹平两个平台的差异。

1. 编写 `set_title.weapp.js`：

```js title="set_title.weapp.js"
import Taro from '@tarojs/taro'
export default function setTitle(title) {
  Taro.setNavigationBarTitle({
    title,
  })
}
```

2. 编写 `set_title.h5.js`：

```js title="set_title.h5.js"
export default function setTitle(title) {
  document.title = title
}
```

3. 调用：

```js
import setTitle from '../utils/set_title'

setTitle('页面标题')
```

### 多端页面路由

可以根据不同平台，设置不同的路由规则。例如：

```js title="app.config.js"
let pages = []

if (process.env.TARO_ENV === 'weapp') {
  pages = ['/pages/index/index']
}

if (process.env.TARO_ENV === 'swan') {
  pages = ['/pages/indexswan/indexswan']
}

export default {
  pages,
}
```

### 解析 node_modules 内的多端文件

#### 小程序 & H5

Taro 3 里的多端文件由 [MultiPlatformPlugin](https://github.com/NervJS/taro/blob/next/packages/taro-runner-utils/src/resolve/MultiPlatformPlugin.ts) 插件进行解析。

它是一个 [enhanced-resolve](https://github.com/webpack/enhanced-resolve) 插件，Taro 内部会默认加载它。但为了提高解析效率，插件**默认不解析 node_modules 中的文件**。

假设我们需要解析 NPM 包 **taro-mobile** 里面的多端文件，可以利用 WebpackChain 为 `MultiPlatformPlugin` 插件添加 `include` 配置：

```js title="config/index.js"
// mini 也可改为 h5，分别对应小程序与 h5 端配置
mini: {
  webpackChain (chain) {
    // Taro 3.1 & 3.2
    chain.resolve.plugin('MultiPlatformPlugin')
      .tap(args => {
        return [...args, {
          include: ['@taro-mobile']
        }]
      })

    // Taro 3.3+
    chain.resolve.plugin('MultiPlatformPlugin')
      .tap(args => {
         args[2]["include"] = ['@taro-mobile']
         return args
      })
  }
}
```

#### React Native

RN 端没有使用 Webpack，因此单独增加了一个配置支持：

```js title="config/index.js"
rn: {
  resolve: {
    include: ['taro-mobile'],
  }
}
```

## 参考案例

[Taro Playground](https://github.com/wuba/taro-playground) 项目支持 RN、微信小程序、web 可供参考。

| Android                                                                                | iOS                                                                                    | Web                                                                                 | Mini Program                                                                        |
| -------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- |
| ![](https://pic3.58cdn.com.cn/nowater/fangfe/n_v295dd481b6b2f446592350e3187716d03.png) | ![](https://pic1.58cdn.com.cn/nowater/fangfe/n_v224532e5560314106b6ab32b0a1534a9d.png) | ![](https://pic5.58cdn.com.cn/nowater/frs/n_v2d585527f52e640679cdd37123a418fe3.png) | ![](https://pic3.58cdn.com.cn/nowater/frs/n_v23ec2613515c6458aaa44f01d459cea8b.jpg) |
| https://github.com/wuba/taro-playground/releases                                       | https://apps.apple.com/cn/app/taro-playground/id1576830673                             | https://wuba.github.io/taro-playground/                                             | https://github.com/wuba/taro-playground                                             |

同时该项目集成了[Github Workflows](https://github.com/wuba/taro-playground/tree/main/.github/workflows)，实现了安卓、iOS、微信小程序、web 的自动化发布。
</file>

<file path="docs/event.md">
---
title: 事件处理
---

Taro 元素的事件处理和 DOM 元素的很相似。但是有一点语法上的不同:

Taro 事件绑定属性的命名采用驼峰式写法，而不是小写。
如果采用 JSX 的语法你需要传入一个函数作为事件处理函数，而不是一个字符串 (DOM 元素的写法)。
例如，传统的微信小程序模板：

```html
<button onclick="activateLasers">Activate Lasers</button>
```

Taro 中稍稍有点不同：

```jsx
<button onClick={this.activateLasers}>Activate Lasers</button>
```

在 Taro 中另一个不同是你不能使用 `catchEvent` 的方式阻止事件冒泡。你必须明确的使用 `stopPropagation`。例如，阻止事件冒泡你可以这样写：

```jsx
class Toggle extends Component {
  constructor(props) {
    super(props)
    this.state = { isToggleOn: true }
  }

  onClick = (e) => {
    e.stopPropagation()
    this.setState((prevState) => ({
      isToggleOn: !prevState.isToggleOn,
    }))
  }

  render() {
    return <button onClick={this.onClick}>{this.state.isToggleOn ? 'ON' : 'OFF'}</button>
  }
}
```

## 向事件处理程序传递参数

通常我们会为事件处理程序传递额外的参数。例如，传入欲删除行的 `id`：

```jsx
<button onClick={this.deleteRow.bind(this, id)}>Delete Row</button>
```

当你通过 bind 方式向监听函数传参，在类组件中定义的监听函数，事件对象 `e` 要排在所传递参数的后面。

```jsx
class Popper extends Component {
  constructor() {
    super(...arguments)
    this.state = { name: 'Hello world!' }
  }

  // 你可以通过 bind 传入多个参数
  preventPop(name, test, e) {
    //事件对象 e 要放在最后
    e.stopPropagation()
  }

  render() {
    return <Button onClick={this.preventPop.bind(this, this.state.name, 'test')}></Button>
  }
}
```

### 使用匿名函数

> 自 v1.2.9 开始支持

> 注意：在各小程序端，使用匿名函数，尤其是在 **循环中** 使用匿名函数，比使用 `bind` 进行事件传参占用更大的内存，速度也会更慢。

除了 `bind` 之外，事件参数也可以使用匿名函数进行传参。直接写匿名函数不会打乱原有监听函数的参数顺序：

```jsx
class Popper extends Component {
  constructor() {
    super(...arguments)
    this.state = { name: 'Hello world!' }
  }

  render() {
    const name = 'test'
    return (
      <Button
        onClick={(e) => {
          e.stopPropagation()
          this.setState({
            name,
          })
        }}
      >
        {this.state.name}
      </Button>
    )
  }
}
```

> 注意：
> 使用通过 `usingComponents` 的第三方组件不支持匿名函数

### 柯里化

> 自 v1.3.0-beta.1 开始支持

> 在各小程序端，使用柯里化 Taro 会在编译后多生成一个匿名函数。

除了 `bind` 和匿名函数之外，事件参数也可以使用[柯里化](https://zh.wikipedia.org/wiki/%E6%9F%AF%E9%87%8C%E5%8C%96)传参。

```jsx
class Title extends Component{

  handleClick = (index) => (e) => {
    e.stopPropagation()
    this.setState({
      currentIndex: index
    })
  }

  render() {
    const { currentIndex } = this.props;
    return (
      {/* 调用 `this.handleClick(currentIndex)` 会返回一个函数，这个函数可以访问到 `currentIndex` 同时也能满足 `onClick` 的签名 */}
      <View onClick={this.handleClick(currentIndex)}>
      </View>
    )
  }
 }
```

> 注意：
> 使用通过 `usingComponents` 的第三方组件不支持匿名函数

### 函数式组件

在函数式组件中，事件传参可以传入事件的引用也可以传入匿名函数，以下是函数式组件配合 [`useCallback`](hooks.md#usecallback) 的一个例子：

```jsx
const App = () => {
  const [c1, setC1] = useState(0)
  const [c2, setC2] = useState(0)
  const [c3, setC3] = useState(0)

  const increment = (c) => c + 1

  // 只有 useCallback 对应的 c1 或 c2 的值改变时，才会返回新的函数
  const increment1 = useCallback(() => setC1(increment), [c1])
  const increment2 = useCallback(() => setC2(increment), [c2])

  return (
    <View>
      <Text> Counter 1 is {c1} </Text>
      <Text> Counter 2 is {c2} </Text>
      <Text> Counter 3 is {c3} </Text>
      <View>
        <Button onClick={increment1}>Increment Counter 1</Button>
        <Button onClick={increment2}>Increment Counter 2</Button>
        <Button onClick={() => setC3(increment)}>Increment Counter 3</Button>
      </View>
    </View>
  )
}
```

## 任何组件的事件传递都要以 `on` 开头

> 在 v1.3.0-beta.0 之后，自定义组件间的事件传递可以不用 `on` 开头，但内置组件的事件依然是以 `on` 开头的，为了一致性我们仍然推荐你以 `on` 开头命名你的事件。

在微信小程序中，可能你会看到像 `bindTap` 这样的用法，但在 Taro 中，事件参数(props)都以 `on` 开头:

```jsx
// 错误
const element = <View bindtap={this.onTag} />
const element2 = <Input bindfocus={this.onFocus} />
const element3 = <CustomElement animationEnd={this.props.onAnimationEnd} />
```

只要当 JSX 组件传入的参数是函数，参数名就必须以 `on` 开头：

```jsx
// 正确
const element = <View onClick={this.onTag} />
const element2 = <Input onFocus={this.onFocus} />
const element3 = <CustomElement onAnimationEnd={this.props.onAnimationEnd} />
```
</file>

<file path="docs/external-libraries.md">
---
title: 第三方工具
---

## 概述

如何利用好第三方工具提升使用 Taro 的开发体验是很多社区内开发者共有的问题，比方说如何利用 Jest 测试或者使用 StoryBook 编写组件库示例等等，都需要借助 Taro-H5 相关的能力。

## 基础配置

正常使用 Taro 时，cli 会帮助我们完成编译配置并对 ast 做出一定的修改，如果使用第三方工具，那么我们需要对 webpack 和 babel 相关的配置做出一定的修改。

### Webpack

Taro-H5 中使用到的 API 实际上并不在 `@tarojs/taro` 的入口文件之下，如果想要使用需要在 Webpack 中配置解析入口和别名如下:

```js title="webpack.config.js"
module.exports = {
  // ...
  resolve: {
    mainFields: ['main:h5', 'browser', 'module', 'jsnext:main', 'main'],
    alias: {
      '@tarojs/taro': '@tarojs/taro-h5',
    },
  },
  // ...
}
```

### Babel

Taro-H5 实际并没有在 Taro 对象上挂载所有的 API，这是为了避免不必要的 API 占用包体的大小，那么为了兼容小程序的 API 使用方法就需要对开发者的代码在编译前做出一些调整，在使用第三方工具时，也需要通过引入 `babel-plugin-transform-taroapi` 依赖完成这一操作。

## 示例

### StoryBook

以 `StoryBook: 6.4.13` 为例，在 Taro 中使用需要在 StoryBook 安装完成之后，更新以下配置：

```js title=".storybook/main.js"
const webpack = require('webpack')
const path = require('path')

module.exports = {
  // ...
  babel: (options) => ({
    ...options,
    plugins: [
      ...options.plugins,
      [
        require('babel-plugin-transform-taroapi').default,
        {
          apis: require(require.resolve('@tarojs/taro-h5/dist/taroApis', { basedir: path.resolve(__dirname, '..') })),
          packageName: '@tarojs/taro',
        },
      ],
    ],
  }),
  webpackFinal: (config) => ({
    ...config,
    resolve: {
      ...config.resolve,
      mainFields: ['main:h5', 'browser', 'module', 'jsnext:main', 'main'],
      alias: {
        ...config.resolve.alias,
        '@tarojs/taro': '@tarojs/taro-h5',
        // Note: 3.6 之前，请使用 '@tarojs/components$': '@tarojs/components/dist-h5/react',
        ['@tarojs/components$']: '@tarojs/components/lib/react',
      },
    },
    plugins: [
      ...config.plugins,
      new webpack.DefinePlugin({
        'process.env.TARO_ENV': JSON.stringify('h5'),
        ENABLE_INNER_HTML: JSON.stringify(false),
        ENABLE_ADJACENT_HTML: JSON.stringify(false),
        ENABLE_SIZE_APIS: JSON.stringify(false),
        ENABLE_TEMPLATE_CONTENT: JSON.stringify(false),
        ENABLE_CLONE_NODE: JSON.stringify(false),
        ENABLE_CONTAINS: JSON.stringify(false),
        ENABLE_MUTATION_OBSERVER: JSON.stringify(false),
      }),
    ],
  }),
  // ...
}
```

:::caution 请注意
该方法不适用 `pxTransform` 方法，如果需要使用请先调用自行调用 `initPxTransform` 初始化配置 (目前 Taro 使用 webpack4 构建项目，无法在 StoryBook 中直接引用 `@tarojs/webpack-runner` 提供的方法引入所有配置，等升级到 webpack5 之后会提供替代解决方案)。
目前解决办法是在.storybook/preview.js 中预先执行`initPxTransform`并载入相关样式。
:::

```js title=".storybook/preview.js"
import { DecoratorFn } from '@storybook/react'

import { defineCustomElements, applyPolyfills } from '@tarojs/components/loader'
import Taro from '@tarojs/taro'

import '@tarojs/components/dist/taro-components/taro-components.css'

export const decorators = [
  (Story) => {
    applyPolyfills().then(function () {
      defineCustomElements(window)
    })

    Taro.initPxTransform({
      designWidth: 750,
      deviceRatio: {
        640: 2.34 / 2,
        750: 1,
        828: 1.81 / 2,
      },
    })
    return <Story />
  },
]

//...
```

:::解决 storybook 中渲染结果与设计稿大小不一致的问题（以 designWidth: 750px 为例)
:::

```html title=".storybook/preview-body.html"
<style>
  html {
    font-size: 23.4375px;
  }
</style>
```

### Jest

使用 Jest 测试也是类似，需要添加配置如下

```js title="jest"
module.exports = {
  // ...
  globals: {
    // ...
    window: true,
    DEPRECATED_ADAPTER_COMPONENT: false,
    ENABLE_INNER_HTML: true,
    ENABLE_ADJACENT_HTML: true,
    ENABLE_SIZE_APIS: true,
    ENABLE_TEMPLATE_CONTENT: true,
    ENABLE_CLONE_NODE: true,
    ENABLE_CONTAINS: true,
    ENABLE_MUTATION_OBSERVER: true,
  },
  moduleNameMapper: {
    // ...
    '@tarojs/taro': '@tarojs/taro-h5',
    // '@tarojs/components': '@tarojs/components/lib/react',
    // '@tarojs/plugin-framework-react/dist/runtime': '<rootDir>/__mocks__/taro-framework',
    // '@tarojs/plugin-framework-vue2/dist/runtime': '<rootDir>/__mocks__/taro-framework',
    // '@tarojs/plugin-framework-vue3/dist/runtime': '<rootDir>/__mocks__/taro-framework',
  },
}
```

:::caution 请注意
该方法不适用路由跳转和部分生命周期测试。
:::

#### TabBar

如果项目需要测试 TabBar 相关的逻辑，需要将应用完成初始化，参看方法如下：

```js title="__tests__/tab-bar.test.js"
import * as Taro from '@tarojs/taro-h5'
import { buildApp } from './utils'

describe('tabbar', () => {
  beforeEach(() => {
    jest.resetAllMocks()
    buildApp()
  })

  it('should be able to set/removeTabBarBadge', (done) => {
    Taro.eventCenter.once('__taroSetTabBarBadge', (res) =>
      res.successHandler({
        errMsg: 'setTabBarBadge:ok',
      })
    )
    Taro.eventCenter.once('__taroRemoveTabBarBadge', (res) =>
      res.successHandler({
        errMsg: 'removeTabBarBadge:ok',
      })
    )
    Taro.setTabBarBadge({
      index: 0,
      text: 'text',
    }).then((res) => {
      expect(res.errMsg).toBe('setTabBarBadge:ok')

      Taro.removeTabBarBadge({
        index: 0,
      }).then((res) => {
        expect(res.errMsg).toBe('removeTabBarBadge:ok')
        done()
      })
    })
  })
})
```

```js title="__tests__/utils.js"
import { createReactApp } from '@tarojs/plugin-framework-react/dist/runtime'
import { createRouter } from '@tarojs/router'
import React, { Component } from 'react'
import ReactDOM from 'react-test-renderer'

const appConfig: any = {
  pages: ['pages/index/index', 'pages/about/index'],
  window: {
    backgroundTextStyle: 'light',
    navigationBarBackgroundColor: '#fff',
    navigationBarTitleText: 'WeChat',
    navigationBarTextStyle: 'black',
  },
  tabBar: {
    color: '#333',
    selectedColor: '#409EFF',
    backgroundColor: '#fff',
    borderStyle: 'black',
    list: [
      {
        pagePath: '/pages/index/index',
        text: '首页',
      },
      {
        pagePath: '/pages/about/about',
        text: '关于',
      },
    ],
    mode: 'hash',
    basename: '/test/app',
    customRoutes: {
      '/pages/about/index': '/about',
    },
  },
  router: { mode: 'hash' },
}

export function buildApp() {
  const config: any = { ...appConfig }
  class App extends Component {
    render() {
      return this.props.children
    }
  }
  config.routes = [config.pages?.map((path) => ({ path, load: () => null }))]
  const inst = createReactApp(App, React, ReactDOM, config)
  createRouter(inst, config, 'React')
}
```

```js title="__mocks__/taro-framework.js"
const App = {}
export function createReactApp() {
  return { ...App }
}
export function createVueApp() {
  return { ...App }
}
export function createVue3App() {
  return { ...App }
}
```

#### Hooks

一些诸如 `useDidShow`、`useDidHide` 等等依赖于生命周期的 Hooks 并不会通过 Taro-H5 提供，使用它们需要提供 Mock 方法并挂在到 taro 对象上（可以参考 `@tarojs/plugin-framework-react/dist/api-loader` 中的方法注入），测试时如果需要触发钩子，则可以通过 `Taro.eventCenter` 来模拟。

### svg-sprite-loader

部分项目希望在 H5 使用 SVG sprites，为此需要使用 [`svg-sprite-loader`](https://github.com/JetBrains/svg-sprite-loader) 覆盖 taro 提供的 loader

> 具体用法在这里并不会详细展开，可以参考官方的文档，在这里只说明和 Taro 相关的问题

```js title="config/index.js"
// ...
webpackChain(chain) {
  chain.merge({
    module: {
      rule: {
        // 覆盖 Taro 默认的图片加载配置
        'image': {
          test: /\.(png|jpe?g|gif|bpm|webp)(\?.*)?$/,
          use: [
            {
              loader: 'url-loader',
              options: {
                name: path.resolve(__dirname, 'images/[name].[ext]'),
              },
            },
          ],
        },
        // 使用 svg-sprite-loader 的配置
        'svg-loader': {
          test: /.svg$/,
          use: [
            {
              loader: 'svg-sprite-loader',
              options: {},
            },
            {
              loader: 'svgo-loader',
              options: {},
            },
          ],
        },
      },
    },
  });
},
imageUrlLoaderOption: {
  limit: 5000,
  exclude: [path.resolve(__dirname, '../src/images/icons')],
  name: 'static/images/[name].[hash:8].[ext]',
}
// ...
```

:::caution 请注意
另外使用 svg-sprite-loader 依旧需要引入图片，避免被 tree shaking 抖动掉可以改用动态导入，参考 Issue [9569](https://github.com/NervJS/taro/issues/9569)。
:::

### NextJS

社区 [@SyMind](https://github.com/SyMind) 大佬提供了编译 NextJS 应用的插件 [tarojs-plugin-platform-nextjs](https://github.com/SyMind/tarojs-plugin-platform-nextjs)，用于支持 Web 端支持 SSR 能力，可以根据项目需要自行选择。
</file>

<file path="docs/folder.md">
---
title: 目录结构
---

## 项目目录结构

    ├── dist                        编译结果目录
    |
    ├── config                      项目编译配置目录
    |   ├── index.js                默认配置
    |   ├── dev.js                  开发环境配置
    |   └── prod.js                 生产环境配置
    |
    ├── src                         源码目录
    |   ├── pages                   页面文件目录
    |   |   └── index               index 页面目录
    |   |       ├── index.js        index 页面逻辑
    |   |       ├── index.css       index 页面样式
    |   |       └── index.config.js index 页面配置
    |   |
    |   ├── app.js                  项目入口文件
    |   ├── app.css                 项目总通用样式
    |   └── app.config.js           项目入口配置
    |
    ├── project.config.json         微信小程序项目配置 project.config.json
    ├── project.tt.json             抖音小程序项目配置 project.tt.json
    ├── project.swan.json           百度小程序项目配置 project.swan.json
    ├── project.qq.json             QQ 小程序项目配置 project.qq.json
    ├── ascf.config.json            ASCF元服务项目配置 ascf.config.json
    |
    ├── babel.config.js             Babel 配置
    ├── tsconfig.json               TypeScript 配置
    ├── .eslintrc                   ESLint 配置
    |
    └── package.json

## 编译配置

    └── config                      项目编译配置目录
        ├── index.js                默认配置
        ├── dev.js                  开发环境配置
        └── prod.js                 生产环境配置

用于配置 Taro 项目的编译行为、修改 Webpack 配置等，详情请参考[编译配置](./config)和[编译配置详情](./config-detail)。

## 源码组织

和小程序规范一样，Taro 包含一个描述整体程序的 `app` 和多个描述各自页面的 `page`。

### app

    └── src                         源码目录
        ├── app.js                  项目入口文件
        ├── app.css                 项目总通用样式
        └── app.config.js           项目入口配置

小程序的主体由下面三个文件组成：

| 文件          | 必须 | 作用           |
| :------------ | :--- | :------------- |
| app.js        | 是   | 小程序入口逻辑 |
| app.css       | 否   | 小程序全局样式 |
| app.config.js | 是   | 小程序全局配置 |

代码示例请根据你选择的框架进行查看：[React](./react-overall), [Preact](./preact), [Vue](./vue-overall), [Vue3](./vue3)。

#### 1. 小程序全局配置

`app.config.js` 对应小程序规范的全局配置文件 `app.json`，优势在于它是 JS 文件可以编写逻辑。配置以**微信小程序的全局配置**为规范。详情请参考[全局配置](./app-config)。

#### 2. 小程序全局样式

小程序全局样式文件可以通过 ES6 规范的 `import` 进行引入。

```js title="app.js"
import './app.css'
```

### page

    └── src                         源码目录
        └── pages                   页面文件目录
            └── index               index 页面目录
                ├── index.js        index 页面逻辑
                ├── index.css       index 页面样式
                └── index.config.js index 页面配置

一个小程序页面由三个文件组成，如下：

| 文件           | 必须 | 作用         |
| :------------- | :--- | :----------- |
| page.js        | 是   | 页面入口逻辑 |
| page.css       | 否   | 页面样式     |
| page.config.js | 否   | 页面配置     |

#### 1. 页面配置

`page.config.js` 对应小程序规范的页面配置文件 `page.json`，优势在于它是 JS 文件可以编写逻辑。配置以**微信小程序的页面配置**为规范。详情请参考[页面配置](./page-config)。

#### 2. 页面样式

页面的样式文件可以通过 ES6 规范的 `import` 进行引入。

```js title="pages/index/index.js"
import './index.css'
```

#### 3. 页面路由

页面路由与小程序规范一致，需要在小程序全局配置 `app.config.js` 中进行配置。

## 项目配置

    └──project.config.json         微信小程序项目配置 project.config.json

各类小程序平台均有自己的项目配置文件，Taro 支持对它们进行适配，详情请参考[项目配置](./project-config)。

## Babel 配置

    └── babel.config.js             Babel 配置

请参考 [Babel 配置](./babel-config)

## ESLint 配置

    └── .eslintrc                   ESLint 配置

ESLint 配置请参考 [Github](https://github.com/NervJS/taro/tree/next/packages/eslint-config-taro)
</file>

<file path="docs/functional-component.md">
---
title: 函数式组件
---

## 普通函数式组件

> 自 `v1.3.0-beta.0` 起支持

定义一个函数式组件非常简单：

```jsx
function Welcome(props) {
  return <View>Hello, {props.name}</View>
}
```

这个函数接受一个参数 `props`，并且返回的是一个 JSX 元素。这样的函数就是函数式组件。相对于的 ES6 Class 组件是：

```jsx
class Welcome extends React.Component {
  render() {
    return <View>Hello, {this.props.name}</View>
  }
}
```

在 Taro 中使用函数式组件有以下限制：

1. 函数的命名需要遵循[帕斯卡式命名法](https://baike.baidu.com/item/%E5%B8%95%E6%96%AF%E5%8D%A1%E5%91%BD%E5%90%8D%E6%B3%95/9464494?fr=aladdin)；
2. 一个文件中只能定义一个普通函数式组件或一个 Class 组件

## 类函数式组件

> 自 `v1.3.0-beta.0` 起支持

由于一个文件不能定义两个组件，但有时候我们需要组件内部的抽象组件，这时类函数式组件就是你想要答案。假设我们有一个 Class 组件，它包括了一个 `Header` 一个 `Footer`，我们可以这样定义：

```jsx
class SomePage extends Taro.Component {
  renderHeader () {
    const { header } = this.state
    return <View>{header}</View>
  }

  renderFooter (footer) {
    return <View>{footer}</View>
  }

  render () {
    return (
      <View>
        {this.renderHeader()}
        {...}
        {this.renderFooter('footer')}
      </View>
    )
  }
}
```

在 `renderHeader` 或 `renderFooter` 函数中，我们可以访问类的 `this`，也可以传入不限量的参数，这类型的函数也可以调用无限次数。但这样的写法也存在一些限制：

1. 函数的命名必须以 `render` 开头，`render` 后的第一个字母需要大写
2. 函数的参数不得传入 JSX 元素或 JSX 元素引用
3. 函数不能递归地调用自身

> 形如 `renderHeader` 这样的函数在小程序中会编译成 `template`，而小程序的 `template` 是无法做到递归调用自身的。当你有这样的需求时，可以新建两个一模一样的组件和文件：ComponentA 和 ComponentB，在 ComponentA 中调用 ComponentB，在 ComponentB 中调用 ComponnetA。

## 闭包函数式组件

> 自 `v1.3.0-beta.2` 起支持

在一个普通的函数式组件中，我们需要一个另外的抽象组件多次调用，同时我们还希望这个抽象组件能访问到我们当前作用域的值，这时候我们就需要闭包函数式组件：

```jsx
function Header({ user }) {
  const name = user.name
  const renderTitle = () => {
    // renderTitle 每次都能获取到当前作用域 `name` 的值
    return <View>Welcome, {name}</View>
  }
  return (
    <View>
      {/* 重要人士我们要欢迎他三次 */}
      {renderTitle()}
      {renderTitle()}
      {renderTitle()}
    </View>
  )
}
```

闭包函数式组件遵循所有类函数式的限制，包括命名，传参，调用，并且它只能在一个普通函数式组件或类函数式组件以及 `Taro.Component` 的 `render` 函数中定义及调用。

> 一般情况下只建议在普通函数式组件中使用闭包函数式组件，而在 `Taro.Component` 中可以显式地定义一个类函数式组件和它的参数和签名，这样函数的作用域更为清晰也更易维护。
</file>

<file path="docs/GETTING-STARTED.md">
---
title: 安装及使用
---

import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

## 安装

Taro 项目基于 node，请确保已具备较新的 node 环境（>=16.20.0），推荐使用 node 版本管理工具 [nvm](https://github.com/creationix/nvm) 来管理 node，这样不仅可以很方便地切换 node 版本，而且全局安装时候也不用加 sudo 了。

### CLI 工具安装

首先，你需要使用 npm 或者 yarn 全局安装 `@tarojs/cli`，或者直接使用 [npx](https://medium.com/@maybekatz/introducing-npx-an-npm-package-runner-55f7d4bd282b):

<Tabs
defaultValue="npm"
values={[
{label: 'npm', value: 'npm'},
{label: 'yarn', value: 'yarn'},
{label: 'pnpm', value: 'pnpm'}
]}>
<TabItem value="npm">

```bash
# 使用 npm 安装 CLI
$ npm install -g @tarojs/cli
```

</TabItem>

<TabItem value="yarn">

```bash
# 使用 yarn 安装 CLI
$ yarn global add @tarojs/cli
```

</TabItem>

<TabItem value="pnpm">

```bash
# 使用 pnpm 安装 CLI
$ pnpm install -g @tarojs/cli
```

</TabItem>
</Tabs>

:::caution 请注意
由于 Taro 部分能力使用 Rust 开发，在 Windows 上，请确保安装了 Microsoft Visual C++ Redistributable。请查看：https://docs.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist

:::

#### 查看 Taro 全部版本信息

可以使用 `npm info` 查看 Taro 版本信息，在这里你可以看到当前最新版本

```bash
npm info @tarojs/cli
```

![npm info @tarojs/cli screenshot](https://img13.360buyimg.com/ling/jfs/t1/144770/7/20011/138415/5fe40491Ed0883578/11236962a3e672db.png)

由图第 1 行可知最新版本，如果你用的是 beta 或者 canary 你可以通过 `dist-tags:` 下面那行看到最新的版本。

## 项目初始化

使用命令创建模板项目：

```bash
$ taro init myApp
```

npm 5.2+ 也可在不全局安装的情况下使用 npx 创建模板项目：

```bash
$ npx @tarojs/cli init myApp
```

![taro init myApp command screenshot](https://img30.360buyimg.com/ling/jfs/t1/121270/15/15083/672721/5f89357dEf36b7fe2/ecb98df1436cd3d5.jpg)

在创建完项目之后，Taro 会默认开始安装项目所需要的依赖，安装使用的工具按照 yarn > cnpm > npm 顺序进行检测。一般来说，依赖安装会比较顺利，但某些情况下可能会安装失败，这时候你可以在项目目录下自己使用安装命令进行安装：

<Tabs
defaultValue="npm"
values={[
{label: 'npm', value: 'npm'},
{label: 'yarn', value: 'yarn'},
{label: 'pnpm', value: 'pnpm'}
]}>
<TabItem value="npm">

```bash
# 进入项目根目录
$ cd myApp

# 使用 npm 安装依赖
$ npm install
```

</TabItem>

<TabItem value="yarn">

```bash
# 进入项目根目录
$ cd myApp

# 使用 yarn 安装依赖
$ yarn
```

</TabItem>

<TabItem value="pnpm">

```bash
# 进入项目根目录
$ cd myApp

# 使用 pnpm 安装依赖
$ pnpm install
```

</TabItem>
</Tabs>

## 编译运行

使用 Taro 的 `build` 命令可以把 Taro 代码编译成不同端的代码，然后在对应的开发工具中查看效果。

Taro 编译分为 `dev` 和 `build` 模式：

- **dev 模式（增加 --watch 参数）** 将会监听文件修改。
- **build 模式（去掉 --watch 参数）** 将不会监听文件修改，并会对代码进行压缩打包。
- dev 模式生成的文件较大，设置环境变量 `NODE_ENV` 为 `production` 可以开启压缩，方便预览，但编译速度会下降。

### 微信小程序

#### 编译命令

```bash
# pnpm
$ pnpm dev:weapp
$ pnpm build:weapp

# yarn
$ yarn dev:weapp
$ yarn build:weapp

# npm script
$ npm run dev:weapp
$ npm run build:weapp

# 仅限全局安装
$ taro build --type weapp --watch
$ taro build --type weapp

# npx 用户也可以使用
$ npx taro build --type weapp --watch
$ npx taro build --type weapp

# watch 同时开启压缩
$ set NODE_ENV=production && taro build --type weapp --watch # CMD
$ NODE_ENV=production taro build --type weapp --watch # Bash
```

#### 小程序开发者工具

下载并打开[微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)，然后选择**项目根目录**进行预览。

需要注意开发者工具的项目设置：

- 需要设置关闭 ES6 转 ES5 功能，开启可能报错
- 需要设置关闭上传代码时样式自动补全，开启可能报错
- 需要设置关闭代码压缩上传，开启可能报错

### 百度小程序

#### 编译命令

```bash
# pnpm
$ pnpm dev:swan
$ pnpm build:swan

# yarn
$ yarn dev:swan
$ yarn build:swan

# npm script
$ npm run dev:swan
$ npm run build:swan

# 仅限全局安装
$ taro build --type swan --watch
$ taro build --type swan

# npx 用户也可以使用
$ npx taro build --type swan --watch
$ npx taro build --type swan

# watch 同时开启压缩
$ set NODE_ENV=production && taro build --type swan --watch # CMD
$ NODE_ENV=production taro build --type swan --watch # Bash
```

#### 小程序开发者工具

下载并打开[百度开发者工具](https://smartprogram.baidu.com/docs/develop/devtools/history)，并确保已经设置了小程序项目配置文件 [project.swan.json](./project-config)。然后选择项目根目录下 `dist` 目录（根目录 `config` 中的 `outputRoot` 设置的目录）进行预览。

需要注意开发者工具的项目设置：

- 需要关闭 ES6 转 ES5 功能，开启可能报错
- 需要关闭上传代码时样式自动补全，开启可能报错
- 需要关闭代码压缩上传，开启可能报错

### 支付宝小程序

#### 编译命令

```bash
# pnpm
$ pnpm dev:alipay
$ pnpm build:alipay

# yarn
$ yarn dev:alipay
$ yarn build:alipay

# npm script
$ npm run dev:alipay
$ npm run build:alipay

# 仅限全局安装
$ taro build --type alipay --watch
$ taro build --type alipay

# npx 用户也可以使用
$ npx taro build --type alipay --watch
$ npx taro build --type alipay

# watch 同时开启压缩
$ set NODE_ENV=production && taro build --type alipay --watch # CMD
$ NODE_ENV=production taro build --type alipay --watch # Bash
```

#### 小程序开发者工具

下载并打开[支付宝小程序开发者工具](https://opendocs.alipay.com/mini/ide/download)，然后选择项目根目录下 `dist` 目录（根目录 `config` 中的 `outputRoot` 设置的目录）进行预览。

需要注意开发者工具的项目设置：

- 需要关闭 ES6 转 ES5 功能，开启可能报错
- 需要关闭上传代码时样式自动补全，开启可能报错
- 需要关闭代码压缩上传，开启可能报错

### 抖音小程序

#### 编译命令

```bash
# pnpm
$ pnpm dev:tt
$ pnpm build:tt

# yarn
$ yarn dev:tt
$ yarn build:tt

# npm script
$ npm run dev:tt
$ npm run build:tt

# 仅限全局安装
$ taro build --type tt --watch
$ taro build --type tt

# npx 用户也可以使用
$ npx taro build --type tt --watch
$ npx taro build --type tt

# watch 同时开启压缩
$ set NODE_ENV=production && taro build --type tt --watch # CMD
$ NODE_ENV=production taro build --type tt --watch # Bash
```

#### 小程序开发者工具

下载并打开[抖音小程序开发者工具](https://developer.open-douyin.com/docs/resource/zh-CN/mini-app/develop/developer-instrument/download/developer-instrument-update-and-download)，并确保已经设置了小程序项目配置文件 [project.tt.json](./project-config)。然后选择项目根目录下 `dist` 目录（根目录 `config` 中的 `outputRoot` 设置的目录）进行预览。

需要注意开发者工具的项目设置：

- 需要关闭 ES6 转 ES5 功能，开启可能报错
- 需要关闭上传代码时样式自动补全，开启可能报错
- 需要关闭代码压缩上传，开启可能报错

### QQ 小程序

#### 编译命令

```bash
# pnpm
$ pnpm dev:qq
$ pnpm build:qq

# yarn
$ yarn dev:qq
$ yarn build:qq

# npm script
$ npm run dev:qq
$ npm run build:qq

# 仅限全局安装
$ taro build --type qq --watch
$ taro build --type qq

# npx 用户也可以使用
$ npx taro build --type qq --watch
$ npx taro build --type qq

# watch 同时开启压缩
$ set NODE_ENV=production && taro build --type qq --watch # CMD
$ NODE_ENV=production taro build --type qq --watch # Bash
```

#### 小程序开发者工具

下载并打开 [QQ 小程序开发者工具](https://q.qq.com/wiki/tools/devtool/)，然后选择项目根目录下 `dist` 目录（根目录 `config` 中的 `outputRoot` 设置的目录）进行预览。

需要注意开发者工具的项目设置：

- 需要关闭 ES6 转 ES5 功能，开启可能报错
- 需要关闭上传代码时样式自动补全，开启可能报错
- 需要关闭代码压缩上传，开启可能报错

### 京东小程序

#### 编译命令

```bash
# pnpm
$ pnpm dev:jd
$ pnpm build:jd

# yarn
$ yarn dev:jd
$ yarn build:jd

# npm script
$ npm run dev:jd
$ npm run build:jd

# 仅限全局安装
$ taro build --type jd --watch
$ taro build --type jd

# npx 用户也可以使用
$ npx taro build --type jd --watch
$ npx taro build --type jd

# watch 同时开启压缩
$ set NODE_ENV=production && taro build --type jd --watch # CMD
$ NODE_ENV=production taro build --type jd --watch # Bash
```

#### 小程序开发者工具

下载并打开[京东小程序开发者工具](https://mp-docs.jd.com/doc/dev/devtools/1591)，然后选择项目根目录下 `dist` 目录（根目录 `config` 中的 `outputRoot` 设置的目录）进行预览。

需要注意开发者工具的项目设置：

- 需要关闭 ES6 转 ES5 功能，开启可能报错
- 需要关闭上传代码时样式自动补全，开启可能报错
- 需要关闭代码压缩上传，开启可能报错

#### 京东小程序相关阅读

- [《使用 Taro 快速开发京东小程序》](/blog/2020-04-27-taro-build-jd)
- [《京东小程序 Taro 开发对比原生开发测评》](/blog/2020-04-27-taro-vs-jd)

### 企业微信小程序

:::note
Taro v3.1+ 开始支持
:::

使用 Taro 插件能支持编译企业微信小程序，插件文档请看 [Github](https://github.com/NervJS/taro-plugin-platform-weapp-qy)。

#### 安装插件

```bash
yarn add @tarojs/plugin-platform-weapp-qy
```

#### 配置插件

```js title="Taro 项目配置"
config = {
  // ...
  plugins: ['@tarojs/plugin-platform-weapp-qy'],
}
```

#### 编译命令

```bash
# pnpm
$ pnpm dev:qywx
$ pnpm build:qywx

# yarn
$ yarn dev:qywx
$ yarn build:qywx

# npm script
$ npm run dev:qywx
$ npm run build:qywx

# 仅限全局安装
$ taro build --type qywx --watch
$ taro build --type qywx

# npx 用户也可以使用
$ npx taro build --type qywx --watch
$ npx taro build --type qywx

# watch 同时开启压缩
$ set NODE_ENV=production && taro build --type qywx --watch # CMD
$ NODE_ENV=production taro build --type qywx --watch # Bash
```

#### 小程序开发者工具

同微信小程序。开发者工具的编译模式设置为企业微信。

### 钉钉小程序

:::note
Taro v3.1+ 开始支持

**Taro v3.3.8+**：
请使用 `@tarojs/plugin-platform-alipay-dd` 插件的 `~0.1.0` 版本

**Taro v3.1 & v3.2**：
请使用 `@tarojs/plugin-platform-alipay-dd` 插件的 `~0.0.5` 版本
:::

使用 Taro 插件能支持编译钉钉小程序，插件文档请看 [Github](https://github.com/NervJS/taro-plugin-platform-alipay-dd)。

#### 安装插件

```bash
yarn add @tarojs/plugin-platform-alipay-dd
```

#### 配置插件

```js title="Taro 项目配置"
config = {
  // ...
  plugins: ['@tarojs/plugin-platform-alipay-dd'],
}
```

#### 编译命令

```bash
# pnpm
$ pnpm dev:dd
$ pnpm build:dd

# yarn
$ yarn dev:dd
$ yarn build:dd

# npm script
$ npm run dev:dd
$ npm run build:dd

# 仅限全局安装
$ taro build --type dd --watch
$ taro build --type dd

# npx 用户也可以使用
$ npx taro build --type dd --watch
$ npx taro build --type dd

# watch 同时开启压缩
$ set NODE_ENV=production && taro build --type dd --watch # CMD
$ NODE_ENV=production taro build --type dd --watch # Bash
```

#### 小程序开发者工具

同支付宝小程序。开发者工具的编译模式设置为钉钉。

### 支付宝 IOT 小程序

:::note
Taro v3.1+ 开始支持
:::

使用 Taro 插件能支持编译支付宝 IOT 小程序，插件文档请看 [Github](https://github.com/NervJS/taro-plugin-platform-alipay-iot)。

#### 安装插件

```bash
yarn add @tarojs/plugin-platform-alipay-iot
```

#### 配置插件

```js title="Taro 项目配置"
config = {
  // ...
  plugins: ['@tarojs/plugin-platform-alipay-iot'],
}
```

#### 编译命令

```bash
# pnpm
$ pnpm dev:iot
$ pnpm build:iot

# yarn
$ yarn dev:iot
$ yarn build:iot

# npm script
$ npm run dev:iot
$ npm run build:iot

# 仅限全局安装
$ taro build --type iot --watch
$ taro build --type iot

# npx 用户也可以使用
$ npx taro build --type iot --watch
$ npx taro build --type iot

# watch 同时开启压缩
$ set NODE_ENV=production && taro build --type iot --watch # CMD
$ NODE_ENV=production taro build --type iot --watch # Bash
```

#### 小程序开发者工具

同支付宝小程序。开发者工具的编译模式设置为 IOT 小程序。

### 飞书小程序

:::note
Taro v3.1+ 开始支持
:::

使用 Taro 插件能支持编译[飞书小程序](https://open.feishu.cn/document/uYjL24iN/uMjNzUjLzYzM14yM2MTN?from=taro)，插件文档请看 [Github](https://github.com/NervJS/taro-plugin-platform-lark)。

#### 安装插件

```bash
yarn add @tarojs/plugin-platform-lark
```

#### 配置插件

```js title="Taro 项目配置"
config = {
  // ...
  plugins: ['@tarojs/plugin-platform-lark'],
}
```

#### 编译命令

```bash
# pnpm
$ pnpm dev:lark
$ pnpm build:lark

# yarn
$ yarn dev:lark
$ yarn build:lark

# npm script
$ npm run dev:lark
$ npm run build:lark

# 仅限全局安装
$ taro build --type lark --watch
$ taro build --type lark

# npx 用户也可以使用
$ npx taro build --type lark --watch
$ npx taro build --type lark

# watch 同时开启压缩
$ set NODE_ENV=production && taro build --type lark --watch # CMD
$ NODE_ENV=production taro build --type lark --watch # Bash
```

#### 小程序开发者工具

[飞书小程序](https://open.feishu.cn/document/uYjL24iN/uMjNzUjLzYzM14yM2MTN?from=taro)能运行在飞书客户端上，且一套代码多端运行(包括 PC 端和移动端)。你需要下载并打开[飞书小程序开发者工具](https://open.feishu.cn/document/tools-and-resources/development-tools/overview-of-ide)，并确保已经设置了小程序项目配置文件。然后选择项目根目录下 `dist` 目录进行预览。

需要注意开发者工具的项目配置

- 需要关闭 ES6 转 ES5 功能，开启可能报错
- 需要关闭上传代码时样式自动补全，开启可能报错
- 需要关闭代码压缩上传，开启可能报错

### 快手小程序

使用 Taro 插件能支持编译快手小程序，插件文档请看 [Github](https://github.com/NervJS/taro-plugin-platform-kwai)。

:::note
Taro v3.1+ 开始支持

**Taro v3.3+**：
请使用 [taro-plugin-platform-kwai](https://github.com/NervJS/taro-plugin-platform-kwai) 插件的 `1.0` 或以上版本

**Taro v3.2**：
请使用 [taro-plugin-platform-ks](https://github.com/vadxq/taro-plugin-platform-ks) 插件的 `1.2.x` 版本

**Taro v3.1**：
请使用 [taro-plugin-platform-ks](https://github.com/vadxq/taro-plugin-platform-ks) 插件的 `1.0.x` 版本
:::

#### 安装插件

```bash
yarn add @tarojs/plugin-platform-kwai
```

#### 配置插件

```js title="Taro 项目配置"
config = {
  // ...
  plugins: ['@tarojs/plugin-platform-kwai'],
}
```

#### 编译命令

```bash
# pnpm
$ pnpm dev:kwai
$ pnpm build:kwai

# yarn
$ yarn dev:kwai
$ yarn build:kwai

# npm script
$ npm run dev:kwai
$ npm run build:kwai

# 仅限全局安装
$ taro build --type kwai --watch
$ taro build --type kwai

# npx 用户也可以使用
$ npx taro build --type kwai --watch
$ npx taro build --type kwai

# watch 同时开启压缩
$ set NODE_ENV=production && taro build --type kwai --watch # CMD
$ NODE_ENV=production taro build --type kwai --watch # Bash
```

#### 小程序开发者工具

下载并打开[快手小程序开发者工具](https://mp.kuaishou.com/docs/develop/developerTools/downloadPath.html)，然后选择项目根目录下 `dist` 目录（根目录 `config` 中的 `outputRoot` 设置的目录）进行预览。

### H5

#### 编译命令

```bash
# pnpm
$ pnpm dev:h5
$ pnpm build:h5

# yarn
$ yarn dev:h5
$ yarn build:h5

# npm script
$ npm run dev:h5
$ npm run build:h5

# 仅限全局安装
$ taro build --type h5 --watch
$ taro build --type h5

# npx 用户也可以使用
$ npx taro build --type h5 --watch
$ npx taro build --type h5
```

### React Native

> Taro v3.2+ 开始支持

请参考 [React Native 端开发流程](./react-native)

### Harmony-hybrid

> Taro v3.6.24+ 开始支持

#### 编译命令

```bash
# yarn
$ yarn dev:harmony-hybrid
$ yarn build:harmony-hybrid

# npm script
$ npm run dev:harmony-hybrid
$ npm run build:harmony-hybrid

# 仅限全局安装
$ taro build --type harmony-hybrid --watch
$ taro build --type harmony-hybrid

# npx 用户也可以使用
$ npx taro build --type harmony-hybrid --watch
$ npx taro build --type harmony-hybrid
```

#### DevEco Studio 鸿蒙应用开发工具

下载并使用 DeEco Studio NEXT Developer Preview1（通过 [HarmonyOS NEXT 开发者预览版 Beta 招募](https://developer.huawei.com/consumer/cn/activityDetail/harmonyos-next-preview/) 申请获得）新建应用工程，并进行如下配置：

- 在 `oh-package.json5` 文件中配置 `dependencies`, 引入 `@hybrid/web-container` 模块。
- 在 `src/main/module.json5` 文件中增加权限配置，如：

```js
{
  requestPermissions: [
    {
      name: 'ohos.permission.INTERNET',
    },
  ]
}
```

- 把 Taro 项目目录下的 `dist` 目录的编译产物复制到鸿蒙应用的 `src/main/resources/rawfile` 目录下，编译运行鸿蒙应用进行开发调试。

### ASCF 元服务

若需将 Taro 代码编译为 ASCF 元服务，需在编译命令中指定平台参数为 `ascf`，并确保满足以下条件：

- 代码中需包含 ASCF 元服务编译条件：`"ascf"`（需在项目配置中声明）。

#### 编译命令

```bash
taro build --type ascf

# pnpm
$ pnpm dev:ascf
$ pnpm build:ascf

# yarn
$ yarn dev:ascf
$ yarn build:ascf

# npm script
$ npm run dev:ascf
$ npm run build:ascf

# 仅限全局安装
$ taro build --type ascf --watch
$ taro build --type ascf

# npx 用户也可以使用
$ npx taro build --type ascf --watch
$ npx taro build --type ascf

# watch 同时开启压缩
$ set NODE_ENV=production && taro build --type ascf --watch # CMD
$ NODE_ENV=production taro build --type ascf --watch # Bash

```

#### 开发者工具

工具准备：
下载并安装 鸿蒙元服务 ASCF 项目[开发环境搭建指南](https://developer.huawei.com/consumer/cn/doc/atomic-ascf/ascf-development-process)，确保已配置 ASCF 元服务开发环境。

#### 现有项目

在 taro 项目根目录下创建 ascf-project 目录，并使用工具在该目录下创建 ASCF 元服务项目。

修改 taro 项目下 config/index.{js,ts}配置文件，编译 ASCF 项目情况下将 outputRoot: 'dist/ascf' 修改为 outputRoot: process.env.TARO_ENV === 'ascf' ? 'ascf-project/ascf/ascf_src' : 'dist'。

编译命令：
使用 --type ascf 指定平台类型，与其他小程序（如 --type weapp）格式统一。
支持 dev:ascf（开发模式）和 build:ascf（生产模式）。

#### 新建项目

使用 taro init 进行项目初始化时，模板源选择`Gitee或者Github` -> `ascf`。项目初始化完成后，后续操作可查看[README.md](https://gitee.com/o2team/taro-project-templates/blob/v4.0/ascf/README.md)。

#### 调试运行

编译后文件在 ascf-project/ascf/ascf_src 目录下。参考鸿蒙元服务 ASCF 项目[开发流程](https://developer.huawei.com/consumer/cn/doc/atomic-ascf/ascf-development-process) 调试运行 ascf-project 项目。如果运行有异常，可以参考[调试指南](https://developer.huawei.com/consumer/cn/doc/atomic-ascf/debug-ascf-code)解决。

#### 适配问题

- ASCF 的 app.json 配置还不支持 theme 变量，需要适配修改为具体的值：

```javascript
{
  window: {
    backgroundColorTop: '@bgColorTop',
    backgroundColorBottom: '@bgColorBottom',
    backgroundTextStyle: '@bgTxtStyle',
    navigationBarBackgroundColor: '@navBgColor',
    navigationBarTitleText: 'ascf',
    navigationBarTextStyle: '@navTxtStyle'
  }
}
```

改为：

```javascript
const theme = require('./theme.json');
const $t = (key) => process.env.TARO_ENV === 'ascf' ? theme.light[key.replace('@', '')] : key;

defineAppConfig({
  {
    window: {
      backgroundColorTop: $t('@bgColorTop'),
      backgroundColorBottom: $t('@bgColorBottom'),
      backgroundTextStyle: $t('@bgTxtStyle'),
      navigationBarBackgroundColor: $t('@navBgColor'),
      navigationBarTitleText: 'ascf',
      navigationBarTextStyle: $t('@navTxtStyle')
    }
  }
})
```

## 渐进式入门教程

我们提供了一个由浅入深的实战教程，请参考[《教程》](./guide)。

## 常见问题

### 保持 CLI 的版本与各端依赖版本一致

在使用 Taro 进行多端开发中，请保持 Taro CLI 的版本与你项目的依赖版本一致，否则可能会出现编译错误或者运行时错误。

如果发现不一致的情况可以使用 Taro 升级命令 taro update self [版本号] 和 taro update project [版本号]来分别将 CLI 和项目依赖升级到指定版本；
或者也可以手动安装相应版本 CLI，修改 package.json 依赖版本号，然后重装依赖来解决。

```bash
# 使用Taro 升级命令更新CLI版本到最新版本
$ taro update self
# 使用Taro 升级命令更新CLI版本到指定版本
$ taro update self [版本号]
# 使用Taro 升级命令将项目依赖升级到与@tarojs/cli一致的版本
$ taro update project
# 使用Taro 升级命令将项目依赖升级到指定版本
$ taro update project [版本号]
```

如果你所使用的 Taro CLI 版本为 3.0.9，而项目里使用的依赖版本为 3.0.10，则有可能会出现问题，这时请将你的 Taro CLI 版本更新至项目依赖版本号相同的版本，如果还是出现问题，请向我们提出 [Issue](https://nervjs.github.io/taro-issue-helper/)。

### Taro 多版本共存问题

很多开发者曾经使用 Taro 旧版本开发过项目，已经在全局安装了 Taro，但是想同时体验到 Taro 3，应该如何进行操作？

我们提供了两种思路：

- 如果是需要新创建 Taro 3 项目，可以使用 [nvm](https://github.com/nvm-sh/nvm) 来管理 node 版本，通过安装不同 node 版本来安装不同版本的 Taro CLI，从而解决 Taro 多版本共存的问题
- 如果是部分已有项目需要升级到 Taro 3，可以在这些项目本地安装相应版本的 Taro CLI，这样通过 `yarn` 或者 `npm` 执行命令的话就会直接使用本地安装的 Taro CLI，安装方式 `yarn add @tarojs/cli`

### 回到某个版本

需要安装某个固定版本，或者回到某个版本，例如我们要安装 `1.3.9` ， 则如下：

```bash
# 使用 npm 安装 CLI
$ npm install -g @tarojs/cli@1.3.9
# OR 使用 yarn 安装 CLI
$ yarn global add @tarojs/cli@1.3.9
# OR 使用 pnpm 安装 CLI
$ pnpm add -g @tarojs/cli@1.3.9
# OR 安装了 cnpm，使用 cnpm 安装 CLI
$ cnpm install -g @tarojs/cli@1.3.9
```
</file>

<file path="docs/guide.mdx">
---
title: 渐进式入门教程
---

import { ReactIcon, VueIcon, Wechat } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

## 在我们开始之前

我们将在这个教程开发一个简单的 V2EX 论坛客户端，你将在本节教程学到 Taro 的基础知识、概念和部分优化技巧。学习这些知识并不需要事先了解 Taro、小程序开发或多端开发。当你掌握这些知识之后，你应该可以快速高效地开发多端应用。

:::tip 提示
这篇教程适合对喜欢边学边做或小程序开发完全没有了解的开发者，如果你倾向于按部就班地学习，请把 [文档](./) 的内容全部过一遍。当你看完 [文档](./) 就可以发现：本篇教程就是文档的渐近式索引。
:::

这篇教程将分为四个章节：

- [环境准备](#环境准备)：当我们使用 Taro 需要安装什么东西；
- [基础教程](#基础教程)：Taro 的基础概念和开发指南；
- [项目进阶与优化](#项目进阶与优化)：当项目变大变慢时，应该如何保持或提高应用的可维护性和性能；
- [多端开发](#多端开发)：已经使用 Taro 开发了一端的应用，如何快速拓展到多端应用。

（如果你在大屏幕浏览时）在本篇教程右边的标题目录包含了所有章节的子目录，你可以查看或导航到你感兴趣的章节。

### 前置知识

在本篇教程中我们假定你已经对 Web 前端开发和 JavaScript 有一定的了解。我们将使用 <ReactIcon /> 和 <VueIcon /> 两个框架分别实现我们的应用，在代码实例中点击 <ReactIcon /> 或 <VueIcon /> 按钮就可以切换不同的实现。如果你对两个框架都不太熟悉，可以通过 [React 文档](https://zh-hans.reactjs.org/)或 [Vue 文档](https://cn.vuejs.org/)对照代码实现。

在我们的代码实现中还会使用部分 ES6 语法，你可以通过 [ES6 入门教程](https://es6.ruanyifeng.com/) 查看或学习 ES6 语法。

## 环境准备

目前 Taro 仅提供一种开发方式：安装 Taro 命令行工具（Taro CLI）进行开发。

Taro CLI 依赖于 Node.js 环境，所以在你的机器上必须安装 Node.js 环境。安装 Node.js 环境有很多种方法，如果你完全不了解 Node.js 可以访问 [Node.js 官网](https://nodejs.org/en/) 下载一个可执行程序进行安装。请确保已具备较新的 node 环境（>=16.20.0）。

当你的机器已经存在了 Node.js 环境，可以通过在终端输入命令 `npm i -g @tarojs/cli` 安装 Taro CLI。安装完毕之后，在终端输入命令 `taro`，如果出现类似内容就说明安装成功了：

```bash
👽 Taro v3.0.0-beta.6

Usage: taro <command> [options]

Options:
  -V, --version       output the version number
  -h, --help          output usage information

Commands:
  init [projectName]  Init a project with default templete
  config <cmd>        Taro config
  create              Create page for project
  build               Build a project with options
  update              Update packages of taro
  info                Diagnostics Taro env info
  doctor              Diagnose taro project
  help [cmd]          display help for [cmd]
```

### 编辑器

我们推荐使用 [VSCode](https://code.visualstudio.com/) 或 [WebStorm](https://www.jetbrains.com/webstorm/)（或其它支持 Web 开发的 Jetbrains IDE）。

当你使用 VSCode 时，推荐安装 [ESLint 插件](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint)，如果你使用 TypeScript，别忘了配置 `eslint.probe` 参数。如果使用 Vue，推荐安装 [Vetur](https://marketplace.visualstudio.com/items?itemName=octref.vetur) 插件。

如果你愿意花钱又懒得折腾可以选择 [WebStorm](https://www.jetbrains.com/webstorm/)（或其它支持 Web 开发的 Jetbrains IDE），基本不需要配置。

不管使用 VSCode 还是 WebStrom，安装了上述插件之后使用 Taro 都实现自动补全和代码实时检查（linting）的功能。

### 终端

#### macOS/Linux

在 \*nix 系统中终端模拟器使用什么工具（Terminal/iTerm2/Konsole/Hyper/etc..）并不重要，但运行 Taro CLI 的 shell 我们推荐使用 `bash` 或 `zsh`。

#### Windows

在 Windows 中我们推荐使用内置的 `cmd` 或 `PowerShell`。如果有条件推荐安装 [WSL](https://docs.microsoft.com/zh-cn/windows/wsl/install-win10) 并使用 Linux 分发版的终端运行 Taro CLI。由于 Taro 的开发团队和 CI 都只运行或测试 \*nix 系统，部分 Windows 极端情况或许没能考虑到，导致出现 Bug。

### 寻求帮助

当你在开发过程中遇到问题时，你可以扫码加入 <Wechat /> 提问，或者去 [Taro 社区](https://taro-club.jd.com/) 提问。当你确信是 Taro 有 Bug 时，请随时向 [Taro GitHub Issue](https://github.com/NervJS/taro/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc) 提出你的问题。

## 基础教程

安装好 Taro CLI 之后可以通过 `taro init` 命令创建一个全新的项目，你可以根据你的项目需求填写各个选项，一个最小版本的 Taro 项目会包括以下文件：

```bash
├── babel.config.js             # Babel 配置
├── .eslintrc.js                # ESLint 配置
├── config                      # 编译配置目录
│   ├── dev.js                  # 开发模式配置
│   ├── index.js                # 默认配置
│   └── prod.js                 # 生产模式配置
├── package.json                # Node.js manifest
├── dist                        # 打包目录
├── project.config.json         # 小程序项目配置
├── src # 源码目录
│   ├── app.config.js           # 全局配置
│   ├── app.css                 # 全局 CSS
│   ├── app.js                  # 入口组件
│   ├── index.html              # H5 入口 HTML
│   └── pages                   # 页面组件
│       └── index
│           ├── index.config.js # 页面配置
│           ├── index.css       # 页面 CSS
│           └── index.jsx       # 页面组件，如果是 Vue 项目，此文件为 index.vue
```

我们以后将会讲解每一个文件的作用，但现在，我们先把注意力聚焦在 `src` 文件夹，也就是源码目录：

### 入口组件

每一个 Taro 项目都有一个入口组件和一个入口配置，我们可以在入口组件中设置全局状态/全局生命周期，一个最小化的入口组件会是这样：

<Tabs
  defaultValue="React"
  values={[
    { label: <ReactIcon />, value: 'React', },
    { label: <VueIcon />, value: 'Vue', }
  ]
}>

<TabItem value="React">

```jsx title="src/app.js"
import React, { Component } from 'react'
import './app.css'

class App extends Component {
  render() {
    // this.props.children 是将要会渲染的页面
    return this.props.children
  }
}

// 每一个入口组件都必须导出一个 React 组件
export default App
```

</TabItem>

<TabItem value="Vue">

```js title="src/app.js"
import Vue from 'vue'
import './app.css'

const App = {
  render(h) {
    // this.$slots.default 是将要会渲染的页面
    return h('block', this.$slots.default)
  },
}

export default App
```

</TabItem>

</Tabs>

每一个入口组件（例如 `app.js`）总是伴随一个全局配置文件（例如 `app.config.js`），我们可以在全局配置文件中设置页面组件的路径、全局窗口、路由等信息，一个最简单的全局配置如下：

<Tabs
  defaultValue="React"
  values={[
    { label: <ReactIcon />, value: 'React', },
    { label: <VueIcon />, value: 'Vue', }
  ]
}>

<TabItem value="React">

```js title="src/app.config.js"
export default {
  pages: ['pages/index/index'],
}
```

</TabItem>

<TabItem value="Vue">

```js title="src/app.config.js"
export default {
  pages: ['pages/index/index'],
}
```

</TabItem>

</Tabs>

你可能会注意到，不管是 <ReactIcon /> 还是 <VueIcon />，两者的全局配置是一样的。这是因为在配置文件中，Taro 并不关心框架的区别，Taro CLI 会直接在编译时在 Node.js 环境直接执行全局配置的代码，并把 `export default` 导出的对象序列化为一个 JSON 文件。接下来我们要讲到 [页面配置](#页面组件) 也是同样的执行逻辑。

因此，我们必须保证配置文件是在 Node.js 环境中是可以执行的，不能使用一些在 H5 环境或小程序环境才能运行的包或者代码，否则编译将会失败。

:::info 了解更多
Taro 的入口组件和全局配置规范是基于微信小程序而制定的，并对全平台进行统一。
你可以通过访问 [React 入口组件](./react-entry) 和 [Vue 入口组件](./vue-entry)，以及 [全局配置](./app-config) 了解入口组件和全局配置的详情。
:::

### 页面组件

页面组件是每一项路由将会渲染的页面，Taro 的页面默认放在 `src/pages` 中，每一个 Taro 项目至少有一个页面组件。在我们生成的项目中有一个页面组件：`src/pages/index/index`，细心的朋友可以发现，这个路径恰巧对应的就是我们[全局配置](./app-config)的 `pages` 字段当中的值。一个简单的页面组件如下：

<Tabs
  defaultValue="React"
  values={[
    { label: <ReactIcon />, value: 'React', },
    { label: <VueIcon />, value: 'Vue', }
  ]
}>

<TabItem value="React">

```jsx title="src/pages/index/index.jsx"
import { View } from '@tarojs/components'
class Index extends Component {
  state = {
    msg: 'Hello World!',
  }

  onReady() {
    console.log('onReady')
  }

  render() {
    return <View>{this.state.msg}</View>
  }
}

export default Index
```

</TabItem>

<TabItem value="Vue">

```html title="src/pages/index/index.vue"
<template>
  <view> {{ msg }} </view>
</template>

<script>
  export default {
    data() {
      return {
        msg: 'Hello World!',
      }
    },
    onReady() {
      console.log('onReady')
    },
  }
</script>
```

</TabItem>

</Tabs>

这不正是我们熟悉的 <ReactIcon /> 和 <VueIcon /> 组件吗！但还是有两点细微的差别：

1. `onReady` 生命周期函数。这是来源于微信小程序规范的生命周期，表示组件首次渲染完毕，准备好与视图交互。Taro 在运行时将大部分小程序规范页面生命周期注入到了页面组件中，同时 React 或 Vue 自带的生命周期也是完全可以正常使用的。
2. `View` 组件。这是来源于 `@tarojs/components` 的跨平台组件。相对于我们熟悉的 `div`、`span` 元素而言，在 Taro 中我们要全部使用这样的跨平台组件进行开发。

和入口组件一样，每一个页面组件（例如 `index.vue`）也会有一个页面配置（例如 `index.config.js`），我们可以在页面配置文件中设置页面的导航栏、背景颜色等参数，一个最简单的页面配置如下：

```jsx title="src/pages/index/index.config.js"
export default {
  navigationBarTitleText: '首页',
}
```

:::info 了解更多
Taro 的页面钩子函数和页面配置规范是基于微信小程序而制定的，并对全平台进行统一。
你可以通过访问 [React 页面组件](./react-page) 和 [Vue 页面组件](./vue-page) 了解全部页面钩子函数和页面配置规范。
:::

### 自定义组件

如果你看到这里，那不得不恭喜你，你已经理解了 Taro 中最复杂的概念：入口组件和页面组件，并了解了它们是如何（通过配置文件）交互的。接下来的内容，如果你已经熟悉了 <ReactIcon /> 或 <VueIcon /> 以及 Web 开发的话，那就太简单了：

我们先把首页写好，首页的逻辑很简单：把论坛最新的帖子展示出来。

<Tabs
  defaultValue="React"
  values={[
    { label: <ReactIcon />, value: 'React', },
    { label: <VueIcon />, value: 'Vue', }
  ]
}>

<TabItem value="React">

```jsx title="src/pages/index/index.jsx"
import Taro from '@tarojs/taro'
import React from 'react'
import { View } from '@tarojs/components'
import { ThreadList } from '../../components/thread_list'
import api from '../../utils/api'

import './index.css'

class Index extends React.Component {
  config = {
    navigationBarTitleText: '首页',
  }

  state = {
    loading: true,
    threads: [],
  }

  async componentDidMount() {
    try {
      const res = await Taro.request({
        url: api.getLatestTopic(),
      })
      this.setState({
        threads: res.data,
        loading: false,
      })
    } catch (error) {
      Taro.showToast({
        title: '载入远程数据错误',
      })
    }
  }

  render() {
    const { loading, threads } = this.state
    return (
      <View className="index">
        <ThreadList threads={threads} loading={loading} />
      </View>
    )
  }
}

export default Index
```

</TabItem>

<TabItem value="Vue">

```html title="src/pages/index/index.vue"
<template>
  <view class="index">
    <thread-list :threads="threads" :loading="loading" />
  </view>
</template>

<script>
  import Vue from 'vue'
  import Taro from '@tarojs/taro'
  import api from '../../utils/api'
  import ThreadList from '../../components/thread_list.vue'
  export default {
    components: {
      'thread-list': ThreadList,
    },
    data() {
      return {
        loading: true,
        threads: [],
      }
    },
    async created() {
      try {
        const res = await Taro.request({
          url: api.getLatestTopic(),
        })
        this.loading = false
        this.threads = res.data
      } catch (error) {
        Taro.showToast({
          title: '载入远程数据错误',
        })
      }
    },
  }
</script>
```

</TabItem>

</Tabs>

:::info 了解更多
可能你会注意到在一个 Taro 应用中发送请求是 `Taro.request()` 完成的。
和页面配置、全局配置一样，Taro 的 API 规范也是基于微信小程序而制定的，并对全平台进行统一。
你可以通过在 [API 文档](./apis/about/desc.md) 找到所有 API。
:::

在我们的首页组件里，还引用了一个 `ThreadList` 组件，我们现在来实现它：

<Tabs
  defaultValue="React"
  values={[
    { label: <ReactIcon />, value: 'React', },
    { label: <VueIcon />, value: 'Vue', }
  ]
}>

<TabItem value="React">

```jsx title="src/components/thread_list.jsx"
import React from 'react'
import { View, Text } from '@tarojs/components'
import { Thread } from './thread'
import { Loading } from './loading'

import './thread.css'

class ThreadList extends React.Component {
  static defaultProps = {
    threads: [],
    loading: true,
  }

  render() {
    const { loading, threads } = this.props

    if (loading) {
      return <Loading />
    }

    const element = threads.map((thread, index) => {
      return (
        <Thread
          key={thread.id}
          node={thread.node}
          title={thread.title}
          last_modified={thread.last_modified}
          replies={thread.replies}
          tid={thread.id}
          member={thread.member}
        />
      )
    })

    return <View className="thread-list">{element}</View>
  }
}

export { ThreadList }
```

```jsx title="src/components/thread.jsx"
import Taro, { eventCenter } from '@tarojs/taro'
import React from 'react'
import { View, Text, Navigator, Image } from '@tarojs/components'

import api from '../utils/api'
import { timeagoInst, Thread_DETAIL_NAVIGATE } from '../utils'

class Thread extends React.Component {
  handleNavigate = () => {
    const { tid, not_navi } = this.props
    if (not_navi) {
      return
    }
    eventCenter.trigger(Thread_DETAIL_NAVIGATE, this.props)
    // 跳转到帖子详情
    Taro.navigateTo({
      url: '/pages/thread_detail/thread_detail',
    })
  }

  render() {
    const { title, member, last_modified, replies, node, not_navi } = this.props
    const time = timeagoInst.format(last_modified * 1000, 'zh')
    const usernameCls = `author ${not_navi ? 'bold' : ''}`

    return (
      <View className="thread" onClick={this.handleNavigate}>
        <View className="info">
          <View>
            <Image src={member.avatar_large} className="avatar" />
          </View>
          <View className="middle">
            <View className={usernameCls}>{member.username}</View>
            <View className="replies">
              <Text className="mr10">{time}</Text>
              <Text>评论 {replies}</Text>
            </View>
          </View>
          <View className="node">
            <Text className="tag">{node.title}</Text>
          </View>
        </View>
        <Text className="title">{title}</Text>
      </View>
    )
  }
}

export { Thread }
```

</TabItem>

<TabItem value="Vue">

```html title="src/components/thread_list.vue"
<template>
  <view className="thread-list">
    <loading v-if="loading" />
    <thread
      v-else
      v-for="t in threads"
      :key="t.id"
      :node="t.node"
      :title="t.title"
      :last_modified="t.last_modified"
      :replies="t.replies"
      :tid="t.id"
      :member="t.member"
    />
  </view>
</template>

<script>
  import Vue from 'vue'
  import Loading from './loading.vue'
  import Thread from './thread.vue'
  export default {
    components: {
      loading: Loading,
      thread: Thread,
    },
    props: {
      threads: {
        type: Array,
        default: [],
      },
      loading: {
        type: Boolean,
        default: true,
      },
    },
  }
</script>
```

```html title="src/components/thread.vue"
<template>
  <view class="thread" @tap="handleNavigate">
    <view class="info">
      <view>
        <image :src="member.avatar_large | url" class="avatar" />
      </view>
      <view class="middle">
        <view :class="usernameCls"> {{member.username}} </view>
        <view class="replies">
          <text class="mr10">{{time}}</text>
          <text>评论 {{replies}}</text>
        </view>
      </view>
      <view class="node">
        <text class="tag">{{node.title}}</text>
      </view>
    </view>
    <text class="title">{{title}}</text>
  </view>
</template>

<script>
  import Vue from 'vue'
  import { eventCenter } from '@tarojs/taro'
  import Taro from '@tarojs/taro'
  import { timeagoInst, Thread_DETAIL_NAVIGATE } from '../utils'
  import './thread.css'
  export default {
    props: ['title', 'member', 'last_modified', 'replies', 'node', 'not_navi', 'tid'],
    computed: {
      time() {
        return timeagoInst.format(this.last_modified * 1000, 'zh')
      },
      usernameCls() {
        return `author ${this.not_navi ? 'bold' : ''}`
      },
    },
    filters: {
      url(val) {
        return 'https:' + val
      },
    },
    methods: {
      handleNavigate() {
        const { tid, not_navi } = this.$props
        if (not_navi) {
          return
        }
        eventCenter.trigger(Thread_DETAIL_NAVIGATE, this.$props)
        // 跳转到帖子详情
        Taro.navigateTo({
          url: '/pages/thread_detail/thread_detail',
        })
      },
    },
  }
</script>
```

</TabItem>

</Tabs>

这里可以发现我们把论坛帖子渲染逻辑拆成了两个组件，并放在 `src/components` 文件中，因为这些组件是会在其它页面中多次用到。
拆分组件的力度是完全由开发者决定的，Taro 并没有规定组件一定要放在 `components` 文件夹，也没有规定页面一定要放在 `pages` 文件夹。

另外一个值得注意的点是：我们并没有使用 `div`/`span` 这样的 HTML 组件，而是使用了 `View`/`Text` 这样的跨平台组件。

:::info 了解更多
Taro 文档的[跨平台组件库](./components-desc.mdx) 包含了所有组件参数和用法。但目前组件库文档中的参数和组件名都是针对 React 的（除了 React 的点击事件是 `onClick` 之外）。
对于 Vue 而言，组件名和组件参数都采用短横线风格（kebab-case）的命名方式，例如：`<picker-view indicator-class="myclass" />`
:::

### 路由与 Tabbar

在 `src/components/thread` 组件中，我们通过

```js
Taro.navigateTo({ url: '/pages/thread_detail/thread_detail' })
```

跳转到帖子详情，但这个页面仍未实现，现在我们去入口文件配置一个新的页面：

```js title="src/app.config.js"
export default {
  pages: ['pages/index/index', 'pages/thread_detail/thread_detail'],
}
```

然后在路径 `src/pages/thread_detail/thread_detail` 实现帖子详情页面，路由就可以跳转，我们整个流程就跑起来了：

<Tabs
  defaultValue="React"
  values={[
    { label: <ReactIcon />, value: 'React', },
    { label: <VueIcon />, value: 'Vue', }
  ]
}>

<TabItem value="React">

```jsx title="src/pages/thread_detail/thread_detail"
import Taro from '@tarojs/taro'
import React from 'react'
import { View, RichText, Image } from '@tarojs/components'
import { Thread } from '../../components/thread'
import { Loading } from '../../components/loading'
import api from '../../utils/api'
import { timeagoInst, GlobalState } from '../../utils'

import './index.css'

function prettyHTML (str) {
  const lines = ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6']

  lines.forEach(line => {
    const regex = new RegExp(`<${line}`, 'gi')

    str = str.replace(regex, `<${line} class="line"`)
  })

  return str.replace(/<img/gi, '<img class="img"')
}

class ThreadDetail extends React.Component {
  state = {
    loading: true,
    replies: [],
    content: '',
    thread: {}
  } as IState

  config = {
    navigationBarTitleText: '话题'
  }

  componentWillMount () {
    this.setState({
      thread: GlobalState.thread
    })
  }

  async componentDidMount () {
    try {
      const id = GlobalState.thread.tid
      const [{ data }, { data: [ { content_rendered } ] } ] = await Promise.all([
        Taro.request({
          url: api.getReplies({
            'topic_id': id
          })
        }),
        Taro.request({
          url: api.getTopics({
            id
          })
        })
      ])
      this.setState({
        loading: false,
        replies: data,
        content: prettyHTML(content_rendered)
      })
    } catch (error) {
      Taro.showToast({
        title: '载入远程数据错误'
      })
    }
  }

  render () {
    const { loading, replies, thread, content } = this.state

    const replieEl = replies.map((reply, index) => {
      const time = timeagoInst.format(reply.last_modified * 1000, 'zh')
      return (
        <View className='reply' key={reply.id}>
          <Image src={reply.member.avatar_large} className='avatar' />
          <View className='main'>
            <View className='author'>
              {reply.member.username}
            </View>
            <View className='time'>
              {time}
            </View>
            <RichText nodes={reply.content} className='content' />
            <View className='floor'>
              {index + 1} 楼
            </View>
          </View>
        </View>
      )
    })

    const contentEl = loading
      ? <Loading />
      : (
        <View>
          <View className='main-content'>
          <RichText nodes={content} />
          </View>
          <View className='replies'>
            {replieEl}
          </View>
        </View>
      )

    return (
      <View className='detail'>
        <Thread
          node={thread.node}
          title={thread.title}
          last_modified={thread.last_modified}
          replies={thread.replies}
          tid={thread.id}
          member={thread.member}
          not_navi={true}
        />
        {contentEl}
      </View>
    )
  }
}

export default ThreadDetail
```

</TabItem>

<TabItem value="Vue">

```html title="src/pages/thread_detail/thread_detail.vue"
<template>
  <view class="detail">
    <thread
      :node="topic.node"
      :title="topic.title"
      :last_modified="topic.last_modified"
      :replies="topic.replies"
      :tid="topic.id"
      :member="topic.member"
      :not_navi="true"
    />
    <loading v-if="loading" />
    <view v-else>
      <view class="main-content">
        <rich-text :nodes="content | html" />
      </view>
      <view class="replies">
        <view v-for="(reply, index) in replies" class="reply" :key="reply.id">
          <image :src="reply.member.avatar_large" class="avatar" />
          <view class="main">
            <view class="author"> {{reply.member.username}} </view>
            <view class="time"> {{reply.last_modified | time}} </view>
            <rich-text :nodes="reply.content_rendered | html" class="content" />
            <view class="floor"> {{index + 1}} 楼 </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</template>

<script>
  import Vue from 'vue'
  import Taro from '@tarojs/taro'
  import api from '../../utils/api'
  import { timeagoInst, GlobalState, IThreadProps, prettyHTML } from '../../utils'
  import Thread from '../../components/thread.vue'
  import Loading from '../../components/loading.vue'
  import './index.css'
  export default {
    components: {
      loading: Loading,
      thread: Thread,
    },
    data() {
      return {
        topic: GlobalState.thread,
        loading: true,
        replies: [],
        content: '',
      }
    },
    async created() {
      try {
        const id = GlobalState.thread.tid
        const [
          { data },
          {
            data: [{ content_rendered }],
          },
        ] = await Promise.all([
          Taro.request({
            url: api.getReplies({
              topic_id: id,
            }),
          }),
          Taro.request({
            url: api.getTopics({
              id,
            }),
          }),
        ])
        this.loading = false
        this.replies = data
        this.content = content_rendered
      } catch (error) {
        Taro.showToast({
          title: '载入远程数据错误',
        })
      }
    },
    filters: {
      time(val) {
        return timeagoInst.format(val * 1000)
      },
      html(val) {
        return prettyHTML(val)
      },
    },
  }
</script>
```

</TabItem>

</Tabs>

到目前为止，我们已经实现了这个应用的所有逻辑，除去「节点列表」页面（在进阶指南我们会讨论这个页面组件）之外，剩下的页面都可以通过我们已经讲解过的组件或页面快速抽象完成。按照我们的计划，这个应用会有五个页面，分别是：

1. 首页，展示最新帖子（已完成）
2. 节点列表
3. 热门帖子（可通过组件复用）
4. 节点帖子 （可通过组件复用）
5. 帖子详情 （已完成）

其中前三个页面我们可以把它们规划在 `tabBar` 里，`tabBar` 是 Taro 内置的导航栏，可以在 `app.config.js` 配置，配置完成之后处于的 `tabBar` 位置的页面会显示一个导航栏。最终我们的 `app.config.js` 会是这样：

```jsx title="app.config.js"
export default {
  pages: [
    'pages/index/index',
    'pages/nodes/nodes',
    'pages/hot/hot',
    'pages/node_detail/node_detail',
    'pages/thread_detail/thread_detail',
  ],
  tabBar: {
    list: [
      {
        iconPath: 'resource/latest.png',
        selectedIconPath: 'resource/lastest_on.png',
        pagePath: 'pages/index/index',
        text: '最新',
      },
      {
        iconPath: 'resource/hotest.png',
        selectedIconPath: 'resource/hotest_on.png',
        pagePath: 'pages/hot/hot',
        text: '热门',
      },
      {
        iconPath: 'resource/node.png',
        selectedIconPath: 'resource/node_on.png',
        pagePath: 'pages/nodes/nodes',
        text: '节点',
      },
    ],
    color: '#000',
    selectedColor: '#56abe4',
    backgroundColor: '#fff',
    borderStyle: 'white',
  },
  window: {
    backgroundTextStyle: 'light',
    navigationBarBackgroundColor: '#fff',
    navigationBarTitleText: 'V2EX',
    navigationBarTextStyle: 'black',
  },
}
```

## 项目进阶与优化

### 状态管理

在我们实现帖子组件（`src/components/thread`）时，通过 Taro 内置的 `eventCenter` 发起了一个事件，把当前帖子的数据注入到一个全局的 `GlobalState` 中，然后在帖子详情页面再从 `GlobalState` 取出当前帖子的数据——这种简单的发布/订阅模式在处理简单逻辑时非常有效且清晰。

一旦我们的业务逻辑变得复杂，一个简单的发布订阅机制绑定到一个全局的 `state` 可能就会导致我们的数据流变得难以追踪。好在这个问题不管是在 React 还是 Vue 社区中都有很好的解决方案。我们会使用这两个社区最热门的状态管理工具：`Redux` 和 `Vuex` 来解决这个问题。

<Tabs
  defaultValue="redux"
  values={[
    {label: 'Redux', value: 'redux'},
    {label: 'Vuex', value: 'vuex'},
  ]}>
<TabItem value="redux">

首先安装 `redux` 和 `react-redux`:

```bash
npm i redux react-redux
```

在入口文件使用 `react-redux` 的 `Provider` 注入 `context` 到我们的应用：

```js title="src/app.js"
import React, { Component } from 'react'
import { Provider } from 'react-redux'
import { createStore, combineReducers } from 'redux'
import './app.css'

const reducers = combineReducers({
  thread: (state = {}, action) => {
    if (action.type === 'SET_CURRENT_THREAD') {
      return {
        ...state,
        ...action.thread,
      }
    }
    return state
  },
})

const store = createStore(reducers)

class App extends Component {
  render() {
    // this.props.children 是将要会渲染的页面
    return <Provider store={store}>{this.props.children}</Provider>
  }
}

export default App
```

然后在帖子组件中我们就可以通过 `connect` 一个 `dispatch` 设置当前的帖子：

```diff title="src/components/thread.jsx"
- eventCenter.trigger(Thread_DETAIL_NAVIGATE, this.props)
+ this.props.setThread(this.props)
- export default Thread
+ const mapDispatchToProps = dispatch => {
+   return {
+     setThread: thread => dispatch({ type: 'SET_CURRENT_THREAD', thread })
+   }
+ }
+ export default connect(null, mapDispatchToProps)(Thread)
```

在帖子详情组件中通过 `connect` 一个 `mapStateToProps` 获取当前帖子的数据：

```diff title="src/components/thread_detail.jsx"
- const id = GlobalState.thread.tid
+ const id = this.props.thread.tid
- export default ThreadDetail
+ function mapStateToProps(state) {
+  return { thread: state.thread }
+ }
+ export default connect(mapStateToProps)(ThreadDetail)
```

:::caution 请注意
此教程演示的是 `Redux` 极简用法，而非最佳实践。详情请访问 [Redux 文档](https://www.redux.org.cn/) 和 [react-redux 文档](https://react-redux.js.org/introduction/quick-start)。
:::

</TabItem>
<TabItem value="vuex">

首先安装 `vuex`:

```bash
npm i vuex
```

在入口文件中注入 Vuex 的 `store`：

```js title="src/app.js"
import Vue from 'vue'
import Vuex from 'vuex'
import './app.css'

const store = new Vuex.Store({
  state: {
    thread: {},
  },
  mutations: {
    setThread: (state, thread) => {
      state.thread = { ...thread }
    },
  },
})

const App = {
  store,
  render(h) {
    // this.$slots.default 是将要会渲染的页面
    return h('block', this.$slots.default)
  },
}

export default App
```

然后在帖子组件中我们就可以通过 `this.$store.setThread()` 设置当前的帖子：

```diff title="src/components/thread.vue"
- eventCenter.trigger(Thread_DETAIL_NAVIGATE, this.props)
+ this.$store.setThread(this.$props)
```

在帖子详情组件中通过 `computed` 获取当前帖子的数据：

```diff title="src/components/thread_detail.vue"
{
  data () {
    return {
-     topic: GlobalState.thread,
      loading: true,
      replies: [],
      content: ''
    }
  },
+ computed: {
+  topic() {
+    return this.$store.state.thread
+  }
+ }
}
```

:::caution 请注意
此教程演示的是 `Vuex` 极简用法，而非最佳实践。详情请访问 [Vuex 文档](https://vuex.vuejs.org/zh/guide/)。
:::

</TabItem>
</Tabs>

#### 其它状态管理工具

原理上来说，Taro 可以支持任何兼容 React 或 Vue 的状态管理工具，使用这类工具通常都会要求在入口组件注入 `context`，而在 Taro 中入口文件是不能渲染 UI 的。只要注意这点即可。

在 Vue 生态圈我们推荐使用 `Vuex`。React 生态圈状态管理工具百花齐放，考虑到使用 Taro 的开发者很多应用会编译到小程序，我们推荐几个在性能或体积上有优势的状态管理工具：

- [`mobx-react`](https://cn.mobx.js.org/): 和 Vuex 一样响应式的状态管理工具
- [unstaged](https://github.com/jamiebuilds/unstated-next): 基于 React Hooks 的极简状态管理工具，压缩体积只有 200 字节
- [Recoil](https://recoiljs.org/): Facebook 推出的基于 React Hooks 的状态管理工具

### CSS 工具

在 Taro 中，我们可以自由地使用 CSS 预处理器和后处理器，使用的方法也非常简单，只要在编译配置添加相关的插件即可：

```js {8,9,10} title="config/index.js"
const config = {
  projectName: 'v2ex',
  date: '2018-8-3',
  designWidth: 750,
  sourceRoot: 'src',
  outputRoot: 'dist',
  plugins: [
    '@tarojs/plugin-sass', // 使用 Sass
    // '@tarojs/plugin-less', // 使用 Less
    // '@tarojs/plugin-stylus', // 使用 Stylus
  ],
  defineConstants: {},
  mini: {},
  h5: {
    publicPath: '/',
    staticDirectory: 'static',
    module: {
      postcss: {
        autoprefixer: {
          enable: true,
        },
      },
    },
  },
}

module.exports = function (merge) {
  if (process.env.NODE_ENV === 'development') {
    return merge({}, config, require('./dev'))
  }
  return merge({}, config, require('./prod'))
}
```

:::info 了解更多
除了 CSS 预处理器之外，Taro 还支持 [CSS Modules](./css-modules.md) 和 [CSS-in-JS](./css-in-js.mdx)。
原理上还支持更多 CSS 工具，我们将在 [自定义编译](#自定义编译) 继续讨论这个问题。
:::

### 渲染 HTML

在帖子详情组件（`ThreadDetail`）中，我们使用了内置组件 `RichText` 来渲染 HTML，但这个组件的兼容性不好，无法在所有端都正常使用，某些特定的 HTML 元素也无法渲染。

幸运的是，Taro 内置了 HTML 渲染，使用方法也和 React/Vue 在 Web 开发中没什么区别：

<Tabs
  defaultValue="React"
  values={[
    { label: <ReactIcon />, value: 'React', },
    { label: <VueIcon />, value: 'Vue', }
  ]
}>

<TabItem value="React">

```diff title="src/pages/thread_detail/thread_detail.jsx"
- <RichText nodes={reply.content} className='content' />
+ <View dangerouslySetInnerHTML={{ __html: reply.content }} className='content'></View>
```

</TabItem>

<TabItem value="Vue">

```diff title="src/pages/thread_detail/thread_detail.vue"
- <rich-text :nodes="reply.content_rendered | html" class='content' />
+ <view v-html="reply.content_rendered | html" class='content' />
```

</TabItem>

</Tabs>

:::info 了解更多
Taro 内置的 HTML 渲染功能不仅可以按 Web 开发的方式去使用，也支持自定义样式、自定义渲染、自定义事件这样的高级功能。
你可以访问 [HTML 渲染文档](./html.mdx) 了解更多。
:::

### 性能优化

#### 虚拟列表

在帖子列表组件（`ThreadList`）中，我们直接渲染从远程得来的数据。这样做没有什么问题，但如果我们的数据非常庞大，或者列表渲染的 DOM 结构异常复杂，这就可能会产生性能问题。

为了解决这一问题，Taro 内置了虚拟列表（`VirtualList`）功能，比起全量渲染所有列表数据，我们只需要渲染当前可视区域(visable viewport)的视图：

<Tabs
  defaultValue="React"
  values={[
    { label: <ReactIcon />, value: 'React', },
    { label: <VueIcon />, value: 'Vue', }
  ]
}>

<TabItem value="React">

```jsx title="src/pages/thread_detail/thread_list.jsx"
import React from 'react'
import { View, Text } from '@tarojs/components'
import { Thread } from './thread'
import { Loading } from './loading'
import VirtualList from '@tarojs/components-advanced/dist/components/virtual-list'

import './thread.css'

const Row = React.memo(({ thread }) => {
  return (
    <Thread
      key={thread.id}
      id={thread.id}
      node={thread.node}
      title={thread.title}
      last_modified={thread.last_modified}
      replies={thread.replies}
      tid={thread.id}
      member={thread.member}
    />
  )
})

class ThreadList extends React.Component {
  static defaultProps = {
    threads: [],
    loading: true,
  }

  render() {
    const { loading, threads } = this.props

    if (loading) {
      return <Loading />
    }

    const element = (
      <VirtualList
        height={800} /* 列表的高度 */
        width="100%" /* 列表的宽度 */
        item={Row} /* 列表单项组件，这里只能传入一个组件 */
        itemData={threads} /* 渲染列表的数据 */
        itemCount={threads.length} /* 渲染列表的长度 */
        itemSize={100} /* 列表单项的高度  */
      />
    )

    return <View className="thread-list">{element}</View>
  }
}

export { ThreadList }
```

</TabItem>

<TabItem value="Vue">

```js title="app.js"
// 在入口文件新增使用插件
import VirtualList from '@tarojs/components-advanced/dist/components/virtual-list'
Vue.use(VirtualList)
```

```html title="src/components/row.vue"
<template>
  <thread
    :id="id"
    :key="thread.id"
    :node="thread.node"
    :title="thread.title"
    :last_modified="thread.last_modified"
    :replies="thread.replies"
    :tid="thread.id"
    :member="thread.member"
  />
</template>

<script>
  import Thread from './thread.vue'
  export default {
    components: {
      thread: Thread,
    },
    props: ['id', 'index', 'data'],
    computed: {
      thread() {
        return this.data[this.index]
      },
    },
  }
</script>
```

```html title="src/components/thread_list.vue"
<template>
  <view className="thread-list">
    <loading v-if="loading" />
    <virtual-list
      v-else
      :height="500"
      :item-data="threads"
      :item-count="threads.length"
      :item-size="100"
      :item="Row"
      width="100%"
    />
  </view>
</template>

<script>
  import Vue from 'vue'
  import Loading from './loading.vue'
  import Thread from './thread.vue'
  import Row from './row.vue'
  export default {
    components: {
      loading: Loading,
      thread: Thread,
    },
    props: {
      threads: {
        type: Array,
        default: [],
      },
      loading: {
        type: Boolean,
        default: true,
      },
    },
  }
</script>
```

</TabItem>

</Tabs>

:::info 了解更多
在文档[虚拟列表](./virtual-list) 你可以找到虚拟列表的一些高级用法，例如：无限滚动、滚动偏移、滚动事件等。
:::

#### 预渲染

现在我们来实现最后一个页面：节点列表页面。这个页面本质说就是渲染一个存在本地的巨大列表：

<Tabs
  defaultValue="React"
  values={[
    { label: <ReactIcon />, value: 'React', },
    { label: <VueIcon />, value: 'Vue', }
  ]
}>

<TabItem value="React">

```jsx title="src/pages/nodes/nodes.jsx"
import React from 'react'
import { View, Text, Navigator } from '@tarojs/components'
import allNodes from './all_node'
import api from '../../utils/api'

import './nodes.css'

function Nodes() {
  const element = allNodes.map((item) => {
    return (
      <View key={item.title} className="container">
        <View className="title">
          <Text style="margin-left: 5px">{item.title}</Text>
        </View>
        <View className="nodes">
          {item.nodes.map((node) => {
            return (
              <Navigator
                className="tag"
                url={`/pages/node_detail/node_detail${api.queryString(node)}`}
                key={node.full_name}
              >
                <Text>{node.full_name}</Text>
              </Navigator>
            )
          })}
        </View>
      </View>
    )
  })
  return <View className="node-container">{element}</View>
}

export default Nodes
```

</TabItem>

<TabItem value="Vue">

```html title="src/pages/nodes/nodes.vue"
<template>
  <view class="node-container">
    <view v-for="item in allNodes" :key="item.title" class="container">
      <view class="title">
        <text style="margin-left: 5px">{{item.title}}</text>
      </view>
      <view class="nodes">
        <navigator v-for="node in item.nodes" :key="node.full_name" class="tag" :url="node | url">
          <text>{{node.full_name}}</text>
        </navigator>
      </view>
    </view>
  </view>
</template>

<script>
  import Vue from 'vue'
  import allNodes from './all_node'
  import api from '../../utils/api'
  import './nodes.css'

  function getURL(node) {
    return `/pages/node_detail/node_detail${api.queryString(node)}`
  }

  export default {
    data() {
      return {
        allNodes,
      }
    },
    filters: {
      url(node) {
        return getURL(node)
      },
    },
  }
</script>
```

</TabItem>

</Tabs>

这个时候我们整个应用就完成了。但如果你把这个应用放在真机小程序中，尤其是一些性能不高的真机中，切换到此页面的时间可能会比较长，会有一段白屏时间。

这是由于 Taro 的渲染机制导致的：在页面初始化时，原生小程序可以从本地直接取数据渲染，但 Taro 会把初始数据通过 React/Vue 渲染成一颗 DOM 树，然后将这颗 DOM 树序列化之后交给小程序渲染。也就是说，比起原生小程序 Taro 会在页面初始化时多一次调用 `setData` 函数的支出——而大部分小程序的性能问题是 `setData` 数据过大导致的。

为了解决这个问题，Taro 引入了一种名为预渲染（Prerender）的技术，和服务端渲染一样，在 Taro CLI 直接将要渲染的页面转换为 `wxml` 字符串，这样就获得了与原生小程序一致甚至更快的速度。

使用预渲染也非常简单，我们只要进行简单的配置即可：

```js {4-6} title="config/prod.js"
const config = {
  ...
  mini: {
    prerender: {
      include: ['pages/nodes/nodes'], // `pages/nodes/nodes` 也会参与 prerender
    }
  }
};

// 我们这里在编译生产模式时才开启预渲染
// 如果需要开发时也开启，那就把配置放在 `config/index` 或 `config/dev`
module.exports = config
```

:::info 了解更多
预渲染的配置支持条件渲染页面、条件渲染逻辑、自定义渲染函数等功能，详情可以访问[预渲染文档](./prerender.md)。
:::

### 打包体积

默认而言使用生产模式打包，Taro 就会给你优化打包体积。但值得注意，Taro 默认的打包配置是为了让多数项目和需求都可以运行，而不是针对任何项目的最优选择。因此你可以在 Taro 配置的基础之上再针对自己的项目进行优化。

#### JavaScript

在 Taro 应用中，所有 Java(Type)Script 都是通过 `babel.config.js` 配置的，具体来说是使用 [`babel-prest-taro`](https://www.npmjs.com/package/babel-preset-taro) 这个 Babel 插件编译的。

默认而言 Taro 会兼容所有 [`@babel/preset-env`](https://www.npmjs.com/package/@babel/preset-env) 支持的语法，并兼容到 `iOS 9` 和 `Android 5`，如果你不需要那么高的兼容性，或者不需要某些 ES2015+ 语法支持，可以自行配置 `babel.config.js` 达到缩小打包体积效果。

例如我们可以把兼容性提升到 `iOS 12`：

```js title="babel.config.js"
// babel.config.js
module.exports = {
  presets: [
    [
      'taro',
      {
        targets: {
          ios: '12',
        },
      },
    ],
  ],
}
```

你可以访问 [Babel 文档](https://babeljs.io/) 了解更多自定义配置的信息。

#### 打包体积分析

Taro 使用 [Webpack](https://www.webpackjs.com/) 作为内部的打包系统，有时候当我们的业务代码使用了 `require` 语法或者 `import default` 语法，Webpack 并不能给我们提供 `tree-shaking` 的效果。在这样的情况下我们通过 [`webpack-bundle-analyzer`](https://www.npmjs.com/package/webpack-bundle-analyzer) 来分析我们依赖打包体积，这个插件会在浏览器打开一个可视化的图表页面告诉我们引用各个包的体积。

首先安装 `webpack-bundle-analyzer` 依赖:

```bash
npm install webpack-bundle-analyzer -D
```

然后在 [mini.webpackChain](./config-detail/#miniwebpackchain-1) 中添加如下配置：

```js {4-7} title="config/index"
const config = {
  ...
  mini: {
    webpackChain (chain, webpack) {
      chain.plugin('analyzer')
        .use(require('webpack-bundle-analyzer').BundleAnalyzerPlugin, [])
    }
  }
}
```

运行编译命令完成之后就可以看到各文件依赖关系及体积。

你可以访问 [webpack-bundle-analyzer](https://www.npmjs.com/package/webpack-bundle-analyzer) 文档了解详细的用法。

#### 分包

在一些情况，我们希望我们的页面只有当用到时才按需进行加载。这种情况在 Taro 应用被称为分包，分包的使用也非常简单，只需要通过配置入口文件 `app.config.js` 即可。

假设我们需要把刚刚实现预渲染的所有节点页面进行分包：

```js title="src/app.config.js"
export default {
  pages: [
    'pages/index/index',
    // 'pages/nodes/nodes', 把要分包的页面从 `pages` 字段中删除
    'pages/hot/hot',
    'pages/node_detail/node_detail',
    'pages/thread_detail/thread_detail'
  ],
  // 在 `subpackages` 字段添加分包，如果目标是支付宝小程序，还需要加一个字段 `subPackages` 值和 `subpackages` 一致
  // 不能在 `pages` 根目录也不能在 pages 目录外，需要在 `pages` 根目录另外新建文件夹做分包
  "subpackages": [
    {
      "root": "pages",
      "pages": [
        "nodes/nodes"
      ]
    }
  ]
  tabBar: {
    list: [{
      'iconPath': 'resource/latest.png',
      'selectedIconPath': 'resource/lastest_on.png',
      pagePath: 'pages/index/index',
      text: '最新'
    }, {
      'iconPath': 'resource/hotest.png',
      'selectedIconPath': 'resource/hotest_on.png',
      pagePath: 'pages/hot/hot',
      text: '热门'
    }, {
      // 如果是分包的子页面，就不能在 `tabBar` 中使用
      'iconPath': 'resource/node.png',
      'selectedIconPath': 'resource/node_on.png',
      pagePath: 'pages/nodes/nodes',
      text: '节点'
    }],
    'color': '#000',
    'selectedColor': '#56abe4',
    'backgroundColor': '#fff',
    'borderStyle': 'white'
  },
  window: {
    backgroundTextStyle: 'light',
    navigationBarBackgroundColor: '#fff',
    navigationBarTitleText: 'V2EX',
    navigationBarTextStyle: 'black'
  }
}
```

### 自定义编译

在特定的情况下，Taro 自带的编译系统没有办法满足我们的编译需求，这时 Taro 提供了两种拓展编译的方案：

#### 使用 Webpack 进行拓展

在[打包体积分析](#打包体积分析) 中我们在 [mini.webpackChain](./config-detail/#miniwebpackchain-1) 添加了一个 Webpack 插件，达到了打包体积/依赖分析的效果。

事实上通过 `mini.webpackChain` 这个配置我们可以几乎使用任何 Webpack 生态的插件和 `loader`，例如我们想使用 `CoffeeScript` 来进行开发：

```js {6-19} title="config/index"
const config = {
  ...
  mini: {
    webpackChain (chain, webpack) {
      // webpack-chain 详细语法请参考文档：https://github.com/neutrinojs/webpack-chain
      chain.merge({
        module: {
          rule: {
            coffeeScript: {
              test: /\.coffee$/,
              use: {
                coffeeLoader: {
                  loader: 'coffee-loader'
                }
              }
            }
          }
        }
      })
    }
  }
}
```

同样，之前我们提到过的 `CSS Modules` 也可以通过 Webpack 的形式进行拓展支持。详情可以访问 [webpack-chain](https://github.com/neutrinojs/webpack-chain) 文档了解详细的用法。

#### 使用插件化系统进行拓展

在 [CSS 工具](#CSS-工具) 我们已经使用了名为 `@tarojs/plugin-sass` 的插件来实现对 `Sass` 的支持。比起使用 Webpack 拓展编译，Taro 的插件功能不用在每个端都对 Webpack 进行配置，只用使用插件即可。

除此之外，Taro 的插件化功能还可以拓展 Taro CLI 编译命令，拓展编译流程，拓展编译平台，你可以访问 [插件功能文档](./plugin.md) 了解更多自定义配置的信息。

:::info 了解更多
除了以上两种方式外，Taro 还提供大量的编译相关选项，你可以访问 [编译配置详情](./config-detail) 文档了解更多。
:::

## 多端开发

### 跨平台开发

在某些情况下，不同平台的表现或业务逻辑有质的不同。在这样的情况下我们是没有办法做到「一套代码走天下」的。

例如我们正在实现 V2EX 论坛应用，当前的 API 没有办法在浏览器中跨域调用，因此我们需要在 H5 端使用另一份 API。我们可以通过内置环境变量来解决：

```diff
- import api from '../../utils/api'
// 我们可以根据不同的平台，引入不同的 API
+ let api
+ if (process.env.TARO_ENV === 'weapp') {
+  api = require('../../utils/api-weapp')
+ } else if (process.env.TARO_ENV === 'h5') {
+  api = require('../../utils/api-h5')
+ }
```

Taro 还提供了[统一接口的多端文件](./envs.md#统一接口的多端文件)，通过不同的命名方式寻找依赖，在这类情况下，我们可以保留：

```js
import api from '../../utils/api'
```

语句原封不动，修改我们的文件结构，在文件名和后缀名之间加上平台的名字：

```bash
.
└── utils
    ├── api.h5.js
    ├── api.weapp.js
    └── index.js
```

:::info 了解更多
除了「内置环境变量」和「统一接口的多端文件」之外，Taro 还提供了别的跨平台开发解决方案，你可以访问文档 [跨平台开发](./envs.md) 了解更多。
:::

### 同步调试

默认情况下，Taro 会把各端打包后的文件都放在 `dist` 目录。如果你想要多端同步调试的话先编译后的文件就会被后编译好的文件覆盖。

但我们可以通过修改编译配置的 `outputRoot` 达到多端同步调试的目的：

```js {2} title="config/index.js"
const config = {
  outputRoot: `dist/${process.env.TARO_ENV}`,
}
```

在这样的配置下，微信小程序编译后的目录就会是 `dist/weapp`，H5 编译后目录就会是 `dist/h5`。

### 使用原生小程序组件

某些情况下我们需要复用小程序既有生态，而小程序的组件/库通常是针对特定小程序写的，并不能直接在 Taro 上使用，需要一些额外的操作。

例如我们的论坛应用，在帖子详情可能服务端返回的是 MarkDown 格式，我们就需要 `towxml` 来渲染的我们的帖子：

首先我们需要在帖子详情页面的配置文件中引用 `towxml`:

```js
export default {
  usingComponents: {
    towxml: '../../towxml/towxml',
  },
}
```

然后使用 `towxml` 组件，这里必须记住的是不管是 React 还是 Vue，原生小程序组件声明需要是小写的

<Tabs
  defaultValue="React"
  values={[
    { label: <ReactIcon />, value: 'React', },
    { label: <VueIcon />, value: 'Vue', }
  ]
}>

<TabItem value="React">

```diff title="src/pages/thread_detail/thread_detail.jsx"
- <View dangerouslySetInnerHTML={{ __html: reply.content }} className='content'></View>
+ <towxml nodes="{{reply.content}}" />
```

</TabItem>

<TabItem value="Vue">

```diff title="src/pages/thread_detail/thread_detail.vue"
- <view v-html="reply.content_rendered | html" class='content' />
+ <towxml :nodes="reply.content_rendered | html" />
```

</TabItem>

</Tabs>

最后按照 [towxml](https://github.com/sbfkcel/towxml/wiki/3.0-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8) 文档调用即可。

:::caution 请注意
一旦使用了原生小程序组件，Taro 应用就失去了跨端的能力。
:::

:::info 了解更多
Taro 还支持使用小程序插件，详情可以访问文档[使用小程序原生第三方组件和插件](./taro-in-miniapp)。
:::
</file>

<file path="docs/h5.md">
---
title: H5
---

本篇将介绍 H5 开发的相关内容，包括兼容性、注意事项等。

## 兼容性

### ES5

#### JS 版本

为了更高的编译效率和更小的产物体积，V4 开始默认的 browserslist 配置调整为：

```json
{
  "browserslist": ["defaults and fully supports es6-module", "maintained node versions"]
}
```

> 如不存在 browserslist 相关配置，则会使用 `@babel/preset-env` 的 `target` 默认配置，如下：

```js
targets = {
  ios: '9',
  android: '5',
}
```

#### 将代码编译为 ES5

V4.0.8 开始使用脚手架创建项目时新增了`是否编译为ES5`的确认项，如选择`是`，生成的项目会在生产模式打包时将全量代码编译为 ES5。需要注意的是：编译为 ES5 会影响编译效率和产物体积。

也可以通过如下配置将代码编译为 ES5：

1. 修改 browserslist

```json title='package.json'
{
  "browserslist": {
    "development": ["defaults and fully supports es6-module", "maintained node versions"],
    "production": ["last 3 versions", "Android >= 4.1", "ios >= 8"]
  }
}
```

2. 设置 BROWSERSLIST_ENV 环境变量，以便在不同环境使用不同的 browserslist 配置

```js title='config/index.js'
process.env.BROWSERSLIST_ENV = process.env.NODE_ENV
```

3. 修改 `babel-preset-taro` 的配置。[文档](babel-config#usebuiltins)

```js title='babel.config.js'
useBuiltIns: process.env.TARO_ENV === 'h5' ? 'usage' : false
```

4. 修改编译范围

```js title='config/prod.js'
// 编译器为 webpack 时
h5: {
    compile: {
      include: [
        // 确保产物为 ES5，如可以确认包含 ES6 代码的 node_modules，则可修改正则采用白名单方式缩小编译范围，以提升编译速度
        filename => /node_modules\/(?!(@babel|core-js|style-loader|css-loader|react|react-dom))/.test(filename)
      ]
    }
}

// 编译器为 vite 时
h5: {
  legacy: true,
}
```

> 小程序可根据自己需求决定是否需要配置和 H5 一样的 include。

> V4.0.8 之前的版本由于默认 exclude 了 `@tarojs/components`，而 exclude 优先级高于 include，所以需要按下述方法配置：

```js title='config/prod.js'
h5: {
  webpackChain (chain) {
    chain.merge({
      module: {
        rule: {
          myloader: {
            test: /\.js$/,
            use: [
              {
                loader: 'babel-loader',
                options: {},
              },
            ],
          },
        },
      },
    });
  }
}
```

#### 其他注意事项

- Taro 内置的 `babel-loader` 配置请查看 [H5WebpackModule](https://github.com/NervJS/taro/blob/8317e63d0345e18dedcccc34c3ae672ef829f304/packages/taro-webpack5-runner/src/webpack/H5WebpackModule.ts#L258)。
- V4.0.8 开始 `@tarojs/components` 也会经过 Babel 编译。
- 除了通过 `h5.compile` 来新增 include 和 exclude，您也可使用 [WebpackChain](config-detail#h5webpackchain) 来修改 Taro 内置的 `babel-loader` 配置。
- 如果还会遇到兼容性问题（如 Android 4.4），可考虑以下几点：
  - 使用兼容性组件库（暂时只支持 React），见：[兼容性组件库](h5#react-兼容性组件库)。
  - 如遇到 `Promise undefined` 等问题，可在 `index.html` 中手动引入一个 Promise 的 polyfill。

### 组件库

#### Input 组件不受控制

在 React 框架中使用 Input 组件时，如果传入 Input 组件值并未更新，开发者对输入值的约束会失效。这是由于虽然用户输入触发了相关事件，但由于开发者约束值导致组件 props 并未实际触发组件更新导致，此时需要手动刷新组件内容。

> [相关 Issue](https://github.com/NervJS/taro/issues/12111)

#### React 兼容性组件库

:::note
Taro 3.2.4 开始支持
:::

Taro3 的 H5 端组件库基于 `Web Components`，使用了 [Stencil](https://stenciljs.com/) 框架进行开发。

> Stencil [兼容性情况](https://stenciljs.com/docs/browser-support)

但移动端对 `Web Components` 的支持还有一些问题，主要问题如下：

- 安卓 4.4 白屏
- 多行文字截断失效
- 部分安卓机（OPPO、VIVO 居多），样式 `visibility` 切换失败导致页面白屏

因此，对兼容性要求强烈对开发者，可以使用 **React 兼容性组件库**代替默认的 `Web Components` 组件库。它完全基于 React 开发，兼容性良好，但是目前**只适配了若干常用的组件**，开发者请**谨慎选择使用**。

#### 使用方法

1. 安装兼容性组件库

```bash
$ yarn add @tarojs/components-react
```

2. 设置编译配置 `h5.useHtmlComponents`

```js title="config/index.js"
module.exports = {
  h5: {
    useHtmlComponents: true,
  },
}
```

3. 启动编译

```bash
$ taro build --type h5 --watch
```

#### 贡献流程

由于人力问题，Taro 团队的迭代重心仍在 `Web Components` 组件库上。也欢迎各位开发者为 React 兼容性组件库添砖加瓦，具体工作是把以 `Stencil` 语法开发的组件改为 React 语法（Stencil 支持 JSX，因此改造工作量不大）。具体开发流程请看：[@tarojs/component-react](https://github.com/NervJS/taro/blob/next/packages/taro-components-react/README.md#%E6%94%B9%E9%80%A0%E6%96%B9%E6%B3%95)

### lazy-load

Taro-H5 打包时会将页面和组件拆分成独立的文件按需加载，但这么做会导致没有用到的页面和组件依旧会被打包，有一些场景（比如 PWA 等需要严格限制包体大小时）会因此受到一些困扰。

所以我们通过 babel 插件提供了移除懒加载的方法：

```js title="babel.config.js" {6}
module.exports = {
  presets: [
    [
      'taro',
      {
        framework: 'react',
        hot: false,
        'dynamic-import-node': true, // 如果使用时遇到问题，可尝试将 devServer 配置项中的 hot 设置为 false
      },
    ],
  ],
}
```

### dataset

Taro-H5 在 3.3.1+ 版本才支持 `data-*` 设置参数到节点上，如需使用请升级到对应版本。

### 浏览器 IntersectionObserver 兼容

在 Taro H5 中，我们使用了 [IntersectionObserver](https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver) 来实现了 `Image` 组件和 `createIntersectionObserver` 方法，考虑到该对象在各端特别是移动端适配度已经很高，在 v3.6.23 版本开始考量移除了它的 polyfill 依赖，如若项目有 IE11 及以下浏览器需求可以通过以下配置启用该兼容模式。

```js
// config/prod.js
module.exports = {
  env: {
    NODE_ENV: '"production"',
    SUPPORT_TARO_POLYFILL: '"enabled"', // 默认值为 disabled
  },
  // ...
}
```

### 钉钉内核浏览器兼容

钉钉内核的浏览器部分特性和其他浏览器有所不同，需要专门适配(譬如标题不能切换等等)。由于需要引入 `dingtalk-jsapi` 将导致包体变大，故而默认关闭，如果需要可通过如下配置启用适配模块。

```js
// config/prod.js
module.exports = {
  env: {
    NODE_ENV: '"production"',
    SUPPORT_TARO_POLYFILL: '"enabled"', // 3.+ 默认值为 enabled; 4.+ 默认值为 disabled
  },
  // ...
}
```

| 值                    | 说明                           |
| --------------------- | ------------------------------ |
| enabled               | 启用全部 Polyfill              |
| Object                | Object Scope Polyfill          |
| Object.assign         | Object.assign Polyfill         |
| Object.defineProperty | Object.defineProperty Polyfill |
| IntersectionObserver  | IntersectionObserver Polyfill  |
| disabled              | 禁用全部 Polyfill              |

## 路由

### 路由模式

H5 支持使用 `hash` 路由模式和浏览器 `history` 路由模式，默认使用 `hash` 模式。可以修改 [h5.router.mode](./config-detail#h5routermode) 进行配置。

### 路由基准路径 basename

H5 支持设置路由 basename，可以修改 [h5.router.basename](config-detail#h5routerbasename) 进行配置。

### 自定义路由

H5 支持设置自定义的路由影射规则，可以修改 [h5.router.customRoutes](config-detail#h5routercustomroutes) 进行配置。

### 路由守卫

Taro H5 的路由实现基于 [history](https://github.com/remix-run/history) 库，因此支持使用 history 库提供的一系列能力，路由守卫就是其中之一。

当用户返回上一页时，我们可以借助 `history` 的 [Blocking Transitions](https://github.com/remix-run/history/blob/main/docs/blocking-transitions.md) 能力监听返回事件，根据一些判断逻辑（例如弹窗挽留用户）决定是否执行路由返回操作。

```jsx title="history 文档上的例子（例子中的 window.confirm 可以替换为自定义弹窗）"
import { history } from '@tarojs/router'

function Index() {
  useEffect(() => {
    // Block navigation and register a callback that
    // fires when a navigation attempt is blocked.
    let unblock = history.block((tx) => {
      // Navigation was blocked! Let's show a confirmation dialog
      // so the user can decide if they actually want to navigate
      // away and discard changes they've made in the current page.
      let url = tx.location.pathname
      if (window.confirm(`Are you sure you want to go to ${url}?`)) {
        // Unblock the navigation.
        unblock()

        // Retry the transition.
        tx.retry()
      }
    })
    return () => unblock()
  }, [])

  return <View />
}
```

## React

使用 React 开发 H5 时需要注意的一些问题。

### fast refresh

React 在 H5 Dev 编译模式时默认开启了 [fast refresh](https://github.com/facebook/react/issues/16604#issuecomment-528663101) 功能。

但是当[使用了自定义环境变量](https://github.com/NervJS/taro/issues/9576)时会出现以下报错：

![](https://storage.360buyimg.com/cjj-pub-images/fast-refresh-error.png)

或配置了 `Webpack devServer` 关闭热更新：`hot: false` 时，会出现以下报错：

:::danger
Uncaught ReferenceError: $RefreshSig$ is not defined
:::

这都是因为在 dev 环境，Taro 默认做了两件事情：

- 使用 `fast-refresh` 的 Babel plugin
- 把 Webpack 配置的 `devServer.hot` 设置为 true，会加入 `fast refresh` 的 loader。

而且 `fast refresh` 的 Babel plugin 和 loader 必须同时启用或关闭。

因此当出现上述报错时，或不希望开启 `fast refresh` 时，可以通过同时配置 Babel 和 Webpack 进行关闭：

```js title="config/index.js" {5}
const config = {
  // ...
  h5: {
    devServer: {
      hot: false,
    },
  },
}
```

```js title="babel.config.js" {5}
module.exports = {
  presets: [
    [
      'taro',
      {
        framework: 'react',
        hot: false,
      },
    ],
  ],
}
```

## 服务端渲染（SSR）

社区 [@SyMind](https://github.com/SyMind) 大佬提供了编译 NextJS 应用的插件 [tarojs-plugin-platform-nextjs](https://github.com/SyMind/tarojs-plugin-platform-nextjs)，用于支持 Web 端支持 SSR 能力，可以根据项目需要自行选择。

## 事件

### \_\_taroNotSupport

> 版本 3.5.6 开始支持该事件

Web 版本中调用不支持的组件或 API 时会触发该事件，可供开发者作统一配置处理。

```ts
interface IEventResult {
  // 组件或 API 名称
  name: string
  // 类型
  type: 'component' | 'method'
  // 状态分类
  category: 'temporarily' | 'weixin_corp' | 'permanently'
  // 组件实例
  instance?
  // API 调用参数
  args?: unknown?[]
}
```

## 组件编译模式

与小程序和 RN 一样，H5 也可以将编译为原生组件

### 使用方法

#### 1. 配置组件路径

修改 `app.config.js`，增加 `components` 配置，指向组件入口文件的路径：

```js title="app.config.js"
export default {
  // ...
  components: ['pages/index/index', 'components/picker/index'],
}
```

#### 2. 开始编译

使用 `taro build native-components` 命令，配合参数 `type`，即可编译出对应平台的自定义组件。

```bash
taro build native-components --type h5 [--watch]
```

### 尺寸转换

组件编译模式同样支持与 Taro 一致的尺寸转换，需要注意的是虽然 css 样式完成了转化，但是部分在代码中的单位转换需要依赖 `pxTransform` 完成。

```diff
- Taro.pxTransform(10)
+ Taro.pxTransform.bind(this)(10)
```

组件模式下，Taro 将尺寸配置关联到组件实例上，在调用相关代码时需要关联相关配置，这一点与正常模式相区别。
</file>

<file path="docs/hooks.md">
---
title: Hooks
---

`Hooks` 是一套全新的 API，可以让你在不编写类，不编写 Class 的情况下使用 `state` 的状态管理，生命周期等功能。

关于 `Hooks` 的概述、动机和规则，我们强烈建议你阅读 React 的官方文档。和其它大部分 React 特性不同，Hooks 没有 RFC 介绍，相反，所有说明都在文档中：

- [Introducing Hooks(简介)](https://zh-hans.reactjs.org/docs/hooks-intro.html)
- [Hooks at a Glance(概览)](https://zh-hans.reactjs.org/docs/hooks-overview.html)
- [Rules of Hooks(规则)](https://zh-hans.reactjs.org/docs/hooks-rules.html)

本篇文档只会介绍在 Taro 中可用的 Hooks API 和部分与 React 不一致的行为，其它内容大体的内容和 [Hooks Reference](https://zh-hans.reactjs.org/docs/hooks-reference.html) 相同。

你还可以参考这两个使用 Hooks 的 Demo：

- [V2EX](https://github.com/NervJS/taro-v2ex-hooks)，主要展示与服务器通信

- [TodoMVC](https://github.com/NervJS/taro-todomvc-hooks)，主要展示组件间通信

## 用法

在 Taro 中使用 Hooks API 很简单，Taro 的专有 Hooks（例如 `usePageScroll`, `useReachBottom`）从 `@tarojs/taro` 中引入，框架自己的 Hooks （例如 `useEffect`, `useState`）从对应的框架引入。

```js
import { usePageScroll, useReachBottom } from '@tarojs/taro' // Taro 专有 Hooks
import { useState, useEffect } from 'react' // 框架 Hooks （基础 Hooks）
// 如果你使用 Nerv 的话
// import { useState, useEffect } from 'nervjs' // 框架 Hooks （基础 Hooks）
```

## Taro Hooks

### useLaunch

:::info
Taro v3.5.0+ 开始支持
:::

等同于 App 入口的 `onLaunch` 生命周期钩子。

```jsx title="示例代码"
useLaunch(() => {
  console.log('onLaunch')
})
```

### useError

:::info
Taro v3.5.0+ 开始支持
:::

等同于 App 入口的 `onError` 生命周期钩子。

```jsx title="示例代码"
useError((error) => {
  console.log(error)
})
```

### usePageNotFound

:::info
Taro v3.5.0+ 开始支持
:::

等同于 App 入口的 `onPageNotFound` 生命周期钩子。

```jsx title="示例代码"
usePageNotFound((res) => {
  Taro.redirectTo({
    url: 'pages/...',
  }) // 如果是 tabbar 页面，请使用 Taro.switchTab
})
```

### useUnhandledRejection

:::info
Taro v3.5.10+ 开始支持
:::

等同于 App 入口的 `onUnhandledRejection` 生命周期钩子。

```jsx title="示例代码"
useUnhandledRejection((res) => {
  console.log(res.reason, res.promise)
})
```

> 注意：**支付宝小程序**需要在源码根目录的 `project.alipay.json` 文件中添加配置 `enableAppxNg: true` 才能在真机环境进行监听。

### useRouter

等同于 Class Component 的 `getCurrentInstance().router`。

```jsx title="示例代码"
// { path: '', params: { ... } }
const router = useRouter()
```

### useLoad

:::info
Taro v3.5.0+ 开始支持
:::

等同于页面的 `onLoad` 生命周期钩子。

```jsx title="示例代码"
useLoad(() => {
  console.log('onLoad')
})
```

### useReady

等同于页面的 `onReady` 生命周期钩子。

从此生命周期开始可以使用 createCanvasContext 或 createSelectorQuery 等 API 访问小程序渲染层的 DOM 节点。

```js title="示例代码"
useReady(() => {
  const query = wx.createSelectorQuery()
})
```

### useDidShow

页面显示/切入前台时触发。等同于 `componentDidShow` 页面生命周期钩子。

```jsx title="示例代码"
useDidShow(() => {
  console.log('componentDidShow')
})
```

### useDidHide

页面隐藏/切入后台时触发。等同于 `componentDidHide` 页面生命周期钩子。

```jsx title="示例代码"
useDidHide(() => {
  console.log('componentDidHide')
})
```

### useUnload

:::info
Taro v3.5.0+ 开始支持
:::

等同于页面的 `onUnload` 生命周期钩子。

```jsx title="示例代码"
useUnload(() => {
  console.log('onUnload')
})
```

### usePullDownRefresh

监听用户下拉动作。等同于 `onPullDownRefresh` 页面生命周期钩子。

```jsx title="示例代码"
usePullDownRefresh(() => {
  console.log('onPullDownRefresh')
})
```

### useReachBottom

监听用户上拉触底事件。等同于 `onReachBottom` 页面生命周期钩子。

```jsx title="示例代码"
useReachBottom(() => {
  console.log('onReachBottom')
})
```

### usePageScroll

监听用户滑动页面事件。等同于 `onPageScroll` 页面生命周期钩子。

```jsx title="示例代码"
usePageScroll((res) => {
  console.log(res.scrollTop)
})
```

### useResize

小程序屏幕旋转时触发。等同于 `onResize` 页面生命周期钩子。

```jsx title="示例代码"
useResize((res) => {
  console.log(res.size.windowWidth)
  console.log(res.size.windowHeight)
})
```

### useShareAppMessage

监听用户点击页面内转发按钮（Button 组件 openType='share'）或右上角菜单“转发”按钮的行为，并自定义转发内容。等同于 `onShareAppMessage` 页面生命周期钩子。

**【Breaking】Taro 3.0.3 开始，使用此 Hook 时必须为页面配置 `enableShareAppMessage: true`。（修改配置文件后请重新编译项目）**

```jsx title="示例代码"
// page.js
function Index() {
  useShareAppMessage((res) => {
    if (res.from === 'button') {
      // 来自页面内转发按钮
      console.log(res.target)
    }
    return {
      title: '自定义转发标题',
      path: '/page/user?id=123',
    }
  })
}
// page.config.js
export default {
  enableShareAppMessage: true,
}
```

### useTabItemTap

点击 tab 时触发。等同于 `onTabItemTap` 页面生命周期钩子。

```jsx title="示例代码"
useTabItemTap((item) => {
  console.log(item.index)
  console.log(item.pagePath)
  console.log(item.text)
})
```

### useAddToFavorites

监听用户点击右上角菜单“收藏”按钮的行为，并自定义收藏内容。等同于 `onAddToFavorites` 页面生命周期钩子。

> Taro 3.0.3 开始支持
> 只有微信小程序支持，本接口为 Beta 版本，安卓 7.0.15 版本起支持，暂只在安卓平台支持

```jsx title="示例代码"
useAddToFavorites((res) => {
  // webview 页面返回 webviewUrl
  console.log('WebviewUrl: ', res.webviewUrl)
  return {
    title: '自定义标题',
    imageUrl: 'https://demo.png',
    query: 'name=xxx&age=xxx',
  }
})
```

### useShareTimeline

监听右上角菜单“分享到朋友圈”按钮的行为，并自定义分享内容。等同于 `onShareTimeline` 页面生命周期钩子。

> Taro 3.0.3 开始支持
> 只有微信小程序支持，基础库 2.11.3 开始支持，本接口为 Beta 版本，暂只在 Android 平台支持

**使用时，必须为页面配置 `enableShareTimeline: true`。（修改配置文件后请重新编译项目）**

```jsx title="示例代码"
// page.js
function Index() {
  useShareTimeline(() => {
    console.log('onShareTimeline')
  })
}
// page.config.js
export default {
  enableShareTimeline: true,
}
```

### useSaveExitState

:::info
Taro v3.5.0+ 开始支持
:::

每当小程序可能被销毁之前，页面回调函数 `onSaveExitState` 会被调用，可以进行[退出状态](https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/operating-mechanism.html#_4-%E9%80%80%E5%87%BA%E7%8A%B6%E6%80%81)的保存。

> 只有微信小程序支持，基础库 2.7.4 开始支持。

```jsx title="示例代码"
useSaveExitState(() => {
  const exitState = { myDataField: 'myData' } // 需要保存的数据
  return {
    data: exitState,
    expireTimeStamp: Date.now() + 24 * 60 * 60 * 1000, // 超时时刻
  }
})
```

### useTitleClick

> 只有支付宝小程序支持。等同于 `onTitleClick` 页面生命周期钩子。

点击标题触发。

```jsx title="示例代码"
useTitleClick(() => console.log('onTitleClick'))
```

### useOptionMenuClick

> 只有支付宝小程序支持。等同于 `onOptionMenuClick` 页面生命周期钩子。

点击导航栏额外图标触发。

```jsx title="示例代码"
useOptionMenuClick(() => console.log('onOptionMenuClick'))
```

### usePullIntercept

> 只有支付宝小程序支持。等同于 `onPullIntercept` 页面生命周期钩子。

下拉截断时触发。

```jsx title="示例代码"
usePullIntercept(() => console.log('onPullIntercept'))
```

## React Hooks

### useState

```js
const [state, setState] = useState(initialState)
```

返回一个 state，以及更新 state 的函数。

在初始渲染期间，返回的状态 (`state`) 与传入的第一个参数 (`initialState`) 值相同。

`setState` 函数用于更新 state。它接收一个新的 state 值并将组件的一次重新渲染加入队列。

```js
setState(newState)
```

在后续的重新渲染中，`useState` 返回的第一个值将始终是更新后最新的 state。

> 注意
>
> Taro 会确保 `setState` 函数的标识是稳定的，并且不会在组件重新渲染时发生变化。这就是为什么可以安全地从 `useEffect` 或 `useCallback` 的依赖列表中省略 `setState`。

#### 函数式更新

如果新的 state 需要通过使用先前的 state 计算得出，那么可以将函数传递给 `setState`。该函数将接收先前的 state，并返回一个更新后的值。下面的计数器组件示例展示了 `setState` 的两种用法：

```js
function Counter({ initialCount }) {
  const [count, setCount] = useState(initialCount)
  return (
    <View>
      Count: {count}
      <Button onClick={() => setCount(initialCount)}>Reset</Button>
      <Button onClick={() => setCount((prevCount) => prevCount + 1)}>+</Button>
      <Button onClick={() => setCount((prevCount) => prevCount - 1)}>-</Button>
    </View>
  )
}
```

“+” 和 “-” 按钮采用函数式形式，因为被更新的 state 需要基于之前的 state。但是“重置”按钮则采用普通形式，因为它总是把 count 设置回初始值。

> 注意
>
> 与 class 组件中的 `setState` 方法不同，`useState` 不会自动合并更新对象。你可以用函数式的 `setState` 结合展开运算符来达到合并更新对象的效果。
>
> ```js
> setState((prevState) => {
>   // 也可以使用 Object.assign
>   return { ...prevState, ...updatedValues }
> })
> ```
>
> `useReducer` 是另一种可选方案，它更适合用于管理包含多个子值的 state 对象。

#### 惰性初始 state

`initialState` 参数只会在组件的初始渲染中起作用，后续渲染时会被忽略。如果初始 state 需要通过复杂计算获得，则可以传入一个函数，在函数中计算并返回初始的 state，此函数只在初始渲染时被调用：

```js
const [state, setState] = useState(() => {
  const initialState = someExpensiveComputation(props)
  return initialState
})
```

### useEffect

```js
useEffect(didUpdate)
```

该 Hook 接收一个包含命令式、且可能有副作用代码的函数。

在函数组件主体内（这里指在 Taro 渲染或创建数据的阶段）改变 DOM、添加订阅、设置定时器、记录日志以及执行其他包含副作用的操作都是不被允许的，因为这可能会产生莫名其妙的 bug 并破坏 UI 的一致性。

使用 `useEffect` 完成副作用操作。赋值给 `useEffect` 的函数会在组件渲染到屏幕之后执行。

默认情况下，effect 将在每轮渲染结束后执行，但你可以选择让它在只有某些值改变的时候才执行。

#### 清除 effect

通常，组件卸载时需要清除 effect 创建的诸如订阅或计时器 ID 等资源。要实现这一点，`useEffect` 函数需返回一个清除函数。以下就是一个创建订阅的例子：

```js
useEffect(() => {
  const subscription = props.source.subscribe()
  return () => {
    // 清除订阅
    subscription.unsubscribe()
  }
})
```

为防止内存泄漏，清除函数会在组件卸载前执行。另外，如果组件多次渲染（通常如此），则**在执行下一个 effect 之前，上一个 effect 就已被清除**。在上述示例中，意味着组件的每一次更新都会创建新的订阅。若想避免每次更新都触发 effect 的执行，请参阅下一小节。

#### effect 的执行时机

与 `componentDidMount`、`componentDidUpdate` 不同的是，Taro 会在 `setData` 完成之后的下一个 [macrotask](https://github.com/ccforward/cc/issues/47) 执行 effect 的回调函数，传给 `useEffect` 的函数会延迟调用。这使得它适用于许多常见的副作用场景，比如如设置订阅和事件处理等情况，因此不应在函数中执行渲染和更新。

然而，并非所有 effect 都可以被延迟执行。例如，在容器执行下一次绘制前，用户可见的 DOM 变更就必须同步执行，这样用户才不会感觉到视觉上的不一致。（概念上类似于被动监听事件和主动监听事件的区别。）Taro 为此提供了一个额外的 [`useLayoutEffect`](#uselayouteffect) Hook 来处理这类 effect。它和 `useEffect` 的结构相同，区别只是调用时机不同。

#### effect 的条件执行

默认情况下，effect 会在每轮组件渲染完成后执行。这样的话，一旦 effect 的依赖发生变化，它就会被重新创建。

然而，在某些场景下这么做可能会矫枉过正。比如，在上一章节的订阅示例中，我们不需要在每次组件更新时都创建新的订阅，而是仅需要在 `source` props 改变时重新创建。

要实现这一点，可以给 `useEffect` 传递第二个参数，它是 effect 所依赖的值数组。更新后的示例如下：

```js
useEffect(() => {
  const subscription = props.source.subscribe()
  return () => {
    subscription.unsubscribe()
  }
}, [props.source])
```

此时，只有当 `props.source` 改变后才会重新创建订阅。

> 注意
>
> 如果你要使用此优化方式，请确保数组中包含了**所有外部作用域中会发生变化且在 effect 中使用的变量**，否则你的代码会引用到先前渲染中的旧变量。
>
> 如果想执行只运行一次的 effect（仅在组件挂载和卸载时执行），可以传递一个空数组（`[]`）作为第二个参数。这就告诉 Taro 你的 effect 不依赖于 props 或 state 中的任何值，所以它永远都不需要重复执行。这并不属于特殊情况 —— 它依然遵循输入数组的工作方式。
>
> 如果你传入了一个空数组（`[]`），effect 内部的 props 和 state 就会一直拥有其初始值。尽管传入 `[]` 作为第二个参数有点类似于 `componentDidMount` 和 `componentWillUnmount` 的思维模式，但我们有 [更好的](https://zh-hans.reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies) [方式](https://zh-hans.reactjs.org/docs/hooks-faq.html#what-can-i-do-if-my-effect-dependencies-change-too-often) 来避免过于频繁的重复调用 effect。除此之外，请记得 Taro 会等待渲染完毕之后才会延迟调用 `useEffect`，因此会使得额外操作很方便。
>
> Taro 会在自带的 ESLint 中配置 [`eslint-plugin-react-hooks`](https://www.npmjs.com/package/eslint-plugin-react-hooks#installation) 中的 [`exhaustive-deps`](https://github.com/facebook/react/issues/14920) 规则。此规则会在添加错误依赖时发出警告并给出修复建议。

### useReducer

```js
const [state, dispatch] = useReducer(reducer, initialArg, init)
```

[`useState`](#usestate) 的替代方案。它接收一个形如 `(state, action) => newState` 的 reducer，并返回当前的 state 以及与其配套的 `dispatch` 方法。（如果你熟悉 Redux 的话，就已经知道它如何工作了。）

在某些场景下，`useReducer` 会比 `useState` 更适用，例如 state 逻辑较复杂且包含多个子值，或者下一个 state 依赖于之前的 state 等。并且，使用 `useReducer` 还能给那些会触发深更新的组件做性能优化，因为[你可以向子组件传递 `dispatch` 而不是回调函数](https://zh-hans.reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down) 。

以下是用 reducer 重写 [`useState`](#usestate) 一节的计数器示例：

```js
const initialState = { count: 0 }

function reducer(state, action) {
  switch (action.type) {
    case 'increment':
      return { count: state.count + 1 }
    case 'decrement':
      return { count: state.count - 1 }
    default:
      throw new Error()
  }
}

function Counter({ initialState }) {
  const [state, dispatch] = useReducer(reducer, initialState)
  return (
    <View>
      Count: {state.count}
      <Button onClick={() => dispatch({ type: 'increment' })}>+</Button>
      <Button onClick={() => dispatch({ type: 'decrement' })}>-</Button>
    </View>
  )
}
```

> 注意
>
> Taro 会确保 `dispatch` 函数的标识是稳定的，并且不会在组件重新渲染时改变。这就是为什么可以安全地从 `useEffect` 或 `useCallback` 的依赖列表中省略 `dispatch`。

#### 指定初始 state

有两种不同初始化 `useReducer` state 的方式，你可以根据使用场景选择其中的一种。将初始 state 作为第二个参数传入 `useReducer` 是最简单的方法：

```jsx
const [state, dispatch] = useReducer(reducer, { count: initialCount })
```

> 注意
>
> Taro 不使用 `state = initialState` 这一由 Redux 推广开来的参数约定。有时候初始值依赖于 props，因此需要在调用 Hook 时指定。如果你特别喜欢上述的参数约定，可以通过调用 `useReducer(reducer, undefined, reducer)` 来模拟 Redux 的行为，但我们不鼓励你这么做。

#### 惰性初始化

你可以选择惰性地创建初始 state。为此，需要将 `init` 函数作为 `useReducer` 的第三个参数传入，这样初始 state 将被设置为 `init(initialArg)`。

这么做可以将用于计算 state 的逻辑提取到 reducer 外部，这也为将来对重置 state 的 action 做处理提供了便利：

```jsx {1-3,11-12,19,24}
function init(initialCount) {
  return { count: initialCount }
}

function reducer(state, action) {
  switch (action.type) {
    case 'increment':
      return { count: state.count + 1 }
    case 'decrement':
      return { count: state.count - 1 }
    case 'reset':
      return init(action.payload)
    default:
      throw new Error()
  }
}

function Counter({ initialCount }) {
  const [state, dispatch] = useReducer(reducer, initialCount, init)
  return (
    <View>
      Count: {state.count}
      <Button onClick={() => dispatch({ type: 'reset', payload: initialCount })}>Reset</Button>
      <Button onClick={() => dispatch({ type: 'increment' })}>+</Button>
      <Button onClick={() => dispatch({ type: 'decrement' })}>-</Button>
    </View>
  )
}
```

### useCallback

```js
const memoizedCallback = useCallback(() => {
  doSomething(a, b)
}, [a, b])
```

返回一个 [memoized](https://en.wikipedia.org/wiki/Memoization) 回调函数。

把内联回调函数及依赖项数组作为参数传入 `useCallback`，它将返回该回调函数的 memoized 版本，该回调函数仅在某个依赖项改变时才会更新。当你把回调函数传递给经过优化的并使用引用相等性去避免非必要渲染（例如 `shouldComponentUpdate`）的子组件时，它将非常有用。

`useCallback(fn, deps)` 相当于 `useMemo(() => fn, deps)`。

### useMemo

```js
const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b])
```

返回一个 [memoized](https://en.wikipedia.org/wiki/Memoization) 值。

把“创建”函数和依赖项数组作为参数传入 `useMemo`，它仅会在某个依赖项改变时才重新计算 memoized 值。这种优化有助于避免在每次渲染时都进行高开销的计算。

记住，传入 `useMemo` 的函数会在渲染期间执行。请不要在这个函数内部执行与渲染无关的操作，诸如副作用这类的操作属于 `useEffect` 的适用范畴，而不是 `useMemo`。

如果没有提供依赖项数组，`useMemo` 在每次渲染时都会计算新的值。

### useRef

```js
const refContainer = useRef(initialValue)
```

`useRef` 返回一个可变的 ref 对象，其 `.current` 属性被初始化为传入的参数（`initialValue`）。返回的 ref 对象在组件的整个生命周期内保持不变。

一个常见的用例便是命令式地访问子组件：

```js
function TextInputWithFocusButton() {
  const inputEl = useRef(null)
  const onButtonClick = () => {
    // `current` 指向已挂载到 DOM 上的文本输入元素
    inputEl.current.focus()
  }
  return (
    <View>
      <Input ref={inputEl} type="text" />
      <Button onClick={onButtonClick}>Focus the input</Button>
    </View>
  )
}
```

本质上，`useRef` 就像是可以在其 `.current` 属性中保存一个可变值的“盒子”。

你应该熟悉 ref 这一种[访问 DOM](ref.mdx) 的主要方式。如果你将 ref 对象以 `<View ref={myRef} />` Taro 都会将 ref 对象的 `.current` 属性设置为相应的 DOM 节点。

然而，`useRef()` 比 `ref` 属性更有用。它可以[很方便地保存任何可变值](https://zh-hans.reactjs.org/docs/hooks-faq.html#is-there-something-like-instance-variables)，其类似于在 class 中使用实例字段的方式。

这是因为它创建的是一个普通 JavaScript 对象。而 `useRef()` 和自建一个 `{current: ...}` 对象的唯一区别是，`useRef` 会在每次渲染时返回同一个 ref 对象。

请记住，当 ref 对象内容发生变化时，`useRef` 并*不会*通知你。变更 `.current` 属性不会引发组件重新渲染。如果想要在 Taro 绑定或解绑 DOM 节点的 ref 时运行某些代码，则需要使用[回调 ref](https://zh-hans.reactjs.org/docs/hooks-faq.html#how-can-i-measure-a-dom-node) 来实现。

### useLayoutEffect

其函数签名与 `useEffect` 相同，但它会在所有的 DOM 变更之后同步调用 effect。可以使用它来读取 DOM 布局并同步触发重渲染。在浏览器执行绘制之前，`useLayoutEffect` 内部的更新计划将被同步刷新。

尽可能使用标准的 `useEffect` 以避免阻塞视觉更新。

> 提示
>
> 如果你正在将代码从 class 组件迁移到使用 Hook 的函数组件，则需要注意 `useLayoutEffect` 与 `componentDidMount`、`componentDidUpdate` 的调用阶段是一样的。但是，我们推荐你**一开始先用 `useEffect`**，只有当它出问题的时再尝试使用 `useLayoutEffect`。

### useContext

```jsx
const value = useContext(MyContext)
```

接收一个 context (`Taro.createContext` 的返回值）并返回该 context 的当前值。当前的 context 值由上层组件中最先渲染的 `<MyContext.Provider value={value}>` 的 `value`决定。

当组件上层最近的 `<MyContext.Provider>` 更新时，该 Hook 会触发重渲染，并使用最新传递给 MyContext provider 的 context `value` 值。

别忘记 `useContext` 的参数必须是 context 对象本身：

正确： `useContext(MyContext)`
错误： `useContext(MyContext.Consumer)`
错误： `useContext(MyContext.Provider)`
调用了 `useContext` 的组件总会在 context 值变化时重新渲染。

> 如果你在接触 Hook 前已经对 context API 比较熟悉，那应该可以理解，`useContext(MyContext)` 相当于 class 组件中的 `static contextType = MyContext` 或者 `<MyContext.Consumer>`。
> `useContext(MyContext)` 只是让你能够读取 context 的值以及订阅 context 的变化。你仍然需要在上层组件树中使用 `<MyContext.Provider>` 来为下层组件提供 context。

## 相关阅读

- [《使用 React Hooks 重构你的小程序》](/blog/2019-07-10-taro-hooks)
</file>

<file path="docs/html.mdx">
---
title: 渲染 HTML
---

> 请注意：本章节所有内容只在小程序端起效果。

Taro 可以直接通过 `Element#innerHTML` 或 Vue 的 `v-html` 或 React/Nerv 的 `dangerouslySetInnerHTML` 直接渲染 HTML:

import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

<Tabs
  defaultValue="React"
  values={[
    {label: 'React', value: 'React'},
    {label: 'Vue', value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx
function helloWorld() {
  const html = `<h1 style="color: red">Wallace is way taller than other reporters.</h1>`

  return <View dangerouslySetInnerHTML={{ __html: html }}></View>
}
```

</TabItem>

<TabItem value="Vue">

```html
<template>
  <view v-html="html"></view>
</template>

<script>
  export default {
    data() {
      return {
        html: `<h1 style="color: red">Wallace is way taller than other reporters.</h1>`,
      }
    },
  }
</script>
```

</TabItem>

</Tabs>

## 自定义 HTML 样式

直接设置 HTML 不会让 HTML 标签带上浏览器的默认样式，Taro 提供两种内置样式我们可以直接引入生效：

- `@tarojs/taro/html.css`: [W3C HTML4 的内置样式](https://www.w3.org/TR/CSS2/sample.html)，只有 HTML4 标签样式，体积较小，兼容性强，能适应大多数情况。
- `@tarojs/taro/html5.css`: [Chrome(Blink) HTML5 的内置样式](https://chromium.googlesource.com/chromium/blink/+/master/Source/core/css/html.css)，内置样式丰富，包括了大多数 HTML5 标签，体积较大，不一定支持所有小程序容器。

为了让内置的标签样式起作用，我们还需要将 HTML 容器的 CSS 类设置为 `.taro_html`:

<Tabs
  defaultValue="React"
  values={[
    {label: 'React', value: 'React'},
    {label: 'Vue', value: 'Vue'},
  ]}>
  <TabItem value="React">

```jsx
if (process.env.TARO_ENV !== 'h5') {
  require('@tarojs/taro/html.css')
}

function helloWorld() {
  const html = `<h1 style="color: red">Wallace is way taller than other reporters.</h1>`

  return <View className="taro_html" dangerouslySetInnerHTML={{ __html: html }}></View>
}
```

  </TabItem>

  <TabItem value="Vue">

```html
<template>
  <view v-html="html" class="taro_html"></view>
</template>

<script>
  if (process.env.TARO_ENV !== 'h5') {
    require('@tarojs/taro/html.css')
  }

  export default {
    data() {
      return {
        html: `<h1 style="color: red">Wallace is way taller than other reporters.</h1>`,
      }
    },
  }
</script>
```

  </TabItem>

</Tabs>

同样地，我们也可以自己编写 CSS 样式，Taro 最终渲染的 HTML 标签的类名都和 HTML 标签名保持一致，例如我们的容器 CSS 类名为 `my_css`，想要设置 `h1` 标签的样式，那就这样这样做：

```css
.my_css .h1 {
  font-size: 30px;
}
```

你可能会倾向于其他浏览器的默认样式：

- [Firefox](https://dxr.mozilla.org/mozilla-central/source/layout/style/res/html.css)
- [Internet Explorer](https://web.archive.org/web/20170122223926/https://www.iecss.com/)
- [Safari/Chrome(Webkit)](https://trac.webkit.org/browser/trunk/Source/WebCore/css/html.css)
- [Opera](https://web.archive.org/web/20161031005401/https://www.iecss.com/opera-10.51.css)
- [W3C HTML5 Spec](https://www.w3.org/TR/html5/rendering.html)
- [normalize.css](https://github.com/necolas/normalize.css/blob/master/normalize.css)

## HTML 转义

由于进行 HTML 转义需要消耗较多的性能和较大的体积，默认而言 Taro 的 HTML 接口只接受转义后的 HTML 字符串，我们推荐直接在服务端返回转义后的 HTML。如果确实需要在客户端转义，开源社区有两个较好的选择：

- [he](https://www.npmjs.com/package/he): 体积较大，但开源协议更为宽松
- [entities](https://www.npmjs.com/package/entities): 体积较小，但开源协议更为严格

你可能会需要[高级选项](#高级选项)的 `transformText` 配合 HTML 转义进行字符串渲染。

## 绑定事件

出于作用域和安全因素考虑，Taro 会把 HTML 字符串中的事件和 JavaScript 全部清除。但我们仍然有办法给 HTML 绑定事件：

<Tabs
  defaultValue="React"
  values={[
    {label: 'React', value: 'React'},
    {label: 'Vue', value: 'Vue'},
  ]}>
  <TabItem value="React">

```jsx
import '@tarojs/taro/html.css'

function helloWorld() {
  const html = `<h1 id="test">Wallace is way taller than other reporters.</h1>`

  useEffect(() => {
    const el = document.getElementById('test')
    function testOnTap (event) {
      // do something
      ...
    }
    el.addEventListener('tap', testOnTap)

    return () => {
      el.removeEventListener('tap', testOnTap)
    }
  }, [])

  return <View className="taro_html" dangerouslySetInnerHTML={{ __html: html }}></View>
}
```

  </TabItem>

  <TabItem value="Vue">

```html
<template>
  <view v-html="html" class="taro_html"></view>
</template>

<script>
  import '@tarojs/taro/html.css'

  export default {
    data () {
      return {
        html: `<h1 id="test">Wallace is way taller than other reporters.</h1>`
      }
    },
    mounted () {
      const el = document.getElementById('test')
      el.addEventListener('tap', this.testOnTap)
    },
    testOnTap (event) {
      // do something
      ...
    },
    beforeDestroy () {
      const el = document.getElementById('test')
      el.removeEventListener('tap', this.testOnTap)
    }
  }
</script>
```

  </TabItem>

</Tabs>

如果需要动态绑定事件的元素没有 ID 的话，你可能需要使用[高级选项](#高级选项)的 `transformElement`。

## 高级选项

如果内置的功能无法满足需求或渲染结果不如预期，Taro 还提供了 HTML 渲染的高级选项，高级选项可以通过 `Taro.options.html` 访问：

```js
import Taro from '@tarojs/taro'

// 不解析 souce 标签中的内容
Taro.options.html.skipElements.add('source')
```

### skipElements

类型：`Set<string>`

默认值：`new Set(['style', 'script'])`

HashSet 中包含的 HTML 标签将不会被解析。

### voidElements

类型：`Set<string>`

默认值：`new Set([
  '!doctype', 'area', 'base', 'br', 'col', 'command',
  'embed', 'hr', 'img', 'input', 'keygen', 'link',
  'meta', 'param', 'source', 'track', 'wbr'
])`

HashSet 中包含的 HTML 标签不需要闭合标签，例如 `<img />`。

### closingElements

类型：`Set<string>`

默认值：`new Set([
  'html', 'head', 'body', 'p', 'dt', 'dd', 'li', 'option',
  'thead', 'th', 'tbody', 'tr', 'td', 'tfoot', 'colgroup'
])`

HashSet 中包含的 HTML 标签可以自动闭合，且不能被嵌套。

### transformText

类型：`(taroText: TaroText, text: Text) => TaroText`

默认值：`void`

该函数第一个参数的值为 Taro 默认处理好的 [TaroText](https://github.com/NervJS/taro/blob/7349f716111accb6a39c72ed0f1e6cbc166fa32b/packages/taro-runtime/src/dom/text.ts#L5)，第二个参数是 HTML 解析器解析好的 [Text](https://github.com/NervJS/taro/blob/7349f716111accb6a39c72ed0f1e6cbc166fa32b/packages/taro-runtime/src/dom/html/parser.ts#L33-L36)，最后返回的 `TaroText` 对象参与 HTML 中的字符串渲染。

### transformElement

类型：`(taroElement: TaroElement, element: Element) => TaroElement`

默认值：`void`

该函数第一个参数的值为 Taro 默认处理好的 [TaroElement](https://github.com/NervJS/taro/blob/7349f716111accb6a39c72ed0f1e6cbc166fa32b/packages/taro-runtime/src/dom/element.ts#L15)，第二个参数是 HTML 解析器解析好的 [Element](https://github.com/NervJS/taro/blob/7349f716111accb6a39c72ed0f1e6cbc166fa32b/packages/taro-runtime/src/dom/html/parser.ts#L38-L43)，最后返回的 `TaroElement` 对象参与 HTML 元素渲染。

```js title="代码示例"
// 给所有 img 标签添加 aotu 类
Taro.options.html.transformElement = (el) => {
  if (el.nodeName === 'image') {
    el.setAttribute('class', 'aotu')
  }
  return el
}
```
</file>

<file path="docs/hybrid.mdx">
---
title: Taro 使用原生模块
---

import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

Taro 支持使用小程序原生的**页面**、**组件**和**插件**。

#### 示例项目：

1. React：https://github.com/NervJS/taro-sample-weapp/tree/next
2. Vue：https://github.com/NervJS/taro-sample-weapp/tree/vue

> 注意：如果在 Taro 项目引用了小程序原生的页面、组件和插件，那么该项目将**不再具备多端转换的能力**。
> 例如，如果使用了微信小程序的原生组件，那么项目只能转换成微信小程序，转义成其他平台会失效，使用其他小程序原生组件同理。

## 使用原生组件

### 使用方法

#### 1. 在 app 或页面配置文件中配置 `usingComponents` 属性。

```js title="page.config.js"
export default {
  usingComponents: {
    // 定义需要引入的第三方组件
    // 1. key 值指定第三方组件名字，以小写开头
    // 2. value 值指定第三方组件 js 文件的相对路径
    'ec-canvas': '../../components/ec-canvas/ec-canvas',
  },
}
```

> 注意：Taro3 的组件是没有配置文件的，因此 usingComponents 必须配置在“页面”的配置文件中。

#### 2. 使用组件

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx
import React, { Component } from 'react'
import { View } from '@tarojs/components'

export default class Index extends Component {
  this.state = {
    ec: {
      onInit: function () {}
    }
  }

  render () {
    return (
      <View>
        <ec-canvas id='mychart-dom-area' canvas-id='mychart-area' ec={this.state.ec} />
      </View>
    )
  }
}
```

</TabItem>

<TabItem value="Vue">

```html
<template>
  <view class="echarts">
    <ec-canvas id="mychart-dom-area" canvas-id="mychart-area" :ec="ec"></ec-canvas>
  </view>
</template>

<script>
  export default {
    data() {
      return {
        ec: {
          onInit: function () {},
        },
      }
    },
  }
</script>
```

</TabItem>
</Tabs>

### 属性绑定

属性名和原生语法保持一致。

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx
<van-button type="primary" loading loading-text="ing">
  Button
</van-button>
```

</TabItem>

<TabItem value="Vue">

```html
<van-button type="primary" :loading="true" loading-text="ing">Button</van-button>
```

</TabItem>
</Tabs>

> 注意：在 Vue 中，如果组件的某些属性带有默认值 `true`，在 Taro 中使用时仍然需要**显式设置为 true**。

### 事件绑定

原生组件派发的事件名称有多种格式，首先开发者要明确原生组件派发的事件名具体是什么。不同的事件名对应不同的模板绑定语法，会影响对应的 React 和 Vue 语法。以下是一些例子：

> 可以看出，小程序原生组件派发的事件名区分大小写，并且支持 `-`。

| 模板绑定语法               | 事件名称 |
| :------------------------- | :------- |
| bindmyevent / bind:myevent | myevent  |
| bindmyEvent / bind:myEvent | myEvent  |
| bindMyEvent / bind:MyEvent | MyEvent  |
| bind:my-event              | my-event |
| bind:my-Event              | my-Event |
| bind:My-Event              | My-Event |

#### React

在 JSX 中事件绑定语法为 `onCamelCase`，它的单一性无法适配小程序原生组件事件名的多样性。

因此 Taro 只能根据开发者 JSX 的事件绑定语法，遵循以下规则生成对应的模板绑定语法（在区分原生组件派发的事件名大小写的情况下，需要使用一个 `bind` 属性进行 hack 处理）：

| JSX 事件绑定语法                    | 模板绑定语法  | 事件名称 |
| :---------------------------------- | :------------ | :------- |
| `<Comp onMyevent={} />`             | bindmyevent   | myevent  |
| `<Comp onMyEvent={} bindmyEvent />` | bindmyEvent   | myEvent  |
| `<Comp onMyEvent={} bindMyEvent />` | bindMyEvent   | MyEvent  |
| `<Comp onMyEvent={} />`             | bind:my-event | my-event |
| -                                   | -             | my-Event |
| -                                   | -             | My-Event |

#### Vue

**Vue** 绑定事件时虽然支持 `-`，但对大小写不敏感。因此针对不同的事件名需要编写不同的 Vue Template 语法，大小写敏感时同样也需要使用 `bind` 属性进行 hack 处理：

| Vue Template 语法                  | 模板绑定语法  | 事件名称 |
| :--------------------------------- | :------------ | :------- |
| `<comp @myevent='' />`             | bindmyevent   | myevent  |
| `<comp @myevent='' bindmyEvent />` | bindmyEvent   | myEvent  |
| `<comp @myevent='' bindMyEvent />` | bindMyEvent   | MyEvent  |
| `<comp @my-event='' />`            | bind:my-event | my-event |
| -                                  | -             | my-Event |
| -                                  | -             | My-Event |

#### 例子

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx
// 对应 bind:click 事件
<van-button type='primary' onClick={this.handleClick} >Button</van-button>
// 对应 bind:after-read 事件
<van-uploader fileList={[]} onAfterRead={this.onAfterRead} />
```

</TabItem>

<TabItem value="Vue">

```html
<!-- 对应 bind:click 事件 -->
<van-button type="primary" @click="handleClick">Button</van-button>
<!-- 对应 bind:after-read 事件 -->
<van-uploader :fileList="[]" @after-read="onAfterRead" />
```

</TabItem>
</Tabs>

### 使用 Slot

**React** 中使用 `<Slot>` 组件实现。

**Vue** 中使用 `<slot-view>` 组件实现。

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx
import React, { Component } from 'react'
import { View, Slot } from '@tarojs/components'

export default class Index extends Component {
  render() {
    return (
      <View>
        <van-calendar poppable show>
          <Slot name="title">
            <View>Hello world</View>
          </Slot>
        </van-calendar>
      </View>
    )
  }
}
```

</TabItem>

<TabItem value="Vue">

```html
<template>
  <view>
    <van-calendar :poppable="true" :show="true">
      <slot-view :name='"title"'>
        <view>Hello world</view>
      </slot-view>
    </van-calendar>
  </view>
</template>

<script>
  export default {
    name: 'index',
  }
</script>
```

</TabItem>
</Tabs>

### selectComponent

可以使用小程序页面实例的 `selectComponent` API 获取第三方原生组件的实例。

```js
import { getCurrentInstance } from '@tarojs/taro'

const { page } = getCurrentInstance()
page.selectComponent('#mychart-dom-area')
```

### 使用 vant-weapp

[详细文档](./vant)

### 常见问题

#### 1. Vue3 出现 warning: "[Vue warn]: Failed to resolve component"

![](http://storage.360buyimg.com/cjj-pub-images/vue3-warn-native.png)

原因是 Vue 把它当做 Vue 组件来解析，我们可以修改 VueLoader 的编译配置 `compilerOptions.isCustomElement`，把此组件声明为原生组件。

- **Taro v3.4 之前**的版本需要通过 WebpackChain 去修改（请参考 [#10838](https://github.com/NervJS/taro/issues/10838#issuecomment-988448778)）
- **Taro v3.4 之后**可以通过配置 [Taro Vue3 插件](./vue3#compileroptions) 的选项去修改。
- 传递函数类型的属性失败：[React 写法](https://github.com/NervJS/taro/issues/8495#issuecomment-1179526364)、[Vue3 写法](https://github.com/NervJS/taro/issues/10337#issuecomment-989834523)

## 使用原生页面

只需要在 app 配置中，设置好原生页面的路由即可。

```js title="app.config.js"
export default {
  pages: ['pages/native/native'],
}
```

## 使用小程序插件

### 引入插件

使用插件前，使用者要在 `app.confg.js` 的配置中声明需要使用的插件，例如

```js title="app.config.js"
export default {
  plugins: {
    myPlugin: {
      version: '1.0.0',
      provider: 'wxidxxxxxxxxxxxxxxxx',
    },
  },
}
```

如上例所示， `plugins` 定义段中可以包含多个插件声明，每个插件声明以一个使用者自定义的插件引用名作为标识，并指明插件的 `appid` 和需要使用的版本号。其中，引用名（如上例中的 myPlugin）由使用者自定义，无需和插件开发者保持一致或与开发者协调。在后续的插件使用中，该引用名将被用于表示该插件。

### 使用插件组件

#### 配置使用

在页面的配置文件中定义需要引入的插件组件，使用 `plugin://` 协议指明插件的引用名和自定义组件名，例如：

```js title="page.config.js"
export default {
  // 定义需要引入的插件
  usingComponents: {
    'hello-component': 'plugin://myPlugin/hello-component',
  },
}
```

#### 组件写法

和使用原生组件一致，请参考 [《使用原生组件》](./hybrid#使用原生组件)。

#### 限制

出于对插件的保护，插件提供的自定义组件在使用上有一定的限制：

- 默认情况下，页面中的 `this.$scope.selectComponent` 接口无法获得插件的自定义组件实例对象；
- `Taro.createSelectorQuery` 等接口的 `>>>` 选择器无法选入插件内部。

### 使用插件页面

插件的页面从小程序基础库版本 2.1.0 开始支持。

需要跳转到插件页面时，url 使用 `plugin://` 前缀，形如 `plugin://PLUGIN_NAME//PLUGIN_PAGE`， 如：

```jsx
<Navigator url="plugin://myPlugin/hello-page">Go to pages/hello-page!</Navigator>
```

### 使用 js 接口

使用插件的 `js` 接口时，可以使用 `Taro.requirePlugin` 方法。例如，插件提供一个名为 `hello` 的方法和一个名为 `world` 的变量，则可以像下面这样调用：

```js
import { requirePlugin } from '@tarojs/taro'

const myPluginInterface = requirePlugin('myPlugin')
const myWorld = myPluginInterface.world

myPluginInterface.hello()
```
</file>

<file path="docs/implement-note.md">
---
title: 实现细节
---

本文会介绍 Taro 的部分实现细节，带动开发者了解 Taro 相关依赖包的具体功能，让开发者对更好地了解 Taro 这个项目。

:::note
不定期更新。
:::

## CLI

`@tarojs/cli` 是 Taro CLI 工具，它基于 `@tarojs/service` 包的插件化内核实现。

CLI 里预先挂载了一系列的内置插件，每个命令、每个编译平台都是一个单独的 Taro 插件。

## 小程序

### 编译时

编译小程序时，CLI 会调用 `@tarojs/mini-runner` 包。`mini-runner` 主要做了这些事情：

1. 负责根据开发者的[编译配置](./config)调整 Webpack 配置。
2. 注入自定义的 PostCSS 插件。（如 `postcss-pxtransform`）
3. 注入自定义的 Webpack 插件。
4. 注入自定义的 Webpack Loaders。（Loaders 位于 `@tarojs/taro-loader` 包中）
5. 调用 Webpack 开启编译。
6. 修改 Webpack 的编译产物，调整最终的编译结果。

### 运行时

为了让 React、Vue 等框架直接运行在小程序端，我们需要在小程序的逻辑层**模拟浏览器环境**，包括实现 DOM、BOM API 等。

`@tarojs/runtime` 是 Taro 的运行时适配器核心，它实现了精简的 [DOM、BOM API](taro-dom)、事件系统、Web 框架和小程序框架的桥接层等。

> 因为 ReactDOM 体积较大，且包含很多兼容性代码。因此 Taro 借助 react-reconciler 实现了一个自定义渲染器用于代替 ReactDOM。渲染器位于 `@tarojs/react` 包中。

这时 Web 框架就可以使用 Taro 模拟的 API 渲染出一颗 Taro DOM 树，但是**这一切都运行在小程序的逻辑层**。而小程序的 xml 模板需要提前写死，Taro 如何使用一个静态的模板文件去渲染这颗动态的 Taro DOM 树呢？

Taro 选择了利用小程序 `<template>` 可以引用其它 `<template>` 的特性，把 Taro DOM 树的每个 DOM 节点对应地渲染为一个个 `<template>`。这时只需要把 Taro DOM 树的序列化数据进行 `setData`，就能触发 `<template>` 的相互引用，从而渲染出最终的 UI。

> 项目的 `dist/base.xml` 文件就是这些 `<template>` 的集合。

### 端平台插件

Taro 内部默认支持 6 大小程序平台，自 [Taro v3.1](/blog/2021-03-10-taro-3-1-lts#1-开放式架构) 版本之后，对各小程序平台的支持都以 Taro 插件的形式进行：

- `@tarojs/plugin-platform-weapp` 微信小程序插件
- `@tarojs/plugin-platform-alipay` 支付宝小程序插件
- `@tarojs/plugin-platform-swan` 百度小程序插件
- `@tarojs/plugin-platform-tt` 抖音小程序插件
- `@tarojs/plugin-platform-qq` qq 小程序插件
- `@tarojs/plugin-platform-jd` 京东小程序插件

端平台插件针对特定的平台，会分别为编译时和运行时注入逻辑，详情请见 [《端平台插件概述》](./platform-plugin/)。

## H5

### 编译时

编译 H5 时，CLI 会调用 `@tarojs/webpack-runner` 包。`webpack-runner` 主要做了这些事情：

1. 负责根据开发者的[编译配置](./config)调整 Webpack 配置。
2. 注入自定义的 PostCSS 插件。（如 `postcss-pxtransform`、`postcss-plugin-constparse`）
3. 注入自定义的 Webpack 插件。
4. 注入自定义的 Webpack Loaders。（Loaders 位于 `@tarojs/taro-loader` 包中）
5. 调用 Webpack 开启编译。
6. 修改 Webpack 的编译产物，调整最终的编译结果。

### 组件库

Taro 在 H5 端实现了遵循微信小程序规范的基础组件库。

默认会使用 `@tarojs/components` 提供的 Web Components 组件库。

开发者使用 React 开发时，也可以选用[兼容性组件库](./h5#react-兼容性组件库)，这时 `@tarojs/components-react` 将会代替 `@tarojs/components`。

### API

开发者从 `@tarojs/taro` 中引用 Taro 对象并使用它提供的 API。

在 H5 环境，`@tarojs/taro` 会从 `@tarojs/api` 取与平台无关的 API，从 `@tarojs/taro-h5` 中取遵循小程序规范实现的 API，最终集合成一个 Taro 对象暴露给开发者。

> 开发者一般会以 `Taro.xxx` 这种形式调用 API。`babel-plugin-transform-taroapi` 插件会把这种写法转换为 `import { xxx } from '@tarojs/taro';` 再进行调用，这样才能保证 Tree Shaking 生效。

### 路由

`@tarojs/router` 实现了遵循小程序规范的路由库。

### 端平台插件

自 `v3.6.0` 起，我们把对 Web 端平台的兼容逻辑抽取了出来，以 Taro 插件的形式支持，同时开发者也可以基于 `@tarojs/plugin-platform-h5` 自行拓展 Web 端编译平台支持。

端平台插件针对特定的平台，会分别为编译时和运行时注入逻辑，详情请见 [《端平台插件概述》](./platform-plugin/)。

## Typings

Taro 的 Typings 文件位于 `@tarojs/taro/types` 中。

因为各小程序的 API 更新较快，Typings 十分需要社区协助维护。

## 反向转换

反向转换，即原生微信小程序转换为 Taro 的功能，目前支持转换为 React。

反向转换分为编译时和运行时两大模块，分别位于 `@tarojs/taroize` 和 `@tarojs/with-weapp`。

## 相关阅读

- [如何参与大型开源项目-Taro 共建](/blog/2022-01-19-how-to-join-Taro)
</file>

<file path="docs/independent-subpackage.md">
---
title: 微信小程序独立分包
---

Taro 支持使用微信小程序的独立分包功能，配置方法和微信小程序中一致，请参考[《微信小程序独立分包文档》](https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/independent.html)。

## 示例

- [weapp-independent-subpackages](https://github.com/NervJS/taro/tree/next/examples/weapp-independent-subpackages)

## 配置方法

假设小程序目录结构如下：

    ├── config
    ├── src
    |   ├── pages
    |   |   └── index
    |   ├── moduleA
    |   |   └── pages
    |   |       ├── rabbit
    |   |       └── squirrel
    |   ├── moduleB
    |   |   └── pages
    |   |       ├── pear
    |   |       └── pineapple
    |   ├── app.css
    |   ├── app.json
    |   └── app.js
    └── package.json

开发者通过在 `app.json` 的 `subpackages` 字段中，给对应的分包配置项中定义的 `independent` 字段声明对应分包为独立分包：

```js title="app.json" {18}
{
  "pages": [
    "pages/index"
  ],
  "subpackages": [
    {
      "root": "moduleA",
      "pages": [
        "pages/rabbit",
        "pages/squirrel"
      ]
    }, {
      "root": "moduleB",
      "pages": [
        "pages/pear",
        "pages/pineapple"
      ],
      "independent": true
    }
  ]
}
```
</file>

<file path="docs/join-in.md">
---
title: 给开发者的信
---

> 2019.10.29

[Taro](https://taro.jd.com) 作为一个多端统一开发解决方案，自诞生以来一直保持着高速的发展态势， 从一个单一的开发框架发展到如今服务数万名开发者的多端解决方案，Taro 的成长有 Taro 团队不忘初心的努力，但更重要的是，离不开社区广大开发者的支持和帮助。

## 开源面临着什么

我们可以先来看一组数据。

Taro 从开源到当前行文为止，总共有 **5227** 次 commits，发布了 **235** 个版本，同时有 **3908** 个 issues 被开启，在 Taro 团队和社区的努力下，已经关闭了 **3296** 个，还有近 **600** 个 issues 有待解决，而每周 Taro 的新开启的 issues 也在 **50** 个左右；同时也收获了 **709** 个 PR，合入了 **656** 个。

除此之外，[Taro 交流社区](https://taro-club.jd.com/) 发帖数也达到 **3000** 个，每周以 **200** 个左右的增速在增加，而 [Taro 官方文档](/docs) 作为 Taro 入门及开发必备的资源，每周的访问量达到了 **20w**。

同时 Taro 还有 **20 余** 个 **500** 人左右的开发者交流微信群，以及 10 余个跟各小程序官方团队、各大公司研发团队的研讨群，每天 Taro 团队的开发人员都要遭受大规模的信息轰炸。

由此可见，Taro 目前拥有庞大且活跃的开发者社区，每天都会产生大量的信息，或是问题，或是建议，或是代码提交，或是有用的轮子。当社区变得越来越大后，如何进行有效的管理，提升社区整体的使用体验，便成了困扰 Taro 团队的问题，迫切需要在方案迭代与社区维护之间寻找到一个平衡点，以使 Taro 可以走得更远，发展得更好。

## 来自社区的力量

正所谓「单丝不成线，独木不成林」。

Taro 发展至今早已不在属于单一团队的项目了，而是整个 Taro 开发社区共同的项目。在 Taro 所属的 NervJS 组织的[成员](https://github.com/orgs/NervJS/people)中也已经加入了像华为、腾讯等其他公司的研发人员，共同建设项目，而整个社区的贡献者也达到了 **230** 位。

![WX20191010-150217@2x.png](https://img10.360buyimg.com/ling/jfs/t1/51716/38/13586/794849/5da564c9Ef215f164/cd2069db4f105db4.jpg)

而在所有的社区贡献中，需要特别感谢：

- [Tom Huang](https://github.com/nanjingboy/) ，独立为 Taro 开发所有端的 MobX 支持
- [jsNewbee](https://github.com/js-newbee/)，为 Taro 贡献了一个完整支持 小程序 + H5 + React Native 的[多端样例](https://github.com/qit-team/taro-yanxuan)
- [Chunlin](https://github.com/Qiyu8/)，来自华为，为 Taro 完善了快应用的转换支持

同时也感谢受邀成为 [TaroUI](https://github.com/NervJS/taro-ui) 核心维护人员的 [Garfield550](https://github.com/Garfield550) (小姐姐)、[梁音](https://github.com/yinLiangDream)、[ShaoQian Liu](https://github.com/lsqy)，他们将支撑起 TaroUI 的后续迭代与维护。

当然还有在社区中乐于助人、积极贡献的 [zacksleo](https://github.com/zacksleo) 、[Jay Fong](https://github.com/fjc0k)、[loveonelong](https://github.com/loveonelong)、[lolipop99](https://github.com/lolipop99)、[波仔糕](https://github.com/bozaigao)、[原罪](https://github.com/fwh1990)、[lentoo](https://github.com/lentoo/) 、[白领夏公子](https://taro-club.jd.com/user/%E7%99%BD%E9%A2%86%E5%A4%8F%E5%85%AC%E5%AD%90) 、YuanQuan、 tourze、 lingxiaoZhu 等等。

此外，还要感谢一直默默为 Taro 发展提供宝贵建议的研发团队：腾讯云、数字广东、腾讯 CDC、网易严选、华为开源团队、招联消费金融等等

社区的力量一直在支撑 Taro 前进。

所以，如今 Taro 面临的社区维护问题我们希望可以交给社区来进行自我管理。

## 期待你的加入

为了能够让社区更加高效、健康的运转下去，Taro 官方团队希望能够从社区中吸引开发者来共同维护，进行社区共建。

社区共建本次拟开放三大类角色，Taro 团队会为每一类角色设定一定门槛以及激励机制，从而保证整体质量。

### 能力完善

| 头衔       | 准入机制                                                                      | 权益                                                                                                            |
| ---------- | ----------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------- |
| 认证开发者 | 1. 为 Taro 实现过独立功能特性 <br/> 2. 代码 commit 数及代码贡献量达到一定标准 | 1. 获取 Taro 项目 developer 权限 <br/> 2. 来自 Taro 团队定期礼品与开源认证证书 <br/> 3. Readme 及官网、文档展示 |
| 代码贡献者 | 为 Taro 提交过 PR                                                             | Readme 及官网、文档展示                                                                                         |

### 社区管理

| 头衔                 | 准入机制                                                                                      | 权益                                                                                                                                                    | 职责                                                                                                                                                                                   |
| -------------------- | --------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 社区版主             | 1. 通过社区报名，遴选后产生 <br/> 2. 通过考察在 Taro 社区的活跃程度，由 Taro 团队进行定向邀请 | 1. Readme 及官网、文档展示 <br/> 2. 所提出特性会优先考虑在 Taro 版本中加入 <br/>3. 来自 Taro 团队定期礼品与开源认证证书                                 | 1. 负责社区各版块的管理<br/>2. 定期发布版块相关主题帖 <br/> 3. 定期收集版块问题帖子，进行汇总，反馈给 Taro 团队 <br/> 4. 对版块内帖子进行审核，剔除无用、违反法律等帖子                |
| GitHub Issues 管理员 | 1. 通过社区报名，遴选后产生 <br/> 2. 通过考察在 Taro 社区的活跃程度，由 Taro 团队进行定向邀请 | 1. Readme 及官网、文档展示 <br/> 2. 所提出特性会优先考虑在 Taro 版本中加入 <br/>3. 来自 Taro 团队定期礼品与开源认证证书 <br/> 4. 参与 GitHub robot 完善 | 1. 负责对 GitHub issues 答疑解惑以及打标分类 <br/> 2. 负责每周汇总 issues，并将 issues 提交到 Taro 团队 <br/>3. 负责每周精选 issues，并将数据同步到 Taro 社区                          |
| 交流群管理员         | 1. 通过社区报名，遴选后产生 <br/> 2. 通过考察在 Taro 社区的活跃程度，由 Taro 团队进行定向邀请 | 1. Readme 及官网、文档展示 <br/> 2. 所提出特性会优先考虑在 Taro 版本中加入 <br/>3. 来自 Taro 团队定期礼品与开源认证证书 <br/>4. 参与 群小助手 完善      | 1. 负责群内内容的管理，创造良好的沟通交流环境 <br/> 2. 负责群内问题的答疑解惑，引导开发者去社区、GitHub issues 获取答案 <br/>3. 负责操作社区群管理工具，整理群内问题，同步到 Taro 社区 |

### 知识构建

| 形式                  | 提交方式                                                                                                                                                                                          | 权益                                                                                  |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------- |
| Taro 课程视频录制     | 通过邮箱发送个人信息及试讲视频<br/>邮箱：taro@jd.com<br/>内容：<br/>1. 个人信息：主攻技术方向、从业经历、公开分享经验等 <br/>2. 试讲视频链接通过遴选后，Taro 团队会与你联系沟通后续的视频录制事宜 | 成为 Taro 官方合作伙伴，视频课程经由 Taro 团队审核后，Taro 团队会全力协助进行运营推广 |
| Taro 开发实践文章撰写 | 通过邮箱投稿<br/>邮箱：taro@jd.com<br/>内容：<br/>1. md 文件（若为系列文章请添加大纲） <br/>2. 是否在 Taro 渠道首发通过遴选后，Taro 团队会与你联系沟通后续发布事宜                                | 成为 Taro 官方合作伙伴，文章经由 Taro 团队审核后，会通过 Taro 相关优质渠道进行发布    |

## 写在最后

Taro 作为一个多端开发解决方案，还处在初级的发展阶段，是一个发展中的方案，在不久的未来我们会有更多新的功能、特性推向开发者，甚至可能也有颠覆性的东西出现，让 Taro 成为一个更棒的方案。目前 Taro 已经翻过了一座座发展的山峰，但他正在向更高山峰迈进。

长风破浪会有时，直挂云帆济沧海。

## Taro 诚邀你的加入

联系邮箱：[taro@jd.com](mailto:taro@jd.com)
邮件标题：【共建】+ 你想说的话
</file>

<file path="docs/jquery-like.md">
---
title: jQuery-like API
---

Taro 目前官方支持使用 React 或 Vue 构建视图，它们都是数据驱动的声明式渲染方式。

但在少数情况下，我们需要显式地操纵 DOM，而小程序提供的 `createQuerySelector` API 的用法又较为复杂难懂。在这样的情况下，我们提供了类似 jQuery 的系列 API。使用这个系列 API 很简单，只需要通过 NPM 安装依赖：

```bash
npm i @tarojs/extend
```

然后再需要使用文件引入 `$` 即可：

```js
import { $ } from '@tarojs/extend'
```

:::info 了解更多
你还可以通过访问 [jQuery-like API RFC](https://github.com/NervJS/taro-rfcs/pull/1) 了解更多实现 jQuery-like API 背后的原因与设计。
:::

## 核心方法

### $()

- `$(selector, [context])   ⇒ collection`
- `$(<collection>)   ⇒ same collection`
- `$(<DOM nodes>)   ⇒ collection`
- `$(htmlString)   ⇒ collection`
- `$(htmlString, attributes)   ⇒ collection`

通过执行 CSS 选择器，包装 DOM 节点，或者通过一个 HTML 字符串创建多个元素 来创建一个集合对象。

`collection` 是一个类似数组的对象，它具有链式方法来操作它指向的 DOM 节点，除了 `$()` 对象上的直接方法外(如`$.extend`)，文档对象中的所有方法都是集合方法。

如果选择器中存在 content 参数(css 选择器，dom，或者集合对象)，那么只在所给的节点背景下进行 css 选择器；这个功能和使用 `$(context).find(selector)` 是一样的。

```js
$('view') //=> 所有页面中得p元素
$('#foo') //=> ID 为 "foo" 的元素

// 创建元素:
$('<text>Hello</text>') //=> 新的text元素
// 创建带有属性的元素:
$('<text />', { text: 'Hello', id: 'greeting', css: { color: 'darkblue' } })
//=> <text id=greeting style="color:darkblue">Hello</p>
```

:::caution 请注意
此不支持 [jQuery CSS 扩展](https://www.html.cn/jqapi-1.9/category/selectors/jquery-selector-extensions/)， 然而，可选的“selector”模块有限提供了支持几个最常用的伪选择器，而且可以被丢弃，与现有的代码或插件的兼容执行。
:::

:::caution 请注意
和 React 或 Vue 不一样的是，在 Taro 的 `jQuery-like API` 中可以使用像 `div` 这样的 HTML 元素，但使用小程序规范的组件（例如 `view`）在 Taro 应用中运行会更顺畅。但在接下来的的案例中可能会出现 HTML 元素，仅代表使用方法，不代表实际可用。
:::

### $.fn

$.fn 是一个对象，它拥有 jQuery 对象上所有可用的方法，如 `addClass()`， `attr()`，和其它方法。在这个对象添加一个方法，所有的 jQuery 对象上都能用到该方法。

这里有一个实现 jQuery 的 `empty()` 方法的例子：

```js
$.fn.empty = function () {
  return this.each(function () {
    this.innerHTML = ''
  })
}
```

### addClass

- `addClass(name)   ⇒ self`
- `addClass(function(index, oldClassName){ ... })   ⇒ self`

为每个匹配的元素添加指定的 class 类名。多个 class 类名使用空格分隔。

### after

- `after(content)   ⇒ self`

在每个匹配的元素后插入内容（注：外部插入）。内容可以为 html 字符串，dom 节点，或者节点组成的数组。

```js
$('form label').after('<p>A note below the label</p>')
```

### append

- `append(content)   ⇒ self`

在每个匹配的元素末尾插入内容（注：内部插入）。内容可以为 html 字符串，dom 节点，或者节点组成的数组。

```js
$('ul').append('<li>new list item</li>')
```

### attr

- `attr(name)   ⇒ string`
- `attr(name, value)   ⇒ self`
- `attr(name, function(index, oldValue){ ... })   ⇒ self`
- `attr({ name: value, name2: value2, ... })   ⇒ self`

读取或设置 dom 的属性。如果没有给定 value 参数，则读取对象集合中第一个元素的属性值。当给定了 value 参数。则设置对象集合中所有元素的该属性的值。当 value 参数为`null`，那么这个属性将被移除(类似`removeAttr`)，多个属性可以通过对象键值对的方式进行设置。

要读取 DOM 的属性如 `checked`和`selected`, 使用 `prop`。

```js
var form = $('form')
form.attr('action') //=> 读取值
form.attr('action', '/create') //=> 设置值
form.attr('action', null) //=> 移除属性

// 多个属性:
form.attr({
  action: '/create',
  method: 'post',
})
```

### before

- `before(content)   ⇒ self`

在匹配每个元素的前面插入内容（注：外部插入）。内容可以为 html 字符串，dom 节点，或者节点组成的数组。

```js
$('table').before('<p>See the following table:</p>')
```

### children

- `children([selector])   ⇒ collection`

获得每个匹配元素集合元素的直接子元素，如果给定 selector，那么返回的结果中只包含符合 css 选择器的元素。

```js
$('ol').children('*:nth-child(2n)')
//=> every other list item from every ordered list
```

### clone (`3.0.0-rc.6`)

- `clone()   ⇒ collection`

通过深度克隆来复制集合中的所有元素。

### closest

- `closest(selector, [context])   ⇒ collection`
- `closest(collection)   ⇒ collection`
- `closest(element)   ⇒ collection`

从元素本身开始，逐级向上级元素匹配，并返回最先匹配 selector 的元素。如果给定 context 节点参数，那么只匹配该节点的后代元素。这个方法与 `parents(selector)`有点相像，但它只返回最先匹配的祖先元素。

如果参数是一个 jQuery 对象集合或者一个元素，结果必须匹配给定的元素而不是选择器。

```js
var input = $('input[type=text]')
input.closest('form')
```

### contents

- `contents()   ⇒ collection`

获得每个匹配元素集合元素的子元素，包括文字和注释节点。（注：`.contents()`和`.children()`方法类似，只不过前者包括文本节点以及 jQuery 对象中产生的 HTML 元素。）

### css

- `css(property)   ⇒ value`
- `css([property1, property2, ...])   ⇒ object`
- `css(property, value)   ⇒ self`
- `css({ property: value, property2: value2, ... })   ⇒ self`

读取或设置 DOM 元素的 css 属性。当 value 参数不存在的时候，返回对象集合中第一个元素的 css 属性。当 value 参数存在时，设置对象集合中每一个元素的对应 css 属性。

多个属性可以通过传递一个属性名组成的数组一次性获取。多个属性可以利用对象键值对的方式进行设置。

当 value 为空(空字符串，null 或 undefined)，那个 css 属性将会被移出。当 value 参数为一个无单位的数字，如果该 css 属性需要单位，“px”将会自动添加到该属性上。

```js
var elem = $('h1')
elem.css('background-color') // read property
elem.css('background-color', '#369') // set property
elem.css('background-color', '') // remove property

// set multiple properties:
elem.css({ backgroundColor: '#8EE', fontSize: 28 })

// read multiple properties:
elem.css(['backgroundColor', 'fontSize'])['fontSize']
```

### data

- `data(name)   ⇒ value`
- `data(name, value)   ⇒ self`

读取或写入 dom 的 `data-*` 属性。行为有点像 attr ，但是属性名称前面加上 data-。

当读取属性值时，会有下列转换:

- “true”, “false”, and “null” 被转换为相应的类型；
- 数字值转换为实际的数字类型；
- JSON 值将会被解析，如果它是有效的 JSON；
- 其它的一切作为字符串返回。

### each

- `each(function(index, item){ ... })   ⇒ self`

遍历一个对象集合每个元素。在迭代函数中，`this`关键字指向当前项(作为函数的第二个参数传递)。如果迭代函数返回 `false`，遍历结束。

```js
$('form input').each(function (index) {
  console.log('input %d is: %o', index, this)
})
```

### empty

- `empty()   ⇒ self`

清空对象集合中每个元素的 DOM 内容。

### eq

- `eq(index)   ⇒ collection`

从当前对象集合中获取给定索引值（注：以 0 为基数）的元素。

```js
$('li').eq(0) //=> only the first list item
$('li').eq(-1) //=> only the last list item
```

### filter

- `filter(selector)   ⇒ collection`
- `filter(function(index){ ... })   ⇒ collection`

过滤对象集合，返回对象集合中满足 css 选择器的项。如果参数为一个函数，函数返回有实际值得时候，元素才会被返回。在函数中， this 关键字指向当前的元素。

### find

- `find(selector)   ⇒ collection`
- `find(collection)   ⇒ collection v1.0+`
- `find(element)   ⇒ collection v1.0+`

在当对象前集合内查找符合 CSS 选择器的每个元素的后代元素。

如果给定 Zepto 对象集合或者元素，过滤它们，只有当它们在当前 Zepto 集合对象中时，才回被返回。

```js
var form = $('#myform')
form.find('input, select')
```

### first

- `first()   ⇒ collection`

获取当前对象集合中的第一个元素。

```js
$('form').first()
```

### forEach

- `forEach(function(item, index, array){ ... }, [context])`

遍历对象集合中每个元素，有点类似 each，但是遍历函数的参数不一样，当函数返回 `false` 的时候，遍历不会停止。

### get

- `get()   ⇒ array`
- `get(index)   ⇒ DOM node`

从当前对象集合中获取所有元素或单个元素。当 index 参数不存在的时，以普通数组的方式返回所有的元素。当指定 index 时，只返回该置的元素。这点与`eq`不同，该方法返回的是 DOM 节点，不是 Zepto 对象集合。

```js
var elements = $('h2')
elements.get() //=> get all headings as an array
elements.get(0) //=> get first heading node
```

### has

- `has(selector)   ⇒ collection`
- `has(node)   ⇒ collection`

判断当前对象集合的子元素是否有符合选择器的元素，或者是否包含指定的 DOM 节点，如果有，则返回新的对象集合，该对象过滤掉不含有选择器匹配元素或者不含有指定 DOM 节点的对象。

```js
$('ol > li').has('a[href]')
//=> get only LI elements that contain links
```

### hasClass

- `hasClass(name)   ⇒ boolean`

检查对象集合中是否有元素含有指定的 class。

```js
$('li').hasClass('test')
```

### height

- `height()   ⇒ Promise<number>`
- `height(value)   ⇒ self`
- `height(function(index, oldHeight){ ... })   ⇒ self`

获取对象集合中第一个元素的高度；或者设置对象集合中所有元素的高度。

```js
const height = await $('#foo').height() // => 123
```

:::caution 请注意
`height()` 返回的 `Promise` 对象。
:::

### hide

- `hide()   ⇒ self`

通过设置 css 的属性 `display` 为 `none` 来将对象集合中的元素隐藏。

### html

- `html()   ⇒ string`
- `html(content)   ⇒ self`
- `html(function(index, oldHtml){ ... })   ⇒ self`

获取或设置对象集合中元素的 HTML 内容。当没有给定 content 参数时，返回对象集合中第一个元素的 innerHtml。当给定 content 参数时，用其替换对象集合中每个元素的内容。content 可以是 append 中描述的所有类型。

```js
// autolink everything that looks like a Twitter username
$('.comment p').html(function (idx, oldHtml) {
  return oldHtml.replace(/(^|\W)@(\w{1,15})/g, '$1@<a href="https://twitter.com/$2">$2</a>')
})
```

### index

- `index([element])   ⇒ number`

获取一个元素的索引值（注：从 0 开始计数）。当 elemen 参数没有给出时，返回当前元素在兄弟节点中的位置。当 element 参数给出时，返回它在当前对象集合中的位置。如果没有找到该元素，则返回-1。

```js
$('li:nth-child(2)').index() //=> 1
```

### insertAfter

- `insertAfter(target)   ⇒ self`

将集合中的元素插入到指定的目标元素后面（注：外部插入）。这个有点像 `after`，但是使用方式相反。

```js
$('<p>Emphasis mine.</p>').insertAfter('blockquote')
```

### insertBefore

- `insertBefore(target)   ⇒ self`

将集合中的元素插入到指定的目标元素前面（注：外部插入）。这个有点像 `before`，但是使用方式相反。

```js
$('<p>See the following table:</p>').insertBefore('table')
```

### last

- `last()   ⇒ collection`

获取对象集合中最后一个元素。

```js
$('li').last()
```

### map

- `map(function(index, item){ ... })   ⇒ collection`

遍历对象集合中的所有元素。通过遍历函数返回值形成一个新的集合对象。在遍历函数中 this 关键之指向当前循环的项（遍历函数中的第二个参数）。

遍历中返回 null 和 undefined，遍历将结束。

```js
elements
  .map(function () {
    return $(this).text()
  })
  .get()
  .join(', ')
```

### next

- `next()   ⇒ collection`
- `next(selector)   ⇒ collection`

获取对象集合中每一个元素的下一个兄弟节点(可以选择性的带上过滤选择器)。

### not

- `not(selector)   ⇒ collection`
- `not(collection)   ⇒ collection`
- `not(function(index){ ... })   ⇒ collection`

过滤当前对象集合，获取一个新的对象集合，它里面的元素不能匹配 css 选择器。如果另一个参数为 Zepto 对象集合，那么返回的新 Zepto 对象中的元素都不包含在该参数对象中。如果参数是一个函数。仅仅包含函数执行为`false`值得时候的元素，函数的 `this` 关键字指向当前循环元素。

与它相反的功能，查看 `filter`。

### offset

- `offset()   ⇒ Promise<object>`
- `offset(coordinates)   ⇒ self`
- `offset(function(index, oldOffset){ ... })   ⇒ self`

获得当前元素相对于 document 的位置。返回一个对象含有： `top`, `left`, `width`和`height`。

### offsetParent

- `offsetParent()   ⇒ collection`

找到第一个定位过的祖先元素，意味着它的 css 中的 `position` 属性值为“relative”, “absolute” or “fixed”

### parent

- `parent([selector])   ⇒ collection`

获取对象集合中每个元素的直接父元素。如果 css 选择器参数给出。过滤出符合条件的元素。

### parents

- `parents([selector])   ⇒ collection`

获取对象集合每个元素所有的祖先元素。如果 css 选择器参数给出，过滤出符合条件的元素。

如果想获取直接父级元素，使用 `parent`。如果只想获取到第一个符合 css 选择器的元素，使用`closest`。

```js
$('h1').parents() //=> [<div#container>, <body>, <html>]
```

### position

- `position()   ⇒ object`

获取对象集合中第一个元素的位置。相对于 `offsetParent`。当绝对定位的一个元素靠近另一个元素的时候，这个方法是有用的。

```js
var pos = element.position()

// position a tooltip relative to the element
$('#tooltip').css({
  position: 'absolute',
  top: pos.top - 30,
  left: pos.left,
})
```

### prepend

- `prepend(content)   ⇒ self`

将参数内容插入到每个匹配元素的前面（注：元素内部插入）。插入 d 的元素可以试 html 字符串片段，一个 dom 节点，或者一个节点的数组。

```js
$('ul').prepend('<li>first list item</li>')
```

### prependTo

- `prependTo(target)   ⇒ self`

将所有元素插入到目标前面（注：元素内部插入）。这有点像`prepend`，但是是相反的方式。

```js
$('<li>first list item</li>').prependTo('ul')
```

### prev

- `prev()   ⇒ collection`
- `prev(selector)   ⇒ collection`

获取对象集合中每一个元素的前一个兄弟节点，通过选择器来进行过滤。

### prop

- `prop(name)   ⇒ value`
- `prop(name, value)   ⇒ self`
- `prop(name, function(index, oldValue){ ... })   ⇒ self`

读取或设置 dom 元素的属性值。它在读取属性值的情况下优先于 `attr`，因为这些属性值会因为用户的交互发生改变，如`checked` 和 `selected`。

简写或小写名称，比如`for`, `class`, `readonly`及类似的属性，将被映射到实际的属性上，比如`htmlFor`, `className`, `readOnly`, 等等。

### remove

- `remove()   ⇒ self`

从其父节点中删除当前集合中的元素，有效的从 dom 中移除。

### removeAttr

- `removeAttr(name)   ⇒ self`

移除当前对象集合中所有元素的指定属性。

### removeClass

- `removeClass([name])   ⇒ self`
- `removeClass(function(index, oldClassName){ ... })   ⇒ self`

移除当前对象集合中所有元素的指定 class。如果没有指定 name 参数，将移出所有的 class。多个 class 参数名称可以利用空格分隔。下例移除了两个 class。

```js
$('#check1').removeClass('test')
```

### removeProp

- `removeProp(name)   ⇒ self`

从集合的每个 DOM 节点中删除一个属性。这是用 JavaScript 的`delete`操作符完成。值得注意的是如果尝试删除 DOM 的一些内置属性，如`className`或`maxLength`，将不会有任何效果，因为浏览器禁止删除这些属性。

### replaceWith

- `replaceWith(content)   ⇒ self`

用给定的内容替换所有匹配的元素。(包含元素本身)。content 参数可以为 `before`中描述的类型。

### scrollLeft

- `scrollLeft() => Promise<number>`
- `scrollLeft(value)   ⇒ self`

获取或设置页面上的滚动元素或者整个窗口向右滚动的像素值。

```js
const height = await $('#foo').scrollLeft() // => 123
```

### scrollTop

- `scrollTop() => Promise<number>`
- `scrollTop(value)   ⇒ self`

获取或设置页面上的滚动元素或者整个窗口向下滚动的像素值。

```js
const height = await $('#foo').scrollTop() // => 123
```

### show

- `show()   ⇒ self`

### siblings

- `siblings([selector])   ⇒ collection`

获取对象集合中所有元素的兄弟节点。如果给定 CSS 选择器参数，过滤出符合选择器的元素。

### size

- `size()   ⇒ number`

获取对象集合中元素的数量。

### slice

- `slice(start, [end])   ⇒ array`

提取这个数组 array 的子集，从`start`开始，如果给定`end`，提取从从`start`开始到`end`结束的元素，但是不包含`end`位置的元素。

### text

- `text()   ⇒ string`
- `text(content)   ⇒ self`
- `text(function(index, oldText){ ... })   ⇒ self`

获取或者设置所有对象集合中元素的文本内容。当没有给定 content 参数时，返回当前对象集合中第一个元素的文本内容（包含子节点中的文本内容）。当给定 content 参数时，使用它替换对象集合中所有元素的文本内容。它有待点似 html，与它不同的是它不能用来获取或设置 HTML。

### toggle

- `toggle([setting])   ⇒ self`

显示或隐藏匹配元素。如果 `setting` 为 `true`，相当于 `show()` 。如果`setting`为`false`。相当于 `hide()`。

### toggleClass

- `toggleClass(names, [setting])   ⇒ self`
- `toggleClass(function(index, oldClassNames){ ... }, [setting])   ⇒ self`

在匹配的元素集合中的每个元素上添加或删除一个或多个样式类。如果 class 的名称存在则删除它，如果不存在，就添加它。如果 setting 的值为真，这个功能类似于 addClass，如果为假，这个功能类似与 removeClass。

### unwrap

- `unwrap()   ⇒ self`

移除集合中每个元素的直接父节点，并把他们的子元素保留在原来的位置。 基本上，这种方法删除上一的祖先元素，同时保持 DOM 中的当前元素。

### val

- `val()   ⇒ string`
- `val(value)   ⇒ self`
- `val(function(index, oldValue){ ... })   ⇒ self`

获取或设置匹配元素的值。当没有给定 value 参数，返回第一个元素的值。当给定 value 参数，那么将设置所有元素的值。

### width

- `width()   ⇒ Promise<number>`
- `width(value)   ⇒ self`
- `width(function(index, oldWidth){ ... })   ⇒ self`

获取对象集合中第一个元素的宽；或者设置对象集合中所有元素的宽。

```js
await $('#foo').width() // => 123
```

## 事件

### off

- `off(type, [selector], function(e){ ... })   ⇒ self`
- `off({ type: handler, type2: handler2, ... }, [selector])   ⇒ self`
- `off(type, [selector])   ⇒ self`
- `off()   ⇒ self`

移除通过 on 添加的事件.移除一个特定的事件处理程序， 必须通过用`on()`添加的那个相同的函数。否则，只通过事件类型调用此方法将移除该类型的所有处理程序。如果没有参数，将移出当前元素上全部的注册事件。

### on

- `on(type, [selector], function(e){ ... })   ⇒ self`
- `on(type, [selector], [data], function(e){ ... })   ⇒ self`
- `on({ type: handler, type2: handler2, ... }, [selector])   ⇒ self`
- `on({ type: handler, type2: handler2, ... }, [selector], [data])   ⇒ self`

添加事件处理程序到对象集合中得元素上。多个事件可以通过空格的字符串方式添加，或者以事件类型为键、以函数为值的对象 方式。如果给定 css 选择器，当事件在匹配该选择器的元素上发起时，事件才会被触发（注：即事件委派，或者说事件代理）。

如果给定`data`参数，这个值将在事件处理程序执行期间被作为有用的 `event.data` 属性

事件处理程序在添加该处理程序的元素、或在给定选择器情况下匹配该选择器的元素的上下文中执行(注：this 指向触发事件的元素)。 当一个事件处理程序返回 false，preventDefault() 和 stopPropagation()被当前事件调用的情况下， 将防止默认浏览器操作，如链接。

```js
var elem = $('#content')
// observe all clicks inside #content:
elem.on('click', function(e){ ... })
// observe clicks inside navigation links in #content
elem.on('click', 'nav a', function(e){ ... })
// all clicks inside links in the document
$('#test').on('click', 'a', function(e){ ... })
// disable following any navigation link on the page
$('#test').on('click', 'nav a', false)
```

### one

- `one(type, [selector], function(e){ ... })   ⇒ self`
- `one(type, [selector], [data], function(e){ ... })   ⇒ self`
- `one({ type: handler, type2: handler2, ... }, [selector])   ⇒ self`
- `one({ type: handler, type2: handler2, ... }, [selector], [data])   ⇒ self`

和 `on()` 一样，添加一个处理事件到元素，当第一次执行事件以后，该事件将自动解除绑定，保证处理函数在每个元素上最多执行一次。

### trigger

- `trigger(event, [args])   ⇒ self`

在对象集合的元素上触发指定的事件。如果给定 args 参数，它会作为参数传递给事件函数。

```js
$('#test').trigger('tap', ['one', 'two'])
```

### triggerHandler

- triggerHandler(event, [args]) ⇒ self

和 `trigger` 一样，它只在当前元素上触发事件，但不冒泡。
</file>

<file path="docs/jsx.md">
---
title: JSX 简介
---

在 Taro 中，我们使用 JSX 作为一种 DSL 进而编译成各端通用的语法。 JSX 是一种看起来很像 XML 的 JavaScript 语法扩展，比起模板语言，它具有以下优点：

1. 各大编辑器和 IDE 都能提供非常良好的支持；
2. 可以做到类型安全，在编译期就能发现错误；
3. 提供语义化并且可以移动的标签；
4. 背后的社区支持非常强力；

如果你是一名新手的话，可能一开始学习一种新语法会产生一些抵触。但当你熟悉了之后，就能发现 JSX 更符合程序语言的书写逻辑，在处理一些精细复杂需求的时候也会比模板语言更为得心应手。

## 使用 JSX

请观察以下代码：

```jsx
import Taro, { Component } from '@tarojs/taro'
import { View } from '@tarojs/components'

class Home extends Component {
  render() {
    return <View>Hello World!</View>
  }
}
```

### 必须声明 `Taro` 和组件

在这段代码中，大写开头的 JSX 标签 `View` 表示它是一个 Taro 组件，尽管在整段代码中，变量 `View` 看起来并没有被调用，但也必须从 `@tarojs/components` 中引入声明。变量 `Taro` 也是一个必须引入声明的变量，因为我们在编译期和运行时会依赖这个变量做一些特殊处理。**当你引入了组件时，一定要使用，不要出现没有使用的变量。**

> 当你只用支持微信小程序时，可以不用引入组件例如 `View` 这样的声明。但我们仍然强烈推荐你在顶部引入你将要使用的组件，这样编辑器/IDE 能更好地提前发现可能出现的问题，也为将来可能需要的多端转换留有余地。

### 首字母大写与驼峰式命名

在 Taro 中，所有组件都应当首字母大写并且使用大驼峰式命名法（Camel-Case）。

例如，下面的代码将无法按预期运行：

```jsx
import Taro, { Component } from '@tarojs/taro'
// 引入一个自定义组件组件
import home_page from './page'

// 错误！组件名应该首字母大写:
class App extends Component {
  render() {
    return <home_page message="Hello World!" />
  }
}
```

为了解决这个问题，我们将 `home_page` 重命名为 `HomePage`，然后使用 `<HomePage />` 引用：

```jsx
import Taro, { Component } from '@tarojs/taro'
// 引入一个自定义组件组件
import HomePage from './page'

class App extends Component {
  render() {
    return <HomePage message="Hello World!" />
  }
}
```

> 和 React/Nerv 不一样的地方在于，Taro 不支持使用 `点表示法` 和[运行时指定类型](https://reactjs.org/docs/jsx-in-depth.html#choosing-the-type-at-runtime)来引用组件，例如 `<MyComponents.DatePicker />` 这样的写法在 Taro 中是无法正确编译的。

## 属性

在 JSX 中有几种不同的方式来指定属性。

### 使用 JavaScript 表达式

你可以任意地在 JSX 当中使用 [JavaScript 表达式](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Expressions_and_Operators#%E8%A1%A8%E8%BE%BE%E5%BC%8F)，在 JSX 当中的表达式要包含在大括号里。例如，在这个 JSX 中：

```jsx
<MyComponent foo={1 + 2 + 3 + 4} />
```

对于 MyComponent 来说， props.foo 的值为 10，这是 1 + 2 + 3 + 4 表达式计算得出的。

if 语句和 for 循环在 JavaScript 中不是表达式，因此它们不能直接在 JSX 中使用，所以你可以将它们放在周围的代码中。

```jsx
import Taro, { Component } from '@tarojs/taro'

class App extends Components {
  render() {
    let description

    if (this.props.number % 2 == 0) {
      description = <Text>even</Text>
    } else {
      description = <Text>odd</Text>
    }

    return (
      <View>
        {this.props.number} is an {description} number
      </View>
    )
  }
}
```

### 字符串常量

你可以将字符串常量作为属性值传递。下面这两个 JSX 表达式是等价的：

```jsx
<MyComponent message="hello world" />

<MyComponent message={'hello world'} />
```

### 默认为 True

如果你没有给属性传值，它默认为 true。因此下面两个 JSX 是等价的：

```jsx
<MyTextBox autocomplete />

<MyTextBox autocomplete={true} />
```

> 和 React/Nerv 的不同：
> React 可以使用 `...` 拓展操作符来传递属性，但在 Taro 中你不能这么做。例如：
>
> ```jsx
> const props = { firstName: 'Plus', lastName: 'Second' }
> return <Greeting {...props} />
> ```
>
> 这样的操作会报错。你只能手动地把所有需要引用的 props 写上去：
> `<Greeting firstName="Plus" lastName="Second" />`

### 嵌套

如果 JSX 标签是闭合式的，那么你需要在结尾处用 `/>`, 就好像 XML/HTML 一样：

```jsx
const element = <Image src={user.avatarUrl} />
```

JSX 标签同样可以相互嵌套：

```jsx
const element = (
  <View>
    <Text>Hello!</Text>
    <Text>Good to see you here.</Text>
  </View>
)
```

JavaScript 表达式也可以嵌套：

```jsx
render () {
  const todos = ['finish doc', 'submit pr', 'nag dan to review'];
  return (
    <ul>
      {todos.map((todo) => <Text>{todo}</Text>)}
    </ul>
  )
}
```

### 布尔值、Null 和 Undefined 被忽略

`false`、`null`、`undefined` 和 `true` 都是有效的 children，但它们不会直接被渲染。下面的表达式是等价的：

```jsx
<View />

<View></View>

<View>{false}</View>

<View>{null}</View>

<View>{undefined}</View>

<View>{true}</View>
```

这在根据条件来确定是否渲染 元素时非常有用。以下的 JSX 只会在 showHeader 为 true 时渲染 `<Header />` 组件。

```jsx
<View>
  {showHeader && <Header />}
  <Content />
</View>
```
</file>

<file path="docs/list.md">
---
title: 列表渲染
---

首先，让我们看下在 Javascript 中如何转化列表：

如下代码，我们使用 `map()` 函数让数组中的每一项翻倍,我们得到了一个新的数列 `doubled` 。

```jsx
const numbers = [1, 2, 3, 4, 5]
const doubled = numbers.map((number) => number * 2)
console.log(doubled)
```

代码打印出 `[2, 4, 6, 8, 10]`。

在 Taro 中，把数组转化为数列元素的过程是相似的。

## 渲染多个组件

下面，我们使用 JavaScript 中的 `map()` 方法遍历 `numbers` 数组。对数组中的每个元素返回 `<Text>` 标签，最后我们得到一个数组 `listItems`：

```jsx
const numbers = [...Array(100).keys()] // [0, 1, 2, ..., 98, 99]
const listItems = numbers.map((number) => {
  return <Text className="li"> 我是第 {number + 1} 个数字</Text>
})
```

这段代码生成了一个 1 到 100 的数字列表。

## Keys

但是在上面的代码，你会得到一个报错：提醒你当循环一个数组时应该提供 keys。Keys 可以在 DOM 中的某些元素被增加或删除的时候帮助 Nerv/小程序 识别哪些元素发生了变化。因此你应当给数组中的每一个元素赋予一个确定的标识。

```jsx
const numbers = [...Array(100).keys()] // [0, 1, 2, ..., 98, 99]
const listItems = numbers.map((number) => {
  return (
    <Text key={String(number)} className="li">
      我是第 {number + 1} 个数字
    </Text>
  )
})
```

## taroKeys

`taroKey` 适用于循环渲染原生小程序组件，赋予每个元素唯一确定标识，转换为小程序的 `wx:key`。

```jsx
const numbers = [...Array(100).keys()] // [0, 1, 2, ..., 98, 99]
const listItems = numbers.map((number) => {
  return (
    // native component
    <g-list taroKey={String(number)} className="g-list">
      我是第 {number + 1} 个数字
    </g-list>
  )
})
```

### 元素的 key 在他的兄弟元素之间应该唯一

数组元素中使用的 key 在其兄弟之间应该是独一无二的。然而，它们不需要是全局唯一的。当我们生成两个不同的数组时，我们可以使用相同的 key：

```jsx
class App extends Componenet {
  state = {
    posts: [
      { id: 1, title: 'Hello World', content: 'Welcome to learning Taro!' },
      { id: 2, title: 'Installation', content: 'You can install Taro from npm.' },
    ],
  }
  render() {
    const { posts } = this.state
    const sidebar = (
      <View>
        {posts.map((post) => (
          <Text key={post.id}>{post.title}</Text>
        ))}
      </View>
    )
    const content = posts.map((post) => {
      return (
        <View key={post.id}>
          <Text>{post.title}</Text>
          <Text>{post.content}</Text>
        </View>
      )
    })
    return (
      <View>
        {sidebar}
        <View className="divider" />
        {content}
      </View>
    )
  }
}
```

key 会作为给 Taro 的提示，但不会传递给你的组件。如果您的组件中需要使用和 key 相同的值，请将其作为属性传递：

```jsx
const content = posts.map((post) => {
  return (
    <View key={post.id} id={post.id}>
      <Text>{post.title}</Text>
      <Text>{post.content}</Text>
    </View>
  )
})
```

### key 的取值

key 的取值必须同时满足三个条件：

1. 稳定
2. 可预测
3. 唯一（相对于其他兄弟元素）

最好的 key 就是数组里的 ID（通常由后端生成），他能同时满足以上三个条件，同时也不需要自己去生成。如果没有 ID，你能保证数组的元素某个键值字符串都是不同的（例如 `item.title`），那么使用那个字符串键值也可以。如果源数据没有提供很好的 key 值，或者需要遍历的数组生成的。那么你最好在数据创建或者修改之后给他添加一个好的 key 值：

```jsx
let todoCounter = 0
function createNewTodo(text) {
  return {
    completed: false,
    id: todoCounter++,
    text
  }
}

class App extends Components {
  state = {
    todos: [],
    inputText: ''
  }

  onNewTodo () {
    this.setState({
      todos: [...this.state.todos, createNewTodo(this.state.inputText)]
    })
  }

  render () {
    return ...
  }
}
```

每一个在渲染结果上一致组件的应该对应一个相同的 key。因此使用数组的 `index` 或在数组渲染时随机生成一个 key 值（但你在创建数组时可以这么做）都是反优化，极端情况下甚至可能导致渲染出错。

## 与 React 的不同

在 React 中，JSX 是会编译成普通的 JS 的执行，每一个 JSX 元素，其实会通过 `createElement` 函数创建成一个 JavaScript 对象（React Element），因此实际上你可以这样写代码 React 也是完全能渲染的：

```jsx
const list = this.state.list
  .map((l) => {
    if (l.selected) {
      return <li>{l.text}</li>
    }
  })
  .filter(React.isValidElement)
```

你甚至可以这样写：

```jsx
const list = this.state.list
  .map((l) => {
    if (l.selected) {
      return {
        $$typeof: Symbol(react.element),
        props: {
          children: l.text,
        },
        type: 'li',
      }
    }
  })
  .filter(React.isValidElement)
```

但是 Taro 中，JSX 会编译成微信小程序模板字符串，**因此你不能把 `map` 函数生成的模板当做一个数组来处理**。当你需要这么做时，应该先处理需要循环的数组，再用处理好的数组来调用 map 函数。例如上例应该写成：

```jsx
const list = this.state.list
  .filter((l) => l.selected)
  .map((l) => {
    return <li>{l.text}</li>
  })
```
</file>

<file path="docs/migration.md">
---
title: 从旧版本迁移到 Taro Next
---

这是一篇针对旧版本用户升级到 Taro Next 的迁移指南。因为本章内容包含了许多详尽的阐述和迁移例子，所以看起来有一些长。但请不要担心，Taro Next 大部分用法还是和旧版本一样的。**本章没有提到的内容，你可以像旧版本的 Taro 一样操作或使用**。

事实上，你并不需要去更改任何业务的逻辑代码，许多更改使用编辑器的「查找/替换」就可以完成。你甚至不需要完整地阅读整章内容（重点在 1，2 小节， [API](#API) 和 [项目/页面配置](#项目/页面配置)），只有当出问题时定位到具体的小节即可。

更新到 Taro Next 首先需要更新项目依赖：

```bash
# 更新 CLI
$ npm i -g @tarojs/cli@next
# 在项目目录更新项目依赖
$ npm i @tarojs/runtime@next @tarojs/mini-runner@next @tarojs/components@next @tarojs/taro@next
$ npm i react @tarojs/react@next # 如果使用 React
$ npm i nervjs # 如果使用 Nerv
# CLI 命令和以前一模一样
$ taro build --type weapp --watch
```

## API

在旧版本 Taro 中，我们把所有面向应用开发者的 API 都放在 `@tarojs/taro` 里，一个典型的 Taro 组件/页面会像这样：

```jsx
// 类组件
import Taro, { Component } from '@tarojs/taro'

class Wallace extends Component {
	componentDidMount () {
	  Taro.request().then(/* do something */)
	}
  render () {
    return ...
	}
}

// 函数式组件
import Taro, { useEffect } from '@tarojs/taro'

function Tall () {
	useEffect(() => {
	  Taro.request().then(/* do something */)
	}, [])
	return ...
}
```

在 Taro Next 中，属于框架本身的 API 从框架自己的包中引入，其它的 API 仍然从 `@tarojs/taro` 引入。使用哪个框架来进行开发完全由开发者来决定。

```jsx
import Taro from '@tarojs/taro'
import React, { Component }  from 'react' // Component 是来自于 React 的 API
// 从 nervjs 中引入，那运行的就是 Nerv
// import { Component } from 'nervjs'

class Reporter extends Component {
  componentDidMount () {
    Taro.request().then(/* do something */)
  }
  render () {
    return ...
  }
}

// 函数式组件
import Taro from '@tarojs/taro'
// useEffect 是来自于 React 的 API
import React, { useEffect }  from 'react'
// 从 nervjs 中引入，那运行的就是 Nerv
// import { useEffect } from 'nervjs'

function Fast () {
  useEffect(() => {
    Taro.request().then(/* do something */)
  }, [])
  return ...
}
```

> Nerv 是凹凸实验室的一个开源类 React 框架，体积比 React 更小，多数情况性能表现也比 React 更好。但某些 React 生态的库兼容性可能会出现问题。

## 项目/页面配置

在旧版本 Taro 中，页面/项目的配置挂载在类组件的类属性或函数式的属性上，通过 AST 分析取出来，然后生成 JSON 文件。但这样做，项目页面的配置就无法动态地生成：

```jsx
// app.js 项目配置
class App extends Component {
  config = {
    pages: [
      'pages/index/index'
    ],
    window: {
      backgroundTextStyle: 'light',
      navigationBarBackgroundColor: '#fff',
      navigationBarTitleText: 'WeChat',
      navigationBarTextStyle: 'black'
    }
  }
  render () {
    return ...
  }
}

// index.js 页面配置
function Index () {
  return ...
}

Index.config = {
  navigationBarTitleText: '首页'
}

```

在 Taro Next 中，会有一个新的文件：`*.config.js` ，`*` 代表你页面/项目文件的文件名，`config` 文件必须和页面/项目文件在同一文件夹。在这个文件里你可以使用任意合法的 JavaScript 语法，只要最终把配置作为对象通过 `export default` 出去即可：

```jsx
// app.js 项目文件
class App extends Component {
  render () {
    return ...
  }
}

// app.config.js
export default {
  pages: [
    'pages/index/index'
  ],
  window: {
    backgroundTextStyle: 'light',
    navigationBarBackgroundColor: '#fff',
    navigationBarTitleText: 'WeChat',
    navigationBarTextStyle: 'black'
  }
}

// index.js 页面文件
function Index () {
  return ...
}

// index.config.js 页面配置
const title = '首页'
export default {
  navigationBarTitleText: title
}
```

一个完整的项目文件结构示例会像这样：

```
.
├── app.config.js // 入口文件项目配置
├── app.js
├── app.scss
├── components
│   └── result.js // 组件若不使用第三方组件则无需配置
└── pages
    └── index
        ├── index.config.js // index 的页面配置
        └── index.js
```

## 使用第三方 React 库

如果你需要引入 React 相关生态的库，直接通过 `npm install` 安装然后引入使用即可，Taro 不会再维护类似于 `taro-redux` 、`taro-mobx` 之类的库。

```jsx
// 当使用了 JSX 时，babel 会隐式地调用 React.createElement
// 因此只要你使用了 JSX，就要把 React 或 Nerv 引入
import React from 'react'
import { useSelector }  from 'react-redux'
// 如果是使用的是 Nerv
// import { useSelector }  from 'nerv-redux'
function Excited () {
  const counter = useSelector(state => state.counter)
  return ...
}
```

## 路由

在旧版本中可以通过 `this.$router` 访问当前组件/页面路由的详情。在 Taro Next 对应的 API 是在 `@tarojs/taro` 中的 `getCurrentInstance().router`，两者的属性一模一样。

```jsx
import { getCurrentInstance } from '@tarojs/taro'
class C extends Component {
  current = getCurrentInstance()

  componentWillMount() {
    // getCurrentInstance().router 和 this.$router 和属性一样
    console.log(this.current.router)
  }
}

// 函数式组件
import { getCurrentInstance } from '@tarojs/taro'
function C() {
  const { router } = getCurrentInstance()
  // getCurrentInstance().router 和 useRouter 返回的内容也一样
  // const router = useRouter()
}
```

而对于项目入口组件而言，路由信息我们推荐在 `componentDidShow` 生命周期的参数中直接读取。

```jsx
// app.js 项目入口文件
class App extends Component {
  componentDidShow (options /* 这里有你想要的路由信息 */) {
  }

  render () {
    ...
  }
}
```

> 聪明的读者已经猜到了，`getCurrentInstance().router` 其实是访问小程序当前页面 `onLoad` 生命周期参数的快捷方式。

## 样式

在 Taro Next 中，没有 [组件的外部样式和全局样式](/docs/component-style) 的概念，组件的配置（`config.js`）是无效的，页面和入口文件引入的 CSS 都会变成全局 CSS ，没有了 `externalClasses` 和 `addGlobalClass` 这两个概念。

如果你需要带作用域的 CSS，可以考虑使用 [CSS Modules](https://github.com/css-modules/css-modules)。

## 编译配置

- 需要添加 [framework 配置](/docs/config)，取值为使用的框架（react, nerv, vue, vue3）
- [jsxAttributeNameReplace](/docs/1.x/config) 配置已被移除。因为我们不需要配置

## 编译依赖库

`Webpack` 升级到 `Webpack@4`，`Babel` 升级到 `babel@7`。Webpack 升级是在 `taro@2` 中完成的，如果你是从 `taro@1` 升级上来的话，或许需要去看看 [Taro 2 更改](https://github.com/NervJS/taro/blob/feat_mini_webpack/docs/config-detail) 查看使用 Webpack 编译后带来的变化。

升级到 `babel@7` 意味着你的项目文件全部都会通过根目录的 `babel.config.js` 的配置进行编译。

## ESLint 和最佳实践

`eslint-plugin-taro` 已被废弃，你不再需要遵循它所规定的种种限制。你可以发挥你的创造力使用任何合法的 JSX 语法：

```jsx
import React from 'react'
import { View, Text } from '@tarojs/components'
function C() {
  // 你可以选择不使用 JSX，但元素还是必须从 `@tarojs/components` 引入
  const title = React.createElement(View, null, 'Numbers:')

  const numbers = []
  for (let i = 0; i < 10; i++) {
    numbers.push(<Text key={i}>{i}</Text>)
  }

  return (
    <>
      {title}
      {numbers}
    </>
  )
}
```

旧版本文档所提到的[最佳实践](/docs/1.x/best-practice)也不必再遵循。也就是说，即便你不给组件设置 `defaultProps`，自定义事件名不以 `on` 开头（还有其它的旧版本代码风格最佳实践），你的代码也能运行。但值得注意的是，遵循这样的 **代码风格最佳实践** 可以让你的代码更健壮，你的应用也会因此而收益。而对于另外的一些由于旧版本 Taro 执行机制的 hack（例如 render 调用两次，state 和 props 无法重名，不要打印组件），这类最佳实践可以不必理会。

## Ref & DOM

Taro Next 在底层会维护一个精简的 DOM 系统，在框架中使用 `ref` 链接到的是一个 Taro Element 实例，因此你直接可以使用 [`HTMLElement`](https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement) 的部分方法直接操作它。如果你需要获取原生小程序 DOM 实例，那需要使用原生小程序的 [`SelectorQuery`](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/SelectorQuery.html) 来获取。

> 大部分和渲染相关的 DOM 属性你都可以通过像 Web 开发一样获取或设置（如果有必要的话你甚至可以通过 `parentNode` 和 `childNodes` 访问元素的父元素和子元素！），但元素的位置你还是必须通过原生小程序 DOM 实例的 `boundingClientRect()` 和 `scrollOffset()` 方法获取。

另外，如果你使用的是 React，就将无法使用字符串的形式来使用 `ref`。(Nerv 不受此影响)

```jsx
class C extends Component {
  input = React.createRef()

  componentDidMount() {
    const node = this.input.current // node 是一个 Taro Element 实例
    node.focus() // ok, 在 Web 开发中常见做法

    // 以下写法也能更新视图，但不推荐这么做，更推荐使用数据来驱动视图更新
    node.setAttribute('class', 'input-css-class')
    node.className = 'input-css-class'
    node.style.fontSize = '16px'
    node.value = 'excited!'

    // 如果你需要获取原生小程序 DOM 的话
    const miniNode = Taro.createSelectorQuery().select('#' + node.id)
  }

  render() {
    return <Input ref={this.input} id="input" />
  }
}
```

> 在未来，我们可能会在 Taro Element 上提供一个可以快速访问小程序 DOM 实例的属性。目前请按照上述例子使用。

## 生命周期

当你使用 React 时（使用 Nerv 不受此影响），以下生命周期被更名：

- `componentWillMount()` -> `UNSAFE_componentWillMount()`
- `componentWillReceiveProps` -> `UNSAFE_componentWillReceiveProps()`
- `componentWillUpdate` -> `UNSAFE_componentWillUpdate()`

新增一个生命周期: [`componentDidCatch(err, info)`](https://reactjs.org/docs/react-component.html#componentdidcatch) ，这是由框架本身（React 或 Nerv）提供的。`componentDidCatch(err, info)` 会在组件和它的子孙抛出错误时触发，第一个参数 `err` 指向抛出的错误，第二个参数 `info` 是组件的调用信息。

## Hooks

在 Taro Next，Taro 的[专有 Hooks](./hooks)（例如 `usePageScroll`, `useReachBottom`）从 `@tarojs/taro` 中引入，框架自己的 Hooks （例如 `useEffect`, `useState`）从对应的框架引入。

另外，旧版本的 Taro 可以在 Class Component 中使用 Hooks，但 React 是不允许这样的行为的。

```jsx
import { usePageScroll, useReachBottom } from '@tarojs/taro' // Taro 专有 Hooks
import { useState, useEffect } from 'react' // 框架 Hooks （基础 Hooks）
// 如果你使用 Nerv 的话
// import { useState, useEffect } from 'nervjs' // 框架 Hooks （基础 Hooks）
```

## $scope 和 $componentType

由于 Taro Next 没有自定义组件，所以也没有了 `this.$scope` 和 `this.$componentType` 的概念。`getCurrentInstance().page` 可以返回当前小程序页面的实例。
</file>

<file path="docs/mini-split-chunks-plugin.md">
---
title: 智能提取分包依赖
---

在开发小程序时，Taro 编译器依赖 SplitChunksPlugin 插件抽取公共文件，默认主包、分包依赖的 module 都会打包到根目录 vendors.js 文件中（有一个例外，当只有分包里面有且只有一个页面依赖 module 时，会打包到分包中依赖页面源码中），直接影响到小程序主包大小，很容易超出 2M 的限制大小。

### SplitChunks 默认配置

> 可通过 [mini.commonChunks](/docs/next/config-detail#minicommonchunks) 配置进行修改。

```json title="SplitChunks 默认配置"
{
  chunks: 'all',
  maxInitialRequests: Infinity,
  minSize: 0,
  cacheGroups: {
    common: {
      name: config.isBuildPlugin ? 'plugin/common' : 'common',
      minChunks: 2,
      priority: 1
    },
    vendors: {
      name: config.isBuildPlugin ? 'plugin/vendors' : 'vendors',
      minChunks: 2, // 当大于 2 个依赖时，才打包到 vendors.js 中
      test: module => {
        return /[\\/]node_modules[\\/]/.test(module.resource)
      },
      priority: 10
    },
    taro: {
      name: config.isBuildPlugin ? 'plugin/taro' : 'taro',
      test: module => {
        return taroBaseReg.test(module.context)
      },
      priority: 100
    }
  }
}
```

那么应该如何对分包公共依赖的进行抽取，减少主包大小呢？

### 优化思路

感谢 [@huangcj](https://github.com/huangcj99) 提交的 miniSplitChunksPlugin 插件，在打包时通过继承 SplitChunksPlugin 进行相关 module 依赖树分析，过滤出主包中无依赖但分包独自依赖的 module 提取成 sub vendor chunks，过滤出主包中无依赖但多个分包共同依赖的 module 为 sub common chunks，利用 SplitChunksPlugin 的 cacheGroup 功能，将相关分包依赖进行文件 split。抽取出的目录文件如下：

- 分包根目录/sub-vendors.(js|wxss)

  - 如果该 module 只被单个分包内的多个 page 引用，则提取到该分包根目录的 sub-vendors 文件中。

  ![sub-venders](https://img13.360buyimg.com/imagetools/jfs/t1/205404/34/21044/222198/6256e36cE62a6c078/93671ab13f3df367.png)

- 分包根目录/sub-common/\*.(js|wxss)

  - 如果该 module 被多个分包内的 page 引用，正常情况下会被提取到主包的公共模块中，这里为了保证主包的体积最优，则会先提取成一个公共模块，然后分别复制到对应分包的 sub-common 文件夹下**（因为小程序无法跨分包引入文件，所以这里需要每个分包都复制一份）**，需要注意的是，这样会导致总包的体积变大一些。

  ![sub-common](https://img12.360buyimg.com/imagetools/jfs/t1/136245/21/26437/256225/6256e36dE6a1c438f/43dfcf54cf443ca0.png)

### 使用方法

1 将 Taro 升级到 **3.3.11** 及以上版本

```shell title="升级版本"
# 使用Taro 升级命令更新CLI版本到最新版本
$ taro update self 
# 使用Taro 升级命令更新CLI版本到指定版本
$ taro update self [版本号]
# 使用Taro 升级命令将项目依赖升级到与@tarojs/cli一致的版本
$ taro update project
# 使用Taro 升级命令将项目依赖升级到指定版本
$ taro update project [版本号]
```

2 修改配置文件

通过配置 [mini.optimizeMainPackage.enable](/docs/next/config-detail#minioptimizemainpackage) 为 true，即可开启智能提取分包依赖插件。

```js title="开启智能提取分包依赖"
// config/index.js
config = {
  // ...
  mini: {
    // ...
    optimizeMainPackage: {
      enable: true,
    },
  },
}
```

3 排除不想抽取的 module
如果依赖的 module 不想走分包提取逻辑，可以配置 exclude 属性，支持字符串（字符串需写文件完整绝对路径名）和函数数组，匹配到的 module 依旧按默认提取到主包中。

```js title="开启智能提取分包依赖"
// config/index.js
config = {
  // ...
  mini: {
    // ...
    optimizeMainPackage: {
      enable: true,
      exclude: [
        path.resolve(__dirname, '../src/utils/moduleName.js'),
        (module) => module.resource?.indexOf('moduleName') >= 0,
      ],
    },
  },
}
```

4.目前只支持微信小程序，默认支持 .wxss、.json、.js、.wxml、.wxs 5 种文件格式。

### 效果展示

[Demo 工程](https://github.com/NervJS/taro/tree/feat/webpack5/examples/mini-split-chunks-plugin)

```bash title="源文件工程目录"
src
├── app.config.js
├── app.js
├── app.scss
├── index.html
├── packageA // 分包 A
│   ├── common
│   │   └── index.scss // 分包 A 公共样式
│   └── pages
│       ├── cat
│       │   ├── index.config.js
│       │   ├── index.jsx // 依赖 taro-ui 和分包公共样式文件
│       │   └── index.scss
│       └── dog
│           ├── index.config.js
│           ├── index.jsx // 依赖 miniprogram-sm-crypto、 taro-ui 和分包公共样式文件
│           └── index.scss
├── packageB // 分包 B
│   └── pages
│       ├── apple
│       │   ├── index.config.js
│       │   ├── index.jsx // 依赖 miniprogram-sm-crypto
│       │   └── index.scss
│       └── banana
│           ├── index.config.js
│           ├── index.jsx
│           └── index.scss
└── pages // 主包
    └── index
        ├── index.config.js
        ├── index.jsx
        └── index.scss
```

```bash title="输出工程目录"
dist
├── app.js
├── app.js.LICENSE.txt
├── app.json
├── app.wxss
├── base.wxml
├── comp.js
├── comp.json
├── comp.wxml
├── custom-wrapper.js
├── custom-wrapper.json
├── custom-wrapper.wxml
├── packageA
│   ├── pages
│   │   ├── cat
│   │   │   ├── index.config.wxss
│   │   │   ├── index.js
│   │   │   ├── index.json
│   │   │   ├── index.wxml
│   │   │   └── index.wxss
│   │   └── dog
│   │       ├── index.config.wxss
│   │       ├── index.js
│   │       ├── index.json
│   │       ├── index.wxml
│   │       └── index.wxss
│   ├── sub-common
│   │   ├── 34299ff0bdffe7d50742f6fc2ed88f06.js // miniprogram-sm-crypto 依赖模块 jsbn 源码
│   │   └── a223b12dc801f51582835c16be379976.js // miniprogram-sm-crypto 源码
│   ├── sub-vendors.js // taro-ui AtButton组件源码
│   ├── sub-vendors.js.LICENSE.txt
│   └── sub-vendors.wxss // taro-ui AtButton组件样式及分包公共样式源码
├── packageB
│   ├── pages
│   │   ├── apple
│   │   │   ├── index.config.wxss
│   │   │   ├── index.js
│   │   │   ├── index.json
│   │   │   ├── index.wxml
│   │   │   └── index.wxss
│   │   └── banana
│   │       ├── index.config.wxss
│   │       ├── index.js
│   │       ├── index.json
│   │       ├── index.wxml
│   │       └── index.wxss
│   └── sub-common
│       ├── 34299ff0bdffe7d50742f6fc2ed88f06.js // miniprogram-sm-crypto 依赖模块 jsbn 源码
│       └── a223b12dc801f51582835c16be379976.js // miniprogram-sm-crypto 源码
├── pages
│   └── index
│       ├── index.js
│       ├── index.json
│       ├── index.wxml
│       └── index.wxss
├── project.config.json
├── runtime.js
├── taro.js
├── taro.js.LICENSE.txt
├── utils.wxs
├── vendors.js // 公共JS文件
└── vendors.js.LICENSE.txt
```

### 注意事项

因为 sub-common 会在每个分包目录下分别复制一份，所以会增大小程序包整体大小，使用时需根据具体场景具体分析，采用适合自己的性能最优方案。
</file>

<file path="docs/mini-troubleshooting.md">
---
title: 常见问题
---

各小程序常见问题汇总。

## 微信小程序

### 热重载

打开微信小程序开发者工具的“热重载”功能，可以在修改**页面 JS 文件**、**样式文件**后快速在开发者工具显示更新的内容，极大地提升了开发体验。

在 Taro 中，样式文件的热重载是直接支持的，而页面 JS 文件的热重载在 `Taro v3.3.17` 版本后支持，且需要额外配置：

- `Taro v3.3.17+`：手动为需要热重载的页面增加兼容代码，请参考：[#10722](https://github.com/NervJS/taro/issues/10722#issuecomment-992247021)
- `Taro v3.4.0+`：打开编译配置 [mini.hot](./config-detail#minihot) 即可。

> **注意：**目前微信小程序的 JS 文件热重载只支持页面文件，而不包括其依赖。
</file>

<file path="docs/miniprogram-plugin.md">
---
title: 微信小程序插件开发
---

Taro 支持开发微信小程序插件，本文将介绍主要用法。

:::info
目前微信小程序仅支持使用 `React` 来进行开发
:::

## 参考

- [微信小程序插件开发概述](https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/)
- [完整示例](https://github.com/NervJS/taro/tree/next/examples/build-weapp-plugin)

## 开发步骤

### 1. 创建插件开发模版

微信小程序插件分为**页面**、**组件**、**接口**三种。开发者可以使用 `taro init` 命令，然后选择生成**微信小程序插件模版**，即可在当前目录生成包含上述三种插件类型的 Taro 微信小程序插件项目。

#### 项目结构

推荐的插件项目结构如下：

注意，最后发布的是 plugin 文件夹内的内容，插件的所有内容及除了 npm 包以外的依赖都应写在 plugin 文件夹内。`src/pages` 内的页面只是用于调试插件。

    ├── config                 配置目录
    ├── src                    源码目录
    |   ├── pages              调试页面目录，用于调试插件
    |   |   └── index
    |   ├── plugin             插件目录
    |   |   ├── doc            插件文档目录
    |   |   ├── components     组件插件目录
    |   |   ├── pages          页面插件目录
    |   |   ├── index.js       接口插件文件
    |   |   └── plugin.json    插件配置文件
    |   ├── app.css            项目总通用样式
    |   └── app.js             项目入口文件
    └── package.json
    └── package.config.json

### 配置 appid

创建完模版后，首先需要修改 `project.config.json` 的 **appid** 字段和 `src/app.config.ts` 的 **prodiver** 字段为同一 appid。

### 编译项目

```bin
taro build --plugin weapp
taro build --plugin weapp --watch
```

### 添加小程序项目

在微信开发者工具中添加 Taro 插件项目根目录。

## 使用插件页面

plugin.json 的 **pages** 字段加入页面插件路径：

```json title="plugin.json"
{
  "pages": {
    "list": "pages/list/list"
  }
}
```

页面使用路径： **plugin://[app.js 中注册的插件名]/[plugin.json 中注册的页面名]** 进行跳转。

```jsx {1}
<Navigator url="plugin://myPlugin/list">Go to pages/list!</Navigator>
```

### 插件页面获取小程序渲染层元素

```js
// 通过 this.props.$scope 获取到小程序原生配置对象
const query = Taro.createSelectorQuery().in(this.props.$scope)
query
  .select('#id')
  .boundingClientRect()
  .exec((res) => {
    console.log(res)
  })
```

### genericsImplementation

支持使用 `genericsImplementation` 传入组件到插件页面，详细用法请看 Demo。

## 使用插件组件

plugin.json 的 **publicComponents** 字段加入组件插件路径：

```json title="plugin.json"
{
  "publicComponents": {
    "avatar": "components/avatar/avatar"
  }
}
```

在页面配置 config.usingComponents 中配置好插件名和插件路径（**plugin://[app.js 中注册的插件名]/[plugin.json 中注册的组件名]**）：

```jsx {4}
export default class Index extends Component {
  config = {
    usingComponents: {
      avatar: 'plugin://myPlugin/avatar',
    },
  }
}
```

### 插件组件接受外部 props

如果需要给插件传入参数，需要将参数统一放在组件的 `props` 中进行传入。

```js
// 常规 props 传递
<Plugin title={this.state.name} desc={this.state.desc} />

// 在使用插件组件时需要改造成以下形式：
const extraProps = {
  name: this.state.name,
  desc: this.state.desc
}
<Plugin props={extraProps} />
```

### 插件组件事件传递

微信小程序的 props 支持传递函数，因此我们也可以通过给插件组件传入函数 props 达到事件传递的目的。

```js
// 调用方传入事件回调函数
;<Plugin props={{ onSomeEvent() {} }} />

// 插件调用事件函数
this.props.onSomeEvent()
```

### 插件组件获取小程序渲染层元素

```js
// 通过 this.props.$scope 获取到小程序原生配置对象
const query = Taro.createSelectorQuery().in(this.props.$scope)
query
  .select('#id')
  .boundingClientRect()
  .exec((res) => {
    console.log(res)
  })
```

### componentGenerics

暂不支持 `componentGenerics`。

## 使用插件接口

plugin.json 的 **main** 字段加入接口插件路径：

```json title="plugin.json"
{
  "main": "index.js"
}
```

页面中使用：

```jsx
const myPluginInterface = Taro.requirePlugin('myPlugin')

export default class Index extends Component {
  componentWillMount () {
    myPluginInterface.sayHello()
    const answer = myPluginInterface.answer
    console.log('answer: ', answer)
  }
```
</file>

<file path="docs/mobx.md">
---
title: 使用 MobX
---

> 自 `1.2.0-beta.1` 开始支持

[MobX](https://mobx.js.org/) 为复杂项目中状态管理提供了一种简单高效的机制；Taro 提供了 `@tarojs/mobx` 来让开发人员在使用 MobX 的过程中获得更加良好的开发体验。

## 安装

```bash
$ yarn add mobx@4.8.0 @tarojs/mobx @tarojs/mobx-h5 @tarojs/mobx-rn
# 或者使用 npm
$ npm install --save mobx@4.8.0 @tarojs/mobx @tarojs/mobx-h5 @tarojs/mobx-rn
```

## API

### onError

Mobx 异常监听。

```jsx
import { onError } from '@tarojs/mobx'

onError((error) => {
  console.log('mobx global error listener:', error)
})
```

### isUsingStaticRendering

> 自 `1.3.6` 开始支持

判断是否开启了服务端渲染（该状态为全局状态）。

```jsx
import { isUsingStaticRendering } from '@tarojs/mobx'

if (isUsingStaticRendering()) {
  //...
}
```

### useStaticRendering

> 自 `1.3.6` 开始支持

服务端渲染状态设置（该状态为全局状态）。

```jsx
import { useStaticRendering } from '@tarojs/mobx'

useStaticRendering(false)
```

### useLocalStore

> 自 `1.3.6` 开始支持

将对象转换为 `observable` 对象，其中 `getter` 会被转换为 `computed` 属性，方法会与 `store` 进行绑定并自动执行
[mobx transactions](https://mobx.js.org/refguide/action.html)，比如：

```jsx
import Taro from '@tarojs/taro'
import { View, Text, Button } from '@tarojs/components'
import { useLocalStore, observer } from '@tarojs/mobx'

import './index.scss'

function Index() {
  const store = useLocalStore(() => ({
    counter: 0,
    increment() {
      store.counter++
    },
    decrement() {
      store.counter--
    },
    incrementAsync() {
      setTimeout(() => store.counter++, 1000)
    },
  }))

  const { counter, increment, decrement, incrementAsync } = store
  return (
    <View>
      <Button onClick={increment}>+</Button>
      <Button onClick={decrement}>-</Button>
      <Button onClick={incrementAsync}>Add Async</Button>
      <Text>{counter}</Text>
    </View>
  )
}

export default observer(Index)
```

### useAsObservableSource

> 自 `1.3.6` 开始支持

与 `useLocalStore` 的区别是，它将纯（不包含 `getter` 或方法）对象转换为 `observable`，主要使用场景为：

- 如果对象某个属性的值需经过复杂运算才能获得，可通过该方法进行包装，这样在组件的生命周期中该运算只需要运算一次。
- 一般情况下 `useLocalStore` 仅用于组件内部，如果 `useLocalStore` 中的对象需要依赖外部传递的属性，那么可通过
  `useAsObservableSource` 将这些属性进行转换，而后在 `useLocalStore` 对象中进行引用，这样在外部属性改变时自动通知
  `useLocalStore` 对象对变化进行响应，比如：

  ```jsx
  import Taro from '@tarojs/taro'
  import { View, Button, Text } from '@tarojs/components'
  import { useAsObservableSource, useLocalStore, observer } from '@tarojs/mobx'

  function Multiplier(props) {
    const observableProps = useAsObservableSource(props)
    const store = useLocalStore(() => ({
      counter: 1,
      get multiplied() {
        return observableProps.multiplier * store.counter
      },
      increment() {
        store.counter += 1
      },
    }))
    const { multiplier } = observableProps
    const { multiplied, counter, increment } = store
    return (
      <View>
        <Text>
          multiplier({multiplier}) * counter({counter}) = {multiplied}
        </Text>
        <Button onClick={increment}>Increment Counter</Button>
      </View>
    )
  }

  export default observer(Multiplier)
  ```

  该场景也可直接使用 `useLocalStore` 中的第二种用法来实现：

  ```jsx
  import Taro from '@tarojs/taro'
  import { View, Button, Text } from '@tarojs/components'
  import { useLocalStore, observer } from '@tarojs/mobx'

  function Multiplier(props) {
    const store = useLocalStore(
      (source) => ({
        counter: 1,

        get multiplier() {
          return source.multiplier
        },

        get multiplied() {
          return source.multiplier * store.counter
        },
        increment() {
          store.counter += 1
        },
      }),
      props
    )
    const { multiplied, counter, increment, multiplier } = store
    return (
      <View>
        <Text>
          multiplier({multiplier}) * counter({counter}) = {multiplied}
        </Text>
        <Button onClick={increment}>Increment Counter</Button>
      </View>
    )
  }

  export default observer(Multiplier)
  ```

### observer

将组件设置为监听者，以便在可观察对象的值改变后触发页面的重新渲染。

注：

- 不要在 `JSX` 中对可观察对象进行引用，比如：

  ```jsx
  // 错误，在小程序中值改变后将无法触发重新渲染
  const { counterStore } = this.props
  return <Text>{counterStore.counter}</Text>

  // 正确
  const {
    counterStore: { counter },
  } = this.props
  return <Text>{counter}</Text>
  ```

  > 这是因为 `@tarojs/mobx` 通过监听组件的 `render`（小程序编译后为 `_createData`）方法来触发更新；在小程序中，`JSX`
  > 的代码会被编译到 `wxml` 文件中，此时对可观察对象的引用（比如：`counterStore.counter`）早已脱离了
  > `@tarojs/mobx` 的监控，故此对该属性的更改并不会触发更新操作。

- 如使用 `@observable` 装饰器来定义可观察对象时，请确保该属性已经初始化，比如：

  ```js
  @observable counter // 错误，值改变后将无法触发重新渲染
  @observable counter = 0 // 正确
  ```

- 如果 `isUsingStaticRendering` 为 `true`，该方法不做任何事情。

### Provider

全局 `store` 设置，比如：

```jsx
import Taro, { Component } from '@tarojs/taro'
import { Provider } from '@tarojs/mobx'
import Index from './pages/index'
import counterStore from './store/counter'

const store = {
  counterStore,
}

class App extends Component {
  config = {
    pages: ['pages/index/index'],
    window: {
      backgroundTextStyle: 'light',
      navigationBarBackgroundColor: '#fff',
      navigationBarTitleText: 'WeChat',
      navigationBarTextStyle: 'black',
    },
  }

  render() {
    return (
      <Provider store={store}>
        <Index />
      </Provider>
    )
  }
}

Taro.render(<App />, document.getElementById('app'))
```

注：

- `Provider` 必须作用于入口文件（即：`src/app.js`），在其他地方使用无效。
- 不支持嵌套，即全局只能存在一个 `Provider`。
- 在 `mobx-react` 中，可通过以下方式设置 `store`：

  ```jsx
  <Provider store1={xxxx} store2={xxxx}>
    <XXX />
  </Provider>
  ```

  而在 `@tarojs/mobx` 中，我们需要使用以下方式设置：

  ```jsx
  const store = {
    store1: xxxx,
    store2: xxxx
  }
  <Provider store={store}>
    <XXX />
  </Provider>
  ```

### inject

将 `Provider` 中设置的 `store` 提取到组件的 `props` 中，该 `API` 只适用于`类组件`，比如：

```jsx
import Taro, { Component } from '@tarojs/taro'
import { observer, inject } from '@tarojs/mobx'

import './index.scss'

@inject('counterStore')
@observer
class Index extends Component {
  //...
}

export default Index
```

或

```jsx
import Taro, { Component } from '@tarojs/taro'
import { observer, inject } from '@tarojs/mobx'

import './index.scss'

@inject((stores, props) => ({
  counterStore: stores.counterStore,
}))
@observer
class Index extends Component {
  //...
}

export default Index
```

注：

- 无论以何种方式使用 `inject`，其后的 `observer` 均不能省略。
- 不要在 `inject` 中引用可观察对象，这将导致属性改变后页面不更新，比如：

  ```jsx
  // 错误
  @inject((stores, props) => ({
    counter: stores.counterStore.counter
  }))

  // 正确
  @inject((stores, props) => ({
    counterStore: stores.counterStore
  }))
  ```

### PropTypes

> 自 `1.3.6` 开始支持

`@tarojs/mobx` 提供了以下 `PropTypes` 来验证 Mobx 的结构：

- observableArray
- observableArrayOf
- observableMap
- observableObject
- arrayOrObservableArray
- arrayOrObservableArrayOf
- objectOrObservableObject

## 资源

示例：[taro-mobx-sample](https://github.com/nanjingboy/taro-mobx-sample)
</file>

<file path="docs/nutui.mdx">
---
title: 使用 NutUI 京东风格组件库
---

[NutUI](https://nutui.jd.com/#/) 已发布 4.0 版本，新版本支持 CSS 动态主题、抽离独立的 Icon 包、更高效的按需引入，提供 80+ 高质量组件，覆盖移动端主流场景。

NutUI 4.0 从功能、组件、性能、官网四方面放入手，不断在组件库的丰富性、轻量化、易用性上进行改进，力求打造一款好用的移动端组件库，为开发者提效，为业务赋能，为开源贡献一份力量。

## 预览体验

<img
  src="https://img12.360buyimg.com/imagetools/jfs/t1/162421/39/13392/9425/6052ea60E592310a9/264bdff23ef5fe95.png"
  width="150"
  alt="NutUI"
/>
<img
  src="https://storage.360buyimg.com/jdc-article/gh_f2231eb941be_258.jpg"
  width="150"
  alt="NutUI"
  style={{ marginLeft: '30px' }}
/>

&nbsp;

## 介绍

通过本文你可以掌握 NutUI 的安装和使用方法，操作简单易上手，开发简洁快速。

## 安装 Taro 脚手架

```bash
# 使用 npm 安装 CLI
npm install -g @tarojs/cli

# 使用 yarn 安装 CLI
yarn global add @tarojs/cli

# 使用 cnpm 安装 CLI
cnpm install -g @tarojs/cli
```

## 使用 NutUI 模板创建项目

#### 1、使用命令创建 Taro 项目：

```bash
taro init myApp
```

#### 2、按照下方图片依次选择，选择 Vue3 + NutUI4.0 模板

<img src="https://img14.360buyimg.com/imagetools/jfs/t1/201678/33/30837/74007/63bcd078F1954ad0f/3859610e4a9f2c0a.png" />

## 在 Taro 项目中使用 NutUI

#### 1、安装 NutUI

```
npm i @nutui/nutui-taro
```

#### 2、Taro 相关配置

安装 [@tarojs/plugin-html](./use-h5)

```bash
npm i @tarojs/plugin-html
```

在项目中配置

```javascript
// config/index.js
config = {
  // 开启 HTML 插件
  plugins: ['@tarojs/plugin-html'],
  // 配置全局 Scss 变量
  sass: {
    data: `@import "@nutui/nutui-taro/dist/styles/variables.scss";`,
  },
  // 配置 NutUI 375 尺寸
  designWidth: 375,
  deviceRatio: {
    640: 2.34 / 2,
    750: 1,
    828: 1.81 / 2,
    375: 2 / 1,
  },
}
```

#### 3、组件用法

**方法一、常规用法**

```javascript
// app.ts
import { createApp } from 'vue'
import { Button } from '@nutui/nutui-taro'
// 引入所有组件的样式文件
import '@nutui/nutui-taro/dist/style.css'

const App = createApp({
  onShow(options) {},
})
App.use(Button)
export default App
```

**方法二、自动按需引入**

安装 [unplugin-vue-components](https://github.com/antfu/unplugin-vue-components)

```bash
npm i unplugin-vue-components -D
```

在 `Taro` 中配置插件：

```javascript
// config/index.js
import ComponentsPlugin from 'unplugin-vue-components/webpack'

const NutUIResolver = () => {
  return (name) => {
    if (name.startsWith('Nut')) {
      const partialName = name.slice(3)
      return {
        name: partialName,
        from: '@nutui/nutui-taro',
        sideEffects: `@nutui/nutui-taro/dist/packages/${partialName.toLowerCase()}/style`,
      }
    }
  }
}

const config = {
  // 小程序开发
  mini: {
    webpackChain(chain) {
      chain.plugin('unplugin-vue-components').use(
        ComponentsPlugin({
          resolvers: [NutUIResolver()],
        })
      )
    },
  },
  // Taro-H5 开发
  h5: {
    webpackChain(chain) {
      chain.plugin('unplugin-vue-components').use(
        ComponentsPlugin({
          resolvers: [NutUIResolver()],
        })
      )
    },
  },
}
```

配置完成后，可以直接在模板中使用 NutUI 组件，`unplugin-vue-components` 插件会自动注册对应的组件，并按需引入组件样式。

```html
# 直接使用
<template>
  <nut-button></nut-button>
</template>
```

```javascript
# 移除手动引入和注册的代码
// import { Button } from '@nutui/nutui-taro';
// app.use(Button);
```

## 注意事项

#### 1、按需引入插件升级

NutUI 4.0 移除了 `babel-plugin-import` 插件的使用，按需引入样式不再依赖于 `babel`，开发者可以选择其他效率更高的编译工具。同时，NutUI 适配了支持自动引入和注册组件的 `unplugin-vue-components` 插件，这将使 `Taro` 的开发体验有所提升。

#### 2、检查 Taro 是否安装成功

```bash
taro -v
```

出现 Taro 版本号说明安装成功。

#### 3、安装 Taro 过程中出现 Saas 相关错误

可以考虑安装 `mirror-config-china` 后重试。

```bash
npm install -g mirror-config-china
```

#### 4、在 webpack 下使用按需引入时组件没有类型提示

解决方案：`unplugin-vue-components` 插件会为引入的组件自动生成全局类型文件 `components.d.ts`，请保留该文件并在 `tsconfig.json` 中将它添加至 `include` 字段中。

```json
{
  "include": [
    ...
    "components.d.ts"
  ],
}
```

#### 5、技术栈使用

工程开发需使用 **taro 3.5 以上版本 + vue3**，示例仓库：[taro3-nutui](https://github.com/jdf2e/nutui-demo/tree/master/taro)。
</file>

<file path="docs/optimized.mdx">
---
title: 小程序性能优化指南
---

import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

Taro 3 为了兼容 React、Vue 等 Web 开发框架，在运行时对浏览器环境进行模拟，实现了 BOM 和 DOM 等一系列 API。相比 Taro 1/2，Taro 3 是一款重运行时、轻编译时的框架，在性能方面会有一定损耗。因此 Taro 3 提供了一系列的性能优化手段，从而提升 Taro 3 应用的性能。

## 半编译模式 —— CompileMode

详情请看[半编译模式](./complier-mode)。

## 模版不使用 XS
:::info
`4.0.7` 开始支持
:::info

模版的拼接使用 xs，会有时间上的损耗，如果要追求极致的性能，可以禁用在模版中使用 xs，但这会导致包体积变大。
用法：

在 Taro 编译配置中禁用模版 xs：

```js title="config/index.js"
const config = {
  mini: {
    experimental: {
      useXsForTemplate: false
    }
  }
  // ...
}
```

## 使用 WXS

:::info
Taro v3.6.25 开始支持。目前只支持在 Taro React 小程序中使用，暂不支持 Taro Vue，暂不支持在其他端使用。
:::

借助 **CompileMode**，Taro 可以支持使用各类小程序的视图层脚步语言，如微信小程序的 `wxs`、支付宝小程序的 `sjs`、京东小程序的 `jds`、头条小程序的 `sjs` 等。

用法：

```jsx title="pages/index/index.jsx"
import { View, ScrollView, Script } from '@tarojs/components'

export default function Index() {
  return (
    {/* 首先需要开启编译模式 */}
    <View compileMode>

      {/* <Script> 组件等于小程序 <wxs> 组件，需要填写 src 和 module 属性，详情请参考小程序官方文档 */}
      <Script src='./animation.wxs' module='ani'></Script>

      {/* 访问 WXS 的导出值 */}
      <View>{ani.msg}</View>
      <View>{ani.getMsg()}</View>
      <View hoverClass={ani.hoverClass}></View>
      <View hoverClass={ani.getHoverClass()}></View>

      {/* WXS 响应事件 */}
      <ScrollView onScrollToUpper={ani.toupper}>
        <View onTouchStart={ani.touchstart} onTouchMove={ani.touchmove} onTouchEnd={ani.touchend}></View>
      </ScrollView>
    </View>
  )
}
```

## 优化初次渲染性能

:::tip
一般情况下不需要开启，请根据实际情况进行使用。
:::

当初次渲染的数据量非常大时，可能会导致页面白屏一段时间。因此 Taro 提供了[预渲染](prerender)功能来解决此问题。

## 优化更新性能

:::tip
经验证明，此项优化能大大减少 Taro3 的更新卡顿问题，尤其是在低端机上。
:::

Taro3 使用小程序的 `template` 进行渲染，一般情况下并不会使用原生自定义组件。这会导致一个问题，所有的 `setData` 更新都是由页面对象调用，如果我们的页面结构比较复杂，更新的性能就会下降。

层级过深时 `setData` 的数据结构：

```js
page.setData({
  'root.cn.[0].cn.[0].cn.[0].cn.[0].markers': [],
})
```

针对这个问题，主要的思路是**借用小程序的原生自定义组件，以达到局部更新的效果**，从而提升更新性能。

期望的 `setData` 数据结构：

```js
component.setData({
  'cn.[0].cn.[0].markers': [],
})
```

开发者有两种办法可以实现这个优化：

### 1. 全局配置项 baseLevel

对于不支持模板递归的小程序（微信、QQ、京东小程序），在 DOM 层级达到一定数量后，Taro 会使用原生自定义组件协助递归。

简单理解就是 DOM 结构超过 N 层后，会使用原生自定义组件进行渲染。N 默认是 16 层，可以通过修改配置项 [baseLevel](/docs/config-detail#minibaselevel) 修改 N。

把 `baseLevel` 设置为 `8` 甚至 `4` 层，能非常有效地提升更新时的性能。但是设置是全局性的，会带来若干问题：

1. `flex` 布局在跨原生自定义组件时会失效，这是影响最大的一个问题。
2. `SelectorQuery.select` 方法的[跨自定义组件的后代选择器](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/SelectorQuery.select.html)写法需要增加 `>>>`：`.the-ancestor >>> .the-descendant`

### 2. CustomWrapper 组件

为了解决全局配置不灵活的问题，我们增加了一个基础组件 `CustomWrapper`。它的作用是创建一个原生自定义组件，对后代节点的 `setData` 将由此自定义组件进行调用，达到局部更新的效果。

开发者可以使用它去**包裹遇到更新性能问题的模块**，提升更新时的性能。因为 `CustomWrapper` 组件需要手动使用，开发者能够清楚“这层使用了自定义组件，需要避免自定义组件的两个问题”。

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx title="示例代码"
import { View, Text } from '@tarojs/components'

export default function () {
  return (
    <View className="index">
      <Text>Demo</Text>
      <CustomWrapper>
        <GoodsList />
      </CustomWrapper>
    </View>
  )
}
```

</TabItem>

<TabItem value="Vue">

```html title="示例代码"
<template>
  <view class="index">
    <text>Demo</text>
    <custom-wrapper>
      <GoodsList />
    </custom-wrapper>
  </view>
</template>

<script>
  import GoodsList from '@/components/goods-list'

  export default {
    components: {
      GoodsList,
    },
  }
</script>
```

</TabItem>
</Tabs>

## 优化长列表性能

针对长列表的场景，Taro 提供了 [VirtualList](virtual-list) 组件辅助开发者进行优化。

它**只会渲染当前可视区域内的组件**，非可视区域的组件将会在用户滚动到可视区域内后再渲染，从而减少实际渲染的组件、优化渲染性能。

## 跳转预加载

:::info
Taro 1 / 2 中提供的 componentWillPreload 钩子在 Taro 3 中已废弃。
:::

在小程序中，从调用 `Taro.navigateTo` 等路由跳转 API 后，到小程序页面触发 `onLoad` 会有一定延时，因此一些网络请求可以提前到发起跳转的前一刻去请求。

Taro 3 提供了 `Taro.preload` API，可以把需要预加载的内容作为参数传入，然后在新页面加载后通过 `Taro.getCurrentInstance().preloadData` 获取到预加载的内容。

例子：

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx title="示例代码（用法一）"
// A 页面
// 调用跳转方法前使用 Taro.preload
Taro.preload(fetchSomething())
Taro.navigateTo({ url: '/pages/B/B' })

// B 页面
componentWillMount () {
  console.log(Taro.getCurrentInstance().preloadData)
}
```

</TabItem>

<TabItem value="Vue">

```js title="示例代码（用法一）"
// A 页面
// 调用跳转方法前使用 Taro.preload
Taro.preload(fetchSomething())
Taro.navigateTo({ url: '/pages/B/B' })

// B 页面
mounted () {
  console.log(Taro.getCurrentInstance().preloadData)
}
```

</TabItem>
</Tabs>

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx title="示例代码（用法二）"
// A 页面
Taro.preload('x', 1)
Taro.navigateTo({ url: '/pages/B/B' })

// B 页面
componentWillMount () {
  console.log(Taro.getCurrentInstance().preloadData)
}
```

</TabItem>

<TabItem value="Vue">

```js title="示例代码（用法二）"
// A 页面
Taro.preload('x', 1)
Taro.navigateTo({ url: '/pages/B/B' })

// B 页面
mounted () {
  console.log(Taro.getCurrentInstance().preloadData)
}
```

</TabItem>
</Tabs>

## 写法最佳实践

对小程序的性能影响较大的有两个因素，分别是 `setData` 的**数据量**和单位时间 `setData` 函数的**调用次数**。

当遇到性能问题时，在项目中打印 `setData` 的数据将非常有利于帮助定位问题。开发者可以通过进入 Taro 项目的 `dist/taro.js` 文件，搜索定位 `.setData` 的调用位置，然后对数据进行打印。

在 Taro 中，会对 `setData` 做 **batch** 捆绑更新操作，因此更多时候只需要考虑 **setData 的数据量大小**问题。

以下是我们梳理的开发者需要注意的写法问题：

### 1. 删除楼层节点要谨慎处理

假设有一种这样一种结构：

```jsx
<View>
  <!-- 轮播 -->
  <Slider />
  <!-- 商品组 -->
  <Goods />
  <!-- 模态弹窗 -->
  {isShowModal && <Modal />}
</View>
```

Taro3 目前对节点的删除处理是有缺陷的。当 `isShowModal` 由 `true` 变为 `false` 时，模态弹窗会从消失。此时 `Modal` 组件的兄弟节点都会被更新，`setData` 的数据是 `Slider` + `Goods` 组件的 DOM 节点信息。

一般情况下，影响不会太大，开发者无须由此产生心智负担。但倘若待删除节点的兄弟节点的 DOM 结构非常复杂，如一个个楼层组件，删除操作的副作用会导致 `setData` 数据量较大，从而影响性能。

##### 解决办法：

目前我们可以这样优化，隔离删除操作：

```jsx
<View>
  <!-- 轮播 -->
  <Slider />
  <!-- 商品组 -->
  <Goods />
  <!-- 模态弹窗 -->
  <View>
    {isShowModal && <Modal />}
  </View>
</View>
```

> 我们正在对删除节点的算法进行优化，完全规避这种不必要的 setData，于 v3.1 推出。

### 2. 基础组件的属性要保持引用

> React

假设基础组件（如 `View`、`Input` 等）的属性值为非基本类型时，尽量保持对象的引用。

假设有以下写法：

```jsx
<Map
  latitude={22.53332}
  longitude={113.93041}
  markers={[
    {
      latitude: 22.53332,
      longitude: 113.93041,
    },
  ]}
/>
```

每次渲染时，React 会对基础组件的属性做浅对比，这时发现 `markers` 的引用不同，就会去更新组件属性。最后导致 `setData` 次数增多、`setData` 数据量增大。

#### 解决办法：

可以通过 `state`、闭包等手段保持对象的引用：

```jsx
<Map latitude={22.53332} longitude={113.93041} markers={this.state.markers} />
```

### 3. 基础组件不要挂载额外属性

基础组件（如 `View`、`Input` 等）如若设置了非标准的属性，目前这些额外属性会被一并进行 `setData`，而实际上小程序并不会理会这些属性，所以 `setData` 的这部分数据是冗余的。

例如 `Text` 组件的标准属性有 `selectable`、`user-select`、`space `、`decode` 四个，如果我们为它设置一个额外属性 `something`，那么这个额外的属性也是会被 setData。

```jsx
<Text something="extra" />
```

## 实战文章

- [《Taro 助力京喜拼拼项目性能体验优化》](/blog/2021-02-08-taro-jxpp)
</file>

<file path="docs/ossa.md">
---
title: 使用 OSSA(React) UI组件库
---

> 注意：OSSA 目前必须使用 taro 3.x 版本 + **React 技术栈** 进行开发。

[OSSA](https://ossa.miaode.com/) 提供了 30+ 组件涵盖了日常业务开发使用的大部分组件。

## 预览体验

<img src='https://yanxuan.nosdn.127.net/static-union/1656314230833368.png' width='200' height='200' alt='OSSA DEMO' />
<img src='https://yanxuan.nosdn.127.net/static-union/16594970359a4f1b.png' width='200' height='200' alt='OSSA DEMO' />

## 如何使用

### 安装

- 通过 Npm 或 Yarn 安装

#### 安装 Taro 脚手架

```bash
# 使用 npm 安装 CLI
npm install -g @tarojs/cli

# OR 使用 yarn 安装 CLI
yarn global add @tarojs/cli

# OR 安装了 cnpm，使用 cnpm 安装 CLI
cnpm install -g @tarojs/cli
```

> 值得一提的是，如果安装过程出现 sass 相关的安装错误，请在安装 mirror-config-china 后重试。

```bash
npm install -g mirror-config-china
```

#### 检查是否安装成功

```bash
taro -v
```

#### 项目初始化

使用命令创建模板：

```bash
taro init myApp
```

#### 安装 OSSA

```bash
npm install ossaui
```

### 使用

#### 全量引入

1. 在入口文件中引入样式文件

```javascript
// app.tsx
import 'ossaui/dist/style/index.scss'

// 或者在app.scss中引入
@import 'ossaui/dist/style/index.scss'
```

2. 在页面中引入`OSSA`组件

```javascript title="page/index.tsx"
import { OsButton } from 'ossaui'

const demo = () => {
  return (
    <OsButton type="primary" onClick={() => handleClick()}>
      按钮
    </OsButton>
  )
}
```

#### 按需引入

全量引用会导致所有组件都打包进最终的产物中，所以更推荐按需引入

> 注意，目前组件库的按需引入需要借助一个 babel 插件[babel-plugin-import](https://github.com/umijs/babel-plugin-import)来实现

1. 安装插件

```bash
npm i babel-plugin-import -D
```

2. 添加配置：

```javascript title="babel.config.js"
{
  // ...
  plugins: [
    [
      'import',
      {
        libraryName: 'ossaui',
        customName: (name) => `ossaui/lib/components/${name.replace(/^os-/, '')}`,
        customStyleName: (name) => `ossaui/dist/style/components/${name.replace(/^os-/, '')}.scss`,
      },
      'ossaui',
    ],
  ]
}
```

3. 在页面中使用`OSSA`组件

```javascript title="page/index.tsx"
import { OsButton } from 'ossaui'

const demo = () => {
  return (
    <OsButton type="primary" onClick={() => handleClick()}>
      按钮
    </OsButton>
  )
}
```

#### 关闭组件库的 prebundle

:::tip
在 taro3.5 之后的版本中，在开启 prebundle(默认开启)的情况下，会导致`ossaui`所引用的`@taro/components`组件没有被打进最终的 bundle 中，导致页面表现异常。
:::

为了解决上述问题，可以手动将`ossaui`排除在 prebundle 列表之外。

```javascript title="config/index.js"
module.exports = {
  // ...
  framework: 'react',
  compiler: {
    type: 'webpack5',
    prebundle: {
      exclude: ['ossaui'],
    },
  },
}
```

#### 输出 H5 时编译组件

:::tip
在输出 H5 时，组件的尺寸可能会表现异常
:::
为了解决上述问题，可以配在在输出 H5 时，对`ossaui`进行 postcss 处理。

```javascript title="config/index.js"
module.exports = {
  // ...
  h5: {
    // ...
    esnextModules: ['ossaui'],
  },
}
```

#### 定制化主题

创建定制化主题样式文件 `src/styles/variables.scss` ，样式变量覆盖表参考 [OSSA UI variables](https://github.com/NeteaseYanxuan/OSSA/blob/main/packages/ossa/src/style/_variable.scss)

```scss title="src/styles/variables.scss"
$--text-color-base: #333;
$--color-border-base: #d9d9d9;
```

然后需要在 `config/index.js` 文件中配置 `scss` 文件全局覆盖如：

```javascript
const path = require('path');
const config = {
  deviceRatio: {
    640: 2.34 / 2,
    750: 1,
    828: 1.81 / 2,
    375: 2 / 1
  },
  sass: {
    resource: [
      path.resolve(__dirname, '..', 'src/styles/variables.scss')
    ]
  },
  // ...
```

### 预览

详细的 Taro 项目预览可参考[Taro 文档](https://docs.taro.zone/docs/GETTING-STARTED#%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C)

```bash
// 微信小程序预览
npm run dev:weapp

// h5预览
npm run dev:h5
```
</file>

<file path="docs/page-config.mdx">
---
title: 页面配置
---

import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

每一个小程序页面都可以使用 `.config.js` 文件来对本页面的窗口表现进行配置。页面中配置项在当前页面会覆盖全局配置 `app.config.json` 的 `window` 中相同的配置项。

文件需要 `export` 一个默认对象，配置项遵循**微信小程序规范**，并且对所有平台进行统一。

**注意：**

1. **Taro v3.4** 之前，`page.config.js` 里引用的 JS 文件**没有经过 Babel 编译**。(**Taro v3.4** 开始支持）
2. **Taro v3.4** 支持在页面 JS 中使用 `definePageConfig` 宏函数定义页面配置，代替 `page.config.js` 文件。
3. 多端差异化逻辑可以使用 `process.env.TARO_ENV` 变量作条件判断来实现。
4. `page.config.js` 不支持多端文件的形式，如 `index.weapp.js` 这样是不起作用的。

## definePageConfig 宏函数

:::info
Taro v3.4+ 支持
:::

开发者可以使用**编译时宏函数** `definePageConfig` 包裹配置对象，以获得**类型提示**和**自动补全**。

### 在页面配置文件中使用

```ts title="page.config.ts"
export default definePageConfig({
  navigationBarTitleText: '首页',
})
```

### 在页面 JS 文件中使用

支持在页面 JS 中使用 `definePageConfig` 定义页面配置，而不需要提供 `page.config.js` 文件。

但是需要注意的是，使用 `definePageConfig` 定义的页面配置对象**不能使用变量**。

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```tsx title="page.ts"
definePageConfig({
  navigationBarTitleText: '首页',
})

export default function Index() {}
```

</TabItem>

<TabItem value="Vue">

```html title="page.vue"
<template>
  <view className="index" />
</template>

<script>
  definePageConfig({
    navigationBarTitleText: '首页',
  })

  export default {}
</script>
```

</TabItem>
</Tabs>

## 配置项列表

| 属性                         | 类型                       | 默认值   | 描述                                                                                  |
| ---------------------------- | -------------------------- | -------- | ------------------------------------------------------------------------------------- |
| navigationBarBackgroundColor | HexColor（十六进制颜色值）    | #000000  | 导航栏背景颜色，如 #000000                                                            |
| navigationBarTextStyle       | String                     | white    | 导航栏标题颜色，仅支持 black / white                                                  |
| navigationBarTitleText       | String                     |          | 导航栏标题文字内容                                                                    |
| navigationStyle              | String                     | default  | 导航栏样式，仅支持以下值：default 默认样式；custom 自定义导航栏，只保留右上角胶囊按钮 |
| transparentTitle             | String                     | none     | 导航栏透明设置。支持 always 一直透明 / auto 滑动自适应 / none 不透明                  |
| backgroundColor              | String                     |          | 窗口的背景色                                                                          |
| backgroundTextStyle          | String                     | dark     | 下拉 loading 的样式，仅支持 dark / light                                              |
| backgroundColorTop           | String                     | #ffffff  | 顶部窗口的背景色，仅 iOS 支持                                                         |
| backgroundColorBottom        | String                     | #ffffff  | 底部窗口的背景色，仅 iOS 支持                                                         |
| enablePullDownRefresh        | boolean                    | false    | 是否开启当前页面的下拉刷新。                                                          |
| onReachBottomDistance        | Number                     | 50       | 页面上拉触底事件触发时距页面底部距离，单位为 px                                       |
| pageOrientation              | String                     | portrait | 屏幕旋转设置，支持 auto / portrait / landscape 详见 响应显示区域变化                  |
| disableScroll                | Boolean                    | false    | 设置为 true 则页面整体不能上下滚动。<br />只在页面配置中有效，无法在 app.json 中设置      |
| disableSwipeBack             | Boolean                    | false    | 禁止页面右滑手势返回                                                                  |
| enableShareAppMessage        | Boolean                    | false    | 是否启用分享给好友。                                                                  |
| enableShareTimeline          | Boolean                    | false    | 是否启用分享到朋友圈。                                                                 |
| usingComponents              | Object                     | 否       | 页面自定义组件配置                                                                    |
| renderer                     | String                     | webview  | 渲染后端                                                                          |

其中，`usingComponents` 一般不需要配置，只有在需要与引用原生小程序组件的时候才需要配置。

### 各端支持程度

属性                         | 微信小程序                         | 百度小程序                 | 抖音小程序 | 支付宝小程序 | H5  | RN  |                  ASCF|
| ---------------------------- | ---------------------------------- | -------------------------- | -------------- | ------------ | --- | --- |--------- |
| navigationBarBackgroundColor | ✔️                                 | ✔️                         | ✔️             | ✔️           | ✔️  | ✔️  | ✔️     |
| navigationBarTextStyle       | ✔️                                 | ✔️                         | ✔️             | ✘            | ✔️  | ✔️  | ✔️     |
| navigationBarTitleText       | ✔️                                 | ✔️                         | ✔️             | ✔️           | ✔️  | ✔️  | ✔️     |
| navigationStyle              | ✔️（微信客户端 6.6.0）               | ✔️（百度 App 版本 11.1.0）   | ✔️             | ✘            | ✘   | ✔️  | ✔️     |
| transparentTitle             | -                                  | -                          | -              | ✔️           | -   | -   | ✘     |
| backgroundColor              | ✔️                                 | ✔️                         | ✔️             | ✘            | ✘   | ✔️  | ✔️     |
| backgroundTextStyle          | ✔️                                 | ✔️                         | ✔️             | ✘            | ✘   | ✔️  | ✘     |
| backgroundColorTop           | ✔️（微信客户端 6.5.16）              | ✘                          | ✔️             | ✘            | ✘   | ✘   | ✘    |
| backgroundColorBottom        | ✔️（微信客户端 6.5.16）              | ✘                          | ✔️             | ✘            | ✘   | ✘   | ✘     |
| enablePullDownRefresh        | ✔️                                 | ✔️                          | ✔️              | ✔️            | ✘   | ✘   | ✔️    |
| onReachBottomDistance        | ✔️                                 | ✔️                          | ✔️              | ✘            | ✘   | ✘   | ✘    |
| pageOrientation              | ✔️2.4.0 (auto) / 2.5.0 (landscape) | ✘                          | ✘              | ✘            | ✘   | ✘   | ✘    |
| disableScroll                | ✔️                                 | ✘                          | ✘              | ✘            | ✘   | ✔️   | ✘    |
| disableSwipeBack             | ✔️                                 | ✘                          | ✘              | ✘            | ✘   | ✘   | ✘   |
| enableShareAppMessage        | ✔️                                 | ✘                          | ✘              | ✘            | ✔️   | ✘   | ✘  |
| enableShareTimeline          | ✔️                                 | ✘                          | ✘              | ✘            | ✔️   | ✘   | ✘ |
| usingComponents              | ✔️                                 | ✔️                          | ✔️              | ✔️            | ✘   | ✘   | ✔️     |
| renderer                     | ✔️                                 | ✘                          | ✘              | ✘            | ✘   | ✘   | ✘    |
</file>

<file path="docs/pinia.md">
---
title: Vue3 Pinia
---

Taro Vue3 支持使用 [Pinia](https://pinia.vuejs.org/) 进行状态管理。

## 安装

```bash
$ yarn add pinia
# 或者使用 npm
$ npm install pinia
```

> pinia@2.0.22 已经解决了这个问题（[#967](https://github.com/vuejs/pinia/pull/967)）, 所以你可能不再需要这个插件

## 例子

- 运行 `taro init` 命令时选择 Vue3 -> pinia 即可创建 vue3-pinia 模板项目
- [Todo App](https://github.com/NervJS/taro-todos-pinia)

## 使用

### 创建 Pinia 实例

```js title="src/app.js"
import { createApp } from 'vue'
import { createPinia } from 'pinia'

const App = createApp({})

App.use(createPinia())

export default App
```

### 创建 `store`

在项目中新建 `src/store/index.js` 文件用来配置 `store`：

```js title="src/store/index.js"
import { defineStore } from 'pinia'

export const useCounterStore = defineStore('counter', {
  state: () => {
    return { count: 0 }
  },
  actions: {
    increment() {
      this.count++
    },
  },
})
```

### 使用 store 定义的数据与方法

```html
<template>
  <view>
    <text>{{ counter.count }}</text>
    <view @tap="onAdd">ADD</view>
  </view>
</template>

<script>
  import { useCounterStore } from '../stores'

  export default {
    setup() {
      const counter = useCounterStore()

      const onAdd = () => {
        counter.count++
      }

      return {
        counter,
        onAdd,
      }
    },
  }
</script>
```
</file>

<file path="docs/plugin-custom.md">
---
title: 编写插件
---

## 快速开始

```bash
# 生成用于扩展命令行的插件模版
$ taro create plugin-name --type=plugin-command
# 生成用于扩展编译时的插件模版
$ taro create plugin-name --type=plugin-build
# 生成用于扩展自定义页面模版的插件模版
$ taro create plugin-name --type=plugin-template
```

### 代码结构

Taro 的插件都具有固定的代码结构，通常由一个函数组成，示例如下：

```typescript
export default (ctx, options) => {
  // plugin 主体
  ctx.onBuildStart(() => {
    console.log('编译开始！')
  })
  ctx.onBuildFinish(() => {
    console.log('Webpack 编译结束！')
  })
  ctx.onBuildComplete(() => {
    console.log('Taro 构建完成！')
  })
}
```

插件函数可以接受两个参数：

- ctx：插件当前的运行环境信息，包含插件相关的 API、当前运行参数、辅助方法等等
- options：为插件调用时传入的参数

在插件主体代码部分可以按照自己的需求编写相应代码。

### Typings

建议使用 typescript 来编写插件，这样你就会获得很棒的智能提示，使用方式如下：

```typescript
import { IPluginContext } from '@tarojs/service'
export default (ctx: IPluginContext, pluginOpts) => {
  // 接下来使用 ctx 的时候就能获得智能提示了
  ctx.onBuildStart(() => {
    console.log('编译开始！')
  })
}
```

## 插件功能

### 命令行扩展

你可以通过编写插件来为 Taro 拓展命令行的命令，在之前版本的 Taro 中，命令行的命令是固定的，如果你要进行扩展，那你得直接修改 Taro 源码，而如今借助插件功能，你可以任意拓展 Taro 的命令行。

这个功能主要通过 `ctx.registerCommand` API 来进行实现，例如，增加一个上传的命令，将编译后的代码上传到服务器：

```typescript
export default (ctx) => {
  ctx.registerCommand({
    // 命令名
    name: 'upload',
    // 执行 taro upload --help 时输出的 options 信息
    optionsMap: {
      '--remote': '服务器地址',
    },
    // 执行 taro upload --help 时输出的使用例子的信息
    synopsisList: ['taro upload --remote xxx.xxx.xxx.xxx'],
    async fn() {
      const { remote } = ctx.runOpts
      await uploadDist()
    },
  })
}
```

将这个插件配置到中项目之后，就可以通过 `taro upload --remote xxx.xxx.xxx.xxx` 命令将编译后代码上传到目标服务器。

### 编译过程扩展

同时你也可以通过插件对代码编译过程进行拓展。

正如前面所述，针对编译过程，有 `onBuildStart`、`onBuildFinish`、`onBuildComplete` 三个钩子来分别表示编译开始，编译结束和构建完成，而除此之外也有更多 API 来对编译过程进行修改，如下：

- `ctx.onBuildStart(() => void)`，编译开始，接收一个回调函数
- `ctx.modifyWebpackChain(args: { chain: any }) => void)`，编译中修改 webpack 配置，在这个钩子中，你可以对 webpackChain 作出想要的调整，等同于配置 [`webpackChain`](./config-detail#miniwebpackchain)
- `ctx.modifyBuildAssets(args: { assets: any }) => void)`，修改编译后的结果
- `ctx.onBuildFinish(() => void)`，编译结束，接收一个回调函数。在每次 Webpack 编译后都会被触发。如果是在 watch 模式下，那么每当有文件改变触发 Webpack 编译时，都会触发 `onBuildFinish` 钩子。
- `ctx.onBuildComplete(() => void)`，构建完成，接收一个回调函数。在 Taro 构建命令结束后被触发，与 `onBuildFinish` 钩子的区别在于其只会被触发一次。

### 编译平台拓展

参考[扩展编译平台](./platform-plugin)

### 创建页面自定义模版扩展

通过 `ctx.modifyCreateTemplate(setCustomTemplateConfig:TSetCustomTemplateConfig)` 这个钩子，可以对 taro create 创建出来的页面模版进行修改。

`setCustomTemplateConfig` 是一个回调函数，其类行为：

```typescript
type TSetCustomTemplateConfig = (customTemplateConfig: TCustomTemplateInfo) => void
type TCustomTemplateInfo = {
  customTemplatePath?: string
  css: 'none' | 'sass' | 'stylus' | 'less'
  typescript?: boolean
  compiler?: 'webpack4' | 'webpack5' | 'vite'
  template?: string
}
```

只需要按照 taro 模版的格式，编写好需要的模版（模版编写参考[模版格式](./template)，静态模版与动态模版均支持），并且下载到电脑本地任意一个目录下，把该目录的绝对路径赋值给 `customTemplateConfig.customTemplatePath`，如果是动态模版，那么可以根据编写的模版的 template_creator.js，配置需要的其他参数，最后生成完整的 `customTemplateConfig` 对象，作为参数调用 `setCustomTemplateConfig` 即可。

通过运行 `taro create plugin-name --type=plugin-template` 会生成一个插件示例，可根据具体需求进行修改。

## API

通过以上内容，我们已经大致知道 Taro 插件可以实现哪些特性并且可以编写一个简单的 Taro 插件了，但是，为了能够编写更加复杂且标准的插件，我们需要了解 Taro 插件机制中的具体 API 用法。

### 插件环境变量

#### ctx.paths

包含当前执行命令的相关路径，所有的路径如下（并不是所有命令都会拥有以下所有路径）：

- `ctx.paths.appPath`，当前命令执行的目录，如果是 `build` 命令则为当前项目路径
- `ctx.paths.configPath`，当前项目配置目录，如果 `init` 命令，则没有此路径
- `ctx.paths.sourcePath`，当前项目源码路径
- `ctx.paths.outputPath`，当前项目输出代码路径
- `ctx.paths.nodeModulesPath`，当前项目所用的 node_modules 路径

#### ctx.runOpts

获取当前执行命令所带的参数，例如命令 `taro upload --remote xxx.xxx.xxx.xxx`，则 `ctx.runOpts` 值为：

```js
{
  _: ['upload'],
  options: {
    remote: 'xxx.xxx.xxx.xxx'
  },
  isHelp: false
}
```

#### ctx.helper

为包 `@tarojs/helper` 的快捷使用方式，包含其所有 API。

#### ctx.initialConfig

获取项目配置。

#### ctx.plugins

获取当前所有挂载的插件。

### 插件方法

Taro 的插件架构基于 [Tapable](https://github.com/webpack/tapable)。

#### ctx.register(hook: IHook)

注册一个可供其他插件调用的钩子，接收一个参数，即 Hook 对象。

一个 Hook 对象类型如下：

```typescript
interface IHook {
  // Hook 名字，也会作为 Hook 标识
  name: string
  // Hook 所处的 plugin id，不需要指定，Hook 挂载的时候会自动识别
  plugin: string
  // Hook 回调
  fn: Function
  before?: string
  stage?: number
}
```

通过 `ctx.register` 注册过的钩子需要通过方法 `ctx.applyPlugins` 进行触发。

我们约定，按照传入的 Hook 对象的 `name` 来区分 Hook 类型，主要为以下三类：

- 事件类型 Hook，Hook name 以 `on` 开头，如 `onStart`，这种类型的 Hook 只管触发而不关心 Hook 回调 fn 的值，Hook 的回调 fn 接收一个参数 `opts` ，为触发钩子时传入的参数
- 修改类型 Hook，Hook name 以 `modify` 开头，如 `modifyBuildAssets`，这种类型的 Hook 触发后会返回做出某项修改后的值，Hook 的回调 fn 接收两个参数 `opts` 和 `arg` ，分别为触发钩子时传入的参数和上一个回调执行的结果
- 添加类型 Hook，Hook name 以 `add` 开头，如 `addConfig`，这种类型 Hook 会将所有回调的结果组合成数组最终返回，Hook 的回调 fn 接收两个参数 `opts` 和 `arg` ，分别为触发钩子时传入的参数和上一个回调执行的结果

如果 Hook 对象的 `name` 不属于以上三类，则该 Hook 表现情况类似事件类型 Hook。

钩子回调可以是异步也可以是同步，同一个 Hook 标识下一系列回调会借助 Tapable 的 AsyncSeriesWaterfallHook 组织为异步串行任务依次执行。

#### ctx.registerMethod(arg: string | { name: string, fn?: Function }, fn?: Function)

向 `ctx` 上挂载一个方法可供其他插件直接调用。

主要调用方式：

```typescript
ctx.registerMethod('methodName')
ctx.registerMethod('methodName', () => {
  // callback
})
ctx.registerMethod({
  name: 'methodName',
})
ctx.registerMethod({
  name: 'methodName',
  fn: () => {
    // callback
  },
})
```

其中方法名必须指定，而对于回调函数则存在两种情况。

##### 指定回调函数

则直接往 `ctx` 上进行挂载方法，调用时 `ctx.methodName` 即执行 `registerMethod` 上指定的回调函数。

##### 不指定回调函数

则相当于注册了一个 `methodName` 钩子，与 `ctx.register` 注册钩子一样需要通过方法 `ctx.applyPlugins` 进行触发，而具体要执行的钩子回调则通过 `ctx.methodName` 进行指定，可以指定多个要执行的回调，最后会按照注册顺序依次执行。

内置的编译过程中的 API 如 `ctx.onBuildStart` 等均是通过这种方式注册。

#### ctx.registerCommand(hook: ICommand)

注册一个自定义命令。

```typescript
interface ICommand {
  // 命令别名
  alias?: string
  // 执行 taro <command> --help 时输出的 options 信息
  optionsMap?: {
    [key: string]: string
  }
  // 执行 taro <command> --help 时输出的使用例子的信息
  synopsisList?: string[]
}
```

使用方式：

```typescript
ctx.registerCommand({
  name: 'create',
  fn() {
    const { type, name, description } = ctx.runOpts
    const { chalk } = ctx.helper
    const { appPath } = ctx.paths
    if (typeof name !== 'string') {
      return console.log(chalk.red('请输入需要创建的页面名称'))
    }
    if (type === 'page') {
      const Page = require('../../create/page').default
      const page = new Page({
        pageName: name,
        projectDir: appPath,
        description,
      })
      page.create()
    }
  },
})
```

#### ctx.registerPlatform(hook: IPlatform)

注册一个编译平台。

```typescript
interface IFileType {
  templ: string
  style: string
  script: string
  config: string
}
interface IPlatform extends IHook {
  // 编译后文件类型
  fileType: IFileType
  // 编译时使用的配置参数名
  useConfigName: String
}
```

使用方式：

```typescript
ctx.registerPlatform({
  name: 'alipay',
  useConfigName: 'mini',
  async fn({ config }) {
    const { appPath, nodeModulesPath, outputPath } = ctx.paths
    const { npm, emptyDirectory } = ctx.helper
    emptyDirectory(outputPath)
    // 准备 miniRunner 参数
    const miniRunnerOpts = {
      ...config,
      nodeModulesPath,
      buildAdapter: config.platform,
      isBuildPlugin: false,
      globalObject: 'my',
      fileType: {
        templ: '.awml',
        style: '.acss',
        config: '.json',
        script: '.js',
      },
      isUseComponentBuildPage: false,
    }
    // build with webpack
    const miniRunner = await npm.getNpmPkg('@tarojs/mini-runner', appPath)
    await miniRunner(appPath, miniRunnerOpts)
  },
})
```

#### ctx.applyPlugins(args: string | { name: string, initialVal?: any, opts?: any })

触发注册的钩子。

传入的钩子名为 `ctx.register` 和 `ctx.registerMethod` 指定的名字。

这里值得注意的是如果是**修改类型**和**添加类型**的钩子，则拥有返回结果，否则不用关心其返回结果。

使用方式：

```typescript
ctx.applyPlugins('onStart')
const assets = await ctx.applyPlugins({
  name: 'modifyBuildAssets',
  initialVal: assets,
  opts: {
    assets,
  },
})
```

#### ctx.addPluginOptsSchema(schema: Function)

为插件入参添加校验，接受一个函数类型参数，函数入参为 joi 对象，返回值为 joi schema。

使用方式：

```typescript
ctx.addPluginOptsSchema((joi) => {
  return joi.object().keys({
    mocks: joi.object().pattern(joi.string(), joi.object()),
    port: joi.number(),
    host: joi.string(),
  })
})
```

#### ctx.writeFileToDist({ filePath: string, content: string })

向编译结果目录中写入文件，参数：

- filePath: 文件放入编译结果目录下的路径
- content: 文件内容

#### ctx.generateFrameworkInfo({ platform: string })

生成编译信息文件 .frameworkinfo，参数：

- platform: 平台名

#### ctx.generateProjectConfig({ srcConfigName: string, distConfigName: string })

根据当前项目配置，生成最终项目配置，参数：

- srcConfigName: 源码中配置名
- distConfigName: 最终生成的配置名
</file>

<file path="docs/plugin-mini-ci.md">
---
title: 小程序持续集成
---

Taro 小程序端构建后支持 CI（持续集成）的插件 `@tarojs/plugin-mini-ci`。
目前已支持（企业）微信、京东、字节、支付宝、钉钉、百度小程序

功能包括：

- 构建完毕后自动唤起小程序开发者工具并打开项目
- 上传代码作为开发版并生成预览二维码
- 上传代码作为体验版并生成体验二维码
- 支持 上传、预览 hooks 回调

## 使用

### 安装

```shell
npm i @tarojs/plugin-mini-ci -D
```

> 本插件 Taro 3.x 版本均可使用，无需和其他 taro 包版本号保持一致；[点击](https://www.npmjs.com/package/@tarojs/plugin-mini-ci?activeTab=versions)查看最新版本。

### 使用插件

`/config/index.js`

```js
// 示例, 如果你使用 `vs code` 作为开发工具， 你还可以使用注释的语法引入插件包含的声明文件，可获得类似于typescript的友好提示
/**
 * @typedef { import("@tarojs/plugin-mini-ci").CIOptions } CIOptions
 * @type {CIOptions}
 */
const CIPluginOpt = {
  weapp: {
    appid: '微信小程序appid',
    privateKeyPath: '密钥文件相对项目根目录的相对路径，例如 key/private.appid.key',
  },
  tt: {
    email: '字节小程序邮箱',
    password: '字节小程序密码',
  },
  alipay: {
    appid: '支付宝小程序appid',
    toolId: '工具id',
    privateKeyPath: '密钥文件相对项目根目录的相对路径，例如 key/pkcs8-private-pem',
  },
  dd: {
    appid: '钉钉小程序appid,即钉钉开放平台后台应用管理的 MiniAppId 选项',
    token: '令牌，从钉钉后台获取',
  },
  swan: {
    token: '鉴权需要的token令牌',
  },
  // 版本号
  version: '1.0.0',
  // 版本发布描述
  desc: '版本描述',
}
const config = {
  plugins: [['@tarojs/plugin-mini-ci', CIPluginOpt]],
}
```

除了给插件传入对象， 你也可以传入一个异步函数，在编译时动态返回相关配置。

```js
const CIPluginFn = async () => {
  // 可以在这里做一些异步事情， 比如请求接口获取配置
  /**
   * @typedef { import("@tarojs/plugin-mini-ci").CIOptions } CIOptions
   * @type {CIOptions}
   */
  return {
    weapp: {
      appid: '微信小程序appid',
      privateKeyPath: '密钥文件相对项目根目录的相对路径，例如 key/private.appid.key',
    },
    tt: {
      email: '字节小程序邮箱',
      password: '字节小程序密码',
    },
    alipay: {
      appid: '支付宝小程序appid',
      toolId: '工具id',
      privateKeyPath: '密钥文件相对项目根目录的相对路径，例如 key/pkcs8-private-pem',
    },
    dd: {
      appid: '钉钉小程序appid,即钉钉开放平台后台应用管理的 MiniAppId 选项',
      token: '令牌，从钉钉后台获取',
    },
    swan: {
      token: '鉴权需要的token令牌',
    },
    // 版本号
    version: '1.0.0',
    // 版本发布描述
    desc: '版本描述',
  }
}

const config = {
  plugins: [['@tarojs/plugin-mini-ci', CIPluginFn]],
}
```

### 作为选项配合 build 命令使用

`package.json` 的 `scripts` 字段使用命令参数

```json
{
  "scripts": {
    //  构建完后自动 “打开开发者工具”
    "build:weapp": "taro build --type weapp --open",
    //  构建完后自动 “上传代码作为开发版并生成预览二维码”
    "build:weapp:preview": "taro build --type weapp --preview",
    //  构建完后自动“上传代码作为体验版”
    "build:weapp:upload": "taro build --type weapp --upload",
    //  构建完后自动“上传 dist/xxx 目录的代码作为体验版”， `--projectPath` 参数 适用于 taro 和 原生混合的场景
    "build:weapp:upload": "taro build --type weapp --upload --projectPath dist/xxx"
  },
  "taroConfig": {
    "version": "1.0.0",
    "desc": "上传描述"
  }
}
```

由上面的示例可知，插件为 taro cli 命令扩展了 4 个选项：

- --open
  打开开发者工具，类似于网页开发中自动打开谷歌浏览器
- --preview
  上传代码作为开发版并生成预览二维码
- --upload
  上传代码作为体验版

此 3 个选项在一条命令里不能同时使用（互斥）

- --projectPath
  指定要操作（打开、预览、上传）的目录路径， 默认情况下是操作构建后目录路径，即 [outputRoot 选项](./config-detail#outputroot)；

此选项必须搭配上述三个选项之一一起使用；

此选项优先级为： 终端传入的`--projectPath` > CI 配置的`projectPath` 选项 > [outputRoot 选项](./config-detail#outputroot)。

### 作为命令单独使用（3.6.0 开始支持）

```json
{
  "scripts": {
    //  直接 “打开开发者工具并载入项目”
    "build:weapp": "taro open --type weapp  --projectPath dist/xxx",
    //  直接 “上传代码作为开发版并生成预览二维码”
    "build:weapp:preview": "taro preview --type weapp",
    //  直接“上传代码作为体验版”
    "build:weapp:upload": "taro upload --type weapp",
    //  上传指定目录代码作为体验版
    "build:weapp:upload2": "taro upload --type weapp --projectPath dist/xxx"
  },
  "taroConfig": {
    "version": "1.0.0",
    "desc": "上传描述"
  }
}
```

由上面的示例可知，插件额外新增了 3 个独立命令，让你可以直接操作指定目录。适用于把 `taro` 作为项目一部分的使用场景。

当直接作为命令使用时，有两个选项：

- --type
  传入平台名称
- --projectPath
  传入路径。 此选项优先级为： 终端传入的`--projectPath` > CI 配置的`projectPath` 选项 > [outputRoot 选项](./config-detail#outputroot)

### Hooks 使用（3.6.0 开始支持）

在插件执行完 `预览`、`上传` 操作后， 插件会触发 2 个钩子事件：

| 事件名            | 传递参数对象 | 说明              |
| :---------------- | :----------- | :---------------- |
| onPreviewComplete | 详细见下文   | CI 执行预览后触发 |
| onUploadComplete  | 详细见下文   | CI 执行上传后触发 |

两个钩子被触发时传入的数据对象描述如下

```ts
interface HooksData {
  /** 是否预览、构建成功 */
  success: boolean
  data: {
    /** 当前构建的小程序平台 */
    platform: string
    /** 预览码本地路径 */
    qrCodeLocalPath: string
    /** 预览码内容 */
    qrCodeContent: string
    /** 插件传递的预览版本号 */
    version: string
    /** 插件传递的描述文本 */
    desc: string
    /** 预览或上传的目录路径 */
    projectPath: string
  }
  /** 错误对象 */
  error?: Error
}
```

你可以写一个自定义插件，来接收上述 2 个事件传递的值：

```js
// config/test.js
module.exports = function (ctx) {
  ctx.register({
    name: 'onPreviewComplete',
    fn: ({ success, data, error }) => {
      console.log('接收预览后数据', success, data, error)
      // 你可以在这里发送钉钉或者飞书消息
    },
  })
  ctx.register({
    name: 'onUploadComplete',
    fn: ({ success, data, error }) => {
      console.log('接收上传后数据', success, data, error)
      // 你可以在这里发送钉钉或者飞书消息
    },
  })
}
```

然后把自己写的插件配置应用起来：

```js
// config/index.js
const config = {
  plugins: [
    ['@tarojs/plugin-mini-ci', CI插件参数],
    // 应用自己写的插件
    require('path').join(__dirname, './test'),
  ],
  // 其他配置省略
}

module.exports = function (merge) {
  if (process.env.NODE_ENV === 'development') {
    return merge({}, config, require('./dev'))
  }
  return merge({}, config, require('./prod'))
}
```

### 各平台 支持的功能情况对比

| 平台/功能 | 自动打开 IDE | 输出预览二维码 | 输出体验二维码 |
| :-------- | :----------- | :------------- | :------------- |
| weapp     | ✅           | ✅             | ✅             |
| qywx      | ✅           | ✅             | ✅             |
| tt        | ✅           | ✅             | ✅             |
| alipay    | ✅           | ✅             | ✅             |
| dd        | ✅           | ✅             | ❌             |
| swan      | ✅           | ✅             | ✅             |

> ps: 各平台上传都是支持的，只是不一定会输出二维码
> 企业微信和微信的各项参数是一样的，共用一个配置

## API

### 插件配置

| 参数        | 类型   | 说明                                                                                |
| :---------- | :----- | :---------------------------------------------------------------------------------- |
| weapp       | Object | （企业）微信小程序 CI 配置                                                          |
| tt          | Object | 抖音小程序配置                                                                      |
| alipay      | Object | 支付宝小程序配置                                                                    |
| dd          | Object | 钉钉小程序配置（3.6.0 版本开始支持）                                                |
| swan        | Object | 百度小程序配置                                                                      |
| version     | string | 上传版本号，不传时默认读取 package.json 下的 taroConfig 下的 version 字段           |
| desc        | string | 上传时的描述信息，不传时默认读取 package.json 下的 taroConfig 下的 desc 字段        |
| projectPath | string | 目标项目目录，对所有小程序生效（不传默认取 outputRoot 字段 ）（3.6.0 版本开始支持） |

### （企业）微信小程序 CI 配置

| 参数                | 类型     | 说明                                                                                     |
| :------------------ | :------- | :--------------------------------------------------------------------------------------- |
| appid               | string   | 小程序/小游戏项目的 appid                                                                |
| privateKeyPath      | string   | 私钥文件在项目中的相对路径，在获取项目属性和上传时用于鉴权使用                           |
| devToolsInstallPath | string   | 微信开发者工具安装路径，如果你安装微信开发者工具时选的默认路径，则不需要传入此参数(选填) |
| projectPath         | string   | 上传的小程序的路径（默认取的 outputRoot ）（3.6.0 版本已废弃）                           |
| ignores             | string[] | 上传需要排除的目录(选填)                                                                 |
| robot               | number   | 指定使用哪一个 ci 机器人，可选值：1 ~ 30(选填, 3.6.0 版本开始支持)                       |

官方 CI 文档[点这里](https://developers.weixin.qq.com/miniprogram/dev/devtools/ci.html)

### 抖音小程序 CI 配置

| 参数     | 类型   | 说明           |
| :------- | :----- | :------------- |
| email    | string | 字节小程序邮箱 |
| password | string | 字节小程序密码 |

官方 CI 文档[点这里](https://developer.open-douyin.com/docs/resource/zh-CN/mini-app/develop/developer-instrument/development-assistance/ide-order-instrument/)

### 支付宝小程序 CI 配置

| 参数                | 类型   | 说明                                                                                                                |
| :------------------ | :----- | :------------------------------------------------------------------------------------------------------------------ |
| appid               | string | 小程序 appid(`3.6.0` 之前参数名是 `appId` ， `3.6.0` 开始统一成`appid`)                                             |
| toolId              | string | 工具 id，[查看这里复制](https://open.alipay.com/dev/workspace/key-manage/tool)                                      |
| privateKeyPath      | string | 密钥文件相对项目根目录的相对路径, 私钥可通过[支付宝开放平台开发助手](https://opendocs.alipay.com/common/02kipl)生成 |
| privateKey          | string | 私钥文本内容, 生成方式同上(privateKeyPath 和 privateKey 之间必须要填写其中一个； 3.6.0 版本开始支持)                |
| devToolsInstallPath | string | 小程序开发者工具安装路径(选填, 3.6.0 版本开始支持)                                                                  |
| clientType          | string | 上传的终端,终端类型见下表（选填，默认值 alipay）                                                                    |

```md
终端类型值及其含义：

alipay: 支付宝

ampe：AMPE

amap：高德

genie：天猫精灵

alios：ALIOS

uc：UC

quark：夸克

koubei：口碑

alipayiot：IoT

cainiao：菜鸟

alihealth：阿里健康

health: 阿里医院
```

官方 CI 文档[点这里](https://opendocs.alipay.com/mini/02q29z)

### 钉钉小程序 CI 配置（3.6.0 版本开始支持）

| 参数                | 类型   | 说明                                                                 |
| :------------------ | :----- | :------------------------------------------------------------------- |
| appid               | string | 钉钉小程序 appid,即钉钉开放平台后台应用管理的 MiniAppId 选项（必填） |
| token               | string | 令牌，从钉钉后台获取 （必填）                                        |
| devToolsInstallPath | string | 小程序开发者工具安装路径（选填）                                     |

`taro` 集成的钉钉 CI 使用了[钉钉官方仓库](https://github.com/open-dingtalk/dingtalk-design-cli)中的 `dingtalk-miniapp-opensdk` 包，查阅源码封装而成

### 百度小程序 CI 配置

| 参数           | 类型   | 说明                               |
| :------------- | :----- | :--------------------------------- |
| token          | string | 有该小程序发布权限的登录密钥       |
| minSwanVersion | string | 最低基础库版本, 不传默认为 3.350.6 |

官方 CI 文档[点这里](https://smartprogram.baidu.com/docs/develop/devtools/commandtool/)

### 完整 ts 接口描述

```ts
export interface CIOptions {
  /** 发布版本号，默认取 package.json 文件的 taroConfig.version 字段 */
  version?: string
  /** 版本发布描述， 默认取 package.json 文件的 taroConfig.desc 字段 */
  desc?: string
  /** 目标项目目录，对所有小程序生效（不传默认取 outputRoot 字段 ） */
  projectPath?: string
  /** 微信小程序CI配置, 官方文档地址：https://developers.weixin.qq.com/miniprogram/dev/devtools/ci.html */
  weapp?: WeappConfig
  /** 抖音小程序配置, 官方文档地址：https://developer.open-douyin.com/docs/resource/zh-CN/mini-app/develop/developer-instrument/development-assistance/ide-order-instrument/ */
  tt?: TTConfig
  /** 支付宝系列小程序配置，官方文档地址： https://opendocs.alipay.com/mini/miniu/api */
  alipay?: AlipayConfig
  /** 钉钉小程序配置 */
  dd?: DingtalkConfig
  /** 百度小程序配置, 官方文档地址：https://smartprogram.baidu.com/docs/develop/devtools/commandtool/ */
  swan?: SwanConfig
}

export type ProjectType = 'miniProgram' | 'miniGame' | 'miniProgramPlugin' | 'miniGamePlugin'

/** 微信小程序配置 */
export interface WeappConfig {
  /** 小程序/小游戏项目的 appid */
  appid: string
  /** 私钥文件路径，在获取项目属性和上传时用于鉴权使用 */
  privateKeyPath: string
  /** 微信开发者工具安装路径 */
  devToolsInstallPath?: string
  /** 类型，默认miniProgram 小程序 */
  type?: ProjectType
  /** 上传需要排除的目录 */
  ignores?: Array<string>
  /** 指定使用哪一个 ci 机器人，可选值：1 ~ 30 */
  robot?: number
}

/** 抖音小程序配置 */
export interface TTConfig {
  /** 绑定的邮箱账号 */
  email: string
  /** 密码 */
  password: string
}

/** 终端类型 */
export type AlipayClientType =
  | 'alipay' /** 支付宝 */
  | 'ampe' /** AMPE */
  | 'amap' /** 高德 */
  | 'genie' /** 天猫精灵 */
  | 'alios' /** ALIOS */
  | 'uc' /** UC */
  | 'quark' /** 夸克 */
  | 'koubei' /** 口碑 */
  | 'alipayiot' /** loT */
  | 'cainiao' /** 菜鸟 */
  | 'alihealth' /** 阿里健康(医蝶谷) */
  | 'health' /** 阿里医院 */

/** 支付宝系列小程序配置 */
export interface AlipayConfig {
  /** 小程序appid */
  appid: string
  /** 工具id */
  toolId: string
  /** 私钥文件路径，在获取项目属性和上传时用于鉴权使用(privateKeyPath和privateKey之间必须要填写其中一个) */
  privateKeyPath: string
  /** 私钥文本内容，在获取项目属性和上传时用于鉴权使用(privateKeyPath和privateKey之间必须要填写其中一个) */
  privateKey: string
  /** 小程序开发者工具安装路径 */
  devToolsInstallPath?: string
  /** 上传的终端, 默认alipay */
  clientType?: AlipayClientType
}

export type DingtalkProjectType =
  /** 第三方个人应用 */
  | 'dingtalk-personal'
  /** 第三方企业应用 */
  | 'dingtalk-biz-isv'
  /** 企业内部应用 */
  | 'dingtalk-biz'
  /** 企业定制应用 */
  | 'dingtalk-biz-custom'
  /** 工作台组件 */
  | 'dingtalk-biz-worktab-plugin'
export interface DingtalkConfig {
  /** 钉钉小程序appid,即钉钉开放平台后台应用管理的 MiniAppId 选项（必填） */
  appid: string
  /** 令牌，从钉钉后台获取 */
  token: string
  /** 小程序开发者工具安装路径 */
  devToolsInstallPath?: string
  /** 钉钉应用类型， 默认为:'dingtalk-biz' (企业内部应用) */
  projectType?: DingtalkProjectType
}

/** 百度小程序配置 */
export interface SwanConfig {
  /** 有该小程序发布权限的登录密钥 */
  token: string
  /** 最低基础库版本, 不传默认为 3.350.6 */
  minSwanVersion?: string
}
```
</file>

<file path="docs/plugin.md">
---
title: 使用插件
---

Taro 引入了插件化机制，目的是为了让开发者能够通过编写插件的方式来为 Taro 拓展更多功能或为自身业务定制个性化功能。

## 插件集合

### 官方插件

- [@tarojs/plugin-mini-ci](./plugin-mini-ci)，小程序持续集成插件。感谢 [@bigmeow](https://github.com/bigmeow) 的贡献！
- [@tarojs/plugin-mock](https://github.com/NervJS/taro-plugin-mock)，一个简易的数据 mock 插件。

### 社区优质插件

- [编译提速插件](treasures#插件)
- [骨架屏插件](treasures#插件)
- [tailwindcss 插件](treasures#插件)
- [动态加载代码插件](treasures#插件)
- [命令行创建组件/页面插件](treasures#插件)
- [兼容 wsl 插件](treasures#插件)

## 如何引入插件

你可以从 npm 或者本地中引入插件，引入方式主要通过 [编译配置](./config-detail)中的 `plugins` 和 `presets`，使用如下

### plugins

插件在 Taro 中，一般通过[编译配置](./config-detail)中的 `plugins` 字段进行引入。

`plugins` 字段取值为一个数组，配置方式如下：

```js title="/config/index.js"
const config = {
  plugins: [
    // 引入 npm 安装的插件
    '@tarojs/plugin-mock',
    // 引入 npm 安装的插件，并传入插件参数
    [
      '@tarojs/plugin-mock',
      {
        mocks: {
          '/api/user/1': {
            name: 'judy',
            desc: 'Mental guy',
          },
        },
      },
    ],
    // 从本地绝对路径引入插件，同样如果需要传入参数也是如上
    '/absulute/path/plugin/filename',
  ],
}
```

### presets

如果你有一系列插件需要配置，而他们通常是组合起来完成特定的事儿，那你可以通过**插件集** `presets` 来进行配置。

配置[编译配置](./config-detail)中的 `presets` 字段，如下。

```js title="/config/index.js"
const config = {
  presets: [
    // 引入 npm 安装的插件集
    '@tarojs/preset-sth',
    // 引入 npm 安装的插件集，并传入插件参数
    [
      '@tarojs/plugin-sth',
      {
        arg0: 'xxx',
      },
    ],
    // 从本地绝对路径引入插件集，同样如果需要传入参数也是如上
    '/absulute/path/preset/filename',
  ],
}
```
</file>

<file path="docs/preact.md">
---
title: Preact
---

:::info
Taro v3.4 开始支持
:::

[Preact](https://preactjs.com) 是一款体积超小的类 React 框架。与 React 接近 **100k** 的体积相比，它的体积只有 **5k** 左右。在小程序严格的体积要求下，使用 Preact 省下的大量空间则显得弥足珍贵。

### 相关资料

- [与 React 的区别](https://preactjs.com/guide/v10/differences-to-react)

## 使用方法

### 安装依赖

```bash
yarn add preact @tarojs/plugin-framework-react
```

### 配置

1. 修改 Taro 编译配置：

```js title="config/index.js" {3}
const config = {
  // ...
  framework: 'preact',
}
```

2. 修改 Babel 配置：

```js title="babel.config.js" {6}
module.exports = {
  presets: [
    [
      'taro',
      {
        framework: 'preact',
      },
    ],
  ],
}
```

3. 如果项目使用了 TypeScript，请打开 `skipLibCheck` 配置，以避免和其它 React 生态库配合使用时报类型错误：

```js title="tsconfig.json" {3}
{
  ...
  "skipLibCheck": true,
}
```

## H5

### Fast-Refresh

开发环境下，React 支持使用 [fast refresh](https://github.com/facebook/react/issues/16604#issuecomment-528663101) 实现组件的 **Hot Reload**。而在 Preact 的生态中，可以借助 [Prefresh](https://github.com/preactjs/prefresh/blob/main/README.md) 实现此功能。

Taro 在开发环境下默认开启 Prefresh，如果需要关闭此功能，需要同时修改 Webpack 和 Babel 的配置：

```js title="config/index.js" {5}
const config = {
  // ...
  h5: {
    devServer: {
      hot: false,
    },
  },
}
```

```js title="babel.config.js" {7}
module.exports = {
  presets: [
    [
      'taro',
      {
        framework: 'preact',
        hot: false,
      },
    ],
  ],
}
```
</file>

<file path="docs/prebundle.md">
---
title: 依赖预加载
---

> 版本要求 3.5+, 目前该特性仅支持 h5 和小程序编译

编译优化有很多可供选择的方案，通过 webpack5 我们可以实现很多有意思的特性，而依赖预加载就是其中之一。受 [UmiJS mfsu](https://umijs.org/zh-CN/docs/mfsu) 特性的启发，可以预先把项目的 node_modules 依赖打包为一个**模块联邦（Module Federation）** remote 应用，再次编译时 Webpack 则无需再对依赖进行编译，从而提升编译速度。

## 开启 PreBundle 配置

对于很多大型项目编译是非常耗时的事情，很多细小的变更都需要全量编译会带来很高的损耗。通过依赖预编译跳过部分编译，开发环境热更新占用内存可以大大降低，热更新所需时间也将大幅减少；生产模式也可以通过提前编译依赖，大幅提升部署效率。

> 通过 [compiler.prebundle](/docs/next/config-detail#compilerprebundle) 配置开启依赖预编译特性。

```jsx
/** config/index.js */
const config = {
  compiler: {
    type: 'webpack5',
    // 仅 webpack5 支持依赖预编译配置
    prebundle: {
      enable: true,
    },
  },
}
```

:::note
Web 端使用依赖预编译特性时，需要在最外层增加 bootstrap 动态引入入口文件，来确保所有依赖都能够被正确加载，如果使用 [dynamic-import-node](/docs/babel-config/#dynamic-import-node) 配置会导致依赖加载失败，请在使用该配置时禁用 prebundle 特性。同时使用依赖预编译时，chunkFilename 不支持 [hash]、[chunkhash] 这一类的占位符，如果使用 `optimization.chunkId` 参数，则仅支持传入 `deterministic | named`。
:::

## 特性实现

依赖预编译可以分为三步：

1. 收集依赖
2. 打包依赖
3. 打包 Module Federation Remote 应用

Taro 参考 [Vite](https://cn.vitejs.dev/) 使用了 esbuild 收集用户使用到的第三方依赖，并分别进行打包。打包后的模块会作为 Webpack 的 entry，最终打包为模块联邦 Remote 应用，供主应用（Host）消费。实现细节请参考 [RFC 文档](https://github.com/NervJS/taro/discussions/11533)。

Taro 会在小程序环境的 dev 模式下默认开启依赖预编译功能。首次编译时，因为使用了 esbuild 打包第三方依赖，所以会比普通编译稍快。二次编译时，Taro 能直接复用 Remote App，Webpack 只需编译业务代码，因此根据不同项目会有不同的编译提速效果。

依赖预编译的流程图：

![https://storage.360buyimg.com/cjj-pub-images/prebundle.png](https://storage.360buyimg.com/cjj-pub-images/prebundle.png)

## 提速效果

以 [NutUI 组件示例库](https://github.com/jdf2e/nutui/tree/next/src/sites/mobile-taro/vue)为例，分别测试 dev 与 prod 环境下编译微信小程序的编译提速效果：

![compile-speed_dev](https://storage.jd.com/cjj-pub-images/compile-speed_dev.png)

![compile-speed_prod](https://storage.jd.com/cjj-pub-images/compile-speed_prod.png)

可以看出：

1. 在 dev 环境下因为 Taro 默认开启了依赖预编译，因此 Webpack5 首次编译速度比 Webpack4 稍快。而 prod 环境没有默认开启依赖预编译，因此两者速度相当（而且 Webpack5 需要写入缓存，可能会比 Webpack4 稍慢）。
2. 无论是 dev 还是 prod 环境，在完全命中缓存的最优情况下，Webpack5 的编译速度都能得到极大提升。即使是修改源码导致了部分缓存失效时，编译速度仍然比首次编译快得多。

## 第三方接入

依赖预编译特性由 `@tarojs/webpack5-prebundle` 提供，通过简易调整就可以在任意 webpack5 项目内接入该特性。

```ts
import Prebundle from '@tarojs/webpack5-prebundle'
import webpack from 'webpack'
import Chain from 'webpack-chain'

const chain = new Chain()
chain.merge(config)

const prebundle = new Prebundle({ chain })
await prebundle.run({
  enable: true, // 启用依赖预编译
})
webpack(chain.toConfig())
```

通过 `webpack-chain` 传入 webpack 配置，就能自动扫描相关依赖并生成依赖预编译文件供团队协同开发使用，prebundle.run 参数与 Taro [compiler.prebundle](/docs/next/config-detail#compilerprebundle) 配置一致。

:::note
Web 端使用依赖预编译特性时，需要在最外层增加 bootstrap 动态引入入口文件，来确保所有依赖都能够被正确加载。在 Taro 中，在入口文件加载时调用虚拟模块插件，动态设置 `app.boot` 文件来加载入口，其他项目引用时也可以使用同样的方法设置入口：

```ts
import { VirtualModule } from '@tarojs/webpack5-prebundle/dist/h5'

VirtualModule.writeModule(bootPath, "import('./app')")
```

当然手动更改入口文件引用的方法，可以跳过该操作，这样操作在普通项目中更为适用。
:::
</file>

<file path="docs/prerender.md">
---
title: 预渲染（Prerender）
---

Prerender 是由 Taro CLI 提供的在小程序端提高页面初始化渲染速度的一种技术，它的实现原理和服务端渲染（Server-side Rendering）一样：将页面初始化的状态直接渲染为无状态(dataless)的 wxml，在框架和业务逻辑运行之前执行渲染流程。经过 Prerender 的页面初始渲染速度通常会和原生小程序一致甚至更快。

## 为什么需要 Prerender?

Taro Next 在一个页面加载时需要经历以下步骤：

1. 框架（React/Nerv/Vue）把页面渲染到虚拟 DOM 中
2. Taro 运行时把页面的虚拟 DOM 序列化为可渲染数据，并使用 `setData()` 驱动页面渲染
3. 小程序本身渲染序列化数据

和原生小程序或编译型小程序框架相比，步骤 1 和 步骤 2 是多余的。如果页面的业务逻辑代码没有性能问题的话，大多数性能瓶颈出在步骤 2 的 `setData()` 上：由于初始化渲染是页面的整棵虚拟 DOM 树，数据量比较大，因此 `setData()` 需要传递一个比较大的数据，导致初始化页面时会一段白屏的时间。这样的情况通常发生在页面初始化渲染的 wxml 节点数比较大或用户机器性能较低时发生。

## 使用 Prerender

使用 Prerender 非常简单，你可以找到项目根目录下的 `config` 文件夹，根据你的项目情况更改 `index.js`/`dev.js`/`prod.js` 三者中的任意一个[项目配置](./config.md)，在编译时 Taro CLI 会根据你的配置自动启动 prerender：

```js title="/config/index.js 或 /config/dev.js 或 /config/prod.js "
const config = {
  ...
  mini: {
    prerender: {
      match: 'pages/shop/**', // 所有以 `pages/shop/` 开头的页面都参与 prerender
      include: ['pages/any/way/index'], // `pages/any/way/index` 也会参与 prerender
      exclude: ['pages/shop/index/index'] // `pages/shop/index/index` 不用参与 prerender
    }
  }
};

module.exports = config
```

完整 Prerender 配置可参看下表：

| 参数          | 类型                                | 默认值  | 必填 | 说明                                                                   |
| ------------- | ----------------------------------- | ------- | ---- | ---------------------------------------------------------------------- |
| match         | `string` `string[]`                 |         | 否   | glob 字符串或 glob 字符串数组，能匹配到本参数的页面会加入 prerender    |
| include       | `Array<string>` `Array<PageConfig>` | `[]`    | 否   |  页面路径与数组中字符串完全一致的会加入 prerender                      |
| exclude       | `string[]`                          | `[]`    | 否   |  页面路径与数组中字符串完全一致的**不会**加入 prerender                |
| mock          | `Record<string, unknown>`           |         | 否   | 在 prerender 环境中运行的全局变量，键名为变量名，键值为变量值          |
| console       | `boolean`                           | `false` | 否   | 在 prerender 过程中 `console` 打印语句是否执行                         |
| transformData | `Function`                          |         | 否   | 自定义虚拟 DOM 树处理函数，函数返回值会作为 `transformXML` 的参数      |
| transformXML  | `Function`                          |         | 否   | 自定义 XML 处理函数，函数返回值是 Taro 运行时初始化结束前要渲染的 wxml |

在表中有用到的类型：

```typescript
// PageConfig 是开发者在 prerender.includes 配置的页面参数
interface PageConfig {
  path: string // 页面路径
  params: Record<string, unknown> // 页面的路由参数，对应 `getCurrentInstance().router.params`
}

// DOM 树数据，Taro 通过遍历它动态渲染数据
interface MiniData {
  ['cn' /* ChildNodes */]: MiniData[]
  ['nn' /* NodeName */]: string
  ['cl' /* Class */]: string
  ['st' /* Style */]: string
  ['v' /* NodeValue */]: string
  uid: string
  [prop: string]: unknown
}

type transformData = (data: MiniData, config: PageConfig) => MiniData

type transformXML = (
  data: MiniData,
  config: PageConfig,
  xml: string // 内置 xml 转换函数已经处理好了的 xml 字符串
) => string
```

Prerender 的所有配置选项都是选填的，就多数情况而言只需要关注 `match`、`include`、`exclude` 三个选项，`match` 和 `include` 至少填写一个才能匹配到预渲染页面，三者可以共存，当匹配冲突时优先级为 `match` < `include` < `exclude`。

和所有技术一样，Prerender 并不是银弹，使用 Prerender 之后将会有以下的 trade-offs 或限制：

- 页面打包的体积会增加。Prerender 本质是一种以空间换时间的技术，体积增加的多寡取决于预渲染 wxml 的数量。
- 在 Taro 运行时把真实 DOM 和事件挂载之前（这个过程在服务端渲染被称之为 `hydrate`），预渲染的页面不会相应任何操作。
- Prerender 不会执行例如 `componentDidMount()`(React)/`ready()`(Vue) 这样的生命周期，这点和服务端渲染一致。如果有处理数据的需求，可以把生命周期提前到 `static getDerivedStateFromProps()`(React) 或 `created()`(Vue)。

## 进阶说明和使用

### `PRERENDER` 全局变量

在预渲染容器有一个名为 `PRERENDER` 的全局变量，它的值为 `true`。你可以通过判断这个变量是否存在，给预渲染时期单独编写业务逻辑：

```javascript
if (typeof PRERENDER !== 'undefined') {
  // 以下代码只会在预渲染中执行
  // do something
}
```

### disablePrerender

对于任意一个原生组件，如果不需要它在 Prerender 时中显示，可以把组件的 `disablePrerender` 属性设置为 `true`，这个组件和它的子孙都不会被渲染为 wxml 字符串。

```jsx
/* id 为 test 的组件和它的子孙在预渲染时都不会显示 */
<View id="test" disablePrerender>
  ...children
</View>
```

### 自定义渲染

当默认预渲染的结果不满足你的预期时，Taro 提供了两个配置项自定义预渲染内容。

Prerender 配置中的 `transformData()` 对需要进行渲染的虚拟 DOM 进行操作：

```javascript
const config = {
  ...
  mini: {
    prerender: {
      match: 'pages/**',
      tranformData (data, { path }) {
        if (path === 'pages/video/index') {
          // 如果是页面是 'page/video/index' 页面只预渲染一个 video 组件
          // 关于 data 的数据结构可以参看上文的数据类型签名
          data.nn = 'video'
          data.cn = []
          data.src = 'https://v.qq.com/iframe/player.html?vid=y08180lrvth&tiny=0&auto=0'
          return data
        }

        return data
      }
    }
  }
}
```

Prerender 配置中的 `transformXML()` 可以自定义预渲染输出的 wxml：

```javascript
const config = {
  ...
  mini: {
    prerender: {
      match: 'pages/**',
      tranformXML (data, { path }, xml) {
        if (path === 'pages/video/index') {
          // 如果是页面是 'page/video/index' 页面只预渲染一个 video 组件
          return `<video src="https://v.qq.com/iframe/player.html?vid=y08180lrvth&tiny=0&auto=0" />`
        }

        return xml
      }
    }
  }
}
```

### 减少预渲染的 wxml 数量

一般而言，用户只需要看到首屏页面，但实际上页面初次渲染的我们构建的业务逻辑有可能会把页面的所有内容都渲染，而 Taro 初始渲染慢的原因在于首次传递的数据量过大，因此可以调整我们的业务逻辑达到只渲染首屏的目的：

```jsx
class SomePage extends Component {
  state = {
    mounted: false,
  }

  componentDidMount() {
    // 等待组件载入，先渲染了首屏我们再渲染其它内容，降低首次渲染的数据量
    // 当 mounted 为 true 时，CompA, B, C 的 DOM 树才会作为 data 参与小程序渲染
    // 注意我们需要在 `componentDidMount()` 这个周期做这件事（对应 Vue 的 `ready()`），更早的生命周期 `setState()` 会与首次渲染的数据一起合并更新
    // 使用 nextTick 确保本次 setState 不会和首次渲染合并更新
    Taro.nextTick(() => {
      this.setState({
        mounted: true,
      })
    })
  }

  render() {
    return (
      <View>
        <FirstScreen /> /* 假设我们知道这个组件会把用户的屏幕全部占据 */
        {this.state.mounted && (
          <React.Fragment>
            {' '}
            /* CompA, B, C 一开始并不会在首屏中显示 */
            <CompA />
            <CompB />
            <CompC />
          </React.Fragment>
        )}
      </View>
    )
  }
}
```

这样的优化除了加快首屏渲染以及 `hydrate` 的速度，还可以降低 Prerender 的所增加的 wxml 体积。当你的优化做得足够彻底时，你会发现多数情况下并不需要 Prerender。

## 常见问题

### 使用了部分 Taro API 后预渲染报错

> 相关 Issue：[#9311](https://github.com/NervJS/taro/issues/9311)

Taro 预渲染时会使用 [vm2](https://github.com/patriksimek/vm2) 创建一个沙箱环境，并在沙箱中注入一些全局变量。

这些注入的全局变量中，包括了小程序的全局对象（如 `wx`），它是使用 `miniprogram-simulate` 这个包模拟的。

这样做会导致两个问题：

1. `miniprogram-simulate` 中部分 API 使用了一些全局变量如 `wx`、`localStorage` 等，开发者使用这些 API 时会报错。
2. `miniprogram-simulate` 只支持微信小程序部分 API。

因此，开发者如果遇到了 `miniprogram-simulate` 包中全局变量报错的问题，可以舍弃 `miniprogram-simulate`，改为自行模拟，例如：

```js
// config/index.js
const config = {
  mini: {
    prerender: {
      // 使用 mock 参数自行模拟 wx.clearStorageSync
      mock: {
        wx: {
          clearStorageSync: () => 'cjj',
        },
      },
    },
  },
}
```

### H5 Prerender

Taro 目前并没有提供 H5 端的预渲染配置，可以考虑使用相关的开源方案，比如 `prerender-spa-plugin`:

```js title="/config/prod.js "
const config = {
  ...
  h5: {
    /**
     * WebpackChain 插件配置
     * @docs https://github.com/neutrinojs/webpack-chain
     */
    webpackChain (chain) {
      /**
       * 如果 h5 端首屏加载时间过长，可以使用 prerender-spa-plugin 插件预加载首页。
       * @docs https://github.com/chrisvfritz/prerender-spa-plugin
       */
      if (process.env.TARO_ENV === 'h5') {
        const path = require('path')
        const Prerender = require('prerender-spa-plugin')
        const staticDir = path.join(__dirname, '..', 'dist')
        chain
          .plugin('prerender')
          .use(new Prerender({
            staticDir,
            routes: [ '/pages/index/index' ],
            postProcess: (context) => ({ ...context, outputPath: path.join(staticDir, 'index.html') })
          }))
      }
    }
  }
};

module.exports = config
```
</file>

<file path="docs/project-config.md">
---
title: 项目配置
---

各类小程序平台均有自己的项目配置文件，例如：

- 微信小程序，[project.config.json](https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html?search-key=%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE)
- 百度小程序，[project.swan.json](https://smartprogram.baidu.com/docs/develop/devtools/projectconfig/)
- 抖音小程序，[project.config.json](https://developer.open-douyin.com/docs/resource/zh-CN/mini-app/develop/framework/basic-reference/catalog-structure)
- QQ 小程序，project.config.json
- 支付宝小程序，[mini.project.json](https://opendocs.alipay.com/mini/framework/project)
- 京东小程序，暂无发现
- 飞书小程序，[project.config.json](https://open.feishu.cn/document/uYjL24iN/uEzMzUjLxMzM14SMzMTN/gadget-project-configuration?from=taro)
- ASCF元服务，[ascf.config.json](https://developer.huawei.com/consumer/cn/doc/atomic-ascf/project-json-config)

为了能够适配不同小程序平台的配置文件不同的情况，Taro 支持为各个小程序平台添加各自的项目配置文件。

通过 Taro 模板创建的项目都会默认拥有 `project.config.json` 这一项目配置文件，这个文件 **只能用于微信小程序**，若要兼容到其他小程序平台，请按如下对应规则来增加相应平台的配置文件，其配置与各自小程序平台要求的一致：

| 小程序平台   | 添加配置文件        |
| ------------ | ------------------- |
| 微信小程序   | project.config.json |
| 百度小程序   | project.swan.json   |
| 抖音小程序   | project.tt.json     |
| QQ 小程序    | project.qq.json     |
| 支付宝小程序 | project.alipay.json |
| 飞书小程序   | project.lark.json   |
| ASCF元服务  | ascf.config.json    |

:::caution 注意
飞书小程序从[插件](https://www.npmjs.com/package/@tarojs/plugin-platform-lark)1.0.2 版本开始，配置文件修改为`project.lark.json`，之前版本为`project.tt.json`。
推荐升级[飞书插件](https://www.npmjs.com/package/@tarojs/plugin-platform-lark)到最新版，避免使用 Taro 同时开发抖音小程序和飞书小程序配置文件 appId 冲突的问题。
:::
</file>

<file path="docs/props.md">
---
title: 组件化 & Props
---

组件可以将 UI 切分成一些的独立的、可复用的部件，这样你就只需专注于构建每一个单独的部件。

组件从概念上看就像是函数，它可以接收任意的输入值（称之为 `props`），并返回一个需要在页面上展示的 Taro 元素。

你也可以使用 ES6 Class 来定义一个组件:

```jsx
class Welcome extends Component {
  render() {
    return <View>Hello, {this.props.name}</View>
  }
}
```

## 组件渲染

在前面，我们遇到的 Taro 元素都是内置组件：

```jsx
const element = <View />
```

然而，Taro 元素也可以是用户自定义的组件：

```jsx
const element = <Welcome name="Wallace" />
```

当 React 遇到的元素是用户自定义的组件，它会将 JSX 属性作为单个对象传递给该组件，这个对象称之为 `props`。

例如,这段代码会在页面上渲染出 `Hello, Wallace`:

```jsx
// welcome.js
class Welcome extends Component {
  render() {
    return (
      <View>
        <Text>Hello, {this.props.name}</Text>
      </View>
    )
  }
}

// app.js
class App extends Component {
  render() {
    return <Welcome name="Wallace" />
  }
}
```

### Props 的只读性

一个声明的组件决不能修改它自己的 `props`。来看这个 `sum` 函数：

```jsx
function sum(a, b) {
  return a + b
}
```

类似于上面的这种函数称为「纯函数」，它没有改变它自己的输入值，当传入的值相同时，总是会返回相同的结果。

与之相对的是非纯函数，它会改变它自身的输入值：

```jsx
function withdraw(account, amount) {
  account.total -= amount
}
```

Taro 和 React 一样，也有一个严格的规则：

所有的 Taro 组件必须像纯函数那样使用它们的 props。

当然，应用的界面是随时间动态变化的，我们将在下一节介绍一种称为 `state` 的新概念，State 可以在不违反上述规则的情况下，根据用户操作、网络响应、或者其他状态变化，使组件动态的响应并改变组件的输出。

### 使用 PropTypes 检查类型

随着应用日渐庞大，你可以通过类型检查捕获大量错误。要检查组件的属性，你需要配置特殊的 `propTypes` 属性：

```jsx
import PropTypes from 'prop-types'

class Greeting extends Component {
  render() {
    return <h1>Hello, {this.props.name}</h1>
  }
}

Greeting.propTypes = {
  name: PropTypes.string,
}
```

如上例，Taro 与 React 一样，也支持 `PropTypes` 检查类型，_目前在小程序端还有些问题_，但在 H5 端可以使用，用法和在 React 里一样。
更多可参照 [React 的相关文档](https://reactjs.org.cn/doc/typechecking-with-proptypes.html)。
</file>

<file path="docs/quick-app.md">
---
title: 快应用端开发流程
---

> 从 **1.3 beta** 版本开始支持快应用开发
>
> 本章节主要讲解快应用端 环境安装-开发-调试-打包-发布 原理及流程

## 简介

Taro 支持快应用端开发

## 安装

### 搭建快应用环境

#### 手机安装调试器

调试器是一个 Android 应用程序，下载调试器 APK 详见[资源下载](https://www.quickapp.cn/docCenter/post/69)

在手机上安装并打开调试器，按钮功能如下：

- **扫码安装**：配置 HTTP 服务器地址，下载 rpk 包，并唤起平台运行 rpk 包
- **本地安装**：选择手机文件系统中的 rpk 包，并唤起平台运行 rpk 包
- **在线更新**：重新发送 HTTP 请求，更新 rpk 包，并唤起平台运行 rpk 包
- **开始调试**：唤起平台运行 rpk 包，并启动远程调试
  **注意**：若打开调试器无法点击按钮，请升级手机系统到最新版本或安装平台预览版

安装成功后如下图所示：

![img](https://doc.quickapp.cn/tutorial/overview/images/img2.png)

#### 手机安装平台预览版

较新的系统版本中内置平台正式版，开发调试平台新功能可使用平台预览版

平台预览版存在以下优缺点：

- 优点：迭代速度快，可立即体验平台新功能
- 缺点：实现与真实的运行环境存在差异，对厂商服务和第三方服务的支持存在缺陷
  平台预览版是一个 Android 应用程序，下载平台预览版 APK 详见[资源下载](https://www.quickapp.cn/docCenter/post/69)

下载安装成功后，在手机调试器中点击切换运行平台至 org.hapjs.mockup，即可在平台预览版上安装运行 rpk 包

### 开发调试

在手机上安装完调试器后，就可以执行 Taro 的快应用编译命令开始编译了

```bash
$ taro build --type quickapp --watch
```

在编译完成后会遇到如下输出结果

![](https://img11.360buyimg.com/ling/jfs/t1/133888/5/12321/688893/5f89398bE0ac357d2/066a38b5f13dc2fd.jpg)

Taro 在将代码编译完后，会自动下载快应用的容器模板，同时安装好相关的依赖，随后就会自动启动快应用的服务，此时，只需要使用手机上安装的调试器扫码就能直接在手机上进行调试了。

### 使用 IDE

https://doc.quickapp.cn/tutorial/ide/overview.html

### 快应用配置

在 Taro 编译适配快应用需要进行一些配置，适配的具体原因可以参考[Taro 和快应用配置差异](./taro-quickapp-manifest.md#Taro和快应用配置差异)，通过在项目根目录下添加 `project.quickapp.json` 大体的配置项可以参考快应用官方文档的 [manifest 配置](https://doc.quickapp.cn/framework/manifest.html)，而 Taro 中支持以下配置：

| 属性                | 类型    | 默认值 | 必填 | 描述                                                                                               |
| :------------------ | :------ | :----- | :--- | :------------------------------------------------------------------------------------------------- |
| package             | String  | -      | 是   | 应用包名，确认与原生应用的包名不一致，推荐采用 com.company.module 的格式，如：com.example.demo     |
| name                | String  | -      | 是   | 应用名称，6 个汉字以内，与应用商店保存的名称一致，用于在桌面图标、弹窗等处显示应用名称             |
| icon                | String  | -      | 是   | 应用图标，提供 192x192 大小的即可                                                                  |
| versionName         | String  | -      | 否   | 应用版本名称，如："1.0"                                                                            |
| versionCode         | Integer | -      | 是   | 应用版本号，从 1 自增，推荐每次重新上传包时 versionCode+1                                          |
| minPlatformVersion  | Integer | -      | 否   | 支持的最小平台版本号，兼容性检查，避免上线后在低版本平台运行并导致不兼容；如果不填按照内测版本处理 |
| features            | Array   | -      | 否   | 接口列表，绝大部分接口都需要在这里声明，否则不能调用，详见每个接口的文档说明                       |
| config              | Object  | -      | 是   | 系统配置信息，详见[说明](https://doc.quickapp.cn/framework/manifest.html#config)                   |
| subpackages `1040+` | Object  | -      | 否   | 定义并启用分包加载，详见[说明](https://doc.quickapp.cn/framework/manifest.html#subpackages)        |

可以看出，相比于快应用官方的配置项，Taro 中支持的配置项缺少了 [router](https://doc.quickapp.cn/framework/manifest.html#router) 与 [display](https://doc.quickapp.cn/framework/manifest.html#display) 配置，这是因为这两项配置在 Taro 编译时会根据用户代码直接生成，不再需要额外配置。

而为了让用户更加方便进行快应用相关配置，Taro 增加了一些额外的配置项，例如：

`customPageConfig` 是为了让用户可以为每个页面配置快应用独有的 `filter` 与 `launchMode` 它直接配置在 `project.quickapp.json` 中，它是一个对象的类型，其 key 值即为页面路径，与 **入口文件** 中 `config` 下 `pages` 数组中配置的页面路径保持一致，常见例子如下

```json
{
  "customPageConfig": {
    "pages/index/index": {
      "filter": {
        "<action>": {
          "uri": "<pattern>"
        }
      },
      "launchMode": "standard"
    }
  }
}
```

一个典型的 `project.quickapp.json` 配置参考[例子](https://github.com/NervJS/taro/blob/master/packages/taro-cli/src/config/manifest.default.json)

### Taro 组件和快应用组件差异剖析

Taro 已经可以编译出可在微信/百度/支付宝/抖音小程序、H5、React-Native 运行的代码，近期也增加了快应用的支持，那必不可少的一步就是组件库的转换，众所周知小程序开发离不开三大要素——界面表现（结构、外观）层、逻辑处理层与系统接口层（网络、存储与媒体等），其中界面结构指的就是组件库，那立足于微信小程序的 Taro 组件和快应用组件有何异同？Taro 是如何处理这些差异的？

小程序官网放出来了一个[体验小程序](https://github.com/wechat-miniprogram/miniprogram-demo)用来展示它的组件、API、云开发能力，快应用官方也出了一个能力展示的开源项目[sample](https://github.com/quickappcn/sample),乍看好像差不多，其实两者之间的差异还是很多的，由于 Taro 组件基本上是微信小程序组件变为首字母大写之后形成的，下面以微信小程序组件为基准，看看快应用的组件能力如何。

## 视图容器

| 微信小程序组件                                                                               | 功能说明                                                                                                              | 对应快应用组件                                        | Taro 如何模拟                                                            |
| :------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------- | ------------------------------------------------------------------------ |
| [cover-image](https://developers.weixin.qq.com/miniprogram/dev/component/cover-image.html)   | 覆盖在原生组件之上的图片视图                                                                                          | 无                                                    | 用 image 模拟，丢失 bindload 和 binderror 事件                           |
| [cover-view](https://developers.weixin.qq.com/miniprogram/dev/component/cover-view.html)     | 覆盖在原生组件之上的文本视图                                                                                          | 无                                                    | 用 div 模拟，丢失 scroll-top 属性                                        |
| [movable-area](https://developers.weixin.qq.com/miniprogram/dev/component/movable-area.html) | [movable-view](https://developers.weixin.qq.com/miniprogram/dev/component/movable-view.html)的可移动区域              | 无                                                    | 用 div 模拟，丢失 scale-area 属性                                        |
| [movable-view](https://developers.weixin.qq.com/miniprogram/dev/component/movable-view.html) | 可移动的视图容器，在页面中可以拖拽滑动                                                                                | 无                                                    | 用 div 模拟，丢失所有属性                                                |
| [scroll-view](https://developers.weixin.qq.com/miniprogram/dev/component/scroll-view.html)   | 可滚动视图区域                                                                                                        | 无                                                    | 用 div 模拟，丢失所有属性                                                |
| [swiper](https://developers.weixin.qq.com/miniprogram/dev/component/swiper.html)             | 滑块视图容器                                                                                                          | [swiper](https://doc.quickapp.cn/widgets/swiper.html) | 指示点颜色可通过样式补齐、丢失 previous-margin、easing-function 等属性， |
| [swiper-item](https://developers.weixin.qq.com/miniprogram/dev/component/swiper-item.html)   | 仅可放置在[swiper](https://developers.weixin.qq.com/miniprogram/dev/component/swiper.html)组件中，宽高自动设置为 100% | 无                                                    | 用 text 或 image 模拟，丢失 item-id 属性                                 |
| [view](https://developers.weixin.qq.com/miniprogram/dev/component/view.html)                 | 视图容器                                                                                                              | 无                                                    | 用 div 模拟，丢失所有属性                                                |

再来看基础组件和表单组件：

## 基础组件

| 微信小程序组件                                                                         | 功能说明 | 对应快应用组件                                            | Taro 如何模拟                                      |
| :------------------------------------------------------------------------------------- | :------- | --------------------------------------------------------- | -------------------------------------------------- |
| [icon](https://developers.weixin.qq.com/miniprogram/dev/component/icon.html)           | 图标     | 无                                                        | 用 div 模拟，丢失 type\size\color 属性             |
| [progress](https://developers.weixin.qq.com/miniprogram/dev/component/progress.html)   | 进度条   | [progress](https://doc.quickapp.cn/widgets/progress.html) | 只保留了 percent 属性                              |
| [rich-text](https://developers.weixin.qq.com/miniprogram/dev/component/rich-text.html) | 富文本   | [richtext](https://doc.quickapp.cn/widgets/richtext.html) | nodes 属性做一次 AST 映射到变量中，丢失 space 属性 |
| [text](https://developers.weixin.qq.com/miniprogram/dev/component/text.html)           | 文本     | [text](https://doc.quickapp.cn/widgets/text.html)         | 少有的比微信丰富的组件，模拟之后丢失所有属性       |

## 表单组件

| 名称                                                                                                     | 功能说明                                                                                                       | 对应快应用组件                                            | Taro 如何模拟                                      |
| :------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------- | -------------------------------------------------- |
| [button](https://developers.weixin.qq.com/miniprogram/dev/component/button.html)                         | 按钮                                                                                                           | 无                                                        | 用 div 模拟，丢失所有属性                          |
| [checkbox](https://developers.weixin.qq.com/miniprogram/dev/component/checkbox.html)                     | 多选项目                                                                                                       | 无                                                        | 用 input 模拟，丢失 color 属性，仿真度高           |
| [checkbox-group](https://developers.weixin.qq.com/miniprogram/dev/component/checkbox-group.html)         | 多项选择器，内部由多个[checkbox](https://developers.weixin.qq.com/miniprogram/dev/component/checkbox.html)组成 | 无                                                        | 用 div 模拟，丢失所有属性                          |
| [editor](https://developers.weixin.qq.com/miniprogram/dev/component/editor.html)                         | 富文本编辑器，可以对图片、文字进行编辑                                                                         | 无                                                        | 用 richtext 模拟，丢失所有属性                     |
| [form](https://developers.weixin.qq.com/miniprogram/dev/component/form.html)                             | 表单                                                                                                           | 无                                                        | 用 div 模拟，丢失所有属性                          |
| [input](https://developers.weixin.qq.com/miniprogram/dev/component/input.html)                           | 输入框                                                                                                         | [input](https://doc.quickapp.cn/widgets/input.html)       | 丢失 passwd、bindinput 等属性                      |
| [label](https://developers.weixin.qq.com/miniprogram/dev/component/label.html)                           | 用来改进表单组件的可用性                                                                                       | [label](https://doc.quickapp.cn/widgets/label.html)       | for 属性对应 target，但不支持子组件模拟            |
| [picker](https://developers.weixin.qq.com/miniprogram/dev/component/picker.html)                         | 从底部弹起的滚动选择器                                                                                         | [picker](https://doc.quickapp.cn/widgets/picker.html)     | 丢失省市选择器类型，转换规则随 type 变化，模拟复杂 |
| [picker-view](https://developers.weixin.qq.com/miniprogram/dev/component/picker-view.html)               | 嵌入页面的滚动选择器                                                                                           | 无                                                        | 用 div 模拟，丢失所有属性                          |
| [picker-view-column](https://developers.weixin.qq.com/miniprogram/dev/component/picker-view-column.html) | 滚动选择器子项                                                                                                 | 无                                                        | 用 div 模拟，丢失所有属性                          |
| [radio](https://developers.weixin.qq.com/miniprogram/dev/component/radio.html)                           | 单选项目                                                                                                       | 无                                                        | 用 input 模拟，丢失 color 属性，仿真度高           |
| [radio-group](https://developers.weixin.qq.com/miniprogram/dev/component/radio-group.html)               | 单项选择器，内部由多个 [radio](https://developers.weixin.qq.com/miniprogram/dev/component/radio.html) 组成     | 无                                                        | 用 div 模拟，丢失所有属性                          |
| [slider](https://developers.weixin.qq.com/miniprogram/dev/component/slider.html)                         | 滑动选择器                                                                                                     | [slider](https://doc.quickapp.cn/widgets/slider.html)     | 丢失 color、block-size 等属性                      |
| [switch](https://developers.weixin.qq.com/miniprogram/dev/component/switch.html)                         | 开关选择器                                                                                                     | [switch](https://doc.quickapp.cn/widgets/switch.html)     | 丢失 color、disabled 等属性                        |
| [textarea](https://developers.weixin.qq.com/miniprogram/dev/component/textarea.html)                     | 多行输入框                                                                                                     | [textarea](https://doc.quickapp.cn/widgets/textarea.html) | 只保留了 placeholder、maxlength 属性               |

最后是不常用到的导航、媒体、地图和画布组件对比

## 导航

| 名称                                                                                                                   | 功能说明                             | 对应快应用组件 | Taro 如何模拟             |
| :--------------------------------------------------------------------------------------------------------------------- | :----------------------------------- | -------------- | ------------------------- |
| [functional-page-navigator](https://developers.weixin.qq.com/miniprogram/dev/component/functional-page-navigator.html) | 仅在插件中有效，用于跳转到插件功能页 | 无             | 用 div 模拟，丢失所有属性 |
| [navigator](https://developers.weixin.qq.com/miniprogram/dev/component/navigator.html)                                 | 页面链接                             | 无             | 用 div 模拟，丢失所有属性 |

## 媒体组件

| 名称                                                                                       | 功能说明       | 对应快应用组件                                        | Taro 如何模拟                                        |
| :----------------------------------------------------------------------------------------- | :------------- | ----------------------------------------------------- | ---------------------------------------------------- |
| [audio](https://developers.weixin.qq.com/miniprogram/dev/component/audio.html)             | 音频           | 无                                                    | div+slider+接口方式模拟，仅保留基本功能              |
| [camera](https://developers.weixin.qq.com/miniprogram/dev/component/camera.html)           | 系统相机       | [camera](https://doc.quickapp.cn/widgets/camera.html) | 仅保留 device-position、flash、binderror 属性        |
| [image](https://developers.weixin.qq.com/miniprogram/dev/component/image.html)             | 图片           | [image](https://doc.quickapp.cn/widgets/image.html)   | 仅保留 src 属性                                      |
| [live-player](https://developers.weixin.qq.com/miniprogram/dev/component/live-player.html) | 实时音视频播放 | 无                                                    | 用 div 模拟，丢失所有属性                            |
| [live-pusher](https://developers.weixin.qq.com/miniprogram/dev/component/live-pusher.html) | 实时音视频录制 | 无                                                    | 用 div 模拟，丢失所有属性                            |
| [video](https://developers.weixin.qq.com/miniprogram/dev/component/video.html)             | 视频           | [video](https://doc.quickapp.cn/widgets/video.html)   | 只保留 src、autoplay、poster、controls 和 muted 属性 |

## 地图

| 名称                                                                       | 功能说明 | 对应快应用组件                                  | Taro 如何模拟                    |
| :------------------------------------------------------------------------- | :------- | ----------------------------------------------- | -------------------------------- |
| [map](https://developers.weixin.qq.com/miniprogram/dev/component/map.html) | 地图     | [map](https://doc.quickapp.cn/widgets/map.html) | 仿真度较高，属性可以做到一一映射 |

## 画布

| 名称                                                                             | 功能说明 | 对应快应用组件                                        | Taro 如何模拟                                            |
| :------------------------------------------------------------------------------- | :------- | ----------------------------------------------------- | -------------------------------------------------------- |
| [canvas](https://developers.weixin.qq.com/miniprogram/dev/component/canvas.html) | 画布     | [canvas](https://doc.quickapp.cn/widgets/canvas.html) | 同名但一个是组件，一个是通过 API 模拟的，只能用 div 模拟 |

## 开放能力

| 名称                                                                                                 | 功能说明               | 对应快应用组件 | Taro 如何模拟             |
| :--------------------------------------------------------------------------------------------------- | :--------------------- | -------------- | ------------------------- |
| [web-view](https://developers.weixin.qq.com/miniprogram/dev/component/web-view.html)                 | 承载网页的容器         | 无             | 通过 web 组件仿真         |
| [ad](https://developers.weixin.qq.com/miniprogram/dev/component/ad.html)                             | Banner 广告            | 无             | 用 div 模拟，丢失所有属性 |
| [official-account](https://developers.weixin.qq.com/miniprogram/dev/component/official-account.html) | 公众号关注组件         | 无             | 用 div 模拟，丢失所有属性 |
| [open-data](https://developers.weixin.qq.com/miniprogram/dev/component/open-data.html)               | 用于展示微信开放的数据 | 无             | 用 div 模拟，丢失所有属性 |

从上面的数据来看，快应用支持的组件还很不完善，如果之前使用 Taro 开发微信小程序的话，想直接转到快应用是很难的（还有样式的严格限制），看到这里你可能会对快应用有点失望，但是快应用在手机端的原生渲染性能是微信小程序不能比的，下面的快应用特色组件会让你刮目相看：

1.使用 list+list-item 实现[流畅的滚动列表](https://doc.quickapp.cn/tutorial/widgets/list-tutorial.html)

2.新鲜的气泡组件[popup](https://doc.quickapp.cn/widgets/popup.html)

3.想实现盖楼功能? 看看这个堆叠组件[stack](https://doc.quickapp.cn/widgets/stack.html)

4.快应用也有 tabbar，[tabs](https://doc.quickapp.cn/widgets/tabs.html) / tab-bar/tab-content 三剑客

5.外卖应用必不可少的星级评分组件[rating](https://doc.quickapp.cn/widgets/rating.html)

---

以上就是 Taro 组件和快应用组件的一个概览对比，总结来说，如果想实现多端一致，请尽量在 Taro 里面使用仿真度高的组件，比如 Swiper、Image、Text、Input、Label、Picker、Video、Map、Camera、Canvas、Slider、Textarea 等，随着快应用不断完善，相信这些差异会逐渐补齐的。
</file>

<file path="docs/react-18.md">
---
title: React 18
---

:::note
Taro v3.5 开始支持。
:::

从 Taro v3.5 开始，Taro 将默认使用 React 18 版本。你可以在 Taro 使用 React18 中激动人心的新特性了。

### 相关资料

- [React v18.0](https://reactjs.org/blog/2022/03/29/react-v18.html)

## 使用方法

### 创建新项目

```bash
# @tarojs/cli 升级到 v3.5
$ taro init myProject
# 选择「react」框架
```

### 旧项目升级

```bash
$ taro update project 3.5
# 项目 package.json 中 react / react-dom 版本升级为 "^18"
```

:::note
如果升级了 Taro v3.5，但不想使用 React v18，可以将项目 `package.json` 中 `react / react-dom` 版本降级为 `^17` 并重新安装依赖。
:::

## 注意事项

- 开发支付宝小程序时，Webpack4 暂不支持使用 React18，[#12134](https://github.com/NervJS/taro/issues/12134#issuecomment-1197904281)。
- 如果你选择升级到 React 18，那么项目中使用的其他 React 生态库同步也需要支持 React 18 版本，以减少运行时问题，比如 [issue 117](https://github.com/NervJS/taro-docs/issues/117)。
- 受小程序环境限制，诸如新 SSR Suspense 等特性将不能在小程序中使用。
- RN 暂不支持 React v18，需要等待 RN 官方输出支持方案。
</file>

<file path="docs/react-devtools.md">
---
title: React DevTools
---

:::note
Taro v3.3.1 开始支持。
:::

在开发小程序时可以使用 [React DevTools](https://github.com/facebook/react/blob/main/packages/react-devtools/README.md)。

## 使用方法

### 1. 安装

在项目中安装 Taro 插件 `@tarojs/plugin-react-devtools`：

```sh
$ yarn add --dev @tarojs/plugin-react-devtools
```

### 2. 配置 Taro 插件

在 Taro 编译配置中配置使用 `@tarojs/plugin-react-devtools`：

```js title="config/dev.js"
config = {
  plugins: ['@tarojs/plugin-react-devtools'],
  // ...
}
```

### 3. 编译项目

```sh
$ taro build --type weapp --watch
```

## 插件参数

插件 `@tarojs/plugin-react-devtools` 具有以下参数：

### enabled

`boolean`

默认值：`true`

控制是否连接 `react-devtools`，开启后会注入 backend 的代码到开发者的应用中。

### hostname

`string`

默认值：`localhost`

当 localhost 不可用时，自定义 `taro` 连接 `react-devtools` 的主机名，多用于局域网或远程调试时使用。

### port

`number`

默认值：`8097`

React DevTools 使用的 Websocket 端口。

## 注意事项

- 强制锁定了 `react-devtools` 的版本，更新版本需要修改 `@tarojs/plugin-react-devtools` 插件的代码。
- [为了识别 custom hooks](https://github.com/facebook/react/blob/main/packages/react-devtools/OVERVIEW.md#inspecting-hooks)，backend 会对部分符合条件的函数式组件执行 `shallow rendering`，开发者需要注意代码是否存在副作用。

另外，目前对 devtools 功能的支持不够全面，有些功能需要针对小程序环境魔改 backend 才能实现，欢迎共建～

- 支持元素高亮。
- 在小程序的 `storage` 中记录 `filters` 变化。

## 详细设计

详细设计请看 [RFC](https://github.com/NervJS/taro-rfcs/blob/master/rfcs/0005-react-devtools.md)。
</file>

<file path="docs/react-entry.mdx">
---
title: 入口组件
---

import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

每一个 Taro 应用都需要一个入口组件（React 组件）用来注册应用。入口文件默认是 `src` 目录下的 `app.js`。

在入口组件中我们可以设置全局状态或访问小程序入口实例的生命周期。

## 代码示例

<Tabs
  defaultValue="class"
  values={[
    {label: 'Class Component', value: 'class'},
    {label: 'Functional Component', value: 'functional'}
  ]}>
<TabItem value="class">

```jsx title="app.js"
import React, { Component } from 'react'

// 假设我们要使用 Redux
import { Provider } from 'react-redux'
import configStore from './store'

// 全局样式
import './app.css'

const store = configStore()

class App extends Component {
  // 可以使用所有的 React 生命周期方法
  componentDidMount() {}

  // 对应 onLaunch
  onLaunch() {}

  // 对应 onShow
  componentDidShow() {}

  // 对应 onHide
  componentDidHide() {}

  render() {
    // 在入口组件不会渲染任何内容，但我们可以在这里做类似于状态管理的事情
    return (
      <Provider store={store}>
        {/* this.props.children 是将要被渲染的页面 */}
        {this.props.children}
      </Provider>
    )
  }
}

export default App
```

</TabItem>

<TabItem value="functional">

```jsx title="app.js"
import React, { useEffect } from 'react'

// Taro 额外添加的 hooks 要从 '@tarojs/taro' 中引入
import { useDidShow, useDidHide } from '@tarojs/taro'

// 假设我们要使用 Redux
import { Provider } from 'react-redux'
import configStore from './store'

// 全局样式
import './app.css'

const store = configStore()

function App(props) {
  // 可以使用所有的 React Hooks
  useEffect(() => {})

  // 对应 onShow
  useDidShow(() => {})

  // 对应 onHide
  useDidHide(() => {})

  return (
    // 在入口组件不会渲染任何内容，但我们可以在这里做类似于状态管理的事情
    <Provider store={store}>
      {/* props.children 是将要被渲染的页面 */}
      {props.children}
    </Provider>
  )
}

export default App
```

</TabItem>
</Tabs>

## 入口组件配置

请参考 [全局配置](./app-config)

## 生命周期方法

入口组件除了支持 React 的生命周期方法外，还根据小程序的标准，额外支持以下生命周期：

### onLaunch (options)

> 在小程序环境中对应 app 的 `onLaunch`。

在此生命周期中通过访问 `options` 参数或调用 `getCurrentInstance().router`，可以访问到程序初始化参数。

#### 参数

##### options

| 属性         | 类型   | 说明                                                                 |
| ------------ | ------ | -------------------------------------------------------------------- |
| path         | string | 启动小程序的路径                                                     |
| scene        | number | 启动小程序的场景值                                                   |
| query        | Object | 启动小程序的 query 参数                                              |
| shareTicket  | string | shareTicket，详见获取更多转发信息                                    |
| referrerInfo | Object | 来源信息。从另一个小程序、公众号或 App 进入小程序时返回。否则返回 {} |

##### options.referrerInfo

| 属性            | 类型   | 说明                                                                 |
| --------------- | ------ | -------------------------------------------------------------------- |
| appId           | string | 来源小程序，或者公众号（微信中）                                     |
| extraData       | Object | 来源小程序传过来的数据，微信和百度小程序在 scene=1037 或 1038 时支持 |
| sourceServiceId | string | 来源插件，当处于插件运行模式时可见                                   |

> options 参数的字段在不同小程序中可能存在差异，如：
>
> 场景值 scene，在微信小程序和百度小程序中存在区别，请分别参考 [微信小程序文档](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/scene.html) 和 [百度小程序文档](https://smartprogram.baidu.com/docs/data/scene/)

### componentDidShow (options)

程序启动，或切前台时触发。

和 `onLaunch` 生命周期一样，在此生命周期中通过访问 `options` 参数或调用 `getCurrentInstance().router`，可以访问到程序初始化参数。

参数与 `onLaunch` 中获取的基本一致，但**百度小程序**中补充两个参数如下：

| 属性      | 类型   | 说明                                                                                                                                                 |
| --------- | ------ | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| entryType | string | 展现的来源标识，取值为 user/ schema /sys :<br />user：表示通过 home 前后<br/>切换或解锁屏幕等方式调起；<br/>schema：表示通过协议调起;<br />sys：其它 |
| appURL    | string | 展现时的调起协议，仅当 entryType 值为 schema 时存在                                                                                                  |

### componentDidHide ()

程序切后台时触发。

### onError (error)

:::info
Taro v3.5.0+ 开始支持
:::

小程序发生脚本错误或 API 调用报错时触发。

### onPageNotFound (Object)

程序要打开的页面不存在时触发。

#### 参数

##### Object

| 属性        | 类型    | 说明                                                                           |
| ----------- | ------- | ------------------------------------------------------------------------------ |
| path        | string  | 不存在页面的路径                                                               |
| query       | Object  | 打开不存在页面的 query 参数                                                    |
| isEntryPage | boolean | 是否本次启动的首个页面（例如从分享等入口进来，首个页面是开发者配置的分享页面） |

### onUnhandledRejection (Object)

:::info
Taro v3.5.10+ 开始支持
:::

小程序有未处理的 Promise 拒绝时触发。

#### 参数

##### Object

| 属性    | 类型    | 说明                            |
| ------- | ------- | ------------------------------- |
| reason  | string  | 拒绝原因，一般是一个 Error 对象 |
| promise | Promise | 被拒绝的 Promise 对象           |

> 注意：**支付宝小程序**需要在源码根目录的 `project.alipay.json` 文件中添加配置 `enableAppxNg: true` 才能在真机环境进行监听。
</file>

<file path="docs/react-error-handling.mdx">
---
title: 错误处理
---

import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

React 和小程序都提供了各自的错误处理方法，本节将介绍如何在 Taro 中结合使用。

## 错误边界

React 16 引入了[错误边界](https://reactjs.org/docs/error-boundaries.html)的概念，相比于 `try catch` 和小程序的全局错误监听回调 `App onError`，它的优点在于能捕获 React 渲染过程中的错误和显示兜底界面。

:::note
错误边界不能捕获以下错误：

- 事件回调
- 异步代码，如 `setTimeout` 回调
- 错误边界组件自身的渲染错误

前两点建议直接使用 `try catch` 或 `App onError` 进行处理，第三点将在后文中介绍。
:::

### 页面组件自身作为错误边界

正如 React 文档所指出的，错误边界的颗粒度可以由开发者自行选择。如果要捕获**页面内子组件**的错误，可以把页面组件自身作为错误边界。

**示例代码：**

```jsx title="pages/index/index.jsx"
class BuggyCounter extends Component {
  state = {
    counter: 0,
  }

  handleClick = () => {
    this.setState(({ counter }) => ({
      counter: counter + 1,
    }))
  }

  render() {
    if (this.state.counter === 2) {
      // 模拟 JS 报错
      throw new Error('I crashed!')
    }
    return <Button onClick={this.handleClick}>{this.state.counter}</Button>
  }
}

// 页面组件自身作为错误边界
export default class Index extends Component {
  state = {
    hasError: null,
  }

  static getDerivedStateFromError() {
    return {
      hasError: true,
    }
  }

  componentDidCatch(error, errorInfo) {
    console.log(error, errorInfo)
  }

  render() {
    return this.state.hasError ? (
      // 异常时显示兜底 UI
      <View>Something went wrong.</View>
    ) : (
      // 正常显示
      <BuggyCounter></BuggyCounter>
    )
  }
}
```

### 捕获页面组件自身的错误

> 相关讨论：[#8191](https://github.com/NervJS/taro/pull/8191)

还记得错误边界的第三个限制**“不能捕获错误边界组件自身的渲染错误”**吗？如果我们把页面组件自身作为错误边界，这时是不能捕获其自身的错误的，因此我们需要再创建一个错误边界组件以包裹我们的页面组件。

可以使用高阶组件为页面组件嵌套错误边界，如果页面组件为 Class Component，还需要对 Taro 的生命周期进行额外处理。因此建议这种情况下，页面组件使用 Functional Component 的写法。

**示例代码：**

<Tabs
  defaultValue="class"
  values={[
    {label: 'Class Component', value: 'class'},
    {label: 'Functional Component', value: 'functional'}
  ]}>
<TabItem value="class">

```jsx title="pages/index/index.jsx"
import React, { Component } from 'react'
import { View, Button } from '@tarojs/components'

// 页面组件
class Index extends Component {
  state = {
    counter: 0,
  }

  componentDidShow() {
    console.log('show')
  }

  componentDidHide() {
    console.log('hide')
  }

  onShareAppMessage() {
    return {
      title: 'myShareTitle',
    }
  }

  handleClick = () => {
    this.setState(({ counter }) => ({
      counter: counter + 1,
    }))
  }

  render() {
    if (this.state.counter === 2) {
      // 模拟 JS 报错
      throw new Error('I crashed!')
    }
    return <Button onClick={this.handleClick}>{this.state.counter}</Button>
  }
}

// 使用 HOC 以方便为各个页面复用这段逻辑
function createErrorBoundary(Page) {
  return class ErrorBoundary extends Component {
    el = React.createRef()
    state = {
      hasError: null,
    }

    static getDerivedStateFromError() {
      return {
        hasError: true,
      }
    }

    componentDidCatch(error, errorInfo) {
      console.log(error, errorInfo)
    }

    /* Start 需要手动调用页面组件上的生命周期方法 **/
    componentDidShow() {
      return this.el.current?.componentDidShow?.()
    }

    componentDidHide() {
      return this.el.current?.componentDidHide?.()
    }

    onShareAppMessage() {
      return this.el.current?.onShareAppMessage?.()
    }

    //...

    /* End 需要手动调用页面组件上的生命周期方法 **/

    render() {
      return this.state.hasError ? <View>Something went wrong.</View> : <Page ref={this.el} />
    }
  }
}

export default createErrorBoundary(Index)
```

</TabItem>

<TabItem value="functional">

```jsx title="pages/index/index.jsx"
import { Component, useEffect, useState } from 'react'
import { View, Button } from '@tarojs/components'
import { useDidShow, useDidHide, useShareAppMessage } from '@tarojs/taro'

function Index() {
  const [counter, setCounter] = useState(0)

  useDidShow(() => console.log('show'))

  useDidHide(() => console.log('hide'))

  useShareAppMessage(() => ({ title: 'myShareTitle' }))

  function handleClick() {
    setCounter(counter + 1)
  }

  useEffect(() => {
    if (counter === 2) {
      // 模拟 JS 报错
      throw new Error('I crashed!')
    }
  })

  return <Button onClick={handleClick}>{counter}</Button>
}

// 使用 HOC 以方便为各个页面复用这段逻辑
function createErrorBoundary(Page) {
  return class ErrorBoundary extends Component {
    state = {
      hasError: null,
    }

    static getDerivedStateFromError() {
      return {
        hasError: true,
      }
    }

    componentDidCatch(error, errorInfo) {
      console.log(error, errorInfo)
    }

    render() {
      return this.state.hasError ? <View>Something went wrong.</View> : <Page />
    }
  }
}

export default createErrorBoundary(Index)
```

</TabItem>
</Tabs>

## App onError

:::info
Taro v3.5+ 开始支持
:::

- React 渲染流程之外的 JS 错误都能被其监听到。
- 当渲染错误没有被开发者设置的错误边界捕获时，渲染报错都可以被监听到。

**示例代码：**

<Tabs
  defaultValue="class"
  values={[
    {label: 'Class Component', value: 'class'},
    {label: 'Functional Component', value: 'functional'}
  ]}>
<TabItem value="class">

```jsx title="app.js"
import { Component } from 'react'

export default class App extends Component {
  onError(error) {
    console.log(error)
  }

  render() {
    return this.props.children
  }
}
```

</TabItem>

<TabItem value="functional">

```jsx title="app.js"
import { useError } from '@tarojs/taro'

export default function App(props) {
  useError((error) => console.log(error))

  return props.children
}
```

</TabItem>
</Tabs>
</file>

<file path="docs/react-native-harmony.md">
---
title: React Native 方案
---

:::tip Taro v4.0.0-beta.36+ 开始支持  
:::
// todo 具体版本待定
随着鸿蒙系统的日渐完善，鸿蒙与 React Native 进行合作，React Native 会推出对鸿蒙的适配。

## 配置鸿蒙环境

### 1.安装、配置 DevEco Studio

（1）登录  [HarmonysOS 应用开发门户](https://developer.harmonyos.com/cn/home)，点击右上角注册按钮，注册开发者帐号。

（2）进入  [HUAWEI DevEco Studio 套件货架中心](https://developer.harmonyos.com/deveco-developer-suite/)，申请白名单，由于目前最新版本的 OpenHarmony SDK 和 IDE 以及 React Native 需要的 npm 包 和 SDK 仍未对外开发，因此个人开发者若想尝鲜，需要先申请白名单成为合作伙伴后才能继续进行下面的步骤。

（3）白名单申请通过后，进入货架下载开发套件具体版本请查看**软件要求**。

（4）下载完成后，打开 IDE 安装包进行安装，安装成功后启动 DevEco Studio，根据[引导](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V4/sdk-prepar-0000001573170041-V4)解压套件里附带的 SDK 压缩包，并根据[引导](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V4/sdk-prepar-0000001573170041-V4)在 IDE 中配置好 SDK 的使用路径。

### 2.软件要求

(1) IDE 版本: 4.1.3.400

(2) SDK 版本: HarmonyOS S NEXT Developer Preview1

(3) Node.js 版本：V18.14.1（可使用 DevEco Studio 安装的 Node.js）

## 使用 Taro 开发鸿蒙 RN

### 1. JS 工程

#### 1.1 通过 CLI 创建 JS 工程

```bash
npx @tarojs/cli@beta init
```

#### 1.2 模版选择

选择**react-native-harmony**

#### 1.3 手动修改代码

##### 1.3.1 添加 harmony 依赖

JS 工程项目同级需要 **react-native-harmony** 、**react-native-harmony-cli** 两个目录（由于目前鸿蒙暂未开源，需跟根据环境配置所述申请白名单，下载对对应的开发套件）

##### 1.3.2 修改 metro.config.js

本修改只针对**pnpm** 包管理的开发者,对于使用**npm**、**yarn**的可发这可忽略

将 metro.config.js 中 fs.lstatSync 修改成 fs.statSync

```bash
/**node_modules/react-native-harmony/metro.config.js**/

function hasNodeModulePathHarmonyCode(nodeModulePath) {
  if (!fs.lstatSync(nodeModulePath).isDirectory()) return false;
  const nodeModuleContentNames = fs.readdirSync(nodeModulePath);
}
```

#### 1.4 运行 JS 工程

```bash
 pnpm start --reset-cache
```

#### 1.5 检查 bundle server 是否正常

可以通过在浏览器中访问 [http://localhost:8081/index.bundle?platform=harmony](http://localhost:8081/index.bundle?platform=harmony) 检查 bundle server 是否正常

### 2. 原生工程

#### 2.1 创建工程

根据**《ReactNative for OpenHarmony 开发使用指导》** 新建鸿蒙工程

#### 2.2 安装第三方依赖

| 包名                                      | 地址                                                                                                 |
| ----------------------------------------- | ---------------------------------------------------------------------------------------------------- |
| @react-native-async-storage/async-storage | https://react-native-oh-library.gitee.io/usage-docs/#/zh-cn/react-native-async-storage-async-storage |
| @react-native-camera-roll/camera-roll     | https://react-native-oh-library.gitee.io/usage-docs/#/zh-cn/react-native-cameraroll                  |
| @react-native-clipboard/clipboard         | https://react-native-oh-library.gitee.io/usage-docs/#/zh-cn/react-native-clipboard-clipboard         |
| @react-native-community/geolocation       | https://react-native-oh-library.gitee.io/usage-docs/#/zh-cn/react-native-geolocation                 |
| @react-native-community/netinfo           | https://react-native-oh-library.gitee.io/usage-docs/#/zh-cn/react-native-community-netinfo           |
| @react-native-community/slider            | https://react-native-oh-library.gitee.io/usage-docs/#/zh-cn/react-native-community-slider            |
| react-native-gesture-handler              | https://react-native-oh-library.gitee.io/usage-docs/#/zh-cn/react-native-gesture-handler             |
| react-native-pager-view                   | https://react-native-oh-library.gitee.io/usage-docs/#/zh-cn/react-native-pager-view                  |
| react-native-safe-area-context            | https://react-native-oh-library.gitee.io/usage-docs/#/zh-cn/react-native-safe-area-context           |
| react-native-screens                      | https://react-native-oh-library.gitee.io/usage-docs/#/zh-cn/react-native-screens                     |
| react-native-webview                      | https://react-native-oh-library.gitee.io/usage-docs/#/zh-cn/react-native-webview                     |
| react-native-svg                          | https://react-native-oh-library.gitee.io/usage-docs/#/zh-cn/react-native-svg                         |

更多第三库的安装请参考 [React Native OpenHarmony](https://react-native-oh-library.gitee.io/usage-docs/#/)

#### 2.3 连接手机或模拟器

启动手机模拟器后如果没有执行 bundle 加载 需执行一下命令进行端口映射

```bash
hdc rport tcp:8081 tcp:8081
```

#### 2.4 修改 moduleName

原生工程中使用的 moduleName 需要与 config 中的 rn.appName 保持一致，如'taroDemo'

```bash
private moduleName = 'taroDemo'
```

## 常见问题

### 1.暂不支持的 api 和组件

由于**taro reactnative** 的部分**api** 和**组件**依赖了原生的支持(主要集中在 expo 类型的依赖),目前鸿蒙暂时没有提供支持，所以使用上会有报错

#### 1.1 组件

| 组件名称 | 组件描述 |
| -------- | -------- |
| Video    | 视频组件 |
| Camera   | 拍摄组件 |

#### 1.2 api

| api 名称                   | api 描述                   |
| -------------------------- | -------------------------- |
| getSetting                 | 获取设置                   |
| openSetting                | 打开设置                   |
| authorize                  | 用户授权                   |
| saveImageToPhotosAlbum     | 保存图片到系统相册         |
| downLoadFIle               | 下载                       |
| chooseVideo                | 选择视频                   |
| chooseMedia                | 选择媒体类型               |
| createCameraContext        | 创建 camera 上下文         |
| getScreenBrightness        | 获取屏幕亮度               |
| setScreenBrightness        | 设置屏幕亮度               |
| onAccelerometerChange      | 监听加速度数据             |
| offAccelerometerChange     | 取消监听加速度数据事件     |
| startAccelerometer         | 开始监听加速度数据         |
| onDeviceMotionChange       | 监听设备方向变化事件       |
| offDeviceMotionChange      | 取消监听设备方向变化事件   |
| startDeviceMotionListening | 开始监听设备方向的变化     |
| stopDeviceMotionListening  | 停止监听设备方向的变化     |
| onGyroscopeChange          | 监听陀螺仪数据变化事件     |
| offGyroscopeChange         | 取消监听陀螺仪数据变化事件 |
| startGyroscope             | 开始监听陀螺仪数据         |
| stopGyroscope              | 停止监听陀螺仪数据         |
| scanCode                   | 调起客户端扫码界面         |
| vibrateShort               | 使手机发生较短时间的振动   |
| vibrateLong                | 使手机发生较长时间的振动   |

### 2.App 启动后没有加载 bundle

端口映射没有成功

```
hdc rport tcp:8081 tcp:8081
```

### 3.第三方库未生效

会看到信息：**No harmony-specific third-party packages have been detected pnpm install** 等操作，导致 node_modules 修改被覆盖。查看**node_modules/react-native-harmony/metro.config.js** **lstatSync** 是否改成了**statSync**。
</file>

<file path="docs/react-native-remind.md">
---
title: React Native 端开发前注意
---

:::tip Taro 3 需要使用 3.1 以上版本
:::

React Native 的样式基于开源的跨平台布局引擎 [Yoga](https://github.com/facebook/yoga) ，样式基本上是实现了 CSS 的一个子集，并且属性名不完全一致，所以当你开始在考虑兼容 React Native 端之前，可以先简要了解一下 React Native 的样式：[React Native Layout Props](https://facebook.github.io/react-native/docs/layout-props)

样式布局上 H5 最为灵活，小程序次之，RN 最弱，统一多端样式即是对齐短板，也就是要以 RN 的约束来管理样式，同时兼顾小程序的限制，核心可以用三点来概括：

- 使用 Flex 布局
- 基于 BEM 写样式
- 采用 style 属性覆盖组件样式

## 一、布局

### flex

在 React Native 中使用 Flexbox 规则来指定某个组件的子元素的布局。Flexbox 可以在不同屏幕尺寸上提供一致的布局结构。因此，如果你要考虑 React Native 端，那你的样式布局就得采用 Flex 布局。

Flex 布局入门，可以查看阮一峰的 [Flex 布局教程：语法篇](https://www.ruanyifeng.com/blog/2015/07/flex-grammar.html)

注意：**RN 中 View 标签默认主轴方向是 column**，如果不将其他端改成与 RN 一致，就需要在所有用到 display: flex 的地方都显式声明主轴方向。

### position

在 React Native 中 position 仅支持两种属性，即 `relative`（默认）和 `absolute`。可[参考文档](https://reactnative.dev/docs/0.60/layout-props#position)

## 二、样式

### 选择器

> React Native 端仅支持类选择器，且不支持 **组合器** [Combinators and groups of selectors](https://developer.mozilla.org/en-US/docs/Learn/CSS/Introduction_to_CSS/Combinators_and_multiple_selectors)。

以下选择器的写法都是不支持的，在样式转换时会自动忽略。

```css
.button.button_theme_islands {
  font-style: bold;
}

img + p {
  font-style: bold;
}

p ~ span {
  color: red;
}

div > span {
  background-color: DodgerBlue;
}

div span {
  background-color: DodgerBlue;
}
```

若我们基于 `scss` 等预编译语言开发，则可基于 [BEM](https://getbem.com/) 写样式，如：

```jsx
<View className="block">
  <Text className="block__elem">文本</Text>
</View>
```

```css
.block: {
  background-color: DodgerBlue;
  &__elem {
    color: yellow;
  }
}
```

### 样式的条件编译

> 1.3+ 版本支持

#### 样式文件条件编译

假设目录中同时存在以下文件：

```
- index.scss
- index.rn.scss
```

当在 JS 文件中引用样式文件：`import './index.scss'` 时，RN 平台会找到并引入 `index.rn.scss`，其他平台会引入：`index.scss`，方便大家书写跨端样式，更好地兼容 RN。

#### 样式代码的条件编译

为了方便大家书写样式跨端的样式代码，添加了样式条件编译的特性。

指定平台保留：

```scss
/*  #ifdef  %PLATFORM%  */
样式代码
/*  #endif  */
```

指定平台剔除：

```scss
/*  #ifndef  %PLATFORM%  */
样式代码
/*  #endif  */
```

多个平台之间可以使用空格隔开。

### 样式的全局引入

- 方式一：入口文件 app.js 里面引入的样式就是全局样式，本地样式会覆盖全局样式。
- 方式二：通过配置全局注入

```js
// config/index.js
...
const config = {
    ...
    sass: {
        resource: [
            'src/styles/common.scss'
        ]
    }
}

```

# 三、导航

React Native 导航是封装的 React-Navigation [6.x](https://github.com/NervJS/taro/pull/11344)，为了更好的方便业务自定义，支持全局与页面配置中透传 React Navigation 的配置，但注意以下导航相关设置 Taro 3.x 生效。

### 全局配置

在全局配置 app.config.js 中可增加 rn 导航的独立配置

```js
//为了对其他端产生影响，最好加上环境判断

let rnConfig = {}

if(process.env.TARO_ENV === 'rn'){
  rnConfig = {
  //deep Linking前缀,https://reactnavigation.org/docs/deep-linking
  linking:[],
  //tabBar页面的设置，https://reactnavigation.org/docs/bottom-tab-navigator/#tabbar 对应options的配置，支持以下属性透传，不支持返回react.Node节点设置的方案
   options:{
      title，
      tabBarVisible，
      tabBarBadge，
      tabBarBadgeStyle，
      tabBarTestID
   },
   tabBarOptions:{//tabbarOptions的配置，其他参考https://reactnavigation.org/docs/bottom-tab-navigator/#tabbar tabBarOptions

   },
   screenOptions:{//全局screenOptions，作用于非所有页面，注意不支持返回React.Node的属性，参考https://reactnavigation.org/docs/stack-navigator/#options

   }
  }
}

export default {
  pages:[
    'pages/index/index',
  ],
  rn:rnConfig
}
```

### 页面配置

除了全局设置页面，也可单独对某个页面进行设置。

```js
// 页面config
rn: {
  screenOptions: {
    // 设置当前页面的options，参考https://reactnavigation.org/docs/stack-navigator/#options
  }
}
```

> 关于透传 react navigation 的配置有需要注意：
>
> - 不支持直接传入 React.Node 节点的参数
> - 传入的样式对象为 React Native 的样式对比，比如 tabStyle:{ backgroundColor :'#ff0000'}
> - rn 的配置优先于其他配置，比如统一的 tabBar 里配置了 selectedColor ，rn 配置里的 activeTintColor ，那么生效的是 activeTintColor

## 常见问题

### 1、box-shadow 能实现吗？

> React Native 这方面支持得并不好（仅 ios 支持且支持程度有限）,android 端仅可通过 `elevation` 设置灰色阴影。

```css
{
    /* 阴影相关属性 */
    shadowOffset: {width: 0, height: 5},
    shadowOpacity: 0.5,
    shadowRadius: 5,
    shadowColor: Color.CMHeaderBgColor,
    /* android 灰色阴影 */
    elevation: 4,
}
```

### 2、border{Top,Right,Bottom,Left} 不支持？

border{Top,Right,Bottom,Left} 的简写（shorthands）不支持，因为 `borderStyle` 不能应用于单个边框。

使用 sass：

```scss
/**
 * // NOTE Taro 编译成 RN 时对 border 的处理有问题
 * RN 不支持针对某一边设置 style，即 border-bottom-style 会报错
 * 那么 border-bottom: 1px 就需要写成如下形式：
 * border: 0 style color; border-bottom-width: 1px;
 */
@mixin border($dir, $width, $style, $color) {
  border: 0 $style $color;
  @each $d in $dir {
    #{border-#{$d}-width}: $width;
  }
}
```

### 3、React Native 不支持 background-image ，有什么解决办法吗？

使用 `Image 组件`，配合 Flex/Position 布局，基本可以实现你的大部分需求。阅读一下这篇文章：[Background Images in React Native](https://thekevinscott.com/background-images-in-react-native/)，有助于你理解。

## 附：各属性支持度

React Native 的样式基于开源的跨平台布局引擎 [Yoga](https://github.com/facebook/yoga) ，样式基本上是实现了 CSS 的一个子集，但是属性名不完全一致，具体的内容及相关差异可以查看文档 [React Native Layout Props](https://facebook.github.io/react-native/docs/layout-props)。

### Text 文本（18）

| 属性名                                       | 取值                                                                                                           | 描述                                                                                                                                                                                                                                                                   |
| -------------------------------------------- | -------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| color                                        | [&lt;color&gt;](#user-content-color)                                                                           | 对应 `CSS` [color](https://css.doyoe.com/properties/color/color.htm) 属性                                                                                                                                                                                              |
| fontFamily                                   | string                                                                                                         | 对应 `CSS` [font-family](https://css.doyoe.com/properties/font/font-family.htm) 属性                                                                                                                                                                                   |
| fontSize                                     | [&lt;number&gt;](#user-content-number)                                                                         | 对应 `CSS` [font-size](https://css.doyoe.com/properties/font/font-size.htm) 属性                                                                                                                                                                                       |
| fontStyle                                    | `normal`, `italic`                                                                                             | 对应 `CSS` [font-style](https://css.doyoe.com/properties/font/font-style.htm) 属性，但阉割了 `oblique` 取值                                                                                                                                                            |
| fontWeight                                   | `normal`, `bold` `100~900`                                                                                     | 对应 `CSS` [font-weight](https://css.doyoe.com/properties/font/font-weight.htm) 属性，但阉割了 `bolder, lighter` 取值                                                                                                                                                  |
| lineHeight                                   | [&lt;number&gt;](#user-content-number)                                                                         | 对应 `CSS` [line-height](https://css.doyoe.com/properties/text/line-height.htm) 属性                                                                                                                                                                                   |
| textAlign                                    | `auto`, `left`, `right`, `center`, `justify`<sup>`iOS`</sup>                                                   | 对应 `CSS` [text-align](https://css.doyoe.com/properties/text/text-align.htm) 属性，但增加了 `auto` 取值。当取值为 `justify` 时，在 `Android` 上会变为 `left`                                                                                                          |
| textDecorationLine                           | `none`, `underline`, `line-through`, `underline line-through`                                                  | 对应 `CSS` [text-decoration-line](https://css.doyoe.com/properties/text-decoration/text-decoration-line.htm) 属性，但阉割了 `overline`, `blink` 取值                                                                                                                   |
| textShadowColor                              | [&lt;color&gt;](#user-content-color)                                                                           | 对应 `CSS` [text-shadow](https://css.doyoe.com/properties/text-decoration/text-shadow.htm) 属性中的颜色定义                                                                                                                                                            |
| textShadowOffset                             | {<br />width:[&lt;number&gt;](#user-content-number),<br />height:[&lt;number&gt;](#user-content-number)<br />} | 对应 `CSS` [text-shadow](https://css.doyoe.com/properties/text-decoration/text-shadow.htm) 属性中的阴影偏移定义                                                                                                                                                        |
| textShadowRadius                             | [&lt;number&gt;](#user-content-number)                                                                         | 在 `CSS` 中，阴影的圆角大小取决于元素的圆角定义，不需要额外定义                                                                                                                                                                                                        |
| includeFontPadding<br /><sup>`Android`</sup> | [&lt;bool&gt;](#user-content-bool)                                                                             | Android 在默认情况下会为文字额外保留一些 padding，以便留出空间摆放上标或是下标的文字。对于某些字体来说，这些额外的 padding 可能会导致文字难以垂直居中。如果你把 `textAlignVertical` 设置为 `center` 之后，文字看起来依然不在正中间，那么可以尝试将本属性设置为 `false` |
| textAlignVertical<br /><sup>`Android`</sup>  | `auto`, `top`, `bottom`, `center`                                                                              | 对应 `CSS` [vertical-align](https://css.doyoe.com/properties/text/vertical-align.htm) 属性，增加了 `auto` 取值，`center` 取代了 `middle`，并阉割了 `baseline, sub` 等值                                                                                                |
| fontVariant<br /><sup>`iOS`</sup>            | `small-caps`, `oldstyle-nums`, `lining-nums`, `tabular-nums`, `proportional-nums`                              | 对应 `CSS` [font-variant](https://css.doyoe.com/properties/font/font-variant.htm) 属性，但取值更丰富                                                                                                                                                                   |
| letterSpacing<br /><sup>`iOS`</sup>          | [&lt;number&gt;](#user-content-number)                                                                         | 对应 `CSS` [letter-spacing](https://css.doyoe.com/properties/text/letter-spacing.htm) 属性                                                                                                                                                                             |
| textDecorationColor<br /><sup>`iOS`</sup>    | [&lt;color&gt;](#user-content-color)                                                                           | 对应 `CSS` [text-decoration-color](https://css.doyoe.com/properties/text-decoration/text-decoration-color.htm) 属性                                                                                                                                                    |
| textDecorationStyle<br /><sup>`iOS`</sup>    | `solid`, `double`, `dotted`, `dashed`                                                                          | 对应 `CSS` [text-decoration-style](https://css.doyoe.com/properties/text-decoration/text-decoration-style.htm) 属性，但阉割了 `wavy` 取值                                                                                                                              |
| writingDirection<br /><sup>`iOS`</sup>       | `auto`, `ltr`, `rtl`                                                                                           | 对应 `CSS` [direction](https://css.doyoe.com/properties/writing-modes/direction.htm) 属性，增加了 `auto` 取值                                                                                                                                                          |

<a name="dimension"></a>

### Dimension 尺寸（6）

| 属性名    | 取值                                   | 描述                                                                                    |
| --------- | -------------------------------------- | --------------------------------------------------------------------------------------- |
| width     | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [width](https://css.doyoe.com/properties/dimension/width.htm) 属性           |
| minWidth  | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [min-width](https://css.doyoe.com/properties/dimension/min-width.htm) 属性   |
| maxWidth  | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [max-width](https://css.doyoe.com/properties/dimension/max-width.htm) 属性   |
| height    | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [height](https://css.doyoe.com/properties/dimension/height.htm) 属性         |
| minHeight | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [min-height](https://css.doyoe.com/properties/dimension/min-height.htm) 属性 |
| maxHeight | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [max-height](https://css.doyoe.com/properties/dimension/max-height.htm) 属性 |

<a name="positioning"></a>

### Positioning 定位（6）

| 属性名   | 取值                                   | 描述                                                                                                                 |
| -------- | -------------------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| position | `absolute`, `relative`                 | 对应 `CSS` [position](https://css.doyoe.com/properties/positioning/position.htm) 属性，但阉割了 `static, fixed` 取值 |
| top      | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [top](https://css.doyoe.com/properties/positioning/top.htm) 属性                                          |
| right    | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [right](https://css.doyoe.com/properties/positioning/right.htm) 属性                                      |
| bottom   | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [bottom](https://css.doyoe.com/properties/positioning/bottom.htm) 属性                                    |
| left     | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [left](https://css.doyoe.com/properties/positioning/left.htm) 属性                                        |
| zIndex   | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [z-index](https://css.doyoe.com/properties/positioning/z-index.htm) 属性                                  |

<a name="margin"></a>

### Margin 外部白（7）

| 属性名           | 取值                                   | 描述                                                                                                                                                                                   |
| ---------------- | -------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| margin           | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [margin](https://css.doyoe.com/properties/margin/margin.htm) 属性，不同的是，它只能定义一个参数，如需分别定义`上、右、下、左`4 个方位的外补白，可以通过下面的单向外部白属性 |
| marginHorizontal | [&lt;number&gt;](#user-content-number) | 无对应的 `CSS` 属性。其效果相当于同时设置 `marginRight` 和 `marginLeft`                                                                                                                |
| marginVertical   | [&lt;number&gt;](#user-content-number) | 无对应的 `CSS` 属性。其效果相当于同时设置 `marginTop` 和 `marginBottom`                                                                                                                |
| marginTop        | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [margin-top](https://css.doyoe.com/properties/margin/margin-top.htm) 属性                                                                                                   |
| marginRight      | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [margin-right](https://css.doyoe.com/properties/margin/margin-right.htm) 属性                                                                                               |
| marginBottom     | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [margin-bottom](https://css.doyoe.com/properties/margin/margin-bottom.htm) 属性                                                                                             |
| marginLeft       | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [margin-left](https://css.doyoe.com/properties/margin/margin-left.htm) 属性                                                                                                 |

<a name="padding"></a>

### Padding 内部白（7）

| 属性名            | 取值                                   | 描述                                                                                                                                                                                      |
| ----------------- | -------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| padding           | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [padding](https://css.doyoe.com/properties/padding/padding.htm) 属性，不同的是，它只能定义一个参数，如需分别定义`上、右、下、左`4 个方位的内补白，可以通过下面的单向内部白属性 |
| paddingHorizontal | [&lt;number&gt;](#user-content-number) | 无对应的 `CSS` 属性。其效果相当于同时设置 `paddingRight` 和 `paddingLeft`                                                                                                                 |
| paddingVertical   | [&lt;number&gt;](#user-content-number) | 无对应的 `CSS` 属性。其效果相当于同时设置 `paddingTop` 和 `paddingBottom`                                                                                                                 |
| paddingTop        | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [padding-top](https://css.doyoe.com/properties/padding/padding-top.htm) 属性                                                                                                   |
| paddingRight      | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [padding-right](https://css.doyoe.com/properties/padding/padding-right.htm) 属性                                                                                               |
| paddingBottom     | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [padding-bottom](https://css.doyoe.com/properties/padding/padding-bottom.htm) 属性                                                                                             |
| paddingLeft       | [&lt;number&gt;](#user-content-number) | 对应 `CSS` [padding-left](https://css.doyoe.com/properties/padding/padding-left.htm) 属性                                                                                                 |

### Border 边框（20）

| 属性名                  | 取值                                                                                                              | 描述                                                                                                                 |
| ----------------------- | ----------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| borderStyle             | `solid`, `dotted`, `dashed`                                                                                       | 对应 `CSS` `border-style` 属性，但阉割了 `none, hidden, double, groove, ridge, inset, outset` 取值，且无方向分拆属性 |
| borderWidth             | [&lt;number&gt;](#user-content-number)                                                                            | 对应 `CSS` `border-width` 属性                                                                                       |
| borderTopWidth          | [&lt;number&gt;](#user-content-number)                                                                            | 对应 `CSS` `border-top-width` 属性                                                                                   |
| borderRightWidth        | [&lt;number&gt;](#user-content-number)                                                                            | 对应 `CSS` `border-right-width` 属性                                                                                 |
| borderBottomWidth       | [&lt;number&gt;](#user-content-number)                                                                            | 对应 `CSS` `border-bottom-width` 属性                                                                                |
| borderLeftWidth         | [&lt;number&gt;](#user-content-number)                                                                            | 对应 `CSS` `border-left-width` 属性                                                                                  |
| borderColor             | [&lt;color&gt;](#user-content-color)                                                                              | 对应 `CSS` `border-color` 属性                                                                                       |
| borderTopColor          | [&lt;color&gt;](#user-content-color)                                                                              | 对应 `CSS` `border-top-color` 属性                                                                                   |
| borderRightColor        | [&lt;color&gt;](#user-content-color)                                                                              | 对应 `CSS` `border-right-color` 属性                                                                                 |
| borderBottomColor       | [&lt;color&gt;](#user-content-color)                                                                              | 对应 `CSS` `border-bottom-color` 属性                                                                                |
| borderLeftColor         | [&lt;color&gt;](#user-content-color)                                                                              | 对应 `CSS` `border-left-color` 属性                                                                                  |
| borderRadius            | [&lt;number&gt;](#user-content-number)                                                                            | 对应 `CSS` `border-radius` 属性                                                                                      |
| borderTopLeftRadius     | [&lt;number&gt;](#user-content-number)                                                                            | 对应 `CSS` `border-top-left-radius` 属性                                                                             |
| borderTopRightRadius    | [&lt;number&gt;](#user-content-number)                                                                            | 对应 `CSS` `border-top-right-radius` 属性                                                                            |
| borderBottomLeftRadius  | [&lt;number&gt;](#user-content-number)                                                                            | 对应 `CSS` `border-bottom-left-radius` 属性                                                                          |
| borderBottomRightRadius | [&lt;number&gt;](#user-content-number)                                                                            | 对应 `CSS` `border-bottom-right-radius` 属性                                                                         |
| shadowColor             | [&lt;color&gt;](#user-content-color)                                                                              | 对应 `CSS` [box-shadow](https://css.doyoe.com/properties/border/box-shadow.htm) 属性中的颜色定义                     |
| shadowOffset            | {<br />width: [&lt;number&gt;](#user-content-number), <br />height: [&lt;number&gt;](#user-content-number)<br />} | 对应 `CSS` [box-shadow](https://css.doyoe.com/properties/border/box-shadow.htm) 属性中的阴影偏移定义                 |
| shadowRadius            | [&lt;number&gt;](#user-content-number)                                                                            | 在 `CSS` 中，阴影的圆角大小取决于元素的圆角定义，不需要额外定义                                                      |
| shadowOpacity           | [&lt;number&gt;](#user-content-number)                                                                            | 对应 `CSS` [box-shadow](https://css.doyoe.com/properties/border/box-shadow.htm) 属性中的阴影透明度定义               |

<a name="background"></a>

### Background 背景（1）

| 属性名          | 取值                                 | 描述                               |
| --------------- | ------------------------------------ | ---------------------------------- |
| backgroundColor | [&lt;color&gt;](#user-content-color) | 对应 `CSS` `background-color` 属性 |

<a name="transform"></a>

### Transform 转换（3）

| 属性名             | 取值                                                                                                                                                                                                                                    | 描述                                                               |
| ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------ |
| transform          | `[{perspective: number}, {rotate: string}, {rotateX: string}, {rotateY: string}, {rotateZ: string}, {scale: number}, {scaleX: number}, {scaleY: number}, {translateX: number}, {translateY: number}, {skewX: string}, {skewY: string}]` | 对应 `CSS` `transform` 属性                                        |
| transformMatrix    | `TransformMatrixPropType`                                                                                                                                                                                                               | 类似于 `CSS` 中 `transform` 属性的 `matrix()` 和 `matrix3d()` 函数 |
| backfaceVisibility | `visible`, `hidden`                                                                                                                                                                                                                     | 对应 `CSS` `backface-visibility` 属性                              |

<a name="flexbox"></a>

### Flexbox 弹性盒（9）

我们在 React Native 中使用 Flexbox 规则来指定某个组件的子元素的布局。Flexbox 可以在不同屏幕尺寸上提供一致的布局结构。

一般来说，使用 `flexDirection`、`alignItems` 和 `justifyContent` 三个样式属性就已经能满足大多数布局需求。

#### Flex number

在 React Native 中 flex 的表现和 CSS 有些区别。 flex 在 RN 中只能为整数值，其具体表现请参考 [yoga 引擎](https://github.com/facebook/yoga) 的文档，

| 条件                              | 表现                                                                                                         |
| --------------------------------- | ------------------------------------------------------------------------------------------------------------ |
| flex 设置为正整数时，如 `flex: 1` | 组件是弹性的，尺寸和 flex 的值成正比                                                                         |
| `flex:0`                          | 组件没有弹性，且尺寸和 width ，height 一致                                                                   |
| `flex: -1`                        | 在空间足够的情况下，组件的尺寸和 width ，height 一致；但是在空间不足时，组件会被压缩至 minWidth 和 minHeight |

#### Flex Direction

在组件的 style 中指定 flexDirection 可以决定布局的主轴。子元素是应该沿着 `水平轴(row)`方向排列，还是沿着 `竖直轴(column)` 方向排列呢？**默认值是 `竖直轴(column)` 方向**，这点和 CSS 不一样，想要注意。

#### Justify Content

在组件的 style 中指定 justifyContent 可以决定其子元素沿着主轴的排列方式。子元素是应该靠近主轴的起始端还是末尾段分布呢？亦或应该均匀分布？对应的这些可选项有：`flex-start`、`center`、`flex-end`、`space-around` 以及 `space-between`。

#### Align Items

在组件的 style 中指定 alignItems 可以决定其子元素沿着次轴（与主轴垂直的轴，比如若主轴方向为 row，则次轴方向为 column ）的排列方式。子元素是应该靠近次轴的起始端还是末尾段分布呢？亦或应该均匀分布？对应的这些可选项有：`flex-start`、`center`、`flex-end` 以及 `stretch`。

| 属性名         | 取值                                                                | 描述                                                         |
| -------------- | ------------------------------------------------------------------- | ------------------------------------------------------------ |
| flex           | [&lt;number&gt;](#user-content-number)                              | 对应 `CSS` `flex` 属性，但只能为整数值                       |
| flexGrow       | [&lt;number&gt;](#user-content-number)                              | 对应 `CSS` `flex-grow` 属性                                  |
| flexShrink     | [&lt;number&gt;](#user-content-number)                              | 对应 `CSS` `flex-shrink` 属性                                |
| flexBasis      | [&lt;number&gt;](#user-content-number)                              | 对应 `CSS` `flex-basis` 属性                                 |
| flexDirection  | `row`, `row-reverse`, `column`, `column-reverse`                    | 对应 `CSS` `flex-direction` 属性                             |
| flexWrap       | `wrap`, `nowrap`                                                    | 对应 `CSS` `flex-wrap` 属性，但阉割了 `wrap-reverse` 取值    |
| justifyContent | `flex-start`, `flex-end`, `center`, `space-between`, `space-around` | 对应 `CSS` `justify-content` 属性，但阉割了 `stretch` 取值。 |
| alignItems     | `flex-start`, `flex-end`, `center`, `stretch`                       | 对应 `CSS` `align-items` 属性，但阉割了 `baseline` 取值。    |
| alignSelf      | `auto`, `flex-start`, `flex-end`, `center`, `stretch`               | 对应 `CSS` `align-self` 属性，但阉割了 `baseline` 取值       |

### Other 其他

| 属性名                                 | 取值                                   | 描述                                                                 |
| -------------------------------------- | -------------------------------------- | -------------------------------------------------------------------- |
| opacity                                | [&lt;number&gt;](#user-content-number) | 对应 `CSS` `opacity` 属性                                            |
| overflow                               | `visible`, `hidden`, `scroll`          | 对应 `CSS` `overflow` 属性，但阉割了 `auto` 取值                     |
| elevation<br /><sup>`Android`</sup>    | [&lt;number&gt;](#user-content-number) | `CSS` 中没有对应的属性，只在 `Android5.0+` 上有效                    |
| resizeMode                             | `cover`, `contain`, `stretch`          | `CSS` 中没有对应的属性，可以参考 `background-size` 属性              |
| overlayColor<br /><sup>`Android`</sup> | string                                 | `CSS` 中没有对应的属性，当图像有圆角时，将角落都充满一种颜色         |
| tintColor<br /><sup>`iOS`</sup>        | [&lt;color&gt;](#user-content-color)   | `CSS` 中没有对应的属性，`iOS` 图像上特殊的色彩，改变不透明像素的颜色 |

#### Color 颜色

`React Native` 支持了 `CSS` 中大部分的颜色类型：

- `#f00` (#rgb)
- `#f00c` (#rgba)：`CSS` 中无对应的值
- `#ff0000` (#rrggbb)
- `#ff0000cc` (#rrggbbaa)：`CSS` 中无对应的值
- `rgb(255, 0, 0)`
- `rgba(255, 0, 0, 0.9)`
- `hsl(360, 100%, 100%)`
- `hsla(360, 100%, 100%, 0.9)`
- `transparent`
- `0xff00ff00` (0xrrggbbaa)：`CSS` 中无对应的值
- `Color Name`：支持了 [基本颜色关键字](https://css.doyoe.com/appendix/color-keywords.htm#basic) 和 [拓展颜色关键字](https://css.doyoe.com/appendix/color-keywords.htm#extended)，但不支持 [28 个系统颜色](https://css.doyoe.com/appendix/color-keywords.htm#system)；

#### 优先级与继承（Specificity and inheritance）

组件的引入样式的优先级高于全局样式的优先级。

#### 选择器

1. 基本选择器只支持类选择器
2. 不支持组合选择器的写法
3. 不支持伪类及伪元素

#### CSS 的简写属性（Shorthand properties）

仅接受 React Native 支持的值。例如 background 只接受一种颜色 `backgroundColor`，因为 React Native 的 Background 仅支持 `backgroundColor` 属性。React Native 支持的属性可见上述 React Native 样式表。

#### 单位

Taro 使用 [PostCSS](https://github.com/ai/postcss) 单位转换插件 [postcss-pxtransform](https://github.com/NervJS/taro/blob/master/packages/postcss-pxtransform/README.md) 会将 px 转换为 React Native 的 `pt`，具体配置方法可以查看文档。
</file>

<file path="docs/react-native.md">
---
title: React Native 端开发流程
---

> 本篇主要讲解 Taro React Native 端开发流程，React Native 开发前注意事项请看 [开发前注意](./react-native-remind.md)。
>
> Taro3.x 跨端（h5、weapp、rn）开发可参考项目：[Taro 跨平台 demo（React Native + Weapp + h5）](https://github.com/wuba/Taro-Mortgage-Calculator)
>
> Taro React Native APP 开发调试工具，请查看 [Taro Playground](https://github.com/wuba/taro-playground) 项目。

## 简介

Taro 移动端的开发基于 Facebook 的开源项目 [React Native](https://github.com/facebook/react-native)。选择 **React** 框架开发的 Taro 项目，经过适配可以编译成 React Native 的 bundle 文件，再通过对应平台的工具可编译为 Android 及 iOS APP。

整体设计如下：

![image](https://pic8.58cdn.com.cn/nowater/frs/n_v287a918607dea4ac7b28471aef4fc8b6f.pic)

## 开发前准备

为了更顺利地进行开发，我们强烈地建议您，先对 React Native 开发进行学习。学习资料可在 [React Native 中文网](https://reactnative.cn/docs/getting-started)中找到，也可到 [React Native 官网](https://reactnative.dev/docs/getting-started)中查看。

完成基础知识的学习后，建议上手完成环境搭建，并确保能够顺利运行。环境搭建参考 [React Native 中文网的文档](https://reactnative.cn/docs/environment-setup) 及 [React Native 官网的文档](https://reactnative.dev/docs/environment-setup)。

## 开发模式

Taro 开发 React Native APP，提供了两种模式：

0. 集成模式：JS、iOS、Android 在同一仓库，通过 `taro init` 生成且选择 react-native 模板的项目，会采用此模式。与 `npx react-native init AwesomeProject` 生成的项目结构基本一致。**入门开发者推荐使用此模式**。
1. 分离模式：JS 代码在一个仓库，iOS 和 Android 代码在另外一个仓库（也称壳工程）。JS 代码可通过 `taro init` 选择任意模板生成。壳工程代码可 fork [Taro Native Shell 项目](https://github.com/NervJS/taro-native-shell)。

## Taro 对 React Native 的版本兼容情况

我们将以 React Native 最新版为主要适配对象，并及时跟进社区发展。

| React Native 版本 | 兼容情况                                                                                                                           | 壳工程分支                                                                                         |
| ----------------- | ---------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- |
| < 0.60.0          | 不兼容，可考虑使用 Taro 1.x/2.x 版本                                                                                               | -                                                                                                  |
| 0.60.x            | <= 3.4.2 兼容，但未全面测试，有问题请提供 issue                                                                                    | [0.63.2](https://github.com/NervJS/taro-native-shell/tree/0.63.2)，更改 react-native 版本为 0.60.0 |
| 0.61.x            | <= 3.4.2 兼容，但未全面测试，有问题请提供 issue                                                                                    | [0.63.2](https://github.com/NervJS/taro-native-shell/tree/0.63.2)，更改 react-native 版本为 0.61.0 |
| 0.62.x            | <= 3.4.2 兼容，但未全面测试，有问题请提供 issue                                                                                    | [0.63.2](https://github.com/NervJS/taro-native-shell/tree/0.63.2)，更改 react-native 版本为 0.62.0 |
| 0.63.x            | >= 3.2.0，但 3.2.13 版本以后，需手动添加配置，参考 [PR](https://github.com/NervJS/taro/pull/9540)                                  | [0.63.2](https://github.com/NervJS/taro-native-shell/tree/0.63.2)                                  |
| 0.64.x            | >= 3.2.0                                                                                                                           | [0.64.0](https://github.com/NervJS/taro-native-shell/tree/0.64.0)                                  |
| 0.65.x            | >= 3.3.10                                                                                                                          | -                                                                                                  |
| 0.66.x            | >= 3.3.10                                                                                                                          | [0.66.0](https://github.com/NervJS/taro-native-shell/tree/0.66.0)                                  |
| 0.67.x            | >= 3.3.10, unimodules                                                                                                              | [0.67.0](https://github.com/NervJS/taro-native-shell/tree/0.67.0)                                  |
| 0.67.x            | >= 3.3.10, expo                                                                                                                    | [0.67.0-expo](https://github.com/NervJS/taro-native-shell/tree/0.67.0-expo)                        |
| 0.68.x            | >= 3.5.0，但 3.5.6 版本以后，需要使用 expo-av@~11.2.3 react@17，参考[Discussion](https://github.com/NervJS/taro/discussions/12133) | [0.68.0](https://github.com/NervJS/taro-native-shell/tree/0.68.0)                                  |
| 0.69.x            | >= 3.5.6                                                                                                                           | [0.69.0](https://github.com/NervJS/taro-native-shell/tree/0.69.0)                                  |
| 0.70.x            | >= 3.6.0                                                                                                                           | [0.70.0](https://github.com/NervJS/taro-native-shell/tree/0.70.0)                                  |

## 集成模式

使用 `taro init` 命令进行初始化，选择 `react-native` 模板。**完成后执行 `yarn upgradePeerdeps` 进行依赖初始化**。

查看[演示视频](https://wos2.58cdn.com.cn/DeFazYxWvDti/frsupload/6820cfd5e0346eac050e7c3f0df78f65.mp4)。

> 如果需要初始化历史版本的 React-Native 项目，可在 [taro-project-templates](https://github.com/NervJS/taro-project-templates) 仓库中，找到对应版本的分支。
>
> 使用 `taro init --template-source github:NervJS/taro-project-templates#v3.5-RN-0.68` 命令，进行初始化。

### 常用命令

```shell
# 更新相关依赖。在初始化完成后或 Taro 版本更新后执行，用于同步 peerDependencies。
$ yarn upgradePeerdeps

# 打包 js bundle 及静态资源。在初始化完成后执行，用于打包默认使用的 bundle。platform 可选 ios, android
$ yarn build:rn --platform ios

# 启动 bundle server
$ yarn start

# 启动 iOS
$ yarn ios

# 启动安卓
$ yarn android
```

## 分离模式

使用 `taro init` 命令进行初始化，选择默认模板。fork 壳工程代码 [Taro Native Shell 项目](https://github.com/NervJS/taro-native-shell)。

### 配置 output

由于分离模式下，需要将 JS 工程产物输出到壳工程，合并完成打包工作。
可通过修改配置 `./config/index.js` 指定资源输出目录，如

```js
{
  rn: {
    output: {
      iosSourceMapUrl: '', // sourcemap 文件url
      iosSourcemapOutput: '../taro-native-shell/ios/main.map', // sourcemap 文件输出路径
      iosSourcemapSourcesRoot: '', // 将 sourcemap 资源路径转为相对路径时的根目录
      androidSourceMapUrl: '',
      androidSourcemapOutput: '../taro-native-shell/android/app/src/main/assets/index.android.map',
      androidSourcemapSourcesRoot: '',
      ios: '../taro-native-shell/ios/main.jsbundle',
      iosAssetsDest: '../taro-native-shell/ios',
      android: '../taro-native-shell/android/app/src/main/assets/index.android.bundle',
      androidAssetsDest: '../taro-native-shell/android/app/src/main/res'
    },
  }
}
```

### JS 工程常用命令

```shell
# 启动 bundle server
$ yarn dev:rn

# 打包 js bundle 及静态资源。platform 可选 ios, android
$ yarn build:rn --platform ios
```

### 壳工程常用命令

```shell
# 更新相关依赖。Taro 版本更新后执行，用于同步 peerDependencies。
$ yarn upgradePeerdeps

# 启动 iOS
$ yarn ios

# 启动安卓
$ yarn android
```

## 使用 Taro Playground APP 进行调试

为方便没有原生开发经验的开发者对 Taro 进行体验，我们提供了高度集成的开发环境 [Taro Playground](https://github.com/wuba/taro-playground)。开发者仅需要正常运行 JS 工程，即可进行 APP 调试。

同时 Taro Playground APP 项目提供了参考代码，供学习。

查看[演示视频](https://wos2.58cdn.com.cn/DeFazYxWvDti/frsupload/09efc622c1f3fa25574d874314f4a421.mp4)。

### 开发调试

运行如下命令，启动 metro server，并打印二维码：

```shell
yarn dev:rn --qr
```

打开 Taro Playground APP，扫描二维码或在输入框中输入 `ip:port`，加载 dev bundle 进行调试。

### release 调试

运行如下命令，启动 http server，并打印二维码：

```shell
yarn build:rn --qr --platform ios
```

打开 Taro Playground APP，扫描二维码，加载 release bundle 进行调试。注意 Android 和 ios 需要分别验证。

### 分享 release bundle

利用 Taro Playground APP + GitHub Action + jsdelivr，我们可以将自己的 APP 通过二维码分享出来，使用方法参考 [taro-react-native-release 项目](https://github.com/zhiqingchen/taro-react-native-release)。

查看[演示视频](https://wos2.58cdn.com.cn/DeFazYxWvDti/frsupload/4c2ea6b807331f319c5fca2a673b454b.mp4)。

## 打包发布安卓包

先学习 [React Native 如何打包发布安卓包](https://www.react-native.cn/docs/signed-apk-android)。Taro 提供的 React Native 模板中集成了 GitHub Action，可使用 GitHub 进行打包，参考 [assemble_android_release](https://github.com/wuba/taro-playground/blob/main/.github/workflows/assemble_android_release.yml)。

主要包含如下步骤：

1. `yarn`
2. `yarn build:rn --platform android`
3. linux: `sudo apt install -y ruby-bundler`, mac: `gem install bundler`
4. `cd android && bundle update && bundle exec fastlane assemble`

不使用 CI 工具：

1. `yarn`
2. `yarn build:rn --platform android`
3. `cd android && ./gradlew assembleRelease` 或使用 Android Studio 打包

## 打包发布到 APP Store

先学习 [React Native 如何打包发布 iOS 包](https://www.react-native.cn/docs/publishing-to-app-store)。Taro 提供的 React Native 模板中集成了 GitHub Action，可使用 GitHub 进行打包，参考 [assemble_ios_release](https://github.com/wuba/taro-playground/blob/main/.github/workflows/assemble_ios_release.yml)。

主要包含如下步骤：

1. 证书导入
2. `yarn`
3. `yarn build:rn --platform ios`
4. `npx pod-install`
5. `export SKIP_BUNDLING=1`
6. `cd ios && bundle update && bundle exec fastlane build_release`

不使用 CI 工具：

1. `yarn`
2. `yarn build:rn --platform ios`
3. 使用 Xcode 打包

## 进阶教程

### 自定义原生依赖

Taro 对相关依赖做了按需加载，不需要的原生依赖可以不进行安装，以降低 APP 包大小。如 APP 中不涉及音视频，可直接删除 expo-av 依赖。

### 自定义 metro 配置

Taro 使用了 metro 中的 transformer 与 resolver，可与用户配置进行合并，开发者如需对 metro 做配置，可在项目根目录新建 `metro.config.js` 文件进行配置。

Taro 的默认配置为 `const { defaultConfig } = require('@tarojs/rn-runner/dist/config')`，可参考源码进行深入定制。

## 常见问题

### 通过 yarn start 或 yarn dev:rn 启动，如何判断是否成功？

- 启动后在终端可以看到 `React-Native Dev server is running on port: 8081` 等信息
- 在浏览器中输入 http://127.0.0.1:8081/status ，可以看到 packager-status:running
- 在浏览器中输入 http://127.0.0.1:8081/index.bundle?platform=ios&dev=true 会触发构建，此时可以在终端看到以下信息：

BUNDLE ./index ░░░░░░░░░░░░░░░░ 0.0% (0/173)

过程中如果有报错会在终端中提示，如无报错则显示绿色的信息：

BUNDLE ./index

以上三步都正常，说明 metro server 启动正常。

### yarn ios 运行报错：main.jsbundle: No such file or directory

```
yarn build:rn --platform ios
```

### 更新 `app.config` 文件，但发现未更新成功。

metro 缓存导致，尝试 `yarn dev:rn --reset-cache`

### requireNativeComponent: "RNCSafeAreaProvider" was not found in the UIManager.

通常为部分依赖未安装，尝试 `yarn upgradePeerdeps`，或检查是否有依赖遗漏。

### yarn upgradePeerdeps 执行不成功

手动执行 `install-peerdeps @tarojs/taro-rn -o -Y && install-peerdeps @tarojs/components-rn -o -Y && install-peerdeps @tarojs/router-rn -o -Y && pod-install`

### install-peerdeps 也执行不成功

查看 [@tarojs/taro-rn](https://github.com/NervJS/taro/blob/next/packages/taro-rn/package.json)、[@tarojs/router-rn](https://github.com/NervJS/taro/blob/next/packages/taro-router-rn/package.json)、[@tarojs/components-rn](https://github.com/NervJS/taro/blob/next/packages/taro-components-rn/package.json) 的 peerDependencies，手动进行安装。

或者与 [Taro Native Shell](https://github.com/NervJS/taro-native-shell) 的 `package.json` 文件中的 `dependencies` 进行对齐。

### Invariant Violation: Tried to register two views with the same name RNCWebView

此类问题，通常是因为安装了多个版本的原生依赖导致。先通过`yarn why xxx`，例子中对应的命令为 `yarn why react-native-webview`，检查为何安装了多个版本。通过 resolutions 锁定需要的版本，建议使用 [@tarojs/taro-rn](https://github.com/NervJS/taro/blob/next/packages/taro-rn/package.json)、[@tarojs/router-rn](https://github.com/NervJS/taro/blob/next/packages/taro-router-rn/package.json)、[@tarojs/components-rn](https://github.com/NervJS/taro/blob/next/packages/taro-components-rn/package.json) 中的版本。

### packager Not Available

使用 Taro Playground 扫码后提示 packager Not Available，通常为网络问题，检查手机与电脑是否属于同一局域网下。

### Invariant Violation: "taroDemo" has not been registered.

检查 `config/index.js` 文件是否修改了 appName，默认使用 `taroDemo`。

```js
{
  rn: {
    appName: 'taroDemo',
  }
}
```

### 如何修改 appName？

0. 修改 `config/index.js` 中的 `rn.appName`
1. 修改 `MainActivity.java` 中 `getMainComponentName` 方法的返回值
2. 修改 `AppDelegate.m` 中 `RCTRootView *rootView = [[RCTRootView alloc] initWithBridge:bridge moduleName:@"taroDemo" initialProperties:nil];` 的 `moduleName`
3. `yarn dev:rn --reset-cache`

### Library not found for -IDoubleConversion

使用 XCode 编译时，需要打开的文件是 `ios/taroDemo.xcworkspace`

### Entry file index.js does not exist. If you use another file as your entry point, pass ENTRY_FILE=myindex.js

Taro React Native 的 jdbundle 文件由 Taro 进行打包（yarn build:rn），如果使用 React Native 自带命令进行打包（react-native bundle），则会出现如上错误。因此我们需要跳过 React Native 原有的打包阶段。

react-native/ios/taroDemo.xcodeproj/project.pbxproj

```diff
-			shellScript = "set -e\n\nexport NODE_BINARY=node\n../node_modules/react-native/scripts/react-native-xcode.sh\n";
+			shellScript = "set -e\n\nexport NODE_BINARY=node\nexport SKIP_BUNDLING=1\n../node_modules/react-native/scripts/react-native-xcode.sh\n";
```

android/app/build.gradle

```diff
-apply from: "../../node_modules/react-native/react.gradle"
+// apply from: "../../node_modules/react-native/react.gradle"
```
</file>

<file path="docs/react-overall.md">
---
title: 概述
---

Taro 3 支持将 Web 框架直接运行在各平台，开发者使用的是真实的 React 和 Vue 等框架。

但是 Taro 在组件、API、路由等规范上，遵循微信小程序规范，所以在 Taro 中使用 React 和开发者熟悉的 Web 端有一些差异，以下将详细列出。

:::info
[Breaking] 旧项目升级到 Taro v3.4+ 请安装依赖 `@tarojs/plugin-framework-react`
:::

## React API

:::info
[Breaking] 从 Taro 1/2 升级到 Taro 3 的同学需要额外关注
:::

因为在 Taro 3 中开发者使用的是真实的 React，React 的 API 如 `Component`、`useState`、`useEffect` 等都需要从 React 包中获取。

```js
// 从 'react' 包中获取 React API
import React, { Component, useState, useEffect } from 'react'
```

## 入口组件和页面组件

因为 Taro 遵循小程序的路由规范，所以引入了[入口组件](./react-entry)和[页面组件](./react-page)的概念，分别对应小程序规范的入口组件 `app` 和页面组件 `page`。

一个 Taro 应用由一个入口组件和至少一个页面组件所组成。

## 内置组件

:::note
自 Taro v3.3+，支持使用 H5 标签进行开发，详情请见 [使用 HTML 标签](use-h5)
:::

Taro 中可以使用小程序规范的内置组件进行开发，如 `<View>`、`<Text>`、`<Button>` 等。

### Taro 规范

1. 在 React 中使用这些内置组件前，必须从 `@tarojs/components` 进行引入。
2. 组件属性遵从**大驼峰式命名规范**。
3. 事件规范请看下一节：[组件事件](./react-overall#%E4%BA%8B%E4%BB%B6)。

### 示例代码

```jsx
import { Swiper, SwiperItem } from '@tarojs/components'

function Index() {
  return (
    <Swiper
      className="box"
      autoplay
      interval={1000}
      indicatorColor="#999"
      onClick={() => {}}
      onAnimationFinish={() => {}}
    >
      <SwiperItem>
        <View className="text">1</View>
      </SwiperItem>
      <SwiperItem>
        <View className="text">2</View>
      </SwiperItem>
      <SwiperItem>
        <View className="text">3</View>
      </SwiperItem>
    </Swiper>
  )
}
```

注意：如果某平台新增的组件或组件的属性还没被 Taro 支持，可以提交 [Issues](https://github.com/NervJS/taro/issues)，我们会尽快修复。

## 事件

事件和 Web 端一样。在事件回调函数中，第一个参数是事件对象，回调中调用 `stopPropagation` 可以阻止冒泡。

### Taro 规范

1. 内置事件名以 `on` 开头，遵从小驼峰式（camelCase）命名规范。
2. React 中点击事件使用 `onClick`。

### 示例代码

```jsx
function Comp() {
  function clickHandler(e) {
    e.stopPropagation() // 阻止冒泡
  }

  function scrollHandler() {}

  // 只有小程序的 bindtap 对应 Taro 的 onClick
  // 其余小程序事件名把 bind 换成 on 即是 Taro 事件名（支付宝小程序除外，它的事件就是以 on 开头）
  return <ScrollView onClick={clickHandler} onScroll={scrollHandler} />
}
```

### Taro 3 在小程序端的事件机制

在 Taro 1 & 2 中，Taro 会根据开发者是否使用了 `e.stopPropagation()`，来决定在小程序模板中绑定的事件是以 `bind` 还是以 `catch` 形式。因此事件冒泡是由小程序控制的。

但是在 Taro 3，我们在小程序逻辑层实现了一套事件系统，包括事件触发和事件冒泡。在小程序模板中绑定的事件都是以 `bind` 的形式。

一般情况下，这套在逻辑层实现的小程序事件系统是可以正常工作的，事件回调能正确触发、冒泡、停止冒泡。

但是，小程序模板中绑定的 `catchtouchmove` 事件除了可以阻止回调函数冒泡触发外，还能阻止视图的**滚动穿透**，这点 Taro 的事件系统是做不到的。

### 阻止滚动穿透

上一点中，我们介绍了 Taro 3 的事件机制。因为事件都以 `bind` 的形式进行绑定，因此不能使用 `e.stopPropagation()` 阻止滚动穿透。

针对滚动穿透，目前总结了两种解决办法：

#### 一、样式

使用样式解决：[禁止被穿透的组件滚动](https://github.com/NervJS/taro/issues/5984#issuecomment-614502302)。

这也是最推荐的做法。

#### 二、catchMove

> Taro 3.0.21 版本开始支持

但是地图组件本身就是可以滚动的，即使固定了它的宽高。所以第一种办法处理不了冒泡到地图组件上的滚动事件。

这时候可以为 `View` 组件增加 **catchMove** 属性：

```jsx
// 这个 View 组件会绑定 catchtouchmove 事件而不是 bindtouchmove
<View catchMove></View>
```

### dataset

#### 一般情况

我们建议按 React、 Vue 的 DSL 特性进行思考，因为 `dataset` 是小程序的特性。

#### dataset

`dataset` 是特别的模版属性，主要作用是可以在事件回调的 `event` 对象中获取到 `dataset` 相关数据。

**这点 Taro 是支持的**，在事件回调对象中可以通过 `event.target.dataset` 或 `event.currentTarget.dataset` 获取到。

#### 模板属性

上一点所说的，Taro 对于小程序 `dataset` 的模拟是在小程序的**逻辑层**实现的。**并没有真正在模板设置这个属性**。

但在小程序中有一些 API（如：`createIntersectionObserver`）获取到页面的节点的时候，由于节点上实际没有对应的属性而获取不到。

这时可以考虑使用 [taro-plugin-inject](https://github.com/NervJS/taro-plugin-inject) 插件注入一些通用属性，如：

```js title="config/index.js"
const config = {
  plugins: [
    [
      '@tarojs/plugin-inject',
      {
        components: {
          View: {
            'data-index': "'dataIndex'",
          },
          ScrollView: {
            'data-observe': "'dataObserve'",
          },
        },
      },
    ],
  ],
}
```

## 生命周期触发机制

Taro 3 在小程序逻辑层上实现了一份遵循 Web 标准 BOM 和 DOM API。因此 React 使用的 `document.appendChild`、`document.removeChild` 等 API 其实是 Taro 模拟实现的，最终的效果是把 React 的虚拟 DOM 树渲染为 Taro 模拟的 Web 标准 DOM 树。

因此在 Taro3 中，React 的生命周期触发时机和我们平常在 Web 开发中理解的概念有一些偏差。

### React 的生命周期

React 组件的生命周期方法在 Taro 中都支持使用。

触发时机：

##### 1. componentWillMount ()

[onLoad](react-page#onload-options) 之后，页面组件渲染到 Taro 的虚拟 DOM 之前触发。

##### 2. componentDidMount ()

页面组件渲染到 Taro 的虚拟 DOM 之后触发。

此时能访问到 Taro 的虚拟 DOM（使用 React ref、document.getElementById 等手段），并支持对其进行操作（设置 DOM 的 style 等）。

但此时不代表 Taro 的虚拟 DOM 数据已经完成从逻辑层 `setData` 到视图层。因此这时**无法通过 `createSelectorQuery` 等方法获取小程序渲染层 DOM 节点。** 只能在 [onReady](react-page#onready-) 生命周期中获取。

### 小程序页面的方法

小程序页面的方法，在 Taro 的页面中同样可以使用：在 Class Component 中书写同名方法、在 Functional Component 中使用对应的 Hooks。

**注意：**

- 小程序页面方法在各端的支持程度不一。
- 使用了 HOC 包裹的小程序页面组件，必须处理 forwardRef 或使用继承组件的方式而不是返回组件的方式，否则小程序页面方法可能不会被触发。

## Ref

[节点获取](./ref.mdx)

## Hooks

[Hooks 文档](./hooks.md)

## dangerouslySetInnerHTML

在小程序端，使用 `dangerouslySetInnerHTML` 时有一些额外的配置选项和需要注意的地方，详情请参考[《渲染 HTML》](html)。

## createPortal

React `createPortal` 支持将组件渲染至特定的 dom 节点中，由于不能在页面组件的 DOM 树之外插入元素，无法实现应用级别的 `<Portal>` 组件。但你仍可以在当前页面中使用 `createPortal`。

示例项目：[taro-react-portal](https://github.com/AdvancedCat/taro-react-portal)

## Minified React error

因为 development 版本的 React 体积较大，为了减少小程序体积，方便开发时真机预览。Taro 在构建小程序时默认使用 production 版本的 React 相关依赖。

但是 production 版本的 React 出错时不会展示报错堆栈的信息。因此当你遇到类似这种报错时：【Error: Minified React error #152】。可以修改编译配置中的 [mini.debugReact](./config-detail#minidebugreact) 选项，然后重新开启编译。这样 Taro 会使用 development 版本的 React，从而输出报错堆栈。

#### Error: Minified React error #152 报错

![](https://storage.jd.com/cjj-pub-images/minified-react-error.png)

## 其它限制

- 由于小程序不支持动态引入，因此小程序中无法使用 `React.lazy` API。

## 常见问题

- `useEffect`、`componentDidMount` 中获取不到渲染层元素信息，[7116](https://github.com/NervJS/taro/issues/7116)
- `useEffect` 或 `useLayoutEffect` 中获取不到组件最新的宽高，[#7491](https://github.com/NervJS/taro/issues/7491)
- 嵌套层级较深时，使用 `selectorQuery` 无法查询到子元素，[#7411](https://github.com/NervJS/taro/issues/7411)
- Taro React 支持使用 Recoil，如果使用中遇到 `ReferenceError: Window is not defined` 的报错，请参考 [#11429](https://github.com/NervJS/taro/issues/11429) 以绕过。
</file>

<file path="docs/react-page.mdx">
---
title: 页面组件
---

import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

每一个 Taro 应用都至少包括一个页面组件，页面组件可以通过 Taro 路由进行跳转，也可以访问小程序页面的生命周期。

## 代码示例

<Tabs
  defaultValue="class"
  values={[
    {label: 'Class Component', value: 'class'},
    {label: 'Functional Component', value: 'functional'}
  ]}>
<TabItem value="class">

```jsx title="page.js"
import React, { Component } from 'react'
import { View } from '@tarojs/components'

class Index extends Component {
  // 可以使用所有的 React 生命周期方法
  componentDidMount() {}

  // onLoad
  onLoad() {}

  // onReady
  onReady() {}

  // 对应 onShow
  componentDidShow() {}

  // 对应 onHide
  componentDidHide() {}

  // 对应 onPullDownRefresh，除了 componentDidShow/componentDidHide 之外，
  // 所有页面生命周期函数名都与小程序相对应
  onPullDownRefresh() {}

  render() {
    return <View className="index" />
  }
}

export default Index
```

</TabItem>

<TabItem value="functional">

```jsx title="page.js"
import React, { useEffect } from 'react'
import { View } from '@tarojs/components'
import { useReady, useDidShow, useDidHide, usePullDownRefresh } from '@tarojs/taro'

function Index() {
  // 可以使用所有的 React Hooks
  useEffect(() => {})

  // 对应 onReady
  useReady(() => {})

  // 对应 onShow
  useDidShow(() => {})

  // 对应 onHide
  useDidHide(() => {})

  // Taro 对所有小程序页面生命周期都实现了对应的自定义 React Hooks 进行支持
  // 详情可查阅：【Hooks】
  usePullDownRefresh(() => {})

  return <View className="index" />
}

export default Index
```

</TabItem>
</Tabs>

## 页面组件配置

请参考 [页面配置](./page-config)

## 生命周期方法

页面组件除了支持 React 的生命周期方法外，还根据小程序的标准，额外支持以下生命周期：

### onLoad (options)

> 在小程序环境中对应页面的 `onLoad`。

在此生命周期中通过访问 `options` 参数或调用 `getCurrentInstance().router`，可以访问到页面路由参数。

### onUnload ()

:::info
Taro v3.4.7 开始支持。
:::

> 在小程序环境中对应页面的 `onUnload`。

一般情况下建议使用 React 的 `componentWillUnmount` 生命周期处理页面卸载时的逻辑。当某些特殊情况需要在页面的 `onUnload` 的同一个事件循环中实现逻辑时才使用它（如对小程序的生命周期执行顺序有强依赖关系时）。

### onReady ()

> 在小程序环境中对应页面的 `onReady`。

从此生命周期开始可以使用 `createCanvasContext` 或 `createSelectorQuery` 等 API 访问小程序渲染层的 DOM 节点。

#### 子组件的 onReady

只在页面组件才会触发 `onReady` 生命周期。子组件可以使用 Taro 内置的[消息机制](./apis/about/events)监听页面组件的 `onReady()` 生命周期：

```jsx title="页面中某个子组件"
import React from 'react'
import { View } from '@tarojs/components'
import Taro, { eventCenter, getCurrentInstance } from '@tarojs/taro'

class Test extends React.Component {
  $instance = getCurrentInstance()

  componentWillMount() {
    const onReadyEventId = this.$instance.router.onReady
    eventCenter.once(onReadyEventId, () => {
      console.log('onReady')

      // onReady 触发后才能获取小程序渲染层的节点
      Taro.createSelectorQuery()
        .select('#only')
        .boundingClientRect()
        .exec((res) => console.log(res, 'res'))
    })
  }

  render() {
    return <View id="only"></View>
  }
}
```

但是当子组件是**按需加载**的时候，页面 `onReady` 早已触发。如果此按需加载的子组件需要获取小程序渲染层的 DOM 节点，因为错过了页面 `onReady`，只能尝试使用 `Taro.nextTick` 模拟：

```jsx title="按需加载的子组件"
import React from 'react'
import { View } from '@tarojs/components'
import Taro from '@tarojs/taro'

class Test extends React.Component {
  componentDidMount() {
    Taro.nextTick(() => {
      // 使用 Taro.nextTick 模拟 setData 已结束，节点已完成渲染
      Taro.createSelectorQuery()
        .select('#only')
        .boundingClientRect()
        .exec((res) => console.log(res, 'res'))
    })
  }

  render() {
    return <View id="only" />
  }
}
```

### componentDidShow ()

> 在小程序环境中对应页面的 `onShow`。

页面显示/切入前台时触发。

#### 子组件的 onShow

只在页面组件才会触发 `onShow` 生命周期。子组件可以使用 Taro 内置的[消息机制](./apis/about/events)监听页面组件的 `onShow()` 生命周期：

```jsx title="页面中某个子组件"
import React from 'react'
import { View } from '@tarojs/components'
import { eventCenter, getCurrentInstance } from '@tarojs/taro'

class Test extends React.Component {
  $instance = getCurrentInstance()

  componentWillMount() {
    const onShowEventId = this.$instance.router.onShow
    // 监听
    eventCenter.on(onShowEventId, this.onShow)
  }

  componentWillUnmount() {
    const onShowEventId = this.$instance.router.onShow
    // 卸载
    eventCenter.off(onShowEventId, this.onShow)
  }

  onShow = () => {
    console.log('onShow')
  }

  render() {
    return <View id="only" />
  }
}
```

### componentDidHide ()

> 在小程序环境中对应页面的 `onHide`。

页面隐藏/切入后台时触发。

#### 子组件的 onHide

只在页面组件才会触发 `onHide` 生命周期。子组件可以使用 Taro 内置的[消息机制](./apis/about/events)监听页面组件的 `onHide()` 生命周期：

```jsx title="页面中某个子组件"
import React from 'react'
import { View } from '@tarojs/components'
import { eventCenter, getCurrentInstance } from '@tarojs/taro'

class Test extends React.Component {
  $instance = getCurrentInstance()

  componentWillMount() {
    const onHideEventId = this.$instance.router.onHide
    // 监听
    eventCenter.on(onHideEventId, this.onHide)
  }

  componentWillUnmount() {
    const onHideEventId = this.$instance.router.onHide
    // 卸载
    eventCenter.off(onHideEventId, this.onHide)
  }

  onHide = () => {
    console.log('onHide')
  }

  render() {
    return <View id="only" />
  }
}
```

### onPullDownRefresh ()

监听用户下拉动作。

- 需要在全局配置的 window 选项中或页面配置中设置 `enablePullDownRefresh: true`。
- 可以通过 [Taro.startPullDownRefresh](./apis/ui/pull-down-refresh/startPullDownRefresh.md) 触发下拉刷新，调用后触发下拉刷新动画，效果与用户手动下拉刷新一致。
- 当处理完数据刷新后，[Taro.stopPullDownRefresh](./apis/ui/pull-down-refresh/stopPullDownRefresh.md) 可以停止当前页面的下拉刷新.

### onReachBottom ()

监听用户上拉触底事件。

- 可以在全局配置的 window 选项中或页面配置中设置触发距离 `onReachBottomDistance`。
- 在触发距离内滑动期间，本事件只会被触发一次

> 需要 `enablePullDownRefresh` 配置

### onPageScroll (Object)

监听用户滑动页面事件。

> 需要 `enablePullDownRefresh` 配置

#### 参数

##### Object

| 参数      | 类型   | 说明                                  |
| --------- | ------ | ------------------------------------- |
| scrollTop | Number | 页面在垂直方向已滚动的距离（单位 px） |

### onAddToFavorites (Object)

监听用户点击右上角菜单“收藏”按钮的行为，并自定义收藏内容。

> Taro 3.0.3 版本开始支持。
> 只有微信小程序支持，本接口为 Beta 版本，安卓 7.0.15 版本起支持，暂只在安卓平台支持。

#### 参数

##### Object

| 参数       | 类型   | 说明                                                 |
| ---------- | ------ | ---------------------------------------------------- |
| webviewUrl | String | 页面中包含 web-view 组件时，返回当前 web-view 的 url |

此事件处理函数需要 return 一个 Object，用于自定义收藏内容：

| 字段     | 说明                              | 默认值             |
| -------- | --------------------------------- | ------------------ |
| title    | 自定义标题                        | 页面标题或账号名称 |
| imageUrl | 自定义图片，显示图片长宽比为 1：1 | 页面截图           |
| query    | 自定义 query 字段                 | 当前页面的 query   |

#### 示例代码

```js title="page.js"
onAddToFavorites (res) {
  // webview 页面返回 webviewUrl
  console.log('WebviewUrl: ', res?.webviewUrl)
  return {
    title: '自定义标题',
    imageUrl: 'https://demo.png',
    query: 'name=xxx&age=xxx',
  }
}
```

### onShareAppMessage (Object)

监听用户点击页面内转发按钮（Button 组件 openType='share'）或右上角菜单“转发”按钮的行为，并自定义转发内容。

**注意：**

1. 当 `onShareAppMessage` 没有触发时，请在页面配置中设置 `enableShareAppMessage: true`
2. 只有定义了此事件处理函数，右上角菜单才会显示“转发”按钮

#### 参数

##### Object

| 参数       | 类型   | 说明                                                                                     |
| ---------- | ------ | ---------------------------------------------------------------------------------------- |
| from       | String | 转发事件来源。<br />button：页面内转发按钮；<br />menu：右上角转发菜单                   |
| target     | Object | 如果 `from` 值是 `button`，则 `target` 是触发这次转发事件的 `button`，否则为 `undefined` |
| webViewUrl | String | 页面中包含 `WebView` 组件时，返回当前 `WebView` 的 url                                   |

此事件需要 return 一个 Object，用于自定义转发内容，返回内容如下：

自定义转发内容

| 字段     | 类型                                                                                                       | 说明                                      |
| -------- | ---------------------------------------------------------------------------------------------------------- | ----------------------------------------- |
| title    | 转发标题                                                                                                   | 当前小程序名称                            |
| path     | 转发路径                                                                                                   | 当前页面 path ，必须是以 / 开头的完整路径 |
| imageUrl | 自定义图片路径，可以是本地文件路径、代码包文件路径或者网络图片路径。支持 PNG 及 JPG 。显示图片长宽比是 5:4 | 使用默认截图                              |

#### 示例代码

```jsx title="page.js"
export default class Index extends Component {
  onShareAppMessage(res) {
    if (res.from === 'button') {
      // 来自页面内转发按钮
      console.log(res.target)
    }
    return {
      title: '自定义转发标题',
      path: '/page/user?id=123',
    }
  }
}
```

```jsx title="page.config.js"
export default {
  // 当 `onShareAppMessage` 没有触发时，可以尝试配置此选项
  enableShareAppMessage: true,
}
```

### onShareTimeline ()

监听右上角菜单“分享到朋友圈”按钮的行为，并自定义分享内容。

> Taro 3.0.3 版本开始支持
> 只有微信小程序支持，基础库 2.11.3 开始支持，本接口为 Beta 版本，暂只在 Android 平台支持

**注意：**

1. 当 `onShareTimeline` 没有触发时，请在页面配置中设置 `enableShareTimeline: true`
2. 只有定义了此事件处理函数，同时监听了 `onShareAppMessage`，右上角菜单才会显示“分享到朋友圈”按钮

#### 返回值

事件处理函数可以返回一个 Object，用于自定义分享内容，不支持自定义页面路径，返回内容如下：

| 字段     | 说明                                                                                | 默认值                 |
| -------- | ----------------------------------------------------------------------------------- | ---------------------- |
| title    | 自定义标题                                                                          | 当前小程序名称         |
| query    | 自定义页面路径中携带的参数                                                          | 当前页面路径携带的参数 |
| imageUrl | 自定义图片路径，可以是本地文件或者网络图片。支持 PNG 及 JPG，显示图片长宽比是 1:1。 | 默认使用小程序 Logo    |

#### 示例代码

```jsx title="page.js"
class Index extends Component {
  onShareAppMessage() {}
  onShareTimeline() {
    console.log('onShareTimeline')
    return {}
  }
}
```

```jsx title="page.config.js"
export default {
  // 当 `onShareAppMessage` 没有触发时，可以尝试配置此选项
  enableShareAppMessage: true,
  // 当 `onShareTimeline` 没有触发时，可以尝试配置此选项
  enableShareTimeline: true,
}
```

### onResize (Object)

小程序屏幕旋转时触发。详见 [响应显示区域变化](https://developers.weixin.qq.com/miniprogram/dev/framework/view/resizable.html#%E5%9C%A8%E6%89%8B%E6%9C%BA%E4%B8%8A%E5%90%AF%E7%94%A8%E5%B1%8F%E5%B9%95%E6%97%8B%E8%BD%AC%E6%94%AF%E6%8C%81)。

### onTabItemTap (Object)

点击 tab 时触发。

#### 参数

##### Object

| 参数     | 类型   | 说明                             |
| -------- | ------ | -------------------------------- |
| index    | String | 被点击 tabItem 的序号，从 0 开始 |
| pagePath | String | 被点击 tabItem 的页面路径        |
| text     | String | 被点击 tabItem 的按钮文字        |

### onSaveExitState

:::info
Taro v3.5.0+ 开始支持
:::

每当小程序可能被销毁之前，页面回调函数 `onSaveExitState` 会被调用，可以进行[退出状态](https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/operating-mechanism.html#_4-%E9%80%80%E5%87%BA%E7%8A%B6%E6%80%81)的保存。

> 只有微信小程序支持，基础库 2.7.4 开始支持。

### onTitleClick ()

> 只有支付宝小程序支持

点击标题触发

### onOptionMenuClick ()

> 只有支付宝小程序支持

点击导航栏额外图标触发

### onPopMenuClick ()

> 只有支付宝小程序支持

暂无说明

### onPullIntercept ()

> 只有支付宝小程序支持

下拉截断时触发
</file>

<file path="docs/README.mdx">
---
title: Taro 介绍
---

import Link from '@docusaurus/Link'
import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

import News from './news'

## 简介

**Taro** 是一个开放式跨端跨框架解决方案，支持使用 React/Vue/Nerv 等框架来开发 [微信](https://mp.weixin.qq.com/) / [京东](https://mp.jd.com/?entrance=taro) / [百度](https://smartprogram.baidu.com/) / [支付宝](https://mini.open.alipay.com/) / [字节跳动](https://developer.open-douyin.com/) / [QQ](https://q.qq.com/) / [飞书](https://open.feishu.cn/document/uYjL24iN/ucDOzYjL3gzM24yN4MjN) / [快手](https://mp.kuaishou.com/) 小程序 / H5 / RN / [ASCF元服务](https://developer.huawei.com/consumer/cn/doc/atomic-ascf/ascf-overview) 等应用。

现如今市面上端的形态多种多样，Web、React Native、微信小程序等各种端大行其道。当业务要求同时在不同的端都要求有所表现的时候，针对不同的端去编写多套代码的成本显然非常高，这时候只编写一套代码就能够适配到多端的能力就显得极为需要。

## 特性

### 多端转换支持

Taro 3 可以支持转换到 H5、ReactNative 以及任意小程序平台。

目前官方支持转换的平台如下：

- [<img title="H5" src={require('@site/static/img/platform/h5.png').default} className="icon_platform" width="25px" /> H5](https://developer.mozilla.org/zh-CN/docs/Web?from=taro)
- [<img title="React Native" src={require('@site/static/img/platform/rn.png').default} className="icon_platform" width="25px" /> React Native](https://reactnative.dev/?from=taro)
- [<img title="微信小程序" src={require('@site/static/img/platform/weapp.png').default} className="icon_platform" width="25px" /> 微信小程序](https://developers.weixin.qq.com/miniprogram/dev/framework/?from=taro)
- [<img title="京东小程序" src={require('@site/static/img/platform/jd.png').default} className="icon_platform" width="25px" /> 京东小程序](https://mp.jd.com/?from=taro)
- [<img title="百度小程序" src={require('@site/static/img/platform/swan.png').default} className="icon_platform" width="25px" /> 百度智能小程序](https://smartprogram.baidu.com/developer/index.html?from=taro)
- [<img title="支付宝小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px" /> 支付宝小程序](https://opendocs.alipay.com/mini/developer/getting-started?from=taro)
- [<img title="抖音小程序" src={require('@site/static/img/platform/tt.png').default} className="icon_platform" width="25px" /> 抖音小程序](https://developer.open-douyin.com/docs/resource/zh-CN/mini-app/introduction/overview?from=taro)
- [<img title="QQ 小程序" src={require('@site/static/img/platform/qq.png').default} className="icon_platform" width="25px" /> QQ 小程序](https://q.qq.com/wiki/develop/miniprogram/frame/?from=taro)
- [<img title="钉钉小程序" src={require('@site/static/img/platform/ding-talk.png').default} className="icon_platform" width="25px" /> 钉钉小程序](https://open.dingtalk.com/document/org/develop-org-mini-programs?from=taro)
- [<img title="企业微信小程序" src={require('@site/static/img/platform/wework.png').default} className="icon_platform" width="25px" /> 企业微信小程序](https://developers.weixin.qq.com/miniprogram/dev/devtools/qywx-dev.html?from=taro)
- [<img title="支付宝 IOT 小程序" src={require('@site/static/img/platform/alipay.png').default} className="icon_platform" width="25px" /> 支付宝 IOT 小程序](https://opendocs.alipay.com/iot/multi-platform/vcs0fv?from=taro)
- [<img title="飞书小程序" src={require('@site/static/img/platform/lark.png').default} className="icon_platform" width="25px" /> 飞书小程序](https://open.feishu.cn/document/uYjL24iN/uMjNzUjLzYzM14yM2MTN?from=taro)
- [<img title="快手小程序" src={require('@site/static/img/platform/kuaishou.png').default} className="icon_platform" width="25px" /> 快手小程序](https://mp.kuaishou.com/docs/develop/frame/config/conf_appjson.html?from=taro)
- [<img title="ASCF元服务" src={require('@site/static/img/platform/ascf.png').default} className="icon_platform" width="25px" /> ASCF元服务](https://developer.huawei.com/consumer/cn/doc/atomic-ascf/ascf-overview)

### 框架支持

在 Taro 3 中可以使用完整的 [**<img title="react" src={require('@site/static/img/framework/react.png').default} className="icon_platform" width="25px" /> React**](https://react.dev/) / [**<img title="vue" src={require('@site/static/img/framework/vue.png').default} className="icon_platform" width="25px" /> Vue**](https://vuejs.org/) / [**<img title="preact" src={require('@site/static/img/framework/preact.png').default} className="icon_platform" width="25px" /> Preact**](https://preactjs.com/) / [**<img title="svelte" src={require('@site/static/img/framework/svelte.png').default} className="icon_platform" width="25px" /> Svelte**](https://svelte.dev/) / [**<img title="nerv" src={require('@site/static/img/framework/nerv.png').default} className="icon_platform" width="25px" /> Nerv**](https://github.com/NervJS/nerv) 开发体验，具体请参考：

- [基础教程——React](./react-overall)
- [基础教程——Vue](./vue-overall)
- [基础教程——Vue3](./vue3)
- [基础教程——Preact](./preact)

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx title="示例代码"
import React, { Component } from 'react'
import { View, Text } from '@tarojs/components'

export default class Index extends Component {
  state = {
    msg: 'Hello World！',
  }

  componentWillMount() {}

  componentDidShow() {}

  componentDidHide() {}

  render() {
    return (
      <View className="index">
        <Text>{this.state.msg}</Text>
      </View>
    )
  }
}
```

</TabItem>

<TabItem value="Vue">

```html title="示例代码"
<template>
  <view class="index">
    <text>{{msg}}</text>
  </view>
</template>

<script>
  export default {
    data() {
      return {
        msg: 'Hello World！',
      }
    },
    created() {},
    onShow() {},
    onHide() {},
  }
</script>
```

</TabItem>
</Tabs>

## 新闻资讯

<News />

## Taro UI

> Taro 3 只能配合使用 taro-ui@next 版本
>
> 安装命令： `npm i taro-ui@next`

一款基于 `Taro` 框架开发的多端 UI 组件库。

[Taro UI](https://taro-ui.jd.com) 特性：

- 基于 `Taro` 开发 UI 组件
- 一套组件可以在多端适配运行（`ReactNative` 端暂不支持）
- 提供友好的 API，可灵活的使用组件

## 学习资源

[【资讯】Taro 团队博客](/blog)

[【教程】5 分钟上手 Taro 开发](/docs/guide)

[【视频】5 分钟快速上手 Taro 开发小程序](https://mp.weixin.qq.com/s?__biz=MzU3NDkzMTI3MA==&mid=2247484205&idx=1&sn=935bb7a35c11c33563eeb7c3aaca3321&chksm=fd2bab04ca5c2212b4cd8aeb5858bd08517aeb31e20727b22d1eee00b394184e7e61359e7dd9&token=1180618535&lang=zh_CN#rd)

[【掘金小册】Taro 多端开发实现原理与实战](https://juejin.im/book/5b73a131f265da28065fb1cd?referrer=5ba228f16fb9a05d3251492d) (已下架，仅购买用户可阅)

更多的资源请点击查看 [更多资源](./composition.md) ，如果您有好的资源或教程和大家分享，欢迎提交资源到 [awesome-taro](https://github.com/NervJS/awesome-taro)。

## 项目状态

![[](https://github.com/NervJS/taro/pulse)](https://repobeats.axiom.co/api/embed/275806b6f177f7e4c005e956d94440562635c36d.svg "Repobeats analytics image")

## 使用案例

Taro 已经投入了我们的生产环境中使用，业界也在广泛地使用 Taro 开发多端应用。

<Link to="/showcase">查看更多的案例，请点击</Link>

[我们正在征集更多优秀案例，欢迎点击提交](https://github.com/NervJS/taro/issues/244)

![[](https://nervjs.github.io/taro-user-cases/)](https://raw.githubusercontent.com/NervJS/taro-user-cases/master/user-cases.jpg)
</file>

<file path="docs/redux.md">
---
title: React Redux
---

在 Taro 中可以自由地使用 React 生态中非常流行的数据流管理工具 [Redux](https://redux.js.org/) 来解决复杂项目的数据管理问题。

## 安装

首先请安装 `redux` 、 `react-redux` 和 `redux-thunk` 、 `redux-logger` 等一些需要用到的 redux 中间件：

```bash
$ yarn add redux react-redux redux-thunk redux-logger
# 或者使用 npm
$ npm install --save redux react-redux redux-thunk redux-logger
```

## 例子

- 运行 `taro init` 命令时选择 React -> redux 即可创建 react-redux 模板项目
- [Todo App](https://github.com/NervJS/TodoMVC)

## 使用

### 创建 `store` 与配置中间件

在项目中新建 `src/store/index.js` 文件用来配置 `store`，按自己喜好设置 redux 的中间件，例如下面例子中使用了 `redux-thunk` 和 `redux-logger` 这两个中间件：

```jsx title="src/store/index.js"
import { createStore, applyMiddleware, compose } from 'redux'
import thunkMiddleware from 'redux-thunk'
import rootReducer from '../reducers'

const composeEnhancers =
  typeof window === 'object' && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__
    ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({
        // Specify extension’s options like name, actionsBlacklist, actionsCreators, serialize...
      })
    : compose

const middlewares = [thunkMiddleware]

if (process.env.NODE_ENV === 'development') {
  middlewares.push(require('redux-logger').createLogger())
}

const enhancer = composeEnhancers(
  applyMiddleware(...middlewares)
  // other store enhancers if any
)

export default function configStore() {
  const store = createStore(rootReducer, enhancer)
  return store
}
```

接下来在项目入口文件 `app.js` 中使用 react-redux 中提供的 `Provider` 组件将上一步写好的 `store` 接入应用中：

```jsx title="src/app.js"
import { Component } from 'react'
import { Provider } from 'react-redux'
import configStore from './store'

const store = configStore()

class App extends Component {
  render() {
    return <Provider store={store}>{this.props.children}</Provider>
  }
}

export default App
```

随后就可以开始使用了。如 `redux` 推荐的那样，可以增加：

- `constants` 目录，用来放置所有的 `action type` 常量。
- `actions` 目录，用来放置所有的 `actions`。
- `reducers` 目录，用来放置所有的 `reducers`。

接下来将演示如何使用 redux 开发一个简单的加、减计数器功能。

### 新增 `action type`

```jsx title="src/constants/counter.js"
export const ADD = 'ADD'
export const MINUS = 'MINUS'
```

### 新增 `reducers`

```jsx title="src/reducers/counter.js"
import { ADD, MINUS } from '../constants/counter'

const INITIAL_STATE = {
  num: 0,
}

export default function counter(state = INITIAL_STATE, action) {
  switch (action.type) {
    case ADD:
      return {
        ...state,
        num: state.num + 1,
      }
    case MINUS:
      return {
        ...state,
        num: state.num - 1,
      }
    default:
      return state
  }
}
```

```jsx title="src/reducers/index.js"
import { combineReducers } from 'redux'
import counter from './counter'

export default combineReducers({
  counter,
})
```

### 新增 `actions`

```jsx title="src/actions/counter.js"
import { ADD, MINUS } from '../constants/counter'

export const add = () => {
  return {
    type: ADD,
  }
}
export const minus = () => {
  return {
    type: MINUS,
  }
}

// 异步的 action
export function asyncAdd() {
  return (dispatch) => {
    setTimeout(() => {
      dispatch(add())
    }, 2000)
  }
}
```

### 在页面、组件中使用 `store`

最后，我们可以在页面（或者组件）中进行使用，我们将通过 react-redux 提供的 `connect` 方法将 `store` 与我们的页面进行连接：

```jsx title="src/pages/index/index.js"
import { Component } from 'react'
import { connect } from 'react-redux'
import { View, Button, Text } from '@tarojs/components'
import { add, minus, asyncAdd } from '../../actions/counter'

@connect(
  ({ counter }) => ({
    counter,
  }),
  (dispatch) => ({
    add() {
      dispatch(add())
    },
    dec() {
      dispatch(minus())
    },
    asyncAdd() {
      dispatch(asyncAdd())
    },
  })
)
class Index extends Component {
  render() {
    return (
      <View className="index">
        <Button className="add_btn" onClick={this.props.add}>
          +
        </Button>
        <Button className="dec_btn" onClick={this.props.dec}>
          -
        </Button>
        <Button className="dec_btn" onClick={this.props.asyncAdd}>
          async
        </Button>
        <View>
          <Text>{this.props.counter.num}</Text>
        </View>
      </View>
    )
  }
}

export default Index
```

`connect` 方法接受两个参数 `mapStateToProps` 与 `mapDispatchToProps`

- `mapStateToProps`，函数类型，接受最新的 `state` 作为参数，用于将 `state` 映射到组件的 `props`
- `mapDispatchToProps`，函数类型，接收 `dispatch()` 方法并返回期望注入到展示组件的 `props` 中的回调方法

## React Redux Hooks

在**函数式组件**中可以使用 react-redux 提供的 Hooks API 连接、操作 `store`。

### `useSelector`

[useSelector](https://react-redux.js.org/api/hooks#useselector) 允许你使用 selector 函数从 store 中获取数据。

```ts title="使用"
const result: any = useSelector(selector: Function, equalityFn?: Function)
```

selector 函数大致相当于 `connect` 函数的 `mapStateToProps` 参数。selector 会在组件每次渲染时调用。`useSelector` 同样会订阅 redux store，在 redux action 被 dispatch 时调用。

但 `useSelector` 还是和 `mapStateToProps` 有一些不同：

- 不像 `mapStateToProps` 只返回对象一样，selector 可能会返回任何值。
- 当一个 action dispatch 时，`useSelector` 会把 selector 的前后返回值做一次浅对比，如果不同，组件会强制更新。
- selector 函数不接受 `ownProps` 参数。但 selector 可以通过闭包访问函数式组件传递下来的 props。

#### 使用案例

基本使用：

```jsx
import { Component } from 'react'
import { useSelector } from 'react-redux'

export const CounterComponent = () => {
  const counter = useSelector((state) => state.counter)
  return <View>{counter}</View>
}
```

使用闭包决定如何 select 数据：

```jsx
export const TodoListItem = (props) => {
  const todo = useSelector((state) => state.todos[props.id])
  return <View>{todo.text}</View>
}
```

进阶使用：

你还可以访问 [react-redux 文档](https://react-redux.js.org/api/hooks#using-memoizing-selectors) 了解如何使用 `reselect` 缓存 selector。

### `useDispatch`

[useDispatch](https://react-redux.js.org/api/hooks#usedispatch) 返回 redux store 的 `dispatch` 引用。你可以使用它来 dispatch actions。

```js title="使用"
const dispatch = useDispatch()
```

#### 使用案例

```jsx
import { Component } from 'react'
import { useDispatch } from 'react-redux'

export const CounterComponent = ({ value }) => {
  const dispatch = useDispatch()

  return (
    <View>
      <Text>{value}</Text>
      <Button onClick={() => dispatch({ type: 'increment-counter' })}>Increment counter</Button>
    </View>
  )
}
```

当我们使用 `dispatch` 传递回调到一个子组件时，推荐使用 `useCallback` 把回调缓存起来，因为组件可能因为引用改变而重新渲染。

```jsx
// CounterComponent.js
export const CounterComponent = ({ value }) => {
  const dispatch = useDispatch()
  const incrementCounter = useCallback(() => dispatch({ type: 'increment-counter' }), [dispatch])

  return (
    <View>
      <Text>{value}</Text>
      <MyIncrementButton onIncrement={incrementCounter} />
    </View>
  )
}

// IncrementButton.js
const MyIncrementButton = ({ onIncrement }) => <Button onClick={onIncrement}>Increment counter</Button>

export default Taro.memo(MyIncrementButton)
```

### `useStore`

[useStore](https://react-redux.js.org/api/hooks#usestore) 返回一个 store 引用，和 `Provider` 组件引用完全一致。

```js title="使用"
const store = useStore()
```

> 这个 hook 可能并不经常使用。`useSelector` 大部分情况是你的第一选择，如果需要替换 reducers 的情况下可能会使用到这个 API。

#### 使用案例

```jsx
import { Component } from 'react'
import { useStore } from 'react-redux'

export const CounterComponent = ({ value }) => {
  const store = useStore()

  // EXAMPLE ONLY! Do not do this in a real app.
  // The component will not automatically update if the store state changes
  return <div>{store.getState()}</div>
}
```

## 持久化

开发者可以使用 [redux-presist](https://github.com/rt2zz/redux-persist) 对 store 的数据进行持久化。

用法及相关讨论请参考 [#6548](https://github.com/NervJS/taro/issues/6548)，其中有两个需要注意的点：

- 配置 `persistConfig` 把 storage API 替换为 Taro Storage API，请参考 [redux-persist-taro-storage](https://github.com/imtcn/redux-persist-taro-storage)。
- `<PersistGate>` 的使用，请参考 [@ryougifujino 的回答](https://github.com/NervJS/taro/issues/6548#issuecomment-816529998)。
</file>

<file path="docs/ref.mdx">
---
title: 节点获取
---

import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

在 Web 开发中，常用的节点获取方法包括了 `document.getElementById` 等 DOM API，以及各开发框架的 `ref` 语法。而在 Taro 中，一般情况下建议使用 `ref` 语法来获取节点。但受限于[小程序平台的实现机制](implement-note#运行时)，如果需要获取节点的**尺寸、定位等与渲染有关的信息**，开发者需要使用 `Taro.createSelectorQuery` API 来获取节点。

## ref 语法

Taro 支持使用 React / Vue 等开发框架的 `ref` 语法来获取节点。开发者可以对这些节点进行一些操作，例如：调用节点的方法、设置属性等，但在小程序平台中不能获取到节点的尺寸信息。

:::info
不同平台 ref 获取到的节点类型不同，但 Taro 尽量保证了这些节点具有统一的属性与 API。
- H5 Ref 类型：Taro 组件实例，一般是 WebComponents。
- 小程序 Ref 类型：Taro 虚拟 DOM 节点，如 TaroElement。存在于逻辑层，因此不携带节点尺寸信息。
- RN Ref 类型：Taro 组件实例。
:::

<Tabs
  defaultValue="react"
  values={[
    {label: <ReactIcon />, value: 'react'},
    {label: <VueIcon version={2} />, value: 'vue2'},
    {label: <VueIcon version={3} />, value: 'vue3'}
  ]}
>

<TabItem value="react">

```tsx title="示例代码"
import { useRef } from 'react'
import { Input, Button } from '@tarojs/components'

export default function Index () {
  const inputRef = useRef<HTMLInputElement>(null)

  function handleClick() {
    inputRef.current?.focus()
  }

  return (
    <>
      <Input ref={inputRef} />
      <Button onClick={handleClick}>Focus the input</Button>
    </>
  )
}
```

</TabItem>

<TabItem value="vue2">

```html title="示例代码"
<template>
  <view>
    <input ref="inputRef" />
    <button @tap="handleClick">Focus the input</button>
  </view>
</template>

<script>
  export default {
    methods: {
      handleClick () {
        this.$refs.inputRef.focus()
      }
    }
  }
</script>
```

</TabItem>

<TabItem value="vue3">

```html title="示例代码"
<template>
  <input ref="inputRef" />
  <button @tap="handleClick">Focus the input</button>
</template>

<script setup>
  import { ref } from 'vue'

  const inputRef = ref(null)

  function handleClick () {
    inputRef.value.focus()
  }
</script>
```

</TabItem>
</Tabs>

## 获取节点尺寸信息

使用 `Taro.createSelectorQuery` API 可以获取到节点的尺寸、定位等与渲染有关的信息。考虑到小程序的实现机制，需要配合在 `onReady` 生命周期中获取节点信息。

:::tip
各个小程序的渲染机制不同，导致了小程序生命周期和 Taro React / Vue 生命周期的触发顺序也不尽相同。如果存在获取节点失败的情况，请尝试使用 `Taro.nextTick` 或 `setTimeout` 等方法增加延时。
:::

<Tabs
  defaultValue="react"
  values={[
    {label: <ReactIcon />, value: 'react'},
    {label: <VueIcon version={2} />, value: 'vue2'},
    {label: <VueIcon version={3} />, value: 'vue3'}
  ]}
>

<TabItem value="react">

```tsx title="示例代码"
import { View } from '@tarojs/components'
import Taro, { useReady } from '@tarojs/taro'

export default function Index () {
  useReady(() => {
    // 初次渲染时，在小程序触发 onReady 后，才能获取小程序的渲染层节点
    Taro.createSelectorQuery()
      .select('#target')
      .boundingClientRect()
      .exec(res => console.log(res))
  })

  return (
    <View id="target"></View>
  )
}
```

</TabItem>

<TabItem value="vue2">

```html title="示例代码"
<template>
  <view id="target" />
</template>

<script>
  import Taro from '@tarojs/taro'

  export default {
    onReady() {
      // 初次渲染时，在小程序触发 onReady 后，才能获取小程序的渲染层节点
      Taro.createSelectorQuery()
        .select('#target')
        .boundingClientRect()
        .exec(res => console.log(res))
    }
  }
</script>

```

</TabItem>

<TabItem value="vue3">

```html title="示例代码"
<template>
  <view id="target" />
</template>

<script setup>
  import Taro, { useReady } from '@tarojs/taro'

  useReady(() => {
    // 初次渲染时，在小程序触发 onReady 后，才能获取小程序的渲染层节点
    // Vue3 需要使用 Taro.nextTick 确保已经渲染完成
    Taro.nextTick(() => {
      Taro.createSelectorQuery()
        .select('#target')
        .boundingClientRect()
        .exec(res => console.log(res))
    })
  })
</script>
```

</TabItem>
</Tabs>

### 在子组件中获取

`onReady` 是页面级别的生命周期，如果需要在子组件中调用 `Taro.createSelectorQuery`，建议使用 `useReady` 钩子。

若开发者没有使用 React Hook 或 Vue3 Composition API，则需要基于 Taro 的事件通讯机制，监听页面 `onReady` 的调用，请参考：[React](./react-page#子组件的-onready)、[Vue](./vue-page#子组件的-onready)。

<Tabs
  defaultValue="react"
  values={[
    {label: <ReactIcon />, value: 'react'},
    {label: <VueIcon version={3} />, value: 'vue3'}
  ]}
>

<TabItem value="react">

```tsx title="示例代码"
import { View } from '@tarojs/components'
import Taro, { useReady } from '@tarojs/taro'

function Comp () {
  useReady(() => {
    // 初次渲染时，在小程序触发 onReady 后，才能获取小程序的渲染层节点
    Taro.createSelectorQuery()
      .select('#target')
      .boundingClientRect()
      .exec((res) => console.log(res))
  })

  return (
    <View id="target"></View>
  )
}

export default function Index () {
  return (
    <Comp></Comp>
  )
}
```

</TabItem>

<TabItem value="vue3">

```html title="示例代码"
<!-- page -->
<template>
  <comp></comp>
</template>

<script setup>
  import Comp from './comp'
</script>

<!-- component -->
<template>
  <view id="target" />
</template>

<script setup>
  import Taro, { useReady } from '@tarojs/taro'

  useReady(() => {
    Taro.nextTick(() => {
      Taro.createSelectorQuery()
        .select('#target')
        .boundingClientRect()
        .exec(res => console.log(res))
    })
  })
</script>
```

</TabItem>
</Tabs>

### 在懒加载组件中获取

另一个常见的场景则是使用了懒加载的组件。当它们挂载时，页面的 `onReady` 早已触发，这时需要配合使用 `Taro.nextTick` API 才能成功获取到节点信息。

<Tabs
  defaultValue="react"
  values={[
    {label: <ReactIcon />, value: 'react'},
    {label: <VueIcon version={3} />, value: 'vue3'}
  ]}
>

<TabItem value="react">

```tsx title="示例代码"
import { View, Button, Canvas } from '@tarojs/components'
import Taro from '@tarojs/taro'
import { useState, useEffect } from 'react'

export default function Index () {
  const [isShow, setIsShow] = useState(false)

  return (
    <View>
      <Button onClick={() => setIsShow(true)}>Load Component</Button>
      {isShow && <LazyFloor></LazyFloor>}
    </View>
  )
}

function LazyFloor () {
  useEffect(() => {
    Taro.nextTick(() => {
      Taro.createSelectorQuery()
        .select(`.ec-canvas`)
        .fields({ node: true, size: true })
        .exec(res => console.log('res: ', res))
    })
  }, [])
  return (
    <View>
      <Canvas canvasId='canvas' className='ec-canvas'></Canvas>
    </View>
  )
}
```

</TabItem>

<TabItem value="vue3">

```html title="示例代码"
<!-- page -->
<template>
  <view>
    <button @tap="isShow = true">Load Component</button>
    <LazyFloor v-if="isShow"></LazyFloor>
  </view>
</template>

<script setup>
  import { ref } from 'vue'
  import LazyFloor from './lazyFloor'

  const isShow = ref(false)
</script>

<!-- component -->
<template>
  <view>
    <canvas canvas-id='canvas' class='ec-canvas'></canvas>
  </view>
</template>

<script setup>
  import Taro from '@tarojs/taro'
  import { onMounted } from 'vue'

  onMounted(() => {
    Taro.nextTick(() => {
      Taro.createSelectorQuery()
        .select(`.ec-canvas`)
        .fields({ node: true, size: true })
        .exec(res => console.log('res: ', res))
    })
  })
</script>
```

</TabItem>
</Tabs>

### 在更新渲染时获取

上述讨论的都是初次渲染的情况，如果需要在更新渲染时获取节点信息，可以在 `componentDidUpdate`、 `useEffect`（React）或 `onUpdated`（Vue3）等更新渲染完成钩子中配合 `nextTick` 获取。用法和[懒加载组件](./ref#在懒加载组件中获取)类似。

### 使用了 CustomWrapper 时

:::tip
如果你的项目只需要运行在小程序端，也可以使用 `>>>` 选择器来解决：[#7411](https://github.com/NervJS/taro/issues/7411)
:::

在小程序平台，每个 `CustomWrapper` 实例对应一个原生自定义组件。小程序规定，如果要获取自定义组件内的节点，必须调用 `.in` 方法，其中 `scope` 是对应的自定义组件实例：`Taro.createSelectorQuery().in(scope)`。

对应在 Taro 中，开发者可以先使用 ref 获取 `CustomWrapper` 实例，然后通过其 `ctx` 属性获取到 `scope`，例子：

<Tabs
  defaultValue="react"
  values={[
    {label: <ReactIcon />, value: 'react'},
    {label: <VueIcon version={3} />, value: 'vue3'}
  ]}
>

<TabItem value="react">

```tsx title="示例代码"
import { View, Canvas, CustomWrapper } from '@tarojs/components'
import Taro, { useReady } from '@tarojs/taro'
import { createRef } from 'react'

export default function Index () {
  const wrapperRef = createRef()

  useReady(() => {
    Taro.createSelectorQuery()
      .in(wrapperRef.current.ctx)
      .select(`.ec-canvas`)
      .fields({ node: true, size: true })
      .exec(res => console.log('res: ', res))
  })

  return (
    <View>
      <CustomWrapper ref={wrapperRef}>
        <Canvas canvasId='canvas' className='ec-canvas'></Canvas>
      </CustomWrapper>
    </View>
  )
}
```

</TabItem>

<TabItem value="vue3">

```html title="示例代码"
<template>
  <view>
    <custom-wrapper ref="wrapperRef">
      <canvas canvas-id='canvas' class='ec-canvas'></canvas>
    </custom-wrapper>
  </view>
</template>

<script setup>
  import Taro, { useReady } from '@tarojs/taro'
  import { ref } from 'vue'

  const wrapperRef = ref()

  useReady(() => {
    Taro.nextTick(() => {
      Taro.createSelectorQuery()
        .in(wrapperRef.value.ctx)
        .select(`.ec-canvas`)
        .fields({ node: true, size: true })
        .exec(res => console.log('res: ', res))
    })
  })
</script>
```

</TabItem>
</Tabs>

### 嵌套层级超过 baseLevel 时

:::tip
如果你的项目只需要运行在小程序端，也可以使用 `>>>` 选择器来解决：[#7411](https://github.com/NervJS/taro/issues/7411)
:::

在微信以及京东小程序平台，当组件的嵌套层级超过 [baseLevel](config-detail#minibaselevel)（默认 16 层）时，Taro 内部会创建一个原生自定义组件协助开启更深层次的嵌套，因此获取超过 baseLevel 层级的节点时会失败。这时我们需要借助 `CustomWrapper` 来解决这个问题：

<Tabs
  defaultValue="react"
  values={[
    {label: <ReactIcon />, value: 'react'},
    {label: <VueIcon version={3} />, value: 'vue3'}
  ]}
>

<TabItem value="react">

```tsx title="示例代码"
import { View, Canvas, CustomWrapper } from '@tarojs/components'
import Taro, { useReady } from '@tarojs/taro'
import { createRef } from 'react'

export default function Index () {
  const wrapperRef = createRef()

  useReady(() => {
    Taro.createSelectorQuery()
      .in(wrapperRef.current.ctx)
      .select(`.ec-canvas`)
      .fields({ node: true, size: true })
      .exec(res => console.log('res: ', res))
  })

  return (
    <View><View><View><View>
      <View><View><View><View>
        <View><View><View><View>
          <CustomWrapper ref={wrapperRef}>
          <View><View><View><View>
            <Canvas canvasId='canvas' className='ec-canvas'></Canvas>
          </View></View></View></View>
          </CustomWrapper>
        </View></View></View></View>
      </View></View></View></View>
    </View></View></View></View>
  )
}
```

</TabItem>

<TabItem value="vue3">

```html title="示例代码"
<template>
  <view><view><view><view>
    <view><view><view><view>
      <view><view><view><view>
        <custom-wrapper ref="wrapperRef">
        <view><view><view><view>
          <canvas canvas-id='canvas' class='ec-canvas'></canvas>
        </view></view></view></view>
        </custom-wrapper>
      </view></view></view></view>
    </view></view></view></view>
  </view></view></view></view>
</template>

<script setup>
  import Taro, { useReady } from '@tarojs/taro'
  import { ref } from 'vue'

  const wrapperRef = ref()

  useReady(() => {
    Taro.nextTick(() => {
      Taro.createSelectorQuery()
        .in(wrapperRef.value.ctx)
        .select(`.ec-canvas`)
        .fields({ node: true, size: true })
        .exec(res => console.log('res: ', res))
    })
  })
</script>
```

</TabItem>
</Tabs>
</file>

<file path="docs/relations.md">
---
title: 小程序原生作用域获取
---

在 Taro 的页面和组件类中，`this` 指向的是 Taro 页面或组件的实例，例如

```jsx
import Taro, { Component } from '@tarojs/taro'
import { View } from '@tarojs/components'

export default class Menu extends Component {
  static defaultProps = {
    data: [],
  }

  constructor(props) {
    super(props)
    this.state = {
      checked: props.checked,
    }
  }

  componentWillMount() {
    console.log(this) // this -> 组件 Menu 的实例
  }

  render() {
    return <View />
  }
}
```

但是一般我们需要获取 Taro 的页面和组件所对应的小程序原生页面和组件的实例，这个时候我们可以通过 `this.$scope` 就能访问到它们。

所以当调用一些 API 需要传入小程序的页面或者组件实例时，可以直接传入 `this.$scope`，例如 `Taro.createCanvasContext(canvasId, this)` 这个 API，第二个参数就是自定义组件实例 `this`，在 Taro 中就可以如下使用

```jsx
Taro.createCanvasContext(canvasId, this.$scope)
```
</file>

<file path="docs/render-props.md">
---
title: Render Props
---

> 自 1.3.5 起支持

`render props` 是指一种在 Taro 组件之间使用一个值为函数的 prop 共享代码的简单技术。

具有 render prop 的组件接受一个函数，该函数返回一个 Taro 元素并调用它而不是实现自己的渲染逻辑。

举个例子，假设我们有一个组件，它可以呈现一张在屏幕上追逐鼠标的猫的图片。我们或许会使用 `<Cat mouse={{ x, y }} prop />` 来告诉组件鼠标的坐标以让它知道图片应该在屏幕哪个位置。

我们可以提供一个带有函数 prop 的 `<Mouse>` 组件，它能够动态决定什么需要渲染的，而不是将 `<Cat>` 硬编码到 `<Mouse>` 组件里，并有效地改变它的渲染结果。

```jsx
// cat.js
import catImage from './cat.jpg'
class Cat extends Taro.Component {
  static defaultProps = {
    mouse: {
      x: 0,
      y: 0,
    },
  }

  render() {
    const { mouse } = this.props
    return <Image src={catImage} style={{ position: 'absolute', left: mouse.x, top: mouse.y }} />
  }
}

// mouse.js
class Mouse extends Taro.Component {
  constructor(props) {
    super(props)
    this.handleMouseMove = this.handleClick.bind(this)
    this.state = { x: 0, y: 0 }
  }

  handleClick(event) {
    const { x, y } = event.detail
    this.setState({
      x,
      y,
    })
  }

  render() {
    return (
      <View style={{ height: '100%' }} onClick={this.handleClick}>
        {/*
          我们可以把 prop 当成一个函数，动态地调整渲染内容。
        */}
        {this.props.renderCat(this.state)}
      </View>
    )
  }
}

// MouseTracker.js
class MouseTracker extends Taro.Component {
  render() {
    return (
      <View>
        <View>点击鼠标!</View>
        {/*
          Mouse 如何渲染由 MouseTracker 的状态控制
        */}
        <Mouse renderCat={(mouse) => <Cat mouse={mouse} />} />
      </View>
    )
  }
}
```

现在，我们提供了一个 render 方法 让 `<Mouse>` 能够动态决定什么需要渲染，而不是克隆 `<Mouse>` 组件然后硬编码来解决特定的用例。

更具体地说，**render prop 是一个用于告知组件需要渲染什么内容的函数 prop**。

这项技术使我们共享行为非常容易。要获得这个行为，只要渲染一个带有 render prop 的 `<Mouse>` 组件就能够告诉它当前鼠标坐标 (x, y) 要渲染什么。

### 注意事项

**`render props` 是基于小程序 `slot` 机制实现的。** 因此它受到的限制和 `children 与组合`的限制一样多，更多详情请查看文档[Children 与组合](./children.md#注意事项)。
</file>

<file path="docs/report.md">
---
title: 接入统计平台
---

## 接入百度统计平台

### 微信小程序接入百度统计

1、在[百度统计平台](https://mtj.baidu.com/web/sdk/index) 的 「小程序 SDK」 里下载「微信小程序统计 SDK」，把解压缩得到的 `mtj-wx-sdk.js` 和 `mtj-wx-sdk.config.js` 拷贝到小程序项目的 `src/utils` 文件夹中。

2、编辑 `mtj-wx-sdk.config.js`，填写 appKey 字段:

```javascript
   appKey: '您小程序的AppKey',
```

3、编辑小程序项目的 src/app.tsx，在文件最顶部加入：

```javascript
import './utils/mtj-wx-sdk'
```

4、登录[微信公众平台](https://mp.weixin.qq.com/)，进入小程序的 `设置` -> `开发设置` -> `服务器域名`，把`https://hmma.baidu.com`加入 `request合法域名`。

详细文档见[https://mtj.baidu.com/static/userguide/book/chapter0/wechat.html#34-taro](https://mtj.baidu.com/static/userguide/book/chapter0/wechat.html#33-mpvue)

## 接入阿拉丁统计平台

详细见阿拉丁统计平台文档[《如何将 SDK 集成至 Taro 框架构建的小程序中》](https://doc.aldwx.com/aldwx/frame/taro-jie-ru.html)
</file>

<file path="docs/request.md">
---
title: 跨端请求库
---

本篇介绍如何在 Taro 中使用 web 生态下的网络请求库, 这里以 `axios` 为例。

## 原理

我们通过 [@tarojs/plugin-http](https://github.com/NervJS/taro/tree/next/packages/taro-plugin-http) 插件，在小程序环境下 runtime 注入模拟实现的 [XMLHttpRequest](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest) , 从而支持在小程序环境中使用 web 生态下的各种网络请求库。至此，你可以在 h5、小程序、react native 中畅快使用 [axios](https://axios-http.com/) 库作为请求库。

理论上， 任何底层基于 XMLHttpRequest 开发的 web 库你都可以自由使用。

## 插件使用

安装

```bash
npm i @tarojs/plugin-http axios
```

配置

```typescript
// config/index.js
config = {
  // ...
  plugins: ['@tarojs/plugin-http'],
}
```

代码引入

```typescript
import axios from "axios";

const request = axios.create({
    baseURL: ""
});


export request;
```

## 插件完整配置参数

| 参数名           | 默认值 | 说明                                                                                          |
| :--------------- | :----- | :-------------------------------------------------------------------------------------------- |
| enableCookie     | false  | (是否)注入相关代码，支持 `document.cookie` 、 通过后端返回 `Set-Cookie` 响应头来设置 `cookie` |
| disabledFormData | true   | (是否)禁用掉 FormData 全局对象                                                                |
| disabledBlob     | true   | (是否)禁用掉 Blob 全局对象                                                                    |

## 限制

:::danger 限制

- 暂不支持上传，且插件默认会将全局 `FormData` 、 `Blob` 对象替换成 `undefined`（仅针对小程序环境）
- 本插件需搭配 taro 主包 3.6.0 及其以上版本使用
- webpack4 用户需升级插件版本为 `3.6.6` 及其以上

:::

## 插件发布记录

- `3.6.0` 插件首次发布
- `3.6.6` [fix: @tarojs/plugin-http 对 webpack4 的兼容](https://github.com/NervJS/taro/pull/13699)
- `3.6.7` 优化事件属性的实现， [#13824](https://github.com/NervJS/taro/issues/13824)
- `3.6.8` 修复发送请求时未正确携带包含 `httpOnly` 的 `cookie` 的问题，[#13941](https://github.com/NervJS/taro/issues/13941)
</file>

<file path="docs/router-extend.mdx">
---
title: 路由库
---

import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

:::note
Taro v3.6 开始支持。
:::

本篇将介绍如何在 Taro 中使用前端路由库，包括 [react-router](https://reactrouter.com/en/main) 和 [vue-router](https://router.vuejs.org/zh/)。

## Taro 页面路由管理

前端路由库的基本原理是监听 `popstate` 或 `hashchange` 事件触发后，读取 `location` 对象对视图进行操控更新。 Taro 为了支持前端路由库的使用，在运行时中引入了 `histroy` `location` 对象的实现，且尽可能与 Web 端规范对齐，你可以在 `window` 对象上访问到 `history` 和 `location` 对象。

> 我们将 `history` 和 `location` 对象统称为页面路由状态。

小程序天然支持多页面(`pages`数组)，Taro 并非以整个应用为一个路由系统，而是顺应小程序规范以页面维度进行路由管理。每当切换页面时，会将当前页面的页面路由状态缓存。跳转至新页面后会重新创建页面路由状态，并挂载在 `window` 对象上。当返回上一级页面时，会重新将当前页面的页面路由状态挂载到 `window` 对象中。

> 你可以在 “示例 DEMO” 中观察页面切换过程中，`history` 与 `location` 对象的变化.

需要说明的是，`location` 对象仅描述当前页面的链接状态，页面的跳转仍需要调用 `Taro.navigateTo()` 方法。

```js title="页面跳转"
// ❌ 错误
window.location.assign('...')
window.location.href = '...' // 无法实现页面跳转，但可以重新赋值
// ✅ 正确
Taro.navigateTo({ url: '...' })
```

## 页面路由初始化

当通过指定 `url` 进行页面跳转，进入新页面后，页面路由状态会初始化，例如：

```jsx
// 传入参数 id=2&type=test#a=1&b=2
Taro.navigateTo({
  url: '/pages/page/path/name?id=2&type=test#a=1&b=2',
})
```

此时可以从 `location.href` 上读取到完整链接信息 `https://taro.com/pages/page/path/name?id=2&type=test#a=1&b=2`，此时 `history.state` 为：

```json
{
  "state": null,
  "title": "",
  "url": "https://taro.com/pages/page/path/name?id=2&type=test#a=1&b=2"
}
```

## 使用路由库

:::info
Taro 需要升级至 **v3.6**
:::

### 应用配置

在路由库中，诸如`<Link>` 组件内部会动态生成 `<a>` 标签，因此需要引入 [`@tarojs/plugin-html`](./use-h5) 插件以支持在 Taro 中使用 `html` 标签开发组件。

```json title="config/index.js"
{
  "plugins": ["@tarojs/plugin-html"]
}
```

当 Taro DOM 序列化数据的 nn 字段为 HTML 标签时，会映射为对应的小程序组件名称。由于无法提前预知动态标签，因此需要应用显式告知可能会使用到的动态标签。例如在应用中塞入一个无样式的标签名即可：

```html
<View>
  <a></a>
</View>
```

### 代码示例

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx title="/pages/index/index.js"
import { BrowserRouter, Routes, Route, Link } from 'react-router-dom'
export default class Index extends Component {
  render() {
    return (
      <BrowserRouter>
        <View className="drawer-box">
          <View className="box-item">
            <Link to="/pages/router/index/view1?a=1&b=2">view1</Link>
          </View>
          <View className="box-item">
            <Link to="/pages/router/index/view2#a=3&b=4">view2</Link>
          </View>
          <View className="box-item">
            <Link to="/pages/router/index/2?a=1&b=2#a=3&b=4">view3</Link>
          </View>
        </View>

        <Routes>
          <Route path="/pages/browser-router/index" element={<Home />}></Route>
          <Route path="/pages/router/index/view1" element={<View1 />}></Route>
          <Route path="/pages/router/index/view2" element={<View2 />}></Route>
          <Route path="/pages/router/index/:id" element={<View3 />}></Route>
        </Routes>
      </BrowserRouter>
    )
  }
}
```

</TabItem>

<TabItem value="Vue">

```js title="app.js"
import { createApp } from 'vue'
import { createWebHistory } from 'vue-router'
// 自定义组件
import Home from './components/home.vue'
import Tab1 from './components/tab-1.vue'
import Tab2 from './components/tab-2.vue'
import Tab3 from './components/tab-3.vue'

const routes = [
  { path: '/', component: Home },
  { path: '/tab1', component: Tab1 },
  { path: '/tab2', component: Tab2 },
  { path: '/tab3/:groupId/:id', component: Tab3 },
]

const router = createRouter({
  history: createWebHistory(),
  routes,
})

const App = createApp({
  onShow(options) {},
})

App.use(router)

export default App
```

```html title="/pages/index/index.vue"
<template>
  <view>
    <view>
      <a></a>
      <view>
        <view class="tab-box">
          <router-link class="tab-item" to="/" replace>Home</router-link>
          <router-link class="tab-item" to="/tab1?name=advancedcat&from=china" replace>Tab 1</router-link>
          <router-link class="tab-item" to="/tab2">Tab 2</router-link>
          <router-link class="tab-item" to="/tab3/1234/8765">Tab 3</router-link>
          <router-link class="tab-item" :to="{ name: 'user', params: { id: '9876' }}">User</router-link>
        </view>
        <router-view></router-view>
      </view>
    </view>
  </view>
</template>

<script setup></script>
```

</TabItem>
</Tabs>

支付宝小程序的 `navigator` 组件不支持 `onTap` 事件，这导致 `<Link>` 组件或 `<a>` 标签无法捕获点击事件，从而无法拦截事件触发路由更新。
因此，如果你需要适配支付宝小程序，需要额外处理 `<Link>` 组件或 `<a>` 标签的动态转换，指定 `as` 属性，`@tarojs/plugin-html` 插件会将其转换为指定的标签名：

```jsx
<a as="view"></a>  // => 将其转换为 view 标签展示
<Link as="view" to="xxx" />
<NavLink as="view" to="xxx" />
```

## 示例 DEMO

在引入路由库前，可以从以下 demo 中看到更多路由特性用法。

- [React + react-router v6](https://github.com/AdvancedCat/taro-react-router)
- [Vue3 + vue-router v4](https://github.com/AdvancedCat/taro-vue-router)

## API

### window.location

> 在小程序环境中，跨域三要素锁定为 `https://taro.com`。

#### 属性

| 属性     | 类型           | 默认值     | 说明                           |
| -------- | -------------- | ---------- | ------------------------------ |
| protocol | `string`       | `https:`   | 协议头部                       |
| hostname | `string`       | `taro.com` | 域名主体                       |
| port     | `string`       | `""`       | 端口号                         |
| pathname | `string`       | `/`        | 路径部分                       |
| search   | `string`       | `""`       | 查询参数，非空则包含 `?` 字符  |
| hash     | `string`       | `""`       | hash 部分，非空则包含 `#` 字符 |
| toString | `() => string` |            | 返回完整 `href`                |

可以通过 `window.location.xxx = 'yyy'` 来重新赋值对应属性.特别的，`window.location.href = 'new url'` 会按照对应部分分别设置相应属性(除了跨域三要素不可修改)， 同时 `history` 历史栈增加一条记录。

#### 事件

##### hashchange

当 `hash` 部分发生变化时，同步触发 `hashchange` 事件：

```js
window.addEventListener('hashchange', () => {
  console.log('hash发生变化')
})
```

### window.history

#### 属性

| 属性         | 类型                                             | 说明                                                       |
| ------------ | ------------------------------------------------ | ---------------------------------------------------------- |
| state        | `{state: any; title: string; url: string}`       | 历史堆栈的顶部状态                                         |
| length       | `number`                                         | 历史堆栈长度                                               |
| go           | `(delta: number) => {}`                          | 切换至相对位置的历史状态，越界时取历史堆栈的边界值         |
| back         | `() => {}`                                       | 等价于 `go(-1)`                                            |
| forward      | `() => {}`                                       | 等价于 `go(1)`                                             |
| pushState    | `(state: any, title: string, url: string) => {}` | 按指定的名称和 URL（如果提供该参数）将数据 push 进历史堆栈 |
| replaceState | `(state: any, title: string, url: string) => {}` | 更新 state，但不修改历史堆栈                               |

#### 事件

##### popstate

当调用 `history.go()` 方法时，同步触发 `hashchange` 事件，`history.state` 会更新：

```js
window.addEventListener('popstate', () => {
  console.log('popstate触发')
})
```

## 注意事项

1. 在 Web 端可以通过赋值 location.href 实现页面加载，但在小程序中不适用，小程序端的页面跳转仍建议使用 `Taro.navigateTo` 等官方 api。在小程序侧，应该将 `location` 上的属性视为只读。
2. `location.origin` 将默认为 `https://taro.com`，`location.assign()` `location.replace()` 在小程序侧无效；
3. 需要为支付宝小程序做额外适配，见文档说明；

## 详细设计

详细设计请看 [RFC](https://github.com/NervJS/taro-rfcs/blob/feat/history/rfcs/0009-router-support.md)。
</file>

<file path="docs/router.mdx">
---
title: 概述
---

import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

本篇将介绍如何在 Taro 中配置路由、实现路由跳转和传参等方法。

## 路由配置

Taro 遵循微信小程序的路由规范。只需要修改全局配置的 [pages](app-config#pages) 属性，配置为 Taro 应用中每个页面的路径即可。

> 使用 react-router、vue-router 等路由库，请参照[下一节](./router-extend)。

## 路由跳转

可以通过 Taro 提供的 API 来跳转到目的页面。路由 API 的详细用法请查看 API 文档的 [导航](./apis/route/navigateTo) 章节。

```jsx title="示例代码"
// 跳转到目的页面，打开新页面
Taro.navigateTo({
  url: '/pages/page/path/name',
})

// 跳转到目的页面，在当前页面打开
Taro.redirectTo({
  url: '/pages/page/path/name',
})
```

### 路由传参

可以通过在所有跳转的 `url` 后面添加查询字符串参数进行跳转传参，例如：

```jsx
// 传入参数 id=2&type=test
Taro.navigateTo({
  url: '/pages/page/path/name?id=2&type=test',
})
```

### 获取路由参数

跳转成功后，在目标页面的**生命周期**方法中，可以通过 `Taro.getCurrentInstance().router.params` 获取路由参数。

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx title="示例代码"
import React, { Component } from 'react'
import { View } from '@tarojs/components'

class Index extends Component {
  // 建议在页面初始化时把 getCurrentInstance() 的结果保存下来供后面使用，
  // 而不是频繁地调用此 API
  $instance = getCurrentInstance()

  componentDidMount() {
    // 获取路由参数
    console.log(this.$instance.router.params) // 输出 { id: 2, type: 'test' }
  }

  render() {
    return <View className="index" />
  }
}

export default Index
```

</TabItem>

<TabItem value="Vue">

```html title="示例代码"
<template>
  <view className="index" />
</template>

<script>
  import Taro from '@tarojs/taro'

  export default {
    created() {
      // 建议在页面初始化时把 getCurrentInstance() 的结果保存下来供后面使用，
      // 而不是频繁地调用此 API
      this.$instance = Taro.getCurrentInstance()
    },
    mounted() {
      // 获取路由参数
      console.log(this.$instance.router.params) // 输出 { id: 2, type: 'test' }
    },
  }
</script>
```

</TabItem>
</Tabs>

## H5

H5 路由还支持设置路由模式、设置 basename、路由守卫等能力，详情请看 [Taro H5 文档](./h5#路由)。
</file>

<file path="docs/seowhy.md">
---
title: 搜外七巧板在线制作小程序
---

## 搜外七巧板简介

[搜外七巧板](https://diy.seowhy.com/)是十多年技术沉淀、站长圈中流砥柱的[搜外网](https://www.seowhy.com/)开发的网站转小程序制作平台，小程序底层使用了 Taro，支持多种主流小程序平台，如 QQ、微信、字节跳动、360、支付宝、百度 。

只要你的网站是[搜外 6 系统](https://6.seowhy.com/)、Wordpress、DedeCMS、帝国 CMS、Zblog、PHPCMS 等其中的任意一种，那么，你只需要来搜外七巧板，进行一些简单的配置与美化就可以将自己网站的内容一键连接到小程序里 ，实现一个网站、一个小程序、多渠道展现。

**官网地址：https://diy.seowhy.com/**

**Taro 案例：https://diy.seowhy.com/case**

---

## 使用搜外七巧板

1. 登录注册即可免费拥有一个小程序
2. 设计配置打包下载小程序打包上传

---

## 加入搜外七巧板开发者

搜外七巧板小程序使自己开发的系统也支持小程序

更多详细见：[《搜外七巧板小程序开发者入驻文档》](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030231)

### 第一步：定义常量

```text
1. DB_PATH                    数据库目录
2. PROVIDER                   程序名称
```

### 第二步：实现方法

#### 1、main.php

1. appClient 类
2. connectProvider 方法 （读取数据库字段）

##### 范例：

1. [dedecms 范例](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030187)
2. [wordpress 范例](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030188)

---

#### 2、 provider.php

##### 必须实现方法：

| 字段名          | 说明                                                                         |
| --------------- | ---------------------------------------------------------------------------- |
| getPosts        | [获得数据列表](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030192)      |
| getCategories   | [获得分类列表](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030191)      |
| getCategory     | [获得分类详情](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030191)      |
| getArticles     | [获得文章列表](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030194)      |
| getArticle      | [获得文章详情](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030191)      |
| getProducts     | [获得产品列表](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030193)      |
| getProduct      | [获得产品详情](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030196)      |
| getPages        | [获得单页列表](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030197)      |
| getPage         | [获得单页详情](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030198)      |
| getComments     | [获得评论列表](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030199)      |
| saveComment     | [新增/修改评论](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030200)     |
| commentAttitude | [点赞或反对评论](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030201)    |
| getMapping      | [获得 sitemap](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030203)      |
| getSiteMapIndex | [获得 sitemapIndex](https://www.kancloud.cn/lyc_echo/diy_seowhy_com/2030204) |
| \_getRelations  | 获得相关产品                                                                 |
| \_getSubCatIds  | 获得所有分类下级                                                             |
| getThumb        | 格式化缩略图                                                                 |
| convertArticle  | 格式化文章返回参数                                                           |
| convertProduct  | 格式化产品返回参数                                                           |
| convertCategory | 格式化分类                                                                   |
| convertPage     | 格式化单页                                                                   |
| convertComment  | 格式化留言                                                                   |
| parseContent    | 格式化内容                                                                   |
| getParams       | 获得扩展字段                                                                 |
</file>

<file path="docs/size.md">
---
title: 设计稿及尺寸单位
---

在 Taro 中尺寸单位建议使用 `px`、 `百分比 %`，Taro 默认会对所有单位进行转换。在 Taro 中书写尺寸按照 1:1 的关系来进行书写，即从设计稿上量的长度 `100px`，那么尺寸书写就是 `100px`，当转成微信小程序的时候，尺寸将默认转换为 `100rpx`，当转成 H5 时将默认转换为以 `rem` 为单位的值。

如果你希望部分 `px` 单位不被转换成 `rpx` 或者 `rem` ，最简单的做法就是在 px 单位中增加一个大写字母，例如 `Px` 或者 `PX` 这样，则会被转换插件忽略。

结合过往的开发经验，Taro 默认以 `750px` 作为换算尺寸标准，如果设计稿不是以 `750px` 为标准，则需要在项目配置 `config/index.js` 中进行设置，例如设计稿尺寸是 `640px`，则需要修改项目配置 `config/index.js` 中的 `designWidth` 配置为 `640`：

```jsx title="/config/index.js"
const config = {
  projectName: 'myProject',
  date: '2018-4-18',
  designWidth: 640,
  ....
}
```

目前 Taro 支持 `750`、 `640` 、 `828` 三种尺寸设计稿，他们的换算规则如下：

```jsx
const DEVICE_RATIO = {
  640: 2.34 / 2,
  750: 1,
  828: 1.81 / 2,
}
```

建议使用 Taro 时，设计稿以 iPhone 6 `750px` 作为设计尺寸标准。

如果你的设计稿是 `375` ，不在以上三种之中，那么你需要把 `designWidth` 配置为 `375`，同时在 `DEVICE_RATIO` 中添加换算规则如下：

```jsx {5}
const DEVICE_RATIO = {
  640: 2.34 / 2,
  750: 1,
  828: 1.81 / 2,
  375: 2 / 1,
}
```

:::info
Taro v3.4.13 开始支持配置**函数形式**的 `designWidth`，借此开发者可以动态地设置 `designWidth`，详情请查看：[config.designWidth](./config-detail#designwidth)
:::

## API

在编译时，Taro 会帮你对样式做尺寸转换操作，但是如果是在 JS 中书写了行内样式，那么编译时就无法做替换了，针对这种情况，Taro 提供了 API `Taro.pxTransform` 来做运行时的尺寸转换。

```jsx
Taro.pxTransform(10) // 小程序：rpx，H5：rem
```

## 配置

### 默认配置

**默认配置会对所有的 `px` 单位进行转换，有大写字母的 `Px` 或 `PX` 则会被忽略。**

`postcss.pxtransform` 的参数默认值如下：

```js title="config/index.js"
config = {
  mini: {
    postcss: {
      pxtransform: {
        enable: true,
        config: {
          onePxTransform: true,
          unitPrecision: 5,
          propList: ['*'],
          selectorBlackList: [],
          replace: true,
          mediaQuery: false,
          minPixelValue: 0
        }
      }
    }
  }
  h5: {
    postcss: {
      pxtransform: {
        enable: true,
        config: {
          onePxTransform: true,
          unitPrecision: 5,
          propList: ['*'],
          selectorBlackList: [],
          replace: true,
          mediaQuery: false,
          minPixelValue: 0,
          baseFontSize: 20,
          maxRootSize: 40,
          minRootSize: 20
        }
      }
    }
  }
}
```

### `onePxTransform` (Boolean)

设置 1px 是否需要被转换

### `unitPrecision` (Number)

REM 单位允许的小数位。

### `propList` (Array)

允许转换的属性。

- Values need to be exact matches.
- Use wildcard `*` to enable all properties. Example: `['*']`
- Use `*` at the start or end of a word. (`['*position*']` will match `background-position-y`)
- Use `!` to not match a property. Example: `['*', '!letter-spacing']`
- Combine the "not" prefix with the other prefixes. Example: `['*', '!font*']`

### `selectorBlackList`

黑名单里的选择器将会被忽略。

- If value is string, it checks to see if selector contains the string.
  - `['body']` will match `.body-class`
- If value is regexp, it checks to see if the selector matches the regexp.
  - `[/^body$/]` will match `body` but not `.body`

### `replace` (Boolean)

直接替换而不是追加一条进行覆盖。

### `mediaQuery` (Boolean)

允许媒体查询里的 px 单位转换

### `minPixelValue` (Number)

设置一个可被转换的最小 px 值

配置规则对应到 `config/index.js` ，例如：

```js {9-14,20-25} title="/config/index.js"
{
  h5: {
    publicPath: '/',
    staticDirectory: 'static',
    postcss: {
      autoprefixer: {
        enable: true
      },
      pxtransform: {
        enable: true,
        config: {
          selectorBlackList: ['body']
        }
      }
    }
  },
  mini: {
    // ...
    postcss: {
      pxtransform: {
        enable: true,
        config: {
          selectorBlackList: ['body']
        }
      }
    }
  }
}
```

### `targetUnit` (String)

转换后的单位，可选值为 `rpx`、`vw`、`rem`，当前仅支持小程序 (默认 `rpx`) 和 Web 端 (默认 `rem`)。

> Web 端使用 `rem` 单位时会注入脚本用于设置 body 上的 `font-size` 属性，其他单位无该操作。

### `baseFontSize` (Number, H5 Only, Default: 20)

H5 字体尺寸大小基准值，开发者可以自行调整单位换算的基准值。

### `maxRootSize` (Number, H5 Only, Default: 40)

H5 根节点 `font-size` 的最大值。

### `minRootSize` (Number, H5 Only, Default: 20)

H5 根节点 `font-size` 的最小值。

## CSS 编译时忽略（过滤）

### 忽略单个属性

当前忽略单个属性的最简单的方法，就是 px 单位使用大写字母。

```css
/* `px` is converted to `rem` */
.convert {
  font-size: 16px; // converted to 1rem
}

/* `Px` or `PX` is ignored by `postcss-pxtorem` but still accepted by browsers */
.ignore {
  border: 1px solid; // ignored
  border-width: 2px; // ignored
}
```

### 忽略样式文件

对于头部包含注释 `/*postcss-pxtransform disable*/` 的文件，插件不予处理。

### 忽略样式举例

样式文件里多行文本省略时我们一般如下面的代码：

```css {3}
.textHide {
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
  text-overflow: ellipsis;
  overflow: hidden;
}
```

但 Taro 编译后少了 `-webkit-box-orient: vertical;` 这条样式属性，此时我们需要忽略掉这条样式

#### 忽略样式方法 1 加入 CSS 注释强制声明忽略下一行

```css {1}
/* autoprefixer: ignore next */
-webkit-box-orient: vertical;
```

#### 忽略样式方法 2 加入 CSS 注释强制声明注释中间多行

```css {1,3}
/* autoprefixer: off */
-webkit-box-orient: vertical;
/* autoprefixer: on */
```

#### 忽略样式方法 3 写成行内样式

```jsx {2-9}
<View
  style={{
    display: '-webkit-box',
    '-webkit-box-orient': 'vertical',
    '-webkit-line-clamp': 2,
    'text-overflow': 'ellipsis',
    overflow: 'hidden',
    'line-height': 2,
  }}
>
  这是要省略的内容这是要省略的内容这是要省略的内容
</View>
```

### 相关链接

- [Taro 多行文本省略不生效](https://taro-club.jd.com/topic/2270/taro%E5%A4%9A%E8%A1%8C%E6%96%87%E6%9C%AC%E7%9C%81%E7%95%A5%E4%B8%8D%E7%94%9F%E6%95%88)
</file>

<file path="docs/skyline.mdx">
---
title: Skyline
---

import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

Skyline 的具体内容详见：[Skyline 介绍](https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/skyline/introduction.html)

:::info
仅支持在微信小程序使用，worklet 部分从 `4.0.8` 开始支持
:::info

## 开启 Skyline

配置方法和微信小程序相同，开发前请仔细阅读 [《微信小程序 Skyline - 起步》](https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/skyline/migration/)。


**示例：**

```js title="app.config.js"
export default defineAppConfig({
  pages: [
    'pages/index/index',
  ]
  lazyCodeLoading: "requiredComponents",
  rendererOptions: {
    skyline: {
      defaultDisplayBlock: true,
      defaultContentBox: true
    }
  }
})
```

```js title="page/index/index.config.js"
export default definePageConfig({
  navigationBarTitleText: '首页',
  renderer: 'skyline',
  componentFramework: 'glass-easel',
  navigationStyle: 'custom',
})
```

### 使用 worklet

在 Taro 中使用 worklet 需要首先开启半编译，开启方法见：[半编译模式使用方法](./complier-mode#使用方法)。

使用 worklet 动画能力时确保以下两项：详见 [worklet 动画](https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/skyline/worklet.html)

* 确保开发者工具右上角 > 详情 > 本地设置里的 将 JS 编译成 ES5 选项被勾选上 (代码包体积会少量增加)
* worklet 动画相关接口仅在 Skyline 渲染模式下才能使用


**示例：**

```js title="config/index.js"
{
  mini: {
    experimental: {
      compileMode: true
    }
  }
}
```

```js title="pages/index/behavior.js"
const behavior = Behavior({
  methods: {
    onScrollUpdate(){
      "worklet";
      console.log('onScrollUpdateWorklet')
    },
    onGesture(evt) {
      'worklet';
      if (evt.state === 2) {
        this._offset.value += evt.deltaX;
      }
    }
  }
})

export default behavior
```

```jsx title="pages/index/index.jsx"
import { View, ScrollView, PanGestureHandler } from "@tarojs/components";
import Taro, { useLoad } from "@tarojs/taro";
import behavior from "./behavior";

Index.behaviors = [behavior];

export default function Index() {
  useLoad(() => {
    const { page } = Taro.getCurrentInstance();
    if (page) {
      const offset = Taro.worklet.shared(0);
      page._offset = offset;
      Taro.nextTick(() => {
        page.applyAnimatedStyle(".circle", () => {
          "worklet";
          return {
            transform: `translateX(${offset.value}px)`,
          };
        });
      });
    }
  });

  return (
    <View className='index' compileMode>
      {/* 手势 */}
      <PanGestureHandler onGestureWorklet='onGesture'>
        <View className='circle'>拖动我</View>
      </PanGestureHandler>

      {/* 非手势组件的 worklet 回调 */}
      <ScrollView
        style={{ height: "300px", border: '1px solid #ccc' }}
        type='custom'
        scroll-y
        onScrollUpdateWorklet='onScrollUpdate'
      >
        {Array(100)
          .fill(1)
          .map((item, index) => (
            <View key={index}>{item}</View>
          ))}
      </ScrollView>
    </View>
  );
}
```
</file>

<file path="docs/spec-for-taro.md">
---
title: 项目组织
---

### 文件组织形式

> 以下文件组织规范为最佳实践的建议

所有项目源代码请放在项目根目录 `src` 目录下，项目所需最基本的文件包括 **入口文件** 以及 **页面文件**

- 入口文件为 `app.js`
- 页面文件建议放置在 `src/pages` 目录下

一个可靠的 Taro 项目可以按照如下方式进行组织

    ├── config                 配置目录
    |   ├── dev.js             开发时配置
    |   ├── index.js           默认配置
    |   └── prod.js            打包时配置
    ├── src                    源码目录
    |   ├── components         公共组件目录
    |   ├── pages              页面文件目录
    |   |   ├── index          index 页面目录
    |   |   |   ├── banner     页面 index 私有组件
    |   |   |   ├── index.js   index 页面逻辑
    |   |   |   └── index.css  index 页面样式
    |   ├── utils              公共方法库
    |   ├── app.css            项目总通用样式
    |   └── app.js             项目入口文件
    └── package.json

### 文件命名

Taro 中普通 JS/TS 文件以小写字母命名，多个单词以下划线连接，例如 `util.js`、`util_helper.js`

Taro 组件文件命名遵循 Pascal 命名法，例如 `ReservationCard.jsx`

### 文件后缀

Taro 中普通 JS/TS 文件以 `.js` 或者 `.ts` 作为文件后缀

Taro 组件则以 `.jsx` 或者 `.tsx` 作为文件后缀，当然这不是强制约束，只是作为一个实践的建议，组件文件依然可以以 `.js` 或者 `.ts` 作为文件后缀
</file>

<file path="docs/specials.md">
---
title: 常见问题
---

- [Issue #46](https://github.com/NervJS/taro/issues/46)，`redux-saga` 的引入问题处理

- 在 H5 模式下，tabBar 可能会挡住页面 fixed 元素问题：这是因为与小程序的 tabBar 不同，在 H5 下 tabBar 是一个普通的组件，当页面中存在 `fixed(bottom)` 定位的元素时，其表现会与小程序中不一致。Taro 提供了一个适配的方法：

例如：

```css
.fixed {
  bottom: 0;
  /* 在 H5 模式下将会编译成 margin-bottom: 50px，在小程序模式下则会忽略 */
  margin-bottom: taro-tabbar-height;
}
```
</file>

<file path="docs/state.md">
---
title: 生命周期 & State
---

在本节中，我们将学习如何重用和封装一个 Clock 组件。它将设置自己的计时器，并每秒钟更新一次。

我们可以从封装时钟开始：

```jsx
class Clock extends Component {
  render() {
    return (
      <View>
        <Text>Hello, world!</Text>
        <Text>现在的时间是 {this.state.date.toLocaleTimeString()}.</Text>
      </View>
    )
  }
}
```

Clock 现在被定义为一个类，使用类就允许我们使用其它特性，例如局部状态、生命周期钩子。

## 为一个类添加局部状态

首先，我们需要添加一个类构造函数来初始化状态 `this.state`：

```jsx
class Clock extends Component {
  constructor(props) {
    super(props)
    this.state = { date: new Date() }
  }

  render() {
    return (
      <View>
        <Text>Hello, world!</Text>
        <Text>现在的时间是 {this.state.date.toLocaleTimeString()}.</Text>
      </View>
    )
  }
}
```

注意我们如何传递 props 到基础构造函数的：

```jsx
constructor (props) {
  super(props)
  this.state = { date: new Date() }
}
```

类组件应始终使用 props 调用基础构造函数。
接下来，我们将使 Clock 设置自己的计时器并每秒更新一次。

## 将生命周期方法添加到类中

在具有许多组件的应用程序中，在销毁时释放组件所占用的资源非常重要。

每当 `Clock` 组件第一次加载到 DOM 中的时候，我们都想生成定时器，这在 Taro/React 中被称为挂载。

同样，每当 Clock 生成的这个 DOM 被移除的时候，我们也会想要清除定时器，这在 Taro/React 中被称为卸载。

我们可以在组件类上声明特殊的方法，当组件挂载或卸载时，来运行一些代码：

```jsx
class Clock extends Component {
  constructor(props) {
    super(props)
    this.state = { date: new Date() }
  }

  componentDidMount() {}

  componentWillUnmount() {}

  render() {
    return (
      <View>
        <Text>Hello, world!</Text>
        <Text>现在的时间是 {this.state.date.toLocaleTimeString()}.</Text>
      </View>
    )
  }
}
```

这些方法被称作生命周期钩子。

当组件输出到 DOM 后会执行 `componentDidMount()` 钩子，这是一个建立定时器的好地方：

```jsx
componentDidMount() {
  this.timerID = setInterval(
    () => this.tick(),
    1000
  )
}
```

注意我们如何在 this 中保存定时器 ID。

虽然 `this.props` 由 Taro 本身设置以及 `this.state` 具有特殊的含义，但如果需要存储不用于视觉输出的东西，则可以手动向类中添加其他字段。

如果你不在 `render()` 中使用某些东西，它就不应该在状态中。

我们将在 `componentWillUnmount()` 生命周期钩子中卸载计时器：

```jsx
componentWillUnmount () {
  clearInterval(this.timerID)
}
```

最后，我们实现了每秒钟执行的 `tick()` 方法。

它将使用 `this.setState()` 来更新组件局部状态：

```jsx
import Taro, { Component } from '@tarojs/taro'

class Clock extends Component {
  constructor(props) {
    super(props)
    this.state = { date: new Date() }
  }

  componentDidMount() {
    this.timerID = setInterval(() => this.tick(), 1000)
  }

  componentWillUnmount() {
    clearInterval(this.timerID)
  }

  tick() {
    this.setState({
      date: new Date(),
    })
  }

  render() {
    return (
      <View>
        <Text>Hello, world!</Text>
        <Text>现在的时间是 {this.state.date.toLocaleTimeString()}.</Text>
      </View>
    )
  }
}
```

## 正确地使用 State

关于 setState() 这里有三件事情需要知道：

### 不要直接更新状态

例如，此代码不会重新渲染组件：

```jsx
// Wrong
this.state.comment = 'Hello'
```

应当使用 `setState()`:

```jsx
// Correct
this.setState({ comment: 'Hello' })
```

`setState()` 函数是唯一能够更新 `this.state` 的地方。

### 状态更新一定是异步的

Taro 可以将多个 `setState()` 调用合并成一个调用来提高性能。

因为 `this.state` 和 `props` 一定是异步更新的，所以你不能在 `setState` 马上拿到 `state` 的值，例如：

```jsx
// 假设我们之前设置了 this.state.counter = 0
updateCounter () {
  this.setState({
    counter: 1
  })
  console.log(this.state.counter) // 这里 counter 还是 0
}
```

正确的做法是这样，在 `setState` 的第二个参数传入一个 callback：

```jsx
// 假设我们之前设置了 this.state.counter = 0
updateCounter () {
  this.setState({
    counter: 1
  }, () => {
    // 在这个函数内你可以拿到 setState 之后的值
  })
}
```

> 这是 Taro 和 React 另一个不同的地方：React 的 `setState` 不一定总是异步的，他内部有一套事务机制控制，且 React 15/16 的实现也各不相同。而对于 Taro 而言，`setState` 之后，你提供的对象会被加入一个数组，然后在执行下一个 [eventloop](https://github.com/aooy/blog/issues/5) 的时候合并它们。

### state 更新会被合并

当你调用 `setState()`，Taro 将合并你提供的对象到当前的状态中。

例如，你的状态可能包含几个独立的变量：

```jsx
constructor(props) {
  super(props)
  this.state = {
    posts: [],
    comments: []
  }
}
```

然后通过调用独立的 `setState()` 调用分别更新它们:

```jsx
componentDidMount() {
  fetchPosts().then(response => {
    this.setState({
      posts: response.posts
    });
  });

  fetchComments().then(response => {
    this.setState({
      comments: response.comments
    })
  })
}
```

合并是浅合并，所以 `this.setState({comments})` 不会改变 `this.state.posts` 的值，但会完全替换 `this.state.comments` 的值。
</file>

<file path="docs/static-reference.md">
---
title: 静态资源引用
---

在 Taro 中可以像使用 [Webpack](https://webpack.js.org/) 那样自由地引用静态资源，而且不需要安装任何 Loaders。

## 引用样式文件

可以直接通过 ES6 的 `import` 语法来引用样式文件

例如引用 CSS 文件

```jsx
import './css/path/name.css'
```

引用 SCSS 文件

```jsx
import './css/path/name.scss'
```

## 引用 JS 文件

可以直接通过 ES6 的 `import` 语法来引用 JS 文件

```jsx
import { functionName } from './css/path/name.js'

import defaultExportName from './css/path/name.js'
```

## 引用图片、音频、字体等文件

可以直接通过 ES6 的 `import` 语法来引用此类文件，拿到文件引用后直接在 JSX 中进行使用

```jsx
// 引用文件
import namedPng from '../../images/path/named.png'

// 使用
export default () => (
  <View>
    <Image src={namedPng} />
  </View>
)
```

## 引用 JSON 文件

可以直接通过 ES6 的 `import` 语法来引用此类文件，拿到 JSON 文件输出的 JSON 数据

```jsx
// 引用 json 文件
/**
 * named.json
 * {
 *   x: 1
 * }
 **/
import namedJson from '../../json/path/named.json'

console.log(namedJson.x)
```

## 小程序样式中引用本地资源

在小程序的样式中，默认不能直接引用本地资源，只能通过网络地址、Base64 的方式来进行资源引用，为了方便开发，Taro 提供了直接在样式文件中引用本地资源的方式，其原理是通过 `PostCSS` 的 [`postcss-url`](https://github.com/postcss/postcss-url) 插件将样式中本地资源引用转换成 Base64 格式，从而能正常加载。

Taro 默认会对 `1kb` 大小以下的资源进行转换，如果需要修改配置，可以在 `config/index.js` 中进行修改，配置位于 [`weapp.module.postcss`](./config-detail#weappmodulepostcss)。

具体配置如下

```js title="/config/index.js"
// 小程序端样式引用本地资源内联
url: {
  enable: true,
  config: {
    limit: 10240 // 设定转换尺寸上限
  }
}
```
</file>

<file path="docs/tailwindcss.mdx">
---
title: 使用 Tailwind CSS
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

`Tailwind CSS` 是目前世界上**最**流行的原子化 `CSS` 框架。它集成了诸如 `flex`, `pt-4`, `text-center` 和 `rotate-90` 这样语义化的类名。我们开发者能直接在各种脚本标记语言中编写它们，并把它们组合起来，构建出任何的设计。

自从 `3.x` 大版本开始，`Tailwind CSS` 把引擎升级为 `Just in Time(jit)` 。这使得我们能够编写代码的同时，实时生成各种 `CSS`，真正的做到了所写即所得。比如我们能够编写 `pt-[19.5px]`, `text-[#123456]` ，`bg-[url('/img/hero-pattern.svg')]` 这样的语义化的类名，它们生成的 `CSS` 结果一目了然。

所以，熟悉 `Tailwind CSS` 之后，可以大幅度的加快我们应用的开发速度，提升代码的可维护性，接下来让我们看看如何在 `tarojs` 应用中使用它吧。

## 1. 安装与配置 tailwindcss

首先我们要把 `tailwindcss` 安装和配置好。这里我们参考 `tailwindcss` 官网中，`postcss` 的使用方式进行安装 ([参考链接](https://tailwindcss.com/docs/installation/using-postcss))：

### 1. 使用包管理器安装 `tailwindcss`

<Tabs>
  <TabItem label="npm" value="npm">

```bash
npm i -D tailwindcss postcss autoprefixer
# 初始化 tailwind.config.js 文件
npx tailwindcss init
```

  </TabItem>
  <TabItem label="yarn" value="yarn">

```bash
yarn add -D tailwindcss postcss autoprefixer
# 初始化 tailwind.config.js 文件
npx tailwindcss init
```

  </TabItem>
  <TabItem label="pnpm" value="pnpm">

```bash
pnpm i -D tailwindcss postcss autoprefixer
# 初始化 tailwind.config.js 文件
npx tailwindcss init
```

  </TabItem>
</Tabs>

:::info
`tailwindcss` 最新版本(`3.x`)对应的 `postcss` 大版本为 `8`，其中 `tarojs` 里已经内置了 `postcss` 和 `autoprefixer` 了。
:::

### 2. 创建 `postcss.config.js` 并注册 `tailwindcss`

```js title="postcss.config.js"
// postcss 插件以 object 方式注册的话，是按照由上到下的顺序执行的
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

### 3. 配置 `tailwind.config.js`

`tailwind.config.js` 是 `tailwindcss` 的配置文件，我们可以在里面配置 `tailwindcss` 的各种行为。[全量配置项](https://tailwindcss.com/docs/configuration)

```js title="tailwind.config.js"
/** @type {import('tailwindcss').Config} */
module.exports = {
  // 这里给出了一份 taro 通用示例，具体要根据你自己项目的目录结构进行配置
  // 比如你使用 vue3 项目，你就需要把 vue 这个格式也包括进来
  // 不在 content glob 表达式中包括的文件，在里面编写 tailwindcss class，是不会生成对应的 css 工具类的
  content: ['./public/index.html', './src/**/*.{html,js,ts,jsx,tsx}'],
  // 其他配置项 ...
  corePlugins: {
    // 小程序不需要 preflight，因为这主要是给 h5 的，如果你要同时开发多端，你应该使用 process.env.TARO_ENV 环境变量来控制它
    preflight: false,
  },
}
```

### 4. 引入 `tailwindcss`

在你的项目入口文件里引入 `tailwindcss`，比如 `taro app` 的 `app.scss`

```scss title="app.scss"
@use 'tailwindcss/base' as *;
@use 'tailwindcss/components' as *;
@use 'tailwindcss/utilities' as *;
// 不使用 sass 就这么写
// @tailwind base;
// @tailwind components;
// @tailwind utilities;
```

然后在 `app.ts` 里，引入这个样式文件即可。

这样 `tailwindcss` 的安装与配置就完成了，接下来让我们进入第二个环节：安装和配置 `weapp-tailwindcss`。


## 2. 安装和配置 `weapp-tailwindcss`

什么是 `weapp-tailwindcss` ? 它是一个让你在小程序环境中，使用 `tailwindcss` 大部分特性的一个 `webpack`, `vite`, `gulp`, `postcss` 插件集合。它支持目前上几乎所有主流的多端小程序框架和使用 `webpack` / `gulp` 的原生小程序开发打包方式。

`weapp-tailwindcss` 使得你很容易在各个框架，或原生开发中集成 `tailwindcss`。

执行下列命令安装插件:

<Tabs>
  <TabItem label="npm" value="npm">

```bash
npm i -D weapp-tailwindcss
```

  </TabItem>
  <TabItem label="yarn" value="yarn">

```bash
yarn add -D weapp-tailwindcss
```

  </TabItem>
  <TabItem label="pnpm" value="pnpm">

```bash
pnpm i -D weapp-tailwindcss
```

  </TabItem>
</Tabs>

然后把下列脚本，添加进你的 `package.json` 的 `scripts` 字段里:

```diff title="package.json"
"scripts": {
+ "postinstall": "weapp-tw patch"
}
```

添加这段脚本的用途是，每次安装包后，都会自动执行一遍 `weapp-tw patch` 这个脚本，给本地的 `tailwindcss` 打上小程序支持补丁。

### 配置你的 `tarojs` 应用

> 这个配置同时支持 `tarojs` 的 `react` / `preact` / `vue2` / `vue3` 等等所有框架

在项目的配置文件 `config/index.js` 中注册:

```js title="config/index.js"
const { UnifiedWebpackPluginV5 } = require('weapp-tailwindcss/webpack')
// 文件是 ts 则为
// import { UnifiedWebpackPluginV5 } from 'weapp-tailwindcss/webpack'
{
  // 找到 mini 这个小程序配置
  mini: {
    webpackChain(chain, webpack) {
      chain.merge({
        plugin: {
          install: {
            plugin: UnifiedWebpackPluginV5,
            args: [{
              appType: 'taro',
              // 下面个配置，会开启 rem -> rpx 的转化
              rem2rpx: true
            }]
          }
        }
      })
    }
  }
}
```

`rem2rpx` 这个配置项，是用来开启 `CSS` `rem` -> `rpx` 单位的转化的，可以不传值来关闭这个转化行为。

传 `true` 时，`1rem` 转化为 `32rpx`。可通过传入配置进行修改，详见 [rem 转 rpx (或 px)](https://weapp-tw.icebreaker.top/docs/quick-start/rem2rpx)

:::tip
**在使用 Taro 时，需要把 `config/index` 的配置项中的 `compiler` 设置为插件对应的版本 **

如果使用 `webpack4` 则使用从 `weapp-tailwindcss/webpack4` 导出的 `UnifiedWebpackPluginV4`

如果使用 `webpack5` 则使用从 `weapp-tailwindcss/webpack` 导出的 `UnifiedWebpackPluginV5`

另外假如你使用了 [`taro-plugin-compiler-optimization`](https://www.npmjs.com/package/taro-plugin-compiler-optimization) 记得把它去除。因为和它一起使用时，它会使整个打包结果变得混乱。详见 [issues/123](https://github.com/sonofmagic/weapp-tailwindcss/issues/123) [issues/131](https://github.com/sonofmagic/weapp-tailwindcss/issues/131)
:::

## 大功告成

现在我们尝试写下`tsx`模板:

```tsx
<View className="text-[#acc855] text-[100px]">Hello world!</View>
```

然后执行 `npm run dev:weapp` 开启我们的 `Tailwind CSS` 之旅吧！

:::tip
如果配置不成功，可以参考配置好的模板项目 [taro-react-tailwind-vscode-template](https://github.com/sonofmagic/taro-react-tailwind-vscode-template) 进行排错。
:::

## 和 NutUI 一起使用

`tarojs` 使用 [NutUI](https://nutui.jd.com) 的注意点:

[NutUI](https://nutui.jd.com) 需要配合 `@tarojs/plugin-html` 一起使用，

然而在和 `@tarojs/plugin-html` 一起使用时，默认配置下它会移除整个 `tailwindcss` 注入的 `css var` 区域块，这会造成所有 `tw-*` 相关`CSS`变量找不到，导致样式大量挂掉的问题。

此时可以给插件传入 [`injectAdditionalCssVarScope`](https://weapp-tw.icebreaker.top/docs/api/interfaces/UserDefinedOptions#injectadditionalcssvarscope) 配置项，把它设为 `true`，这能让插件在 `CSS` 里重新注入 `tailwindcss css var` 区域块。

相关的 [taro 官方文档](./use-h5#%E6%8F%92%E4%BB%B6-postcss-%E9%85%8D%E7%BD%AE%E9%A1%B9), 讨论详情见 [issues/155](https://github.com/sonofmagic/weapp-tailwindcss-webpack-plugin/issues/155)

## 参考项目和文档链接

想了解更多场景和常见问题，可以参考下列链接:

`weapp-tailwindcss` \[[官网](https://weapp-tw.icebreaker.top/)\] \[[Github](https://github.com/sonofmagic/weapp-tailwindcss)\]

`tailwindcss` \[[官网](https://tailwindcss.com/)\] \[[Github](https://github.com/tailwindlabs/tailwindcss)\]
</file>

<file path="docs/taro-dom.md">
---
title: Taro DOM Reference
---

**小程序**环境下，Taro 模拟实现的 DOM、BOM API 概览。

相关代码位于 `@tarojs/runtime` 包中。

## DOM

### TaroEventTarget

| 属性或方法          | 说明     |
| :------------------ | :------- |
| addEventListener    | 绑定事件 |
| removeEventListener | 解绑事件 |

### TaroNode

`TaroEventTarget <- TaroNode`

| 属性或方法      | 说明                                                |
| :-------------- | :-------------------------------------------------- |
| nodeType        |                                                     |
| nodeName        |                                                     |
| parentNode      |                                                     |
| childNodes      |                                                     |
| nextSibling     |                                                     |
| previousSibling |                                                     |
| parentElement   |                                                     |
| firstChild      |                                                     |
| lastChild       |                                                     |
| textContent     | setter                                              |
| insertBefore    |                                                     |
| appendChild     |                                                     |
| replaceChild    |                                                     |
| removeChild     |                                                     |
| remove          |                                                     |
| hasChildNodes   |                                                     |
| ownerDocument   | 只读，返回模拟的 [document](taro-dom#document) 对象 |

#### 可选属性/方法

以下属性/方法不是每个 Web 框架、每个应用都需要使用的。因此 Taro v3.4 把这类 DOM APIs 做成可插拔式，让开发者可以选择在最终的编译结果里只存在哪些 DOM APIs。

:::tip
如果没有使用 React 的 `dangerouslySetInnerHTML` 或 Vue2 的 `v-html` 去渲染 HTML 字符串，可以关闭对 `innerHTML` 的支持，可以节省 **9k** 的空间。
但 Vue3 必须开启，因为它使用了 insertAdjacentHTML。
:::

| 属性或方法         | 默认状态     | 配置项             | 说明                                                                                                            |
| :----------------- | :----------- | :----------------- | :-------------------------------------------------------------------------------------------------------------- |
| innerHTML          | 开启         | enableInnerHTML    | 目前只实现了 `setter`(主要用于支持 React `dangerouslySetInnerHTML`、Vue `v-html`)<br/>`getter` 只会返回空字符串 |
| insertAdjacentHTML | 开启（Vue3） | enableAdjacentHTML |                                                                                                                 |
| cloneNode          | 开启（Vue3） | enableCloneNode    |                                                                                                                 |
| contains           | 关闭         | enableContains     |                                                                                                                 |

### TaroText

`TaroEventTarget <- TaroNode <- TaroText`

| 属性或方法  | 说明 |
| :---------- | :--- |
| textContent |      |
| nodeValue   |      |

### TaroElement

`TaroEventTarget <- TaroNode <- TaroElement`

| 属性或方法             | 说明 |
| :--------------------- | :--- |
| id                     |      |
| tagName                |      |
| props                  |      |
| style                  |      |
| dataset                |      |
| className              |      |
| cssText                |      |
| classList              |      |
| children               |      |
| attributes             |      |
| textContent            |      |
| hasAttribute           |      |
| hasAttributes          |      |
| focus                  |      |
| blur                   |      |
| setAttribute           |      |
| removeAttribute        |      |
| getAttribute           |      |
| getElementsByTagName   |      |
| getElementsByClassName |      |
| dispatchEvent          |      |

#### 可选属性/方法

| 属性或方法            | 默认状态     | 配置项                | 说明                                |
| :-------------------- | :----------- | :-------------------- | :---------------------------------- |
| content               | 开启（Vue3） | enableTemplateContent |                                     |
| getBoundingClientRect | 关闭         | enableSizeAPIs        | 受限于小程序，此 API 是**异步函数** |

### RootElement

`TaroEventTarget <- TaroNode <- TaroElement <- RootElement`

非 Web 标准 API。是链接 Taro DOM 更新和小程序 `setData` 的核心实现。

在这里会调用小程序的 `setData` API，把 Taro DOM 的序列化数据传递到小程序渲染层。

### FormElement

`TaroEventTarget <- TaroNode <- TaroElement <- FormElement`

| 属性或方法 | 说明                   |
| :--------- | :--------------------- |
| value      | 返回或设置当前控件的值 |

### SVGElement

`TaroEventTarget <- TaroNode <- TaroElement <- SVGElement`

只是实现了继承关系，没有实现属性与方法。

## BOM

### window

Taro 模拟实现了基于浏览器标准 `window` 对象，它主要实现了用于支持 React、Vue 等框架运行的必备 API。

此外，Taro 会为 `window` 对象赋值小程序的 `global` 对象上的全部属性。

| 属性或方法            | 说明                                                               |
| :-------------------- | :----------------------------------------------------------------- |
| navigator             | 模拟的 [navigator](taro-dom#navigator) 对象                        |
| document              | 模拟的 [document](taro-dom#document) 对象                          |
| requestAnimationFrame | 模拟的 [requestAnimationFrame](taro-dom#requestanimationframe) API |
| cancelAnimationFrame  | 模拟的 [cancelAnimationFrame](taro-dom#cancelanimationframe) API   |
| getComputedStyle      | 只能用于返回元素的 `style` 值，做不到真正去计算 `css` 后的样式     |
| addEventListener      | 空函数                                                             |
| removeEventListener   | 空函数                                                             |

### document

`TaroEventTarget <- TaroNode <- TaroElement <- document`

| 属性或方法       | 说明                                                                |
| :--------------- | :------------------------------------------------------------------ |
| createElement    | 返回 `TaroElement`                                                  |
| createElementNS  | 没有真正去实现，等同于 `document.createElement`，返回 `TaroElement` |
| createTextNode   | 返回 `TaroText`                                                     |
| createComment    | 返回 `TaroText`                                                     |
| getElementById   | 返回 `TaroElement`                                                  |
| querySelector    | 目前只能根据 `id` 寻找元素，等同于 `document.getElementById`        |
| querySelectorAll | 没有真正去实现，返回 `[]`                                           |
| defaultView      | 返回 [window](taro-dom#window)                                      |

### navigator

`navigator` 为以下对象：

```json
{
  "appCodeName": "Mozilla",
  "appName": "Netscape",
  "appVersion": "5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/534.36 (KHTML, like Gecko) NodeJS/v4.1.0 Chrome/76.0.3809.132 Safari/534.36",
  "cookieEnabled": true,
  "mimeTypes": [],
  "onLine": true,
  "platform": "MacIntel",
  "plugins": [],
  "product": "Taro",
  "productSub": "20030107",
  "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/534.36 (KHTML, like Gecko) NodeJS/v4.1.0 Chrome/76.0.3809.132 Safari/534.36",
  "vendor": "Joyent",
  "vendorSub": ""
}
```

### requestAnimationFrame

优先使用小程序的 `requestAnimationFrame` API，如果不存在则进行 [polyfill](https://github.com/NervJS/taro/blob/next/packages/taro-runtime/src/bom/raf.ts)。

### cancelAnimationFrame

优先使用小程序的 `cancelAnimationFrame` API，如果不存在则使用 `clearTimeout` 代替。
</file>

<file path="docs/taro-in-miniapp.mdx">
---
title: 原生项目使用 Taro
---

import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

:::info
Taro v3.0.25 开始支持
:::

## 基础混合用法

### 示例项目

[blended-basic](https://github.com/NervJS/taro/tree/next/examples/blended-basic)

### 用法

#### 1. 开发环境

1.1 推荐在 Taro 项目中进行开发调试，在生产环境下再把产物移动到原生小程序中进行预览。

```bash
# 和编译普通 Taro 项目一样
$ taro build --type [platform] --watch
```

1.2 小程序开发者工具导入 **Taro 项目**进行预览。

#### 2. 生产环境

1.1 编译项目时使用 `--blended` 参数以输出混合模式的代码。

```bash
# 以混合模式进行打包
$ taro build --type [platform] --blended
```

1.2 移动 Taro 项目的输出目录到原生项目内

也可以编写一个 **Taro 插件**自动移动，可以参考 [plugin-mv](https://github.com/NervJS/taro/blob/next/examples/blended-basic/taro-project/plugin-mv/index.js)。

1.3 原生项目的 `app.js` 中引用 Taro 入口文件

```js title="app.config.js" {2,7,12}
// 必须引用 Taro 项目的入口文件
const taroApp = require('./taro/app.js').taroApp

App({
  onShow() {
    // 可选，调用 Taro 项目 app 的 onShow 生命周期
    taroApp.onShow()
  },

  onHide() {
    // 可选，调用 Taro 项目 app 的 onHide 生命周期
    taroApp.onHide()
  },
})
```

### Taro 项目引用原生项目的 JS 文件

有时我们需要在 Taro 项目中引用原生项目中的公共 JS 模块（如上报 sdk）。但是 Webpack 会把这些公共模块一并打包，导致公共模块存在两份（Taro 产物中一份，原生项目中一份）。

为了优化包体积大小，我们希望不要打包到 Taro 产物中，而是直接引用原生项目中的代码，可以使用 Webpack 的 [externals](https://webpack.js.org/configuration/externals/) 配置去实现。

#### 例子

假设以下项目结构：

    ├── miniapp           原生项目
    |   └── utils
    |       └── util.js
    └── taro-project      Taro 项目
        ├── config
        |   └── index.js
        └── src
            └── pages
                └── index 此页面中希望引用 miniapp/utils/util.js

1. 配置 `alias`，目的是让 `externals` 更方便地筛选出不需要打包的依赖。
2. 配置 Webpack `externals`，选择出不需要打包的依赖，并计算好相对路径。
3. 设置环境变量 `process.env.NODE_ENV` 为 `production` 时，externals 生效。（当没有手动设置环境变量时，默认在 `watch` 模式时环境变量为 `development`，否则为 `production`）

```js title="config/index.js" {3,8,10,15-29}
const config = {
  alias: {
    '@/utils':
      process.env.NODE_ENV === 'production'
        ? // 生产环境路径计算：
          // Webpack 编译发生在 taro-project 下，假设编译后的 taro-project/dist 会被移到到 miniapp/taro。
          // path.resolve(__dirname, '..') 为 taro-project。taro-project/dist 之于 taro-project，相当于 miniapp/taro 之于 miniapp。
          // 再根据 miniapp/utils 与 miniapp 的相对路径，得出 path.resolve(__dirname, '../utils')
          path.resolve(__dirname, '../utils')
        : // 开发环境直接引用原生项目下的依赖，方便开发
          path.resolve(__dirname, '../../miniapp/utils'),
  },
  mini: {
    webpackChain(chain) {
      chain.merge({
        externals: [
          (context, request, callback) => {
            const externalDirs = ['@/utils']
            const externalDir = externalDirs.find((dir) => request.startsWith(dir))

            if (process.env.NODE_ENV === 'production' && externalDir) {
              const externalDirPath = config.alias[externalDir]
              const res = request.replace('@/utils', path.relative(context, externalDirPath))

              return callback(null, `commonjs ${res}`)
            }

            callback()
          },
        ],
      })
    },
  },
}
```

#### 效果

```js title="taro-project/src/pages/index/index.js"
import { logSomething } from '@/utils/util'
logSomething()
```

```js title="webpack 打包结果"
{
  "./src/pages/index/index.jsx": (function(m, e, __webpack_require__) {
    var _utils_util = __webpack_require__("@/utils/util");
    // ...
  }),
  "@/utils/util": (function(module, exports) {
    // 成功 external
    module.exports = require("../../../utils/util");
  })
}
```

### Taro 项目引用原生项目的原生组件

有时我们需要在 Taro 项目中引用原生项目中的公共自定义组件。

和[引用原生项目的 js 文件](./taro-in-miniapp#引用原生项目的-js-文件)一样，我们希望在开发环境能正确解析组件路径，在生产环境则直接引用原生项目的组件而不是重复打包，可以使用 Taro 的 [alias](./config-detail#alias) 配置去实现。

#### 例子

假设以下项目结构：

    ├── miniapp                原生项目
    |   └── components
    |       └── title
    |           ├── index.js
    |           ├── index.wxml
    |           ├── index.wxss
    |           └── index.json
    └── taro-project           Taro 项目
        ├── config
        |   └── index.js
        └── src
            ├── components     小程序不支持引用根目录之外的组件，因此只能把原生项目的组件拷贝过来，让开发环境能正确解析组件
            |   └── title
            └── pages
                └── index      此页面中希望引用 miniapp/components/title

1. 把原生项目的组件拷贝到 Taro 项目，让开发环境能正确解析组件。
2. 根据开发环境和生产环境，正确配置 `alias`

```js title="config/index.js" {3,8,10}
const config = {
  alias: {
    '@/components':
      process.env.NODE_ENV === 'production'
        ? // 生产环境路径计算：
          // Webpack 编译发生在 taro-project 下，假设编译后的 taro-project/dist 会被移到到 miniapp/taro。
          // path.resolve(__dirname, '..') 为 taro-project。taro-project/dist 之于 taro-project，相当于 miniapp/taro 之于 miniapp。
          // 再根据 miniapp/components 与 miniapp 的相对路径，得出 path.resolve(__dirname, '../components')
          path.resolve(__dirname, '../components')
        : // 开发环境引用 taro-project/src 下的组件
          path.resolve(__dirname, '../src/components'),
  },
}
```

```js title="taro-project/src/pages/index/index.config.js" {3}
export default {
  usingComponents: {
    title: '@/components/title/index',
  },
}
```

### 对 Taro 项目的部分页面分包

在原生项目中直接配置 subPackages 指向 Taro 编译后的页面即可。

#### 依赖细分

Taro 默认会把页面共用的普通依赖打包为主包里的 `common.js`，node_modules 依赖打包为主包里的 `vendor.js`。

但是在分包时，我们会希望把**只有在分包中共用的依赖**打包到分包中，而不是打在主包的 `common.js` 和 `vendor.js` 中。这就需要我们对依赖进行细分。可以借助 Webpack 的 [splitChunk](https://webpack.js.org/plugins/split-chunks-plugin/) 和 Taro 的 [addChunkPages](./config-detail#miniaddchunkpages) 配置去实现。

#### 例子

假设以下项目结构：

    ├── dist
    |   |── common.js     公共依赖
    |   |── vendors.js    node_modules 依赖
    |   └── subPackages
    |       ├── foo
    |       ├── bar
    |       └── common.js 只有 subPackages 子包中使用的公共依赖
    └── src
        └── subPackages
            ├── foo
            └── bar

1. 使用 **Webpack splitChunks** 把只有 `subpackages` 子包独有的依赖打包到 `subpackages/common.js` 中。
2. 使用 **Taro addChunkPages** 配置，在子包中所有页面的头部添加对 `subpackages/common.js` 的引用。

```js title="config/index.js" {3-6,12-20}
const config = {
  mini: {
    addChunkPages(pages) {
      pages.set('subpackages/bar/index', ['subpackages/common']),
        pages.set('subpackages/foo/index', ['subpackages/common'])
    },
    webpackChain(chain) {
      chain.merge({
        optimization: {
          splitChunks: {
            cacheGroups: {
              subpackagesCommon: {
                name: 'subpackages/common',
                minChunks: 2,
                test: (module, chunks) => {
                  const isNoOnlySubpackRequired = chunks.find((chunk) => !/\bsubpackages\b/.test(chunk.name))
                  return !isNoOnlySubpackRequired
                },
                priority: 200,
              },
            },
          },
        },
      })
    },
  },
}
```

## 把 Taro 项目作为一个完整分包

### 示例项目

[blended-apart](https://github.com/NervJS/taro/tree/next/examples/blended-apart)

### 使用方法

#### 1. 安装使用插件

安装插件 [@tarojs/plugin-indie](https://github.com/NervJS/taro-plugin-indie)

```bash
npm i @tarojs/plugin-indie --save-dev
```

使用插件

```js title="config/index.js"
const config = {
  plugins: ['@tarojs/plugin-indie'],
}
```

#### 2. 开发环境

2.1 推荐在 Taro 项目中进行开发调试，在生产环境下再把产物移动到原生小程序中进行预览。

```bash
# 和编译普通 Taro 项目一样
$ taro build --type [platform] --watch
```

2.2 小程序开发者工具导入 **Taro 项目**进行预览。

#### 3. 生产环境

3.1 编译项目时使用 `--blended` 参数以输出混合模式的代码。

```bash
# 以混合模式进行打包
$ taro build --type [platform] --blended
```

3.2 移动 Taro 项目的输出目录到原生项目内

也可以编写一个 **Taro 插件**自动移动，可以参考 [plugin-mv](https://github.com/NervJS/taro/blob/next/examples/blended-basic/taro-project/plugin-mv/index.js)。

3.3 设置原生项目的分包配置

### 把 Taro 项目拆分到多个分包

假设有一个 Taro 项目，它含有页面 A 和页面 B。我们需要把页面 A 加入原生项目的其中一个分包 M，把页面 B 加入到另一个分包 N。

为此，和普通打出**一个分包**不同的是，首先需要配置 Webpack 的 `output.jsonpFunction` 配置，避免 `chunkid` 的冲突。

```js title="config/index.js" {7}
config = {
  mini: {
    webpackChain(chain) {
      chain.merge({
        output: {
          // 可以配合 npm script 和环境变量来动态修改
          jsonpFunction: process.env.JSONP_NAME || 'webpackJsonp',
        },
      })
    },
  },
}
```

然后分别对 A、B 页面使用混合模式打包，步骤和[把 Taro 项目作为一个完整分包](./taro-in-miniapp#把-taro-项目作为一个完整分包)一致。

## 把 Taro 组件编译为原生自定义组件

:::info
Taro v3.1.2 开始支持使用 React 开发，Taro v3.5.6 开始支持使用 Vue3 开发。
:::

Taro 支持把组件编译为**原生小程序自定义组件**，供原生项目使用。

### 示例项目

- [blended-taro-component](https://github.com/NervJS/taro/tree/next/examples/blended-taro-component)
- [blended-taro-component-vue3](https://github.com/NervJS/taro/tree/next/examples/blended-taro-component-vue3)

### 使用方法

#### 1. 配置组件路径

修改 `app.config.js`，增加 `components` 配置，指向组件入口文件的路径：

```js title="app.config.js"
export default {
  // ...
  components: ['pages/index/index', 'components/picker/index'],
}
```

#### 2. 开始编译

使用 `taro build native-components` 命令，配合参数 `type`，即可编译出对应平台的自定义组件。

```bash
taro build native-components --type [platform] [--watch]
```

### props 传递

传递 props 给 Taro 编译出来的原生自定义组件时，需要统一通过 `props` 参数来传递：

```js title="page/index/index.js"
Page({
  data: {
    pickerProps: {
      mode: 'format',
      value: [0, 0, 0],
      onInitial(value, index) {
        console.log('onInitial')
      },
    },
  },
})
```

```xml title="page/index/index.wxml"
<!--index.wxml-->
<view>
  <picker props="{{pickerProps}}"></picker>
</view>
```

```jsx title="Taro 组件 - Picker"
function Picker ({ mode, value, onInitial }) {
  return (
    // ...
  )
}
```

### 小程序自定义组件对象实例

React 开发者可以通过 `props.$scope` 获取到小程序的自定义组件对象实例，而 Vue3 开发者可以通过 `props._scope` 获取。

使用某些小程序 API 时可能需要使用此实例，如获取视图层 DOM：

`Taro.createSelectorQuery().in(props.$scope)`

### 组件间通信与事件

支持使用两种方式进行组件间通信。

#### 使用小程序的 triggerEvent

和小程序原生自定义组件的[组件间通信与事件](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/events.html)一样，子组件使用 `triggerEvent` 发送事件。

```js title="子组件"
props.$scope.triggerEvent('myevent', myEventDetail, myEventOption)
```

#### 通过 props 传递事件回调

```js title="父组件"
Page({
  data: {
    childProps: {
      // props 里可以传递函数
      onMyEvent (value, index) {
        console.log(value, index)
      }
    }
  }
})
// 和普通 props 传递一样
<child props="{{childProps}}">
```

```js title="子组件"
props.onMyEvent(value, index)
```

### 组件配置

:::info
Taro v3.3.20 开始支持
:::

微信小程序的自定义组件支持配置 [styleIsolation](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html#%E7%BB%84%E4%BB%B6%E6%A0%B7%E5%BC%8F%E9%9A%94%E7%A6%BB)、[virtualHost](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html#%E8%99%9A%E6%8B%9F%E5%8C%96%E7%BB%84%E4%BB%B6%E8%8A%82%E7%82%B9) 等特性。在 Taro 中可以通过修改组件的配置文件进行设置：

```js title="index.config.js"
export default {
  styleIsolation: 'isolated',
  virtualHost: true,
}
```

### 使用 Slot

:::info
Taro v3.5.7 开始支持
:::

组件可以使用 `<NativeSlot>` 作为小程序的 slot 节点。用法介绍：

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx title="Taro 组件"
import { View, NativeSlot } from '@tarojs/components'

export default function () {
  return (
    <View>
      <NativeSlot />
    </View>
  )
}
```

</TabItem>

<TabItem value="Vue">

```html title="Taro 组件"
<template>
  <view>
    <native-slot />
  </view>
</template>
```

</TabItem>
</Tabs>

```xml title="原生组件 - index.wxml"
<comp>
  <view>Slot Content</view>
</comp>
```

## 新混合模式
:::info
Taro v3.6.13 开始支持使用 React 开发。
:::

### 模式介绍
新的混合模式在项目打包过程中会同时处理 `Taro组件编译为原生自定义组件` 的任务，该模式适用于同时需要用到 `页面混合模式` 以及 `Taro组件编译为原生自定义组件` 的场景。

> 以往使用`taro build native-components` 命令编译的自定义组件会额外包含一套Taro运行时，而这个特性可以帮助你在编译原生自定义组件的同时与taro页面共享同一套运行时代码，避免了两套运行时导致包体增大的问题。通过这种优化，我们能够更加高效地使用混合模式，并减少包体积的增长。

### 示例项目
[new-blended](https://github.com/NervJS/taro/tree/next/examples/new-blended)

### 使用方法
#### 1. 以新混合模式进行项目打包

编译项目时使用 --new-blended 参数替代老的 --blended 以输出新混合模式的代码。
```bash
$ taro build --type [platform] --new-blended
```
#### 2. 把 Taro 组件编译为原生自定义组件(可选)

配置组件路径
修改 `app.config.js`，增加 `components` 配置，指向组件入口文件的路径：
```js title="app.config.js"
export default {
  // ...
  components: ['pages/index/index', 'components/picker/index'],
}
```

#### 3. 其他用法同 [普通混合模式](#基础混合用法).

### 注意事项
该特性已集成 `@tarojs/plugin-indie` 插件能力，不需要再启用该插件，即可把 Taro 项目作为一个完整分包使用。
</file>

<file path="docs/taro-quickapp-manifest.md">
### Taro 和快应用配置差异

如果希望自己现在写的 Taro 程序日后能更平滑的转换到快应用，在十大厂商的多个入口(搜索、语音、浏览器、负一屏)快速上线，就需要了解 Taro 和快应用的配置差异，由于 Taro 是立足于微信小程序的开发框架，因此只需要比较微信小程序和快应用的官方文档即可了解差异，以生态更完善的微信小程序为基础整理出如下表格：

| 微信小程序属性                                                                                                                                     | 类型     | 必填 | 描述                                                                                                                                                                    | 对应快应用属性 |
| :------------------------------------------------------------------------------------------------------------------------------------------------- | :------- | :--- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------- |
| [pages](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#pages)                                                   | string[] | 是   | 页面路径列表                                                                                                                                                            | router.pages   |
| [window](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#window)                                                 | Object   | 否   | 全局的默认窗口表现                                                                                                                                                      | display        |
| [tabBar](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#tabBar)                                                 | Object   | 否   | 底部 `tab` 栏的表现                                                                                                                                                     | 无             |
| [networkTimeout](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#networkTimeout)                                 | Object   | 否   | 网络超时时间                                                                                                                                                            | 无             |
| [functionalPages](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#functionalPages)                               | boolean  | 否   | 是否启用插件功能页，默认关闭                                                                                                                                            | 无             |
| [subpackages](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#subpackages)                                       | Object[] | 否   | 分包结构配置                                                                                                                                                            | subpackages    |
| [workers](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#workers)                                               | string   | 否   | `Worker` 代码放置的目录                                                                                                                                                 | 无             |
| [requiredBackgroundModes](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#requiredBackgroundModes)               | string[] | 否   | 需要在后台使用的能力，如「音乐播放」                                                                                                                                    | features       |
| [plugins](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#plugins)                                               | Object   | 否   | 使用到的插件                                                                                                                                                            | 无             |
| [preloadRule](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#preloadRule)                                       | Object   | 否   | 分包预下载规则                                                                                                                                                          | 无             |
| [resizable](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#resizable)                                           | boolean  | 否   | iPad 小程序是否支持屏幕旋转，默认关闭                                                                                                                                   | 无             |
| [navigateToMiniProgramAppIdList](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#navigateToMiniProgramAppIdList) | string[] | 否   | 需要跳转的小程序列表，详见 [wx.navigateToMiniProgram](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/miniprogram-navigate/wx.navigateToMiniProgram.html) | 无             |
| [usingComponents](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#usingComponents)                               | Object   | 否   | 全局[自定义组件](<https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/(custom-component/README)>)配置                                              | 无             |
| [permission](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#permission)                                         | Object   | 否   | 小程序接口权限相关设置                                                                                                                                                  | 无             |
| [sitemapLocation](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#sitemapLocation)                               | String   | 是   | 指明 sitemap.json 的位置                                                                                                                                                | 无             |
| [style](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#style)                                                   | String   | 否   | 指定使用升级后的 weui 样式                                                                                                                                              | 无             |

以上是全局配置的差异，从表中可以看到微信小程序有非常多的定制属性，比如 tabBar\plugins\sitemapLocation 等，当然快应用也有很多定制属性，如下表加粗所示：

| 属性                   | 类型        | 默认值 | 必填   | 描述                                                                                                   |
| :--------------------- | :---------- | :----- | :----- | :----------------------------------------------------------------------------------------------------- |
| **package**            | **String**  | **-**  | **是** | **应用包名，确认与原生应用的包名不一致，推荐采用 com.company.module 的格式，如：com.example.demo**     |
| **name**               | **String**  | **-**  | **是** | **应用名称，6 个汉字以内，与应用商店保存的名称一致，用于在桌面图标、弹窗等处显示应用名称**             |
| **icon**               | **String**  | **-**  | **是** | **应用图标，提供 192x192 大小的即可**                                                                  |
| **versionName**        | **String**  | **-**  | **否** | **应用版本名称，如：`"1.0"**`                                                                          |
| **versionCode**        | **Integer** | **-**  | **是** | **应用版本号，从`1`自增，推荐每次重新上传包时 versionCode+1\*\***                                      |
| **minPlatformVersion** | **Integer** | **-**  | **否** | **支持的最小平台版本号，兼容性检查，避免上线后在低版本平台运行并导致不兼容；如果不填按照内测版本处理** |
| features               | Array       | -      | 否     | 接口列表，绝大部分接口都需要在这里声明，否则不能调用，详见每个接口的文档说明                           |
| config                 | Object      | -      | 是     | 系统配置信息                                                                                           |
| router                 | Object      | -      | 是     | 路由信息                                                                                               |
| display                | Object      | -      | 否     | UI 显示相关配置                                                                                        |
| subpackages `1040+`    | Object      | -      | 否     | 定义并启用分包加载                                                                                     |

微信小程序还支持每个页面定制自己的页面配置 json(大部分属性继承自[window](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#window))，而快应用的页面配置则统一由 display.pages 管理，从宏观上可以看到两类轻应用的配置差别，微观上我们也来分析一下：

- pages **VS** router.pages

微信的 pages 只是一个路径字符串数组，没有额外的信息，而快应用的 pages 有很多细腻的属性，比如 filter 属性，声明该属性之后，页面中可以使用$page 获取打开页面的参数，还有 launchMode 可以指定启动模式，Taro 为了兼容这一差异，使用 customPageConfig 属性进行适配，参考[文档](/docs/quick-app) 。

- window **VS** display

| 微信小程序属性               | 描述                                                                                                                                                                | 快应用属性              |
| :--------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :---------------------- |
| navigationBarBackgroundColor | 导航栏背景颜色，如 `#000000`                                                                                                                                        | titleBarBackgroundColor |
| navigationBarTextStyle       | 导航栏标题颜色，仅支持 `black` / `white`                                                                                                                            | titleBarTextColor       |
| navigationBarTitleText       | 导航栏标题文字内容                                                                                                                                                  | titleBarText            |
| navigationStyle              | 导航栏样式，仅支持以下值： `default` 默认样式 `custom` 自定义导航栏，只保留右上角胶囊按钮。参见注 2。                                                               | 无                      |
| backgroundColor              | 窗口的背景色                                                                                                                                                        | backgroundColor         |
| backgroundTextStyle          | 下拉 loading 的样式，仅支持 `dark` / `light`                                                                                                                        | 无                      |
| backgroundColorTop           | 顶部窗口的背景色，仅 iOS 支持                                                                                                                                       | 无                      |
| backgroundColorBottom        | 底部窗口的背景色，仅 iOS 支持                                                                                                                                       | 无                      |
| enablePullDownRefresh        | 是否开启全局的下拉刷新。 详见 [Page.onPullDownRefresh](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onpulldownrefresh)                  | 无                      |
| onReachBottomDistance        | 页面上拉触底事件触发时距页面底部距离，单位为 px。 详见 [Page.onReachBottom](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onreachbottom) | 无                      |
| pageOrientation              | 屏幕旋转设置，支持 `auto` / `portrait` / `landscape` 详见 [响应显示区域变化](https://developers.weixin.qq.com/miniprogram/dev/framework/view/resizable.html)        | orientation             |

微信小程序对背景和导航栏的样式配置更加细腻，快应用则新增了对沉浸式状态栏的管理。

| 属性                               | 类型                  | 默认值 | 描述                                                           |
| :--------------------------------- | :-------------------- | :----- | :------------------------------------------------------------- |
| statusBarImmersive `1050+`         | Boolean               | false  | 是否显示沉浸式状态栏                                           |
| statusBarTextStyle `1050+`         | light \| dark \| auto | auto   | 状态栏文字样式，有亮,暗和自动 当为自动时会根据状态栏背景色调整 |
| statusBarBackgroundColor `1050+`   | String                | -      | 状态栏背景色，默认值同标题栏背景色                             |
| statusBarBackgroundOpacity `1050+` | float(0-1.0)          | false  | 状态栏背景色不透明度，默认值同标题栏背景色不透明度             |

至于啥是沉浸式状态栏，[参考经验](https://jingyan.baidu.com/article/3d69c55122cd57f0cf02d728.html)

- subPackages **VS** subPackages

  既然是轻应用自然少不了分包机制，微信的 subPackages 支持 root\name\pages\independent 字段，当 independent 字段为 true 时为独立分包，此时可以不需下载主包即可运行，否则为普通分包，当用户进入普通分包或主包内页面时，主包会被下载，快应用则支持 name\resource 字段，resource 就是包名，运行时，快应用将优先加载基础包和页面所在分包，其余分包会自动在后台进行预加载。

  ***

以上就是 Taro 和快应用的配置对比啦。

参考链接：

[https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#全局配置)

[https://doc.quickapp.cn/framework/manifest.html](https://doc.quickapp.cn/framework/manifest.html)
</file>

<file path="docs/taroize-troubleshooting.md">
---
title: Troubleshooting
---

## 不支持的小程序特性

### 入口 App 对象

| 属性                 | 说明 |
| :------------------- | :--- |
| onError              |      |
| onPageNotFound       |      |
| onUnhandledRejection |      |
| onThemeChange        |      |

### 页面 Page 对象

| 属性                 | 说明                    |
| :------------------- | :---------------------- |
| selectComponent      | 建议使用 React ref 重构 |
| selectAllComponents  | 建议使用 React ref 重构 |
| selectOwnerComponent | 建议使用 React ref 重构 |
| groupSetData         |                         |

### 自定义组件

| 属性             | 说明                                                        |
| :--------------- | :---------------------------------------------------------- |
| moved            |                                                             |
| externalClasses  | Taro 3 不存在自定义组件，建议规范类名或使用 CSS Module 代替 |
| relations        |                                                             |
| options          |                                                             |
| definitionFilter |                                                             |

### wxml 语法

| 属性 | 说明                                                                          |
| :--- | :---------------------------------------------------------------------------- |
| 循环 | [部分语法有限制]                                                              |
| 事件 | [部分语法有限制](./taroize-troubleshooting#2-事件)                            |
| 引用 | [部分语法有限制](./taroize-troubleshooting#16-include-里不支持使用-template)  |
| wxs  | [部分语法有限制](./taroize-troubleshooting#15-不支持-wxs-里的-getregexp-方法) |

## 关键问题

### 1. 没有处理基类

原生开发中，常常会把 App、Page、Component 构造对象的公共逻辑整合到基类中。

如 **Vant-weapp** 中：

```js
// 组件
VantComponent({
  data: {},
})
// 基类
function VantComponent(vantOptions = {}) {
  // 整合组件独有配置 vantOptions 和公共配置到最终的配置对象 options 中
  // ...

  // 调用小程序的 Component 方法构造自定义组件
  Component(options)
}
```

Taro 在编译时只能识别出入口、页面、组件文件中存在的 `App()`、`Page()`、`Component()` 调用，使用基类对配置封装后就不存在这些调用。因此编译后的 `withWeapp` 获得的参数是 `{}`。

```js
VantComponent({
  data: {},
})
// withWeapp 中应该传入小程序配置对象
@withWeapp({})
class _C extends React.Component {}
```

因此我们需要手动修改：

```js
// 基类
function VantComponent(vantOptions = {}) {
  // 整合组件独有配置 vantOptions 和公共配置到最终的配置对象 options 中
  // ...

  // 调用小程序的 Component 方法构造自定义组件
  // Component(options);

  // 1. 基类直接返回整合后的 options
  return options
}
```

```js
// 2. 把基类创建的配置传入 withWeapp：
const options = VantComponent({
  data: {},
})
@withWeapp(options)
class _C extends React.Component {}
```

### 2. 样式作用域

微信小程序中的自定义组件，转换后会生成一个 Taro 中的 React/Vue 组件。

但是 Taro 中使用 React/Vue 开发的组件，编译到小程序平台时，并不会生成对应的小程序自定义组件。

**因此微信小程序自定义组件的样式隔离特性，在转换为 Taro 后就会丢失。**

#### 解决办法：

1. 修改冲突的选择器。
2. 使用 CSS Modules 进行改写。

## 常见问题

### 1. wxml 语法转换问题

把 `wxml` 转换为 `JSX` 是通过操作 `AST` 实现的，有一些写法可能没有考虑到，或难以适配，从而导致报错。

以下是一些已知问题，需要手动修复：

#### 1.1 组件同时使用 `wx:for` 和 `wx:if` 语句时转换错误

当组件上同时使用了 `wx:for` 和 `wx:if` 语句，并且使用了当前**循环元素 item** 或**循环下标 index** 做判断条件时，转换后会报错。

例如：

```jsx
// 转换前（注意判断条件使用了循环下标 index）：
<block wx:for="{{objectArray}}" wx:if="{{index % 2 !== 0}}">
  <view>objectArray item: {{item.id}}</view>
</block>
```

```jsx
// 转换后：
{
  index % 2 !== 0 && (
    <Block>
      {objectArray.map((item, index) => {
        return (
          <Block>
            <View>{'objectArray item: ' + item.id}</View>
          </Block>
        )
      })}
    </Block>
  )
}
```

上例可见，对于条件语句的转换，目前的处理会把条件提取到组件外部。但是如果条件使用了 `item` 或 `index` 时，这样的提取逻辑会导致**变量未定义**的报错。

暂时可以通过手动修复解决：

方法一，修改**编译前**的代码，把循环和条件语句拆开到两个组件中：

```jsx
<block wx:for="{{objectArray}}">
  <block wx:if="{{index % 2 !== 0}}">
    <view>objectArray item: {{item.id}}</view>
  </block>
</block>
```

方法二，修改**编译后**的代码,把条件判断放进循环体中：

```jsx
<Block>
  {objectArray.map((item, index) => {
    return <Block>{index % 2 !== 0 && <View>{'objectArray item: ' + item.id}</View>}</Block>
  })}
</Block>
```

#### 1.2 根元素不能含有 `hidden` 属性。

#### 1.3 编译时报错：SyntaxError: Unexpected token

尖括号 “<” 右侧需要留一个空格，[#4243](https://github.com/NervJS/taro/issues/4243)

##### 解决办法：

检查是否存在以下写法：

```jsx
<view>{{a <4? "1": "2"}}</view>
```

改为：

```jsx
<view>{{a < 4? "1": "2"}}</view>
```

#### 1.4 运行时报错：ReferenceError: item is not defined

查看编译后的 JSX，是否因为漏了从 `this.data` 中取出变量，如：

```
// 下面的代码没有引用 item
const { a, b, c } = this.data
```

##### 解决办法：

`this.data` 中的变量名，不要和用于指定数组当前下标的变量名，默认值为 `item`，或由 `wx:for-index` 具体指定的变量名相同。

#### 1.5 不支持 WXS 里的 GetRegExp 方法

使用 `RegExp` 构造正则表达式。

#### 1.6 `<include>` 里不支持使用 `<template>`

#### 1.7 template 里暂不支持使用 catch 事件

### 2. 事件

- 事件不支持绑定字符串。
- `catchtouchmove` 转换后只能停止回调函数的冒泡，不能阻止滚动穿透。如要阻止滚动穿透，可以手动给编译后的 `View` 组件加上 `catchMove` 属性。
- 不支持事件捕获阶段。
- 不支持使用 WXS 函数响应事件。
- 不支持互斥事件绑定 `mut-bind`。
- 不支持 `mark` 来识别具体触发事件的 target 节点。

### 3. CommonJS 和 ES 模块化语法不能混用

可能遇到的报错信息：

- Cannot assign to read only property 'exports' of object
- export '[something]' (imported as '[name]') was not found in '[somePath]'

在使用到小程序 API 的地方，Taro 会把 `wx.api()` 转换为 `Taro.api()`，同时在文件的头部加上 `import Taro from '@tarjs/taro`。

如果此文件原本是使用 **CommonJS** 组织模块，可能会出现问题，需要手动修复。

### 4. selectorQuery API 获取不到 DOM

1. 一定要在 `onReady`、`ready` 生命周期中才能调用小程序 API 获取 DOM。
2. 不需要调用 `.in(this)` 方法。

### 5. Image 没有处理动态拼接的 src

Taro 会对 `Image` 组件的 src 进行处理：

```jsx
// 转换前：
<Image src='../../img/icons/0.png' />
// 转换后：
<Image src={require('../../img/icons/0.png')} />
```

但如果 `src` 是动态拼接的字符串，则需要手动修改：

```jsx
// 转换前：
<Image src='../../img/icons/' + chart.id + '.png' />
// 转换后：
<Image src='../../img/icons/' + chart.id + '.png' />
// 手动修改，图片也需要手动拷贝到 taroConert/src 对应目录下：
<Image src={require('../../img/icons/' + chart.id + '.png')} />
```

### 6. require 的参数不能是变量

可能遇到的报错信息：

- The "path" argument must be of type string. Received type undefined

不支持转换以下写法，[#4749](https://github.com/NervJS/taro/issues/4749)：

```js
var pathTest = './test.js'
var test = require(pathTest)
```

Taro 目前只能转换 `require` 字符串的写法。

### 7. 没有处理 export from 语法

暂时手动处理，[#5131](https://github.com/NervJS/taro/issues/5131)。

### 8. Issues

反向转换的更多问题，请查阅 Taroize 相关 [Issues](https://github.com/NervJS/taro/issues?q=is%3Aopen+is%3Aissue+label%3AA-taroize)。
</file>

<file path="docs/taroize.md">
---
title: 微信小程序转 Taro
---

Taro 可以把**原生微信小程序应用转换为 Taro 项目**，从而使项目成为多端应用。

转换后的代码可读性高，能够继续使用 **React**（将来支持转换为 **Vue**）进行二次开发。

### 反向转换步骤

1. 在微信小程序项目的根目录中运行 `npx @tarojs/cli-convertor` 命令进行转换：

```bash
# 转换后的代码保存在根目录下的 `taroConvert` 文件夹下
$ npx @tarojs/cli-convertor
```

3. 进入 `taroConvert` 目录，安装依赖：

```bash
$ cd taroConvert
$ npm install
```

4. 运行 `build` 命令，把项目编译到任意平台：

```bash
$ taro build --type [platform]
```
</file>

<file path="docs/template.md">
---
title: 项目初始化模板
---

一直以来，在使用 Taro CLI 的 `taro init` 命令创建项目时，CLI 会提供若干内置模板给开发者选择。但是很多团队都有自己独特的业务场景，需要使用和维护的模板也不尽一致，因此 Taro 支持把项目模板打包成一个能力赋予给开发者。

`1.3.9` 对 CLI 的模板功能做了以下修改：

1. CLI 只保留最基础的 `default` 模板，其它模板被移除。
2. CLI 会从 CLI 全局配置中读取**模版源**配置项，然后从模板源拉取模板供开发者选择。
3. 开发者可以通过修改**模板源**来使用自己的模板。

## 模板源

模板源为 CLI 配置项的 **templateSource** 字段，可以使用 [taro config](./GETTING-STARTED#cli-%E9%85%8D%E7%BD%AE) 命令对其进行操作。

### 默认模版源

默认模板源为 [taro-project-templates](https://github.com/NervJS/taro-project-templates) 仓库，原本内置的模板都被抽离到此处。

### 配置模板源

模板源支持两种格式，**git 模板源** 和 **url 模板源**。

#### git 模板源

- GitHub - github:owner/name
- GitLab - gitlab:owner/name
- Direct - direct:url

```sh
# 初始化项目时可以使用 --clone 选项指定拉取远程模板时使用git clone
taro init --clone
```

#### url 模板源

指向某 zip 包的 url。

## 编写模板

### 模板组织格式

模板目录组织支持两种，分别是**单模板模式**和**模板组模式**。

#### 单模板模式

##### git

仓库根目录存在 package.json。

模板名为仓库名。

##### zip 包

zip 包解压出单文件夹，文件夹根目录包含 package.json。

模板名为 zip 包解压出的文件夹名。

![template](https://storage.jd.com/cjj-test/QQ20190717-154634.png)

#### 模板组模式

##### git

如[默认模板源](https://github.com/NervJS/taro-project-templates)，仓库根目录下存放着若干模板。

模板名对应根目录下所有文件夹名。

##### zip 包

zip 包解压出单文件夹，文件夹内包含若干模板。

模板名对应文件夹内所有文件夹名。

![templates](https://storage.jd.com/cjj-test/QQ20190717-152451.png)

### 静态模板

静态模板表示不带逻辑的模板，CLI 会遍历整个模板文件夹，把文件一一拷贝到目标位置。

### 动态模板

很多情况下需要为模板加入一些逻辑，从而根据不同的环境生成不同的模板内容。

开发者可以在模板根目录加入 **template_creator.js** 文件，文件对外 exports 包含 handler 、 basePageFiles 与 compiler 字段的对象：

```js {5,16} title="template_creator.js"
const path = require('path')

function normalizePath (path) {
  return path.replace(/\\/g, '/').replace(/\/{2,}/g, '/')
}

function createWhenTs(err, params) {
  return params.typescript ? true : false
}
const SOURCE_ENTRY = '/src'
const PAGES_ENTRY = '/src/pages'

const handler = {
  '/global.d.ts': createWhenTs,
  '/tsconfig.json': createWhenTs,
  '/src/pages/index/index.jsx' (err, { pageName = '', pageDir = '', subPkg = '' }) {
    return {
      setPageName: normalizePath(path.join(PAGES_ENTRY, pageDir, pageName, 'index.jsx')),
      setSubPkgName: normalizePath(path.join(SOURCE_ENTRY, subPkg, pageDir, pageName, 'index.jsx'))
    }
  },
  '/src/pages/index/index.css' (err, { pageName = '', pageDir = '', subPkg = '' }) {
    return {
      setPageName: normalizePath(path.join(PAGES_ENTRY, pageDir, pageName, 'index.css')),
      setSubPkgName: normalizePath(path.join(SOURCE_ENTRY, subPkg, pageDir, pageName, 'index.css'))
    }
  },
}

const basePageFiles = ['/src/pages/index/index.jsx', '/src/pages/index/index.css']

module.exports = {
  handler,
  basePageFiles,
  compiler: ['Webpack5', 'Webpack4', 'Wite']
}
```

#### 模板语言

请使用 [Handlebars](https://handlebarsjs.com/) 作为模板语言，各模板文件都将接收到全局模板参数。

##### 默认全局模板参数（模板中可直接使用的变量）

| 变量        | 类型                                   | 说明                                         |
| :---------- | :------------------------------------- | :------------------------------------------- |
| projectName | string                                 | 项目名                                       |
| description | string                                 | 项目描述                                     |
| version     | string                                 | Taro CLI 版本                                |
| date        | string                                 | 模板创建时间戳                               |
| css         | 'None' or 'Sass' or 'Stylus' or 'Less' | 样式预处理工具                               |
| cssExt      | string                                 | 样式文件后缀                                 |
| typescript  | boolean                                | 是否使用 TS                                  |
| pageName    | string                                 | `taro create` 时传入的页面名称，默认 'index' |
| template    | string                                 | 模板名称                                     |
| framework   | 'React' or 'Preact' or 'Vue' or 'Vue3' | 框架名称                                     |
| compiler    | 'Webpack4' or 'Webpack5' or 'Vite'     | 编译模式名称                                 |
##### 例子

```handlebars
import { defineConfig{{#if typescript }}, type UserConfigExport{{/if}} } from '@tarojs/cli'
{{#if typescript }}import TsconfigPathsPlugin from 'tsconfig-paths-webpack-plugin'{{/if}}
```

#### handler 字段

handler 用于控制是否生成某文件，或给文件传入特定参数。

##### handler: object

| 属性     | 类型     | value    |
| :------- | :------- | :------- |
| 文件路径 | function | 处理函数 |

> 文件路径以 “/” 开头，代表模板文件夹根目录

##### 处理函数

params: object

:::info
`params.pageDir` Taro v4.0.0+ 开始支持

`params.subPkg` Taro v4.0.0+ 开始支持
:::

| 属性         | 类型                                   | 说明                                          |
| :----------- | :------------------------------------- | :-------------------------------------------- |
| projectName  | string                                 | 项目名                                        |
| description  | string                                 | 项目描述                                      |
| version      | string                                 | Taro CLI 版本                                 |
| date         | string                                 | 模板创建时间戳                                |
| css          | 'none' or 'sass' or 'stylus' or 'less' | 样式预处理工具                                |
| typescript   | boolean                                | 是否使用 TS                                   |
| pageName     | string                                 | 页面名称                                      |
| pageDir      | string                                 | 页面路径（相对于「页面目录」的相对路径） taro create 时 --dir 传入的值|
| subPkg       | string                                 | 分包页面路径（相对于「src目录」的相对路径） taro create 时 --subpkg 传入的值|
| template     | string                                 | 模板名称                                      |
| templatePath | string                                 | 模板路径                                      |
| projectPath  | string                                 | 目标路径                                      |
| period       | 'createApp' or 'createPage'            | `taro init` 创建项目或 `taro create` 创建页面 |

return: boolean/object

:::info
`object.setSubPkgName` Taro v4.0.0+ 开始支持
:::

返回值说明

| 取值   | 说明                                                     |
| :----- | :------------------------------------------------------- |
| true   | 创建文件                                                 |
| false  | 不创建文件                                               |
| object | 创建文件，返回的 object 的字段会被合并到全局模板参数中。 |

若返回值为 object，其中某些属性有特殊作用：

| 属性        | 类型    | 说明                     |
| :---------- | :------ | :----------------------- |
| setPageName | string  | 将替换当前文件的输出路径 |
| changeExt   | boolean | 是否自动替换文件后缀     |

##### 例子

当用户选择了使用 typescript 时，才生成 **global.d.ts** 和 **tsconfig.json** 文件。

```js title="template_creator.js"
function createWhenTs(err, params) {
  return params.typescript ? true : false
}

const handler = {
  '/global.d.ts': createWhenTs,
  '/tsconfig.json': createWhenTs,
}

module.exports = { handler }
```

#### basePageFiles 字段

basePageFiles 告诉 CLI，当用户使用 `taro create` 命令创建页面时，创建以下文件。

##### 例子

结合 handler 字段，创建新页面。

当用户使用命令 `taro create --page=detail` 时，会创建 **/src/pages/detail/detail.jsx** 与 **/src/pages/detail/detail.css** 两个文件。

```js title="template_creator.js"
const path = require('path')

function normalizePath (path) {
  return path.replace(/\\/g, '/').replace(/\/{2,}/g, '/')
}

const handler = {
  '/src/pages/index/index.jsx' (err, { pageName = '', pageDir = '', subPkg = '' }) {
    return {
      setPageName: normalizePath(path.join(PAGES_ENTRY, pageDir, pageName, 'index.jsx')),
      setSubPkgName: normalizePath(path.join(SOURCE_ENTRY, subPkg, pageDir, pageName, 'index.jsx'))
    }
  },
  '/src/pages/index/index.css' (err, { pageName = '', pageDir = '', subPkg = '' }) {
    return {
      setPageName: normalizePath(path.join(PAGES_ENTRY, pageDir, pageName, 'index.css')),
      setSubPkgName: normalizePath(path.join(SOURCE_ENTRY, subPkg, pageDir, pageName, 'index.css'))
    }
  },
}

const basePageFiles = ['/src/pages/index/index.jsx', '/src/pages/index/index.css']

module.exports = {
  handler,
  basePageFiles,
}
```

### compiler 字段

:::info
Taro v4.0.0+ 开始支持
:::

compiler 告诉 cli 当前模版支持的编译器类型，该值是一个 `string[]`，目前 taro 支持的编译器类型有 `Webpack4、Webpack5、Vite`
</file>

<file path="docs/treasures.md">
---
title: 社区优质物料
---

本篇收录了社区在 [Taro 物料市场](https://taro-ext.jd.com) 贡献的各种优质物料。

注意：平台支持度没有打 `✔️` 的，意思是尚未验证，不代表完全不支持。

#### 如何贡献

欢迎各位开发者为 Taro 社区贡献物料。可以通过以下步骤进行贡献、引流、讨论，共同成长：

1. 提交物料到 [Taro 物料市场](https://taro-ext.jd.com/)，并提供完善的文档。
2. 修改本文档，为物料添加说明。
3. 在 [Taro 讨论组](https://github.com/NervJS/taro/discussions/categories/%E7%94%9F%E6%80%81) 添加一条讨论，与开发者进行沟通。

## 模板项目

---

### 网易云音乐小程序

`React`

🎉 基于 Taro + Taro UI + Redux + React Hooks + Typescript 开发的网易云音乐小程序。

@lsqy 出品。【[Github](https://github.com/lsqy/taro-music/tree/feature_upgrade_taro3.0)】

<img src="https://storage.360buyimg.com/cjj-pub-images/taro-music.png" width="700px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### nice-router-taro

`React`

nice-router 第 0 适合后端程序员的前端小程序开发框架。

@kala888 出品。【[Github](https://github.com/kala888/nice-router-taro)】

<img src="https://storage.360buyimg.com/cjj-pub-images/taro-route.webp" width="400px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### 小溪里博客小程序

`React`

小溪里博客小程序。基于 Taro 3.3+，使用 HTML 标签开发。

@shenghanqin 出品。【[Github](https://github.com/hi-our/hi-blog-taro/)】

<img src="https://storage.360buyimg.com/cjj-pub-images/taro-xxl-blog1.png" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### 房贷计算器

`React`

首个 Taro 3 多端统一实例 - 支持 React Native，Weapp，H5。

58 同城团队出品。【[Github](https://github.com/wuba/Taro-Mortgage-Calculator)】

<img src="https://storage.360buyimg.com/cjj-pub-images/taro-fdjsq.png" width="700px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      | ✔️  | ✔️  |

---

### 《瑞克和莫蒂》Wiki

`React`

基于 Taro3.2+ 的多端统一项目。在这里可以查看几乎所有在《瑞克和莫蒂》中出现的人物，外加专为铁粉准备的小游戏。

@ 出品。【[Github](https://github.com/rick-and-morty-wiki/rick-and-morty-wiki)】

<img src="https://storage.360buyimg.com/cjj-pub-images/taro-mr-wiki.png" width="700px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      | ✔️  | ✔️  |

---

### 南歌文化电子票销售小程序

`React`

基于 Taro 3.0.27 的开发的电子票（景点、餐饮、夜店）销售小程序，使用了 React + React Hooks + TypeScript + React-Redux。

@sskcal 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/605447970ed19502489d719e)】【[Github](https://github.com/sskcal/ng-small_proground_taro)】

<img src="https://img10.360buyimg.com/img/jfs/t1/166374/28/13744/217757/605447b5Eae1de603/b036e697f1c742e9.jpg!q60.webp" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### 微信小程序每日工作量

`Vue`

记录每日工作量，统计日工资，月工资。

@whyour 出品。【[Github](https://github.com/whyour/mini-work)】

<img src="https://storage.360buyimg.com/cjj-pub-images/taro-daily.jpeg" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  | ✔️  |

---

### niceup

`React`

这是一款针对自媒体从业者专门开发的微信团购小程序。

@nasawz 出品。【[Github](https://github.com/nasawz/niceup)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### taro-mall

`React`

Taro_Mall 是一款多端开源在线商城应用程序，后台是基于 litemall 基础上进行开发，前端采用 Taro 框架编写，现已全部完成小程序和 H5 移动端，后续会对 APP，淘宝，头条，百度小程序进行适配。Taro_Mall 已经完成了 litemall 前端的所有功能。

@jiechud 出品。【[Github](https://github.com/jiechud/taro-mall)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### Vue3 + TS 快速开发模板

`Vue3`

基于 Taro 3.x & Vue 3 & TypeScript 的快速开发模板。

@RealCoolSnow 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5fd8732f65befdc26fa98f2a)】【[Github](https://github.com/RealCoolSnow/taro-quick-start)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  |     |

---

### React + Dva + Less 模板

`React`

这是一份基于 Taro 3.x 的模版。 - DvaJS - Taro - Less - React。

@hocgin 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5fced04b0f9312af84eaf3a6)】【[Github](https://github.com/hocgin/taro-starter)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  |     |

---

### elf-taro

`React`

Taro 小程序 脚手架 (Taro 3 + Dva + Typescript + Immer) - 内置 Redux 计数器, 异步数据请求 与 腾讯小程序地图 demo。

@didilinkin 出品。【[Github](https://github.com/didilinkin/elf-taro)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### taro-kit

`React`

Taro 小程序脚手架。 特性： 封装 api、redux 优雅集成、生成海报类，异常日志上报。

@wsdo 出品。【[Github](https://github.com/wsdo/taro-kit)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

## 样式库

### NutUI

`Vue3`

支持多端开发的 Vue 组件库

@jdf2e 出品。【[官网](https://nutui.jd.com/#/)】【[Github](https://github.com/jdf2e/nutui)】

<img src="https://img13.360buyimg.com/imagetools/jfs/t1/222418/40/22573/338132/63bcc1e5Ff4cbffd2/412f9667b2b57333.png" width="700px" />

|        | 微信 | 京东 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |  ✔️  |   ✔️   |      |      | ✔️  |     |

---

### taro-ui-vue

`Vue`

Taro UI 的 Vue 实现。

@psaren 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5f26b507bd510d60dd72a3cb)】【[Github](https://github.com/psaren/taro-ui-vue)】

<img src="https://img10.360buyimg.com/img/jfs/t1/123869/18/8595/1210587/5f26b3fdE5649bb68/b73745d66b1189c3.png.webp" width="700px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      | ✔️  |     |

---

### taro-ui-vue3

`Vue3`

采用 Vue 3.0 重写的 Taro UI 组件库。

@b2nil 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5f9158b66ea29204c27aca46)】【[Github](https://github.com/b2nil/taro-ui-vue3.git)】

<img src="https://img13.360buyimg.com/img/jfs/t1/144940/30/11635/67759/5f915841Ef43483ca/bccc3b0cde141d93.jpg!q40.webp" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  |     |

---

### Taroify

`React`

Taroify 是移动端组件库 Vant 的 Taro 版本，两者基于相同的视觉规范，提供一致的 API 接口，助力开发者快速搭建小程序应用。

[@Taroify](https://github.com/mallfoundry) 出品。【[物料详情](https://taroify.github.io/taroify.com/introduce/)】【[Github](https://github.com/mallfoundry/taroify)】

<img src="https://storage.360buyimg.com/cjj-pub-images/WX20210705-155124.png" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  |     |

---

### taro-color-ui

`React`

本项目基于 ColorUI 封装了一些常用的组件，无需下载 ColorUI 的 demo 查看各种实现的 classname， 减少手动将 demo 中的 wxml 书写格式改写为 Taro jsx 格式 等一系列烦琐的工作， 可以直接使用 jsx 组件的方式使用，支持按需导入样式。

@Gengar-666 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5f895a216ea29204c27ac9e7)】【[Github](https://github.com/Gengar-666/taro-color-ui)】

<img src="https://img14.360buyimg.com/img/jfs/t1/126061/34/15236/86720/5f8958e5E0360ec79/b37731e0f77e8621.jpg!q40.webp" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  |     |     |

---

### @antmjs/vantui

`React`

@antmjs/vantui 是一款基于 vant 开发的 React / Taro-React 多端 UI 组件库。

[@antmjs](https://github.com/AntmJS) 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/6183a65b89dfc6bef5d5a88e)】【[Github](https://github.com/AntmJS/vantui)】

<img src="https://img30.360buyimg.com/img/jfs/t1/136536/19/21123/599490/6183a34bE2b06216c/0b9557af04c325d1.png.webp" width="700px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  |     |

---

### Tard

`React`

Tard 是一套基于 Taro 框架开发的多端 React UI 组件库。

@jd-antelope 出品。【[物料详情](https://tard-ui.selling.cn/docs)】【[Github](https://github.com/jd-antelope/tard)】

<img src="https://storage.360buyimg.com/hawley-common/tard-home.png" width="700px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  |     |

---

## 插件

---

### 编译提速插件

采用**多核心**和**缓存**提升 Taro 编译打包速度。详情请阅读文章[《编写插件，将 Taro 编译打包耗时缩短至三分之一》](https://mp.weixin.qq.com/s/Z79QhAlP8tBQn3mXQ11byQ)。

智行小程序团队出品。【[Github](https://github.com/CANntyield/taro-plugin-compiler-optimization)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  |     |

---

### 骨架屏插件

让你的 Taro3 页面更流畅，Taro page 初始化 `setData()` 需要传递一个比较大的数据，导致初始化页面时会一段白屏的时间，该插件可以解决这个问题。

@allen-hu-666 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/602f7accca9e81834dd689d1)】【[Github](https://github.com/allen-hu-666/taro-tools/tree/master/packages/taro-plugin-skeleton)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  |     |     |

---

### tailwindcss 插件

Taro 接入 tailwindcss 2.0 插件。

@pcdotfan 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5fbb3a0799370e09266e2d68)】【[Github](https://github.com/pcdotfan/taro-plugin-tailwind)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  |     |

---

### 动态加载代码插件

`React`

基于 Taro 3.0+、webpack 插件、babel 的小程序端动态加载代码实现。

@JiyuShao 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/6049846a39b51f165cbfb0f4)】【[Github](https://github.com/JiyuShao/taro-dynamic-import-weapp)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### 命令行创建组件/页面插件

Taro 页面/组件创建工具，全部使用函数式组件 + Typescript + Hooks，提供良好的页面提示。

@liuhuapiaoyuan 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5f92de541c9f2000d7e02978)】【[Github](https://github.com/liuhuapiaoyuan/tarojs-plugin-generator)】

<img src="https://img20.360buyimg.com/img/jfs/t1/145078/20/12034/12331/5f92de18Ea95a8e27/2040d1e6caf93698.png.webp" width="400px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  | ✔️  |

---

### 兼容 wsl 插件

打包内容(rsync)同步到 Windows 文件下,解决 wsl2 下(`\\wsl$`) 打包出的小程序文件直接从开发工具读会无法读取到的正确内容

@toknT 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5fe94f6e7684a858dfc230bd)】【[Github](https://github.com/toknT/taro-plugin-sync-in-wsl)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  | ✔️  |

---

### taro-plugin-pinia 支持使用 `Pinia` 进行状态管理

`Taro & vue3` 支持使用 `Pinia` 进行状态管理的插件

@keyding 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/61a58b5dc142e18d4eb2aa53)】【[Github](https://github.com/keyding/taro-plugin-pinia)】

<img src="https://img10.360buyimg.com/img/jfs/t1/211360/8/10989/54059/61a58addE90daf2a4/9b4fe1f143c7cc5d.png.webp" width="400px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  |     |

---

## 组件

---

### 虚拟列表

`React`

基于 Taro3 封装的虚拟列表组件，支持列表子节点不等高，白屏率比官方的要低，性能更好，使用方便简单。

携程团队出品。【[物料详情](https://taro-ext.jd.com/plugin/view/60bf31e23ac107d9df4685cb)】【[Github](https://github.com/tingyuxuan2302/taro3-virtual-list)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  |     |

---

### 商品双向联动列表

`React`

功能不受布局位置 和 内容数据的影响，全由 JS 动态计算获取的商品双向联动列表。

【[物料详情](https://taro-ext.jd.com/plugin/view/5edf005bbe897edf72b35ea8)】

<img src="https://img30.360buyimg.com/img/jfs/t1/123538/9/4451/56208/5edf003cE8709569c/6327fc64db8e24fa.png.webp" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  |     |

---

### 下拉式筛选菜单

`React`

商城，团购常用的下拉式筛选菜单，最多支持 3 级子菜单，支持多选/单选筛选。

【[物料详情](https://taro-ext.jd.com/plugin/view/5ee72c6c77568ff8a503f604)】

<img src="https://img30.360buyimg.com/img/jfs/t1/142021/38/694/16559/5ee72c66E8efb82b6/f8ee1db04bb869aa.png.webp" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  |     |

---

### 抽奖插件

`React` & `Vue`

🍧🍧🍧 基于 taro 实现的【大转盘 / 九宫格】抽奖插件，🎨 奖品 / 文字 / 图片 / 颜色 / 按钮均可配置，支持同步 / 异步抽奖，🎯 概率前 / 后端可控，可搭配 rpx 适配移动端。

@LuckDraw 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/601a62c67dbe7bb05d82a2e7)】【[Github](https://github.com/LuckDraw/taro-luck-draw)】

<img src="https://img10.360buyimg.com/img/jfs/t1/152098/39/17466/324186/601a62a6E8a7c429a/b055b66c95758fe7.png.webp" width="500px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      | ✔️  |     |

---

### 日历热力图

`React`

基于 Taro 的日历热力图，生成类似与 GitHub Contribution 统计图。

@Mayandev 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/606042d8b81d0a91b3c3b18f)】【[Github](https://github.com/Mayandev/taro-calendar-heatmap)】

<img src="https://img30.360buyimg.com/img/jfs/t1/167304/35/14985/239420/60603f17Eca5e7f5c/915f2637f3a8a0ec.png.webp" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### 弧形进度条

`React`

弧形进度条，单个模板。

【[物料详情](https://taro-ext.jd.com/plugin/view/5f93a0f11c9f2000d7e02980)】

<img src="https://img14.360buyimg.com/img/jfs/t1/151168/39/4150/7087/5f939fc3Eeda6e224/6734c149acf78c2f.png.webp" width="400px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### 手写签名

`React`

Taro 的手写签名库。

@yz1311 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5fd3378865befdc26fa98ee9)】【[Github](https://github.com/yz1311/taro-signature-pad.git)】

<img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gliuxzjhmsg309s0hsn1i.gif" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### 日期时间选择组件

`React`

基于 pickerView、pickerViewColumn 来自定义了一个选择器用于日期和时间在用一个组件中选择完成。项目使用 Taro 框架，也可实现类似微信提醒的时间选择器。

@jarbozhang 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5e5112e36f4478a443aa4f53)】【[Github](https://github.com/jarbozhang/taro-picker)】

<img src="https://img13.360buyimg.com/img/jfs/t1/116828/25/455/254392/5e8c9404E081319bd/72546c4cacea19fa.png.webp" width="700px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### wPicker

`React`

日期、时间、多级联动 picker。

【[物料详情](https://taro-ext.jd.com/plugin/view/5ed64276be897edf72b35dfc)】

<img src="https://img12.360buyimg.com/img/jfs/t1/111423/13/9031/83329/5ed6424dEadac5873/a54ebe3b7570f641.png.webp" width="500px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### 时间选择器

`React`

时间选择器。

【[物料详情](https://taro-ext.jd.com/plugin/view/5f9fd274b6669e4de3674abe)】

<img src="https://img12.360buyimg.com/img/jfs/t1/135857/38/14396/8002/5f9fce69E39ad90dd/96f817ce5f855753.png.webp" width="500px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### 日期选择器

`Vue`

用的 vue 开发，业务需求一个选择日期区间的组件，只能结合别人的手动弄一个，部分功能还没有完全调完，有空再完善

【[物料详情](https://taro-ext.jd.com/plugin/view/60b59b433ac107d9df468567)】

<img src="https://img13.360buyimg.com/img/jfs/t1/126764/20/19090/120002/60b599d8E78c64c0e/017240219a0d8ce5.png.webp" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### 多功能表格组件

`React`

基于 Taro3、React 的微信小程序端多功能表格组件。

@qxtang 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/604d7cde39b51f165cbfb11c)】【[Github](https://github.com/qxtang/taro3-table)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### echarts-taro3-react

`React`

基于 Taro3.x 版本构建的微信小程序 echarts 组件。

@Cecilxx 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5f648e4c0dd8313026e0942d)】【[Github](https://github.com/Cecilxx/echarts-taro3-react)】

<img src="https://img30.360buyimg.com/img/jfs/t1/146007/14/8952/85344/5f648e15E683990ec/78834506eafe001b.jpg!q40.webp" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### echarts-taro3-vue

`Vue`

Taro3.x-Vue 构建的微信小程序 echarts 组件。

@Cecilxx 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5f68a040f71392c040202fd7)】【[Github](https://github.com/Cecilxx/echarts-taro3-vue)】

<img src="https://img10.360buyimg.com/img/jfs/t1/130406/33/10494/85344/5f689fcfEa5f4b9c0/89359159e220a2e1.jpg!q40.webp" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### taro3-react-f2

`React`

Taro3 集成图表库 f2。

@tomalloc 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/609cc5d338335db454095655)】【[Github](https://github.com/tomalloc/taro-react-f2)】

<img src="https://img10.360buyimg.com/img/jfs/t1/179128/4/3810/53712/609cc4feEbce2eee9/c62ef4ccad69912f.png.webp" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |      |      |     |     |

---

### taro-vchart

`React`

Taro3 集成图表库 @visactor/vchart。

@visactor 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/6540cbacbbd619b5897f988b)】【[Github](https://github.com/VisActor/VChart)】【[使用教程](https://www.visactor.io/vchart/guide/tutorial_docs/Cross-terminal_and_Developer_Ecology/taro)】

<img src="https://img14.360buyimg.com/img/jfs/t1/182617/24/40933/352731/6540cadfF80121018/7a7dce74e748da36.png.webp" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |  ✔️  | ✔️  |     |

---

## 工具库

---

### taro-iconfont-cli

在 Taro 框架中使用 iconfont 图标，不依赖字体，支持多色彩。

@fwh1990 出品。【[Github](https://github.com/iconfont-cli/taro-iconfont-cli)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  |     |

---

### 长列表方案

`React`

Taro 框架长列表方案 ：集成下拉刷新、骨架屏、无限滚动、图片懒加载。

@Rahim-Chan 出品。【[Github](https://github.com/Rahim-Chan/taro-listview)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      | ✔️  |     |

---

### tarojs-router-next

Taro 小程序路由库/自动生成带参数类型提示的路由方法/允许传递任意类型、任意大小的参数数据/同步的路由方法调用/koa 体验一致的路由中间件。

@lblblong 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5f64832f0dd8313026e0942b)】【[Github](https://github.com/lblblong/tarojs-router-next)】

---

### vue-taro-router

`Vue`

基于 Taro，扩展成 vue-router 的使用体验。支持路由拦截、事件回调、链式调用。方法类型有：push、replace、goBack 等。

@kaeryehaowan 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/607f975f2ae2b4ed20b8f289)】【[Github](https://github.com/kaeryehaowan/vue-taro-router)】

---

### Easy Taro Router

`React` & `Vue`

使用过 umi 框架的人，一定对它的约定式路由印象深刻。通过一系列配置，可以让你在 Taro 小程序中实现类似“约定式路由”的功能。

@LuckyHH 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5ff1345417b86f279e75ff7f)】【[Github](https://github.com/LuckyHH/generated-plugin-taro-router-service)】

---

### PreQuest

一款好用的小程序请求库。

@xdoer 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/60c751806be8e5ae7a8528b0)】【[Github](https://taro-ext.jd.com/plugin/view/60c751806be8e5ae7a8528b0)】

---

### taro-storage

扩展 taro 的存储，支持本地存储设置有效期，支持清除过期的本地存储。

@JosnLee 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5f14fed938dabd4991e19af4)】【[Github](https://github.com/JosnLee/taro-storage)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      |     |     |

---

### 百度语音

`React`

非常轻便的语音合成接口，一般用于对推送过来的消息进行语音播报。

【[物料详情](https://taro-ext.jd.com/plugin/view/5ed99ef0be897edf72b35e47)】

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  | ✔️  |

---

### taro-hooks

`React`

为 Taro 而设计的 Hooks Library。

@innocces 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/6119f3ba2dde82e17a3b8574)】【[Github](https://github.com/innocces/taro-hooks)】

<img src="https://cdn.jsdelivr.net/gh/innocces/DrawingBed/2021-8-15/1629041766989-taro-hooks-index.PNG" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |        |      |      | ✔️  | ✔️  |

---

## 其它

---

### 表单可视化编辑

`React`

使用 Taro3 开发的可视化表单编辑器，支持 H5、小程序（开发中）、app（开发中），可以将其集成在自己的前端项目用于表单构建，或者继承到后端用户表单编辑 在线预览：https://form.t.platelet.xyz/。

@ShaoGongBra 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5fe2f5f07684a858dfc2307f)】【[Github](https://github.com/ShaoGongBra/taro-form)】

<img src="https://img10.360buyimg.com/img/jfs/t1/144964/5/19729/164594/5fe2f583E1d09bd60/7e846811c2b77331.jpg!q60.webp" width="600px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  | ✔️  |

---

### taro-mobx-logger

`React`

让使用 Taro + Mobx 开发微信小程序获得更友好的状态调试。

@kevin-zeus 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/5efdae4a4004e5cc1a647f86)】【[Github](https://github.com/kevin-zeus/mobx-logger)】

<img src="https://img20.360buyimg.com/img/jfs/t1/117239/7/11405/50008/5efdae20Ee4023f86/c6e6c8647fda67ef.png.webp" width="500px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |  ✔️  |  ✔️  | ✔️  |     |

---

### @better-mini/logger

`React`

小程序真机调试/预览 Logger 组件，支持输出日志到屏幕进行查看，提升调试效率。 目前仅微信和支付宝端经过完整测试，其他端不一定支持。

@Fay98de 出品。【[物料详情](https://taro-ext.jd.com/plugin/view/608cf5741a9f428bbf572f7f)】【[Github](https://github.com/Fay98de/better-mini/tree/main/packages/logger)】

<img src="https://img10.360buyimg.com/img/jfs/t1/194492/34/753/264079/608cf553E5c1befa6/4e9de97729894fb3.png.webp" width="250px" />

|        | 微信 | 阿里系 | 百度 | 头条 | H5  | RN  |
| :----: | :--: | :----: | :--: | :--: | :-: | :-: |
| 支持度 |  ✔️  |   ✔️   |      |      |     |     |

---
</file>

<file path="docs/ui-lib.md">
---
title: 基于 Taro 开发第三方多端 UI 库
---

> 通过 Taro 提供的多端 UI 库打包能力，可以打包出一个多端运行的 UI 库，目前已经支持 微信/支付宝/百度小程序以及 H5，RN 端的支持还在调研中，示例项目 [taro-ui-sample](https://github.com/NervJS/taro-ui-sample)

## 多端 UI 库项目结构

多端 UI 库的项目目录结构与普通 Taro 项目基本一致，不同点如下

#### 增加一个 UI 库入口文件

> RN 端 `index.js` 已经被占用，如果要兼容 RN 端，需改为其他名字，并通过 `--ui-index`指定入口文件。

需要在 `src` 目录下添加 `index.js` 或者 `index.ts` 来作为 UI 库的入口文件，用于输出 UI 组件，如果有多个 UI 组件，可以如下书写

```javascript
export { default as A } from './components/A/A'
export { default as B } from './components/B/B'
```

这样的话，这个组件库使用起来，会是如下的方式

```javascript
import { A } from 'taro-ui-sample'

export default function Demo {
  return <A />
}
```

如果只有 UI 组件，也可以如下书写

```javascript
import A from './components/A/A'

export default A
```

这样的话，这个组件库使用起来，会是如下的方式

```javascript
import A from 'taro-ui-sample'

export default function Demo {
  return <A />
}
```

#### 配置文件改造

为了打包出可以在 H5 端使用的组件库，需要在 `config/index.js` 文件中增加一些配置

```javascript
if (process.env.TARO_BUILD_TYPE === 'ui') {
  Object.assign(config.h5, {
    enableSourceMap: false,
    enableExtract: false,
    enableDll: false,
  })
  config.h5.webpackChain = (chain) => {
    chain.plugins.delete('htmlWebpackPlugin')
    chain.plugins.delete('addAssetHtmlWebpackPlugin')
    chain.merge({
      output: {
        path: path.join(process.cwd(), 'dist', 'h5'),
        filename: 'index.js',
        libraryTarget: 'umd',
        library: 'taro-ui-sample',
      },
      externals: {
        nervjs: 'commonjs2 nervjs',
        classnames: 'commonjs2 classnames',
        '@tarojs/components': 'commonjs2 @tarojs/components',
        '@tarojs/taro-h5': 'commonjs2 @tarojs/taro-h5',
        weui: 'commonjs2 weui',
      },
    })
  }
}
```

以上配置可以根据需要自行修改。

## 打包命令

在完成以上项目结构改造后，你就可以获得一个 Taro 的多端 UI 库的项目了

这时候你可以通过如下命令来进行打包

```bash
$ TARO_BUILD_TYPE=ui taro build --ui --ui-index=${CUSTOM_ENTRY}
```

只有当 UI 库入口文件非 `index.js` 时，才需要通过 `--ui-index`指定入口文件，其中 `CUSTOM_ENTRY` 为自定义的 UI 库入口文件。

打包之后的文件在 `dist` 目录下

里面会包含一个 `index.js` 的入口文件，内容如下，需要注意的是，这个内容是 Taro 自动生成的，不可修改

```javascript
if (process.env.TARO_ENV === 'h5') {
  module.exports = require('./h5/index')
  module.exports.default = module.exports
} else {
  module.exports = require('./weapp/index')
  module.exports.default = module.exports
}
```

H5 端以及小程序类（微信/支付宝/百度）的文件分别在 `h5` 和 `weapp` 目录下，通过入口文件就能在不同的端内进行引用

## 项目测试

推荐采用 [Jest](https://jestjs.io/) 进行测试，项目中已经包含了完整的测试配置与范例，可以直接使用，有以下值得注意的地方

#### 使用 babel-jest

转换器使用 `babel-jest`，为了配合 babel 7 进行使用，需要安装

```bash
$ yarn add --dev babel-jest babel-core@^7.0.0-bridge.0 @babel/core
```

其中 `babel-core@^7.0.0-bridge.0` 一定要安装

#### babel.config.js

由于测试使用了 babel 7，为了避免和 Taro 本身使用的 babel 冲突，测试使用的 babel 配置位于 `babel.config.js` 中
</file>

<file path="docs/use-h5.mdx">
---
title: 使用 HTML 标签
---

import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

> Taro v3.3+ 开始支持

多年以来 Web 端沉淀了大量优秀的库和组件，我们希望能直接在小程序端进行复用。此外，我们希望能减少 H5 应用迁移到小程序端的成本，甚至能够直接运行在小程序端。因此，自 v3.3 起支持使用 HTML 标签编写 Taro 应用。

## 使用方法

### 配置插件

1. 首先下载安装插件 `@tarojs/plugin-html`

```bash
yarn add @tarojs/plugin-html
```

2. 然后在项目配置中添加使用插件

```js
// config/index.js
config = {
  // ...
  plugins: ['@tarojs/plugin-html'],
}
```

### 示例代码

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx title="示例代码"
function Index() {
  return <div>Hello World!</div>
}
```

</TabItem>

<TabItem value="Vue">

```html title="示例代码"
<template>
  <div>Hello World!</div>
</template>
```

</TabItem>
</Tabs>

## 示例项目

- [taro-weui](https://github.com/NervJS/taro-weui)
- [taro-antd-mobile](https://github.com/NervJS/taro-antd-mobile)
- [taro-vant](https://github.com/NervJS/taro-vant)

## 样式相关问题

### 浏览器默认样式

Taro 提供了两种内置的浏览器默认样式，可以根据项目需要进行引入。

根据经验，在 Web 端的项目中常常会写一些样式去重置部分浏览器的默认样式，因此一般情况下开发者并不需要所有的这些默认样式。我们建议手动挑选项目需要的默认样式添加到全局样式中。

#### 1. HTML4

W3C HTML4 的内置样式。只有 HTML4 标签样式，体积较小，兼容性强，能适应大多数情况。

用法：

```js title="app.js"
import '@tarojs/taro/html.css'
```

#### 2. HTML5

Chrome(Blink) HTML5 的内置样式。内置样式丰富，包括了大多数 HTML5 标签，体积较大，不一定支持所有小程序容器。

用法：

```js title="app.js"
import '@tarojs/taro/html5.css'
```

### 第三方组件库的尺寸变小了一倍

Taro 默认会使用 `postcss` **把 px 按比例解析为 rpx**，详情请见 [《设计稿及尺寸单位》](/docs/size)。

但很多第三方 H5 组件库不需要解析 `px` 单位，用户可以配置 `@tarojs/plugin-html` 插件的 [pxtransformBlackList](use-h5#pxtransformblacklist) 选项进行过滤。

### `<span>` 默认表现为块级样式

`<span>` 是行内元素，本来需要映射为同样是行内元素的 `<Text>` 组件。

但小程序的 `<Text>` 组件有一个限制，它只能嵌套 `<Text>` 自身，嵌套 `<View>`、`<Image>` 等组件都会不显示。也就是说，如果 `<span>` 映射为 `<Text>`，`<span>` 只能嵌套同样映射为 `<Text>` 的 `<i>`、`<b>` 等行内元素。

但是我们在适配一些 H5 组件库的时候发现，`<span>` 里很可能会嵌套 `<div>`、`<img>` 等标签，用法十分多样。因此我们决定把 `<span>` 映射为 `<View>`，以兼容 H5 标签写法的多样性。

这样做的缺点是，开发者需要自行使用样式令 `<span>` 默认表现为行内样式：

```scss title="app.css"
// 方法一：只使用部分需要的浏览器默认样式
.h5-span {
  display: inline;
}

// 方法二：直接引入全套浏览器默认样式
import '@tarojs/taro/html.css';
```

至于 `<i>` 等行内标签还是默认映射为 `<Text>`。如果需要修改映射规则，可以配置 `@tarojs/plugin-html` 插件的 [modifyElements](use-h5#modifyelements) 选项。

### 不支持部分 CSS 选择器

在小程序中部分 CSS 选择器不会生效，如：

- 通配符 `*`
- 媒体查询
- 属性选择器，当属性不是对应小程序组件的内置属性时

### 不支持使用 rem

暂不支持 rem。

## 其它限制

HTML 标准和小程序标准存在着很大的差异，有一些 Taro 能够抹平，但仍有部分差异无法处理。

### 表单组件

HTML 标签和小程序组件两种规范之间，存在较大差异的部分主要是表单组件。

1. 在使用 `<input type='checkbox'>` 或 `<input type='radio'>` 时，需要手动补充 `<CheckboxGroup>`、`<RadioGroup>` 组件。
2. HTML 使用 `<select>` + `<option>` 实现选择器，而小程序使用 `<Picker>`。两者差异巨大，因此不作映射。当用户使用了 `<select>` 时，会提示用户直接使用 `<Picker>` 组件。

### 不能同步获取元素尺寸

在 H5 中我们可以调用 DOM API **同步**获取元素的尺寸：

```js title="h5"
const el = document.getElementById('#inner')
const res = el.getBoundingClientRect()
console.log(res)
```

但是在小程序中，获取元素尺寸的 API 是**异步**的：

```js title="小程序"
const query = Taro.createSelectorQuery()
query
  .select('#inner')
  .boundingClientRect()
  .exec((res) => {
    console.log(res)
  })
```

因此 Taro 提供了这些 API 的异步版本，如 `getBoundingClientRect`。（如有遗漏，可以提交 [Issues](https://issue.taro.zone/) 让官方进行补充）

```js title="Taro"
const el = document.getElementById('#inner')
const res = await el.getBoundingClientRect()
console.log(res)
```

### DOM API 差异

`canvas`、`video`、`audio` 等元素在 H5 端可以直接调用 `HTMLElement` 上的方法。

```js title="h5"
const el = document.getElementById('myVideo')
el.play()
```

但是在 Taro 中，要调用组件上的原生方法，必须先创建对应的 `Context`：

```js title="小程序"
const ctx = Taro.createVideoContext('myVideo')
ctx.play()
```

### `<img>` 图片尺寸问题

在 H5 中，不设置 `<img>` 的宽高时，浏览器会使用原图的宽高作为标签的宽高。

而在小程序中，不设置 `<Image>` 的宽高时，会使用默认样式中规定的宽高。

解决办法：用户在使用 `<img>` 时必须显式设置它的宽高。

### 不支持 ReactDOM 部分 API

Taro 使用 **React Reconciler** 实现了自定义的渲染器，相对于 ReactDOM 来说功能十分精简。

因此部分基于 ReactDOM 实现的 H5 组件会无法使用，如使用了：`unstable_renderSubtreeIntoContainer`。

### 不支持 React `Portal`

### 不支持 Vue3 `Teleport`

### 不支持使用 SVG

暂不支持使用 SVG。

## 插件配置项

### pxtransformBlackList

`regexp array`

命中数组中任意正则表达式的类名选择器，其样式声明块中的 `px` 单位不会被 Taro 解析。

用法：

```js title="config/index.js"
config = {
  plugins: [
    [
      '@tarojs/plugin-html',
      {
        // 包含 `demo-`、`van-` 的类名选择器中的 px 单位不会被解析
        pxtransformBlackList: [/demo-/, /van-/],
      },
    ],
  ],
}
```

### modifyElements

`function`

修改普通块级元素和行内元素的映射规则。

用法：

```ts title="config/index.js"
config = {
  plugins: [
    [
      '@tarojs/plugin-html',
      {
        modifyElements(inline: string[], block: string[]) {
          // 行内元素增加 <xxx>
          inline.push('xxx')
          // 行内元素添加 <span>，块级元素删除 <span>
          inline.push('span')
          block.splice(block.indexOf('span'), 1)
        },
      },
    ],
  ],
}
```

### enableSizeAPIs

`boolean`

默认值：`true`

设置是否能够使用 H5 同步获取元素尺寸的 API 的 异步版本，如 `getBoundingClientRect`。

用法：

```js title="config/index.js"
config = {
  plugins: [
    [
      '@tarojs/plugin-html',
      {
        // 这些异步 API 的代码将会从运行时代码中删除
        enableSizeAPIs: false,
      },
    ],
  ],
}
```

## 插件 postcss 配置项

`@tarojs/plugin-html` 会启用 postcss 插件：`postcss-html-transform` 对样式进行一些处理，例如去除 `*` 选择符等。以下是 `postcss-html-transform` 的一些配置项：

### removeCursorStyle

:::info
Taro v3.4.3 开始支持。
:::

`boolean`

默认值：`true`

设置是否去除 `cursor` 相关样式。

用法：

```js title="config/index.js" {6-9}
config = {
  // ...
  mini: {
    // ...
    postcss: {
      htmltransform: {
        enable: true,
        config: {
          removeCursorStyle: false,
        },
      },
    },
  },
}
```

## 详细设计

RFC 文档：[《0004-rendering-html》](https://github.com/NervJS/taro-rfcs/blob/html-support/rfcs/0004-rendering-html.md)

## 附录

### 一、标签名映射规则

| HTML 标签              | 小程序组件 |
| :--------------------- | :--------- |
| 块级标签               | view       |
| 内联标签               | text       |
| span                   | view       |
| img                    | image      |
| a                      | navigator  |
| a["href=javascript;"]  | view       |
| input                  | input      |
| input["type=checkbox"] | checkbox   |
| input["type=radio"]    | radio      |
| button                 | button     |
| textarea               | textarea   |
| progress               | progress   |
| label                  | label      |
| form                   | form       |
| audio                  | audio      |
| canvas                 | canvas     |
| video                  | video      |
| iframe                 | web-view   |
| slot                   | slot       |

### 二、属性名映射规则

#### 1. HTML `<a>` 标签

| `<a>` 属性 | `<Navigator>` 属性 |
| :--------- | :----------------- |
| href       | url                |
| target     | openType           |

1.1 `<a>` 标签的 `target` 属性值对应关系：

| `a[target]` 属性值 | `Navigator[open-type]` 属性值 |
| :----------------- | :---------------------------- |
| \_blank            | navigate                      |
| \_self             | redirect                      |

#### 2. HTML `<input>` 标签

| `<input>` 属性 | `<Input>` 属性 |
| :------------- | :------------- |
| autofocus      | focus          |
| readonly       | disabled       |

2.1 `<input>` 标签的 `type` 属性值对应关系：

| `input[type]` 属性值   | `Input[type]` 属性值   |
| :--------------------- | :--------------------- |
| tel                    | number                 |
| `input[type=password]` | `input[password=true]` |

#### 3. HTML `<textarea>` 标签

| `<textarea>` 属性 | `<Textarea>` 属性 |
| :---------------- | :---------------- |
| autofocus         | focus             |
| readonly          | disabled          |

#### 4. HTML `<progress>` 标签

| `<progress>` 属性  | `<Progress>` 属性 |
| :----------------- | :---------------- |
| value / max \* 100 | precent           |

#### 5. HTML `<button>` 标签的 `type` 属性值对应关系

| `button[type]`        | `Button[form-type]`        |
| :-------------------- | :------------------------- |
| `button[type=submit]` | `Button[form-type=submit]` |
| `button[type=reset]`  | `Button[form-type=reset]`  |

### 三、事件映射规则

#### 1. 通用规则

| HTML 事件 | 小程序组件事件 |
| :-------- | :------------- |
| click     | tap            |

#### 2. HTML `<input>` 标签

| `<input>` 事件 | `<Input>` 事件 |
| :------------- | :------------- |
| onChange       | onInput        |
| keypress       | onConfirm      |

#### 2. HTML checkbox 控件

| `input[type=checkbox]` 事件 | `<Checkbox>` 事件 |
| :-------------------------- | :---------------- |
| onChange                    | bindtap           |

#### 3. HTML radio 控件

| `input[type=radio]` 事件 | `<Radio>` 事件 |
| :----------------------- | :------------- |
| onChange                 | bindtap        |
</file>

<file path="docs/vant.mdx">
---
title: 使用 Vant Weapp
---

import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

Taro3 支持使用 [Vant Weapp](https://youzan.github.io/vant-weapp/#/intro) 组件库进行开发，示例仓库：[taro3-vant-sample](https://github.com/NervJS/taro3-vant-sample)。

> 注意：使用原生第三方组件库进行开发的项目，**不再具有多端转换的能力**。
>
> **[Taroify](https://github.com/mallfoundry/taroify)** 是移动端组件库 Vant 的 Taro 版本，两者基于相同的视觉规范，提供一致的 API 接口，助力开发者快速搭建小程序应用。
>
> 但是，如果你想使用 Vant Weapp 又想拥有多端转换的能力，强烈推荐 Vant Weapp 社区衍生库 **[@antmjs/vantui](https://github.com/AntmJS/vantui)**， 它是基于 Vant Weapp 开发的多端组件库，同时支持 Taro 和 React。拥有 Taro 多端转换的能力，同时和 Vant Weapp 的 UI 和 API 高度保持一致。

## 使用方法

### 配置忽略 vant 的样式尺寸转换

如果直接使用 vant 组件，会发现样式偏小的情况，这是因为 Taro 默认将 vant 的样式尺寸从 **px** 转换为了 **rpx**，可以通过配置 [selectorblacklist](/docs/size#selectorblacklist) 来禁止转换。

配置方法：

```js title="config/index.js"
const config = {
  // ...
  mini: {
    postcss: {
      pxtransform: {
        enable: true,
        config: {
          selectorBlackList: [/van-/],
        },
      },
    },
  },
}
```

### 配置 copy 小程序原生文件

vant 组件中包含一些小程序原生文件的依赖，目前 Taro 没有对这些依赖进行分析。因此需要配置 `copy` 把这些依赖移动到 `dist` 目录中，例如需要 copy `wxs` 和样式文件，部分配置如下

```js title="config/index.js"
const config = {
  // ...
  copy: {
    patterns: [
      { from: 'src/components/vant-weapp/dist/wxs', to: 'dist/components/vant-weapp/dist/wxs' },
      { from: 'src/components/vant-weapp/dist/common/style', to: 'dist/components/vant-weapp/dist/common/style' },
      {
        from: 'src/components/vant-weapp/dist/common/index.wxss',
        to: 'dist/components/vant-weapp/dist/common/index.wxss',
      },
      {
        from: 'src/components/vant-weapp/dist/calendar/index.wxs',
        to: 'dist/components/vant-weapp/dist/calendar/index.wxs',
      },
      {
        from: 'src/components/vant-weapp/dist/calendar/utils.wxs',
        to: 'dist/components/vant-weapp/dist/calendar/utils.wxs',
      },
      {
        from: 'src/components/vant-weapp/dist/calendar/calendar.wxml',
        to: 'dist/components/vant-weapp/dist/calendar/calendar.wxml',
      },
      {
        from: 'src/components/vant-weapp/dist/calendar/components/month/index.wxs',
        to: 'dist/components/vant-weapp/dist/calendar/components/month/index.wxs',
      },
    ],
    options: {},
  },
}
```

### 引用 vant 组件

首先需要在 **app 的 config** 或**页面的 config** 文件中配置 `usingComponents` 字段，如：

```js
export default {
  navigationBarTitleText: '首页',
  usingComponents: {
    'van-button': '../../components/vant-weapp/dist/button/index',
  },
}
```

然后在页面中便可以直接使用。

### 使用 vant 组件

#### 1. 绑定属性

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx
import React, { Component } from 'react'
import { View } from '@tarojs/components'

export default class Index extends Component {
  render() {
    return (
      <View>
        <van-button type="primary" loading loading-text="ing">
          Button
        </van-button>
      </View>
    )
  }
}
```

</TabItem>

<TabItem value="Vue">

```html
<template>
  <view>
    <van-button type="primary" :loading="true" loading-text="ing">Button</van-button>
  </view>
</template>

<script>
  export default {
    name: 'index',
  }
</script>
```

</TabItem>
</Tabs>

> 注意：如果组件的某些属性在 vant 文档里写着带有默认值 `true`，在 Taro 中使用时仍然需要**显式设置为 true**。

#### 2. 绑定事件

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx
import React, { Component } from 'react'
import { View } from '@tarojs/components'

export default class Index extends Component {
  handleClick = () => {
    console.log('click')
  }

  onAfterRead = (res) => {
    console.log(res)
  }

  render() {
    return (
      <View>
        // 对应 bind:click 事件
        <van-button type="primary" onClick={this.handleClick}>
          Button
        </van-button>
        // 对应 bind:after-read 事件
        <van-uploader fileList={[]} onAfterRead={this.onAfterRead} />
      </View>
    )
  }
}
```

</TabItem>

<TabItem value="Vue">

```html
<template>
  <view>
    <van-button type="primary" @click="handleClick">Button</van-button>
    <van-uploader :fileList="[]" @after-read="onAfterRead" />
  </view>
</template>

<script>
  export default {
    methods: {
      handleClick() {
        console.log('click')
      },
      onAfterRead(res) {
        console.log(res)
      },
    },
  }
</script>
```

</TabItem>
</Tabs>

#### 3. Slot

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
  ]}>
<TabItem value="React">

```jsx
import React, { Component } from 'react'
import { View, Slot } from '@tarojs/components'

export default class Index extends Component {
  render() {
    return (
      <View>
        <van-calendar poppable show>
          <Slot name="title">
            <View>Hello world</View>
          </Slot>
        </van-calendar>
      </View>
    )
  }
}
```

</TabItem>

<TabItem value="Vue">

```html
<template>
  <view>
    <van-calendar :poppable="true" :show="true">
      <slot-view :name='"title"'>
        <view>Hello world</view>
      </slot-view>
    </van-calendar>
  </view>
</template>

<script>
  export default {
    name: 'index',
  }
</script>
```

</TabItem>
</Tabs>

### 处理 Vant 组件默认值失效的问题

> v1.0.2+ 开始支持，且需要 Taro v3.4.10+

在默认情况下，第三方自定义组件的属性会被编译为形如：`<van-empty image="{{i.image}}" />`。

这时自定义组件声明的默认值会失效（详情请浏览 [#11575](https://github.com/NervJS/taro/issues/11575)）。

```js
Component({
  props: {
    image: {
      type: String,
      value: 'default',
    },
  },
})
```

所以我们需要使用 [@tarojs/plugin-inject](https://github.com/NervJS/taro-plugin-inject/tree/v1.0.2#6-thirdpartycomponents) 为此属性增加默认值，把它编译为形如：`<van-empty image="{{i.image===undefined?'default':i.image}}" />`。

用法：

```js
const config = {
  plugins: [
    [
      '@tarojs/plugin-inject',
      {
        thirdPartyComponents: {
          // 为 `van-empty` 组件的 image 属性设置默认值 'default'
          'van-empty': {
            image: "'default'",
          },
        },
      },
    ],
  ],
}
```

## 常见问题

### Vue3

- [`readonly` 属性不生效](https://github.com/NervJS/taro/issues/10337#issuecomment-989641124)
- 传递函数类型的属性失败：[React 写法](https://github.com/NervJS/taro/issues/8495#issuecomment-1179526364)、[Vue3 写法](https://github.com/NervJS/taro/issues/10337#issuecomment-989834523)
</file>

<file path="docs/version.md">
---
title: Taro 版本说明
---

当前 Taro 已进入 3.x 时代，相较于 Taro 1/2 编译时架构，Taro 3 采用了重运行时的架构，让开发者可以获得完整的 React / Vue 等框架的开发体验。具体原理请参考 [《小程序跨框架开发的探索与实践》](https://mp.weixin.qq.com/s?__biz=MzU3NDkzMTI3MA==&mid=2247483770&idx=1&sn=ba2cdea5256e1c4e7bb513aa4c837834)。

### 最新版本

最新版本可在 [Taro Release](https://github.com/NervJS/taro/releases) 中查阅。

也可以在命令行输入命令查看：

```bash
npm info @tarojs/cli
```

### Taro 3.4

Taro 3.4 的主要改动是支持使用 Preact 和 Vue3.2 进行开发。

详情请参考 [《Taro 正式发布 3.4 版本 —— 全面支持 Preact 和 Vue3.2》](/blog/2022-01-20-Taro-3.4)。

### Taro 3.3

Taro 3.3 的主要改动是支持使用 HTML 标签进行开发。

详情请参考 [《Taro 3.3 alpha 发布：用 ant-design 开发小程序？》](/blog/2021-04-22-Taro-3.3-alpha)。

### Taro 3.2

Taro 3.2 新增了对 ReactNative 的支持。

详情请参考 [《Taro 3.2 版本正式发布：React Native 支持，王者归来》](/blog/2021-04-08-taro-3.2)。

### Taro 3.1

Taro 3.1 的主要改动是打造开放式架构，支持以插件的形式编译到任意小程序平台。

详情请参考 [《Taro 正式发布 3.1 版本》](/blog/2021-03-10-taro-3-1-lts)。

### Taro 1 / 2

如果你想使用 Taro 1/2，可以访问[文档版本](/versions)获得帮助。

### 版本信息

Taro 每个版本的详细发布信息可在 [Taro Release](https://github.com/NervJS/taro/releases) 中查阅。

### 开发计划

目前 Taro 团队的迭代重心在于 Taro 3，Taro 1 / 2 只会对重大问题进行修复，不会新增新特性。

Taro 每周会发布 **patch 版本**，进行小型特性新增和问题修复。

重大特性会首先通过 [Taro-RFC](https://github.com/NervJS/taro-rfcs) 进行公示与意见采集，然后经开发测试后，最终发布 **minor** 版本。

详细的开发计划可在 [Taro MileStones](https://github.com/NervJS/taro/milestones) 中查阅。

### 升级指南

如何从 Taro 1 / 2 升级到 Taro 3 请参考：[从旧版本迁移到 Taro Next](./migration)。

关于各版本间更详尽的迁移的指南请参考：[《Taro 版本升级权威指南》](/blog/2020-09-01-taro-versions)。

社区贡献的一键升级工具：[taro2-to-3](https://github.com/SyMind/taro2-to-3)，by @SyMind。
</file>

<file path="docs/virtual-list.mdx">
---
title: 长列表渲染（虚拟列表）
---

import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

在典型的 Taro 应用中，正常的列表渲染遵循以下的逻辑：

1. 生成或从远程加载数据
2. 把数据加入框架的响应式数据中
3. 框架使用 diff 算法或其它机制根据数据的不同尝试全量更新视图
4. Taro 运行时捕获框架的更新请求更新视图

如果按照此逻辑，当第一步我们生成或加载的数据量非常大时就可能会产生严重的性能问题，导致视图无法响应操作一段时间。为了解决这个问题，我们可以采用另一种方式：比起全量渲染数据生成的视图，可以只渲染**当前可视区域(visible viewport)**的视图，非可视区域的视图在用户滚动到可视区域再渲染：

![virtual-list](https://img20.360buyimg.com/ling/jfs/t1/125645/6/13305/50138/5f6aaaa4E2f20eba7/d70a2d2da2d68de1.jpg)

> 虚拟列表仅支持单列渲染，多列渲染请使用[虚拟瀑布流](./virtual-waterfall)组件。

## 示例

### 基础示例

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

在 React Like 框架中我们可以直接从 `@tarojs/components-advanced/dist/components/virtual-list` 引入虚拟列表（VirtualList）组件：

```js
import VirtualList from '@tarojs/components-advanced/dist/components/virtual-list'
```

一个最简单的长列表组件会像这样，`VirtualList` 的 6 个属性都是必填项：

```jsx
function buildData(offset = 0) {
  return Array(100)
    .fill(0)
    .map((_, i) => i + offset)
}

const Row = React.memo(({ id, index, data }) => {
  return (
    <View id={id} className={index % 2 ? 'ListItemOdd' : 'ListItemEven'}>
      Row {index} : {data[index]}
    </View>
  )
})

export default class Index extends Component {
  state = {
    data: buildData(0),
  }

  render() {
    const { data } = this.state
    const dataLen = data.length
    return (
      <VirtualList
        height={800} /* 列表的高度 */
        width="100%" /* 列表的宽度 */
        item={Row} /* 列表单项组件，这里只能传入一个组件 */
        itemData={data} /* 渲染列表的数据 */
        itemCount={dataLen} /* 渲染列表的长度 */
        itemSize={100} /* 列表单项的高度  */
      />
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

在 Vue 中使用虚拟列表，我们需要在入口文件声明使用：

```js
// app.js 入口文件
import Vue from 'vue'
import registerVirtualList from '@tarojs/components-advanced/dist/components/virtual-list'
// Note: 使用以下路径导出插件可以在 vue 中获得更好的类型支持
// import registerVirtualList from '@tarojs/components-advanced/dist/components/virtual-list/vue'

Vue.use(registerVirtualList)
```

一个最简单的长列表组件会像这样，`virtual-list` 的 6 个属性都是必填项：

```html
<! –– row.vue 单项组件 ––>
<template>
  <view :id="id" :class="index % 2 ? 'ListItemOdd' : 'ListItemEven'"> Row {{ index }} : {{ data[index] }} </view>
</template>

<script>
  export default {
    props: ['id', 'index', 'data'],
  }
</script>

<! –– page.vue 页面组件 ––>
<template>
  <virtual-list
    class="List"
    :height="500"
    :item-data="list"
    :item-count="list.length"
    :item-size="100"
    :item="Row"
    width="100%"
  />
</template>

<script>
  import { markRaw } from 'vue'
  import Row from './row.vue'

  function buildData(offset = 0) {
    return Array(100)
      .fill(0)
      .map((_, i) => i + offset)
  }

  export default {
    data() {
      return {
        Row: markRaw(Row),
        list: buildData(0),
      }
    },
  }
</script>
```
</TabItem>
</Tabs>

### 无限滚动

实现无限滚动也非常简单，我们只需要在列表滚动到底部时，往列表尾部追加数据即可：

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

```jsx
const Row = React.memo(({ id, index, data }) => {
  return (
    <View id={id} className={index % 2 ? 'ListItemOdd' : 'ListItemEven'}>
      Row {index} : {data[index]}
    </View>
  )
})

function buildData(offset = 0) {
  return Array(100)
    .fill(0)
    .map((_, i) => i + offset)
}

export default class Index extends Component {
  state = {
    data: buildData(0),
  }

  loading = false

  listReachBottom() {
    Taro.showLoading()
    // 如果 loading 与视图相关，那它就应该放在 `this.state` 里
    // 我们这里使用的是一个同步的 API 调用 loading，所以不需要
    this.loading = true
    setTimeout(() => {
      const { data } = this.state
      this.setState(
        {
          data: data.concat(buildData(data.length)),
        },
        () => {
          this.loading = false
          Taro.hideLoading()
        }
      )
    }, 1000)
  }

  render() {
    const { data } = this.state
    const dataLen = data.length
    const itemSize = 100
    return (
      <VirtualList
        className="List"
        height={500}
        item={Row}
        itemData={data}
        itemCount={dataLen}
        itemSize={itemSize}
        width="100%"
        onScroll={({ scrollDirection, scrollOffset }) => {
          if (
            // 避免重复加载数据
            !this.loading &&
            // 只有往前滚动我们才触发
            scrollDirection === 'forward' &&
            // 5 = (列表高度 / 单项列表高度)
            // 100 = 滚动提前加载量，可根据样式情况调整
            scrollOffset > (dataLen - 5) * itemSize + 100
          ) {
            this.listReachBottom()
          }
        }}
      />
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <virtual-list
    class="List"
    :height="500"
    :item-data="list"
    :item-count="dataLen"
    :item-size="itemHeight"
    :item="Row"
    width="100%"
    @scroll="onScroll"
  />
</template>

<script>
  import { markRaw } from 'vue'
  import Row from './row.vue'

  function buildData(offset = 0) {
    return Array(100)
      .fill(0)
      .map((_, i) => i + offset)
  }

  export default {
    data() {
      return {
        Row: markRaw(Row),
        list: buildData(0),
        loading: false,
        itemHeight: 100,
      }
    },
    computed: {
      dataLen() {
        return this.list.length
      },
    },
    methods: {
      listReachBottom() {
        Taro.showLoading()
        this.loading = true
        setTimeout(() => {
          const { data } = this.state
          this.setState(
            {
              data: data.concat(buildData(data.length)),
            },
            () => {
              this.loading = false
              Taro.hideLoading()
            }
          )
        }, 1000)
      },
      onScroll({ scrollDirection, scrollOffset }) {
        if (
          // 避免重复加载数据
          !this.loading &&
          // 只有往前滚动我们才触发
          scrollDirection === 'forward' &&
          // 5 = (列表高度 / 单项列表高度)
          // 100 = 滚动提前加载量，可根据样式情况调整
          scrollOffset > (this.dataLen - 5) * this.itemHeight + 100
        ) {
          this.listReachBottom()
        }
      },
    },
  }
</script>
```
</TabItem>
</Tabs>

## Props

### height

> **类型：** `number | string`

列表的高度。

> 3.6.10 及以下版本，当滚动方向为垂直时，`height` 必须为 `number` 类型。

### width

> **类型：** `number | string`

列表的宽度。

> 3.6.10 及以下版本，当滚动方向为水平时，`width` 必须为 `number` 类型。

### item (Required)

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

> **类型：** `ReactComponent` （原 children 参数）

推荐使用 `React.memo` 或 `React.PureComponent` 或使用 `shouldComponentUpdate()` 来优化此组件，避免不必要的渲染。

</TabItem>

<TabItem value="Vue">

> **类型：** `VueComponent`

推荐使用 `markRaw` 或使用 `shallowReactive` 来优化此组件。

</TabItem>
</Tabs>

将要渲染的列表单项组件。组件的 `props` 有 4 个属性：

- `id`: 单项的 ID，必须传入组件的 `id` 中
- `index`: 组件渲染数据的索引
- `data`: 组件渲染的数据，同虚拟瀑布流 `itemData`
- `isScrolling`: 组件是否正在滚动，当 `useIsScrolling` 值为 `true` 时返回布尔值，否则返回 `undefined`

### itemCount (Required)

> **类型：** `number`

列表的长度。

### itemData (Required)

> **类型：** `Array<any>`

渲染数据。

### itemSize (Required)

> **类型：** `number ｜ (index?: number, itemData?: Array<any>) => number`

列表单项的大小，垂直滚动时为高度，水平滚动时为宽度。

### unlimitedSize

> **类型：** `boolean`

解开高度列表单项大小限制，默认值使用: itemSize (请注意，初始高度与实际高度差异过大会导致隐患)。

### position

> **类型：** `'absolute' | 'relative' | 'brick'`

布局方式，默认采用 "absolute"

> - `absolute`：绝对定位布局模式，列表单项的位置由 `top` 和 `left` 决定
> - `relative`：相对定位布局模式，插入前置节点替代未显示单项的高度
> - `brick`：相对定位布局模式，未显示单项不移除，保留单项高度 (v3.6.10 及以下不支持)
>   - 相比 `relative` 模式 `brick` 模式占用节点更多会导致一定性能问题，但保留未显示单项节点可提升部分场景显示速度

#### layout

> **类型：** `'vertical' | 'horizontal'`; **默认值：** `'vertical'`

滚动方向。`vertical` 为垂直滚动，`horizontal` 为平行滚动。默认为 `vertical`。

### initialScrollOffset (Default: 0)

> **类型：** `number`

初始滚动偏移值。

- 水平滚动时，影响 `scrollLeft` 的值；
- 垂直滚动时，影响 `scrollTop` 的值。

### overscanCount (Default: 1)

> **类型：** `number`

在可视区域之外渲染的列表单项数量，值设置得越高，快速滚动时出现白屏的概率就越小，相应地，每次滚动的性能会变得越差。

### placeholderCount (Default: overscanCount)

> **类型：** `number`

在可视区域之外占位的列表单项数量，值设置得越高，快速滚动时出现白屏的概率就越小，相应地，每次滚动的性能会变得越差。

### upperThreshold (Default: 50)

> **类型：** `number`, v3.6.10 及以下不支持

距离顶部多远时触发 `onScrollToUpper` 函数，单位为 `px`

### lowerThreshold (Default: 50)

> **类型：** `number`, v3.6.10 及以下不支持

距离底部多远时触发 `onScrollToLower` 函数，单位为 `px`

### useIsScrolling

> **类型：** `boolean`

是否注入 `isScrolling` 属性到 `item` 组件。这个参数一般用于实现滚动骨架屏（或其它 placeholder） 时比较有用。

### enhanced (Default: false)

> **类型：** `boolean`

通过 ScrollViewContext 优化组件滚动性能

> 部分平台不支持，使用时请注意甄别

## Events

### scroll 事件

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

> `onScroll: Function`

</TabItem>

<TabItem value="Vue">

> `v-on:scroll: Function`

</TabItem>
</Tabs>

列表滚动时调用函数，函数的第一个参数为对象，由三个属性构成：

- `scrollDirection`，滚动方向，可能值为 `forward` 往前， `backward` 往后。
- `scrollOffset`，滚动距离
- `scrollUpdateWasRequested`, 当滚动是由 `scrollTo()` 或 `scrollToItem()` 调用时返回 `true`，否则返回 `false`

### onScrollNative

> **类型：** `Function` (原 scrollNative 参数)

调用平台原生的滚动监听函数。

> **Vue:**
>
> ```html
> <virtual-list
>   class="List"
>   :height="500"
>   :item-data="list"
>   :item-count="list.length"
>   :item-size="100"
>   :item="Row"
>   width="100%"
>   @scroll="onScroll"
>   @scroll-native="onScrollNative"
> />
> ```

### onScrollToUpper

> **类型：** `Function`, v3.6.10 及以下不支持

滚动到顶部时调用函数

### onScrollToLower

> **类型：** `Function`, v3.6.10 及以下不支持

滚动到底部时调用函数

## Slots & Components

### 列表插槽

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

#### renderTop

> **类型：** `ReactNode`

顶部区域

#### renderBottom

> **类型：** `ReactNode`

底部区域

</TabItem>
<TabItem value="Vue">

支持 `top`、`bottom` 两个插槽，分别对应顶部和底部区域

```html
<virtual-list class="List" :height="500" :item-data="list" :item-count="list.length" :item-size="100" :item="Row">
  <template #top>
    <view>top</view>
  </template>
  <template #bottom>
    <view>bottom</view>
  </template>
</virtual-list>
```

</TabItem>
</Tabs>

### outerElementType

列表外部容器组件类型。

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

> **类型：** `ReactElement`; **默认值：** `ScrollView`

</TabItem>
<TabItem value="Vue">

> **类型：** `string`; **默认值：** `'scroll-view'`

</TabItem>
</Tabs>

处于考虑适配小程序原因，不建议使用 `View` 替换 `ScrollView` 组件作为 `outerElementType`。

### innerElementType

列表内部容器组件类型`。

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

> **类型：** `ReactElement`; **默认值：** `View`

此容器的 `parentNode` 是 `ScrollView`，`childNodes` 是列表。

</TabItem>
<TabItem value="Vue">

> **类型：** `string`; **默认值：** `'view'`

此容器的 `parentNode` 是 `scroll-view`，`childNodes` 是列表。

</TabItem>
</Tabs>

### itemElementType

列表子节点容器组件类型。

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

> **类型：** `ReactElement`; **默认值：** `View`

</TabItem>
<TabItem value="Vue">

> **类型：** `string`; **默认值：** `'view'`

</TabItem>
</Tabs>

## Native Props

### 组件 ID

> `id: string`

根组件 ID，用于标识组件，不传入时会自动生成。

### 组件 CSS 类

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

> `className: string`

</TabItem>

<TabItem value="Vue">

> `class: string` (原 wclass 参数)

</TabItem>
</Tabs>

根组件 CSS 类。

### 组件 CSS 样式

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

> `style: Style`

</TabItem>

<TabItem value="Vue">

> `style: Style` (原 wstyle 参数)

</TabItem>
</Tabs>

根组件的 CSS 样式。

### 其它 `ScrollView` 参数

除了以上参数，所有 `ScrollView` 组件的参数都可以传入 `VirtualList` 组件，冲突时优先使用以上文档描述的参数。

## Methods

通过 `React.createRef()` 创建 ref，挂载到 `VirtualList` 上可以访问到 `VirtualList` 的内部方法：

```jsx
export default class Index extends Component {
  state = {
    data: buildData(0),
  }

  list = React.createRef()

  componentDidMount() {
    const list = this.list.current
    list.scrollTo()
    list.scrollToItem()
  }

  render() {
    const { data } = this.state
    const dataLen = data.length
    return (
      <VirtualList
        height={500} /* 列表的高度 */
        width="100%" /* 列表的宽度 */
        item={Row} /* 列表单项组件，这里只能传入一个组件 */
        itemData={threads} /* 渲染列表的数据 */
        itemCount={threads.length} /*  渲染列表的长度 */
        itemSize={100} /* 列表单项的高度  */
      />
    )
  }
}
```

### scrollTo

`(scrollOffset: number, enhanced?: boolean): void`

滚动到指定的地点。

> enhanced 默认为 props 传入的 enhanced 值。

### scrollToItem

`(index: number, align: string = "auto", enhanced?: boolean): void`

滚动到指定的条目。

第二参数 `align` 的值可能为：

- `auto`: 尽可能滚动距离最小保证条目在可视区域中，如果已经在可视区域，就不滚动
- `smart`: 条目如果已经在可视区域，就不滚动；如果有部分在可视区域，尽可能滚动距离最小保证条目在可视区域中；如果条目完全不在可视区域，那就滚动到条目在可视区域居中显示
- `center`: 让条目在可视区域居中显示
- `end`: 让条目在可视区域末尾显示
- `start`: 让条目在可视区域末尾显示

> enhanced 默认为 props 传入的 enhanced 值。

## 相关问题

- 在 `Vue3` 中使用虚拟列表需升级至 v3.6+ 版本
</file>

<file path="docs/virtual-waterfall.mdx">
---
title: 多列表渲染（虚拟瀑布流）
---

import { ReactIcon, VueIcon } from '@site/static/icons'
import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

与[虚拟列表](./virtual-list)原理一致，通过只渲染**当前可视区域(visible viewport)**的视图，可以极大程度提升多列表渲染时的性能。

> v3.6.10 及以下不支持。

## 示例

### 基础示例

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

在 React Like 框架中我们可以直接从 `@tarojs/components-advanced` 引入虚拟瀑布流（VirtualWaterfall）组件：

```js
import { VirtualWaterfall } from `@tarojs/components-advanced`
```

一个最简单的长列表组件会像这样，`VirtualWaterfall` 的 6 个属性都是必填项：

```jsx
function buildData(offset = 0) {
  return Array(100)
    .fill(0)
    .map((_, i) => i + offset)
}

const Row = React.memo(({ id, index, data }) => {
  return (
    <View id={id} className={index % 2 ? 'ListItemOdd' : 'ListItemEven'}>
      Row {index} : {data[index]}
    </View>
  )
})

export default class Index extends Component {
  state = {
    data: buildData(0),
  }

  render() {
    const { data } = this.state
    const dataLen = data.length
    return (
      <VirtualWaterfall
        height={800} /* 列表的高度 */
        width="100%" /* 列表的宽度 */
        item={Row} /* 列表单项组件，这里只能传入一个组件 */
        itemData={data} /* 渲染列表的数据 */
        itemCount={dataLen} /* 渲染列表的长度 */
        itemSize={100} /* 列表单项的高度  */
      />
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

在 Vue 中使用虚拟瀑布流，我们需要在入口文件声明使用：

```js
// app.js 入口文件
import Vue from 'vue'
import { VirtualWaterfall as registerVirtualWaterfall } from `@tarojs/components-advanced`
// Note: 使用以下路径导出插件可以在 vue 中获得更好的类型支持
// import registerVirtualWaterfall from '@tarojs/components-advanced/dist/components/virtual-waterfall/vue'

Vue.use(registerVirtualWaterfall)
```

一个最简单的长列表组件会像这样，`virtual-waterfall` 的 6 个属性都是必填项：

```html
<! –– row.vue 单项组件 ––>
<template>
  <view :id="id" :class="index % 2 ? 'ListItemOdd' : 'ListItemEven'"> Row {{ index }} : {{ data[index] }} </view>
</template>

<script>
  export default {
    props: ['id', 'index', 'data'],
  }
</script>

<! –– page.vue 页面组件 ––>
<template>
  <virtual-waterfall
    class="List"
    :height="500"
    :item-data="list"
    :item-count="list.length"
    :item-size="100"
    :item="Row"
    width="100%"
  />
</template>

<script>
  import { markRaw } from 'vue'
  import Row from './row.vue'

  function buildData(offset = 0) {
    return Array(100)
      .fill(0)
      .map((_, i) => i + offset)
  }

  export default {
    data() {
      return {
        Row: markRaw(Row),
        list: buildData(0),
      }
    },
  }
</script>
```
</TabItem>
</Tabs>

### 无限滚动

实现无限滚动也非常简单，我们只需要在列表滚动到底部时，往列表尾部追加数据即可：

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

```tsx
const Row = React.memo(({ id, index, data }) => {
  return (
    <View id={id} className={index % 2 ? 'ListItemOdd' : 'ListItemEven'}>
      Row {index} : {data[index]}
    </View>
  )
})

function buildData(offset = 0) {
  return Array(100)
    .fill(0)
    .map((_, i) => i + offset)
}

export default class Index extends Component {
  state = {
    data: buildData(0),
  }

  loading = false

  listReachBottom() {
    Taro.showLoading()
    // 如果 loading 与视图相关，那它就应该放在 `this.state` 里
    // 我们这里使用的是一个同步的 API 调用 loading，所以不需要
    this.loading = true
    setTimeout(() => {
      const { data } = this.state
      this.setState(
        {
          data: data.concat(buildData(data.length)),
        },
        () => {
          this.loading = false
          Taro.hideLoading()
        }
      )
    }, 1000)
  }

  render() {
    const { data } = this.state
    const dataLen = data.length
    const itemSize = 100
    return (
      <VirtualWaterfall
        className="List"
        height={500}
        item={Row}
        itemData={data}
        itemCount={dataLen}
        itemSize={itemSize}
        width="100%"
        onScroll={({ scrollDirection, scrollOffset }) => {
          if (
            // 避免重复加载数据
            !this.loading &&
            // 只有往前滚动我们才触发
            scrollDirection === 'forward' &&
            // 5 = (列表高度 / 单项列表高度)
            // 100 = 滚动提前加载量，可根据样式情况调整
            scrollOffset > (dataLen - 5) * itemSize + 100
          ) {
            this.listReachBottom()
          }
        }}
      />
    )
  }
}
```
</TabItem>
<TabItem value="Vue">

```html
<template>
  <virtual-waterfall
    class="List"
    :height="500"
    :item-data="list"
    :item-count="dataLen"
    :item-size="itemHeight"
    :item="Row"
    width="100%"
    @scroll="onScroll"
  />
</template>

<script>
  import { markRaw } from 'vue'
  import Row from './row.vue'

  function buildData(offset = 0) {
    return Array(100)
      .fill(0)
      .map((_, i) => i + offset)
  }

  export default {
    data() {
      return {
        Row: markRaw(Row),
        list: buildData(0),
        loading: false,
        itemHeight: 100,
      }
    },
    computed: {
      dataLen() {
        return this.list.length
      },
    },
    methods: {
      listReachBottom() {
        Taro.showLoading()
        this.loading = true
        setTimeout(() => {
          const { data } = this.state
          this.setState(
            {
              data: data.concat(buildData(data.length)),
            },
            () => {
              this.loading = false
              Taro.hideLoading()
            }
          )
        }, 1000)
      },
      onScroll({ scrollDirection, scrollOffset }) {
        if (
          // 避免重复加载数据
          !this.loading &&
          // 只有往前滚动我们才触发
          scrollDirection === 'forward' &&
          // 5 = (列表高度 / 单项列表高度)
          // 100 = 滚动提前加载量，可根据样式情况调整
          scrollOffset > (this.dataLen - 5) * this.itemHeight + 100
        ) {
          this.listReachBottom()
        }
      },
    },
  }
</script>
```
</TabItem>
</Tabs>

## Props

### column

> **类型：** `number`

瀑布流占用列数量，默认值依照 `width / columnWidth ||= 2` 计算。

### columnWidth

> **类型：** `number`

瀑布流单列宽度，默认值依照 `width / column` 计算。

### height

> **类型：** `number | string`

列表的高度。

### width

> **类型：** `number | string`

列表的宽度。

### item (Required)

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

> **类型：** `ReactComponent`

推荐使用 `React.memo` 或 `React.PureComponent` 或使用 `shouldComponentUpdate()` 来优化此组件，避免不必要的渲染。

</TabItem>

<TabItem value="Vue">

> **类型：** `VueComponent`

推荐使用 `markRaw` 或使用 `shallowReactive` 来优化此组件。

</TabItem>
</Tabs>

将要渲染的列表单项组件。组件的 `props` 有 4 个属性：

- `id`: 单项的 ID，必须传入组件的 `id` 中
- `index`: 组件渲染数据的索引
- `data`: 组件渲染的数据，同虚拟瀑布流 `itemData`
- `isScrolling`: 组件是否正在滚动，当 `useIsScrolling` 值为 `true` 时返回布尔值，否则返回 `undefined`

### itemCount (Required)

> **类型：** `number`

列表的长度。

### itemData (Required)

> **类型：** `Array<any>`

渲染数据。

### itemSize (Required)

> **类型：** `number ｜ (index?: number, itemData?: Array<any>) => number`

列表单项的大小。

### unlimitedSize

> **类型：** `boolean`

解开高度列表单项大小限制，默认值使用: itemSize (请注意，初始高度与实际高度差异过大会导致隐患)。

### position

> **类型：** `'absolute' | 'relative' | 'brick'`

布局方式，默认采用 "absolute"

> - `absolute`：绝对定位布局模式，列表单项的位置由 `top` 和 `left` 决定
> - `relative`：相对定位布局模式，插入前置节点替代未显示单项的高度
> - `brick`：相对定位布局模式，未显示单项不移除，保留单项高度
>   - 相比 `relative` 模式 `brick` 模式占用节点更多会导致一定性能问题，但保留未显示单项节点可提升部分场景显示速度

### initialScrollOffset (Default: 0)

> **类型：** `number`

初始滚动偏移值。

### overscanDistance (Default: 50)

> **类型：** `number`

在可视区域之外预渲染的距离，值设置得越高，快速滚动时出现白屏的概率就越小，相应地，每次滚动的性能会变得越差。

> 建议至少大于等于 itemSize 的最大值，但不要设置超过虚拟瀑布流高度。

### placeholderCount (Default: 0)

> **类型：** `number`

在可视区域之外占位的列表单项数量，值设置得越高，快速滚动时出现白屏的概率就越小，相应地，每次滚动的性能会变得越差。

### upperThreshold (Default: 50)

> **类型：** `number`

距离顶部多远时触发 `onScrollToUpper` 函数，单位为 `px`

### lowerThreshold (Default: 50)

> **类型：** `number`

距离底部多远时触发 `onScrollToLower` 函数，单位为 `px`

### useIsScrolling

> **类型：** `boolean`

是否注入 `isScrolling` 属性到 `item` 组件。这个参数一般用于实现滚动骨架屏（或其它 placeholder） 时比较有用。

### enhanced (Default: true)

> **类型：** `boolean`

通过 ScrollViewContext 优化组件滚动性能

> 部分平台不支持，使用时请注意甄别

## Events

### scroll 事件

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

> `onScroll: Function`

</TabItem>

<TabItem value="Vue">

> `v-on:scroll: Function`

</TabItem>
</Tabs>

列表滚动时调用函数，函数的第一个参数为对象，由三个属性构成：

- `scrollDirection`，滚动方向，可能值为 `forward` 往前， `backward` 往后。
- `scrollOffset`，滚动距离
- `scrollUpdateWasRequested`, 当滚动是由 `scrollTo()` 或 `scrollToItem()` 调用时返回 `true`，否则返回 `false`

### onScrollNative

> **类型：** `Function`

调用平台原生的滚动监听函数。

> **Vue:**
>
> ```html
> <virtual-waterfall
>   class="List"
>   :height="500"
>   :item-data="list"
>   :item-count="list.length"
>   :item-size="100"
>   :item="Row"
>   width="100%"
>   @scroll="onScroll"
>   @scroll-native="onScrollNative"
> />
> ```

### onScrollToUpper

> **类型：** `Function`

滚动到顶部时调用函数

### onScrollToLower

> **类型：** `Function`

滚动到底部时调用函数

## Slots & Components

### 列表插槽

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

#### renderTop

> **类型：** `ReactComponent<{ id: string }>`

顶部区域

#### renderBottom

> **类型：** `ReactComponent<{ id: string }>`

底部区域

</TabItem>
<TabItem value="Vue">

支持 `top`、`bottom` 两个插槽，分别对应顶部和底部区域

```html
<virtual-waterfall class="List" :height="500" :item-data="list" :item-count="list.length" :item-size="100" :item="Row">
  <template #top>
    <view>top</view>
  </template>
  <template #bottom>
    <view>bottom</view>
  </template>
</virtual-waterfall>
```

</TabItem>
</Tabs>

### outerElementType

列表外部容器组件类型。

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

> **类型：** `ReactElement`; **默认值：** `ScrollView`

</TabItem>
<TabItem value="Vue">

> **类型：** `string`; **默认值：** `'scroll-view'`

</TabItem>
</Tabs>

处于考虑适配小程序原因，不建议使用 `View` 替换 `ScrollView` 组件作为 `outerElementType`。

### innerElementType

列表内部容器组件类型`。

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

> **类型：** `ReactElement`; **默认值：** `View`

此容器的 `parentNode` 是 `ScrollView`，`childNodes` 是列表。

</TabItem>
<TabItem value="Vue">

> **类型：** `string`; **默认值：** `'view'`

此容器的 `parentNode` 是 `scroll-view`，`childNodes` 是列表。

</TabItem>
</Tabs>

### itemElementType

列表子节点容器组件类型。

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

> **类型：** `ReactElement`; **默认值：** `View`

</TabItem>
<TabItem value="Vue">

> **类型：** `string`; **默认值：** `'view'`

</TabItem>
</Tabs>

## Native Props

### 组件 ID

> `id: string`

根组件 ID，用于标识组件，不传入时会自动生成。

### 组件 CSS 类

<Tabs
  defaultValue="React"
  values={[
    {label: <ReactIcon />, value: 'React'},
    {label: <VueIcon />, value: 'Vue'}
]}>
<TabItem value="React">

> `className: string`

</TabItem>

<TabItem value="Vue">

> `class: string`

</TabItem>
</Tabs>

根组件 CSS 类。

### 组件 CSS 样式

> `style: Style`

根组件的 CSS 样式。

### 其它 `ScrollView` 参数

除了以上参数，所有 `ScrollView` 组件的参数都可以传入 `VirtualWaterfall` 组件，冲突时优先使用以上文档描述的参数。

## Methods

通过 `React.createRef()` 创建 ref，挂载到 `VirtualWaterfall` 上可以访问到 `VirtualWaterfall` 的内部方法：

```jsx
export default class Index extends Component {
  state = {
    data: buildData(0),
  }

  list = React.createRef()

  componentDidMount() {
    const list = this.list.current
    list.scrollTo()
    list.scrollToItem()
  }

  render() {
    const { data } = this.state
    const dataLen = data.length
    return (
      <VirtualWaterfall
        height={500} /* 列表的高度 */
        width="100%" /* 列表的宽度 */
        item={Row} /* 列表单项组件，这里只能传入一个组件 */
        itemData={threads} /* 渲染列表的数据 */
        itemCount={threads.length} /*  渲染列表的长度 */
        itemSize={100} /* 列表单项的高度  */
      />
    )
  }
}
```

### scrollTo

`(scrollOffset: number, enhanced?: boolean): void`

滚动到指定的地点。

> enhanced 默认为 props 传入的 enhanced 值。

### scrollToItem

`(index: number, align: string = "auto", enhanced?: boolean): void`

滚动到指定的条目。

第二参数 `align` 的值可能为：

- `auto`: 尽可能滚动距离最小保证条目在可视区域中，如果已经在可视区域，就不滚动
- `smart`: 条目如果已经在可视区域，就不滚动；如果有部分在可视区域，尽可能滚动距离最小保证条目在可视区域中；如果条目完全不在可视区域，那就滚动到条目在可视区域居中显示
- `center`: 让条目在可视区域居中显示
- `end`: 让条目在可视区域末尾显示
- `start`: 让条目在可视区域末尾显示

> enhanced 默认为 props 传入的 enhanced 值。
</file>

<file path="docs/vue-devtools.md">
---
title: Vue DevTools
---

:::note
Taro v3.3.2 开始支持。

暂不支持 Vue2。
:::

在开发小程序时可以使用 [Vue DevTools](https://devtools.vuejs.org/guide/installation.html)。

## 使用方法

### 1. 安装

在项目中安装 Taro 插件 `@tarojs/plugin-vue-devtools`：

```sh
$ yarn add --dev @tarojs/plugin-vue-devtools
```

### 2. 配置 Taro 插件

在 Taro 编译配置中配置使用 `@tarojs/plugin-vue-devtools`：

```js title="config/dev.js"
config = {
  plugins: ['@tarojs/plugin-vue-devtools'],
  // ...
}
```

### 3. 编译项目

```sh
$ taro build --type weapp --watch
```

## 插件参数

插件 `@tarojs/plugin-vue-devtools` 具有以下参数：

### enabled

`boolean`

默认值：`true`

控制是否连接 `vue-devtools`，开启后会注入 backend 的代码到开发者的应用中。

### hostname

`string`

默认值：`localhost`

当 localhost 不可用时，自定义 `taro` 连接 `vue-devtools` 的主机名，多用于局域网或远程调试时使用。

### port

`number`

默认值：`8098`

Vue DevTools 使用的 Websocket 端口。

## 注意事项

- 强制锁定了 `vue-devtools` 的版本，更新版本需要修改 `@tarojs/plugin-vue-devtools` 插件的代码。

另外，目前对 devtools 功能的支持不够全面，有些功能需要针对小程序环境魔改 backend 才能实现，欢迎共建～

- 支持元素高亮。

## 详细设计

详细设计请看 [RFC](https://github.com/NervJS/taro-rfcs/blob/master/rfcs/0006-vue-devtools.md)。
</file>

<file path="docs/vue-entry.mdx">
---
title: 入口组件
---

import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

每一个 Taro 应用都需要一个入口组件（Vue 组件）用来注册应用。入口文件默认是 `src` 目录下的 `app.js`。

在入口组件中我们可以设置全局状态或访问小程序入口实例的生命周期。

#### 注意：

1. 自 Taro v3.1 开始，Vue2 入口组件的写法有 **Breaking Changes**，详情请见 [3.1.0 发布信息](https://github.com/NervJS/taro/releases/tag/v3.1.0)。
2. 由于 Vue3 Global API 有变化（[0009-global-api-change](https://github.com/vuejs/rfcs/blob/master/active-rfcs/0009-global-api-change.md)），Vue3 的入口组件写法和 Vue2 不同。

## 代码示例

<Tabs
  defaultValue="vue"
  values={[
    {label: 'Vue2', value: 'vue'},
    {label: 'Vue3', value: 'vue3'}
  ]}>
<TabItem value="vue">

```js title="app.js"
import Vue from 'vue'
// 假设我们已经在 './store' 配置好了 vuex
import store from './store'

const App = {
  store,

  // 可以使用所有的 Vue 生命周期方法
  mounted() {},

  // 对应 onLaunch
  onLaunch() {},

  // 对应 onShow
  onShow(options) {},

  // 对应 onHide
  onHide() {},

  render(h) {
    // this.$slots.default 是将要会渲染的页面
    return h('block', this.$slots.default)
  },
}

export default App
```

</TabItem>

<TabItem value="vue3">

```jsx title="app.js"
import { createApp } from 'vue'

const app = createApp({
  // 可以使用所有的 Vue 生命周期方法
  mounted () {},

  // 对应 onLaunch
  onLaunch () {},

  // 对应 onShow
  onShow (options) {},

  // 对应 onHide
  onHide () {},

  // 入口组件不需要实现 render 方法，即使实现了也会被 taro 所覆盖
})

export app
```

</TabItem>
</Tabs>

## 入口组件配置

请参考 [全局配置](./app-config)

## 生命周期方法

> 在 Vue2 和 Vue3 中，Taro 额外添加的生命周期方法的写法一致

入口组件除了支持 Vue 的生命周期方法外，还根据小程序的标准，额外支持以下生命周期：

### onLaunch (options)

> 在小程序环境中对应 app 的 `onLaunch`。

在此生命周期中通过访问 `options` 参数或调用 `getCurrentInstance().router`，可以访问到程序初始化参数。

#### 参数

##### options

| 属性         | 类型   | 说明                                                                 |
| ------------ | ------ | -------------------------------------------------------------------- |
| path         | string | 启动小程序的路径                                                     |
| scene        | number | 启动小程序的场景值                                                   |
| query        | Object | 启动小程序的 query 参数                                              |
| shareTicket  | string | shareTicket，详见获取更多转发信息                                    |
| referrerInfo | Object | 来源信息。从另一个小程序、公众号或 App 进入小程序时返回。否则返回 {} |

##### options.referrerInfo

| 属性            | 类型   | 说明                                                                 |
| --------------- | ------ | -------------------------------------------------------------------- |
| appId           | string | 来源小程序，或者公众号（微信中）                                     |
| extraData       | Object | 来源小程序传过来的数据，微信和百度小程序在 scene=1037 或 1038 时支持 |
| sourceServiceId | string | 来源插件，当处于插件运行模式时可见                                   |

> options 参数的字段在不同小程序中可能存在差异，如：
>
> 场景值 scene，在微信小程序和百度小程序中存在区别，请分别参考 [微信小程序文档](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/scene.html) 和 [百度小程序文档](https://smartprogram.baidu.com/docs/data/scene/)

### onShow (options)

程序启动，或切前台时触发。

和 `onLaunch` 生命周期一样，在此生命周期中通过访问 `options` 参数或调用 `getCurrentInstance().router`，可以访问到程序初始化参数。

参数与 `onLaunch` 中获取的基本一致，但**百度小程序**中补充两个参数如下：

| 属性      | 类型   | 说明                                                                                                                                                 |
| --------- | ------ | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| entryType | string | 展现的来源标识，取值为 user/ schema /sys :<br />user：表示通过 home 前后<br/>切换或解锁屏幕等方式调起；<br/>schema：表示通过协议调起;<br />sys：其它 |
| appURL    | string | 展现时的调起协议，仅当 entryType 值为 schema 时存在                                                                                                  |

### onHide ()

程序切后台时触发。

### onError (error)

:::info
Taro v3.5.0+ 开始支持
:::

小程序发生脚本错误或 API 调用报错时触发。

### onPageNotFound (Object)

程序要打开的页面不存在时触发。

#### 参数

##### Object

| 属性        | 类型    | 说明                                                                           |
| ----------- | ------- | ------------------------------------------------------------------------------ |
| path        | string  | 不存在页面的路径                                                               |
| query       | Object  | 打开不存在页面的 query 参数                                                    |
| isEntryPage | boolean | 是否本次启动的首个页面（例如从分享等入口进来，首个页面是开发者配置的分享页面） |

### onUnhandledRejection (Object)

:::info
Taro v3.5.10+ 开始支持
:::

小程序有未处理的 Promise 拒绝时触发。

#### 参数

##### Object

| 属性    | 类型    | 说明                            |
| ------- | ------- | ------------------------------- |
| reason  | string  | 拒绝原因，一般是一个 Error 对象 |
| promise | Promise | 被拒绝的 Promise 对象           |

> 注意：**支付宝小程序**需要在源码根目录的 `project.alipay.json` 文件中添加配置 `enableAppxNg: true` 才能在真机环境进行监听。
</file>

<file path="docs/vue-overall.mdx">
---
title: 概述
---

import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

Taro 3 支持将 Web 框架直接运行在各平台，开发者使用的是真实的 Vue/Vue3 和 React 等框架。

但是 Taro 在组件、API、路由等规范上，遵循微信小程序规范，所以在 Taro 中使用 Vue/Vue3 和开发者熟悉的 Web 端有一些差异，以下将详细列出。

:::info
[Breaking] 旧项目升级到 Taro v3.4+ 时，使用 Vue2 请安装依赖 `@tarojs/plugin-framework-vue2`、使用 Vue3 请安装依赖 `@tarojs/plugin-framework-vue3`、
:::

## 入口组件和页面组件

因为 Taro 遵循小程序的路由规范，所以引入了[入口组件](./vue-entry)和[页面组件](./vue-page)的概念，分别对应小程序规范的入口组件 `app` 和页面组件 `page`。

一个 Taro 应用由一个入口组件和至少一个页面组件所组成。

## 内置组件

:::note
自 Taro v3.3+，支持使用 H5 标签进行开发，详情请见 [使用 HTML 标签](./use-h5)
:::

Taro 中可以使用小程序规范的内置组件进行开发，如 `<view>`、`<text>`、`<button>` 等。

### Taro 规范

1. 组件名遵从**小程序规范**（全小写，kebab-case）。
2. 组件属性遵从**小程序规范**（全小写，kebab-case）。
3. `Boolean` 值的组件属性需要显式绑定为 `true`，不支持简写。
4. 事件规范请看下一节：[组件事件](./vue-overall#%E4%BA%8B%E4%BB%B6)。

### 示例代码

```html
<template>
  <swiper
    class="box"
    :autoplay="true"
    :interval="interval"
    indicator-color="#999"
    @tap="handleTap"
    @animationfinish="handleAnimationFinish"
  >
    <swiper-item>
      <view class="text">1</view>
    </swiper-item>
    <swiper-item>
      <view class="text">2</view>
    </swiper-item>
    <swiper-item>
      <view class="text">3</view>
    </swiper-item>
  </swiper>
</template>

<script>
  export default {
    data() {
      return {
        interval: 1000,
      }
    },
    methods: {
      handleTap() {
        console.log('tap')
      },
      handleAnimationFinish() {
        console.log('finish')
      },
    },
  }
</script>
```

注意：如果某平台新增的组件或组件的属性还没被 Taro 支持，可以提交 [Issues](https://github.com/NervJS/taro/issues)，我们会尽快修复。

## 事件

事件和 Web 端一样。在事件回调函数中，第一个参数是事件对象，回调中调用 `stopPropagation` 可以阻止冒泡。

### Taro 规范

1. 使用 `@` 修饰符（或 `v-on:`，更多用法可以参考[Vue 文档](https://cn.vuejs.org/v2/guide/events.html)）替代小程序事件名中的 `bind`(替代支付宝小程序事件名中的 `on`)。
2. Vue 中点击事件使用 `@tap`。
3. 事件名称一般遵循组件属性规范（全部小写）。
4. 在 `vue@3.0.6` 或之后版本使用 JSX 时，事件名遵循 **onCamelcase** 规范，例如 `onGetphonenumber`。具体原因可参考 [#8796](https://github.com/NervJS/taro/issues/8796#issuecomment-802796286)。

### 示例代码

```html
<template>
  <!-- 注意，Vue 中点击事件需要绑定 @tap，-->
  <!-- 其余小程序事件名把 bind 换成 @ 即是 Taro 事件名（支付宝小程序除外，它的事件就是以 on 开头，需要把 on 换成 @）-->
  <scroll-view
    style="height: 300px"
    :scroll-y="true"
    @tap="handleClick"
    @scroll="handleScroll"
    @scrolltoupper="handleScrollToUpper"
  >
    <view style="height: 200px">1</view>
    <view style="height: 200px">2</view>
    <view style="height: 200px">3</view>
  </scroll-view>
</template>

<script>
  export default {
    methods: {
      handleClick(e) {
        console.log('handleClick')
        e.stopPropagation() // 阻止冒泡
      },
      handleScroll() {
        console.log('handleScroll')
      },
      handleScrollToUpper() {
        console.log('handleScrollToUpper')
      },
    },
  }
</script>
```

### Taro 3 在小程序端的事件机制

在 Taro 1 & 2 中，Taro 会根据开发者是否使用了 `e.stopPropagation()`，来决定在小程序模板中绑定的事件是以 `bind` 还是以 `catch` 形式。因此事件冒泡是由小程序控制的。

但是在 Taro 3，我们在小程序逻辑层实现了一套事件系统，包括事件触发和事件冒泡。在小程序模板中绑定的事件都是以 `bind` 的形式。

一般情况下，这套在逻辑层实现的小程序事件系统是可以正常工作的，事件回调能正确触发、冒泡、停止冒泡。

但是，小程序模板中绑定的 `catchtouchmove` 事件除了可以阻止回调函数冒泡触发外，还能阻止视图的**滚动穿透**，这点 Taro 的事件系统是做不到的。

### 阻止滚动穿透

上一点中，我们介绍了 Taro 3 的事件机制。因为事件都以 `bind` 的形式进行绑定，因此不能使用 `e.stopPropagation()` 阻止滚动穿透。

针对滚动穿透，目前总结了两种解决办法：

#### 一、样式

使用样式解决：[禁止被穿透的组件滚动](https://github.com/NervJS/taro/issues/5984#issuecomment-614502302)。

这也是最推荐的做法。

#### 二、catchMove

> Taro 3.0.21 版本开始支持

但是地图组件本身就是可以滚动的，即使固定了它的宽高。所以第一种办法处理不了冒泡到地图组件上的滚动事件。

这时候可以为 `view` 组件增加 **catch-move** 属性：

```jsx
// 这个 View 组件会绑定 catchtouchmove 事件而不是 bindtouchmove
<view :catch-move="true"></view>
```

### dataset

#### 一般情况

我们建议按 Vue、 React 的 DSL 特性进行思考，因为 `dataset` 是小程序的特性。

#### dataset

`dataset` 是特别的模版属性，主要作用是可以在事件回调的 `event` 对象中获取到 `dataset` 相关数据。

**这点 Taro 是支持的**，在事件回调对象中可以通过 `event.target.dataset` 或 `event.currentTarget.dataset` 获取到。

#### 模板属性

上一点所说的，Taro 对于小程序 `dataset` 的模拟是在小程序的**逻辑层**实现的。**并没有真正在模板设置这个属性**。

但在小程序中有一些 API（如：`createIntersectionObserver`）获取到页面的节点的时候，由于节点上实际没有对应的属性而获取不到。

这时可以考虑使用 [taro-plugin-inject](https://github.com/NervJS/taro-plugin-inject) 插件注入一些通用属性，如：

```js title="config/index.js"
const config = {
  plugins: [
    [
      '@tarojs/plugin-inject',
      {
        components: {
          View: {
            'data-index': "'dataIndex'",
          },
          ScrollView: {
            'data-observe': "'dataObserve'",
          },
        },
      },
    ],
  ],
}
```

## 生命周期触发机制

Taro 3 在小程序逻辑层上实现了一份遵循 Web 标准 BOM 和 DOM API。因此 Vue 使用的 `document.appendChild`、`document.removeChild` 等 API 其实是 Taro 模拟实现的，最终的效果是把 Vue 的虚拟 DOM 树渲染为 Taro 模拟的 Web 标准 DOM 树。

因此在 Taro3 Vue 的生命周期触发时机和我们平常在 Web 开发中理解的概念有一些偏差。

### Vue 的生命周期

Vue 组件的生命周期方法在 Taro 中都支持使用。

触发时机：

##### 1. beforeMount ()

[onLoad](vue-page#onload-options) 之后，页面组件渲染到 Taro 的虚拟 DOM 之前触发。

##### 2. mounted ()

页面组件渲染到 Taro 的虚拟 DOM 之后触发。

此时能访问到 Taro 的虚拟 DOM（使用 Vue ref、document.getElementById 等手段），并支持对其进行操作（设置 DOM 的 style 等）。

但此时不代表 Taro 的虚拟 DOM 数据已经完成从逻辑层 `setData` 到视图层。因此这时**无法通过 `createSelectorQuery` 等方法获取小程序渲染层 DOM 节点。** 只能在 [onReady](vue-page#onready-) 生命周期中获取。

### 小程序页面的方法

小程序页面的方法，在 Taro 的页面中同样可以使用：在 Vue 对象中书写同名方法。

**注意：**小程序页面方法在各端的支持程度不一，请查阅对应小程序的文档。

## Ref

[节点获取](./ref.mdx)

## v-html

在小程序端，使用 `v-html` 时有一些额外的配置选项和需要注意的地方，详情请参考[《渲染 HTML》](html)。

## 兼容 `<transition>`

`<transition>` 组件内部使用了 `getComputedStyle`，用于嗅探组件上的动画样式。但是在小程序中没有办法实现 `getComputedStyle`，可以通过以下方法进行 hack：

为元素的 `style` 设置 `transitionDuration` 或 `animationDuration` 指定过渡时间，即可兼容 `<transition>`。

```jsx
<transition>
  <view style="animationDuration: 0.5s" />
</transition>
```

## 其它限制

- 由于小程序访问元素位置为异步 API，因此小程序中无法使用内置的 `transition-group` 组件。
- 小程序中不支持 `<style scoped>`，建议使用 cssModules 代替。[#6662](https://github.com/NervJS/taro/issues/6662)
- 所有组件的 `id` 必须在整个应用中保持唯一（即使他们在不同的页面），否则可能导致事件不触发的问题，[#7317](https://github.com/NervJS/taro/issues/7317)
</file>

<file path="docs/vue-page.mdx">
---
title: 页面组件
---

import TabItem from '@theme/TabItem'
import Tabs from '@theme/Tabs'

每一个 Taro 应用都至少包括一个页面组件，页面组件可以通过 Taro 路由进行跳转，也可以访问小程序页面的生命周期。

每一个页面组件必须是一个 `.vue` 文件。

## 代码示例

<Tabs
  defaultValue="vue"
  values={[
    {label: 'Vue2', value: 'vue'},
    {label: 'Vue3', value: 'vue3'}
  ]}>
<TabItem value="vue">

```jsx title="page.vue"
<template>
  <view class="index"></view>
</template>

<script>
export default {
  name: 'Index',

  // 可以使用所有的 Vue 生命周期方法
  mounted () {},

  // onLoad
  onLoad () {},

  // onReady
  onReady () {},

  // 对应 onShow
  onShow () {},

  // 对应 onHide
  onHide () {},

  // 对应 onPullDownRefresh
  onPullDownRefresh () {}
}
</script>

<style>
.index {}
</style>
```

</TabItem>

<TabItem value="vue3">

```jsx title="page.vue"
<template>
  <view class="index">
    <text>{{ msg }}</text>
  </view>
</template>

<script>
import { ref } from 'vue'

export default {
  // 可以使用所有的 Vue 生命周期方法
  mounted () {},

  // onLoad
  onLoad () {},

  // onReady
  onReady () {},

  // 对应 onShow
  onShow () {},

  // 对应 onHide
  onHide () {},

  // 对应 onPullDownRefresh
  onPullDownRefresh () {},

  setup () {
    const msg = ref('Hello world')
    return {
      msg
    }
  }
}
</script>
```

</TabItem>
</Tabs>

## 页面组件配置

请参考 [页面配置](./page-config)

## 生命周期方法

> 在 Vue2 和 Vue3 中，Taro 额外添加的生命周期方法的写法一致

页面组件除了支持 Vue 的生命周期方法外，还根据小程序的标准，额外支持以下生命周期：

### onLoad (options)

> 在小程序环境中对应页面的 `onLoad`。

页面创建时执行。在此生命周期中通过访问 `options` 参数或调用 `getCurrentInstance().router`，可以访问到页面路由参数。

### onUnload ()

:::info
Taro v3.4.7 开始支持。
:::

> 在小程序环境中对应页面的 `onUnload`。

一般情况下建议使用 Vue 的 `onUnmounted` 生命周期处理页面卸载时的逻辑。当某些特殊情况需要在页面的 `onUnload` 的同一个事件循环中实现逻辑时才使用它（如对小程序的生命周期执行顺序有强依赖关系时）。

### onReady ()

> 在小程序环境中对应页面的 `onReady`。

页面首次渲染完毕时执行。从此生命周期开始可以使用 `createCanvasContext` 或 `createSelectorQuery` 等 API 访问小程序渲染层的 DOM 节点。

#### 子组件的 onReady

只在页面组件才会触发 `onReady` 生命周期。子组件可以使用 Taro 内置的[消息机制](./apis/about/events)监听页面组件的 `onReady()` 生命周期：

```html title="页面中某个子组件"
<template>
  <view id="only" />
</template>

<script>
  import Taro, { eventCenter, getCurrentInstance } from '@tarojs/taro'

  export default {
    mounted() {
      eventCenter.once(getCurrentInstance().router.onReady, () => {
        console.log('onReady')

        // onReady 触发后才能获取小程序渲染层的节点
        Taro.createSelectorQuery()
          .select('#only')
          .boundingClientRect()
          .exec((res) => console.log('res: ', res))
      })
    },
  }
</script>
```

但是当子组件是**按需加载**的时候，页面 `onReady` 早已触发。如果此按需加载的子组件需要获取小程序渲染层的 DOM 节点，因为错过了页面 `onReady`，只能尝试使用 `Taro.nextTick` 模拟：

```html title="按需加载的子组件"
<template>
  <view id="only" />
</template>

<script>
  import Taro from '@tarojs/taro'

  export default {
    mounted() {
      Taro.nextTick(() => {
        // 使用 Taro.nextTick 模拟 setData 已结束，节点已完成渲染
        Taro.createSelectorQuery()
          .select('#only')
          .boundingClientRect()
          .exec((res) => console.log('res: ', res))
      })
    },
  }
</script>
```

### onShow ()

> 在小程序环境中对应页面的 `onShow`。

页面显示/切入前台时触发。

#### 子组件的 onShow

只在页面组件才会触发 `onShow` 生命周期。子组件可以使用 Taro 内置的[消息机制](./apis/about/events)监听页面组件的 `onShow()` 生命周期：

```jsx title="页面中某个子组件"
<script>
  import { eventCenter, getCurrentInstance } from '@tarojs/taro'

  export default {
    mounted () {
      eventCenter.on(getCurrentInstance().router.onShow, () => {
        console.log('onShow')
      })
    }
  }
</script>
```

### onHide ()

> 在小程序环境中对应页面的 `onHide`。

页面隐藏/切入后台时触发。

#### 子组件的 onHide

只在页面组件才会触发 `onHide` 生命周期。子组件可以使用 Taro 内置的[消息机制](./apis/about/events)监听页面组件的 `onHide()` 生命周期：

```jsx title="页面中某个子组件"
<script>
  import { eventCenter, getCurrentInstance } from '@tarojs/taro'

  export default {
    mounted () {
      eventCenter.on(getCurrentInstance().router.onHide, () => {
        console.log('onHide')
      })
    }
  }
</script>
```

### onPullDownRefresh ()

监听用户下拉动作。

- 需要在全局配置的 window 选项中或页面配置中设置 `enablePullDownRefresh: true`。
- 可以通过 [Taro.startPullDownRefresh](./apis/ui/pull-down-refresh/startPullDownRefresh.md) 触发下拉刷新，调用后触发下拉刷新动画，效果与用户手动下拉刷新一致。
- 当处理完数据刷新后，[Taro.stopPullDownRefresh](./apis/ui/pull-down-refresh/stopPullDownRefresh.md) 可以停止当前页面的下拉刷新。

### onReachBottom ()

监听用户上拉触底事件。

- 可以在全局配置的 window 选项中或页面配置中设置触发距离 `onReachBottomDistance`。
- 在触发距离内滑动期间，本事件只会被触发一次

> 需要 `enablePullDownRefresh` 配置

### onPageScroll (Object)

监听用户滑动页面事件。

> 需要 `enablePullDownRefresh` 配置

#### 参数

##### Object

| 参数      | 类型   | 说明                                  |
| --------- | ------ | ------------------------------------- |
| scrollTop | Number | 页面在垂直方向已滚动的距离（单位 px） |

### onAddToFavorites (Object)

监听用户点击右上角菜单“收藏”按钮的行为，并自定义收藏内容。

> Taro 3.0.3 版本开始支持。
> 只有微信小程序支持，本接口为 Beta 版本，安卓 7.0.15 版本起支持，暂只在安卓平台支持。

#### 参数

##### Object

| 参数       | 类型   | 说明                                                 |
| ---------- | ------ | ---------------------------------------------------- |
| webviewUrl | String | 页面中包含 web-view 组件时，返回当前 web-view 的 url |

此事件处理函数需要 return 一个 Object，用于自定义收藏内容：

| 字段     | 说明                              | 默认值             |
| -------- | --------------------------------- | ------------------ |
| title    | 自定义标题                        | 页面标题或账号名称 |
| imageUrl | 自定义图片，显示图片长宽比为 1：1 | 页面截图           |
| query    | 自定义 query 字段                 | 当前页面的 query   |

#### 示例代码

```jsx title="page.vue"
<script>
  export default {
    onAddToFavorites (res) {
      // webview 页面返回 webviewUrl
      console.log('WebviewUrl: ', res?.webviewUrl)
      return {
        title: '自定义标题',
        imageUrl: 'https://demo.png',
        query: 'name=xxx&age=xxx',
      }
    }
  }
</script>
```

### onShareAppMessage (Object)

监听用户点击页面内转发按钮（Button 组件 openType='share'）或右上角菜单“转发”按钮的行为，并自定义转发内容。

**注意：**只有定义了此事件处理函数，右上角菜单才会显示“转发”按钮。对于某些特殊写法，如果定义了此事件处理函数后“转发”按钮还是不可点击，请在该页面配置中设置 `enableShareAppMessage: true`。

#### 参数

##### Object

| 参数       | 类型   | 说明                                                                                     |
| ---------- | ------ | ---------------------------------------------------------------------------------------- |
| from       | String | 转发事件来源。<br />button：页面内转发按钮；<br />menu：右上角转发菜单                   |
| target     | Object | 如果 `from` 值是 `button`，则 `target` 是触发这次转发事件的 `button`，否则为 `undefined` |
| webViewUrl | String | 页面中包含 `WebView` 组件时，返回当前 `WebView` 的 url                                   |

此事件需要 return 一个 Object，用于自定义转发内容，返回内容如下：

自定义转发内容

| 字段     | 类型                                                                                                       | 说明                                      |
| -------- | ---------------------------------------------------------------------------------------------------------- | ----------------------------------------- |
| title    | 转发标题                                                                                                   | 当前小程序名称                            |
| path     | 转发路径                                                                                                   | 当前页面 path ，必须是以 / 开头的完整路径 |
| imageUrl | 自定义图片路径，可以是本地文件路径、代码包文件路径或者网络图片路径。支持 PNG 及 JPG 。显示图片长宽比是 5:4 | 使用默认截图                              |

#### 示例代码

```jsx title="page.vue"
<script>
  export default {
    onShareAppMessage (res) {
      if (res.from === 'button') {
        // 来自页面内转发按钮
        console.log(res.target)
      }
      return {
        title: '自定义转发标题',
        path: '/page/user?id=123'
      }
    }
  }
</script>
```

### onShareTimeline ()

监听右上角菜单“分享到朋友圈”按钮的行为，并自定义分享内容。

> Taro 3.0.3 版本开始支持
> 只有微信小程序支持，基础库 2.11.3 开始支持，本接口为 Beta 版本，暂只在 Android 平台支持

**注意：**只有定义了此事件处理函数，同时监听了 `onShareAppMessage`，右上角菜单才会显示“分享到朋友圈”按钮。对于某些特殊写法，如果定义了此事件处理函数后“分享到朋友圈”按钮还是不可点击，请在该页面配置中设置 `enableShareTimeline: true`。

#### 返回值

事件处理函数可以返回一个 Object，用于自定义分享内容，不支持自定义页面路径，返回内容如下：

| 字段     | 说明                                                                                | 默认值                 |
| -------- | ----------------------------------------------------------------------------------- | ---------------------- |
| title    | 自定义标题                                                                          | 当前小程序名称         |
| query    | 自定义页面路径中携带的参数                                                          | 当前页面路径携带的参数 |
| imageUrl | 自定义图片路径，可以是本地文件或者网络图片。支持 PNG 及 JPG，显示图片长宽比是 1:1。 | 默认使用小程序 Logo    |

#### 示例代码

```jsx title="page.vue"
<script>
  export default {
    onShareAppMessage () {},
    onShareTimeline () {
      console.log('onShareTimeline')
      return {}
    }
  }
</script>
```

### onResize (Object)

小程序屏幕旋转时触发。详见 [响应显示区域变化](https://developers.weixin.qq.com/miniprogram/dev/framework/view/resizable.html#%E5%9C%A8%E6%89%8B%E6%9C%BA%E4%B8%8A%E5%90%AF%E7%94%A8%E5%B1%8F%E5%B9%95%E6%97%8B%E8%BD%AC%E6%94%AF%E6%8C%81)。

### onTabItemTap (Object)

点击 tab 时触发。

#### 参数

##### Object

| 参数     | 类型   | 说明                             |
| -------- | ------ | -------------------------------- |
| index    | String | 被点击 tabItem 的序号，从 0 开始 |
| pagePath | String | 被点击 tabItem 的页面路径        |
| text     | String | 被点击 tabItem 的按钮文字        |

### onSaveExitState

:::info
Taro v3.5.0+ 开始支持
:::

每当小程序可能被销毁之前，页面回调函数 `onSaveExitState` 会被调用，可以进行[退出状态](https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/operating-mechanism.html#_4-%E9%80%80%E5%87%BA%E7%8A%B6%E6%80%81)的保存。

> 只有微信小程序支持，基础库 2.7.4 开始支持。

### onTitleClick ()

> 只有支付宝小程序支持

点击标题触发

### onOptionMenuClick ()

> 只有支付宝小程序支持

点击导航栏额外图标触发

### onPopMenuClick ()

> 只有支付宝小程序支持

暂无说明

### onPullIntercept ()

> 只有支付宝小程序支持

下拉截断时触发
</file>

<file path="docs/vue3.md">
---
title: Vue3
---

Taro 可以使用 Vue 3 进行开发，开发者可以使用 `taro init` 命令创建 Vue3 的模版，包括 **default**、 **vuex** 以及 [NutUI](https://nutui.jd.com/) 。我们推荐使用 NutUI4.0 模版进行开发。

具体用法可以参考 Taro Vue 系列文档。

开发者可以自行选择使用 options 式配置或 [Composition API](https://v3.vuejs.org/guide/composition-api-introduction.html) 组织逻辑，浏览 [Vue 3 文档](https://v3.vuejs.org/) 以了解更多的 Vue3 改动。

## JSX

我们可以直接使用 JSX 编写 Vue3 组件，相关注意事项：

- 小程序的 `bindtap` 事件在 JSX 中需要绑定为 `onClick`。
- 事件名命名规范为 **onCamelcase**，如小程序的事件名为 `bindtouchstart`，JSX 中需要绑定为 `onTouchstart`。
- Taro `v3.4.5+` 开始支持在 H5 中使用 JSX。

例子：

```jsx
import { reactive } from 'vue'
import { View, Text, Button } from '@tarojs/components'

export default {
  name: 'Index',
  components: {
    View,
    Text,
    Button,
  },
  setup() {
    const state = reactive({
      msg: '欢迎使用 NutUI 开发小程序',
      msg2: '你成功了～',
    })

    const handleClick = (msg) => {
      state.msg = msg
    }

    return () => {
      return (
        <View>
          <View>
            <Text>{state.msg}</Text>
          </View>
          <Button onTouchstart={() => handleClick(state.msg2)}>Confirm</Button>
        </View>
      )
    }
  },
}
```

使用 `ts` 用户可以在 `tsconfig.json` 中引入组件的类型提示：

```json
{
  "compilerOptions": {
    "types": ["@tarojs/components/vue3"]
  }
}
```

## teleport

由于不能在页面组件的 DOM 树之外插入元素，因此不支持应用级别的 `<teleport>`。但你仍可以在当前页面内使用 `<teleport>`。

示例项目：[taro-vue-teleport](https://github.com/AdvancedCat/taro-vue-teleport)


## vueLoaderOption

:::info
Taro v3.4.8 开始支持
:::

传递给 VueLoader 的编译配置，编译配置细节请参阅 [vue-loader 文档](https://vue-loader.vuejs.org/options.html)。

Taro 中可以通过修改 `@tarojs/plugin-framework-vue3` 的配置项去设置 vueLoader 的配置项：

```js title="config/index.js"
const config = {
  plugins: [
    [
      '@tarojs/plugin-framework-vue3',
      {
        vueLoaderOption: {
          compilerOptions: {
            isCustomElement: (tag) => tag.includes('ec-canvas'),
            whitespace: 'preserve',
            // ...
          },
          reactivityTransform: true, // 开启vue3响应性语法糖
        },
      },
    ],
  ],
  // ...
}
```

## 其它限制

- 小程序中不支持 `<style scoped>`，建议使用 cssModules 代替。[#6662](https://github.com/NervJS/taro/issues/6662)
- Vue 3 内部实现使用了 Proxy ，在 iOS 9 及以下操作系统无法运行。但 Vue 官方团队在正式版发布后会推出兼容版本。
- 小程序端非类似 HTML 表单标签规范的表单组件，如 Picker，暂不兼容 v-model。Vue3 的 v-model 绑定属性改为了 modelValue，事件绑定改为了 update:modelValue。对于 HTML 表单标签会自动对接表单的值与事件，例如 input 会自动对应 modelValue 与 value、update:modelValue 与 @input。但对于 Picker 这种小程序特有表单则无法对应，建议这种情况不使用 v-model。
- VirtualList 组件需升级至 v3.6+ 版本
- 在 H5 端使用 ref 获取基础组件的 DOM 节点，现在只能得到适配层的 Vue 组件实例，而不是对应的 webComponent 根节点。在 Vue2 里可以通过修改父元素的 refs 属性实现，但 Vue3 中组件间初始化顺序有变化，因此暂时不能支持。（自 Taro v3.4.5 起，不再存在此限制，[#11537](https://github.com/NervJS/taro/pull/11537)）

## 相关阅读

Vue3 新特性可参阅 [Vue3 文档](https://v3.vuejs.org/guide/migration/introduction.html#notable-new-features)。

Taro 是如何兼容 Vue3 的，可参阅 [Taro RFC](https://github.com/NervJS/taro-rfcs/blob/master/rfcs/0001-vue-3-support.md)。

[《使用 Vue3 开发小程序》](https://taro-club.jd.com/topic/2267/%E4%BD%BF%E7%94%A8-vue3-%E5%BC%80%E5%8F%91%E5%B0%8F%E7%A8%8B%E5%BA%8F) by lillian。

[ NutUI 开发示例 ](https://github.com/jdf2e/nutui-demo/tree/master/taro) by jdf2e。
</file>

<file path="docs/vuex.md">
---
title: Vue2 Vuex
---

Taro Vue2 支持使用 [Vuex](https://vuex.vuejs.org/) 进行状态管理。

## 安装

首先请安装 `vuex` 的 3.x 版本：

```bash
$ yarn add vuex@^3
# 或者使用 npm
$ npm install vuex@^3
```

## 例子

- 运行 `taro init` 命令时选择 Vue -> vuex 即可创建 vue2-redux 模板项目。

## 使用

在项目中新建 `src/store/index.js` 文件用来配置 `store`，根据需求设置 `state`、`mutations`、`actions`、`getters`：

```js title="src/store/index.js"
import Vue from 'vue'
import Vuex from 'vuex'

Vue.use(Vuex)

const state = {
  numbers: [1, 2, 3],
}

const mutations = {
  ADD_NUMBER(state, payload) {
    state.numbers.push(payload)
  },
}

const actions = {
  addNumber(context, number) {
    context.commit('ADD_NUMBER', number)
  },
}

const getters = {
  getNumbers(state) {
    return state.numbers
  },
}

export default new Vuex.Store({
  state,
  mutations,
  actions,
  getters,
})
```

为了在组件中可以通过 `this.$store` 获取到 store，我们需要把 store 注入到 Vue 实例中：

```js title="src/app.js"
import Vue from 'vue'
import store from './store'

const App = {
  store,
  render(h) {
    return h('block', this.$slots.default)
  },
}

export default App
```

接下来即可以在 Vue 组件中使用 store 了，如：

```js
this.$store.dispatch('addNumber', 1)
```
</file>

<file path="docs/wxcloudbase.md">
---
title: 小程序云开发模板
---

> 自 `v1.2.20` 开始支持此功能，仅支持微信小程序

[云开发（CloudBase）](https://www.cloudbase.net?ADTAG=taro)是基于 Serverless 架构构建的一站式后端云服务，涵盖函数、数据库、存储、CDN 等服务，免后端运维，支持小程序、Web 和 APP 开发。
其中，小程序·云开发是微信和腾讯云联合推出的云端一体化解决方案，基于云开发可以免鉴权调用微信所有开放能力，在微信开发者工具中即可开通使用。

## 使用小程序云开发项目模板

在 1.2.20 版本中，新增了小程序云开发项目模板。如需使用，请将 CLI 更新至 `1.2.20` 以上版本。[更新](./GETTING-STARTED#更新)

## 模板目录结构

```conf
├── client                                  小程序端目录
│   ├── config                              配置目录
│   │   ├── dev.js                          开发时配置
│   │   ├── index.js                        默认配置
│   │   └── prod.js                         打包时配置
│   ├── dist                                编译结果目录
│   ├── package.json
│   ├── src                                 源码目录
│   │   ├── app.scss                        项目总通用样式
│   │   ├── app.js                          项目入口文件
│   │   ├── components                      组件文件目录
│   │   │   └── login                       login 组件目录
│   │   │       └── index.weapp.js          login 组件逻辑
│   │   └── pages                           页面文件目录
│   │       └── index                       index 页面目录
│   │           ├── index.scss              index 页面逻辑
│   │           └── index.js                index 页面样式
├── cloud                                   服务端目录
│   └── functions                           云函数目录
│       └── login                           login 云函数
│           ├── index.js                    login 函数逻辑
│           └── package.json
└── project.config.json                     小程序项目配置
```

### 使用要点

1. 开发时，进入 client 目录，在此目录下运行相关编译预览或打包命令
2. 使用微信开发者工具调试项目，请将项目 **整个文件夹** 作为运行目录。 注意： 不是 client 中生成的 dist 文件夹
</file>

<file path="docs/youshu.md">
---
title: 接入腾讯有数无痕埋点能力
sidebar_label: 腾讯有数无痕埋点能力
---

Taro 引入了腾讯有数的微信小程序无痕埋点能力，为 Taro 的开发者提供真·零开发的 8 大无痕埋点能力以及自定义埋点能力，包含**小程序启动、显示、隐藏、页面浏览、页面离开、分享、下拉刷新、上拉触底**等**八大自动化埋点能力**以及搜索、商品归因等**定制化埋点**，以及经营分析、直播分析、导购分析等能力。

## 腾讯有数简介

[腾讯有数](https://youshu.tencent.com/)是由[腾讯智慧零售](https://lingshou.tencent.com)推出，为品牌商、零售商打造的数据分析与管理平台，融合腾讯数据、技术与生态优势，提供全链路经营数据分析、消费者洞察、精准营销等能力，让企业经营更“有数”。

更多介绍请关注：[https://mp.zhls.qq.com/youshu-docs/start/youshu_intro.html](https://mp.zhls.qq.com/youshu-docs/start/youshu_intro.html)

## 功能介绍

腾讯有数 & Taro 合作开发的微信小程序模板，可以快速的通过 `taro init myApp` 选择 `default-youshu` 模板即可快速拥有无痕埋点能力，无需任何开发即可拥有小程序启动、显示、隐藏、页面浏览、页面离开、分享、下拉刷新、上拉触底等八大自动化埋点能力。

## 零开发快速体验指南

> 需要升级 Taro 到 2.x 或 3.x

1. `taro init myApp`
2. 选择`default-youshu`模板
3. `npm run dev:weapp`
4. 微信小程序开发者工具控制台即可看到 8 大行为日志上报
5. 访问 [https://docs.qq.com/form/fill/DUkZHalR0RUJCVkVj#/fill](https://docs.qq.com/form/fill/DUkZHalR0RUJCVkVj#/fill) 申请有数数据查看权限

> 通过上述流程已经让你的微信小程序拥有了 8 大用户行为埋点的体验能力，体验完成后，只需要更换有数的 Token 和微信小程序 appid，即可拥有有数的正式版功能。正式账号获取路径：https://docs.qq.com/form/fill/DUkZHalR0RUJCVkVj#/fill

## 现存小程序的有数 SDK 接入

### 1. 安装

- 通过 npm 安装 SDK
  `npm i sr-sdk-wxapp`
- 在 app.jsx 中通过 import 引入 SDK
  `import sr from 'sr-sdk-wxapp'`

### 2. 添加可信域名

登录[微信公众平台](https://mp.weixin.qq.com/)，进入<开发><开发设置><服务器域名>，将 `https://zhls.qq.com` 添加为 request 合法域名。

> 在开发环境中还有 SDK 版本检查，所以会提示 `https://sr-home-1257214331.cos.ap-guangzhou.myqcloud.com 不在以下 request 合法域名列表中` , 可以通过设置不校验域名来处理。

### 3. init 初始化

`init(options: object)`

配置接口，用来调整 SDK 的基础机制。应该在`App()`调用之前调用。

首次调用初始化 SDK，再次调用覆盖之前传入的配置，可多次调用。

| 名称              | 类型   | 必填 | 描述                                                                                                                              |
| :---------------- | :----- | :--- | :-------------------------------------------------------------------------------------------------------------------------------- |
| appid             | string | Y    | 微信小程序 appId                                                                                                                  |
| token             | string | Y    | 通过接入申请后，有数提供的凭证字符串                                                                                              |
| usePlugin         | bool   |      | 是否使用了小程序插件，默认是：false                                                                                               |
| debug             | bool   |      | 是否打印日志，默认是：false                                                                                                       |
| openSdkShareDepth | bool   |      | 是否打开分享链路记录功能，默认值为 false，打开后，将记录用户分享链路 A->B->C->D                                                   |
| serverUrl         | string |      | 传入自定义的后台上报接口，若传入则 token 将无意义， 默认是：'https://zhls.qq.com/api/report'                                      |
| trackApp          | bool   |      | 是否开启自动跟踪 APP 的曝光事件（APP 相关预置事件，如 APP - onLuanch），默认是：true                                              |
| proxyPage         | bool   |      | 是否开启自动代理 Page，默认是：false。SDK 负责上报页面的 browse 、leave、share 等事件可以使用 sr.page 代替 Page(sr.page(options)) |
| autoStart         | bool   |      | 是否开启自动开始上报，默认是：false，open_id 无法自动获取，一般在 login 业务之后手动调用 sr.startReport 方法开启上报              |

### 4. 示例

```javascript
import sr from 'sr-sdk-wxapp'
sr.init({
  /**
   * 有数 - ka‘接入测试用’ 分配的 app_id，对应的业务接口人负责
   */
  token: 'bi72fccc7184ef4xxx',
  /**
   * 微信小程序appID，以wx开头
   */
  appid: 'wx195745e8e342bxxx',
  /**
   * 如果使用了小程序插件，需要设置为 true
   */
  usePlugin: false,
  /**
   * 开启打印调试信息， 默认 false
   */
  debug: true,
  /**
   * 建议开启-开启自动代理 Page， 默认 false
   * sdk 负责上报页面的 browse 、leave、share 等事件
   * 可以使用 sr.page 代替 Page(sr.page(options))
   * 元素事件跟踪，需要配合 autoTrack: true
   */
  proxyPage: true,
  /**
   * 建议开启-开启组件自动代理， 默认 false
   * sdk 负责上报页面的 browse 、leave、share 等事件
   */
  proxyComponent: true,
  // 建议开启-是否开启页面分享链路自动跟踪
  openSdkShareDepth: true,
  // 建议开启-元素事件跟踪，自动上报元素事件，入tap、change、longpress、confirm
  autoTrack: true,
})
```
</file>

</files>
